<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Configuring authentication for Foreman users</title>
<style>
﻿*,::before,::after{box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:100%}body{background:#fff;color:rgba(0,0,0,0.8);padding:0;margin:0;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:inherit;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,p,blockquote,th,td{margin:0;padding:0}a{background:none;color:#2156a5;text-decoration:underline;line-height:inherit}a:active,a:hover{cursor:pointer;outline:0}a:focus{outline:thin dotted}a:hover,a:focus{color:#1d4b8f}abbr{font-size:0.9em}abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}b,strong{font-weight:bold;line-height:inherit}strong strong{font-weight:400}code,kbd,pre{font-family:"Droid Sans Mono", "DejaVu Sans Mono", monospace;font-size:1em}code{font-weight:400;color:rgba(0,0,0,0.9)}pre{color:rgba(0,0,0,0.9);line-height:1.45;text-rendering:optimizeSpeed;white-space:pre-wrap}dfn{font-style:italic}em,i{font-style:italic;line-height:inherit}em em{font-style:normal}hr{border:solid #dddddf;border-width:1px 0 0;clear:both;height:0;margin:1.25em 0 1.1875em}mark{background:#ff0;color:#000}p{line-height:1.6;margin-bottom:1.25rem;text-rendering:optimizeLegibility}q{quotes:"“" "”" "‘" "’"}small{font-size:60%;line-height:inherit}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img,object[type^="image/"],svg{display:inline-block;height:auto;max-width:100%;vertical-align:middle}img{border:0;-ms-interpolation-mode:bicubic}object{max-width:100%}svg:not(:root){overflow:hidden}figure{margin:0}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}.left{float:left !important}.right{float:right !important}.text-left{text-align:left !important}.text-right{text-align:right !important}.text-center{text-align:center !important}.text-justify{text-align:justify !important}.hide{display:none}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:0.25em}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.2;word-spacing:-0.05em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em;margin-left:1.125em}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,0.85)}@media screen and (min-width: 768px){h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;border:1px solid #dedede;border-collapse:collapse;border-spacing:0;margin-bottom:1.25em;word-wrap:normal}table thead,table tfoot{background:#f7f8f7}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,0.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,0.8)}table tr.even,table tr.alt{background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.center{margin-left:auto;margin-right:auto}.stretch{width:100%}.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:"";display:table}.clearfix::after,.float-group::after{clear:both}:not(pre).nobreak{word-wrap:normal}:not(pre).nowrap{white-space:nowrap}:not(pre).pre-wrap{white-space:pre-wrap}:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal !important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}pre>code{display:block}pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}.keyseq{color:rgba(51,51,51,0.8)}kbd{display:inline-block;color:rgba(0,0,0,0.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,0.2),inset 0 0 0 0.1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menuref{color:#000}.menuseq b:not(.caret),.menuref{font-weight:inherit}.menuseq{word-spacing:-0.02em}.menuseq b.caret{font-size:1.25em;line-height:0.8}.menuseq i.caret{font-weight:bold;text-align:center;width:0.45em}b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}b.button::before{content:"[";padding:0 3px 0 2px}b.button::after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,0.9)}body>div[id]{margin:0 auto;max-width:62.5em;position:relative;padding-left:.9375em;padding-right:0.9375em}body>div[id]::before,body>div[id]::after,#content #footnotes::before{content:"";display:table;clear:both}#content{margin-top:1.25em;margin-bottom:0.625em}#content::before{content:none}#header>h1:first-child{color:rgba(0,0,0,0.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,0.6);display:flex;flex-flow:row wrap}#header .details span:first-child{margin-left:-0.125em}#header .details span.email a{color:rgba(0,0,0,0.85)}#header .details br{display:none}#header .details br+span::before{content:" – "}#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,0.85)}#header .details br+span#revremark::before{content:" | "}#header #revnumber{text-transform:capitalize}#header #revnumber::after{content:" "}#content>h1:first-child:not([class]){color:rgba(0,0,0,0.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #e7e7e9;padding-bottom:0.5em}#toc>ul{margin-left:0.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:0.5em 0}#toc ul{font-family:"Open Sans", "DejaVu Sans", sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:0.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media screen and (min-width: 768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0 !important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0 !important;border-bottom-width:0 !important;z-index:1000;padding:1.25em 1em;height:calc(100% - (70px + 2.5em));overflow:auto}#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:0.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}@media screen and (min-width: 1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:0.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:none;background:#025d8c;padding:1.25em;margin-left:2em}#footer-text{color:rgba(255,255,255,0.8);line-height:1.44}h1:before,h2:before,h3:before,h4:before,h5:before,h6:before,div.title:before{display:block;content:" ";height:90px;margin-top:-90px;visibility:hidden}.sect1{padding-bottom:0.625em}@media screen and (min-width: 768px){#content{margin-bottom:1.25em}.sect1{padding-bottom:1.25em}}.sect1:last-child{padding-bottom:0}.sect1+.sect1{border-top:1px solid #e7e7e9}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none !important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:0.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}details{margin-left:1.25rem}details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}details>summary::-webkit-details-marker{display:none}details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:1rem;font-style:italic}table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,0.85)}.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans", "DejaVu Sans", sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,0.6);word-wrap:anywhere}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#fffef7;border-radius:4px;box-shadow:0 1px 4px #e0e0dc}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:0.8125em}@media screen and (min-width: 768px){.literalblock pre,.listingblock>.content>pre{font-size:0.90625em}}@media screen and (min-width: 1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,0.9)}.listingblock>.content{position:relative}.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:0.5}.listingblock:hover code[data-lang]::before{display:block}.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:0.5}.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.prettyprint{background:#f7f7f8}pre.prettyprint .linenums{line-height:1.45;margin-left:2em}pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}pre.prettyprint li code[data-lang]::before{opacity:1}pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}table.linenotable td.code{padding-left:0.75em}table.linenotable td.linenos{width:0.01%}table.linenotable td.linenos,pre.pygments .linenos,pre.rouge .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}pre.pygments span.linenos,pre.rouge span.linenos{display:inline-block;margin-right:0.75em}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:0.75em}.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,0.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,0.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}.verseblock{margin:0 1em 1.25em}.verseblock pre{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-size:1.15rem;color:rgba(0,0,0,0.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:0.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,0.6)}.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}.quoteblock.abstract{margin:0 1em 1.25em;display:block}.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:0.25em solid #dddddf}.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}p.tableblock:last-child{margin-bottom:0}td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}td.tableblock>.content>:last-child{margin-bottom:-1.25em}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all>*>tr>*{border-width:1px}table.grid-cols>*>tr>*{border-width:0 1px}table.grid-rows>*>tr>*{border-width:1px 0}table.frame-all{border-width:1px}table.frame-ends{border-width:1px 0}table.frame-sides{border-width:0 1px}table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,0.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:0.625em}ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:0.625em}ul.unstyled,ol.unstyled{margin-left:0}li>p:empty:only-child::before{content:"";display:inline-block}ul.checklist>li>p:first-child{margin-left:-1em}ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:0.125em}ul.checklist>li>p:first-child>input[type=checkbox]:first-child{font:inherit;margin:0 .25em 0 0;padding:0}ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 0.625em -1.25em}ul.inline>li{margin-left:1.25em}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{vertical-align:top;padding:0 0.625em}td.hdlist1{font-weight:bold;padding-bottom:1.25em}td.hdlist2{word-wrap:anywhere}.literalblock+.colist,.listingblock+.colist{margin-top:-0.5em}.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}.colist td:not([class]):first-child img{max-width:none}.colist td:not([class]):last-child{padding:0.25em 0}.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}.imageblock.left{margin:0.25em 0.625em 1.25em 0}.imageblock.right{margin:0.25em 0 1.25em 0.625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 0.125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:0.625em}.image.right{margin-left:0.625em}a.image{text-decoration:none;display:inline-block}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:0.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:0.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:0.75em 0}div.page-break{display:none}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background:#00fafa}.black{color:#000}.black-background{background:#000}.blue{color:#0000bf}.blue-background{background:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background:#fa00fa}.gray{color:#606060}.gray-background{background:#7d7d7d}.green{color:#006000}.green-background{background:#007d00}.lime{color:#00bf00}.lime-background{background:#00fa00}.maroon{color:#600000}.maroon-background{background:#7d0000}.navy{color:#000060}.navy-background{background:#00007d}.olive{color:#606000}.olive-background{background:#7d7d00}.purple{color:#600060}.purple-background{background:#7d007d}.red{color:#bf0000}.red-background{background:#fa0000}.silver{color:#909090}.silver-background{background:#bcbcbc}.teal{color:#006060}.teal-background{background:#007d7d}.white{color:#bfbfbf}.white-background{background:#fafafa}.yellow{color:#bfbf00}.yellow-background{background:#fafa00}span.icon>.fa{cursor:default}a span.icon>.fa{cursor:inherit}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,0.5);cursor:default}.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,0.8);color:#111}.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff !important;background:rgba(0,0,0,0.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans", "DejaVu Sans", sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff !important}.conum[data-value]+b{display:none}.conum[data-value]::after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-0.125em}b.conum *{color:inherit !important}.conum:not([data-value]):empty{display:none}dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}h1,h2,p,td.content,span.alt,summary{letter-spacing:-0.01em}p strong,td.content strong,div.footnote strong{letter-spacing:-0.005em}p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.print-only{display:none !important}@page{margin:1.25cm 0.75cm}@media print{*{box-shadow:none !important;text-shadow:none !important}html{font-size:80%}a{color:inherit !important;text-decoration:underline !important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none !important}a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:0.25em}abbr[title]{border-bottom:1px dotted}abbr[title]::after{content:" (" attr(title) ")"}pre,blockquote,tr,img,object,svg{page-break-inside:avoid}thead{display:table-header-group}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}body>div[id]{max-width:none}#toc,.sidebarblock,.exampleblock>.content{background:none !important}#toc{border-bottom:1px solid #dddddf !important;padding-bottom:0 !important}body.book #header{text-align:center}body.book #header>h1:first-child{border:0 !important;margin:2.5em 0 1em}body.book #header .details{border:0 !important;display:block;padding:0 !important}body.book #header .details span:first-child{margin-left:0 !important}body.book #header .details br{display:block}body.book #header .details br+span::before{content:none !important}body.book #toc{border:0 !important;text-align:left !important;padding:0 !important;margin:0 !important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]::before{display:block}div.page-break{display:block;page-break-after:always}#footer{padding:0 0.9375em}.hide-on-print{display:none !important}.print-only{display:block !important}.hide-for-print{display:none !important}.show-for-print{display:inherit !important}}@media amzn-kf8, print{#header>h1:first-child{margin-top:1.25rem}.sect1{padding:0 !important}.sect1+.sect1{border:0}#footer{background:none}#footer-text{color:rgba(0,0,0,0.6);font-size:0.9em}}@media amzn-kf8{body>div[id]{padding:0}}body{padding:0;margin:0;margin-top:70px !important}.container{position:relative;z-index:1;padding-top:50px;min-height:100%}.container p{font-family:sans-serif;font-size:1.2em}nav{position:fixed;z-index:9999;left:0;right:0;top:0;height:70px;padding:0 1.5em;background-color:#025d8c;font-family:sans-serif;line-height:70px}nav .logo{width:50px;vertical-align:middle}nav .nav-menu{position:absolute;right:0.3em;top:0;padding:0;margin:0;list-style:none}nav .nav-item{display:inline-block}nav .nav-item>a{display:inline-block;padding:0 2.5em;line-height:70px;color:#fff;text-decoration:none}nav .dropdown{position:relative}nav .dropdown a::after{content:"";display:inline-block;margin-left:0.5em;vertical-align:middle;border-top:0.3em solid #fff;border-right:0.3em solid transparent;border-left:0.3em solid transparent}nav .dropdown.show a::after{transform:rotate(180deg)}nav .dropdown-menu{display:none;position:absolute;left:0;right:0;top:100%;padding:0.5em 0;margin-top:-0.5em;border:1px solid rgba(0,0,0,0.3);border-radius:0.5em;background-color:#fff;width:max-content}nav .dropdown-menu-left{left:auto;right:0}nav .dropdown.show .dropdown-menu{display:block}nav .dropdown-div{display:block;padding:0.4em 0;line-height:4em}nav .dropdown-div a::after{content:none;margin-left:0;border-top:0;border-right:0;border-left:0}nav .dropdown-item{display:block;padding:0 1.5em;font-size:0.875em;color:#000;line-height:1.6em;text-decoration:none}nav .btn-hamburger{display:none;position:absolute;right:1.5em;top:50%;background-color:transparent;border:0;cursor:pointer;outline:none;transform:translateY(-50%)}nav .btn-hamburger span{display:block;width:30px;height:4px;background-color:#fff;margin:6px;border-radius:2px;transition:0.3s ease-in-out}nav .btn-hamburger span:nth-child(4),nav .btn-hamburger span:nth-child(5){position:absolute;top:10px;opacity:0.5}nav .btn-hamburger span:nth-child(4){transform:rotate(45deg) scale(0)}nav .btn-hamburger span:nth-child(5){transform:rotate(-45deg) scale(0)}nav.opened .btn-hamburger span:nth-child(4){opacity:1;transform:rotate(45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(5){opacity:1;transform:rotate(-45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(1),nav.opened .btn-hamburger span:nth-child(2),nav.opened .btn-hamburger span:nth-child(3){opacity:0}@media screen and (max-width: 768px){nav .nav-menu{position:fixed;left:0;right:0;top:70px;bottom:100%;display:flex;flex-direction:column;justify-content:start;background-color:#363d4e;transition:bottom 0.5s ease-in-out;overflow:hidden}nav.opened .nav-menu{bottom:0}nav .nav-item>a{display:block}nav .dropdown-menu{position:relative;top:0;margin:0 1.5em}nav .btn-hamburger{display:block}}@media screen{div.narrow{max-width:1080px;margin:0 auto !important;margin-top:70px auto !important;float:none !important}#toc.toc2{margin-top:70px !important}}

</style>
<!-- docinfo -->
<style>
/*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
.tabs {
  margin-bottom: 1.25em;
}

.tablist > ul {
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  margin: 0;
  padding: 0;
}

.tablist > ul li {
  align-items: center;
  background-color: #fff;
  cursor: pointer;
  display: flex;
  font-weight: bold;
  line-height: 1.5;
  padding: 0.25em 1em;
  position: relative;
}

.tablist > ul li:focus-visible {
  outline: none;
}

.tablist.ulist,
.tablist.ulist > ul li {
  margin: 0;
}

.tablist.ulist > ul li + li {
  margin-left: 0.25em;
}

.tabs .tablist li::after {
  content: "";
  display: block;
  height: 1px;
  position: absolute;
  bottom: -1px;
  left: 0;
  right: 0;
}

.tabs.is-loading .tablist li:not(:first-child),
.tabs:not(.is-loading) .tablist li:not(.is-selected) {
  background-color: #f5f5f5;
}

.tabs.is-loading .tablist li:first-child::after,
.tabs:not(.is-loading) .tablist li.is-selected::after {
  background-color: #fff;
}

/*
.tabs:not(.is-loading) .tablist li,
.tabs:not(.is-loading) .tablist li::after {
  transition: background-color 200ms ease-in-out;
}
*/

.tablist > ul p {
  line-height: inherit;
  margin: 0;
}

.tabpanel {
  background-color: #fff;
  padding: 1.25em;
}

.tablist > ul li,
.tabpanel {
  border: 1px solid #dcdcdc;
}

.tablist > ul li {
  border-bottom: 0;
}

.tabs.is-loading .tabpanel + .tabpanel,
.tabs:not(.is-loading) .tabpanel.is-hidden {
  display: none;
}

.tabpanel > :first-child {
  margin-top: 0;
}

/* #content is a signature of the Asciidoctor standalone HTML output */
#content .tabpanel > :last-child,
#content .tabpanel > :last-child > :last-child,
#content .tabpanel > :last-child > :last-child > li:last-child > :last-child {
  margin-bottom: 0;
}

.tablecontainer {
  overflow-x: auto;
}

#content .tablecontainer {
  margin-bottom: 1.25em;
}

#content .tablecontainer > table.tableblock {
  margin-bottom: 0;
}
</style>
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Configuring authentication for Foreman users</h1>
<div class="details">
<span id="revnumber">version 3.13 (unsupported),</span>
<span id="revdate">published Nov 18 2024</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#overview-of-authentication-methods-in-project_authentication">1. Overview of authentication methods in Foreman</a></li>
<li><a href="#Accessing_Server_authentication">2. Accessing Foreman</a>
<ul class="sectlevel2">
<li><a href="#logging-in-to-the-foreman_web_UI_authentication">2.1. Logging in to the Foreman web UI</a></li>
<li><a href="#Importing_the_Katello_Root_CA_Certificate_authentication">2.2. Importing the Katello root CA certificate</a></li>
<li><a href="#Resetting_the_Administrative_User_Password_authentication">2.3. Resetting the administrative user password</a></li>
<li><a href="#setting-a-custom-message-on-the-foreman_web_UI-login-page_authentication">2.4. Setting a custom message on the Foreman web UI login page</a></li>
</ul>
</li>
<li><a href="#configuring-kerberos-sso-with-FreeIPA-in-project_authentication">3. Configuring Kerberos SSO with FreeIPA in Foreman</a>
<ul class="sectlevel2">
<li><a href="#enrolling-projectserver-in-freeipa-domain_authentication">3.1. Enrolling Foreman&#160;server in a FreeIPA domain</a></li>
<li><a href="#configuring-the-freeipa-authentication-source-on-projectserver_authentication">3.2. Configuring the FreeIPA authentication source on Foreman&#160;server</a></li>
<li><a href="#configuring-host-based-access-control-for-FreeIPA-users-logging-in-to-project_authentication">3.3. Configuring host-based access control for FreeIPA users logging in to Foreman</a></li>
<li><a href="#configuring-hammer-cli-to-accept-FreeIPA-credentials_authentication">3.4. Configuring Hammer CLI to accept FreeIPA credentials</a></li>
<li><a href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_Hammer_CLI_authentication">3.5. Logging in to Hammer CLI with FreeIPA credentials</a></li>
<li><a href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-Mozilla-Firefox_authentication">3.6. Logging in to the Foreman web UI with FreeIPA credentials in Mozilla Firefox</a></li>
<li><a href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-a-Chrome-browser_authentication">3.7. Logging in to the Foreman web UI with FreeIPA credentials in Chrome</a></li>
<li><a href="#Configuring-a-cross-forest-trust-between-FreeIPA-and-Active-Directory-for-Foreman_authentication">3.8. Configuring a cross-forest trust between FreeIPA and Active Directory for Foreman</a></li>
</ul>
</li>
<li><a href="#configuring-sso-and-2fa-with-keycloak-wildfly-in-project_keycloak-wildfly">4. Configuring SSO and 2FA with Wildfly-based Keycloak in Foreman</a>
<ul class="sectlevel2">
<li><a href="#prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-wildfly">4.1. Prerequisites for configuring Foreman with Wildfly-based Keycloak authentication</a></li>
<li><a href="#registering-foreman-as-a-client-of-keycloak_keycloak-wildfly">4.2. Registering Foreman as a client of Keycloak</a></li>
<li><a href="#configuring-the-foreman-client-in-keycloak_keycloak-wildfly">4.3. Configuring the Foreman client in Wildfly-based Keycloak</a></li>
<li><a href="#configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-wildfly">4.4. Configuring a Foreman client to provide Foreman web UI authentication with Keycloak</a></li>
<li><a href="#configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-wildfly">4.5. Configuring a Foreman client to provide Hammer CLI authentication with Keycloak</a></li>
<li><a href="#configuring-foreman-with-keycloak-for-totp-authentication_keycloak-wildfly">4.6. Configuring Foreman with Keycloak for TOTP authentication</a></li>
<li><a href="#configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-wildfly">4.7. Configuring Keycloak settings for authentication with PIV cards</a></li>
<li><a href="#configuring-group-mapping-for-keycloak-authentication_keycloak-wildfly">4.8. Optional: Configuring external group mapping for Keycloak authentication</a></li>
<li><a href="#logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-wildfly">4.9. Logging in to Foreman configured with Keycloak as an authentication source</a></li>
</ul>
</li>
<li><a href="#configuring-sso-and-2fa-with-keycloak-in-project_keycloak-quarkus">5. Configuring SSO and 2FA with Quarkus-based Keycloak in Foreman</a>
<ul class="sectlevel2">
<li><a href="#prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-quarkus">5.1. Prerequisites for configuring Foreman with Quarkus-based Keycloak authentication</a></li>
<li><a href="#registering-foreman-as-a-client-of-keycloak_keycloak-quarkus">5.2. Registering Foreman as a client of Keycloak</a></li>
<li><a href="#configuring-the-foreman-client-in-keycloak_keycloak-quarkus">5.3. Configuring the Foreman client in Quarkus-based Keycloak</a></li>
<li><a href="#configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-quarkus">5.4. Configuring a Foreman client to provide Foreman web UI authentication with Keycloak</a></li>
<li><a href="#configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-quarkus">5.5. Configuring a Foreman client to provide Hammer CLI authentication with Keycloak</a></li>
<li><a href="#configuring-foreman-with-keycloak-for-totp-authentication_keycloak-quarkus">5.6. Configuring Foreman with Keycloak for TOTP authentication</a></li>
<li><a href="#configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-quarkus">5.7. Configuring Keycloak settings for authentication with PIV cards</a></li>
<li><a href="#configuring-group-mapping-for-keycloak-authentication_keycloak-quarkus">5.8. Optional: Configuring external group mapping for Keycloak authentication</a></li>
<li><a href="#logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-quarkus">5.9. Logging in to Foreman configured with Keycloak as an authentication source</a></li>
</ul>
</li>
<li><a href="#configuring-kerberos-sso-for-active-directory-users-in-project_authentication">6. Configuring Kerberos SSO for Active Directory users in Foreman</a>
<ul class="sectlevel2">
<li><a href="#configuring-the-active-directory-authentication-source-on-projectserver_authentication">6.1. Configuring the Active Directory authentication source on Foreman&#160;server</a></li>
</ul>
</li>
<li><a href="#configuring-an-ldap-server-as-an-external-identity-provider-for-project_authentication">7. Configuring an LDAP server as an external identity provider for Foreman</a>
<ul class="sectlevel2">
<li><a href="#Configuring_TLS_for_Secure_LDAP_authentication">7.1. Configuring TLS for secure LDAP</a></li>
<li><a href="#Configuring_Project_to_Use_LDAP_authentication">7.2. Configuring Foreman to use LDAP</a></li>
<li><a href="#Example_Settings_for_LDAP_Connections_authentication">7.3. Example settings for LDAP connections</a></li>
<li><a href="#Example_LDAP_Filters_authentication">7.4. Example LDAP filters</a></li>
</ul>
</li>
<li><a href="#important-user-and-group-account-information-for-active-directory-accounts_authentication">8. Important user and group account information for Active Directory accounts</a></li>
<li><a href="#Configuring_External_User_Groups_authentication">9. Configuring external user groups</a></li>
<li><a href="#Refreshing_External_User_Groups_for_LDAP_authentication">10. Refreshing external user groups for LDAP</a></li>
<li><a href="#Refreshing_External_User_Groups_for_FreeIPA_or_AD_authentication">11. Refreshing external user groups for FreeIPA or AD</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="overview-of-authentication-methods-in-project_authentication"><a class="anchor" href="#overview-of-authentication-methods-in-project_authentication"></a>1. Overview of authentication methods in Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman includes native support for authentication with a username and password.
If you require additional methods of authentication, configure your Foreman&#160;server to use an external authentication source.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. External authentication sources supported by Foreman and the authentication features they provide</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Username and password</th>
<th class="tableblock halign-left valign-top">Single sign-on (SSO)</th>
<th class="tableblock halign-left valign-top">One-time password (OTP)</th>
<th class="tableblock halign-left valign-top">Time-based one-time password (TOTP)</th>
<th class="tableblock halign-left valign-top">PIV cards</th>
<th class="tableblock halign-left valign-top">Additional details</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Active&#160;Directory (direct integration)</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#configuring-kerberos-sso-for-active-directory-users-in-project_authentication">Configuring Kerberos SSO for Active Directory users in Foreman</a></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">FreeIPA</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes (Linux and Active Directory users)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes (Linux users only)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#configuring-kerberos-sso-with-FreeIPA-in-project_authentication">Configuring Kerberos SSO with FreeIPA in Foreman</a></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Quarkus-based Keycloak</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#configuring-sso-and-2fa-with-keycloak-wildfly-in-project_keycloak-wildfly">Configuring SSO and 2FA with Wildfly-based Keycloak in Foreman</a></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Wildfly-based Keycloak</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#configuring-sso-and-2fa-with-keycloak-wildfly-in-project_keycloak-wildfly">Configuring SSO and 2FA with Wildfly-based Keycloak in Foreman</a></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">LDAP</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#configuring-an-ldap-server-as-an-external-identity-provider-for-project_authentication">Configuring an LDAP server as an external identity provider for Foreman</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="Accessing_Server_authentication"><a class="anchor" href="#Accessing_Server_authentication"></a>2. Accessing Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After Foreman has been installed and configured, use a browser to log in to the Foreman web UI interface.
From the Foreman web UI, you can manage and monitor your Foreman infrastructure.</p>
</div>
<div class="sect2">
<h3 id="logging-in-to-the-foreman_web_UI_authentication"><a class="anchor" href="#logging-in-to-the-foreman_web_UI_authentication"></a>2.1. Logging in to the Foreman web UI</h3>
<div class="paragraph">
<p>Use the web user interface to log in to Foreman for further configuration.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the Katello root CA certificate is installed in your browser.
For more information, see <a href="#Importing_the_Katello_Root_CA_Certificate_authentication">Importing the Katello root CA certificate</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Access Foreman&#160;server using a web browser pointed to the fully qualified domain name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://<em>foreman.example.com</em>/</pre>
</div>
</div>
</li>
<li>
<p>Enter the user name and password created during the configuration process.
If a user was not created during the configuration process, the default user name is <em>admin</em>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>If you have problems logging in, you can reset the password.
For more information, see <a href="#Resetting_the_Administrative_User_Password_authentication">Resetting the administrative user password</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Importing_the_Katello_Root_CA_Certificate_authentication"><a class="anchor" href="#Importing_the_Katello_Root_CA_Certificate_authentication"></a>2.2. Importing the Katello root CA certificate</h3>
<div class="paragraph">
<p>The first time you log in to Foreman, you might see a warning informing you that you are using the default self-signed certificate and you might not be able to connect this browser to Foreman until the root CA certificate is imported in the browser.
Use the following procedure to locate the root CA certificate on Foreman and to import it into your browser.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see <a href="#CLI_Importing_the_Katello_Root_CA_Certificate_authentication">CLI Procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your Foreman is installed and configured.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify the fully qualified domain name of your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hostname -f</pre>
</div>
</div>
</li>
<li>
<p>Access the <code>pub</code> directory on your Foreman&#160;server using a web browser pointed to the fully qualified domain name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://<em>foreman.example.com</em>/pub</pre>
</div>
</div>
</li>
<li>
<p>When you access Foreman for the first time, an untrusted connection warning displays in your web browser.
Accept the self-signed certificate and add the Foreman URL as a security exception to override the settings.
This procedure might differ depending on the browser being used.
Ensure that the Foreman URL is valid before you accept the security exception.</p>
</li>
<li>
<p>Select <code>katello-server-ca.crt</code>.</p>
</li>
<li>
<p>Import the certificate into your browser as a certificate authority and trust it to identify websites.</p>
</li>
</ol>
</div>
<div id="CLI_Importing_the_Katello_Root_CA_Certificate_authentication" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>From the Foreman CLI, copy the <code>katello-server-ca.crt</code> file to the machine you use to access the Foreman web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /var/www/html/pub/katello-server-ca.crt <em>username@hostname:remotefile</em></pre>
</div>
</div>
</li>
<li>
<p>In the browser, import the <code>katello-server-ca.crt</code> certificate as a certificate authority and trust it to identify websites.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Resetting_the_Administrative_User_Password_authentication"><a class="anchor" href="#Resetting_the_Administrative_User_Password_authentication"></a>2.3. Resetting the administrative user password</h3>
<div class="paragraph">
<p>Use the following procedures to reset the administrative password to randomly generated characters or to set a new administrative password.</p>
</div>
<div class="olist arabic">
<div class="title">To reset the administrative user password</div>
<ol class="arabic">
<li>
<p>Log in to the base operating system where Foreman&#160;server is installed.</p>
</li>
<li>
<p>Enter the following command to reset the password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake permissions:reset
Reset to user: admin, password: qwJxBptxb7Gfcjj5</pre>
</div>
</div>
</li>
<li>
<p>Use this password to reset the password in the Foreman web UI.</p>
</li>
<li>
<p>Edit the <code>~/.hammer/cli.modules.d/foreman.yml</code> file on Foreman&#160;server to add the new password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi ~/.hammer/cli.modules.d/foreman.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Unless you update the <code>~/.hammer/cli.modules.d/foreman.yml</code> file, you cannot use the new password with Hammer CLI.</p>
</div>
<div class="olist arabic">
<div class="title">To set a new administrative user password</div>
<ol class="arabic">
<li>
<p>Log in to the base operating system where Foreman&#160;server is installed.</p>
</li>
<li>
<p>To set the password, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake permissions:reset password=<em>new_password</em></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>~/.hammer/cli.modules.d/foreman.yml</code> file on Foreman&#160;server to add the new password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi ~/.hammer/cli.modules.d/foreman.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Unless you update the <code>~/.hammer/cli.modules.d/foreman.yml</code> file, you cannot use the new password with Hammer CLI.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-a-custom-message-on-the-foreman_web_UI-login-page_authentication"><a class="anchor" href="#setting-a-custom-message-on-the-foreman_web_UI-login-page_authentication"></a>2.4. Setting a custom message on the Foreman web UI login page</h3>
<div class="paragraph">
<p>You can change the default text on the login page to a custom message you want your users to see every time they access the page.
For example, your custom message might be a warning required by your company.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>General</strong> tab.</p>
</li>
<li>
<p>Enter your custom message in the <strong>Login page footer text</strong> field.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Log out of the Foreman web UI and verify that the custom message is now displayed on the login page.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-kerberos-sso-with-FreeIPA-in-project_authentication"><a class="anchor" href="#configuring-kerberos-sso-with-FreeIPA-in-project_authentication"></a>3. Configuring Kerberos SSO with FreeIPA in Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FreeIPA is an open-source identity management solution that provides centralized authentication, authorization, and account management services.
With Foreman, you can integrate Foreman&#160;server with your existing FreeIPA server to enable FreeIPA users to authenticate to Foreman.</p>
</div>
<div class="paragraph">
<p>With your FreeIPA server configured as an external identity provider, users defined in FreeIPA can log in to Foreman with their FreeIPA credentials.
If cross-forest trust is configured between FreeIPA and Active&#160;Directory, Active&#160;Directory users can also log in to Foreman.</p>
</div>
<div class="paragraph">
<p>FreeIPA users can log in using the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Username and password</p>
</li>
<li>
<p>Kerberos single sign-on</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When cross-forest trust is configured between FreeIPA and Active&#160;Directory, Active&#160;Directory users can log in to Foreman with their user principal name (UPN) and password.</p>
</div>
<div class="paragraph">
<p>For information about FreeIPA, including its cross-forest trust functionality, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/planning_identity_management/index">Red&#160;Hat Enterprise Linux&#160;8 <em>Planning Identity Management</em></a> and <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/installing_identity_management/index">Red&#160;Hat Enterprise Linux&#160;8 <em>Installing Identity Management</em></a>.</p>
</div>
<div class="sect2">
<h3 id="enrolling-projectserver-in-freeipa-domain_authentication"><a class="anchor" href="#enrolling-projectserver-in-freeipa-domain_authentication"></a>3.1. Enrolling Foreman&#160;server in a FreeIPA domain</h3>
<div class="paragraph">
<p>Create a host entry for your Foreman&#160;server system in the FreeIPA LDAP and configure the system to be a client in your FreeIPA domain.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing FreeIPA server</p>
</li>
<li>
<p>FreeIPA user account with privileges to enroll new FreeIPA hosts</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the FreeIPA server:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a host entry for the Foreman&#160;server system.</p>
<div class="paragraph">
<p>For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/configuring_and_managing_identity_management/index">Red&#160;Hat Enterprise Linux&#160;8 Configuring and managing Identity Management</a> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/managing_idm_users_groups_hosts_and_access_control_rules">Red&#160;Hat Enterprise Linux&#160;9 Managing IdM users, groups, hosts, and access control rules</a>.</p>
</div>
</li>
<li>
<p>Create an entry for the HTTP service for Foreman&#160;server.
This enables access to the keytab file by creating a service principal for your Foreman&#160;server.</p>
<div class="paragraph">
<p>For more information on creating a service entry in FreeIPA, see
<a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html-single/managing_idm_users_groups_hosts_and_access_control_rules/index">Red&#160;Hat Enterprise Linux&#160;8 Managing IdM users, groups, hosts, and access control rules</a> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html-single/managing_idm_users_groups_hosts_and_access_control_rules/index#">Red&#160;Hat Enterprise Linux&#160;9 Managing IdM users, groups, hosts, and access control rules</a>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>On your Foreman&#160;server, configure the system as client in the FreeIPA domain.
This includes ensuring that the system meets the necessary prerequisites, installing the necessary packages, and running the <code>ipa-client-install</code> utility.</p>
<div class="paragraph">
<p>For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux//8/html-single/installing_identity_management/index#assembly_installing-an-idm-client_installing-identity-management">Red&#160;Hat Enterprise Linux&#160;8 Installing Identity Management</a> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux//9/html-single/installing_identity_management/index#assembly_installing-an-idm-client_installing-identity-management">Red&#160;Hat Enterprise Linux&#160;9 Installing Identity Management</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To install packages on your Foreman&#160;server, use the <code>foreman-installer</code> utility.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>On your Foreman&#160;server, check that you are able to resolve a user defined on the FreeIPA server.
For example, to check the <code>admin</code> user that FreeIPA creates by default:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ id admin</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 1. Enrolling a Foreman&#160;server system as a FreeIPA client from the command line by using a one-time password</div>
<div class="content">
<div class="paragraph">
<p>On the FreeIPA server, a user named <em>admin</em> who has administrative privileges on the FreeIPA server prepares a host entry for the Foreman&#160;server system:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Authenticate as the FreeIPA <em>admin</em> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit <em>admin</em></pre>
</div>
</div>
</li>
<li>
<p>Optional: Verify that you have authenticated successfully:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># klist</pre>
</div>
</div>
</li>
<li>
<p>Create a host entry from the command line.
Specify that you want to use a random password for the enrollment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa host-add --random <em>foreman-server.example.com</em>
--------------------------------------------------
 Added host "foreman-server.example.com"
 --------------------------------------------------
  Host name: foreman-server.example.com
  Random password: W5YpARl=7M.n
  Password: True
  Keytab: False
  Managed by: ipa-server.example.com</pre>
</div>
</div>
</li>
<li>
<p>Enable access to the keytab file by creating a service principal for your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa service-add HTTP/<em>foreman-server.example.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On the Foreman&#160;server system, a user with Foreman administrative privileges enrolls the system into the FreeIPA domain:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the FreeIPA client packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ipa-client</pre>
</div>
</div>
</li>
<li>
<p>Configure the Foreman&#160;server system a client in FreeIPA by using the random password produced by <code>ipa host-add</code> in a previous step:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install --password 'W5YpARl=7M.n'</pre>
</div>
</div>
</li>
<li>
<p>Verify that you are able to resolve the FreeIPA <code>admin</code> user from your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ id admin</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-freeipa-authentication-source-on-projectserver_authentication"><a class="anchor" href="#configuring-the-freeipa-authentication-source-on-projectserver_authentication"></a>3.2. Configuring the FreeIPA authentication source on Foreman&#160;server</h3>
<div class="paragraph">
<p>Enable FreeIPA users to access Foreman by configuring FreeIPA as an authentication provider on your Foreman&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Foreman&#160;server running on a system that is enrolled in the FreeIPA domain.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable access to the Foreman web UI only:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-ipa-authentication=true</pre>
</div>
</div>
</li>
<li>
<p>To enable access to the Foreman web UI and the Foreman API, including Hammer CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-ipa-authentication-api=true \
--foreman-ipa-authentication=true</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Enabling access to both the Foreman web UI and the Foreman API poses a security risk.
After the FreeIPA user enters <code>kinit</code> to receive a Kerberos ticket-granting ticket (TGT), an attacker might obtain an API session.
The attack is possible even if the user did not previously enter the Foreman login credentials anywhere, for example in the browser.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>To disable external authentication with FreeIPA, reset the options.
For example, to disable access to the Foreman API and Hammer CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --reset-foreman-ipa-authentication-api</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Log in to Foreman web UI by entering the credentials of a user defined in FreeIPA.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-host-based-access-control-for-FreeIPA-users-logging-in-to-project_authentication"><a class="anchor" href="#configuring-host-based-access-control-for-FreeIPA-users-logging-in-to-project_authentication"></a>3.3. Configuring host-based access control for FreeIPA users logging in to Foreman</h3>
<div class="paragraph">
<p>You can use host-based access control (HBAC) rules to manage access control within your FreeIPA domain.
In FreeIPA, HBAC rules define which users can access which hosts and which services can be used to gain access.</p>
</div>
<div class="paragraph">
<p>For example, you can configure HBAC on the FreeIPA server to limit access to Foreman&#160;server only to selected users or user groups.
By configuring a HBAC rule in the FreeIPA domain, you can ensure Foreman does not create database entries for users who should not have access.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>FreeIPA user account with privileges to configure HBAC rules</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the FreeIPA server, configure HBAC control.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/managing_idm_users_groups_hosts_and_access_control_rules/configuring-host-based-access-control-rules_managing-users-groups-hosts"><em>Red&#160;Hat Enterprise Linux&#160;9 Managing IdM users, groups, hosts, and access control rules</em></a> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/managing_idm_users_groups_hosts_and_access_control_rules/configuring-host-based-access-control-rules_managing-users-groups-hosts"><em>Red&#160;Hat Enterprise Linux&#160;8 Managing IdM users, groups, hosts, and access control rules</em></a>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a HBAC service for Foreman&#160;server.</p>
</li>
<li>
<p>Create a new HBAC rule to define the required access control.
Add the following FreeIPA entities to the HBAC rule:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>The HBAC service for Foreman&#160;server</p>
</li>
<li>
<p>The Foreman&#160;server host</p>
</li>
<li>
<p>The users or user groups to whom you want to grant access</p>
</li>
</ol>
</div>
</li>
<li>
<p>Make sure the default FreeIPA <code>allow_all</code> rule is disabled.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On your Foreman&#160;server, load the host-based access control rules from FreeIPA:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-pam-service=foreman-prod</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Log in to the Foreman web UI as a user defined in FreeIPA.</p>
<div class="ulist">
<ul>
<li>
<p>If the user is included in the HBAC rule, Foreman web UI will grant access.</p>
</li>
<li>
<p>If the user is not included in the HBAC rule, Foreman web UI will not grant access.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the <code>allow_all</code> rule and configuring HBAC in FreeIPA, see <a href="https://freeipa.readthedocs.io/en/latest/workshop/4-hbac.html">Host-based access control (HBAC)</a> in FreeIPA documentation.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 2. Configuring host-based access control to allow access to Foreman only for selected FreeIPA users by using the command line</div>
<div class="content">
<div class="paragraph">
<p>On the FreeIPA server, a user with administrative privileges configures a HBAC rule to allow selected users access to Foreman&#160;server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Authenticate as the user with privileges required to configure HBAC rules:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kinit <em>admin</em></pre>
</div>
</div>
</li>
<li>
<p>Optional: Verify that you have authenticated successfully:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ klist</pre>
</div>
</div>
</li>
<li>
<p>Create a new HBAC service named <code>foreman-prod</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacsvc-add foreman-prod</pre>
</div>
</div>
</li>
<li>
<p>Create a new HBAC rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacrule-add <em>allow-foreman-prod</em></pre>
</div>
</div>
</li>
<li>
<p>Add the following FreeIPA entities to the HBAC rule:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The <code>foreman-prod</code> HBAC service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacrule-add-service <em>allow-foreman-prod</em> --hbacsvcs=foreman-prod</pre>
</div>
</div>
</li>
<li>
<p>The Foreman&#160;server host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacrule-add-host <em>allow-foreman-prod</em> --hosts=<em>foreman.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>The users or user groups to whom you want to grant access:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacrule-add-user <em>allow-foreman-prod</em> --user=<em>ipa-user</em></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Optional: Verify the status of the rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacrule-find <em>foreman-prod</em>
$ ipa hbactest --user=<em>ipa-user</em> --host=<em>foreman.example.com</em> --service=foreman-prod</pre>
</div>
</div>
</li>
<li>
<p>Disable the default <code>allow_all</code> rule:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ipa hbacrule-disable allow_all</pre>
</div>
</div>
<div class="paragraph">
<p>On Foreman&#160;server, a Foreman administrator re-runs foreman-installer to load the host-based access control rules from FreeIPA:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-pam-service=foreman-prod</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-hammer-cli-to-accept-FreeIPA-credentials_authentication"><a class="anchor" href="#configuring-hammer-cli-to-accept-FreeIPA-credentials_authentication"></a>3.4. Configuring Hammer CLI to accept FreeIPA credentials</h3>
<div class="paragraph">
<p>Configure the Foreman Hammer CLI tool to use FreeIPA to authenticate users.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have enabled FreeIPA access to the Foreman API.
For more information, see <a href="#configuring-the-freeipa-authentication-source-on-projectserver_authentication">Configuring the FreeIPA authentication source on Foreman&#160;server</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Open the <code>~/.hammer/cli.modules.d/foreman.yml</code> file on your Foreman&#160;server and update the list of <code>foreman</code> parameters:</p>
<div class="ulist">
<ul>
<li>
<p>To enforce session usage, enable <code>:use_sessions:</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :use_sessions: true</pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, you will need to initiate an authentication session manually with <code>hammer auth login negotiate</code>.</p>
</div>
</li>
<li>
<p>Alternatively, to enforce session usage and also negotiate authentication by default:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :default_auth_type: 'Negotiate_Auth'
  :use_sessions: true</pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, Hammer will negotiate authentication automatically when you enter the first <code>hammer</code> command.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Using_FreeIPA_credentials_to_log_in_to_the_foreman_Hammer_CLI_authentication"><a class="anchor" href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_Hammer_CLI_authentication"></a>3.5. Logging in to Hammer CLI with FreeIPA credentials</h3>
<div class="paragraph">
<p>Authenticate to the Foreman Hammer CLI with your FreeIPA username and password.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have configured Hammer CLI to accept FreeIPA credentials.
For more information, see <a href="https://docs.theforeman.org/3.13/Installing_Server/index-katello.html#configuring-hammer-cli-to-accept-FreeIPA-credentials_authentication">Configuring Hammer CLI to accept FreeIPA credentials</a> in <em>Installing Foreman&#160;Server with Katello 4.15 plugin on Enterprise Linux</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Authenticate as a user defined in FreeIPA to obtain a Kerberos ticket-granting ticket (TGT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kinit <em>FreeIPA_user</em></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you enabled access to the Foreman API and the Foreman web UI when you were configuring FreeIPA as the authentication provider for Foreman, an attacker might now obtain an API session after the user receives the Kerberos TGT.
The attack is possible even if the user did not previously enter the Foreman login credentials anywhere, for example in the browser.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If Hammer is not configured to negotiate authentication, initiate an authentication session manually:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer auth login negotiate</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you destroy the active Kerberos ticket, for example with <code>kdestroy</code>, you will still be logged in to Hammer.
To log out, enter <code>hammer auth logout</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Use any <code>hammer</code> command to check that the system does not ask you to authenticate.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host list</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about authenticating with Hammer, see
<code>hammer auth --help</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-Mozilla-Firefox_authentication"><a class="anchor" href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-Mozilla-Firefox_authentication"></a>3.6. Logging in to the Foreman web UI with FreeIPA credentials in Mozilla Firefox</h3>
<div class="paragraph">
<p>You can use Mozilla Firefox to log in to the Foreman web UI with your FreeIPA credentials.</p>
</div>
<div class="paragraph">
<p>Use the latest stable Mozilla Firefox browser.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have FreeIPA authentication configured in your Foreman environment.
For more information, see <a href="https://docs.theforeman.org/3.13/Installing_Server/index-katello.html#configuring-kerberos-sso-with-FreeIPA-in-project_foreman">Installing Foreman&#160;Server with Katello 4.15 plugin on Enterprise Linux</a>.</p>
</li>
<li>
<p>The host on which you are using Mozilla Firefox is a client in the FreeIPA domain.</p>
</li>
<li>
<p>Your Mozilla Firefox is configured for Single Sign-On (SSO).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Obtain the Kerberos ticket granting ticket (TGT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kinit <em>user</em>
Password for user@EXAMPLE.COM:</pre>
</div>
</div>
</li>
<li>
<p>In Mozilla Firefox, go to the URL of your Foreman&#160;server.</p>
</li>
<li>
<p>You are logged in automatically.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Alternatively:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your browser address bar, enter the URL of your Foreman&#160;server.</p>
</li>
<li>
<p>Enter your username and password.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-a-Chrome-browser_authentication"><a class="anchor" href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-a-Chrome-browser_authentication"></a>3.7. Logging in to the Foreman web UI with FreeIPA credentials in Chrome</h3>
<div class="paragraph">
<p>You can use Chrome to log in to the Foreman web UI with your FreeIPA credentials.</p>
</div>
<div class="paragraph">
<p>Use the latest stable Chrome browser.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have FreeIPA authentication configured in your Foreman environment.
For more information, see <a href="https://docs.theforeman.org/3.13/Installing_Server/index-katello.html#configuring-kerberos-sso-with-FreeIPA-in-project_foreman">Installing Foreman&#160;Server with Katello 4.15 plugin on Enterprise Linux</a>.</p>
</li>
<li>
<p>The host on which you are using Chrome is a client in the FreeIPA domain.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable the Chrome browser to use Kerberos authentication:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ google-chrome --auth-server-whitelist="*.<em>example.com</em>" --auth-negotiate-delegate-whitelist="*.<em>example.com</em>"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Instead of allowlisting the whole domain, you can also allowlist a specific Foreman&#160;server.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Obtain the Kerberos ticket-granting ticket (TGT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kinit <em>user</em>
Password for user@EXAMPLE.COM:</pre>
</div>
</div>
</li>
<li>
<p>In Chrome, go to the URL of your Foreman&#160;server.</p>
</li>
<li>
<p>You are logged in automatically.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Alternatively:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your browser address bar, enter the URL of your Foreman&#160;server.</p>
</li>
<li>
<p>Enter your username and password.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring-a-cross-forest-trust-between-FreeIPA-and-Active-Directory-for-Foreman_authentication"><a class="anchor" href="#Configuring-a-cross-forest-trust-between-FreeIPA-and-Active-Directory-for-Foreman_authentication"></a>3.8. Configuring a cross-forest trust between FreeIPA and Active Directory for Foreman</h3>
<div class="paragraph">
<p>When your FreeIPA deployment includes a cross-forest trust with Active Directory (AD), configure host-based access control (HBAC) and the System Security Services Daemon (SSSD) to enable AD users to log in to Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing FreeIPA server with a cross-forest trust with AD established.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html-single/installing_identity_management/index#installing-trust-between-idm-and-ad_installing-identity-management">Red&#160;Hat Enterprise Linux&#160;8 <em>Installing trust between IdM and AD</em></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On your FreeIPA server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable HBAC:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create an external group and add the AD group to it.</p>
</li>
<li>
<p>Add the new external group to a POSIX group.</p>
</li>
<li>
<p>Use the POSIX group in a HBAC rule.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On your FreeIPA server and all replicas in your FreeIPA topology, configure SSSD to transfer additional attributes of AD users:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the AD user attributes to the <em>nss</em> and <em>domain</em> sections in <code>/etc/sssd/sssd.conf</code>.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[domain/EXAMPLE.com]
...
krb5_store_password_if_offline = True
ldap_user_extra_attrs=email:mail, lastname:sn, firstname:givenname

[nss]
user_attributes=+email, +firstname, +lastname

[ifp]
allowed_uids = ipaapi, root
user_attributes=+email, +firstname, +lastname</pre>
</div>
</div>
</li>
<li>
<p>Clear the SSSD cache:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Stop SSSD:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl stop sssd</pre>
</div>
</div>
</li>
<li>
<p>Clear the cache:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sss_cache -E</pre>
</div>
</div>
</li>
<li>
<p>Start SSSD:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start sssd</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Verify the AD attributes value by using the <code>dbus-send</code> command on your Foreman&#160;server and on your FreeIPA server.
Make sure that both outputs match.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dbus-send --print-reply --system --dest=org.freedesktop.sssd.infopipe /org/freedesktop/sssd/infopipe org.freedesktop.sssd.infopipe.GetUserAttr string:ad-user@ad-domain array:string:email,firstname,lastname</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-sso-and-2fa-with-keycloak-wildfly-in-project_keycloak-wildfly"><a class="anchor" href="#configuring-sso-and-2fa-with-keycloak-wildfly-in-project_keycloak-wildfly"></a>4. Configuring SSO and 2FA with Wildfly-based Keycloak in Foreman</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The default Keycloak distribution is now based on Quarkus.</p>
</div>
<div class="paragraph">
<p>Quarkus-based Keycloak replaces Wildfly-based Keycloak in Foreman deployments.
For information about configuring Quarkus-based Keycloak authentication, see <a href="#configuring-sso-and-2fa-with-keycloak-in-project_keycloak-quarkus">Configuring SSO and 2FA with Quarkus-based Keycloak in Foreman</a>.</p>
</div>
<div class="paragraph">
<p>For information about migrating from Wildfly-based Keycloak to Quarkus-based Keycloak, see <a href="https://www.keycloak.org/migration/migrating-to-quarkus">Migrating to Quarkus distribution</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Keycloak is an open-source identity and access management solution that provides authentication features, such as single sign-on functionality, user federation, and centralized authentication management.
With Wildfly-based Keycloak, you can integrate Foreman&#160;server with your existing Keycloak server to delegate user authentication and authorization to Keycloak.</p>
</div>
<div class="paragraph">
<p>Keycloak users can log in using the following login methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User name and password in Foreman web UI and Hammer CLI</p>
</li>
<li>
<p>Time-based one-time password (TOTP)</p>
</li>
<li>
<p>PIV cards</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-wildfly"><a class="anchor" href="#prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-wildfly"></a>4.1. Prerequisites for configuring Foreman with Wildfly-based Keycloak authentication</h3>
<div class="ulist">
<ul>
<li>
<p>A Keycloak account with administrative privileges.</p>
</li>
<li>
<p>A Keycloak server that uses HTTPS instead of HTTP.</p>
</li>
<li>
<p>If the certificates or the CA are self-signed, ensure that they are added to the end-user certificate truststore.</p>
</li>
<li>
<p>A Keycloak realm created for Foreman user accounts, for example <code><em>Foreman_Realm</em></code>.</p>
</li>
<li>
<p>Users imported or added to Keycloak.
For more information about importing or creating users, see the <a href="https://docs.redhat.com/en/documentation/red_hat_single_sign-on/7.6/html/server_administration_guide/assembly-managing-users_server_administration_guide#proc-creating-user_server_administration_guide"><em>Red&#160;Hat Single Sign-On Server Administration Guide</em></a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="registering-foreman-as-a-client-of-keycloak_keycloak-wildfly"><a class="anchor" href="#registering-foreman-as-a-client-of-keycloak_keycloak-wildfly"></a>4.2. Registering Foreman as a client of Keycloak</h3>
<div class="paragraph">
<p>Users defined in Keycloak can authenticate to Foreman by using the Foreman web UI or by using Hammer CLI.
Each authentication method requires you to register a separate Foreman client to Keycloak.
If you want users to authenticate by using both Foreman web UI and Hammer CLI, you must register two different Foreman clients to Keycloak.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On your Foreman&#160;server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the packages required for registering a Keycloak client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install mod_auth_openidc keycloak-httpd-client-install python3-lxml</pre>
</div>
</div>
</li>
<li>
<p>Choose the authentication method you want Keycloak users to use when authenticating to Foreman:</p>
<div class="ulist">
<ul>
<li>
<p>If you want users to authenticate by using the Foreman web UI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a client for Foreman.
Use <code>foreman-openidc</code> as the application name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name foreman-openidc \
--keycloak-server-url "https://<em>keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
</li>
<li>
<p>Configure Foreman to use Keycloak as an authentication source for Foreman web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "foreman-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you want users to authenticate by using the Hammer CLI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a client for Foreman.
Use <code>hammer-openidc</code> as the application name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name hammer-openidc \
--keycloak-server-url "https://<em>keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
</li>
<li>
<p>Configure Foreman to use Keycloak as an authentication source for Hammer CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "hammer-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
<li>
<p>Reset Keycloak support to the default value to ensure that users are not authenticated also in Foreman web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --reset-foreman-keycloak</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Restart the <code>httpd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To disable Keycloak authentication in Foreman, reset Keycloak support to the default value by using <code>foreman-installer --reset-foreman-keycloak</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-foreman-client-in-keycloak_keycloak-wildfly"><a class="anchor" href="#configuring-the-foreman-client-in-keycloak_keycloak-wildfly"></a>4.3. Configuring the Foreman client in Wildfly-based Keycloak</h3>
<div class="paragraph">
<p>Configure the Foreman client in Wildfly-based Keycloak with valid redirect URIs and mappers.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Keycloak web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the realm created for Foreman users.
Navigate to <strong>Clients</strong> and click the Foreman client.</p>
</li>
<li>
<p>Configure access type:</p>
<div class="ulist">
<ul>
<li>
<p>If you are configuring a client that will provide Foreman web UI authentication, select <strong>confidential</strong> from the <strong>Access Type</strong> list.</p>
</li>
<li>
<p>If you are configuring a client that will provide Hammer CLI authentication, select <strong>public</strong> from the <strong>Access Type</strong> list.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure <strong>Valid redirect URI</strong> addresses:</p>
<div class="ulist">
<ul>
<li>
<p>If you are configuring a client that will provide Foreman web UI authentication:</p>
<div class="ulist">
<ul>
<li>
<p>You will see a pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin/redirect_uri</code>.
Do not change or remove this URI.</p>
</li>
<li>
<p>Add another URI below the pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>If you are configuring a client that will provide Hammer CLI authentication:</p>
<div class="ulist">
<ul>
<li>
<p>You will see a pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin/redirect_uri</code>.
Do not change or remove this URI.</p>
</li>
<li>
<p>Add another URI below the pre-defined URI: <code>urn:ietf:wg:oauth:2.0:oob</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>On the <strong>Mappers</strong> tab, click <strong>Create</strong> to add an audience mapper.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the <strong>Mapper Type</strong> list, select <strong>Audience</strong>.</p>
</li>
<li>
<p>From the <strong>Included Client Audience</strong> list, select the Foreman client.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>On the <strong>Mappers</strong> tab, click <strong>Create</strong> to add a group mapper so that you can specify authorization in Foreman based on group membership.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the <strong>Mapper Type</strong> list, select <strong>Group Membership</strong>.</p>
</li>
<li>
<p>In the <strong>Token Claim Name</strong> field, enter <strong>groups</strong>.</p>
</li>
<li>
<p>Set the <strong>Full group path</strong> setting to <code>OFF</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about configuring Wildfly-based Keycloak clients, see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.6/html-single/server_administration_guide/index">Red&#160;Hat Single Sign-On <em>Server Administration Guide</em></a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-wildfly"><a class="anchor" href="#configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-wildfly"></a>4.4. Configuring a Foreman client to provide Foreman web UI authentication with Keycloak</h3>
<div class="paragraph">
<p>If you are configuring a client that will provide Foreman web UI authentication to your Foreman deployment, delegate authentication to the Keycloak server and add Keycloak as an external authentication source in Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <strong>Access Type</strong> setting in the Foreman client in the Wildfly-based Keycloak web UI is set to <strong>confidential</strong>.
For more information, see <a href="#configuring-the-foreman-client-in-keycloak_keycloak-wildfly">Configuring the Foreman client in Wildfly-based Keycloak</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Foreman web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Authentication</strong> tab, configure the following settings:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Authorize login delegation</strong>: Set to <code>Yes</code>.</p>
</li>
<li>
<p><strong>Authorize login delegation auth source user autocreate</strong>: Set to <code>External</code>.</p>
</li>
<li>
<p><strong>Login delegation logout URL</strong>: Set to <code>https://<em>foreman.example.com</em>/users/extlogout</code>.</p>
</li>
<li>
<p><strong>OIDC Algorithm</strong>: For example, set to <code>RS256</code>.</p>
</li>
<li>
<p><strong>OIDC Audience</strong>: Set to the client ID for Keycloak.</p>
</li>
<li>
<p><strong>OIDC Issuer</strong>:
Set to <code>https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_Realm</em></code>.</p>
</li>
<li>
<p><strong>OIDC JWKs URL</strong>:
Set to <code>https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_Realm</em>/protocol/openid-connect/certs</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Authentication Sources</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the <strong>External</strong> menu, select <strong>Edit</strong>.</p>
</li>
<li>
<p>On the <strong>Locations</strong> tab, add the locations that you want to be able to use the Keycloak authentication source.</p>
</li>
<li>
<p>On the <strong>Organizations</strong> tab, add the organizations that you want to be able to use the Keycloak authentication source.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-wildfly"><a class="anchor" href="#configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-wildfly"></a>4.5. Configuring a Foreman client to provide Hammer CLI authentication with Keycloak</h3>
<div class="paragraph">
<p>If you are configuring a client that will provide Hammer CLI authentication to your Foreman deployment, delegate authentication to the Keycloak server and add Keycloak as an external authentication source in Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <strong>Access Type</strong> setting in the Foreman client in the Wildfly-based Keycloak web UI is set to <strong>public</strong>.
For more information, see <a href="#configuring-the-foreman-client-in-keycloak_keycloak-wildfly">Configuring the Foreman client in Wildfly-based Keycloak</a>.</p>
</li>
<li>
<p>Obtain the values to configure Foreman settings from the following URL: <code>https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_Realm</em>/.well-known/openid-configuration</code>.
Replace <em>Foreman_Realm</em> with the name of the Keycloak realm created for your Foreman server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On the Foreman client registered to Keycloak:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the login delegation to <code>true</code> so that users can authenticate using the Open IDC protocol:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name authorize_login_delegation --value true</pre>
</div>
</div>
</li>
<li>
<p>Set the login delegation logout URL:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name login_delegation_logout_url \
--value https://<em>foreman.example.com</em>/users/extlogout</pre>
</div>
</div>
</li>
<li>
<p>Set the algorithm for encoding:
For example, to use the <code>RS256</code> algorithm:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_algorithm --value 'RS256'</pre>
</div>
</div>
</li>
<li>
<p>Add the value for the Hammer client in the Open IDC audience:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you register several Keycloak clients to Foreman, ensure that you append all audiences in the array.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-foreman-openidc', '<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set the value for the Open IDC issuer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_issuer \
--value "https://<em>keycloak.example.com</em>/auth/realms/<em>KEYCLOAK_REALM</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set the value for Open IDC Java Web Token (JWT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_jwks_url \
--value "https://<em>keycloak.example.com</em>/auth/realms/<em>KEYCLOAK_REALM</em>/protocol/openid-connect/certs"</pre>
</div>
</div>
</li>
<li>
<p>Retrieve the ID of the Keycloak authentication source:</p>
<div class="listingblock">
<div class="content">
<pre># hammer auth-source external list</pre>
</div>
</div>
</li>
<li>
<p>Set the location and organization:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth-source external update \
--id <em>My_Authentication_Source_ID</em> \
--location-ids <em>My_Location_ID</em> \
--organization-ids <em>My_Organization_ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-foreman-with-keycloak-for-totp-authentication_keycloak-wildfly"><a class="anchor" href="#configuring-foreman-with-keycloak-for-totp-authentication_keycloak-wildfly"></a>4.6. Configuring Foreman with Keycloak for TOTP authentication</h3>
<div class="paragraph">
<p>If you want users to authenticate with time-based one-time passwords (TOTP), configure an OTP policy for the Foreman realm in Keycloak.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Keycloak web UI, navigate to the Foreman realm.</p>
</li>
<li>
<p>Navigate to <strong>Authentication</strong>.</p>
</li>
<li>
<p>On the <strong>Policies</strong> tab, click the <strong>OTP Policy</strong> tab.
Ensure that the <strong>Supported Applications</strong> field includes FreeOTP or Google Authenticator.</p>
</li>
<li>
<p>Configure the OTP settings to suit your requirements.</p>
</li>
<li>
<p>On <strong>Required Actions</strong> tab, enable the <strong>Set as default action</strong> setting for the <strong>Configure OTP</strong> action.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/24.0/html/server_administration_guide/configuring-authentication_server_administration_guide#configuring-authentication_server_administration_guide">Red&#160;Hat Single Sign-On Server Administration Guide</a> or <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.6/html-single/server_administration_guide/index#configuring-authentication_server_administration_guide">Red&#160;Hat build of Keycloak Server Administration Guide</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-wildfly"><a class="anchor" href="#configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-wildfly"></a>4.7. Configuring Keycloak settings for authentication with PIV cards</h3>
<div class="paragraph">
<p>If you want users to authenticate with PIV cards, configure Keycloak for authentication with PIV cards and configure the operating system for PIV cards on each user system.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Keycloak web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <strong>Authentication</strong> tab.</p>
</li>
<li>
<p>From the <strong>Flows</strong> list, select <strong>Browser</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Copy</strong> to copy this flow.</p>
</li>
<li>
<p>In the <strong>Copy Authentication Flow</strong> window, enter a new name for the flow and click <strong>OK</strong>.</p>
</li>
<li>
<p>In the copied flow, delete the <strong>Username Password Form</strong> and <strong>OTP Form</strong> entries.</p>
</li>
<li>
<p>Click <strong>Add execution</strong>.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>X509/Validate Username Form</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the <strong>X509/Validate Username Form</strong> row, select <strong>ALTERNATIVE</strong>.
Click <strong>Actions</strong> &gt; <strong>Config</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Alias</strong> field, enter a name for this configuration.</p>
</li>
<li>
<p>From the <strong>User Identity Source</strong> list, select <strong>Subject’s Common Name</strong>,</p>
</li>
<li>
<p>From the <strong>User mapping method</strong> list, select <strong>Username or Email</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to <strong>Authentication</strong> &gt; <strong>Bindings</strong>.</p>
</li>
<li>
<p>From the <strong>Browser Flow</strong> list, select the created flow.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On each system from which you want users to log in to with PIV cards:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>opensc</code> package:</p>
<div class="ulist">
<ul>
<li>
<p>On Debian or Ubuntu:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># apt install opensc</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 8+:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install opensc</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 7:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install opensc</pre>
</div>
</div>
</li>
<li>
<p>On OpenSUSE and SUSE Linux Enterprise Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># zypper install opensc</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Make sure Mozilla Firefox is installed.</p>
</li>
<li>
<p>In Mozilla Firefox main menu, click <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Privacy and Security</strong> tab, click <strong>Security Devices</strong>.</p>
</li>
<li>
<p>Click <strong>Load</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Load PKCS#11 Device Driver</strong> window, enter <strong>/usr/lib64/pkcs11/opensc-pkcs11.so</strong> in the <strong>Module filename</strong> field.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If the PIV card is connected to system, restart the <code>pcscd</code> service.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-group-mapping-for-keycloak-authentication_keycloak-wildfly"><a class="anchor" href="#configuring-group-mapping-for-keycloak-authentication_keycloak-wildfly"></a>4.8. Optional: Configuring external group mapping for Keycloak authentication</h3>
<div class="paragraph">
<p>To implement the role-based access control (RBAC), create a group in Foreman, assign a role to this group, and then map an Keycloak group to the Foreman group.
As a result, anyone in the given group in Keycloak will log in under the corresponding Foreman group.</p>
</div>
<div class="paragraph">
<p>For example, you can configure users of the Foreman-admin user group defined in Active Directory to authenticate as users with administrator privileges on Foreman.</p>
</div>
<div class="paragraph">
<p>If you do not configure group mapping, every user will receive the <em>Default role</em> permissions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>.</p>
</li>
<li>
<p>Click <strong>Create User Group</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter a name for the user group.
Enter a name that is different from the Active Directory user group name.</p>
</li>
<li>
<p>Do not add any users or user groups to the new group in Foreman web UI.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On the <strong>Roles</strong> tab, select <strong>Administer</strong>.</p>
</li>
<li>
<p>On the <strong>External Groups</strong> tab, click <strong>Add external user group</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter the name of the Active Directory group.</p>
</li>
<li>
<p>From the <strong>Auth Source</strong> drop-down menu, select <strong>EXTERNAL</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-wildfly"><a class="anchor" href="#logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-wildfly"></a>4.9. Logging in to Foreman configured with Keycloak as an authentication source</h3>
<div class="paragraph">
<p>With Keycloak configured as an external authentication source for Foreman, users defined in a Keycloak realm can log in to Foreman&#160;server.
The particular login methods available to users depend on how you configured integration between Keycloak and Foreman.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To authenticate to the Foreman web UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In your browser, go to <code>https://<em>foreman.example.com</em></code> and enter your credentials.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman web UI by using Keycloak TOTP:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your browser, log in to Foreman.
Foreman redirects you to the Keycloak login screen.</p>
</li>
<li>
<p>Enter your username and password, and click <strong>Log In</strong>.</p>
</li>
<li>
<p>On your first login attempt, Keycloak requests you to configure your client by scanning the bar code and entering your PIN.
Once authenticated, your browser redirects you back to Foreman and logs you in.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman CLI with Hammer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that Hammer is configured to enforce session usage in <code>~/.hammer/cli.modules.d/foreman.yml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :use_sessions: true</pre>
</div>
</div>
</li>
<li>
<p>Initiate an authentication session with <code>hammer auth login oauth</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--oidc-token-endpoint 'https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_realm</em>/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-hammer-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman CLI with Hammer by using Keycloak TOTP:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that Hammer is configured to enforce session usage in <code>~/.hammer/cli.modules.d/foreman.yml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :use_sessions: true</pre>
</div>
</div>
</li>
<li>
<p>Initiate an authentication session by using <code>--two-factor</code> with <code>hammer auth login oauth</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--two-factor \
--oidc-token-endpoint 'https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_realm</em>/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-hammer-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
<li>
<p>You will be prompted to enter a success code.
To retrieve the success code, navigate to the URL that the command returns.</p>
</li>
<li>
<p>Enter the success code in CLI.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To log in to the Foreman web UI using the Keycloak PIV cards:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Mozilla Firefox, log in to Foreman and enter your credentials.</p>
</li>
<li>
<p>When prompted, enter the PIN of the PIV card.</p>
</li>
<li>
<p>Choose the certificate for authentication.
Browser verifies this certificate with Keycloak.
Once authenticated, browser redirects you back to Foreman and logs you in.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-sso-and-2fa-with-keycloak-in-project_keycloak-quarkus"><a class="anchor" href="#configuring-sso-and-2fa-with-keycloak-in-project_keycloak-quarkus"></a>5. Configuring SSO and 2FA with Quarkus-based Keycloak in Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus-based Keycloak is an open-source identity and access management solution that provides authentication features, such as single sign-on functionality, user federation, and centralized authentication management.
With Quarkus-based Keycloak, you can integrate Foreman&#160;server with your existing Quarkus-based Keycloak server to delegate user authentication and authorization to Quarkus-based Keycloak.</p>
</div>
<div class="paragraph">
<p>Keycloak users can log in using the following login methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User name and password in Foreman web UI and Hammer CLI</p>
</li>
<li>
<p>Time-based one-time password (TOTP), an implementation of two-factor authentication (2FA)</p>
</li>
<li>
<p>PIV cards</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about Keycloak, see <a href="https://www.keycloak.org/documentation">Keycloak documentation</a>.</p>
</div>
<div class="sect2">
<h3 id="prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-quarkus"><a class="anchor" href="#prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-quarkus"></a>5.1. Prerequisites for configuring Foreman with Quarkus-based Keycloak authentication</h3>
<div class="ulist">
<ul>
<li>
<p>A Keycloak account with administrative privileges.</p>
</li>
<li>
<p>A Keycloak server that uses HTTPS instead of HTTP and has been initialized with the <code>--http-relative-path=/auth</code> context path.
To access a Keycloak server initialized with <code>--http-relative-path=/auth</code> from its web UI, go to <code>https://<em>keycloak.example.com</em>:8443/auth</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To use a different context path, make manual adjustments after the initialisation with <code>/auth</code> or configure the <code><em>foreman-openidc_oidc_keycloak_Foreman_Realm</em>.conf</code> file of the HTTPd service manually.
For more information about configuring a different context path, see the <a href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/24.0/html-single/server_guide/index#reverseproxy-different-context-path-on-reverse-proxy"><em>Red&#160;Hat build of Keycloak Administration Guide</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If the certificates or the CA are self-signed, add them to the end-user certificate truststore.</p>
</li>
<li>
<p>A Keycloak realm created for Foreman user accounts, for example <code><em>Foreman_Realm</em></code>.</p>
</li>
<li>
<p>Users imported or added to Keycloak.
For more information on importing or creating users, see the <a href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/24.0/html/server_administration_guide/user-storage-federation"><em>Red&#160;Hat build of Keycloak Administration Guide</em></a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="registering-foreman-as-a-client-of-keycloak_keycloak-quarkus"><a class="anchor" href="#registering-foreman-as-a-client-of-keycloak_keycloak-quarkus"></a>5.2. Registering Foreman as a client of Keycloak</h3>
<div class="paragraph">
<p>Users defined in Keycloak can authenticate to Foreman by using one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Foreman web UI</p>
</li>
<li>
<p>Hammer CLI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Choose one of these methods to enable in your Foreman deployment.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On your Foreman&#160;server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the packages required for registering a Keycloak client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install mod_auth_openidc keycloak-httpd-client-install python3-lxml</pre>
</div>
</div>
</li>
<li>
<p>Choose the authentication method you want Keycloak users to use when authenticating to Foreman:</p>
<div class="ulist">
<ul>
<li>
<p>If you want users to authenticate by using the Foreman web UI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a client for Foreman.
Use <code>foreman-openidc</code> as the application name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name foreman-openidc \
--keycloak-server-url "https://<em>keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
</li>
<li>
<p>Configure Foreman to use Keycloak as an authentication source for Foreman web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "foreman-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you want users to authenticate by using the Hammer CLI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a client for Foreman.
Use <code>hammer-openidc</code> as the application name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name hammer-openidc \
--keycloak-server-url "https://<em>keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
</li>
<li>
<p>Configure Foreman to use Keycloak as an authentication source for Hammer CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "hammer-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
<li>
<p>Reset Keycloak support to the default value to ensure that users are not authenticated also in Foreman web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --reset-foreman-keycloak</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Restart the <code>httpd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To disable Keycloak authentication in Foreman, reset Keycloak support to the default value by using <code>foreman-installer --reset-foreman-keycloak</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-foreman-client-in-keycloak_keycloak-quarkus"><a class="anchor" href="#configuring-the-foreman-client-in-keycloak_keycloak-quarkus"></a>5.3. Configuring the Foreman client in Quarkus-based Keycloak</h3>
<div class="paragraph">
<p>Configure the Foreman client in Quarkus-based Keycloak with valid redirect URIs and mappers.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Quarkus-based Keycloak web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the realm created for Foreman users.</p>
</li>
<li>
<p>Navigate to <strong>Clients</strong> and click the Foreman client.</p>
</li>
<li>
<p>On the <strong>Settings</strong> tab for the Foreman client, configure the access type and redirect addresses:</p>
<div class="ulist">
<ul>
<li>
<p>If you are configuring a client that will provide Foreman web UI authentication:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enable <strong>Client authentication</strong>.</p>
</li>
<li>
<p>You will see a pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin/redirect_uri</code>.
Do not change or remove this URI.</p>
</li>
<li>
<p>Add another URI below the pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>If you are configuring a client that will provide Hammer CLI authentication:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ensure <strong>Client authentication</strong> is disabled.</p>
</li>
<li>
<p>You will see a pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin/redirect_uri</code>.
Do not change or remove this URI.</p>
</li>
<li>
<p>Add another URI below the pre-defined URI: <code>urn:ietf:wg:oauth:2.0:oob</code></p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>On the <strong>Client Scopes</strong> tab for the Foreman client, locate the client scope dedicated to the Foreman client named <code><em>client-name</em>-dedicated</code>.
Start editing the client scope.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>On the <strong>Mappers</strong> tab for <code><em>client-name</em>-dedicated</code>, add a new mapper by configuration.
Select the <strong>Audience</strong> mapper type.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>From the <strong>Included Client Audience</strong> list, select the Foreman client.</p>
</li>
<li>
<p>Enable <strong>Add to ID token</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Add another mapper by configuration.
Select the <strong>Group Membership</strong> mapper type. This adds a group mapper so that you can specify authorization in Foreman based on group membership.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In the <strong>Token Claim Name</strong> field, enter <strong>groups</strong>.</p>
</li>
<li>
<p>Disable <strong>Full group path</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about configuring Quarkus-based Keycloak clients, see <a href="https://access.redhat.com/documentation/en-us/red_hat_build_of_keycloak/24.0/html-single/server_administration_guide/index#assembly-managing-clients_server_administration_guide">Red&#160;Hat build of Keycloak <em>Server Administration Guide</em></a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-quarkus"><a class="anchor" href="#configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-quarkus"></a>5.4. Configuring a Foreman client to provide Foreman web UI authentication with Keycloak</h3>
<div class="paragraph">
<p>If you are configuring a client that will provide Foreman web UI authentication to your Foreman deployment, delegate authentication to the Keycloak server and add Keycloak as an external authentication source in Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <strong>Client authentication</strong> setting in the Foreman client in the Quarkus-based Keycloak web UI is enabled.
For more information, see <a href="#configuring-the-foreman-client-in-keycloak_keycloak-quarkus">Configuring the Foreman client in Quarkus-based Keycloak</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Foreman web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Authentication</strong> tab, configure the following settings:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Authorize login delegation</strong>: Set to <code>Yes</code>.</p>
</li>
<li>
<p><strong>Authorize login delegation auth source user autocreate</strong>: Set to <code>External</code>.</p>
</li>
<li>
<p><strong>Login delegation logout URL</strong>: Set to <code>https://<em>foreman.example.com</em>/users/extlogout</code>.</p>
</li>
<li>
<p><strong>OIDC Algorithm</strong>: For example, set to <code>RS256</code>.</p>
</li>
<li>
<p><strong>OIDC Audience</strong>: Set to the client ID for Keycloak.</p>
</li>
<li>
<p><strong>OIDC Issuer</strong>:
Set to <code>https://<em>keycloak.example.com</em>:8443/auth/realms/<em>Foreman_Realm</em></code>.</p>
</li>
<li>
<p><strong>OIDC JWKs URL</strong>:
Set to <code>https://<em>keycloak.example.com</em>:8443/auth/realms/<em>Foreman_Realm</em>/protocol/openid-connect/certs</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Authentication Sources</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the <strong>External</strong> menu, select <strong>Edit</strong>.</p>
</li>
<li>
<p>On the <strong>Locations</strong> tab, add the locations that you want to be able to use the Keycloak authentication source.</p>
</li>
<li>
<p>On the <strong>Organizations</strong> tab, add the organizations that you want to be able to use the Keycloak authentication source.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-quarkus"><a class="anchor" href="#configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-quarkus"></a>5.5. Configuring a Foreman client to provide Hammer CLI authentication with Keycloak</h3>
<div class="paragraph">
<p>If you are configuring a client that will provide Hammer CLI authentication to your Foreman deployment, delegate authentication to the Keycloak server and add Keycloak as an external authentication source in Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <strong>Client authentication</strong> setting in the Foreman client in the Quarkus-based Keycloak web UI is disabled.
For more information, see <a href="#configuring-the-foreman-client-in-keycloak_keycloak-quarkus">Configuring the Foreman client in Quarkus-based Keycloak</a>.</p>
</li>
<li>
<p>Obtain the values to configure Foreman settings from the following URL: <code>https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_Realm</em>/.well-known/openid-configuration</code>.
Replace <em>Foreman_Realm</em> with the name of the Keycloak realm created for your Foreman server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On the Foreman client registered to Keycloak:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the login delegation to <code>true</code> so that users can authenticate using the Open IDC protocol:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name authorize_login_delegation --value true</pre>
</div>
</div>
</li>
<li>
<p>Set the login delegation logout URL:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name login_delegation_logout_url \
--value https://<em>foreman.example.com</em>/users/extlogout</pre>
</div>
</div>
</li>
<li>
<p>Set the algorithm for encoding:
For example, to use the <code>RS256</code> algorithm:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_algorithm --value 'RS256'</pre>
</div>
</div>
</li>
<li>
<p>Add the value for the Hammer client in the Open IDC audience:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you register several Keycloak clients to Foreman, ensure that you append all audiences in the array.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-foreman-openidc', '<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set the value for the Open IDC issuer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_issuer \
--value "https://<em>keycloak.example.com</em>/auth/realms/<em>KEYCLOAK_REALM</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set the value for Open IDC Java Web Token (JWT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_jwks_url \
--value "https://<em>keycloak.example.com</em>/auth/realms/<em>KEYCLOAK_REALM</em>/protocol/openid-connect/certs"</pre>
</div>
</div>
</li>
<li>
<p>Retrieve the ID of the Keycloak authentication source:</p>
<div class="listingblock">
<div class="content">
<pre># hammer auth-source external list</pre>
</div>
</div>
</li>
<li>
<p>Set the location and organization:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth-source external update \
--id <em>My_Authentication_Source_ID</em> \
--location-ids <em>My_Location_ID</em> \
--organization-ids <em>My_Organization_ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-foreman-with-keycloak-for-totp-authentication_keycloak-quarkus"><a class="anchor" href="#configuring-foreman-with-keycloak-for-totp-authentication_keycloak-quarkus"></a>5.6. Configuring Foreman with Keycloak for TOTP authentication</h3>
<div class="paragraph">
<p>If you want users to authenticate with time-based one-time passwords (TOTP), configure an OTP policy for the Foreman realm in Keycloak.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Keycloak web UI, navigate to the Foreman realm.</p>
</li>
<li>
<p>Navigate to <strong>Authentication</strong>.</p>
</li>
<li>
<p>On the <strong>Policies</strong> tab, click the <strong>OTP Policy</strong> tab.
Ensure that the <strong>Supported Applications</strong> field includes FreeOTP or Google Authenticator.</p>
</li>
<li>
<p>Configure the OTP settings to suit your requirements.</p>
</li>
<li>
<p>On <strong>Required Actions</strong> tab, enable the <strong>Set as default action</strong> setting for the <strong>Configure OTP</strong> action.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/24.0/html/server_administration_guide/configuring-authentication_server_administration_guide#configuring-authentication_server_administration_guide">Red&#160;Hat Single Sign-On Server Administration Guide</a> or <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.6/html-single/server_administration_guide/index#configuring-authentication_server_administration_guide">Red&#160;Hat build of Keycloak Server Administration Guide</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-quarkus"><a class="anchor" href="#configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-quarkus"></a>5.7. Configuring Keycloak settings for authentication with PIV cards</h3>
<div class="paragraph">
<p>If you want users to authenticate with PIV cards, configure Keycloak for authentication with PIV cards and configure the operating system for PIV cards on each user system.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Keycloak web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <strong>Authentication</strong> tab.</p>
</li>
<li>
<p>From the <strong>Flows</strong> list, select <strong>Browser</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Copy</strong> to copy this flow.</p>
</li>
<li>
<p>In the <strong>Copy Authentication Flow</strong> window, enter a new name for the flow and click <strong>OK</strong>.</p>
</li>
<li>
<p>In the copied flow, delete the <strong>Username Password Form</strong> and <strong>OTP Form</strong> entries.</p>
</li>
<li>
<p>Click <strong>Add execution</strong>.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>X509/Validate Username Form</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the <strong>X509/Validate Username Form</strong> row, select <strong>ALTERNATIVE</strong>.
Click <strong>Actions</strong> &gt; <strong>Config</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Alias</strong> field, enter a name for this configuration.</p>
</li>
<li>
<p>From the <strong>User Identity Source</strong> list, select <strong>Subject’s Common Name</strong>,</p>
</li>
<li>
<p>From the <strong>User mapping method</strong> list, select <strong>Username or Email</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to <strong>Authentication</strong> &gt; <strong>Bindings</strong>.</p>
</li>
<li>
<p>From the <strong>Browser Flow</strong> list, select the created flow.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On each system from which you want users to log in to with PIV cards:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>opensc</code> package:</p>
<div class="ulist">
<ul>
<li>
<p>On Debian or Ubuntu:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># apt install opensc</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 8+:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install opensc</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 7:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install opensc</pre>
</div>
</div>
</li>
<li>
<p>On OpenSUSE and SUSE Linux Enterprise Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># zypper install opensc</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Make sure Mozilla Firefox is installed.</p>
</li>
<li>
<p>In Mozilla Firefox main menu, click <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Privacy and Security</strong> tab, click <strong>Security Devices</strong>.</p>
</li>
<li>
<p>Click <strong>Load</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Load PKCS#11 Device Driver</strong> window, enter <strong>/usr/lib64/pkcs11/opensc-pkcs11.so</strong> in the <strong>Module filename</strong> field.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If the PIV card is connected to system, restart the <code>pcscd</code> service.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-group-mapping-for-keycloak-authentication_keycloak-quarkus"><a class="anchor" href="#configuring-group-mapping-for-keycloak-authentication_keycloak-quarkus"></a>5.8. Optional: Configuring external group mapping for Keycloak authentication</h3>
<div class="paragraph">
<p>To implement the role-based access control (RBAC), create a group in Foreman, assign a role to this group, and then map an Keycloak group to the Foreman group.
As a result, anyone in the given group in Keycloak will log in under the corresponding Foreman group.</p>
</div>
<div class="paragraph">
<p>For example, you can configure users of the Foreman-admin user group defined in Active Directory to authenticate as users with administrator privileges on Foreman.</p>
</div>
<div class="paragraph">
<p>If you do not configure group mapping, every user will receive the <em>Default role</em> permissions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>.</p>
</li>
<li>
<p>Click <strong>Create User Group</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter a name for the user group.
Enter a name that is different from the Active Directory user group name.</p>
</li>
<li>
<p>Do not add any users or user groups to the new group in Foreman web UI.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On the <strong>Roles</strong> tab, select <strong>Administer</strong>.</p>
</li>
<li>
<p>On the <strong>External Groups</strong> tab, click <strong>Add external user group</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter the name of the Active Directory group.</p>
</li>
<li>
<p>From the <strong>Auth Source</strong> drop-down menu, select <strong>EXTERNAL</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-quarkus"><a class="anchor" href="#logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-quarkus"></a>5.9. Logging in to Foreman configured with Keycloak as an authentication source</h3>
<div class="paragraph">
<p>With Keycloak configured as an external authentication source for Foreman, users defined in a Keycloak realm can log in to Foreman&#160;server.
The particular login methods available to users depend on how you configured integration between Keycloak and Foreman.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To authenticate to the Foreman web UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In your browser, go to <code>https://<em>foreman.example.com</em></code> and enter your credentials.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman web UI by using Keycloak TOTP:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your browser, log in to Foreman.
Foreman redirects you to the Keycloak login screen.</p>
</li>
<li>
<p>Enter your username and password, and click <strong>Log In</strong>.</p>
</li>
<li>
<p>On your first login attempt, Keycloak requests you to configure your client by scanning the bar code and entering your PIN.
Once authenticated, your browser redirects you back to Foreman and logs you in.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman CLI with Hammer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that Hammer is configured to enforce session usage in <code>~/.hammer/cli.modules.d/foreman.yml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :use_sessions: true</pre>
</div>
</div>
</li>
<li>
<p>Initiate an authentication session with <code>hammer auth login oauth</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--oidc-token-endpoint 'https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_realm</em>/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-hammer-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman CLI with Hammer by using Keycloak TOTP:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that Hammer is configured to enforce session usage in <code>~/.hammer/cli.modules.d/foreman.yml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :use_sessions: true</pre>
</div>
</div>
</li>
<li>
<p>Initiate an authentication session by using <code>--two-factor</code> with <code>hammer auth login oauth</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--two-factor \
--oidc-token-endpoint 'https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_realm</em>/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-hammer-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
<li>
<p>You will be prompted to enter a success code.
To retrieve the success code, navigate to the URL that the command returns.</p>
</li>
<li>
<p>Enter the success code in CLI.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To log in to the Foreman web UI using the Keycloak PIV cards:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Mozilla Firefox, log in to Foreman and enter your credentials.</p>
</li>
<li>
<p>When prompted, enter the PIN of the PIV card.</p>
</li>
<li>
<p>Choose the certificate for authentication.
Browser verifies this certificate with Keycloak.
Once authenticated, browser redirects you back to Foreman and logs you in.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-kerberos-sso-for-active-directory-users-in-project_authentication"><a class="anchor" href="#configuring-kerberos-sso-for-active-directory-users-in-project_authentication"></a>6. Configuring Kerberos SSO for Active Directory users in Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the base system of your Foreman&#160;server is connected directly to Active Directory (AD), you can configure AD as an external authentication source for Foreman.
Direct AD integration means that a Linux system is joined directly to the AD domain where the identity is stored.</p>
</div>
<div class="paragraph">
<p>AD users can log in using the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Username and password</p>
</li>
<li>
<p>Kerberos single sign-on</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can also connect your Foreman deployment to AD in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By using indirect AD integration.
With indirect integration, your Foreman&#160;server is connected to a FreeIPA server which is then connected to AD.
For more information, see <a href="#configuring-kerberos-sso-with-FreeIPA-in-project_authentication">Configuring Kerberos SSO with FreeIPA in Foreman</a>.</p>
</li>
<li>
<p>By attaching the LDAP server of the AD domain as an external authentication source with no single sign-on support.
For more information, see <a href="#configuring-an-ldap-server-as-an-external-identity-provider-for-project_authentication">Configuring an LDAP server as an external identity provider for Foreman</a>.
For an example configuration, see <a href="https://access.redhat.com/solutions/1498773">How to configure Active Directory authentication with TLS on Foreman</a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="configuring-the-active-directory-authentication-source-on-projectserver_authentication"><a class="anchor" href="#configuring-the-active-directory-authentication-source-on-projectserver_authentication"></a>6.1. Configuring the Active Directory authentication source on Foreman&#160;server</h3>
<div class="paragraph">
<p>Enable Active Directory (AD) users to access Foreman by configuring the corresponding authentication provider on your Foreman&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The base system of your Foreman&#160;server must be joined to an Active Directory (AD) domain.
To enable AD users to sign in with Kerberos single sign-on, use the System Security Services Daemon (SSSD) and Samba services to join the base system to the AD domain:</p>
<div class="paragraph">
<p>Install the following packages on Foreman&#160;server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install adcli krb5-workstation oddjob-mkhomedir oddjob realmd samba-winbind-clients samba-winbind samba-common-tools samba-winbind-krb5-locator sssd</pre>
</div>
</div>
<div class="paragraph">
<p>Specify the required software when joining the AD domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># realm join <em>AD.EXAMPLE.COM</em> --membership-software=samba --client-software=sssd</pre>
</div>
</div>
<div class="paragraph">
<p>For more information on direct AD integration, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html-single/integrating_rhel_systems_directly_with_windows_active_directory/index#connecting-rhel-systems-directly-to-ad-using-samba-winbind_integrating-rhel-systems-directly-with-active-directory">Connecting RHEL systems directly to AD using Samba Winbind</a>.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define AD realm configuration in a location where foreman-installer expects it:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a directory named <code>/etc/ipa/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /etc/ipa/</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/etc/ipa/default.conf</code> file with the following contents to configure the Kerberos realm for the AD domain:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[global]
realm = <em>AD.EXAMPLE.COM</em></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the Apache keytab for Kerberos connections:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Update the <code>/etc/samba/smb.conf</code> file with the following settings to configure how Samba interacts with AD:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[global]
workgroup = <em>AD.EXAMPLE</em>
realm = <em>AD.EXAMPLE.COM</em>
kerberos method = system keytab
security = ads</pre>
</div>
</div>
</li>
<li>
<p>Add the Kerberos service principal to the keytab file at <code>/etc/httpd/conf/http.keytab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># KRB5_KTNAME=FILE:/etc/httpd/conf/http.keytab net ads keytab add HTTP -U Administrator -s /etc/samba/smb.conf</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the System Security Services Daemon (SSSD) to use the AD access control provider to evaluate and enforce Group Policy Object (GPO) access control rules for the <code>foreman</code> PAM service:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <code>[domain/<em>ad.example.com</em>]</code> section of your <code>/etc/sssd/sssd.conf</code> file, configure the <code>ad_gpo_access_control</code> and <code>ad_gpo_map_service</code> options as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[domain/<em>ad.example.com</em>]
ad_gpo_access_control = enforcing
ad_gpo_map_service = +foreman</pre>
</div>
</div>
<div class="paragraph">
<p>For more information on GPOs, see the following documents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/integrating_rhel_systems_directly_with_windows_active_directory/managing-direct-connections-to-ad_integrating-rhel-systems-directly-with-active-directory#how-sssd-interprets-gpo-access-control-rules_applying-group-policy-object-access-control-in-rhel">How SSSD interprets GPO access control rules</a> in <em>Integrating RHEL systems directly with Windows Active Directory (RHEL&#160;9)</em></p>
</li>
<li>
<p><a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/integrating_rhel_systems_directly_with_windows_active_directory/managing-direct-connections-to-ad_integrating-rhel-systems-directly-with-active-directory#applying-group-policy-object-access-control-in-rhel_managing-direct-connections-to-ad">How SSSD interprets GPO access control rules</a> in <em>Integrating RHEL systems directly with Windows Active Directory (RHEL&#160;8)</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Restart SSSD:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart sssd</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Enable the authentication source:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-ipa-authentication=true</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To verify that AD users can log in to Foreman by entering their credentials, log in to Foreman web UI at https://foreman.example.com.
Enter the user name in the user principal name (UPN) format, for example: <code><em>ad_user</em>@<em>AD.EXAMPLE.COM</em></code>.</p>
</li>
<li>
<p>To verify that AD users can authenticate by using Kerberos single sign-on:</p>
<div class="ulist">
<ul>
<li>
<p>Obtain a Kerberos ticket-granting ticket (TGT) on behalf of an AD user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kinit <em>ad_user</em>@<em>AD.EXAMPLE.COM</em></pre>
</div>
</div>
</li>
<li>
<p>Verify user authentication by using your TGT:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl -k -u : --negotiate https://foreman.example.com/users/extlogin

&lt;html&gt;&lt;body&gt;You are being &lt;a href="foreman.example.com/hosts"&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><code>sssd-ad(5)</code> man page on your system</p>
</li>
<li>
<p>For information about configuring Mozilla Firefox for Kerberos, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/configuring_authentication_and_authorization_in_rhel/configuring_applications_for_sso#Configuring_Firefox_to_use_Kerberos_for_SSO">Configuring Firefox to use Kerberos for single sign-on</a> in <em>Red&#160;Hat Enterprise Linux&#160;9 Configuring authentication and authorization in RHEL</em>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-an-ldap-server-as-an-external-identity-provider-for-project_authentication"><a class="anchor" href="#configuring-an-ldap-server-as-an-external-identity-provider-for-project_authentication"></a>7. Configuring an LDAP server as an external identity provider for Foreman</h2>
<div class="sectionbody">
<div id="Using_LDAP_satellite" class="paragraph">
<p>Lightweight Directory Access Protocol (LDAP) is a set of open protocols used to access centrally stored information over a network.
With Foreman, you can use one or multiple LDAP directories for external authentication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>While you can configure the LDAP server integrated with FreeIPA as an external authentication source, FreeIPA users will not be able to log in by using single sign-on.
Instead, consider configuring FreeIPA as an external identity provider.
For more information, see <a href="#configuring-kerberos-sso-with-FreeIPA-in-project_authentication">Configuring Kerberos SSO with FreeIPA in Foreman</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Users cannot use both FreeIPA and LDAP as an authentication method.
After a user authenticates by using one of these methods, they cannot use the other method.</p>
</div>
<div class="paragraph">
<p>To change the authentication method for a user, remove the automatically created user from Foreman.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="Configuring_TLS_for_Secure_LDAP_authentication"><a class="anchor" href="#Configuring_TLS_for_Secure_LDAP_authentication"></a>7.1. Configuring TLS for secure LDAP</h3>
<div class="paragraph">
<p>If Foreman uses TLS to establish a secure LDAP connection (LDAPS), you must obtain the CA certificates  of your LDAP server and add them to the trusted CA list on the base operating system of your Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>If your LDAP server uses a certificate chain with intermediate certificate authorities,  you must obtain all root and intermediate certificates and add them to the trusted CA list.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Obtain the CA certificate from the LDAP Server:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If you use Active Directory Certificate Services, export the Enterprise PKI CA Certificate using the Base64 encoded X.509 format.
See <a href="https://access.redhat.com/solutions/1498773">How to configure Active Directory authentication with <code>TLS</code> on Foreman</a> for information on creating and exporting a CA certificate from an Active Directory server.</p>
</li>
<li>
<p>Download the LDAP server certificate to a temporary location on the Foreman&#160;server, such as <code>/tmp/<em>example.crt</em></code>.
You will remove the certificate when finished.</p>
<div class="paragraph">
<p>The filename extensions <code>.cer</code> and <code>.crt</code> are only conventions and can refer to DER binary or PEM ASCII format certificates.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Add the LDAP certificate to your CA trust list:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Install the LDAP certificate in the <code>/etc/pki/tls/certs/</code> directory with the correct permissions:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># install /tmp/<em>example.crt</em> /etc/pki/tls/certs/</pre>
</div>
</div>
<div class="paragraph">
<p>LDAP certificates must be individual files.</p>
</div>
</li>
<li>
<p>Create a symbolic link to the LDAP certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ln -s <em>example.crt</em> /etc/pki/tls/certs/$(openssl \
x509 -noout -hash -in \
/etc/pki/tls/certs/<em>example.crt</em>).0</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>httpd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Delete the downloaded LDAP certificate from the temporary location on your Foreman&#160;server.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Project_to_Use_LDAP_authentication"><a class="anchor" href="#Configuring_Project_to_Use_LDAP_authentication"></a>7.2. Configuring Foreman to use LDAP</h3>
<div class="paragraph">
<p>Configure an LDAP authentication source to enable users to log in to Foreman with their existing LDAP credentials.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your LDAP server complies with the <a href="https://datatracker.ietf.org/doc/html/rfc2307">RFC 2307</a> schema.</p>
</li>
<li>
<p>Your user account has the following permissions:</p>
<div class="ulist">
<ul>
<li>
<p><code>view_authenticators</code>, <code>create_authenticators</code>, <code>edit_authenticators</code></p>
</li>
<li>
<p><code>view_locations</code>, <code>assign_locations</code></p>
</li>
<li>
<p><code>view_organizations</code>, <code>assign_organizations</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Foreman&#160;server, enable the Network Information System (NIS) service so that SELinux does not block outgoing LDAP connections:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># setsebool -P nis_enabled on</pre>
</div>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Authentication Sources</strong>.</p>
</li>
<li>
<p>From the <strong>LDAP</strong> menu, select <strong>Create</strong>.</p>
</li>
<li>
<p>On the <strong>LDAP server</strong> tab, enter the details of your LDAP server.</p>
<div class="paragraph">
<p>For TLS encrypted connections, select <strong>LDAPS</strong> to enable encryption.</p>
</div>
</li>
<li>
<p>On the <strong>Account</strong> tab, enter the account information and domain name details.</p>
<div class="paragraph">
<p>See <a href="#Example_Settings_for_LDAP_Connections_authentication">Example settings for LDAP connections</a> and <a href="#Example_LDAP_Filters_authentication">Example LDAP filters</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Attribute mappings</strong> tab, map LDAP attributes to Foreman attributes.</p>
</li>
<li>
<p>On the <strong>Locations</strong> tab, select the locations you want Foreman to assign to users created from the LDAP authentication source.
These locations are available to users after they log in for the first time.</p>
</li>
<li>
<p>On the <strong>Organizations</strong> tab, select the organizations you want Foreman to assign to users created from the LDAP authentication source.
These locations are available to users after they log in for the first time.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>If you did not select <strong>Automatically Create Accounts In Foreman</strong> on the <strong>Account</strong> tab, create user accounts manually.
For more information, see <a href="https://docs.theforeman.org/3.13/Administering_Project/index-katello.html#Creating_a_User_admin">Creating a User</a> in <em>Administering Foreman</em>.</p>
</li>
<li>
<p>If you selected <strong>Automatically Create Accounts In Foreman</strong>, LDAP users can now log in to Foreman using their LDAP accounts and passwords.</p>
</li>
<li>
<p>After users log in for the first time, the Foreman administrator must assign roles to them manually.
For more information about assigning appropriate roles to user accounts, see <a href="https://docs.theforeman.org/3.13/Administering_Project/index-katello.html#Assigning_Roles_to_a_User_admin">Assigning Roles to a User</a> in <em>Administering Foreman</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Example_Settings_for_LDAP_Connections_authentication"><a class="anchor" href="#Example_Settings_for_LDAP_Connections_authentication"></a>7.3. Example settings for LDAP connections</h3>
<div class="exampleblock">
<div class="title">Example 3. Example settings for Active Directory LDAP connections</div>
<div class="content">
<div class="paragraph">
<p>This example uses a dedicated service account called <em>redhat</em> that has bind, read, and search permissions on the user and group entries.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Account Username</strong>: DOMAIN\redhat</p>
</li>
<li>
<p><strong>Account password</strong>: P@ssword</p>
</li>
<li>
<p><strong>Base DN</strong>: DC=example,DC=COM</p>
</li>
<li>
<p><strong>Login name attribute</strong>: userPrincipalName</p>
</li>
<li>
<p><strong>First name attribute</strong>: givenName</p>
</li>
<li>
<p><strong>Last name attribute</strong>: sn</p>
</li>
<li>
<p><strong>Email address attribute</strong>: mail</p>
</li>
<li>
<p><strong>Photo attribute</strong>: thumbnailPhoto</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>userPrincipalName</code> attribute allows the use of whitespace in usernames. The <code>sAMAccountName</code> attribute, which provides backwards compatibility with legacy Microsoft systems, does not allow the use of whitespace in usernames.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 4. Example settings for FreeIPA LDAP connections</div>
<div class="content">
<div class="paragraph">
<p>This example uses a dedicated service account called <em>redhat</em> that has bind, read, and search permissions on the user and group entries.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Account Username</strong>: uid=redhat,cn=users,cn=accounts,dc=example,dc=com</p>
</li>
<li>
<p><strong>Base DN</strong>: dc=example,dc=com</p>
</li>
<li>
<p><strong>Groups Base DN</strong>: cn=groups,cn=accounts,dc=example,dc=com</p>
</li>
<li>
<p><strong>Login name attribute</strong>: uid</p>
</li>
<li>
<p><strong>First name attribute</strong>: givenName</p>
</li>
<li>
<p><strong>Last name attribute</strong>: sn</p>
</li>
<li>
<p><strong>Email address attribute</strong>: mail</p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 5. Example settings for POSIX LDAP connections</div>
<div class="content">
<div class="paragraph">
<p>This example uses a dedicated service account called <em>redhat</em> that has bind, read, and search permissions on the user and group entries.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Account Username</strong>: uid=redhat,ou=users,dc=example,dc=com</p>
</li>
<li>
<p><strong>Base DN</strong>: dc=example,dc=com</p>
</li>
<li>
<p><strong>Groups Base DN</strong>: cn=employee,ou=userclass,dc=example,dc=com</p>
</li>
<li>
<p><strong>Login name attribute</strong>: uid</p>
</li>
<li>
<p><strong>First name attribute</strong>: givenName</p>
</li>
<li>
<p><strong>Last name attribute</strong>: sn</p>
</li>
<li>
<p><strong>Email address attribute</strong>: mail</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Example_LDAP_Filters_authentication"><a class="anchor" href="#Example_LDAP_Filters_authentication"></a>7.4. Example LDAP filters</h3>
<div class="exampleblock">
<div class="title">Example 6. Example LDAP filters for allowing specific users to login</div>
<div class="content">
<div class="paragraph">
<p>You are using the following LDAP directory structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">DC=Domain,DC=Example
   |
   |----- CN=Users
         |
         |----- CN=Group1
         |----- CN=Group2
         |----- CN=User1
         |----- CN=User2
         |----- CN=User3</pre>
</div>
</div>
<div class="paragraph">
<p>Group membership is defined as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Group1</code> includes users <code>User1</code> and <code>User3</code></p>
</li>
<li>
<p><code>Group2</code> includes users <code>User2</code> and <code>User3</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, you can define the following search filters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Search result (users)</th>
<th class="tableblock halign-left valign-top">Filter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(distinguishedName=cn=User1,cn=Users,dc=domain,dc=example)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(memberOf=cn=Group1,cn=Users,dc=domain,dc=example)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User2, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(memberOf=cn=Group2,cn=Users,dc=domain,dc=example)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1, User2, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(|(memberOf=cn=Group1,cn=Users,dc=domain,dc=example)(memberOf=cn=Group2,cn=Users,dc=domain,dc=example))</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1, User2, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(memberOf:1.2.840.113556.1.4.1941:=cn=Users,dc=domain,dc=example)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Because group <code>Users</code> is a nested group that contains groups <code>Group1</code> and <code>Group2</code>, the filter must include <code>memberOf:1.2.840.113556.1.4.1941:=</code> before the nested group name. This enables you to filter all users from the nested group.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="important-user-and-group-account-information-for-active-directory-accounts_authentication"><a class="anchor" href="#important-user-and-group-account-information-for-active-directory-accounts_authentication"></a>8. Important user and group account information for Active Directory accounts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All user and group accounts must be local accounts.
This is to ensure that there are no authentication conflicts between local accounts on your Foreman&#160;server and accounts in your Active Directory domain.</p>
</div>
<div class="paragraph">
<p>Your system is not affected by this conflict if your user and group accounts exist in both <code>/etc/passwd</code> and <code>/etc/group</code> files.
For example, to check if entries for <code>puppet</code>, <code>apache</code>, <code>foreman</code> and <code>foreman-proxy</code> groups exist in both <code>/etc/passwd</code> and <code>/etc/group</code> files, enter the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># grep 'puppet\|apache\|foreman\|foreman-proxy' /etc/passwd /etc/group</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_External_User_Groups_authentication"><a class="anchor" href="#Configuring_External_User_Groups_authentication"></a>9. Configuring external user groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman does not associate external users with their user group automatically.
You must create a user group with the same name as in the external source on Foreman.
Members of the external user group then automatically become members of the Foreman user group and receive the associated permissions.</p>
</div>
<div class="paragraph">
<p>The configuration of external user groups depends on the type of external authentication.</p>
</div>
<div class="paragraph">
<p>To assign additional permissions to an external user, add this user to an internal user group that has no external mapping specified.
Then assign the required roles to this group.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>If you use an LDAP server, configure Foreman to use LDAP authentication.
For more information, see <a href="#configuring-an-ldap-server-as-an-external-identity-provider-for-project_authentication">Configuring an LDAP server as an external identity provider for Foreman</a>.</p>
<div class="paragraph">
<p>When using external user groups from an LDAP source, you cannot use the <code>$login</code> variable as a substitute for the account user name.
You must use either an anonymous or dedicated service user.</p>
</div>
</li>
<li>
<p>If you use a FreeIPA or AD server, configure Foreman to use FreeIPA or AD authentication.
For more information, see <a href="https://docs.theforeman.org/3.13/Installing_Server/index-katello.html#Configuring_External_Authentication_foreman">Configuring External Authentication</a> in <em>Installing Foreman&#160;Server with Katello 4.15 plugin on Enterprise Linux</em>.</p>
</li>
<li>
<p>Ensure that at least one external user authenticates for the first time.</p>
</li>
<li>
<p>Retain a copy of the external group names you want to use.
To find the group membership of external users, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id <em>username</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>, and click <strong>Create User Group</strong>.</p>
</li>
<li>
<p>Specify the name of the new user group.
Do not select any users to avoid adding users automatically when you refresh the external user group.</p>
</li>
<li>
<p>Click the <strong>Roles</strong> tab and select the roles you want to assign to the user group.
Alternatively, select the <strong>Administrator</strong> checkbox to assign all available permissions.</p>
</li>
<li>
<p>Click the <strong>External groups</strong> tab, then click <strong>Add external user group</strong>, and select an authentication source from the <strong>Auth source</strong> drop-down menu.</p>
<div class="paragraph">
<p>Specify the exact name of the external group in the <strong>Name</strong> field.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Refreshing_External_User_Groups_for_LDAP_authentication"><a class="anchor" href="#Refreshing_External_User_Groups_for_LDAP_authentication"></a>10. Refreshing external user groups for LDAP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To set the LDAP source to synchronize user group membership automatically on user login, in the <strong>Auth Source</strong> page, select the <strong>Usergroup Sync</strong> option.
If this option is not selected, LDAP user groups are refreshed automatically through a scheduled cron job synchronizing the LDAP Authentication source every 30 minutes by default.</p>
</div>
<div class="paragraph">
<p>If the user groups in the LDAP Authentication source change in the lapse of time between scheduled tasks, the user can be assigned to incorrect external user groups.
This is corrected automatically when the scheduled task runs.</p>
</div>
<div class="paragraph">
<p>Use this procedure to refresh the LDAP source manually.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Usergroups</strong> and select a user group.</p>
</li>
<li>
<p>On the <strong>External Groups</strong> tab, click <strong>Refresh</strong> to the right of the required user group.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre># foreman-rake ldap:refresh_usergroups</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Refreshing_External_User_Groups_for_FreeIPA_or_AD_authentication"><a class="anchor" href="#Refreshing_External_User_Groups_for_FreeIPA_or_AD_authentication"></a>11. Refreshing external user groups for FreeIPA or AD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>External user groups based on FreeIPA or AD are refreshed only when a group member logs in to Foreman.
It is not possible to alter user membership of external user groups in the Foreman web UI, such changes are overwritten on the next group refresh.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.13 (unsupported)<br>
Last updated Nov 2024
</div>
</div>
<script>
;(function () { /*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
  'use strict'

  var config = (document.currentScript || {}).dataset || {}
  var forEach = Array.prototype.forEach

  init(document.querySelectorAll('.tabs'))

  function init (tabsBlocks) {
    if (!tabsBlocks.length) return
    forEach.call(tabsBlocks, function (tabs) {
      var syncIds = tabs.classList.contains('is-sync') ? {} : undefined
      var tablist = tabs.querySelector('.tablist ul')
      tablist.setAttribute('role', 'tablist')
      var start
      forEach.call(tablist.querySelectorAll('li'), function (tab, idx) {
        tab.tabIndex = -1
        tab.setAttribute('role', tab.classList.add('tab') || 'tab')
        var id, anchor, syncId
        if (!(id = tab.id) && (anchor = tab.querySelector('a[id]'))) {
          id = tab.id = anchor.parentNode.removeChild(anchor).id
        }
        var panel = id && tabs.querySelector('.tabpanel[aria-labelledby~="' + id + '"]')
        if (!panel) return idx ? undefined : toggleSelected(tab, true) // invalid state
        syncIds && (((syncId = tab.textContent.trim()) in syncIds) ? (syncId = undefined) : true) &&
          (syncIds[(tab.dataset.syncId = syncId)] = tab)
        idx || (syncIds && (start = { tab: tab, panel: panel })) ? toggleHidden(panel, true) : toggleSelected(tab, true)
        tab.setAttribute('aria-controls', panel.id)
        panel.setAttribute('role', 'tabpanel')
        var onClick = syncId === undefined ? activateTab : activateTabSync
        tab.addEventListener('click', onClick.bind({ tabs: tabs, tab: tab, panel: panel }))
      })
      if (!tabs.closest('.tabpanel')) {
        forEach.call(tabs.querySelectorAll('.tabpanel table.tableblock'), function (table) {
          var container = Object.assign(document.createElement('div'), { className: 'tablecontainer' })
          table.parentNode.insertBefore(container, table).appendChild(table)
        })
      }
      if (start) {
        var syncGroupId
        for (var i = 0, lst = tabs.classList, len = lst.length, className; i !== len; i++) {
          if (!(className = lst.item(i)).startsWith('data-sync-group-id=')) continue
          tabs.dataset.syncGroupId = syncGroupId = lst.remove(className) || className.slice(19).replace(/\u00a0/g, ' ')
          break
        }
        if (syncGroupId === undefined) tabs.dataset.syncGroupId = syncGroupId = Object.keys(syncIds).sort().join('|')
        var preferredSyncId = 'syncStorageKey' in config &&
          window[(config.syncStorageScope || 'local') + 'Storage'].getItem(config.syncStorageKey + '-' + syncGroupId)
        var tab = preferredSyncId && syncIds[preferredSyncId]
        tab && Object.assign(start, { tab: tab, panel: document.getElementById(tab.getAttribute('aria-controls')) })
        toggleSelected(start.tab, true) || toggleHidden(start.panel, false)
      }
    })
    onHashChange()
    toggleClassOnEach(tabsBlocks, 'is-loading', 'remove')
    window.setTimeout(toggleClassOnEach.bind(null, tabsBlocks, 'is-loaded', 'add'), 0)
    window.addEventListener('hashchange', onHashChange)
  }

  function activateTab (e) {
    var tab = this.tab
    var tabs = this.tabs || (this.tabs = tab.closest('.tabs'))
    var panel = this.panel || (this.panel = document.getElementById(tab.getAttribute('aria-controls')))
    querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (el) {
      toggleSelected(el, el === tab)
    })
    querySelectorWithSiblings(tabs, '.tabpanel', 'tabpanel').forEach(function (el) {
      toggleHidden(el, el !== panel)
    })
    if (!this.isSync && 'syncStorageKey' in config && 'syncGroupId' in tabs.dataset) {
      var storageKey = config.syncStorageKey + '-' + tabs.dataset.syncGroupId
      window[(config.syncStorageScope || 'local') + 'Storage'].setItem(storageKey, tab.dataset.syncId)
    }
    if (!e) return
    var loc = window.location
    var hashIdx = loc.hash ? loc.href.indexOf('#') : -1
    if (~hashIdx) window.history.replaceState(null, '', loc.href.slice(0, hashIdx))
    e.preventDefault()
  }

  function activateTabSync (e) {
    activateTab.call(this, e)
    var thisTabs = this.tabs
    var thisTab = this.tab
    var initialY = thisTabs.getBoundingClientRect().y
    forEach.call(document.querySelectorAll('.tabs'), function (tabs) {
      if (tabs === thisTabs || tabs.dataset.syncGroupId !== thisTabs.dataset.syncGroupId) return
      querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (tab) {
        if (tab.dataset.syncId === thisTab.dataset.syncId) activateTab.call({ tabs: tabs, tab: tab, isSync: true })
      })
    })
    var shiftedBy = thisTabs.getBoundingClientRect().y - initialY
    if (shiftedBy && (shiftedBy = Math.round(shiftedBy))) window.scrollBy({ top: shiftedBy, behavior: 'instant' })
  }

  function querySelectorWithSiblings (scope, selector, siblingClass) {
    var el = scope.querySelector(selector)
    if (!el) return []
    var result = [el]
    while ((el = el.nextElementSibling) && el.classList.contains(siblingClass)) result.push(el)
    return result
  }

  function toggleClassOnEach (elements, className, method) {
    forEach.call(elements, function (el) {
      el.classList[method](className)
    })
  }

  function toggleHidden (el, state) {
    el.classList[(el.hidden = state) ? 'add' : 'remove']('is-hidden')
  }

  function toggleSelected (el, state) {
    el.setAttribute('aria-selected', '' + state)
    el.classList[state ? 'add' : 'remove']('is-selected')
    el.tabIndex = state ? 0 : -1
  }

  function onHashChange () {
    var id = window.location.hash.slice(1)
    if (!id) return
    var tab = document.getElementById(~id.indexOf('%') ? decodeURIComponent(id) : id)
    if (!(tab && tab.classList.contains('tab'))) return
    'syncId' in tab.dataset ? activateTabSync.call({ tab: tab }) : activateTab.call({ tab: tab })
  }
})()
</script>
</body>
</html>