<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Administering Foreman</title>
<link rel="stylesheet" href="./foreman-el.css">
<!-- docinfo -->
</head>
<body class="book toc2 toc-left">
<!--
	vim: set noai ts=2 sts=2 sw=2 et ft= syn=html
-->
<div id="wrap">
<script src="/js/nav.js"></script>
<script>
const versionRe = new RegExp(`/(nightly|\\d+.\\d+)/`);
var currentVer = document.location.toString().match(versionRe);
if (currentVer && currentVer.length > 1) {
  currentVer = currentVer[1];
} else {
  currentVer = "nightly";
}
var navId = 1;
var Navbar = `<nav>
<img class="logo" src="/img/helmet.svg" />
<button type="button" class="btn-hamburger" data-action="nav-toggle">
  <span></span>
  <span></span>
  <span></span>
  <span></span>
  <span></span>
</button>
<ul class="nav-menu">
  <li class="nav-item"><a href="/">Home</a></li>`
  + navItems.map(function(navItem){ return(
    `<li id="nav-id-`+ navId++ +`" class="nav-item dropdown">
        <a href="#" data-action="dropdown-toggle">`+ navItem.title + `</a>
        <div class="dropdown-menu">`
        + navItem.items.map(function(item){ return(
            `<div class="dropdown-div"><a class="dropdown-item" href=/`+currentVer+item.href+`>`+item.title+`</a></div>`
        )}).join("")
        +`</div>
    </li>`
    )}).join("")
  + navVersions.map(function(navItem){ return(
    `<li id="nav-id-`+ navId++ +`" class="nav-item dropdown">
        <a href="#" data-action="dropdown-toggle">Version `+currentVer+`</a>
        <div class="dropdown-menu dropdown-menu-left">`
        + navItem.items.map(function(item){
            if (document.location.pathname == "/") {
                var dl = "/release/" + item.href;
            } else {
                var dl = document.location.toString().replace(versionRe, "/"+item.href+"/");
            }
            return(`<div class="dropdown-div"><a class="dropdown-item" href=`+dl+`>`+item.title+`</a></div>`
        )}).join("")
        +`</div>
    </li>`
    )}).join("")
+`</ul>
</nav>`;

function toggleElement(dropdown) {
  if (dropdown.classList.contains("show")) {
    dropdown.classList.remove("show");
  } else {
    dropdown.classList.add("show");
  }
}

function closeAll(except) {
  for (let i = 1; i <= navItems.length + 1; i++) {
    let elem = document.getElementById("nav-id-" + i)
    if (elem != except) {
      elem.classList.remove("show");
    }
  }
}

var addNavbarListeners = () => {
  let nav = document.querySelector("nav");
  let navId = 1;
  nav.querySelectorAll("[data-action='dropdown-toggle']").forEach((dropdownToggle) => {
    let dropdown = document.getElementById("nav-id-" + navId++);
    dropdownToggle.addEventListener("click", () => {
      closeAll(dropdown);
      toggleElement(dropdown);
    });
  });

  nav.querySelector("[data-action='nav-toggle']").addEventListener("click", () => {
    if (nav.classList.contains("opened")) {
      nav.classList.remove("opened");
    } else {
      nav.classList.add("opened");
    }
  });
}
document.open();
document.write(Navbar)
addNavbarListeners();
document.close();
</script>
</div>
<div id="header">
<h1>Administering Foreman</h1>
<div class="details">
<span id="revnumber">version 3.0,</span>
<span id="revdate">published Jan 21 2022</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#chap-Administering-Accessing_Red_Hat_Satellite">1. Accessing Foreman</a>
<ul class="sectlevel2">
<li><a href="#sect-Administering-Installing_the_Katello_Root_CA_Certificate">1.1. Installing the Katello Root CA Certificate</a></li>
<li><a href="#sect-Administering-Logging_on_to_Satellite">1.2. Logging on to Foreman</a></li>
<li><a href="#form-Administering-Navigation_Tabs_in_the_Satellite_Web_UI">1.3. Navigation Tabs in the Foreman web UI</a></li>
<li><a href="#sect-Administering-Changing_the_Password">1.4. Changing the Password</a></li>
<li><a href="#sect-Administering-Resetting_the_Administrative_User_Password">1.5. Resetting the Administrative User Password</a></li>
<li><a href="#sect-Administering-Setting_a_Custom_Login_Message">1.6. Setting a Custom Message on the Login Page</a></li>
</ul>
</li>
<li><a href="#chap-Administering-Starting_and_Stopping_Red_Hat_Satellite">2. Starting and Stopping Foreman</a></li>
<li><a href="#migrating-from-internal-databases-to-external-databases_admin">3. Migrating from Internal Foreman Databases to External Databases</a>
<ul class="sectlevel2">
<li><a href="#postgresql-as-an-external-database-considerations_admin">3.1. PostgreSQL as an External Database Considerations</a></li>
<li><a href="#preparing-a-host-for-external-databases_admin">3.2. Preparing a Host for External Databases</a></li>
<li><a href="#installing-postgresql_admin">3.3. Installing PostgreSQL</a></li>
<li><a href="#migrating-to-external-databases_admin">3.4. Migrating to External Databases</a></li>
</ul>
</li>
<li><a href="#using-satellite-ansible-content-collections_admin">4. Managing Foreman with Ansible Collections</a>
<ul class="sectlevel2">
<li><a href="#installing-satellite-ansible-modules-via-rpm_admin">4.1. Installing the Foreman Ansible Modules from RPM</a></li>
<li><a href="#listing-using-satellite-ansible-modules_admin">4.2. Viewing the Foreman Ansible Modules</a></li>
</ul>
</li>
<li><a href="#chap-Administering-Users_and_Roles">5. Managing Users and Roles</a>
<ul class="sectlevel2">
<li><a href="#user-management_admin">5.1. User Management</a></li>
<li><a href="#ssh-keys_admin">5.2. SSH Key Management</a></li>
<li><a href="#sect-Administering-Users_and_Roles-Creating_and_Managing_User_Groups">5.3. Creating and Managing User Groups</a></li>
<li><a href="#sect-Administering-Users_and_Roles-Creating_and_Managing_Roles">5.4. Creating and Managing Roles</a></li>
<li><a href="#sect-Administering-Users_and_Roles-Granular_Permission_Filtering">5.5. Granular Permission Filtering</a></li>
</ul>
</li>
<li><a href="#configuring-email-notifications_admin">6. Configuring Email Notifications</a>
<ul class="sectlevel2">
<li><a href="#testing-email-delivery_admin">6.1. Testing Email Delivery</a></li>
<li><a href="#testing-email-notifications_admin">6.2. Testing Email Notifications</a></li>
<li><a href="#notification-types_admin">6.3. Notification Types</a></li>
<li><a href="#changing-email-notifications-for-a-host_admin">6.4. Changing email notification settings for a host</a></li>
</ul>
</li>
<li><a href="#chap-Administering-Security_Compliance_Management">7. Managing Security Compliance</a>
<ul class="sectlevel2">
<li><a href="#security-content-automation-protocol_admin">7.1. Security Content Automation Protocol</a></li>
<li><a href="#sect-Administering-Security_Compliance_Management_with_OpenSCAP-Configuring_SCAP_Content">7.2. Configuring SCAP Content</a></li>
<li><a href="#sect-Administering-Security_Compliance_Management_with_OpenSCAP-Managing_Compliance_Policies">7.3. Managing Compliance Policies</a></li>
<li><a href="#tailoring-files_admin">7.4. Tailoring Files</a></li>
<li><a href="#configuring-a-host-group-for-openscap_admin">7.5. Configuring a host group for OpenSCAP</a></li>
<li><a href="#configuring-a-host-for-openscap_admin">7.6. Configuring a host for OpenSCAP</a></li>
<li><a href="#monitoring-compliance_admin">7.7. Monitoring Compliance</a></li>
<li><a href="#sect-Administering-Specifications_Supported_OpenSCAP">7.8. Specifications Supported by OpenSCAP</a></li>
</ul>
</li>
<li><a href="#backing-up-satellite-server-and-capsule-server">8. Backing Up Foreman&#160;server and Smart&#160;Proxy&#160;server</a>
<ul class="sectlevel2">
<li><a href="#estimating-the-size-of-a-backup_admin">8.1. Estimating the Size of a Backup</a></li>
<li><a href="#performing-a-full-backup-of-satellite-or-capsule_admin">8.2. Performing a Full Backup of Foreman&#160;server or Smart&#160;Proxy&#160;server</a></li>
<li><a href="#performing-a-backup-without-pulp-content_admin">8.3. Performing a Backup without Pulp Content</a></li>
<li><a href="#performing-an-incremental-backup_admin">8.4. Performing an Incremental Backup</a></li>
<li><a href="#example-of-a-weekly-full-backup-followed-by-daily-incremental-backups_admin">8.5. Example of a Weekly Full Backup Followed by Daily Incremental Backups</a></li>
<li><a href="#performing-an-online-backup_admin">8.6. Performing an Online Backup</a></li>
<li><a href="#performing-a-snapshot-backup_admin">8.7. Performing a Snapshot Backup</a></li>
<li><a href="#white-listing-and-skipping-steps-when-performing-backups_admin">8.8. White-listing and Skipping Steps When Performing Backups</a></li>
</ul>
</li>
<li><a href="#sect-Administering-Backup_and_Disaster_Recovery-Restoring_Satellite_Server_or_Capsule_Server_from_a_Backup">9. Restoring Foreman&#160;server or Smart&#160;Proxy&#160;server from a Backup</a>
<ul class="sectlevel2">
<li><a href="#restoring-from-a-full-backup_admin">9.1. Restoring from a Full Backup</a></li>
<li><a href="#restoring-from-incremental-backups_admin">9.2. Restoring from Incremental Backups</a></li>
<li><a href="#backup-and-restore-capsule-server-using-a-virtual-machine-snapshot_admin">9.3. Backup and Restore Smart&#160;Proxy&#160;server Using a Virtual Machine Snapshot</a></li>
</ul>
</li>
<li><a href="#sect-Administering-Renaming_a_Server">10. Renaming Foreman&#160;server or Smart&#160;Proxy&#160;server</a>
<ul class="sectlevel2">
<li><a href="#sect-Administering-Renaming_a_Satellite_Server">10.1. Renaming Foreman&#160;server</a></li>
<li><a href="#sect-Administering-Renaming_a_Capsule_Server">10.2. Renaming Smart&#160;Proxy&#160;server</a></li>
</ul>
</li>
<li><a href="#chap-Administering-Maintaining_a_Red_Hat_Satellite_Server">11. Maintaining Foreman&#160;server</a>
<ul class="sectlevel2">
<li><a href="#sect-Administering-Deleting_Audit_Records">11.1. Deleting Audit Records</a></li>
<li><a href="#sect-Administering-Anonymizing_Audit_Records">11.2. Anonymizing Audit Records</a></li>
<li><a href="#sect-Administering-Configuring_the_Cleaning_Unused_Tasks_Feature">11.3. Configuring the Cleaning Unused Tasks Feature</a></li>
<li><a href="#sect-Administering-Recovering_from_a_Full_Disk">11.4. Recovering from a Full Disk</a></li>
<li><a href="#reclaiming-postgresql-space-after-an-upgrade_admin">11.5. Reclaiming PostgreSQL Space</a></li>
</ul>
</li>
<li><a href="#chap-Administering-Logging_and_Reporting_Problems">12. Logging and Reporting Problems</a>
<ul class="sectlevel2">
<li><a href="#enabling-debug-logging_admin">12.1. Enabling Debug Logging</a></li>
<li><a href="#_enabling_individual_loggers">12.2. Enabling Individual Loggers</a></li>
<li><a href="#configuring-logging-to-journal">12.3. Configuring Logging to Journal</a></li>
<li><a href="#log-file-directories-provided-by-satellite_admin">12.4. Log File Directories Provided by Foreman</a></li>
<li><a href="#utilities-for-collecting-log-information_admin">12.5. Utilities for Collecting Log Information</a></li>
</ul>
</li>
<li><a href="#chap-Administering-Configuring_External_Authentication">13. Configuring External Authentication</a>
<ul class="sectlevel2">
<li><a href="#sect-Administering-Using_LDAP">13.1. Using LDAP</a></li>
<li><a href="#sect-Administering-Configuring_External_Authentication-Using_Identity_Management">13.2. Using FreeIPA</a></li>
<li><a href="#sect-Administering-Configuring_External_Authentication-Using_Active_Directory">13.3. Using Active Directory</a></li>
<li><a href="#sect-Administering-Creating_User_Groups-Configuring_External_User_Groups">13.4. Configuring External User Groups</a></li>
<li><a href="#_refreshing_external_user_groups_for_ldap">13.5. Refreshing External User Groups for LDAP</a></li>
<li><a href="#_refreshing_external_user_groups_for_freeipa_or_ad">13.6. Refreshing External User Groups for FreeIPA or AD</a></li>
<li><a href="#sect-Administering-Configuring_External_Authentication-External_Authentication_for_Provisioned_Hosts">13.7. External Authentication for Provisioned Hosts</a></li>
<li><a href="#configuring-project-with-keycloak-authentication_admin">13.8. Configuring Foreman with Keycloak Authentication</a></li>
<li><a href="#configuring-keycloak-authentication-with-totp_admin">13.9. Configuring Keycloak Authentication with TOTP</a></li>
<li><a href="#configuring-keycloak-authentication-with-cac-cards_admin">13.10. Configuring Keycloak Authentication with PIV Cards</a></li>
<li><a href="#disabling-keycloak-authentication_admin">13.11. Disabling Keycloak Authentication</a></li>
</ul>
</li>
<li><a href="#chap-Administering-Monitoring_Resources">14. Monitoring Resources</a>
<ul class="sectlevel2">
<li><a href="#chap-Administering-Using_the_Red_Hat_Satellite_Content_Dashboard">14.1. Using the Foreman Content Dashboard</a></li>
<li><a href="#sect-Administering-Configuring_RSS_Notifications">14.2. Configuring RSS Notifications</a></li>
<li><a href="#sect-Administering-Monitoring_Satellite_Server">14.3. Monitoring Foreman&#160;server</a></li>
<li><a href="#chap-Administering-Monitoring_Capsule_Servers">14.4. Monitoring Smart&#160;Proxy&#160;server</a></li>
</ul>
</li>
<li><a href="#using-foreman-webhooks_admin">15. Using Webhooks</a>
<ul class="sectlevel2">
<li><a href="#migrating-to-webhooks_admin">15.1. Migrating to Webhooks</a></li>
<li><a href="#installing-webhooks-plugin_admin">15.2. Installing Webhooks</a></li>
<li><a href="#creating-a-webhook-template_admin">15.3. Creating a Webhook Template</a></li>
<li><a href="#creating-a-webhook_admin">15.4. Creating a Webhook</a></li>
<li><a href="#webhooks-available-events_admin">15.5. Available Webhook Events</a></li>
<li><a href="#shellhooks_admin">15.6. Shellhooks</a></li>
<li><a href="#installing-shellhooks-plugin_admin">15.7. Installing the Shellhooks Plugin</a></li>
<li><a href="#using-shellhook_argumentsadmin">15.8. Using Shellhook Arguments</a></li>
</ul>
</li>
<li><a href="#chap-Administering-Searching_and_Bookmarking">16. Searching and Bookmarking</a>
<ul class="sectlevel2">
<li><a href="#sect-Administering-Searching_and_Bookmarking-Building_Search_Queries">16.1. Building Search Queries</a></li>
<li><a href="#sect-Administering-Searching_and_Bookmarking-Using_Free_Text_Search">16.2. Using Free Text Search</a></li>
<li><a href="#sect-Administering-Searching_and_Bookmarking-Bookmarking">16.3. Managing Bookmarks</a></li>
</ul>
</li>
<li><a href="#satellite-settings_admin">Appendix A: Foreman Settings</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="chap-Administering-Accessing_Red_Hat_Satellite">1. Accessing Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After Foreman has been installed and configured, use the web user interface to log in to Foreman for further configuration.</p>
</div>
<div class="sect2">
<h3 id="sect-Administering-Installing_the_Katello_Root_CA_Certificate">1.1. Installing the Katello Root CA Certificate</h3>
<div class="paragraph">
<p>The first time you log on to Foreman, you might see a warning informing you that you are using the default self-signed certificate and you might not be able to connect this browser to Foreman until the root CA certificate is installed in the browser.
Use the following procedure to locate the root CA certificate on Foreman and to install it in your browser.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Your Foreman is installed and configured.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify the fully qualified domain name of your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hostname -f</pre>
</div>
</div>
</li>
<li>
<p>Access the <code>pub</code> directory on your Foreman&#160;server using a web browser pointed to the fully qualified domain name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://<em>foreman.example.com</em>/pub</pre>
</div>
</div>
</li>
<li>
<p>When you access Foreman for the first time, an untrusted connection warning displays in your web browser.
Accept the self-signed certificate and add the Foreman URL as a security exception to override the settings.
This procedure might differ depending on the browser being used.
Ensure that the Foreman URL is valid before you accept the security exception.</p>
</li>
<li>
<p>Select <code>katello-server-ca.crt</code>.</p>
</li>
<li>
<p>Import the certificate into your browser as a certificate authority and trust it to identify websites.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Importing the Katello Root CA Certificate Manually</div>
<p>If you cannot add a security exception in your browser, import the Katello root CA certificate manually.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the Foreman CLI, copy the <code>katello-server-ca.crt</code> file to the machine you use to access the Foreman web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /var/www/html/pub/katello-server-ca.crt \
<em>username@hostname:remotefile</em></pre>
</div>
</div>
</li>
<li>
<p>In the browser, import the <code>katello-server-ca.crt</code> certificate as a certificate authority and trust it to identify websites.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Logging_on_to_Satellite">1.2. Logging on to Foreman</h3>
<div class="paragraph">
<p>Use the web user interface to log on to Foreman for further configuration.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Ensure that the Katello root CA certificate is installed in your browser.
For more information, see <a href="#sect-Administering-Installing_the_Katello_Root_CA_Certificate">Installing the Katello Root CA Certificate</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Access Foreman&#160;server using a web browser pointed to the fully qualified domain name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://<em>foreman.example.com</em>/</pre>
</div>
</div>
</li>
<li>
<p>Enter the user name and password created during the configuration process.
If a user was not created during the configuration process, the default user name is <em>admin</em>.
If you have problems logging on, you can reset the password.
For more information, see <a href="#sect-Administering-Resetting_the_Administrative_User_Password">Resetting the Administrative User Password</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="form-Administering-Navigation_Tabs_in_the_Satellite_Web_UI">1.3. Navigation Tabs in the Foreman web UI</h3>
<div class="paragraph">
<p>Use the navigation tabs to browse the Foreman web UI.</p>
</div>
<div class="paragraph">
<p><a id="tabl-Administering-Logging_in_to_Red_Hat_Satellite-Navigation_Tabs"></a>
.Navigation Tabs</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Navigation Tabs</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Any Context</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clicking this tab changes the organization and location.
If no organization or location is selected, the default organization is <em>Any Organization</em> and the default location is <em>Any Location</em>.
Use this tab to change to different values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Monitor</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides summary dashboards and reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Content</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides content management tools.
This includes Content Views, Activation Keys, and Life Cycle Environments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides host inventory and provisioning configuration tools.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Configure</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides general configuration tools and data including Host Groups and Puppet data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Infrastructure</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides tools on configuring how Foreman interacts with the environment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>User Name</em></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides user administration where users can edit their personal information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/notifications1.png" alt="notifications1"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides event notifications to keep administrators informed of important environment changes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Administer</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides advanced configuration for settings such as Users and RBAC, as well as general settings.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="sect-Administering-Changing_the_Password">1.4. Changing the Password</h3>
<div class="paragraph">
<p>These steps show how to change your password.</p>
</div>
<div class="paragraph">
<p><a id="proc-Administering-Changing_the_Password-To_Change_your_Red_Hat_Satellite_Password"></a>
.To Change your Foreman Password:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click your user name at the top right corner.</p>
</li>
<li>
<p>Select <strong>My Account</strong> from the menu.</p>
</li>
<li>
<p>In the <strong>Current Password</strong> field, enter the current password.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter a new password.</p>
</li>
<li>
<p>In the <strong>Verify</strong> field, enter the new password again.</p>
</li>
<li>
<p>Click the <strong>Submit</strong> button to save your new password.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Resetting_the_Administrative_User_Password">1.5. Resetting the Administrative User Password</h3>
<div class="paragraph">
<p>Use the following procedures to reset the administrative password to randomly generated characters or to set a new administrative password.</p>
</div>
<div id="proc-Administering-Resetting_the_Administrative_User_Password-To_Reset_the_Administrative_User_Password" class="paragraph">
<div class="title">To Reset the Administrative User Password:</div>
<p>To reset the password to randomly generated characters, complete the following procedure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log on to the base operating system where Foreman&#160;server is installed.</p>
</li>
<li>
<p>Enter the following command to reset the password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake permissions:reset
Reset to user: admin, password: qwJxBptxb7Gfcjj5</pre>
</div>
</div>
</li>
<li>
<p>Use this password to reset the password in the Foreman web UI.</p>
</li>
<li>
<p>Edit the <code>~/.hammer/cli.modules.d/foreman.yml</code> file on Foreman&#160;server to add the new password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#  vi ~/.hammer/cli.modules.d/foreman.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Unless you update the <code>~/.hammer/cli.modules.d/foreman.yml</code> file, you cannot use the new password with Hammer CLI.</p>
</div>
<div id="proc-Administering-Resetting_the_Administrative_User_Password-To_Set_a_New_Administrative_User_Password" class="paragraph">
<div class="title">To Set a New Administrative User Password:</div>
<p>To change the administrative user password to a new password, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log on to the base operating system where Foreman&#160;server is installed.</p>
</li>
<li>
<p>To set the password, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake permissions:reset password=<em>new_password</em></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>~/.hammer/cli.modules.d/foreman.yml</code> file on Foreman&#160;server to add the new password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#  vi ~/.hammer/cli.modules.d/foreman.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Unless you update the <code>~/.hammer/cli.modules.d/foreman.yml</code> file, you cannot use the new password with Hammer CLI.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Setting_a_Custom_Login_Message">1.6. Setting a Custom Message on the Login Page</h3>
<div id="proc-Administering-Setting_a_Custom_Login_Message-To_Set_a_Custom_Login_Message" class="olist arabic">
<div class="title">To Set a Custom Message on the Login Page:</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>General</strong> tab.</p>
</li>
<li>
<p>Click the edit button next to <strong>Login page footer text</strong>, and enter the desired text to be displayed on the login page.
For example, this text may be a warning message required by your company.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Log out of the Foreman&#8217;s web UI and verify that the custom text is now displayed on the login page below the Foreman version number.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Administering-Starting_and_Stopping_Red_Hat_Satellite">2. Starting and Stopping Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman provides the <code>foreman-maintain service</code> command to manage Foreman services from the command line.
This is useful when creating a backup of Foreman.
For more information on creating backups, see <a href="#backing-up-satellite-server-and-capsule-server">Backing Up Foreman&#160;server and Smart&#160;Proxy&#160;server</a>.</p>
</div>
<div class="paragraph">
<p>After installing Foreman with the <code>foreman-installer</code> command, all Foreman services are started and enabled automatically.
View the list of these services by executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service list</pre>
</div>
</div>
<div class="paragraph">
<p>To see the status of running services, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service status</pre>
</div>
</div>
<div class="paragraph">
<p>To stop the <code>foreman-maintain</code> services, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service stop</pre>
</div>
</div>
<div class="paragraph">
<p>To start the <code>foreman-maintain</code> services, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service start</pre>
</div>
</div>
<div class="paragraph">
<p>To restart the <code>foreman-maintain</code> services, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service restart</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-from-internal-databases-to-external-databases_admin">3. Migrating from Internal Foreman Databases to External Databases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Red Hat systems only.</p>
</div>
<div class="paragraph">
<p>When you install Foreman, the <strong>foreman-installer</strong> command installs PostgreSQL databases on the same server as Foreman.
If you are using the default internal databases but want to start using external databases to help with the server load, you can migrate your internal databases to external databases.</p>
</div>
<div class="paragraph">
<p>To confirm whether your Foreman&#160;server has internal or external databases, you can query the status of your databases:</p>
</div>
<div class="paragraph">
<p>For PostgreSQL, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service status --only postgresql</pre>
</div>
</div>
<div class="paragraph">
<p>To migrate from the default internal databases to external databases, you must complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#preparing-a-host-for-external-databases_admin">Preparing a Host for External Databases</a>.
Prepare a Red&#160;Hat Enterprise Linux 7 server to host the external databases.</p>
</li>
<li>
<p><a href="#installing-postgresql_admin">Installing PostgreSQL</a>.
Prepare PostgreSQL with databases for Foreman, Pulp and Candlepin with dedicated users owning them.</p>
</li>
<li>
<p><a href="#migrating-to-external-databases_admin">Migrating to External Databases</a>.
Edit the parameters of <code>foreman-installer</code> to point to the new databases, and run <code>foreman-installer</code>.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="postgresql-as-an-external-database-considerations_admin">3.1. PostgreSQL as an External Database Considerations</h3>
<div class="paragraph">
<p>Foreman, Katello, and Candlepin use the PostgreSQL database.
If you want to use PostgreSQL as an external database, the following information can help you decide if this option is right for your Foreman configuration.
Foreman supports PostgreSQL version 12.1.</p>
</div>
<div class="ulist">
<div class="title">Advantages of External PostgreSQL:</div>
<ul>
<li>
<p>Increase in free memory and free CPU on Foreman</p>
</li>
<li>
<p>Flexibility to set <code>shared_buffers</code> on the PostgreSQL database to a high number without the risk of interfering with other services on Foreman</p>
</li>
<li>
<p>Flexibility to tune the PostgreSQL server&#8217;s system without adversely affecting Foreman operations</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Disadvantages of External PostgreSQL</div>
<ul>
<li>
<p>Increase in deployment complexity that can make troubleshooting more difficult</p>
</li>
<li>
<p>The external PostgreSQL server is an additional system to patch and maintain</p>
</li>
<li>
<p>If either Foreman or the PostgreSQL database server suffers a hardware or storage failure, Foreman is not operational</p>
</li>
<li>
<p>If there is latency between the Foreman server and database server, performance can suffer</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="preparing-a-host-for-external-databases_admin">3.2. Preparing a Host for External Databases</h3>
<div class="paragraph">
<p>Install a freshly provisioned system with the latest Red&#160;Hat Enterprise Linux 7 server to host the external databases.</p>
</div>
<div class="paragraph">
<p>Subscriptions for Red&#160;Hat Software Collections and Red&#160;Hat Enterprise Linux do not provide the correct service level agreement for using Foreman with external databases.
You must also attach a Foreman subscription to the base operating system that you want to use for the external databases.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Red&#160;Hat Enterprise Linux 7 server must meet Foreman&#8217;s <a href="https://docs.theforeman.org/3.0/Installing_Server_on_Red_Hat/index-foreman-el.html#storage-requirements_foreman">Storage Requirements</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Use the instructions in <a href="https://docs.theforeman.org/3.0/Installing_Server_on_Red_Hat/index-foreman-el.html#attaching-satellite-infrastructure-subscription_foreman">Attaching the Foreman Infrastructure Subscription</a> to attach a Foreman subscription to your server.</p>
</li>
<li>
<p>Disable all repositories and enable only the following repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --disable '*'
# subscription-manager repos --enable=rhel-server-rhscl-7-rpms \
--enable=rhel-7-server-rpms --enable=rhel-server-7-satellite-6-beta-rpms</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="installing-postgresql_admin">3.3. Installing PostgreSQL</h3>
<div class="paragraph">
<p>You can install only the same version of PostgreSQL that is installed with the <code>foreman-installer</code> tool during an internal database installation.
You can install PostgreSQL using Red Hat Enterprise Linux Server 7 repositories or from an external source, as long as the version is supported.
Foreman supports PostgreSQL version 12.1.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To install PostgreSQL, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre># yum install rh-postgresql12-postgresql-server \
rh-postgresql12-syspaths \
rh-postgresql12-postgresql-evr</pre>
</div>
</div>
</li>
<li>
<p>To initialize PostgreSQL, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># postgresql-setup initdb</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>/var/opt/rh/rh-postgresql12/lib/pgsql/data/postgresql.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /var/opt/rh/rh-postgresql12/lib/pgsql/data/postgresql.conf</pre>
</div>
</div>
</li>
<li>
<p>Remove the <code>#</code> and edit to listen to inbound connections:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">listen_addresses = '*'</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>/var/opt/rh/rh-postgresql12/lib/pgsql/data/pg_hba.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /var/opt/rh/rh-postgresql12/lib/pgsql/data/pg_hba.conf</pre>
</div>
</div>
</li>
<li>
<p>Add the following line to the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  host  all   all   <em>Foreman_ip</em>/24   md5</pre>
</div>
</div>
</li>
<li>
<p>To start, and enable PostgreSQL service, enter the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start postgresql
# systemctl enable postgresql</pre>
</div>
</div>
</li>
<li>
<p>Open the <strong>postgresql</strong> port on the external PostgreSQL server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-service=postgresql
# firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>Switch to the <code>postgres</code> user and start the PostgreSQL client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ su - postgres -c psql</pre>
</div>
</div>
</li>
<li>
<p>Create three databases and dedicated roles: one for Foreman, one for Candlepin, and one for Pulp:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">CREATE USER "foreman" WITH PASSWORD '<em>Foreman_Password</em>';
CREATE USER "candlepin" WITH PASSWORD '<em>Candlepin_Password</em>';
CREATE USER "pulp" WITH PASSWORD '<em>Pulpcore_Password</em>';
CREATE DATABASE foreman OWNER foreman;
CREATE DATABASE candlepin OWNER candlepin;
CREATE DATABASE pulpcore OWNER pulp;</pre>
</div>
</div>
</li>
<li>
<p>Exit the <code>postgres</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># \q</pre>
</div>
</div>
</li>
<li>
<p>From Foreman&#160;server, test that you can access the database.
If the connection succeeds, the commands return <code>1</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># PGPASSWORD='<em>Foreman_Password</em>' psql -h <em>postgres.example.com</em>  -p 5432 -U foreman -d foreman -c "SELECT 1 as ping"
# PGPASSWORD='<em>Candlepin_Password</em>' psql -h <em>postgres.example.com</em> -p 5432 -U candlepin -d candlepin -c "SELECT 1 as ping"
# PGPASSWORD='<em>Pulpcore_Password</em>' psql -h <em>postgres.example.com</em> -p 5432 -U pulp -d pulpcore -c "SELECT 1 as ping"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="migrating-to-external-databases_admin">3.4. Migrating to External Databases</h3>
<div class="paragraph">
<p>Back up and transfer existing data, then use the <code>foreman-installer</code> command to configure Foreman to connect to an external PostgreSQL database server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed and configured a PostgreSQL server on a Red&#160;Hat Enterprise Linux server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, stop the <code>foreman-maintain</code> services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service stop</pre>
</div>
</div>
</li>
<li>
<p>Start the <strong>PostgreSQL</strong> services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start postgresql</pre>
</div>
</div>
</li>
<li>
<p>Back up the internal databases:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup online --skip-pulp-content --preserve-directory -y <em>/var/migration_backup</em></pre>
</div>
</div>
</li>
<li>
<p>Transfer the data to the new external databases:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">PGPASSWORD='<em>Foreman_Password</em>' pg_restore -h <em>postgres.example.com</em> -U foreman -d foreman &lt; <em>/var/migration_backup/foreman.dump</em>
PGPASSWORD='<em>Candlepin_Password</em>' pg_restore -h <em>postgres.example.com</em> -U candlepin -d candlepin &lt; <em>/var/migration_backup/candlepin.dump</em>
PGPASSWORD='<em>Pulpcore_Password</em>' pg_restore -h <em>postgres.example.com</em> -U pulp -d pulpcore &lt; <em>/var/migration_backup/pulpcore.dump</em></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>foreman-installer</code> command to update Foreman to point to the new databases:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-installer --scenario foreman \
    --foreman-db-host <em>postgres.example.com</em> \
    --foreman-db-password <em>Foreman_Password</em> \
    --foreman-db-database foreman \
    --foreman-db-manage false \
    --katello-candlepin-db-host <em>postgres.example.com</em> \
    --katello-candlepin-db-name candlepin \
    --katello-candlepin-db-password <em>Candlepin_Password</em> \
    --katello-candlepin-manage-db false \
    --foreman-proxy-content-pulpcore-manage-postgresql false \
    --foreman-proxy-content-pulpcore-postgresql-host <em>postgres.example.com</em> \
    --foreman-proxy-content-pulpcore-postgresql-db-name pulpcore \
    --foreman-proxy-content-pulpcore-postgresql-password <em>Pulpcore_Password</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-satellite-ansible-content-collections_admin">4. Managing Foreman with Ansible Collections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman Ansible Collections is a set of Ansible modules that interact with the Foreman API.
You can use Foreman Ansible Collections to manage and automate many aspects of Foreman.</p>
</div>
<div class="sect2">
<h3 id="installing-satellite-ansible-modules-via-rpm_admin">4.1. Installing the Foreman Ansible Modules from RPM</h3>
<div class="paragraph">
<p>Use this procedure to install the Foreman Ansible modules.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Install the RPM from the client repository on yum.theforeman.org using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install ansible-collection-theforeman-foreman</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="listing-using-satellite-ansible-modules_admin">4.2. Viewing the Foreman Ansible Modules</h3>
<div class="paragraph">
<p>Starting with Ansible 2.10, you can view the installed Foreman Ansible modules by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-doc -l theforeman.foreman</pre>
</div>
</div>
<div class="paragraph">
<p>When using Ansible before 2.10, you can view the installed Foreman Ansible modules by listing the content of the following directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ls /usr/share/ansible/collections/ansible_collections/theforeman/foreman/plugins/modules/</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can also see the complete list of Foreman Ansible modules and other related information at <a href="https://galaxy.ansible.com/theforeman/foreman" class="bare">https://galaxy.ansible.com/theforeman/foreman</a>.</p>
</div>
<div class="paragraph">
<p>All modules are in the <code>theforeman.foreman</code> namespace and can be referred to in the format <code>theforeman.foreman._module_name_</code>.
For example, to display information about the <code>activation_key</code> module, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ansible-doc theforeman.foreman.activation_key</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Administering-Users_and_Roles">5. Managing Users and Roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A User defines a set of details for individuals using the system.
Users can be associated with organizations and environments, so that when they create new entities, the default settings are automatically used.
Users can also have one or more <em>roles</em> attached, which grants them rights to view and manage organizations and environments.
See <a href="#user-management_admin">User Management</a> for more information on working with users.</p>
</div>
<div class="paragraph">
<p>You can manage permissions of several users at once by organizing them into user groups.
User groups themselves can be further grouped to create a hierarchy of permissions.
See <a href="#sect-Administering-Users_and_Roles-Creating_and_Managing_User_Groups">Creating and Managing User Groups</a> for more information on creating user groups.</p>
</div>
<div class="paragraph">
<p>Roles define a set of permissions and access levels.
Each role contains one on more <em>permission filters</em> that specify the actions allowed for the role.
Actions are grouped according to the <em>Resource type</em>.
Once a role has been created, users and user groups can be associated with that role.
This way, you can assign the same set of permissions to large groups of users.
Foreman provides a set of predefined roles and also enables creating custom roles and permission filters as described in <a href="#sect-Administering-Users_and_Roles-Creating_and_Managing_Roles">Creating and Managing Roles</a>.</p>
</div>
<div class="sect2">
<h3 id="user-management_admin">5.1. User Management</h3>
<div class="paragraph">
<p>As an administrator, you can create, modify and remove Foreman users.
You can also configure access permissions for a user or a group of users by assigning them different <em>roles</em>.</p>
</div>
<div class="sect3">
<h4 id="creating-a-user_admin">5.1.1. Creating a User</h4>
<div class="paragraph">
<p>Use this procedure to create a user.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-a-user_admin">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a user, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>Click <strong>Create User</strong>.</p>
</li>
<li>
<p>In the <strong>Login</strong> field, enter a username for the user.</p>
</li>
<li>
<p>In the <strong>Firstname</strong> and <strong>Lastname</strong> fields, enter the real first name and last name of the user.</p>
</li>
<li>
<p>In the <strong>Mail</strong> field, enter the user’s email address.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, add a description of the new user.</p>
</li>
<li>
<p>Select a specific language for the user from the <strong>Language</strong> list.</p>
</li>
<li>
<p>Select a timezone for the user from the <strong>Timezone</strong> list.</p>
<div class="paragraph">
<p>By default, Foreman&#160;server uses the language and timezone settings of the user’s browser.</p>
</div>
</li>
<li>
<p>Set a password for the user:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the <strong>Authorized by</strong> list, select the source by which the user is authenticated.</p>
<div class="ulist">
<ul>
<li>
<p><strong>INTERNAL</strong>: to enable the user to be managed inside Foreman&#160;server.</p>
</li>
<li>
<p><strong>EXTERNAL</strong>: to configure external authentication as described in <a href="#chap-Administering-Configuring_External_Authentication">Configuring External Authentication</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter an initial password for the user in the <strong>Password</strong> field and the <strong>Verify</strong> field.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to create the user.</p>
</li>
</ol>
</div>
<div id="cli-creating-a-user_admin" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a user, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user create \
--login <em>user_name</em> \
--password <em>user_password</em> \
--mail <em>user_mail</em> \
--auth-source-id 1 \
--organization-ids <em>org_ID1</em>,<em>org_ID2</em>...</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--auth-source-id 1</code> setting means that the user is authenticated internally, you can specify an external authentication source as an alternative.
Add the <code>--admin</code> option to grant administrator privileges to the user.
Specifying organization IDs is not required, you can modify the user details later using the <code>update</code> subcommand.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about user related subcommands, enter <code>hammer user --help</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="assigning-roles-to-a-user_admin">5.1.2. Assigning Roles to a User</h4>
<div class="paragraph">
<p>Use this procedure to assign roles to a user.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-assigning-roles-to-a-user_admin">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>Click the <strong>username</strong> of the user to be assigned one or more roles.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a user account is not listed, check that you are currently viewing the correct organization.
To list all the users in Foreman, click <strong>Default Organization</strong> and then <strong>Any Organization</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and select a location if none is assigned.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and check that an organization is assigned.</p>
</li>
<li>
<p>Click the <strong>Roles</strong> tab to display the list of available roles.</p>
</li>
<li>
<p>Select the roles to assign from the <strong>Roles</strong> list.</p>
<div class="paragraph">
<p>To grant all the available permissions, select the <strong>Admin</strong> check box.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To view the roles assigned to a user, click the <strong>Roles</strong> tab; the assigned roles are listed under <strong>Selected items</strong>.
To remove an assigned role, click the role name in <strong>Selected items</strong>.</p>
</div>
<div id="cli-assigning-roles-to-a-user_admin" class="paragraph">
<div class="title">CLI procedure</div>
<p>To assign roles to a user, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user add-role --id <em>user_id</em> --role <em>role_name</em></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="impersonating-a-different-user-account_admin">5.1.3. Impersonating a Different User Account</h4>
<div class="paragraph">
<p>Administrators can impersonate other authenticated users for testing and troubleshooting purposes by temporarily logging on to the Foreman web UI as a different user.
When impersonating another user, the administrator has permissions to access exactly what the impersonated user can access in the system, including the same menus.</p>
</div>
<div class="paragraph">
<p>Audits are created to record the actions that the administrator performs while impersonating another user.
However, all actions that an administrator performs while impersonating another user are recorded as having been performed by the impersonated user.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you are logged on to the Foreman web UI as a user with administrator privileges for Foreman.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To impersonate a different user account, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>To the right of the user that you want to impersonate, from the list in the <strong>Actions</strong> column, select <strong>Impersonate</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you want to stop the impersonation session, in the upper right of the main menu, click the impersonation icon.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ssh-keys_admin">5.2. SSH Key Management</h3>
<div class="paragraph">
<p>Adding SSH keys to a user allows deployment of SSH keys during provisioning.</p>
</div>
<div class="paragraph">
<p>For information on deploying SSH keys during provisioning, see <a href="https://docs.theforeman.org/3.0/Provisioning_Guide/index-foreman-el.html#Configuring_Provisioning_Resources-Creating_Provisioning_Templates-Deploying_SSH_Keys_during_Provisioning">Deploying SSH Keys during Provisioning</a> in the <em>Provisioning Guide</em>.</p>
</div>
<div class="paragraph">
<p>For information on SSH keys and SSH key creation, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-getting_started#sec-SSH">Using SSH-based Authentication</a> in the <em>Red&#160;Hat Enterprise Linux 7 System Administrator&#8217;s Guide</em>.</p>
</div>
<div class="sect3">
<h4 id="managing-ssh-keys-for-a-user_admin">5.2.1. Managing SSH Keys for a User</h4>
<div class="paragraph">
<p>Use this procedure to add or remove SSH keys for a user.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-managing-ssh-keys-for-a-user_admin">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Make sure that you are logged in to the web UI as an Admin user of Foreman or a user with the <em>create_ssh_key</em> permission enabled for adding SSH key and <em>destroy_ssh_key</em> permission for removing a key.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>From the <strong>Username</strong> column, click on the username of the required user.</p>
</li>
<li>
<p>Click on the <strong>SSH Keys</strong> tab.</p>
<div class="ulist">
<ul>
<li>
<p>To Add SSH key</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Prepare the content of the public SSH key in a clipboard.</p>
</li>
<li>
<p>Click <strong>Add SSH Key</strong>.</p>
</li>
<li>
<p>In the <strong>Key</strong> field, paste the public SSH key content from the clipboard.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the SSH key.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>To Remove SSH key</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Click <strong>Delete</strong> on the row of the SSH key to be deleted.</p>
</li>
<li>
<p>Click <strong>OK</strong> in the confirmation prompt.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="cli-managing-ssh-keys-for-a-user_admin" class="paragraph">
<div class="title">CLI procedure</div>
<p>To add an SSH key to a user, you must specify either the path to the public SSH key file, or the content of the public SSH key copied to the clipboard.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you have the public SSH key file, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user ssh-keys add \
--user-id <em>user_id</em> \
--name <em>key_name</em> \
--key-file <em>~/.ssh/id_rsa.pub</em></pre>
</div>
</div>
</li>
<li>
<p>If you have the content of the public SSH key, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user ssh-keys add \
--user-id <em>user_id</em> \
--name <em>key_name</em> \
--key <em>ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNtYAAABBBHHS2KmNyIYa27Qaa7EHp+2l99ucGStx4P77e03ZvE3yVRJEFikpoP3MJtYYfIe8k 1/46MTIZo9CPTX4CYUHeN8= host@user</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To delete an SSH key from a user, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user ssh-keys delete --id <em>key_id</em> --user-id <em>user_id</em></pre>
</div>
</div>
<div class="paragraph">
<p>To view an SSH key attached to a user, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user ssh-keys info --id <em>key_id</em> --user-id <em>user_id</em></pre>
</div>
</div>
<div class="paragraph">
<p>To list SSH keys attached to a user, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user ssh-keys list --user-id <em>user_id</em></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Users_and_Roles-Creating_and_Managing_User_Groups">5.3. Creating and Managing User Groups</h3>
<div class="sect3">
<h4 id="user-groups_admin">5.3.1. User Groups</h4>
<div class="paragraph">
<p>With Foreman, you can assign permissions to groups of users.
You can also create user groups as collections of other user groups.
If using an external authentication source, you can map Foreman user groups to external user groups as described in <a href="#sect-Administering-Creating_User_Groups-Configuring_External_User_Groups">Configuring External User Groups</a>.</p>
</div>
<div class="paragraph">
<p>User groups are defined in an organizational context, meaning that you must select an organization before you can access user groups.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-user-group_admin">5.3.2. Creating a User Group</h4>
<div class="paragraph">
<p>Use this procedure to create a user group.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>.</p>
</li>
<li>
<p>Click <strong>Create User group</strong>.</p>
</li>
<li>
<p>On the <strong>User Group</strong> tab, specify the name of the new user group and select group members:</p>
<div class="ulist">
<ul>
<li>
<p>Select the previously created user  groups from the <strong>User Groups</strong> list.</p>
</li>
<li>
<p>Select users from the <strong>Users</strong> list.</p>
</li>
</ul>
</div>
</li>
<li>
<p>On the <strong>Roles</strong> tab, select the roles you want to assign to the user group.
Alternatively, select the <strong>Admin</strong> check box to assign all available permissions.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a user group, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer user-group create \
--name <em>usergroup_name</em> \
--user-ids <em>user_ID1,user_ID2</em>... \
--role-ids <em>role_ID1,role_ID2</em>...</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="removing-a-user-group_admin">5.3.3. Removing a User Group</h4>
<div class="paragraph">
<p>Use the Foreman web UI to remove a user group.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>.</p>
</li>
<li>
<p>Click <strong>Delete</strong> to the right of the user group you want to delete.</p>
</li>
<li>
<p>In the alert box that appears, click <strong>OK</strong> to delete a user group.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Users_and_Roles-Creating_and_Managing_Roles">5.4. Creating and Managing Roles</h3>
<div class="paragraph">
<p>Foreman provides a set of predefined roles with permissions sufficient for standard tasks, as listed in <a href="#predefined-roles-available-in-satellite_admin">Predefined Roles Available in Foreman</a>.
It is also possible to configure custom roles, and assign one or more permission filters to them.
Permission filters define the actions allowed for a certain resource type.
Certain Foreman plug-ins create roles automatically.</p>
</div>
<div class="sect3">
<h4 id="creating-a-role_admin">5.4.1. Creating a Role</h4>
<div class="paragraph">
<p>Use this procedure to create a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Click <strong>Create Role</strong>.</p>
</li>
<li>
<p>Provide a <strong>Name</strong> for the role.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your new role.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">CLI procedure</div>
<p>To create a role, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer role create --name <em>role_name</em></pre>
</div>
</div>
<div class="paragraph">
<p>To serve its purpose, a role must contain permissions.
After creating a role, proceed to <a href="#adding-permissions-to-a-role_admin">Adding Permissions to a Role</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="cloning-a-role_admin">5.4.2. Cloning a Role</h4>
<div class="paragraph">
<p>Use the Foreman web UI to clone a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong> and select <strong>Clone</strong> from the drop-down menu to the right of the required role.</p>
</li>
<li>
<p>Provide a <strong>Name</strong> for the role.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to clone the role.</p>
</li>
<li>
<p>Click the name of the cloned role and navigate to <strong>Filters</strong>.</p>
</li>
<li>
<p>Edit the permissions as required.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your new role.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="adding-permissions-to-a-role_admin">5.4.3. Adding Permissions to a Role</h4>
<div class="paragraph">
<p>Use this procedure to add permissions to a role.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-permissions-to-a-role_admin">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Select <strong>Add Filter</strong> from the drop-down list to the right of the required role.</p>
</li>
<li>
<p>Select the <strong>Resource type</strong> from the drop-down list.
The <em>(Miscellaneous)</em> group gathers permissions that are not associated with any resource group.</p>
</li>
<li>
<p>Click the permissions you want to select from the <strong>Permission</strong> list.</p>
</li>
<li>
<p>Depending on the <strong>Resource type</strong> selected, you can select or deselect the <strong>Unlimited</strong> and <strong>Override</strong> check box.
The <strong>Unlimited</strong> check box is selected by default, which means that the permission is applied on all resources of the selected type.
When you disable the <strong>Unlimited</strong> check box, the <strong>Search</strong> field activates.
In this field you can specify further filtering with use of the Foreman search syntax.
See <a href="#sect-Administering-Users_and_Roles-Granular_Permission_Filtering">Granular Permission Filtering</a> for details.
When you enable the <strong>Override</strong> check box, you can add additional locations and organizations to allow the role to access the resource type in the additional locations and organizations; you can also remove an already associated location and organization from the resource type to restrict access.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save changes.</p>
</li>
</ol>
</div>
<div id="cli-adding-permissions-to-a-role_admin" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>List all available permissions:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer filter available-permissions</pre>
</div>
</div>
</li>
<li>
<p>Add permissions to a role:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer filter create \
--role <em>role_name</em> \
--permission-ids <em>perm_ID1</em>,<em>perm_ID2</em>...</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about roles and permissions parameters, enter the <code>hammer role --help</code> and <code>hammer filter --help</code> commands.</p>
</div>
</div>
<div class="sect3">
<h4 id="viewing-permissions-of-a-role_admin">5.4.4. Viewing Permissions of a Role</h4>
<div class="paragraph">
<p>Use the Foreman web UI to view the permissions of a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Click <strong>Filters</strong> to the right of the required role to get to the <strong>Filters</strong> page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>Filters</strong> page contains a table of permissions assigned to a role grouped by the resource type.
It is also possible to generate a complete table of permissions and actions that you can use on your Foreman system.
See <a href="#creating-a-complete-permission-table_admin">Creating a Complete Permission Table</a> for instructions.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-complete-permission-table_admin">5.4.5. Creating a Complete Permission Table</h4>
<div class="paragraph">
<p>Use the Foreman CLI to create a permission table.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the required packages are installed.
Execute the following command on Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install foreman-console</pre>
</div>
</div>
</li>
<li>
<p>Start the Foreman console with the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake console</pre>
</div>
</div>
<div class="paragraph">
<p>Insert the following code into the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">f = File.open('/tmp/table.html', 'w')

result = Foreman::AccessControl.permissions {|a,b| a.security_block &lt;=&gt; b.security_block}.collect do |p|
      actions = p.actions.collect { |a| "&lt;li&gt;#{a}&lt;/li&gt;" }
      "&lt;tr&gt;&lt;td&gt;#{p.name}&lt;/td&gt;&lt;td&gt;&lt;ul&gt;#{actions.join('')}&lt;/ul&gt;&lt;/td&gt;&lt;td&gt;#{p.resource_type}&lt;/td&gt;&lt;/tr&gt;"
end.join("\n")

f.write(result)</pre>
</div>
</div>
<div class="paragraph">
<p>The above syntax creates a table of permissions and saves it to the <code>/tmp/table.html</code> file.</p>
</div>
</li>
<li>
<p>Press <code><strong>Ctrl</strong></code> + <code><strong>D</strong></code> to exit the Foreman console.
Insert the following text at the first line of <code>/tmp/table.html</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;table border="1"&gt;&lt;tr&gt;&lt;td&gt;Permission name&lt;/td&gt;&lt;td&gt;Actions&lt;/td&gt;&lt;td&gt;Resource type&lt;/td&gt;&lt;/tr&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Append the following text at the end of <code>/tmp/table.html</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;/table&gt;</pre>
</div>
</div>
</li>
<li>
<p>Open <code>/tmp/table.html</code> in a web browser to view the table.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="removing-a-role_admin">5.4.6. Removing a Role</h4>
<div class="paragraph">
<p>Use the Foreman web UI to remove a role.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Select <strong>Delete</strong> from the drop-down list to the right of the role to be deleted.</p>
</li>
<li>
<p>In an alert box that appears, click <strong>OK</strong> to delete the role.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="predefined-roles-available-in-satellite_admin">5.4.7. Predefined Roles Available in Foreman</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Permissions Provided by Role footnote:[The exact set of allowed actions associated with predefined roles can be viewed by the privileged user as described in
<a href="#viewing-permissions-of-a-role_admin">]</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Insights Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add and edit Insights rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Insights Viewer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View Insight reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ansible Roles Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Play roles on hosts and host groups.
View, destroy, and import Ansible roles.
View, edit, create, destroy, and import Ansible variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ansible Tower Inventory Reader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View facts, hosts, and host groups.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bookmarks manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create, edit, and delete bookmarks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boot disk access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Download the boot disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compliance manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View, create, edit, and destroy SCAP content files, compliance policies, and tailoring files.
View compliance reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compliance viewer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View compliance reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create ARF report</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create compliance reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The set of permissions that every user is granted, irrespective of any other roles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View, provision, edit, and destroy discovered hosts and manage discovery rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery Reader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View hosts and discovery rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View, create, edit, destroy, and build hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit partition tables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View, create, edit and destroy partition tables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role similar to administrator, but does not have permissions to edit global settings.
In the Foreman web UI, global settings can be found under <strong>Administer</strong> &gt; <strong>Settings</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An administrator role defined per organization.
The role has no visibility into resources in other organizations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red&#160;Hat Access Logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the log viewer and the logs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote Execution Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role with full remote execution permissions, including modifying job templates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote Execution User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run remote execution jobs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A restrained version of the Manager role.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System admin</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Edit global settings in <strong>Administer</strong> &gt; <strong>Settings</strong></p>
</li>
<li>
<p>View, create, edit and destroy users, user groups, and roles.</p>
</li>
<li>
<p>View, create, edit, destroy, and assign organizations and locations but not view resources within them.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users with this role can create users and assign all roles to them.
Therefore, ensure to give this role only to trusted users.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tasks manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View and edit Foreman tasks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tasks reader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role that can only view Foreman tasks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Viewer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A passive role that provides the ability to view the configuration of every element of the Foreman structure, logs, reports, and statistics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role that can only view hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virt-who Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role with full virt-who permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virt-who Reporter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upload reports generated by virt-who to Foreman.
It can be used if you configure virt-who manually and require a user role that has limited virt-who permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virt-who Viewer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View virt-who configurations.
Users with this role can deploy virt-who instances using existing virt-who configurations.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Users_and_Roles-Granular_Permission_Filtering">5.5. Granular Permission Filtering</h3>
<div class="sect3">
<h4 id="granular-permission-filter_admin">5.5.1. Granular Permission Filter</h4>
<div class="paragraph">
<p>As mentioned in <a href="#adding-permissions-to-a-role_admin">Adding Permissions to a Role</a>, Foreman provides the ability to limit the configured user permissions to selected instances of a resource type.
These granular filters are queries to the Foreman database and are supported by the majority of resource types.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-granular-permission-filter_admin">5.5.2. Creating a Granular Permission Filter</h4>
<div class="paragraph">
<p>Use this procedure to create a granular filter.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-a-granular-permission-filter_admin">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<p>Foreman does not apply search conditions to create actions.
For example, limiting the <em>create_locations</em> action with <em>name = "Default Location"</em> expression in the search field does not prevent the user from assigning a custom name to the newly created location.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Specify a query in the <strong>Search</strong> field on the <strong>Edit Filter</strong> page.
Deselect the <strong>Unlimited</strong> check box for the field to be active.
Queries have the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>field_name</em> <em>operator</em> <em>value</em></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>field_name</em> marks the field to be queried.
The range of available field names depends on the resource type.
For example, the <em>Partition Table</em> resource type offers <em>family</em>, <em>layout</em>, and <em>name</em> as query parameters.</p>
</li>
<li>
<p><em>operator</em> specifies the type of comparison between <em>field_name</em> and <em>value</em>.
See <a href="#supported-operators-for-granular-search_admin">Supported Operators for Granular Search</a> for an overview of applicable operators.</p>
</li>
<li>
<p><em>value</em> is the value used for filtering.
This can be for example a name of an organization.
Two types of wildcard characters are supported: underscore (_) provides single character replacement, while percent sign (%) replaces zero or more characters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For most resource types, the <strong>Search</strong> field provides a drop-down list suggesting the available parameters.
This list appears after placing the cursor in the search field.
For many resource types, you can combine queries using logical operators such as <em>and</em>, <em>not</em> and <em>has</em> operators.</p>
</div>
<div id="cli-creating-a-granular-permission-filter_admin" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a granular filter, enter the <code>hammer filter create</code> command with the <code>--search</code> option to limit permission filters, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer filter create \
--permission-ids 91 \
--search "name ~ ccv*" \
--role qa-user</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command adds to the <strong>qa-user</strong> role a permission to view, create, edit, and destroy Content Views that only applies to Content Views with name starting with <code>ccv</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_examples_of_using_granular_permission_filters">5.5.3. Examples of Using Granular Permission Filters</h4>
<div class="paragraph">
<p>As an administrator, you can allow selected users to make changes in a certain part of the environment path.
The following filter allows you to work with content while it is in the development stage of the application life cycle, but the content becomes inaccessible once is pushed to production.</p>
</div>
<div class="sect4">
<h5 id="applying-permissions-for-the-host-resource-type_admin">Applying Permissions for the Host Resource Type</h5>
<div class="paragraph">
<p>The following query applies any permissions specified for the Host resource type only to hosts in the group named host-editors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">hostgroup = host-editors</pre>
</div>
</div>
<div class="paragraph">
<p>The following query returns records where the name matches <em>XXXX</em>, <em>Yyyy</em>, or <em>zzzz</em> example strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">name ^ (XXXX, Yyyy, zzzz)</pre>
</div>
</div>
<div class="paragraph">
<p>You can also limit permissions to a selected environment.
To do so, specify the environment name in the <strong>Search</strong> field, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Dev</pre>
</div>
</div>
<div class="paragraph">
<p>You can limit user permissions to a certain organization or location with the use of the granular permission filter in the <strong>Search</strong> field.
However, some resource types provide a GUI alternative, an <strong>Override</strong> check box that provides the <strong>Locations</strong> and <strong>Organizations</strong> tabs.
On these tabs, you can select from the list of available organizations and locations.
See <a href="#creating-an-organization-specific-manager-role_admin">Creating an Organization Specific Manager Role</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-an-organization-specific-manager-role_admin">Creating an Organization Specific Manager Role</h5>
<div class="paragraph">
<p>Use the Foreman UI to create an administrative role restricted to a single organization named <em>org-1</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Clone the existing <strong>Organization admin</strong> role.
Select <strong>Clone</strong> from the drop-down list next to the <strong>Filters</strong> button.
You are then prompted to insert a name for the cloned role, for example <em>org-1 admin</em>.</p>
</li>
<li>
<p>Click the desired locations and organizations to associate them with the role.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to create the role.</p>
</li>
<li>
<p>Click <em>org-1 admin</em>, and click <strong>Filters</strong> to view all associated filters.
The default filters work for most use cases.
However, you can optionally click <strong>Edit</strong> to change the properties for each filter.
For some filters, you can enable the <strong>Override</strong> option if you want the role to be able to access resources in additional locations and organizations.
For example, by selecting the <strong>Domain</strong> resource type, the <strong>Override</strong> option, and then additional locations and organizations using the <strong>Locations</strong> and <strong>Organizations</strong> tabs, you allow this role to access domains in the additional locations and organizations that is not associated with this role.
You can also click <strong>New filter</strong> to associate new filters with this role.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="supported-operators-for-granular-search_admin">5.5.4. Supported Operators for Granular Search</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Logical Operators</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">and</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines search criteria.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">not</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negates an expression.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">has</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object must have a specified property.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Symbolic Operators</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Is equal to</em>.
An equality comparison that is case-sensitive for text fields.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Is not equal to</em>.
An inversion of the = operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">~</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Like</em>.
A case-insensitive occurrence search for text fields.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!~</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Not like</em>.
An inversion of the ~ operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>In</em>.
An equality comparison that is case-sensitive search for text fields.
This generates a different SQL query to the <em>Is equal to</em> comparison, and is more efficient for multiple value comparison.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Not in</em>.
An inversion of the ^ operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;, &gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Greater than</em>, <em>greater than or equal to</em>.
Supported for numerical fields only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;, &#8656;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Less than</em>, <em>less than or equal to</em>.
Supported for numerical fields only.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-email-notifications_admin">6. Configuring Email Notifications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure Foreman to send email messages to individual users registered to Foreman. Foreman sends the email to the email address that has been added to the account, if present. Users can edit the email address by clicking on their name in the top-right of the Foreman web UI and selecting <strong>My account</strong>.</p>
</div>
<div class="paragraph">
<p>Configure email notifications for a user from the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>Click the <strong>Username</strong> of the user you want to edit.</p>
</li>
<li>
<p>On the <strong>User</strong> tab, verify the value of the <strong>Mail</strong> field.
Email notifications will be sent to the address in this field.</p>
</li>
<li>
<p>On the <strong>Email Preferences</strong> tab, select <strong>Mail Enabled</strong>.</p>
</li>
<li>
<p>Select the notifications you want the user to receive using the drop-down menus next to the notification types.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>Audit Summary</strong> notification can be filtered by entering the required query in the <strong>Mail Query</strong> text box.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
<div class="paragraph">
<p>The user will start receiving the notification emails.</p>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="testing-email-delivery_admin">6.1. Testing Email Delivery</h3>
<div class="paragraph">
<p>To verify the delivery of emails, send a test email to a user.
If the email gets delivered, the settings are correct.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Users</strong>.</p>
</li>
<li>
<p>Click on the username.</p>
</li>
<li>
<p>On the <strong>Email Preferences</strong> tab, click <strong>Test email</strong>.</p>
<div class="paragraph">
<p>A test email message is sent immediately to the user&#8217;s email address.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the email is delivered, the verification is complete.
Otherwise, you must perform the following diagnostic steps:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Verify the user&#8217;s email address.</p>
</li>
<li>
<p>Verify Foreman&#160;server&#8217;s email configuration.</p>
</li>
<li>
<p>Examine firewall and mail server logs.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="testing-email-notifications_admin">6.2. Testing Email Notifications</h3>
<div class="paragraph">
<p>To verify that users are correctly subscribed to notifications, trigger the notifications manually.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To trigger the notifications, execute the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake reports:&lt;<em>frequency</em>&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>frequency</em> with one of the following:</p>
</div>
</li>
<li>
<p>daily</p>
</li>
<li>
<p>weekly</p>
</li>
<li>
<p>monthly</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This triggers all notifications scheduled for the specified frequency for all the subscribed users.
If every subscribed user receives the notifications, the verification succeeds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Sending manually triggered notifications to individual users is currently not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="notification-types_admin">6.3. Notification Types</h3>
<div class="paragraph">
<p>The following are the notifications created by Foreman:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Audit summary</strong>: A summary of all activity audited by Foreman&#160;server.</p>
</li>
<li>
<p><strong>Host built</strong>: A notification sent when a host is built.</p>
</li>
<li>
<p><strong>Host errata advisory</strong>: A summary of applicable and installable errata for hosts managed by the user.</p>
</li>
<li>
<p><strong>OpenSCAP policy summary</strong>: A summary of OpenSCAP policy reports and their results.</p>
</li>
<li>
<p><strong>Promote errata</strong>: A notification sent only after a Content View promotion.
It contains a summary of errata applicable and installable to hosts registered to the promoted Content View.
This allows a user to monitor what updates have been applied to which hosts.</p>
</li>
<li>
<p><strong>Puppet error state</strong>: A notification sent after a host reports an error related to Puppet.</p>
</li>
<li>
<p><strong>Puppet summary</strong>: A summary of Puppet reports.</p>
</li>
<li>
<p><strong>Sync errata</strong>: A notification sent only after synchronizing a repository.
It contains a summary of new errata introduced by the synchronization.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="changing-email-notifications-for-a-host_admin">6.4. Changing email notification settings for a host</h3>
<div class="paragraph">
<p>Foreman can send event notifications for a host to the host’s registered owner.</p>
</div>
<div class="paragraph">
<p>You can configure Foreman to send email notifications either to an individual user or a user group. When set to a user group, all group members who are subscribed to the email type receive a message.</p>
</div>
<div class="paragraph">
<p>To view the notification status for a host, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and click the host you want to view.
In the host details page, click the <strong>Additional Information</strong> tab, you can view the email notification status.</p>
</div>
<div class="paragraph">
<p>Receiving email notifications for a host can be useful, but also overwhelming if you are expecting to receive frequent errors, for example, because of a known issue or error you are working around.</p>
</div>
<div class="paragraph">
<p>To change the email notification settings for a host, complete the following steps.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>, and select the host with the notification setting you want to change.</p>
</li>
<li>
<p>Select the host&#8217;s check box, and from the <strong>Select Action</strong> list, select <strong>Enable Notifications</strong> or <strong>Disable Notifications</strong>, depending on what you want.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Administering-Security_Compliance_Management">7. Managing Security Compliance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security compliance management is the ongoing process of defining security policies, auditing for compliance with those policies and resolving instances of non-compliance.
Any non-compliance is managed according to the organization&#8217;s configuration management policies.
Security policies range in scope from host-specific to industry-wide, therefore, flexibility in their definition is required.</p>
</div>
<div class="sect2">
<h3 id="security-content-automation-protocol_admin">7.1. Security Content Automation Protocol</h3>
<div class="paragraph">
<p>Foreman uses the Security Content Automation Protocol (SCAP) to define security configuration policies.
For example, a security policy might specify that for hosts running Red&#160;Hat Enterprise&#160;Linux, login via SSH is not permitted for the <code>root</code> account.
With Foreman you can schedule compliance auditing and reporting on all hosts under management.
For more information about SCAP, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/security_guide/">Red Hat Enterprise Linux 7 Security Guide</a>.</p>
</div>
<div class="sect3">
<h4 id="scap-content_admin">7.1.1. SCAP Content</h4>
<div class="paragraph">
<p>SCAP content is a datastream format containing the configuration and security baseline against which hosts are checked.
Checklists are described in the extensible checklist configuration description format (XCCDF) and vulnerabilities in the open vulnerability and assessment language (OVAL).
Checklist items, also known as rules express the desired configuration of a system item.
For example, you may specify that no one can log in to a host over SSH using the <code>root</code> user account.
Rules can be grouped into one or more profiles, allowing multiple profiles to share a rule.
SCAP content consists of both rules and profiles.</p>
</div>
<div class="paragraph">
<p>You can either create SCAP content or obtain it from a vendor.
Supported profiles are provided for Red&#160;Hat Enterprise&#160;Linux in the scap-security-guide package.
The creation of SCAP content is outside the scope of this guide, but see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/security_guide/">Red Hat Enterprise Linux 7 Security Guide</a> for information on how to download, deploy, modify, and create your own content.</p>
</div>
<div class="paragraph">
<p>The default SCAP content provided with the OpenSCAP components of Foreman depends on the version of Red&#160;Hat Enterprise&#160;Linux.
On Red&#160;Hat Enterprise&#160;Linux&#160;7, content for both Red&#160;Hat Enterprise&#160;Linux&#160;6 and Red&#160;Hat Enterprise&#160;Linux&#160;7 is installed.</p>
</div>
</div>
<div class="sect3">
<h4 id="xccdf-profile_admin">7.1.2. XCCDF Profile</h4>
<div class="paragraph">
<p>An XCCDF profile is a checklist against which a host or host group is evaluated.
Profiles are created to verify compliance with an industry standard or custom standard.</p>
</div>
<div class="paragraph">
<p>The profiles provided with Foreman are obtained from the <a href="https://www.open-scap.org/">OpenSCAP project</a>.</p>
</div>
<div class="sect4">
<h5 id="listing-available-xccdf-profiles_admin">Listing Available XCCDF Profiles</h5>
<div class="paragraph">
<p>In the Foreman UI, list the available XCCD profiles.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>SCAP contents</strong>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Security_Compliance_Management_with_OpenSCAP-Configuring_SCAP_Content">7.2. Configuring SCAP Content</h3>
<div class="sect3">
<h4 id="importing-openscap-puppet-modules_admin">7.2.1. Importing OpenSCAP Puppet Modules</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you do not use Puppet to configure OpenSCAP auditing on hosts, you can skip this procedure.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To audit hosts with OpenSCAP, you must first import a Puppet environment.
The Puppet environment contains the Puppet classes you must assign to each host to deploy the OpenSCAP configuration.</p>
</div>
<div class="paragraph">
<p>You must associate each host that you want to audit with the Puppet environment in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Environments</strong>.</p>
</li>
<li>
<p>Click <strong>Import environments from <em>foreman.example.com</em></strong>.</p>
</li>
<li>
<p>Select the Puppet environment check box associated with the host you want to audit.</p>
<div class="paragraph">
<p>If no Puppet environment exists, select the <strong>production</strong> environment check box.
The Puppet classes that you require for OpenSCAP are in the <strong>production</strong> environment by default.</p>
</div>
</li>
<li>
<p>Click <strong>Update</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="loading-the-default-openscap-content">7.2.2. Loading the Default OpenSCAP Content</h4>
<div class="paragraph">
<p>In the CLI, load the default OpenScap content.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use the <code>foreman-rake</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake foreman_openscap:bulk_upload:default</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="extra-scap-content_admin">7.2.3. Extra SCAP Content</h4>
<div class="paragraph">
<p>You can upload extra SCAP content into Foreman&#160;server, either content created by yourself or obtained elsewhere.
SCAP content must be imported into Foreman&#160;server before being applied in a policy.
For example, the <code>scap-security-guide</code> RPM package available in the Red&#160;Hat Enterprise&#160;Linux&#160;7.2 repositories includes a profile for the Payment Card Industry Data Security Standard (PCI-DSS) version 3.
You can upload this content into a Foreman&#160;server even if it is not running Red&#160;Hat Enterprise&#160;Linux&#160;7.2 as the content is not specific to an operating system version.</p>
</div>
<div class="sect4">
<h5 id="uploading-extra-scap-content_admin">Uploading Extra SCAP Content</h5>
<div class="paragraph">
<p>In the Foreman web UI, upload the extra SCAP content.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>SCAP contents</strong> and click <strong>New SCAP Content</strong>.</p>
</li>
<li>
<p>Enter a title in the <strong>Title</strong> text box.</p>
<div class="paragraph">
<p>Example: <code><strong>RHEL 7.2 SCAP Content</strong></code>.</p>
</div>
</li>
<li>
<p>Click <strong>Choose file</strong>, navigate to the location containing the SCAP content file and select <strong>Open</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the SCAP content file is loaded successfully, a message similar to <code>Successfully created RHEL 7.2 SCAP Content</code> is shown and the list of <strong>SCAP Contents</strong> includes the new title.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Security_Compliance_Management_with_OpenSCAP-Managing_Compliance_Policies">7.3. Managing Compliance Policies</h3>
<div class="sect3">
<h4 id="compliance-policy_admin">7.3.1. Compliance Policy</h4>
<div class="paragraph">
<p>A scheduled audit, also known as a <em>compliance policy</em>, is a scheduled task that checks the specified hosts for compliance against an XCCDF profile.
The schedule for scans is specified by Foreman&#160;server and the scans are performed on the host.
When a scan completes, an <em>Asset Reporting File</em> (ARF) is generated in XML format and uploaded to Foreman&#160;server.
You can see the results of the scan in the compliance policy dashboard.
No changes are made to the scanned host by the compliance policy.
The SCAP content includes several profiles with associated rules but policies are not included by default.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-complicance-policy_admin">7.3.2. Creating a Compliance Policy</h4>
<div class="paragraph">
<p>With Foreman, you can create a compliance policy to scan your content hosts to ensure that the hosts remain compliant to your security requirements.</p>
</div>
<div class="paragraph">
<p>You can use either Puppet or Ansible to deploy the compliance policy to your hosts.
Note that Puppet runs by default every 30 minutes.
If you assign a new policy, the next Puppet run synchronizes the policy to the host.
However Ansible does not perform scheduled runs.
To add a new policy, you must run Ansible role manually or using remote execution.
For more information about remote execution, see <a href="https://docs.theforeman.org/3.0/Managing_Hosts/index-foreman-el.html#configuring-and-setting-up-remote-jobs_managing-hosts">Configuring and Setting up Remote Jobs</a> in the <em>Managing Hosts</em> guide.</p>
</div>
<div id="form-Red_Hat_Satellite-Host_Configuration_Guide-Compliance_Policy-Creating_a_Policy-Prerequisites" class="paragraph">
<div class="title">Prerequisites</div>
<p>Before you begin, you must decide whether you want to use a Puppet or Ansible deployment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Puppet deployment, ensure that each host that you want to audit is associated with a Puppet environment.
For more information, see <a href="#importing-openscap-puppet-modules_admin">Importing OpenSCAP Puppet Modules</a>.</p>
</li>
<li>
<p>For Ansible deployment, ensure that you import the <code>theforeman.foreman_scap_client</code> Ansible role.
For more information about importing Ansible roles, see <a href="https://docs.theforeman.org/3.0/Configuring_Ansible/index-foreman-el.html#getting-started-with-ansible_ansible">Getting Started with Ansible in Foreman</a> in <em>Configuring Foreman to use Ansible</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>, and select whether you want a manual, Ansible, or Puppet deployment.</p>
</li>
<li>
<p>Enter a name for this policy, a description (optional), then click <strong>Next</strong>.</p>
</li>
<li>
<p>Select the SCAP Content and XCCDF Profile to be applied, then click <strong>Next</strong>.</p>
<div class="paragraph">
<p>Note that the openSCAP plugin does not detect if a SCAP content role has no content, which means that the <code>Default XCCDF Profile</code> might return an empty report.</p>
</div>
</li>
<li>
<p>Specify the scheduled time when the policy is to be applied, then click <strong>Next</strong>.</p>
<div class="paragraph">
<p>Select <strong>Weekly</strong>, <strong>Monthly</strong>, or <strong>Custom</strong> from the <strong>Period</strong> list.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you select <strong>Weekly</strong>, also select the desired day of the week from the <strong>Weekday</strong> list.</p>
</li>
<li>
<p>If you select <strong>Monthly</strong>, also specify the desired day of the month in the <strong>Day of month</strong> field.</p>
</li>
<li>
<p>If you select <strong>Custom</strong>, enter a valid Cron expression in the <strong>Cron line</strong> field.</p>
<div class="paragraph">
<p>The <strong>Custom</strong> option allows for greater flexibility in the policy&#8217;s schedule than either the <strong>Weekly</strong> or <strong>Monthly</strong> options.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Select the locations to which the policy is to be applied, then click <strong>Next</strong>.</p>
</li>
<li>
<p>Select the organizations to which the policy is to be applied, then click <strong>Next</strong>.</p>
</li>
<li>
<p>Select the host groups to which the policy is to be applied, then click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the Puppet agent runs on the hosts which belong to the selected host group, or hosts to which the policy has been applied, the OpenSCAP client will be installed and a Cron job added with the policy&#8217;s specified schedule.
The <code>SCAP Content</code> tab provides the name of the SCAP content file which will be distributed to the directory <code>/var/lib/openscap/content/</code> on all target hosts.</p>
</div>
</div>
<div class="sect3">
<h4 id="viewing-a-compliance-policy_admin">7.3.3. Viewing a Compliance Policy</h4>
<div class="paragraph">
<p>You can preview the rules which will be applied by specific OpenSCAP content and profile combination.
This is useful when planning policies.</p>
</div>
<div class="paragraph">
<p>In the Foreman web UI, view the compliance policy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>.</p>
</li>
<li>
<p>Click <strong>Show Guide</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="editing-a-compliance-policy_admin">7.3.4. Editing a Compliance Policy</h4>
<div class="paragraph">
<p>In the Foreman web UI, edit the compliance policy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>.</p>
</li>
<li>
<p>From the drop-down list to the right of the policy&#8217;s name, select <strong>Edit</strong>.</p>
</li>
<li>
<p>Edit the necessary attributes.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An edited policy is applied to the host when its Puppet agent next checks with Foreman&#160;server for updates.
By default this occurs every 30 minutes.</p>
</div>
</div>
<div class="sect3">
<h4 id="deleting-a-compliance-policy_admin">7.3.5. Deleting a Compliance Policy</h4>
<div class="paragraph">
<p>In the Foreman web UI, delete an existing policy.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>.</p>
</li>
<li>
<p>From the drop-down list to the right of the policy&#8217;s name, select <strong>Delete</strong>.</p>
</li>
<li>
<p>Click <strong>OK</strong> in the confirmation message.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tailoring-files_admin">7.4. Tailoring Files</h3>
<div class="paragraph">
<p>Tailoring Files allow existing OpenSCAP policies to be customized without forking or rewriting the policy.
You can assign a Tailoring File to a policy when creating or updating a policy.</p>
</div>
<div class="paragraph">
<p>You can create a Tailoring File using the <a href="https://www.open-scap.org/tools/scap-workbench/">SCAP Workbench</a>.
For more information on using the SCAP Workbench tool, see <a href="https://www.open-scap.org/resources/documentation/customizing-scap-security-guide-for-your-use-case/">Customizing SCAP Security Guide for your use-case</a>.</p>
</div>
<div class="sect3">
<h4 id="uplodaing-a-tailoring-file_admin">7.4.1. Uploading a Tailoring File</h4>
<div class="paragraph">
<p>In the Foreman web UI, upload a Tailoring file.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Compliance - Tailoring Files</strong> and click <strong>New Tailoring File</strong>.</p>
</li>
<li>
<p>Enter a name in the <strong>Name</strong> text box.</p>
</li>
<li>
<p>Click <strong>Choose File</strong>, navigate to the location containing the SCAP DataStream Tailoring File and select <strong>Open</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to upload the chosen Tailoring File.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="assigning-a-tailoring-file-to-a-policy_admin">7.4.2. Assigning a Tailoring File to a Policy</h4>
<div class="paragraph">
<p>In the Foreman web UI, assign a Tailoring file to a policy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Compliance - Policies</strong>.</p>
</li>
<li>
<p>Click <strong>New Policy</strong>, or <strong>New Compliance Policy</strong> if there are existing Compliance Policies.</p>
</li>
<li>
<p>Enter a name in the <strong>Name</strong> text box, and click <strong>Next</strong>.</p>
</li>
<li>
<p>Select a <strong>Scap content</strong> from the dropdown menu.</p>
</li>
<li>
<p>Select a <strong>XCCDF Profile</strong> from the dropdown menu.</p>
</li>
<li>
<p>Select a <strong>Tailoring File</strong> from the dropdown menu.</p>
</li>
<li>
<p>Select a <strong>XCCDF Profile in Tailoring File</strong> from the dropdown menu.</p>
<div class="paragraph">
<p>It is important to select the XCCDF Profile because Tailoring Files are able to contain multiple XCCDF Profiles.</p>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Select a <strong>Period</strong> from the dropdown menu.</p>
</li>
<li>
<p>Select a <strong>Weekday</strong> from the dropdown menu, and click <strong>Next</strong>.</p>
</li>
<li>
<p>Select a <strong>Location</strong> to move it to the <strong>Selected Items</strong> window, and click <strong>Next</strong>.</p>
</li>
<li>
<p>Select an <strong>Organization</strong> to move it to the <strong>Selected Items</strong> window, and click <strong>Next</strong>.</p>
</li>
<li>
<p>Select a <strong>Hostgroup</strong> to move it to the <strong>Selected Items</strong> window, and click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-host-group-for-openscap_admin">7.5. Configuring a host group for OpenSCAP</h3>
<div class="paragraph">
<p>Use this procedure to configure all the OpenSCAP requirements for a host group.</p>
</div>
<div class="paragraph">
<div class="title">OpenSCAP Setup Overview</div>
<p>You must complete the following tasks on Foreman&#160;server to assign the necessary components for a host group:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable OpenSCAP on Smart&#160;Proxy.
For more information, see <a href="https://docs.theforeman.org/3.0/Installing_Proxy_on_Red_Hat/index-foreman-el.html#enabling-openscap_smart-proxy">Enabling OpenSCAP on External Smart&#160;Proxies</a> in the <em>Installing Smart&#160;Proxy&#160;server</em> guide.</p>
</li>
<li>
<p>Assign an OpenSCAP Smart&#160;Proxy.</p>
</li>
<li>
<p>Assign a Puppet environment that contains the Puppet classes to deploy the OpenSCAP policies.</p>
</li>
<li>
<p>Assign the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>Assign any compliance policies that you want to add.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about creating and administering hosts, see the <a href="https://docs.theforeman.org/3.0/Managing_Hosts/index-foreman-el.html#">Managing Hosts</a> guide.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>, and either create a host group or click the host group that you want to configure for OpenSCAP reporting.</p>
</li>
<li>
<p>From the <strong>Puppet Environment</strong> list, select the Puppet environment that contains the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>From the <strong>OpenSCAP Smart&#160;Proxy</strong> list, select the Smart&#160;Proxy with OpenSCAP enabled that you want to use.</p>
</li>
<li>
<p>Click the <strong>Puppet Classes</strong> tab, and add the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>.</p>
</li>
<li>
<p>Select the policy that you want to assign to the host group.</p>
</li>
<li>
<p>Click the <strong>Host Groups</strong> tab.</p>
</li>
<li>
<p>From the <strong>Host Groups</strong> list, select as many host groups as you want to assign to this policy.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-host-for-openscap_admin">7.6. Configuring a host for OpenSCAP</h3>
<div class="paragraph">
<p>Use this procedure to configure all the OpenSCAP requirements for a host.</p>
</div>
<div class="paragraph">
<div class="title">OpenSCAP Setup Overview</div>
<p>You must complete the following tasks on Foreman&#160;server to assign the necessary components for a host:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable OpenSCAP on Smart&#160;Proxy.
For more information, see <a href="https://docs.theforeman.org/3.0/Installing_Proxy_on_Red_Hat/index-foreman-el.html#enabling-openscap_smart-proxy">Enabling OpenSCAP on External Smart&#160;Proxies</a> in the <em>Installing Smart&#160;Proxy&#160;server</em> guide.</p>
</li>
<li>
<p>Assign an OpenSCAP Smart&#160;Proxy.</p>
</li>
<li>
<p>Assign a Puppet environment that contains the Puppet classes to deploy the OpenSCAP policies.</p>
</li>
<li>
<p>Assign the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>Assign any compliance policies that you want to add.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about creating and administering hosts, see the <a href="https://docs.theforeman.org/3.0/Managing_Hosts/index-foreman-el.html#">Managing Hosts</a> guide.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>, and select <strong>Edit</strong> on the host you want to configure for OpenSCAP reporting.</p>
</li>
<li>
<p>From the <strong>Puppet Environment</strong> list, select the Puppet environment that contains the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>From the <strong>OpenSCAP Smart&#160;Proxy</strong> list, select the Smart&#160;Proxy with OpenSCAP enabled that you want to use.</p>
</li>
<li>
<p>Click the <strong>Puppet Classes</strong> tab, and add the <code>foreman_scap_client</code> and <code>foreman_scap_client::params</code> Puppet classes.</p>
</li>
<li>
<p>To add a compliance policy, navigate to one of the following locations:</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</li>
<li>
<p>Select the host or hosts to which you want to add the policy.</p>
</li>
<li>
<p>Click <strong>Select Action</strong>.</p>
</li>
<li>
<p>Select <strong>Assign Compliance Policy</strong> from the list.</p>
</li>
<li>
<p>In the Policy window, select the policy that you want from the list of available policies and click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="monitoring-compliance_admin">7.7. Monitoring Compliance</h3>
<div class="paragraph">
<p>Foreman enables centralized compliance monitoring and management.
A compliance dashboard provides an overview of compliance of hosts and the ability to view details for each host within the scope of that policy.
Compliance reports provide a detailed analysis of compliance of each host with the applicable policy.
With this information, you can evaluate the risks presented by each host and manage the resources required to bring hosts into compliance.</p>
</div>
<div class="paragraph">
<p>Common objectives when monitoring compliance using SCAP include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Verifying policy compliance.</p>
</li>
<li>
<p>Detecting changes in compliance.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="compliance-policy-dashboard_admin">7.7.1. Compliance Policy Dashboard</h4>
<div class="paragraph">
<p>The compliance policy dashboard provides a statistical summary of compliance of hosts and the ability to view details for each host within the scope of that policy.
For all hosts which were evaluated as non-compliant, the <code>Failed</code> statistic provides a useful metric for prioritizing compliance effort.
The hosts detected as <code>Never audited</code> should also be a priority, since their status is unknown.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/compliance_policy_dashboard.png" alt="Compliance Policy Dashboard">
</div>
</div>
</div>
<div class="sect3">
<h4 id="viewing-the-complience-policy-dashboard_admin">7.7.2. Viewing the Compliance Policy Dashboard</h4>
<div class="paragraph">
<p>Use the Foreman web UI to verify policy compliance with the compliance policy dashboard.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Policies</strong>.</p>
</li>
<li>
<p>Click the required policy name.
The dashboard provides the following information:</p>
<div class="ulist">
<ul>
<li>
<p>A ring chart illustrating a high-level view of compliance of hosts with the policy.</p>
</li>
<li>
<p>A statistical breakdown of compliance of hosts with the policy, in a tabular format.</p>
</li>
<li>
<p>Links to the latest policy report for each host.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="compliance-email-notifications_admin">7.7.3. Compliance Email Notifications</h4>
<div class="paragraph">
<p>Foreman&#160;server sends an OpenSCAP Summary email to all users who subscribe to the <strong>Openscap policy summary</strong> email notifications.
For more information on subscribing to email notifications, see <a href="#configuring-email-notifications_admin">Configuring Email Notifications</a>.
Each time a policy is run, Foreman checks the results against the previous run, noting any changes between them.
The email is sent according to the frequency requested by each subscriber, providing a summary of each policy and its most recent result.</p>
</div>
<div class="paragraph">
<p>An <strong>OpenSCAP Summary</strong> email message contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Details of the time period it covers.</p>
</li>
<li>
<p>Totals for all hosts by status: changed, compliant, and noncompliant.</p>
</li>
<li>
<p>A tabular breakdown of each host and the result of its latest policy, including totals of the rules that passed, failed, changed, or where results were unknown.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="compliance-report_admin">7.7.4. Compliance Report</h4>
<div class="paragraph">
<p>A compliance report is the output of a policy run against a host.
Each report includes the total number of rules passed or failed per policy.
By default, reports are listed in descending date order.</p>
</div>
<div class="paragraph">
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Reports</strong> to list all compliance reports.</p>
</div>
<div class="paragraph">
<p>A compliance report consists of the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Introduction</p>
</li>
<li>
<p>Evaluation Characteristics</p>
</li>
<li>
<p>Compliance and Scoring</p>
</li>
<li>
<p>Rule Overview</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Evaluation Characteristics</div>
<p>The Evaluation Characteristics area provides details about an evaluation against a specific profile, including the host that was evaluated, the profile used in the evaluation, and when the evaluation started and finished.
For reference, the IPv4, IPv6, and MAC addresses of the host are also listed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 18.75%;">
<col style="width: 37.5%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target machine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully-qualified domain name (FQDN) of the evaluated host.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-system.example.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benchmark URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL of the SCAP content against which the host was evaluated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/lib/openscap/content/1fbdc87d24db51ca184419a2b6f</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benchmark ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the benchmark against which the host was evaluated.
A benchmark is a set of profiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xccdf_org.ssgproject.content_benchmark_RHEL_7</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the profile against which the host was evaluated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xccdf_org.ssgproject_content_profile_rht-ccp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Started at</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date and time at which the evaluation started, in ISO 8601 format.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2015-09-12T14:40:02</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finished at</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date and time at which the evaluation finished, in ISO 8601 format.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2015-09-12T14:40:05</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performed by</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The local account name under which the evaluation was performed on the host.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>root</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Compliance and Scoring</div>
<p>The Compliance and Scoring area provides an overview of whether or not the host is in compliance with the profile rules, a breakdown of compliance failures by severity, and an overall compliance score as a percentage.
If compliance with a rule was not checked, this is categorized in the <strong>Rule results</strong> field as <strong>Other</strong>.</p>
</div>
<div class="paragraph">
<div class="title">Rule Overview</div>
<p>The Rule Overview area provides details about every rule and the compliance result, with the rules presented in a hierarchical layout.</p>
</div>
<div class="paragraph">
<p>Select or clear the check boxes to narrow the list of rules included in the compliance report.
For example, if the focus of your review is any non-compliance, clear the <strong>pass</strong> and <strong>informational</strong> check boxes.</p>
</div>
<div class="paragraph">
<p>To search all rules, enter a criterion in the <strong>Search</strong> field.
The search is dynamically applied as you type.
The <strong>Search</strong> field only accepts a single plain-text search term and it is applied as a case-insensitive search.
When you perform a search, only those rules whose descriptions match the search criterion will be listed.
To remove the search filter, delete the search criterion.</p>
</div>
<div class="paragraph">
<p>For an explanation of each result, hover the cursor over the status shown in the <strong>Result</strong> column.</p>
</div>
</div>
<div class="sect3">
<h4 id="examining-rule-results_admin">7.7.5. Examining Compliance Failure of Hosts</h4>
<div class="paragraph">
<p>Use the Foreman web UI to determine why a host failed compliance on a rule.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Reports</strong> to list all compliance reports.</p>
</li>
<li>
<p>Click <strong>View Report</strong> in the row of the specific host to view the details of an individual report.</p>
</li>
<li>
<p>Click on the rule&#8217;s title to see further details:</p>
<div class="ulist">
<ul>
<li>
<p>A description of the rule with instructions for bringing the host into compliance if available.</p>
</li>
<li>
<p>The rationale for the rule.</p>
</li>
<li>
<p>In some cases, a remediation script.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Do not implement any of the recommended remedial actions or scripts without first testing them in a non-production environment.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="searching-compliance-reports_admin">7.7.6. Searching Compliance Reports</h4>
<div class="paragraph">
<p>Use the Compliance Reports search field to filter the list of available reports on any given subset of hosts.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To apply a filter, enter the search query in the <strong>Search</strong> field and click <strong>Search</strong>.
The search query is case insensitive.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Search Use Cases</div>
<ul>
<li>
<p>The following search query finds all compliance reports for which more than five rules failed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">failed &gt; 5</pre>
</div>
</div>
</li>
<li>
<p>The following search query finds all compliance reports created after January 1, <em>YYYY</em>, for hosts with host names that contain the <code>prod-</code> group of characters:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">host ~ prod- AND date &gt; "Jan 1, <em>YYYY</em>"</pre>
</div>
</div>
</li>
<li>
<p>The following search query finds all reports generated by the <code>rhel7_audit</code> compliance policy from an hour ago:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">"1 hour ago" AND compliance_policy = date = "1 hour ago" AND compliance_policy = rhel7_audit</pre>
</div>
</div>
</li>
<li>
<p>The following search query finds reports that pass an XCCDF rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">xccdf_rule_passed = xccdf_org.ssgproject.content_rule_firefox_preferences-auto-download_actions</pre>
</div>
</div>
</li>
<li>
<p>The following search query finds reports that fail an XCCDF rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">xccdf_rule_failed = xccdf_org.ssgproject.content_rule_firefox_preferences-auto-download_actions</pre>
</div>
</div>
</li>
<li>
<p>The following search query finds reports that have a result different than fail or pass for an XCCDF rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">xccdf_rule_othered = xccdf_org.ssgproject.content_rule_firefox_preferences-auto-download_actions</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional Information</div>
<ul>
<li>
<p>To see a list of available search parameters, click the empty <strong>Search</strong> field.</p>
</li>
<li>
<p>You can create complex queries with the following logical operators: <code>and</code>, <code>not</code> and <code>has</code>.
For more information about logical operators, see <a href="#supported-operators-for-granular-search_admin">Supported Operators for Granular Search</a>.</p>
</li>
<li>
<p>You cannot use regular expressions in a search query.
However, you can use multiple fields in a single search expression.
For more information about all available search operators, see <a href="#supported-operators-for-granular-search_admin">Supported Operators for Granular Search</a>.</p>
</li>
<li>
<p>You can bookmark a search to reuse the same search query.
For more information, see <a href="#sect-Administering-Searching_and_Bookmarking-Creating_Bookmarks">Creating Bookmarks</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="deleting-a-compliance-reportadmin">7.7.7. Deleting a Compliance Report</h4>
<div class="paragraph">
<p>To delete a compliance report, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Reports</strong>.</p>
</li>
<li>
<p>In the Compliance Reports window, identify the policy that you want to delete and, on the right of the policy&#8217;s name, select <strong>Delete</strong>.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deleting-multiple-compliance-reportsadmin">7.7.8. Deleting Multiple Compliance Reports</h4>
<div class="paragraph">
<p>You can delete multiple compliance policies simultaneously.
However, in the Foreman web UI, compliance policies are paginated, so you must delete one page of reports at a time.
If you want to delete all OpenSCAP reports, use the script in the <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.10-beta/html/api_guide/chap-red_hat_satellite-api_guide-using_the_red_hat_satellite_api#sect-API_Guide-Deleting-OpenSCAP-Reports">Deleting OpenSCAP Reports</a> section of the <em>Foreman API Guide</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Reports</strong>.</p>
</li>
<li>
<p>In the Compliance Reports window, select the compliance reports that you want to delete.</p>
</li>
<li>
<p>In the upper right of the list, select <strong>Delete reports</strong>.</p>
</li>
<li>
<p>Repeat these steps for as many pages as you want to delete.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Specifications_Supported_OpenSCAP">7.8. Specifications Supported by OpenSCAP</h3>
<div class="paragraph">
<p>The following specifications are supported by OpenSCAP:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Title</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XCCDF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Extensible Configuration Checklist Description Format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open Vulnerability and Assessment Language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asset Identification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asset Reporting Format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CCE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Configuration Enumeration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Platform Enumeration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CVE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Vulnerabilities and Exposures</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CVSS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Vulnerability Scoring System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backing-up-satellite-server-and-capsule-server">8. Backing Up Foreman&#160;server and Smart&#160;Proxy&#160;server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can back up your Foreman deployment to ensure the continuity of your Foreman deployment and associated data in the event of a disaster.
If your deployment uses custom configurations, you must consider how to handle these custom configurations when you plan your backup and disaster recovery policy.</p>
</div>
<div class="paragraph">
<p>To create a backup of your Foreman&#160;server or Smart&#160;Proxy&#160;server and all associated data, use the <code>foreman-maintain backup</code> command.
Backing up to a separate storage device on a separate system is highly recommended.</p>
</div>
<div class="paragraph">
<p>Foreman services are unavailable during the backup.
Therefore, you must ensure that no other tasks are scheduled by other administrators.
You can schedule a backup using <code>cron</code>.
For more information, see the <a href="#example-of-a-weekly-full-backup-followed-by-daily-incremental-backups_admin">Example of a Weekly Full Backup Followed by Daily Incremental Backups</a>.</p>
</div>
<div class="paragraph">
<p>During offline or snapshot backups, the services are inactive and Foreman is in a maintenance mode.
All the traffic from outside on port 443 is rejected by a firewall to ensure there are no modifications triggered.</p>
</div>
<div class="paragraph">
<p>A backup contains sensitive information from the <code>/root/ssl-build</code> directory.
For example, it can contain hostnames, ssh keys, request files and SSL certificates.
You must encrypt or move the backup to a secure location to minimize the risk of damage or unauthorized access to the hosts.</p>
</div>
<div class="paragraph">
<div class="title">Conventional Backup Methods</div>
<p>You can also use conventional backup methods.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/part-system_backup_and_recovery">System Backup and Recovery</a> in the <em>Red&#160;Hat Enterprise&#160;Linux&#160;7 System Administrator&#8217;s Guide</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you plan to use the <code>foreman-maintain backup</code> command to create a backup, do not stop the <code>foreman-maintain</code> services.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>When creating a snapshot or conventional backup, you must stop all services as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service stop</pre>
</div>
</div>
</li>
<li>
<p>Start the services after creating a snapshot or conventional backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service start</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="estimating-the-size-of-a-backup_admin">8.1. Estimating the Size of a Backup</h3>
<div class="paragraph">
<p>Note that estimations in this section are for the installations that use the Katello plug-in.</p>
</div>
<div class="paragraph">
<p>The full backup creates uncompressed archives of PostgreSQL and Pulp database files, and Foreman configuration files.
Compression occurs after the archives are created to decrease the time when Foreman services are unavailable.</p>
</div>
<div class="paragraph">
<p>A full backup requires space to store the following data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uncompressed Foreman database and configuration files</p>
</li>
<li>
<p>Compressed Foreman database and configuration files</p>
</li>
<li>
<p>An extra 20% of the total estimated space to ensure a reliable backup</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the <code>du</code> command to estimate the size of uncompressed directories containing Foreman database and configuration files:</p>
<div class="listingblock">
<div class="content">
<pre># du -sh /var/opt/rh/rh-postgresql12/lib/pgsql/data /var/lib/pulp
100G  /var/opt/rh/rh-postgresql12/lib/pgsql/data
100G	/var/lib/pulp
# du -csh /var/lib/qpidd /var/lib/tftpboot /etc /root/ssl-build \
/var/www/html/pub /opt/puppetlabs
886M  /var/lib/qpidd
16M   /var/lib/tftpboot
37M   /etc
900K	/root/ssl-build
100K	/var/www/html/pub
2M	  /opt/puppetlabs
942M  total</pre>
</div>
</div>
</li>
<li>
<p>Calculate how much space is required to store the compressed data.</p>
<div class="paragraph">
<p>The following table describes the compression ratio of all data items included in the backup:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Backup Data Compression Ratio</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 27.7779%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Data type</th>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Ratio</th>
<th class="tableblock halign-left valign-top">Example results</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgreSQL database files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/opt/rh/rh-postgresql12/lib/pgsql/data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 - 85%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 GB &#8594; 20 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pulp RPM files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/lib/pulp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(not compressed)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration files</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>/var/lib/qpidd</code><br>
<code>/var/lib/tftpboot</code><br>
<code>/etc</code><br>
<code>/root/ssl-build</code><br>
<code>/var/www/html/pub</code><br>
<code>/opt/puppetlabs</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">85%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">942 MB &#8594; 141 MB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this example, the compressed backup data occupies 180 GB in total.</p>
</div>
</li>
<li>
<p>To calculate the amount of available space you require to store a backup, calculate the sum of the estimated values of compressed and uncompressed backup data, and add an extra 20% to ensure a reliable backup.</p>
<div class="paragraph">
<p>This example requires 681 GB plus 180 GB for the uncompressed and compressed backup data, 861 GB in total.
With 172 GB of extra space, 1033 GB must be allocated for the backup location.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="performing-a-full-backup-of-satellite-or-capsule_admin">8.2. Performing a Full Backup of Foreman&#160;server or Smart&#160;Proxy&#160;server</h3>
<div class="paragraph">
<p>Foreman uses the <code>foreman-maintain backup</code> command to make backups.</p>
</div>
<div class="paragraph">
<p>There are three main methods of backing up Foreman&#160;server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Offline backup</p>
</li>
<li>
<p>Online backup</p>
</li>
<li>
<p>Snapshot backups</p>
<div class="paragraph">
<p>For more information about each of these methods, you can view the usage statements for each backup method.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For offline backups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline --help</pre>
</div>
</div>
<div class="paragraph">
<p>For online backups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup online --help</pre>
</div>
</div>
<div class="paragraph">
<p>For snapshots backups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup snapshot --help</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Directory creation</div>
<p>The <code>foreman-maintain backup</code> command creates a time-stamped subdirectory in the backup directory that you specify.
The <code>foreman-maintain backup</code> command does not overwrite backups, therefore you must select the correct directory or subdirectory when restoring from a backup or an incremental backup.
The <code>foreman-maintain backup</code> command stops and restarts services as required.</p>
</div>
<div class="paragraph">
<p>When you run the <code>foreman-maintain backup offline</code> command, the following default backup directories are created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>foreman-backup</code> on Foreman</p>
</li>
<li>
<p><code>foreman-proxy-backup</code> on Smart&#160;Proxy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to set a custom directory name, add the  <code>--preserve-directory</code> option and add a directory name.
The backup is then stored in the directory you provide in the command line.
If you use the <code>--preserve-directory</code> option, no data is removed if the backup fails.</p>
</div>
<div class="paragraph">
<p>Note that if you use a local PgSQL database, the <code>postgres</code> user requires write access to the backup directory.</p>
</div>
<div class="paragraph">
<div class="title">Remote databases</div>
<p>You can use the <code>foreman-maintain backup</code> command to back up remote databases.</p>
</div>
<div class="paragraph">
<p>You can use both online and offline methods to back up remote databases, but if you use offline methods, such as snapshot, the <code>foreman-maintain backup</code> command performs a database dump.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your backup location has sufficient available disk space to store the backup.
For more information, see <a href="#estimating-the-size-of-a-backup_admin">Estimating the Size of a Backup</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To perform a full offline backup of Foreman&#160;server or Smart&#160;Proxy&#160;server, complete one of the following steps:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Request other users of Foreman&#160;server or Smart&#160;Proxy&#160;server to save any changes and warn them that Foreman services are unavailable for the duration of the backup.
Ensure no other tasks are scheduled for the same time as the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>On Foreman&#160;server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline <em>/var/foreman-backup</em></pre>
</div>
</div>
</li>
<li>
<p>On Smart&#160;Proxy&#160;server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline <em>/var/foreman-proxy-backup</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="performing-a-backup-without-pulp-content_admin">8.3. Performing a Backup without Pulp Content</h3>
<div class="paragraph">
<p>You can perform an offline backup that excludes the contents of the Pulp directory.
The backup without Pulp content is useful for debugging purposes and is only intended to provide access to configuration files without backing up the Pulp database.
You cannot restore from a directory that does not contain Pulp content.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Request other users of Foreman&#160;server or Smart&#160;Proxy&#160;server to save any changes and warn them that Foreman services are unavailable for the duration of the backup.
Ensure no other tasks are scheduled for the same time as the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your backup location has sufficient available disk space to store the backup.
For more information, see <a href="#estimating-the-size-of-a-backup_admin">Estimating the Size of a Backup</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To perform an offline backup without Pulp content, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline --skip-pulp-content <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="performing-an-incremental-backup_admin">8.4. Performing an Incremental Backup</h3>
<div class="paragraph">
<p>Use this procedure to perform an offline backup of any changes since a previous backup.</p>
</div>
<div class="paragraph">
<p>To perform incremental backups, you must perform a full backup as a reference to create the first incremental backup of a sequence.
Keep the most recent full backup and a complete sequence of incremental backups to restore from.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Request other users of Foreman&#160;server or Smart&#160;Proxy&#160;server to save any changes and warn them that Foreman services are unavailable for the duration of the backup.
Ensure no other tasks are scheduled for the same time as the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your backup location has sufficient available disk space to store the backup.
For more information, see <a href="#estimating-the-size-of-a-backup_admin">Estimating the Size of a Backup</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To perform a full offline backup, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline  <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
<li>
<p>To create a directory within your backup directory to store the first incremental back up, enter the <code>foreman-maintain backup</code> command with the <code>--incremental</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline --incremental <em>/var/backup_directory/full_backup</em>  <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
<li>
<p>To create the second incremental backup, enter the <code>foreman-maintain backup</code> command with the <code>--incremental</code> option and include the path to the first incremental backup to indicate the starting point for the next increment.
This creates a directory for the second incremental backup in your backup directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline --incremental <em>/var/backup_directory/first_incremental_backup</em>  <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
<li>
<p>Optional: If you want to point to a different version of the backup, and make a series of increments with that version of the backup as the starting point, you can do this at any time.
For example, if you want to make a new incremental backup from the full backup rather than the first or second incremental backup, point to the full backup directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup offline --incremental <em>/var/backup_directory/full_backup</em>  <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="example-of-a-weekly-full-backup-followed-by-daily-incremental-backups_admin">8.5. Example of a Weekly Full Backup Followed by Daily Incremental Backups</h3>
<div class="paragraph">
<p>The following script performs a full backup on a Sunday followed by incremental backups for each of the following days.
A new subdirectory is created for each day that an incremental backup is performed.
The script requires a daily cron job.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#!/bin/bash -e
PATH=/sbin:/bin:/usr/sbin:/usr/bin
DESTINATION=/var/backup_directory
if [[ $(date +%w) == 0 ]]; then
  foreman-maintain backup offline --assumeyes $DESTINATION
else
  LAST=$(ls -td -- $DESTINATION/*/ | head -n 1)
  foreman-maintain backup offline --assumeyes --incremental "$LAST" $DESTINATION
fi
exit 0</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>foreman-maintain backup</code> command requires <code>/sbin</code> and <code>/usr/sbin</code> directories to be in <code>PATH</code> and the <code>--assumeyes</code> option is used to skip the confirmation prompt.</p>
</div>
</div>
<div class="sect2">
<h3 id="performing-an-online-backup_admin">8.6. Performing an Online Backup</h3>
<div class="paragraph">
<p>Perform an online backup only for debugging purposes.</p>
</div>
<div class="paragraph">
<div class="title">Risks Associated with Online Backups</div>
<p>When performing an online backup, if there are procedures affecting the Pulp database, the Pulp part of the backup procedure repeats until it is no longer being altered.
Because the backup of the Pulp database is the most time consuming part of backing up Foreman, if you make a change that alters the Pulp database during this time, the backup procedure keeps restarting.</p>
</div>
<div class="paragraph">
<p>For production environments, use the snapshot method.
For more information, see <a href="#performing-a-snapshot-backup_admin">Performing a Snapshot Backup</a>.
If you want to use the online backup method in production, proceed with caution and ensure that no modifications occur during the backup.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Request other users of Foreman&#160;server or Smart&#160;Proxy&#160;server to save any changes and warn them that Foreman services are unavailable for the duration of the backup.
Ensure no other tasks are scheduled for the same time as the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your backup location has sufficient available disk space to store the backup.
For more information, see <a href="#estimating-the-size-of-a-backup_admin">Estimating the Size of a Backup</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To perform an online backup, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup online <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="performing-a-snapshot-backup_admin">8.7. Performing a Snapshot Backup</h3>
<div class="paragraph">
<p>You can perform a snapshot backup that uses Logical Volume Manager (LVM) snapshots of the Pulp, and PostgreSQL directories.
Creating a backup from LVM snapshots mitigates the risk of an inconsistent backup.</p>
</div>
<div class="paragraph">
<p>The snapshot backup method is faster than a full offline backup and therefore reduces Foreman downtime.</p>
</div>
<div class="paragraph">
<p>To view the usage statement, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-maintain backup snapshot -h</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Request other Foreman&#160;server or Smart&#160;Proxy&#160;server users to save any changes and warn them that Foreman services are unavailable for the duration of the backup.
Ensure no other tasks are scheduled for the same time as the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before you perform the snapshot backup, ensure that the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The system uses LVM for the directories that you snapshot: <code>/var/lib/pulp/</code>, and <code>/var/opt/rh/rh-postgresql12/lib/pgsql</code>.</p>
</li>
<li>
<p>The free disk space in the relevant volume group (VG) is three times the size of the snapshot.
More precisely, the VG must have enough space unreserved by the member logical volumes (LVs) to accommodate new snapshots.
In addition, one of the LVs must have enough free space for the backup directory.</p>
</li>
<li>
<p>The target backup directory is on a different LV than the directories that you snapshot.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To perform a snapshot backup, enter the <code>foreman-maintain backup snapshot</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup snapshot <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>foreman-maintain backup snapshot</code> command creates snapshots when the services are active, and stops all services which can impact the backup.
This makes the maintenance window shorter.
After the successful snapshot, all services are restarted and LVM snapshots are removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="white-listing-and-skipping-steps-when-performing-backups_admin">8.8. White-listing and Skipping Steps When Performing Backups</h3>
<div class="paragraph">
<p>A backup using the <code>foreman-maintain backup</code> command proceeds in a sequence of steps.
To skip part of the backup add the <code>--whitelist</code> option to the command and add the step label that you want to omit.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To display a list of available step labels, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain advanced procedure run -h</pre>
</div>
</div>
</li>
<li>
<p>To skip a step of the backup, enter the <code>foreman-maintain backup</code> command with the <code>--whitelist</code> option.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain backup online --whitelist backup-metadata  -y <em>/var/backup_directory</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect-Administering-Backup_and_Disaster_Recovery-Restoring_Satellite_Server_or_Capsule_Server_from_a_Backup">9. Restoring Foreman&#160;server or Smart&#160;Proxy&#160;server from a Backup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can restore Foreman Server or Red&#160;Hat Smart&#160;Proxy&#160;server from the backup data that you create as part of <a href="#backing-up-satellite-server-and-capsule-server">Backing Up Foreman&#160;server and Smart&#160;Proxy&#160;server</a>.
This process outlines how to restore the backup on the same server that generated the backup, and all data covered by the backup is deleted on the target system.
If the original system is unavailable, provision a system with the same configuration settings and host name.</p>
</div>
<div class="sect2">
<h3 id="restoring-from-a-full-backup_admin">9.1. Restoring from a Full Backup</h3>
<div class="paragraph">
<p>Use this procedure to restore Foreman or Smart&#160;Proxy&#160;server from a full backup.
When the restore process completes, all processes are online, and all databases and system configuration revert to the state at the time of the backup.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you are restoring to the correct instance.
The Foreman instance must have the same host name, configuration, and be the same minor version (X.Y) as the original system.</p>
</li>
<li>
<p>Ensure that you have an existing target directory.
The target directory is read from the configuration files contained within the archive.</p>
</li>
<li>
<p>Ensure that you have enough space to store this data on the base system of Foreman&#160;server or Smart&#160;Proxy&#160;server as well as enough space after the restoration to contain all the data in the <code>/etc/</code> and <code>/var/</code> directories contained within the backup.</p>
<div class="paragraph">
<p>To check the space used by a directory, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># du -sh <em>/var/backup_directory</em></pre>
</div>
</div>
<div class="paragraph">
<p>To check for free space, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># df -h <em>/var/backup_directory</em></pre>
</div>
</div>
<div class="paragraph">
<p>Add the <code>--total</code> option to get a total of the results from more than one directory.</p>
</div>
</li>
<li>
<p>Ensure that all SELinux contexts are correct.
Enter the following command to restore the correct SELinux contexts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -Rnv /</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Choose the appropriate method to install Foreman or Smart&#160;Proxy:</p>
<div class="ulist">
<ul>
<li>
<p>To install Foreman&#160;server from a connected network, follow the procedures in <a href="https://docs.theforeman.org/3.0/Installing_Server_on_Red_Hat/index-foreman-el.html#">Installing Foreman&#160;server from a Connected Network</a>.</p>
</li>
<li>
<p>To install a Smart&#160;Proxy&#160;server, follow the procedures in the <a href="https://docs.theforeman.org/3.0/Installing_Proxy_on_Red_Hat/index-foreman-el.html#">Installing Smart&#160;Proxy&#160;server</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Copy the backup data to Foreman&#160;server’s local file system.
Use <code>/var/</code> or <code>/var/tmp/</code>.</p>
</li>
<li>
<p>Run the restoration script.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain restore <em>/var/backup_directory</em></pre>
</div>
</div>
<div class="paragraph">
<p>Where <em>backup_directory</em> is the time-stamped directory or subdirectory containing the backed-up data.</p>
</div>
<div class="paragraph">
<p>The restore process can take a long time to complete, because of the amount of data to copy.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional Resources</div>
<ul>
<li>
<p>For troubleshooting, you can check <code>/var/log/foreman/production.log</code> and <code>/var/log/messages</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="restoring-from-incremental-backups_admin">9.2. Restoring from Incremental Backups</h3>
<div class="paragraph">
<p>Use this procedure to restore Foreman or Smart&#160;Proxy&#160;server from incremental backups.
If you have multiple branches of incremental backups, select your full backup and each incremental backup for the “branch” you want to restore, in chronological order.</p>
</div>
<div class="paragraph">
<p>When the restore process completes, all processes are online, and all databases and system configuration revert to the state at the time of the backup.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Restore the last full backup using the instructions in <a href="#restoring-from-a-full-backup_admin">Restoring from a Full Backup</a>.</p>
</li>
<li>
<p>Remove the full backup data from Foreman&#160;server’s local file system, for example, <code>/var/</code> or <code>/var/tmp/</code>.</p>
</li>
<li>
<p>Copy the incremental backup data to Foreman&#160;server’s local file system, for example, <code>/var/</code> or <code>/var/tmp/</code>.</p>
</li>
<li>
<p>Restore the incremental backups in the same sequence that they are made:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain restore -i <em>/var/backup_directory</em>/FIRST_INCREMENTAL
# foreman-maintain restore -i <em>/var/backup_directory</em>/SECOND_INCREMENTAL</pre>
</div>
</div>
<div class="paragraph">
<p>If you created the backup using the <code>foreman-maintain backup</code> command, you do not need to use <code>-i</code> option in the command.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional Resources</div>
<ul>
<li>
<p>For troubleshooting, you can check <code>/var/log/foreman/production.log</code> and <code>/var/log/messages</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="backup-and-restore-capsule-server-using-a-virtual-machine-snapshot_admin">9.3. Backup and Restore Smart&#160;Proxy&#160;server Using a Virtual Machine Snapshot</h3>
<div class="paragraph">
<p>If your Smart&#160;Proxy&#160;server is a virtual machine, you can restore it from a snapshot.
Creating weekly snapshots to restore from is recommended.
In the event of failure, you can install, or configure a new Smart&#160;Proxy&#160;server, and then synchronize the database content from Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>If required, deploy a new Smart&#160;Proxy&#160;server, ensuring the host name is the same as before, and then install the Smart&#160;Proxy certificates.
You may still have them on Foreman&#160;server, the package name ends in -certs.tar, alternately create new ones.
Follow the procedures in <a href="https://docs.theforeman.org/3.0/Installing_Proxy_on_Red_Hat/index-foreman-el.html#">Installing Smart&#160;Proxy&#160;server</a> until you can confirm, in the Foreman web UI, that Smart&#160;Proxy&#160;server is connected to Foreman&#160;server.
Then use the procedure <a href="#synchronizing-an-external-capsule_admin">Synchronizing an External Smart&#160;Proxy</a> to synchronize from Foreman.</p>
</div>
<div class="sect3">
<h4 id="synchronizing-an-external-capsule_admin">9.3.1. Synchronizing an External Smart&#160;Proxy</h4>
<div class="paragraph">
<p>Synchronize an external Smart&#160;Proxy with Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To synchronize an external Smart&#160;Proxy, select the relevant organization and location in the Foreman web UI, or choose <strong>Any Organization</strong> and <strong>Any Location</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong> and click the name of the Smart&#160;Proxy to synchronize.</p>
</li>
<li>
<p>On the <strong>Overview</strong> tab, select <strong>Synchronize</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect-Administering-Renaming_a_Server">10. Renaming Foreman&#160;server or Smart&#160;Proxy&#160;server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To rename Foreman&#160;server or Smart&#160;Proxy&#160;server, you must use the <code>katello-change-hostname</code> script.</p>
</div>
<div class="paragraph">
<p>If you rename Foreman&#160;server, you must reregister all Foreman clients and configure each Smart&#160;Proxy&#160;server to point them to the new Foreman host name.
If you use custom SSL certificates, you must regenerate them with the new host name.
If you use virt-who, you must update the virt-who configuration files with the new host name.</p>
</div>
<div class="paragraph">
<p>If you rename Smart&#160;Proxy&#160;server, you must reregister all Smart&#160;Proxy clients and update the Smart&#160;Proxy host name in the Foreman web UI.
If you use custom SSL certificates, you must regenerate them with the new host name.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>The renaming process shuts down all Foreman&#160;server services on the host being renamed.
When the renaming is complete, all services are restarted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="sect-Administering-Renaming_a_Satellite_Server">10.1. Renaming Foreman&#160;server</h3>
<div class="paragraph">
<p>The host name of Foreman&#160;server is used by Foreman&#160;server components, all Smart&#160;Proxy&#160;servers, and hosts registered to it for communication.
This procedure ensures that you update all references to the new host name.</p>
</div>
<div class="paragraph">
<p>If you use external authentication, you must reconfigure Foreman&#160;server for external authentication after you run the <code>katello-change-hostname</code> script.
The <code>katello-change-hostname</code> script breaks external authentication for Foreman&#160;server.
For more information about configuring external authentication, see <a href="#chap-Administering-Configuring_External_Authentication">Configuring External Authentication</a>.</p>
</div>
<div class="paragraph">
<p>If you use virt-who, you must update the virt-who configuration files with the new host name after you run the <code>katello-change-hostname</code> script.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.10-beta/html/configuring_virtual_machine_subscriptions_in_red_hat_satellite/troubleshooting-virt-who#modifying-virt-who-configuration_vm-subs-satellite">Modifying a virt-who Configuration</a> in <em>Configuring Virtual Machine Subscriptions in Foreman</em>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Both the <code>hostname</code> and <code>hostname -f</code> commands must return the FQDN of Foreman&#160;server or the <code>katello-change-hostname</code> script will fail to complete.
If the <code>hostname</code> command returns the shortname of Foreman&#160;server instead of the FQDN, use <code>hostnamectl set-hostname <em>old_fqdn</em></code> to set the old FQDN correctly before attempting to use the <code>katello-change-hostname</code> script.</p>
</li>
<li>
<p>Perform a backup of Foreman&#160;server before changing a host name.
If the renaming process is not successful, you must restore it from a backup.
For more information, see <a href="#backing-up-satellite-server-and-capsule-server">Backing Up Foreman&#160;server and Smart&#160;Proxy&#160;server</a>.</p>
</li>
<li>
<p>Optional: If Foreman&#160;server has a custom SSL certificate installed, a new certificate must be obtained for the host&#8217;s new name.
For more information, see <a href="https://docs.theforeman.org/3.0/Installing_Server_on_Red_Hat/index-foreman-el.html#configuring-satellite-custom-server-certificate_foreman">Configuring Foreman&#160;server with a Custom SSL Certificate</a> in <em>Installing Foreman&#160;server from a Connected Network</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, choose the appropriate method to run the <code>katello-change-hostname</code> script, providing the new host name and Foreman credentials:</p>
<div class="ulist">
<ul>
<li>
<p>If your Foreman&#160;server is installed with default self-signed SSL certificates, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># katello-change-hostname <em>new-foreman</em> \
--username <em>admin</em> \
--password <em>password</em></pre>
</div>
</div>
</li>
<li>
<p>If your Foreman&#160;server is installed with custom SSL certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># katello-change-hostname <em>new-foreman</em> \
--username <em>admin</em> \
--password <em>password</em> \
--custom-cert "/root/ownca/test.com/test.com.crt" \
--custom-key "/root/ownca/test.com/test.com.key"</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: If you have created a custom SSL certificate for the new Foreman&#160;server host name, run the Foreman installation script to install the certificate.
For more information about installing a custom SSL certificate, see <a href="https://docs.theforeman.org/3.0/Installing_Server_on_Red_Hat/index-foreman-el.html#deploying-a-custom-ssl-certificate-to-satellite-server_foreman">Deploying a Custom SSL Certificate to Foreman&#160;server</a> in <em>Installing Foreman&#160;server from a Connected Network</em>.</p>
</li>
<li>
<p>On all Foreman clients, enter the following commands to reinstall the bootstrap RPM, reregister clients, and refresh their subscriptions.</p>
<div class="paragraph">
<p>You can use remote execution feature to perform this step.
For more information, see <a href="https://docs.theforeman.org/3.0/Managing_Hosts/index-foreman-el.html#configuring-and-setting-up-remote-jobs_managing-hosts">Configuring and Setting up Remote Jobs</a> in <em>Managing Hosts</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum remove -y katello-ca-consumer*

# rpm -Uvh http://<em>new-foreman.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm

# subscription-manager register \
--org="<em>Default_Organization</em>" \
--environment="<em>Library</em>" \
--force

# subscription-manager refresh</pre>
</div>
</div>
</li>
<li>
<p>On all Smart&#160;Proxy&#160;servers, run the Foreman installation script to update references to the new host name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-foreman-base-url https://<em>new-foreman.example.com</em> \
--foreman-proxy-trusted-hosts <em>new-foreman.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, list all Smart&#160;Proxy&#160;servers:</p>
<div class="listingblock">
<div class="content">
<pre># hammer proxy list</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, synchronize content for each Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer proxy_content synchronize \
--id <em>proxy_id_number</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Renaming_a_Capsule_Server">10.2. Renaming Smart&#160;Proxy&#160;server</h3>
<div class="paragraph">
<p>The host name of Smart&#160;Proxy&#160;server is referenced by Foreman&#160;server components, and all hosts registered to it.
This procedure ensures that you update all references to the new host name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Both the <code>hostname</code> and <code>hostname -f</code> commands must return the FQDN of Smart&#160;Proxy&#160;server or the <code>katello-change-hostname</code> script will fail to complete.</p>
</li>
<li>
<p>If the <code>hostname</code> command returns the shortname of Smart&#160;Proxy&#160;server instead of the FQDN, use <code>hostnamectl set-hostname <em>old_fqdn</em></code> to set the old FQDN correctly before attempting to use the <code>katello-change-hostname</code> script.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Backup Smart&#160;Proxy&#160;server.
The <code>katello-change-hostname</code> script makes irreversible changes to Smart&#160;Proxy&#160;server.
If the renaming process is not successful, you must restore it from a backup.</p>
<div class="paragraph">
<p>Perform a backup before changing a host name.
For more information, see <a href="#backing-up-satellite-server-and-capsule-server">Backing Up Foreman&#160;server and Smart&#160;Proxy&#160;server</a>.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Until <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1829115">BZ#1829115</a> is resolved, you must edit the <code>usr/share/katello/hostname-change.rb</code> file on Smart&#160;Proxy&#160;server and comment out the following lines before attempting to rename Smart&#160;Proxy&#160;server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">STDOUT.puts "updating hostname in hammer configuration"
self.run_cmd("sed -i.bak -e 's/#<em>{@old_hostname}</em> \
/<em>#{@new_hostname}</em>/g' <em>#{hammer_root_config_path}</em>/*.yml")
self.run_cmd("sed -i.bak -e 's/#<em>{@old_hostname}</em> \
/#<em>{@new_hostname&gt;</em>/g' #<em>{hammer_config_path}</em>/*.yml")</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, generate a new certificates archive file for Smart&#160;Proxy&#160;server.</p>
<div class="ulist">
<ul>
<li>
<p>If you are using the default SSL certificate, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-proxy-certs-generate \
--foreman-proxy-fqdn <em>new-smartproxy.example.com</em> \
--certs-tar /root/<em>new-smartproxy.example.com-certs.tar</em></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that you enter the full path to the <code>.tar</code> file.</p>
</div>
</li>
<li>
<p>If you are using a custom SSL certificate, create a new SSL certificate for Smart&#160;Proxy&#160;server.
For more information, see <a href="https://docs.theforeman.org/3.0/Installing_Proxy_on_Red_Hat/index-foreman-el.html#configuring-capsule-custom-server-certificate_smart-proxy">Configuring Smart&#160;Proxy&#160;server with a Custom SSL Certificate</a> in <em>Installing Smart&#160;Proxy&#160;server</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>On Foreman&#160;server, copy the certificates archive file to Smart&#160;Proxy&#160;server, providing the <code>root</code> user’s password when prompted.
In this example the archive file is copied to the <code>root</code> user’s home directory, but you may prefer to copy it elsewhere.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/<em>new-smartproxy.example.com-certs.tar</em> root@<em>smartproxy.example.com</em>:</pre>
</div>
</div>
</li>
<li>
<p>On Smart&#160;Proxy&#160;server, run the <code>katello-change-hostname</code> script and provide the host&#8217;s new name, Foreman credentials, and certificates archive filename.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># katello-change-hostname <em>new-smart-proxy</em> --username <em>admin</em> \
--password <em>password</em> \
--certs-tar /root/<em>new-smartproxy.example.com-certs.tar</em></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that you enter the full path to the <code>.tar</code> file.</p>
</div>
</li>
<li>
<p>Optional: If you have created a custom certificate for Smart&#160;Proxy&#160;server, on Smart&#160;Proxy&#160;server, to deploy the certificate, enter the <code>foreman-installer</code> command that the <code>foreman-proxy-certs-generate</code> command returns.
For more information, see <a href="https://docs.theforeman.org/3.0/Installing_Proxy_on_Red_Hat/index-foreman-el.html#deploying-a-custom-ssl-certificate-to-capsule-server_smart-proxy">Deploying a Custom SSL Certificate to Smart&#160;Proxy&#160;server</a> in <em>Installing Smart&#160;Proxy&#160;server</em>.</p>
</li>
<li>
<p>On all Smart&#160;Proxy clients, enter the following commands to reinstall the bootstrap RPM, reregister clients, and refresh their subscriptions.</p>
<div class="paragraph">
<p>You can use remote execution feature to perform this step.
For more information, see <a href="https://docs.theforeman.org/3.0/Managing_Hosts/index-foreman-el.html#configuring-and-setting-up-remote-jobs_managing-hosts">Configuring and Setting up Remote Jobs</a> in <em>Managing Hosts</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum remove -y katello-ca-consumer*

# rpm -Uvh http://<em>new-smartproxy.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm

# subscription-manager register --org="<em>Default_Organization</em>" \
--environment="<em>Library</em>" \
--force

# subscription-manager refresh</pre>
</div>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>.</p>
</li>
<li>
<p>Locate Smart&#160;Proxy&#160;server in the list, and click <strong>Edit</strong> to the right of it.</p>
</li>
<li>
<p>Edit the <strong>Name</strong> and <strong>URL</strong> fields to match Smart&#160;Proxy&#160;server&#8217;s new host name, then click <strong>Submit</strong>.</p>
</li>
<li>
<p>On your DNS server, add a record for Smart&#160;Proxy&#160;server&#8217;s new host name, and delete the record for the previous host name.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Administering-Maintaining_a_Red_Hat_Satellite_Server">11. Maintaining Foreman&#160;server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides information on how to maintain a Foreman Server, including information on how to work with audit records, how to clean unused tasks, and how to recover Pulp from a full disk.</p>
</div>
<div class="sect2">
<h3 id="sect-Administering-Deleting_Audit_Records">11.1. Deleting Audit Records</h3>
<div class="paragraph">
<p>Audit records are created automatically in Foreman.
You can use the <code>foreman-rake audits:expire</code> command to remove audits at any time.
You can also use a cron job to schedule audit record deletions at the set interval that you want.</p>
</div>
<div class="paragraph">
<p>By default, using the <code>foreman-rake audits:expire</code> command removes audit records that are older than 90 days.
You can specify the number of days to keep the audit records by adding the <strong>days</strong> option and add the number of days.</p>
</div>
<div class="paragraph">
<p>For example, if you want to delete audit records that are older than seven days, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># foreman-rake audits:expire days=7</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Anonymizing_Audit_Records">11.2. Anonymizing Audit Records</h3>
<div class="paragraph">
<p>You can use the <code>foreman-rake audits:anonymize</code> command to remove any user account or IP information while maintaining the audit records in the database.
You can also use a cron job to schedule anonymizing the audit records at the set interval that you want.</p>
</div>
<div class="paragraph">
<p>By default, using the <code>foreman-rake audits:anonymize</code> command anonymizes audit records that are older than 90 days.
You can specify the number of days to keep the audit records by adding the <strong>days</strong> option and add the number of days.</p>
</div>
<div class="paragraph">
<p>For example, if you want to anonymize audit records that are older than seven days, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># foreman-rake audits:anonymize days=7</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Configuring_the_Cleaning_Unused_Tasks_Feature">11.3. Configuring the Cleaning Unused Tasks Feature</h3>
<div class="paragraph">
<p>Foreman performs regular cleaning to reduce disc space in the database and limit the rate of disk growth.
As a result, Foreman backup completes faster and overall performance is higher.</p>
</div>
<div class="paragraph">
<p>By default, Foreman executes a cron job that cleans tasks every day at 19:45.
Foreman removes the following tasks during the cleaning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tasks that have run successfully and are older than thirty days</p>
</li>
<li>
<p>All tasks that are older than a year</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">For Foremans Upgraded from Previous Versions</div>
<p>Until <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1788615">BZ#1788615</a> is resolved, this functionality works only on fresh installations of Foreman&#160;1.22 and later.
If you upgrade Foreman from previous versions, this functionality is disabled by default.
To enable Foreman to perform regular cleaning, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-plugin-tasks-automatic-cleanup true</pre>
</div>
</div>
<div class="paragraph">
<p>Optionally use this procedure to adjust the configuration to serve your needs.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Optional: To configure the time at which Foreman runs the cron job, set the <code>--foreman-plugin-tasks-cron-line</code> parameter to the time you want in cron format.
For example, to schedule the cron job to run every day at 15:00, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-plugin-tasks-cron-line "00 15 * * *"</pre>
</div>
</div>
</li>
<li>
<p>Optional: To configure the period after which Foreman deletes the tasks, edit the <code>:rules:</code> section in the <code>/etc/foreman/plugins/foreman-tasks.yaml</code> file.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Recovering_from_a_Full_Disk">11.4. Recovering from a Full Disk</h3>
<div class="paragraph">
<p>The following procedure describes how to resolve the situation when a logical volume (LV) with the Pulp database on it has no free space.</p>
</div>
<div id="proc-Administering-to_Recover_from_a_Full_Disk" class="olist arabic">
<div class="title">To recover from a full disk</div>
<ol class="arabic">
<li>
<p>Let running Pulp tasks finish but do not trigger any new ones as they can fail due to the full disk.</p>
</li>
<li>
<p>Ensure that the LV with the <code>/var/lib/pulp</code> directory on it has sufficient free space.
Here are some ways to achieve that:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Remove orphaned content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake katello:delete_orphaned_content RAILS_ENV=production</pre>
</div>
</div>
<div class="paragraph">
<p>This is run weekly so it will not free much space.</p>
</div>
</li>
<li>
<p>Change the download policy from <strong>Immediate</strong> to <strong>On Demand</strong> for as many repositories as possible and remove already downloaded packages.
See the Red&#160;Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/2785021">How to change syncing policy for Repositories on Satellite from "Immediate" to "On-Demand"</a> on the Red&#160;Hat Customer Portal for instructions.</p>
</li>
<li>
<p>Grow the file system on the LV with the <code>/var/lib/pulp</code> directory on it.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/logical_volume_manager_administration/fsgrow_overview">Growing a File System on a Logical Volume</a> in the <em>Red&#160;Hat Enterprise Linux 7 Logical Volume Manager Administration Guide</em>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you use an untypical file system (other than for example ext3, ext4, or xfs), you might need to unmount the file system so that it is not in use.
In that case, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop the <code>foreman-maintain</code> services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service stop</pre>
</div>
</div>
</li>
<li>
<p>Grow the file system on the LV.</p>
</li>
<li>
<p>Start the <code>foreman-maintain</code> services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service start</pre>
</div>
</div>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If some Pulp tasks failed due to the full disk, run them again.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="reclaiming-postgresql-space-after-an-upgrade_admin">11.5. Reclaiming PostgreSQL Space</h3>
<div class="paragraph">
<p>The PostgreSQL database can use a large amount of disk space especially in heavily loaded deployments.
Use this procedure to reclaim some of this disk space on Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Stop all services, except for the <code>postgresql</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service stop --exclude postgresql</pre>
</div>
</div>
</li>
<li>
<p>Switch to the <code>postgres</code> user and reclaim space on the database:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su - postgres -c 'vacuumdb --full --dbname=foreman'</pre>
</div>
</div>
</li>
<li>
<p>Start the other services when the vacuum completes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service start</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Administering-Logging_and_Reporting_Problems">12. Logging and Reporting Problems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides information on how to log and report problems in Foreman Server, including information on relevant log files, how to enable debug logging, how to open a support case and attach the relevant log tar files, and how to access support cases within the Foreman web UI.</p>
</div>
<div class="paragraph">
<p>You can use the log files and other information described in this chapter to do your own troubleshooting, or you can capture these and many more files, as well as diagnostic and configuration information, to send to Red&#160;Hat Support if you need further assistance.</p>
</div>
<div class="paragraph">
<p>For more information about Foreman logging settings, use <code>foreman-installer</code> with the <code>--full-help</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --full-help | grep logging</pre>
</div>
</div>
<div class="sect2">
<h3 id="enabling-debug-logging_admin">12.1. Enabling Debug Logging</h3>
<div class="paragraph">
<p>Debug logging provides the most detailed log information and can help with troubleshooting issues that can arise with Foreman and its components.</p>
</div>
<div class="paragraph">
<p>In the Foreman CLI, enable debug logging to log detailed debugging information for Foreman.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To enable debug logging, complete the following steps on your Foreman&#160;server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To enable debug logging, enter the following command :</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-logging-level debug</pre>
</div>
</div>
</li>
<li>
<p>After you complete debugging, reset the logging level to the default value:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --reset-foreman-logging-level</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_individual_loggers">12.2. Enabling Individual Loggers</h3>
<div class="paragraph">
<p>You can enable individual loggers for selective logging.
Foreman uses the following loggers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>app</code></dt>
<dd>
<p>Logs web requests and all general application messages.
Default value: true.</p>
</dd>
<dt class="hdlist1"><code>audit</code></dt>
<dd>
<p>Logs additional fact statistics, numbers of added, updated, and removed facts.
Default value: true.</p>
</dd>
<dt class="hdlist1"><code>ldap</code></dt>
<dd>
<p>Logs high level LDAP queries and LDAP operations.
Default value: false.</p>
</dd>
<dt class="hdlist1"><code>permissions</code></dt>
<dd>
<p>Logs queries to user roles, filters, and permissions when loading pages.
Default value: false.</p>
</dd>
<dt class="hdlist1"><code>sql</code></dt>
<dd>
<p>Logs SQL queries made through Rails ActiveRecord.
Default value: false.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To enable individual loggers, complete the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the individual loggers that you want.
For example, to enable <code>sql</code> and <code>ldap</code> loggers, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-loggers sql:true --foreman-loggers ldap:true</pre>
</div>
</div>
</li>
<li>
<p>Optional: To reset loggers to their default values, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --reset-foreman-loggers</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-logging-to-journal">12.3. Configuring Logging to Journal</h3>
<div class="paragraph">
<p>You can configure Foreman to manage logging with Journal.
Journal then forwards log messages to <code>rsyslog</code> and <code>rsyslog</code> writes the log messages to <code>/var/log/messages</code>.
Note that after this change the log messages do not appear in <code>/var/log/foreman/production.log</code> or <code>/var/log/foreman-proxy.log</code> any more.</p>
</div>
<div class="paragraph">
<p>For more information about Journal, see <a href="https://github.com/lzap/foreman-elasticsearch" class="bare">https://github.com/lzap/foreman-elasticsearch</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure Foreman&#160;server logging with Journal, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following <code>foreman-installer</code> command to configure logging to <code>journald</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-logging-level info \
--foreman-logging-type journald \
--foreman-logging-layout pattern --foreman-proxy-log JOURNAL</pre>
</div>
</div>
</li>
<li>
<p>Restart the Apache daemon:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service restart --only httpd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="log-file-directories-provided-by-satellite_admin">12.4. Log File Directories Provided by Foreman</h3>
<div class="paragraph">
<p>Foreman provides system information in the form of notifications and log files.</p>
</div>
<table id="tabl-Administering-Logging_and_Reporting-Log_Files_for_Reporting_and_Troubleshooting" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Log File Directories for Reporting and Troubleshooting</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log File Directories</th>
<th class="tableblock halign-left valign-top">Description of Log File Content</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/candlepin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/foreman</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/foreman-proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/httpd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache HTTP server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/foreman-installer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/puppet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/rhsm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/tomcat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Candlepin webservice logs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/messages</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Various other log messages</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can also use the <code>foreman-tail</code> command to follow many of the log files related to Foreman.
You can run <code>foreman-tail -l</code> to list the processes and services that it follows.</p>
</div>
</div>
<div class="sect2">
<h3 id="utilities-for-collecting-log-information_admin">12.5. Utilities for Collecting Log Information</h3>
<div class="paragraph">
<p>There are two utilities available to collect information from log files.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Log Collecting Utilities</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>foreman-debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>foreman-debug</code> command collects configuration and log file data for Foreman, its back-end services, and system information.
This information is collected and written to a tar file.
By default, the output tar file is located at <code>/tmp/<em>foreman-debug-xxx.tar.xz</em></code>.</p>
<p class="tableblock">Additionally, the <code>foreman-debug</code> command exports tasks run during the last 60 days.
By default, the output tar file is located at <code>/tmp/<em>task-export-xxx.tar.xz</em></code>.
If the file is missing, see the file <code>/tmp/task-export.log</code> to learn why task export was unsuccessful.</p>
<p class="tableblock">For more information, run <code>foreman-debug --help</code>.</p>
<p class="tableblock">There is no timeout when running this command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sosreport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>sosreport</code> command is a tool that collects configuration and diagnostic information from a Red&#160;Hat Enterprise&#160;Linux system, such as the running kernel version, loaded modules, and system and service configuration files.
The command also runs external programs (for example: <code>foreman-debug -g</code>) to collect Foreman-specific information, and stores this output in a tar file.</p>
<p class="tableblock">By default, the output tar file is located at <code>/var/tmp/<em>sosreport-XXX-20171002230919.tar.xz</em></code>.
For more information, run <code>sosreport --help</code> or see <a href="https://access.redhat.com/solutions/3592"><em>What is a sosreport and how can I create one?</em></a>.</p>
<p class="tableblock">The <code>sosreport</code> command calls the <code>foreman-debug -g</code> and times out after 500 seconds.
If your Foreman&#160;server has large log files or many Foreman tasks, support engineers may require the output of <code>sosreport</code> and <code>foreman-debug</code> when you open a support case.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Both <code>foreman-debug</code> and <code>sosreport</code> remove security information such as passwords, tokens, and keys while collecting information.
However, the tar files can still contain sensitive information about the Foreman Server.
Red&#160;Hat recommends that you send this information directly to the intended recipient and not to a public target.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Administering-Configuring_External_Authentication">13. Configuring External Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By using external authentication you can derive user and user group permissions from user group membership in an external identity provider.
When you use external authentication, you do not have to create these users and maintain their group membership manually on Foreman&#160;server.</p>
</div>
<div class="paragraph">
<div class="title">Important User and Group Account Information</div>
<p>All user and group accounts must be local accounts.
This is to ensure that there are no authentication conflicts between local accounts on your Foreman&#160;server and accounts in your Active Directory domain.</p>
</div>
<div class="paragraph">
<p>Your system is not affected by this conflict if your user and group accounts exist in both <code>/etc/passwd</code> and <code>/etc/group</code> files.
For example, to check if entries for <code>puppet</code>, <code>apache</code>, <code>foreman</code> and <code>foreman-proxy</code> groups exist in both <code>/etc/passwd</code> and <code>/etc/group</code> files, enter the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/passwd | grep 'puppet\|apache\|foreman\|foreman-proxy'
# cat /etc/group | grep 'puppet\|apache\|foreman\|foreman-proxy'</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Scenarios for Configuring External Authentication</div>
<p>Foreman supports the following general scenarios for configuring external authentication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using <em>Lightweight Directory Access Protocol</em> (LDAP) server as an external identity provider.
LDAP is a set of open protocols used to access centrally stored information over a network.
With Foreman, you can manage LDAP entirely through the Foreman web UI.
For more information, see <a href="#sect-Administering-Using_LDAP">Using LDAP</a>.
Though you can use LDAP to connect to a FreeIPA or AD server, the setup does not support server discovery, cross-forest trusts, or single sign-on with Kerberos in Foreman&#8217;s web UI.</p>
</li>
<li>
<p>Using a FreeIPA server as an external identity provider.
FreeIPA deals with the management of individual identities, their credentials and privileges used in a networking environment.
Configuration using FreeIPA cannot be completed using only the Foreman web UI and requires some interaction with the CLI.
For more information see <a href="#sect-Administering-Configuring_External_Authentication-Using_Identity_Management">Using FreeIPA</a>.</p>
</li>
<li>
<p>Using <em>Active Directory</em> (AD) integrated with FreeIPA through cross-forest Kerberos trust as an external identity provider.
For more information see <a href="#active-directory-with-cross-forest-trust_admin">Active Directory with Cross-Forest Trust</a>.</p>
</li>
<li>
<p>Using Keycloak as an OpenID provider for external authentication to Foreman.
For more information, see <a href="#configuring-project-with-keycloak-authentication_admin">Configuring Foreman with Keycloak Authentication</a>.</p>
</li>
<li>
<p>Using Keycloak as an OpenID provider for external authentication to Foreman with TOTP.
For more information, see <a href="#configuring-keycloak-authentication-with-totp_admin">Configuring Keycloak Authentication with TOTP</a>.</p>
</li>
<li>
<p>Using Keycloak as an OpenID provider for external authentication to Foreman with PIV cards.
For more information, see <a href="#configuring-keycloak-authentication-with-cac-cards_admin">Configuring Keycloak Authentication with PIV Cards</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As well as providing access to Foreman&#160;server, hosts provisioned with Foreman can also be integrated with FreeIPA realms.
Foreman has a realm feature that automatically manages the life cycle of any system registered to a realm or domain provider.
For more information, see <a href="#sect-Administering-Configuring_External_Authentication-External_Authentication_for_Provisioned_Hosts">External Authentication for Provisioned Hosts</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Authentication Overview</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Authentication</th>
<th class="tableblock halign-left valign-top">User Groups</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FreeIPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos or LDAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active Directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos or LDAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POSIX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="sect-Administering-Using_LDAP">13.1. Using LDAP</h3>
<div class="paragraph">
<p>Foreman supports LDAP authentication using one or multiple LDAP directories.</p>
</div>
<div id="sect-Administering-Using_Configuring_TLS_for_Secure-LDAP" class="paragraph">
<p>If you require Foreman to use <code>TLS</code> to establish a secure LDAP connection (LDAPS), first obtain certificates used by the LDAP server you are connecting to and mark them as trusted on the base operating system of your Foreman&#160;server as described below.
If your LDAP server uses a certificate chain with intermediate certificate authorities, all of the root and intermediate certificates in the chain must be trusted, so ensure all certificates are obtained.
If you do not require secure LDAP at this time, proceed to <a href="#configuring-red-hat-satellite-to-use-ldap_admin">Configuring Foreman to use LDAP</a>.</p>
</div>
<div class="paragraph">
<div class="title">Using SSSD Configuration</div>
<p>Though direct LDAP integration is covered in this section, Red&#160;Hat recommends that you use SSSD and configure it against FreeIPA, AD, or an LDAP server.
SSSD improves the consistency of the authentication process.
For more information about the preferred configurations, see <a href="#sect-Administering-Configuring_External_Authentication-Using_Active_Directory">Using Active Directory</a>.
You can also cache the SSSD credentials and use them for LDAP authentication.
For more information on SSSD, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system-level_authentication_guide/sssd">Configuring SSSD</a> in the <em>Red&#160;Hat&#160;Enterprise&#160;Linux 7 System-Level Authentication Guide</em>.</p>
</div>
<div class="sect3">
<h4 id="configuring-tls-for-secure-ldap_admin">13.1.1. Configuring TLS for Secure LDAP</h4>
<div class="paragraph">
<p>Use the Foreman CLI to configure TLS for secure LDAP (LDAPS).</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Obtain the Certificate from the LDAP Server.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If you use Active Directory Certificate Services, export the Enterprise PKI CA Certificate using the Base-64 encoded X.509 format.
See <a href="https://access.redhat.com/solutions/1498773">How to configure Active Directory authentication with <code>TLS</code> on Foreman</a> for information on creating and exporting a CA certificate from an Active Directory server.</p>
</li>
<li>
<p>Download the LDAP server certificate to a temporary location on the Red&#160;Hat Enterprise&#160;Linux system where Foreman&#160;server is installed and remove it when finished.</p>
<div class="paragraph">
<p>For example, <code>/tmp/example.crt</code>.
The filename extensions <code>.cer</code> and <code>.crt</code> are only conventions and can refer to DER binary or PEM ASCII format certificates.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Trust the Certificate from the LDAP Server.</p>
<div class="paragraph">
<p>Foreman Server requires the CA certificates for LDAP authentication to be individual files in <code>/etc/pki/tls/certs/</code> directory.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the <code>install</code> command to install the imported certificate into the <code>/etc/pki/tls/certs/</code> directory with the correct permissions:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># install /tmp/<em>example.crt</em> /etc/pki/tls/certs/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command as <code>root</code> to trust the <em>example.crt</em> certificate obtained from the LDAP server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ln -s <em>example.crt</em> /etc/pki/tls/certs/$(openssl \
x509 -noout -hash -in \
/etc/pki/tls/certs/<em>example.crt</em>).0</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>httpd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a id="sect-Administering-Using_Configuring_Red_Hat_Satellite_to_Use_LDAP"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-red-hat-satellite-to-use-ldap_admin">13.1.2. Configuring Foreman to use LDAP</h4>
<div class="paragraph">
<p>In the Foreman web UI, configure Foreman to use LDAP.</p>
</div>
<div class="paragraph">
<p>Note that if you need single sign-on functionality with Kerberos on Foreman&#8217;s web UI, you should use FreeIPA and AD external authentication instead.
See <a href="#sect-Administering-Configuring_External_Authentication-Using_Identity_Management">Using FreeIPA</a> or <a href="#sect-Administering-Configuring_External_Authentication-Using_Active_Directory">Using Active Directory
</a> for more information on those options.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the Network Information System (NIS) service boolean to true to prevent SELinux from stopping outgoing LDAP connections:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># setsebool -P nis_enabled on</pre>
</div>
</div>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>LDAP Authentication</strong>.</p>
</li>
<li>
<p>Click <strong>Create Authentication Source</strong>.</p>
</li>
<li>
<p>On the <strong>LDAP server</strong> tab, enter the LDAP server&#8217;s name, host name, port, and server type.
The default port is 389, the default server type is POSIX (alternatively you can select FreeIPA or Active Directory depending on the type of authentication server).
For <code>TLS</code> encrypted connections, select the <strong>LDAPS</strong> check box to enable encryption.
The port should change to 636, which is the default for LDAPS.</p>
</li>
<li>
<p>On the <strong>Account</strong> tab, enter the account information and domain name details.
See <a href="#description-of-ldap-settings_admin">Description of LDAP Settings</a> for descriptions and examples.</p>
</li>
<li>
<p>On the <strong>Attribute mappings</strong> tab, map LDAP attributes to Foreman attributes.
You can map login name, first name, last name, email address, and photo attributes.
See <a href="#example-settings-for-ldap-connections_admin">Example Settings for LDAP Connections</a> for examples.</p>
</li>
<li>
<p>On the <strong>Locations</strong> tab, select locations from the left table.
Selected locations are assigned to users created from the LDAP authentication source, and available after their first login.</p>
</li>
<li>
<p>On the <strong>Organizations</strong> tab, select organizations from the left table.
Selected organizations are assigned to users created from the LDAP authentication source, and available after their first login.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Configure new accounts for LDAP users:</p>
<div class="ulist">
<ul>
<li>
<p>If you did not select <strong>Automatically Create Accounts In Foreman</strong> check box, see <a href="#creating-a-user_admin">Creating a User</a> to create user accounts manually.</p>
</li>
<li>
<p>If you selected the <strong>Automatically Create Accounts In Foreman</strong> check box, LDAP users can now log in to Foreman using their LDAP accounts and passwords.
After they log in for the first time, the Foreman administrator has to assign roles to them manually.
See <a href="#assigning-roles-to-a-user_admin">Assigning Roles to a User</a> to assign user accounts appropriate roles in Foreman.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="description-of-ldap-settings_admin">13.1.3. Description of LDAP Settings</h4>
<div class="paragraph">
<p>The following table provides a description for each setting in the <strong>Account</strong> tab.</p>
</div>
<table id="tabl-Administering-Description_of_Account_Tab_Settings_for_Active_Directory_LDAP_Connection" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Account Tab Settings</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Account</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The user name of the LDAP account that has read access to the LDAP server.
User name is not required if the server allows anonymous reading, otherwise use the full path to the user&#8217;s object.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">uid=$login,cn=users,cn=accounts,dc=example,dc=com</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>$login</code> variable stores the username entered on the login page as a literal string.
The value is accessed when the variable is expanded.</p>
</div>
<div class="paragraph">
<p>The variable cannot be used with external user groups from an LDAP source because Foreman needs to retrieve the group list without the user logging in.
Use either an anonymous, or dedicated service user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Account password</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The LDAP password for the user defined in the <strong>Account username</strong> field.
This field can remain blank if the <strong>Account username</strong> is using the <code>$login</code> variable.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Base DN</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The top level domain name of the LDAP directory.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Groups base DN</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The top level domain name of the LDAP directory tree that contains groups.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>LDAP filter</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A filter to restrict LDAP queries.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Automatically Create Accounts In Foreman</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If this check box is selected, Foreman creates user accounts for LDAP users when they log in to Foreman for the first time.
After they log in for the first time, the Foreman administrator has to assign roles to them manually.
See <a href="#assigning-roles-to-a-user_admin">Assigning Roles to a User</a> to assign user accounts appropriate roles in Foreman.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usergroup Sync</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If this option is selected, the user group membership of a user is automatically synchronized when the user logs in, which ensures the membership is always up to date.
If this option is cleared, Foreman relies on a cron job to regularly synchronize group membership (every 30 minutes by default).
See <a href="#proc-Administering-Configuring_External_User_Groups-To_Configure_an_External_User_Group">To Configure an External User Group:</a> for further context.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="example-settings-for-ldap-connections_admin">13.1.4. Example Settings for LDAP Connections</h4>
<div class="paragraph">
<p>The following table shows example settings for different types of LDAP connections.
The example below uses a dedicated service account called <em>redhat</em> that has bind, read, and search permissions on the user and group entries.
Note that LDAP attribute names are case sensitive.</p>
</div>
<table id="tabl-Administering-Using_LDAP-Example_Settings_for_Active_Directory_LDAP_Connection" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Example Settings for Active Directory, Free IPA or Red&#160;Hat Identity Management and POSIX LDAP Connections</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 28.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Active Directory</th>
<th class="tableblock halign-left valign-top">FreeIPA or Red&#160;Hat Identity Management</th>
<th class="tableblock halign-left valign-top">POSIX (OpenLDAP)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOMAIN\redhat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uid=redhat,cn=users,
cn=accounts,dc=example,
dc=com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uid=redhat,ou=users,
dc=example,dc=com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P@ssword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base DN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DC=example,DC=COM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dc=example,dc=com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dc=example,dc=com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Groups Base DN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CN=Users,DC=example,DC=com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cn=groups,cn=accounts,
dc=example,dc=com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cn=employee,ou=userclass,
dc=example,dc=com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login name attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">userPrincipalName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">First name attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">givenName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">givenName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">givenName</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last name attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email address attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>userPrincipalName</code> allows the use of whitespace in usernames.
The login name attribute <code>sAMAccountName</code> (which is not listed in the table above) provides backwards compatibility with legacy Microsoft systems.
<code>sAMAccountName</code> does not allow the use of whitespace in usernames.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="example-ldap-filters_admin">13.1.5. Example LDAP Filters</h4>
<div class="paragraph">
<p>As an administrator, you can create LDAP filters to restrict the access of specific users to Foreman.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Example filters for allowing specific users to login</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">User</th>
<th class="tableblock halign-left valign-top">Filter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(memberOf=cn=Group1,cn=Users,dc=domain,dc=example)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User2, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(memberOf=cn=Group2,cn=Users,dc=domain,dc=example)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1, User2, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(|(memberOf=cn=Group1,cn=Users,dc=domain,dc=example)(memberOf=cn=Group2,cn=Users,dc=domain,dc=example))</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">LDAP directory structure</div>
<p>The LDAP directory structure that the filters in the example use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">DC=Domain,DC=Example
   |
   |----- CN=Users
         |
         |----- CN=Group1
         |----- CN=Group2
         |----- CN=User1
         |----- CN=User2
         |----- CN=User3</pre>
</div>
</div>
<div class="paragraph">
<div class="title">LDAP group membership</div>
<p>The group membership that the filters in the example use:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Group</th>
<th class="tableblock halign-left valign-top">Members</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1,
User3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User2,
User3</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Configuring_External_Authentication-Using_Identity_Management">13.2. Using FreeIPA</h3>
<div class="paragraph">
<p>This section shows how to integrate Foreman Server with a FreeIPA server and how to enable host-based access control.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can attach FreeIPA as an external authentication source with no single sign-on support.
For more information, see <a href="#sect-Administering-Using_LDAP">Using LDAP</a>.
</td>
</tr>
</table>
</div>
<div id="br-Using-IdM-for-Authentication-prereq" class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Foreman&#160;server has to run on Red&#160;Hat Enterprise&#160;Linux&#160;7.1 or later.</p>
</li>
<li>
<p>The base operating system of Foreman&#160;server must be enrolled in the FreeIPA domain by the FreeIPA administrator of your organization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The examples in this chapter assume separation between FreeIPA and Foreman configuration.
However, if you have administrator privileges for both servers, you can configure FreeIPA as described in <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/linux_domain_identity_authentication_and_policy_guide/index#ldi-install">Red&#160;Hat Enterprise&#160;Linux&#160;7 Linux Domain Identity, Authentication, and Policy Guide</a>.</p>
</div>
<div class="sect3">
<h4 id="configuring-idm-authentication-on-satellite-server_admin">13.2.1. Configuring FreeIPA Authentication on Foreman&#160;server</h4>
<div class="paragraph">
<p>In the Foreman CLI, configure FreeIPA authentication by first creating a host entry on the FreeIPA server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the FreeIPA server, to authenticate, enter the following command and enter your password when prompted:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit <em>admin</em></pre>
</div>
</div>
</li>
<li>
<p>To verify that you have authenticated, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># klist</pre>
</div>
</div>
</li>
<li>
<p>On the FreeIPA server, create a host entry for Foreman&#160;server and generate a one-time password, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa host-add --random <em>hostname</em></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The generated one-time password must be used on the client to complete FreeIPA-enrollment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on host configuration properties, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/linux_domain_identity_authentication_and_policy_guide/host-attr">About Host Entry Configuration Properties</a> in the <em>Red&#160;Hat Enterprise&#160;Linux&#160;7 Linux Domain Identity, Authentication, and Policy</em> guide.</p>
</div>
</li>
<li>
<p>Create an HTTP service for Foreman&#160;server, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa service-add HTTP/<em>hostname</em></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on managing services, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/linux_domain_identity_authentication_and_policy_guide/services">Managing Services</a> in the <em>Red&#160;Hat Enterprise&#160;Linux&#160;7 Linux Domain Identity, Authentication, and Policy</em> guide.</p>
</div>
</li>
<li>
<p>On Foreman&#160;server, install the IPA client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install ipa-client</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, enter the following command as root to configure FreeIPA-enrollment:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install --password <em>OTP</em></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>OTP</em> with the one-time password provided by the FreeIPA administrator.</p>
</div>
</li>
<li>
<p>If Foreman&#160;server is running on Red&#160;Hat Enterprise&#160;Linux&#160;7, execute the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable rhel-7-server-optional-rpms</pre>
</div>
</div>
<div class="paragraph">
<p>The installer is dependent on packages which, on Red&#160;Hat Enterprise&#160;Linux&#160;7, are in the optional repository <code>rhel-7-server-optional-rpms</code>.</p>
</div>
</li>
<li>
<p>If Foreman&#160;server is running on Debian, ensure that the hostname is set to the fully qualified domain name (FQDN); the short name is not sufficient:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hostname
foreman.example.com</pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise the installer cannot generate the right principal name that is needed to join the realm.</p>
</div>
</li>
<li>
<p>Set <code>foreman-ipa-authentication</code> to true, using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-ipa-authentication=true</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>foreman-maintain</code> services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service restart</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>External users can now log in to Foreman using their FreeIPA credentials.
They can now choose to either log in to Foreman&#160;server directly using their username and password or take advantage of the configured Kerberos single sign-on and obtain a ticket on their client machine and be logged in automatically.
The two-factor authentication with one-time password (2FA OTP) is also supported.
If the user in FreeIPA is configured for 2FA, and Foreman&#160;server is running on Red&#160;Hat Enterprise&#160;Linux&#160;7, this user can also authenticate to Foreman with an OTP.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-host-based-authentication-control_admin">13.2.2. Configuring Host-Based Authentication Control</h4>
<div class="paragraph">
<p>HBAC rules define which machine within the domain a FreeIPA user is allowed to access.
You can configure HBAC on the FreeIPA server to prevent selected users from accessing Foreman&#160;server.
With this approach, you can prevent Foreman from creating database entries for users that are not allowed to log in.
For more information on HBAC, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/linux_domain_identity_authentication_and_policy_guide/configuring-host-access">Configuring Host-Based Access Control</a> in the <em>Red&#160;Hat Enterprise&#160;Linux&#160;7 Linux Domain Identity, Authentication, and Policy</em> guide.</p>
</div>
<div class="paragraph">
<p>On the FreeIPA server, configure Host-Based Authentication Control (HBAC).</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the FreeIPA server, to authenticate, enter the following command and enter your password when prompted:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit <em>admin</em></pre>
</div>
</div>
</li>
<li>
<p>To verify that you have authenticated, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># klist</pre>
</div>
</div>
</li>
<li>
<p>Create HBAC service and rule on the FreeIPA server and link them together.
The following examples use the PAM service name <em>foreman-prod</em>.
Execute the following commands on the FreeIPA server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa hbacsvc-add foreman-prod
# ipa hbacrule-add allow_foreman_prod
# ipa hbacrule-add-service allow_foreman_prod --hbacsvcs=foreman-prod</pre>
</div>
</div>
</li>
<li>
<p>Add the user who is to have access to the service foreman-prod, and the hostname of Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa hbacrule-add-user allow_foreman_prod --user=<em>username</em>
# ipa hbacrule-add-host allow_foreman_prod --hosts=<em>foreman.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, host groups and user groups can be added to the <em>allow</em>foreman_prod_ rule.</p>
</div>
</li>
<li>
<p>To check the status of the rule, execute:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa hbacrule-find foreman-prod
# ipa hbactest --user=<em>username</em> --host=<em>foreman.example.com</em> --service=foreman-prod</pre>
</div>
</div>
</li>
<li>
<p>Ensure the allow_all rule is disabled on the FreeIPA server.
For instructions on how to do so without disrupting other services see the <a href="https://access.redhat.com/solutions/67895">How to configure HBAC rules in IdM</a> article on the Red&#160;Hat Customer Portal.</p>
</li>
<li>
<p>Configure the FreeIPA integration with Foreman&#160;server as described in <a href="#configuring-idm-authentication-on-satellite-server_admin">Configuring FreeIPA Authentication on Foreman&#160;server</a>.
On Foreman&#160;server, define the PAM service as root:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-pam-service=foreman-prod</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Configuring_External_Authentication-Using_Active_Directory">13.3. Using Active Directory</h3>
<div class="paragraph">
<p>This section shows how to use direct Active Directory (AD) as an external authentication source for Foreman&#160;server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can attach Active Directory as an external authentication source with no single sign-on support.
For more information, see <a href="#sect-Administering-Using_LDAP">Using LDAP</a>.
For an example configuration, see <a href="https://access.redhat.com/solutions/1498773">How to configure Active Directory authentication with TLS on Foreman</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Direct AD integration means that Foreman&#160;server is joined directly to the AD domain where the identity is stored.
The recommended setup consists of two steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enrolling Foreman&#160;server with the Active Directory server as described in <a href="#enrolling-satellite-server-with-the-ad-server_admin">Enrolling Foreman&#160;server with the AD Server</a>.</p>
</li>
<li>
<p>Configuring direct Active Directory integration with GSS-proxy as described in <a href="#configuring-direct-ad-integration-with-gss-proxy_admin">Configuring Direct AD Integration with GSS-proxy</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="gss-proxy_admin">13.3.1. GSS-Proxy</h4>
<div class="paragraph">
<p>The traditional process of Kerberos authentication in Apache requires the Apache process to have read access to the keytab file.
GSS-Proxy allows you to implement stricter privilege separation for the Apache server by removing access to the keytab file while preserving Kerberos authentication functionality.
When using AD as an external authentication source for Foreman, it is recommended to implement GSS-proxy, because the keys in the keytab file are the same as the host keys.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The AD integration requires Foreman Server to be deployed on Red&#160;Hat Enterprise&#160;Linux&#160;7.1 or later.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Perform the following procedures on Red&#160;Hat Enterprise&#160;Linux that acts as a base operating system for your Foreman&#160;server.
For the examples in this section <em>EXAMPLE.ORG</em> is the Kerberos realm for the AD domain.
By completing the procedures, users that belong to the EXAMPLE.ORG realm can log in to Foreman&#160;server.</p>
</div>
</div>
<div class="sect3">
<h4 id="enrolling-satellite-server-with-the-ad-server_admin">13.3.2. Enrolling Foreman&#160;server with the AD Server</h4>
<div class="paragraph">
<p>In the Foreman CLI, enroll Foreman&#160;server with the Active Directory server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>GSS-proxy and nfs-utils are installed.</p>
<div class="paragraph">
<p>Installing GSS-proxy and nfs-utils:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install gssproxy nfs-utils</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the required packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install sssd adcli realmd ipa-python-compat krb5-workstation samba-common-tools</pre>
</div>
</div>
</li>
<li>
<p>Enroll Foreman&#160;server with the AD server.
You may need to have administrator permissions to perform the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># realm join -v <em>EXAMPLE.ORG</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-direct-ad-integration-with-gss-proxy_admin">13.3.3. Configuring Direct AD Integration with GSS-proxy</h4>
<div class="paragraph">
<p>In the Foreman CLI, configure the direct Active Directory integration with GSS-proxy.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Foreman is enrolled with the Active Directory server.</p>
<div class="paragraph">
<p>For more information, see <a href="#enrolling-satellite-server-with-the-ad-server_admin">Enrolling Foreman&#160;server with the AD Server</a>.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the <code>/etc/ipa/</code> directory and the <code>default.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /etc/ipa
# touch /etc/ipa/default.conf</pre>
</div>
</div>
</li>
<li>
<p>To the <code>default.conf</code> file, add the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[global]
server = unused
realm = <em>EXAMPLE.ORG</em></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/etc/net-keytab.conf</code> file with the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[global]
workgroup = EXAMPLE
realm = EXAMPLE.ORG
kerberos method = system keytab
security = ads</pre>
</div>
</div>
</li>
<li>
<p>Determine the effective user ID of the Apache user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id apache</pre>
</div>
</div>
<div class="paragraph">
<p>Apache user must not have access to the keytab file.</p>
</div>
</li>
<li>
<p>Create the <code>/etc/gssproxy/00-http.conf</code> file with the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[service/HTTP]
mechs = krb5
cred_store = keytab:/etc/krb5.keytab
cred_store = ccache:/var/lib/gssproxy/clients/krb5cc_%U
euid = <em>ID_of_Apache_User</em></pre>
</div>
</div>
</li>
<li>
<p>Create a keytab entry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># KRB5_KTNAME=FILE:/etc/httpd/conf/http.keytab net ads keytab add HTTP -U administrator -d3 -s /etc/net-keytab.conf
# chown root.apache /etc/httpd/conf/http.keytab
# chmod 640 /etc/httpd/conf/http.keytab</pre>
</div>
</div>
</li>
<li>
<p>Enable IPA authenication in Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-ipa-authentication=true</pre>
</div>
</div>
</li>
<li>
<p>Start and enable the <code>gssproxy</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart gssproxy.service
# systemctl enable gssproxy.service</pre>
</div>
</div>
</li>
<li>
<p>Configure the Apache server to use the gssproxy service:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create the <code>/etc/systemd/system/httpd.service</code> file with the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">.include /lib/systemd/system/httpd.service
[Service]
Environment=GSS_USE_PROXY=1</pre>
</div>
</div>
</li>
<li>
<p>Apply changes to the service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl daemon-reload</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Start and enable the <code>httpd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd.service</pre>
</div>
</div>
</li>
<li>
<p>Verify that SSO is working as expected.</p>
<div class="paragraph">
<p>With a running Apache server, users making HTTP requests against the server are authenticated if the client has a valid Kerberos ticket.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Retrieve the Kerberos ticket of the LDAP user, using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit ldapuser</pre>
</div>
</div>
</li>
<li>
<p>View the Kerberos ticket, using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># klist</pre>
</div>
</div>
</li>
<li>
<p>View output from successful SSO-based authentication, using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -k -u : --negotiate https://<em>foreman.example.com/</em>users/extlogin</pre>
</div>
</div>
<div class="paragraph">
<p>This returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;html&gt;&lt;body&gt;You are being &lt;a href="https://<em>foreman.example.com/</em>users/4-ldapuserexample-com/edit"&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kerberos-configuration-in-web-browsers_admin">13.3.4. Kerberos Configuration in Web Browsers</h4>
<div class="paragraph">
<p>For information on configuring the Firefox browser see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system-level_authentication_guide/configuring_applications_for_sso#configuring_firefox_to_use_kerberos_for_sso">Configuring Firefox to Use Kerberos for Single Sign-On</a> in the <em>Red&#160;Hat Enterprise&#160;Linux System-Level Authentication</em> guide.</p>
</div>
<div class="paragraph">
<p>If you use the Internet Explorer browser, add Foreman&#160;server to the list of Local Intranet or Trusted sites, and turn on the <em>Enable Integrated Windows Authentication</em> setting.
See the Internet Explorer documentation for details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>With direct AD integration, HBAC through FreeIPA is not available.
As an alternative, you can use Group Policy Objects (GPO) that enable administrators to centrally manage policies in AD environments.
To ensure correct GPO to PAM service mapping, use the following sssd configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">access_provider = ad
ad_gpo_access_control = enforcing
ad_gpo_map_service = +foreman</pre>
</div>
</div>
<div class="paragraph">
<p>Here, <em>foreman</em> is the PAM service name.
For more information on GPOs, please refer to the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/windows_integration_guide/sssd-gpo">Red&#160;Hat Enterprise Linux Windows Integration Guide</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="active-directory-with-cross-forest-trust_admin">13.3.5. Active Directory with Cross-Forest Trust</h4>
<div class="paragraph">
<p>Kerberos can create <code>cross-forest trust</code> that defines a relationship between two otherwise separate domain forests.
A domain forest is a hierarchical structure of domains; both AD and FreeIPA constitute a forest.
With a trust relationship enabled between AD and FreeIPA, users of AD can access Linux hosts and services using a single set of credentials.
For more information on cross-forest trusts, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/windows_integration_guide/active-directory-trust">Creating Cross-forest Trusts with Active Directory and Identity Management</a> in the <em>Red&#160;Hat Enterprise&#160;Linux Windows Integration</em> guide.</p>
</div>
<div class="paragraph">
<p>From the Foreman point of view, the configuration process is the same as integration with FreeIPA server without cross-forest trust configured.
Foreman&#160;server has to be enrolled in the IPM domain and integrated as described in <a href="#sect-Administering-Configuring_External_Authentication-Using_Identity_Management">Using FreeIPA</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-idm-server-to-use-cross-forest-trust_admin">13.3.6. Configuring the FreeIPA Server to Use Cross-Forest Trust</h4>
<div class="paragraph">
<p>On the FreeIPA server, configure the server to use <code>cross-forest trust</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable HBAC:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create an external group and add the AD group to it.</p>
</li>
<li>
<p>Add the new external group to a POSIX group.</p>
</li>
<li>
<p>Use the POSIX group in a HBAC rule.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure sssd to transfer additional attributes of AD users.</p>
<div class="ulist">
<ul>
<li>
<p>Add the AD user attributes to the <em>nss</em> and <em>domain</em> sections in <code>/etc/sssd/sssd.conf</code>.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[nss]
user_attributes=+mail, +sn, +givenname

[domain/EXAMPLE]
ldap_user_extra_attrs=mail, sn, givenname</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Creating_User_Groups-Configuring_External_User_Groups">13.4. Configuring External User Groups</h3>
<div class="paragraph">
<p>Foreman does not associate external users with their user group automatically.
You must create a user group with the same name as in the external source on Foreman.
Members of the external user group then automatically become members of the Foreman user group and receive the associated permissions.</p>
</div>
<div class="paragraph">
<p>The configuration of external user groups depends on the type of external authentication.</p>
</div>
<div class="paragraph">
<p>To assign additional permissions to an external user, add this user to an internal user group that has no external mapping specified.
Then assign the required roles to this group.</p>
</div>
<div id="br-external_user_groups_prerequisites" class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>If you use an LDAP server, configure Foreman to use LDAP authentication.
For more information see <a href="#sect-Administering-Using_LDAP">Using LDAP</a>.</p>
<div class="paragraph">
<p>When using external user groups from an LDAP source, you cannot use the <code>$login</code> variable as a substitute for the account user name.
You must use either an anonymous or dedicated service user.</p>
</div>
</li>
<li>
<p>If you use a FreeIPA or AD server, configure Foreman to use FreeIPA or AD authentication.
For more information, see <a href="#chap-Administering-Configuring_External_Authentication">Configuring External Authentication</a>.</p>
</li>
<li>
<p>Ensure that at least one external user authenticates for the first time.</p>
</li>
<li>
<p>Retain a copy of the external group names you want to use.
To find the group membership of external users, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id <em>username</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div id="proc-Administering-Configuring_External_User_Groups-To_Configure_an_External_User_Group" class="olist arabic">
<div class="title">To Configure an External User Group:</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>, and click <strong>Create User Group</strong>.</p>
</li>
<li>
<p>Specify the name of the new user group.
Do not select any users to avoid adding users automatically when you refresh the external user group.</p>
</li>
<li>
<p>Click the <strong>Roles</strong> tab and select the roles you want to assign to the user group.
Alternatively, select the <strong>Administrator</strong> check box to assign all available permissions.</p>
</li>
<li>
<p>Click the <strong>External groups</strong> tab, then click <strong>Add external user group</strong>, and select an authentication source from the <strong>Auth source</strong> drop-down menu.</p>
<div class="paragraph">
<p>Specify the exact name of the external group in the <strong>Name</strong> field.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_refreshing_external_user_groups_for_ldap">13.5. Refreshing External User Groups for LDAP</h3>
<div class="paragraph">
<p>To set the LDAP source to synchronize user group membership automatically on user login, in the <strong>Auth Source</strong> page, select the <strong>Usergroup Sync</strong> option.
If this option is not selected, LDAP user groups are refreshed automatically through a scheduled cron job synchronizing the LDAP Authentication source every 30 minutes by default.</p>
</div>
<div class="paragraph">
<p>If the user groups in the LDAP Authentication source change in the lapse of time between scheduled tasks, the user can be assigned to incorrect external user groups.
This is corrected automatically when the scheduled task runs.</p>
</div>
<div class="paragraph">
<p>Use this procedure to refresh the LDAP source manually.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Usergroups</strong> and select a user group.</p>
</li>
<li>
<p>Navigate to the <strong>External Groups</strong> tab and click <strong>Refresh</strong> to the right of the required user group.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre># foreman-rake ldap:refresh_usergroups</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_refreshing_external_user_groups_for_freeipa_or_ad">13.6. Refreshing External User Groups for FreeIPA or AD</h3>
<div class="paragraph">
<p>External user groups based on FreeIPA or AD are refreshed only when a group member logs in to Foreman.
It is not possible to alter user membership of external user groups in the Foreman web UI, such changes are overwritten on the next group refresh.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Configuring_External_Authentication-External_Authentication_for_Provisioned_Hosts">13.7. External Authentication for Provisioned Hosts</h3>
<div class="paragraph">
<p>Use this section to configure Foreman&#160;server or Smart&#160;Proxy&#160;server for FreeIPA realm support, then add hosts to the FreeIPA realm group.</p>
</div>
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="paragraph">
<p>You require the following setup to configure external authentication for provisioned hosts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Foreman&#160;server that is registered to the Content Delivery Network or an external Smart&#160;Proxy&#160;server that is registered to Foreman&#160;server.</p>
</li>
<li>
<p>A deployed realm or domain provider such as FreeIPA.</p>
</li>
</ul>
</div>
<div id="proc-Administering-Configuring_a_Red_Hat_Satellite_Server_or_Capsule_Server_for_IdM_Realm_Support-To_configure_the_Satellite_Server_or_Capsule_Server_for_IdM_Realm_Support" class="paragraph">
<div class="title">To install and configure FreeIPA packages on Foreman Server or Foreman Smart&#160;Proxy&#160;server:</div>
<p>To use FreeIPA for provisioned hosts, complete the following steps to install and configure FreeIPA packages on Foreman Server or Foreman Smart&#160;Proxy&#160;server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>ipa-client</code> package on Foreman&#160;server or Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install ipa-client</pre>
</div>
</div>
</li>
<li>
<p>Configure the server as a FreeIPA client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install</pre>
</div>
</div>
</li>
<li>
<p>Create a realm proxy user, <code>realm-smart-proxy</code>, and the relevant roles in FreeIPA:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-prepare-realm admin realm-smart-proxy</pre>
</div>
</div>
<div class="paragraph">
<p>Note the principal name that returns and your FreeIPA server configuration details because you require them for the following procedure.</p>
</div>
</li>
</ol>
</div>
<div id="proc-Administering-Configuring_IdM" class="paragraph">
<div class="title">To configure Foreman&#160;server or Smart&#160;Proxy&#160;server for FreeIPA Realm Support:</div>
<p>Complete the following procedure on Foreman and every Smart&#160;Proxy that you want to use:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy the <code>/root/freeipa.keytab</code> file to any Smart&#160;Proxy&#160;server that you want to include in the same principal and realm:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/freeipa.keytab root@<em>smartproxy.example.com</em>:/etc/foreman-proxy/freeipa.keytab</pre>
</div>
</div>
</li>
<li>
<p>Move the <code>/root/freeipa.keytab</code> file to the <code>/etc/foreman-proxy</code> directory and set the ownership settings to the <code>foreman-proxy</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /root/freeipa.keytab /etc/foreman-proxy
# chown foreman-proxy:foreman-proxy /etc/foreman-proxy/freeipa.keytab</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command on all Smart&#160;Proxies that you want to include in the realm.
If you use the integrated Smart&#160;Proxy on Foreman, enter this command on Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-realm true \
--foreman-proxy-realm-keytab /etc/foreman-proxy/freeipa.keytab \
--foreman-proxy-realm-principal <em>realm-smart-proxy@EXAMPLE.COM</em> \
--foreman-proxy-realm-provider freeipa</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use these options when you first configure the Foreman Server.</p>
</div>
</li>
<li>
<p>Ensure that the most updated versions of the ca-certificates package is installed and trust the FreeIPA Certificate Authority:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /etc/ipa/ca.crt /etc/pki/ca-trust/source/anchors/ipa.crt
# update-ca-trust enable
# update-ca-trust</pre>
</div>
</div>
</li>
<li>
<p>Optional: If you configure FreeIPA on an existing Foreman&#160;server or Smart&#160;Proxy&#160;server, complete the following steps to ensure that the configuration changes take effect:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Restart the <strong>foreman-proxy</strong> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>.</p>
</li>
<li>
<p>Locate the Smart&#160;Proxy you have configured for FreeIPA and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div id="proc-Administering-Creating_a_Realm_for_the_IdM_enabled_Capsule" class="paragraph">
<div class="title">To create a realm for the FreeIPA-enabled Smart&#160;Proxy</div>
<p>After you configure your integrated or external Smart&#160;Proxy with FreeIPA, you must create a realm and add the FreeIPA-configured Smart&#160;Proxy to the realm.</p>
</div>
<div class="paragraph">
<p>To create a realm, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Realms</strong> and click <strong>Create Realm</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the realm.</p>
</li>
<li>
<p>From the <strong>Realm Type</strong> list, select the type of realm.</p>
</li>
<li>
<p>From the <strong>Realm Smart&#160;Proxy</strong> list, select Smart&#160;Proxy&#160;server where you have configured FreeIPA.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and from the <strong>Locations</strong> list, select the location where you want to add the new realm.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and from the <strong>Organizations</strong> list, select the organization where you want to add the new realm.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Updating Host Groups with Realm Information</div>
<p>You must update any host groups that you want to use with the new realm information.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>, select the host group that you want to update, and click the <strong>Network</strong> tab.</p>
</li>
<li>
<p>From the <strong>Realm</strong> list, select the realm you create as part of this procedure, and then click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div id="sect-Administering-External_Authentication_for_Provisioned_Hosts-Adding_Hosts_to_an_IdM_Host_Group" class="paragraph">
<div class="title">Adding Hosts to a FreeIPA Host Group</div>
<p>FreeIPA supports the ability to set up automatic membership rules based on a system&#8217;s attributes.
Foreman&#8217;s realm feature provides administrators with the ability to map the Foreman host groups to the FreeIPA parameter <code>userclass</code> which allow administrators to configure automembership.</p>
</div>
<div class="paragraph">
<p>When nested host groups are used, they are sent to the FreeIPA server as they are displayed in the Foreman User Interface.
For example, "Parent/Child/Child".</p>
</div>
<div class="paragraph">
<p>Foreman&#160;server or Smart&#160;Proxy&#160;server sends updates to the FreeIPA server, however automembership rules are only applied at initial registration.</p>
</div>
<div id="proc-Administering-Adding_Hosts_to_an_IdM_Host_Group-To_Add_Hosts_to_an_IdM_Host_Group" class="olist arabic">
<div class="title">To Add Hosts to a FreeIPA Host Group:</div>
<ol class="arabic">
<li>
<p>On the FreeIPA server, create a host group:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa hostgroup-add <em>hostgroup_name</em> --desc=<em>hostgroup_description</em></pre>
</div>
</div>
</li>
<li>
<p>Create an <code>automembership</code> rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa automember-add --type=hostgroup <em>hostgroup_name</em> <em>automember_rule</em></pre>
</div>
</div>
<div class="paragraph">
<p>Where you can use the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>automember-add</code> flags the group as an automember group.</p>
</li>
<li>
<p><code>--type=hostgroup</code> identifies that the target group is a host group, not a user group.</p>
</li>
<li>
<p><code><em>automember_rule</em></code> adds the name you want to identify the automember rule by.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Define an automembership condition based on the <code>userclass</code> attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa automember-add-condition --key=userclass --type=hostgroup --inclusive-regex=<em>^webserver</em> <em>hostgroup_name</em>
----------------------------------
Added condition(s) to "<em>hostgroup_name</em>"
----------------------------------
Automember Rule: <em>automember_rule</em>
Inclusive Regex: userclass=<em>^webserver</em>
----------------------------
Number of conditions added 1
----------------------------</pre>
</div>
</div>
<div class="paragraph">
<p>Where you can use the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>automember-add-condition</code> adds regular expression conditions to identify group members.</p>
</li>
<li>
<p><code>--key=userclass</code> specifies the key attribute as <code>userclass</code>.</p>
</li>
<li>
<p><code>--type=hostgroup</code> identifies that the target group is a host group, not a user group.</p>
</li>
<li>
<p><code>--inclusive-regex=</code> <em>^webserver</em> identifies matching values with a regular expression pattern.</p>
</li>
<li>
<p><em>hostgroup_name</em> - identifies the target host group&#8217;s name.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When a system is added to Foreman&#160;server&#8217;s <em>hostgroup_name</em> host group, it is added automatically to the FreeIPA server&#8217;s "<em>hostgroup_name</em>" host group.
FreeIPA host groups allow for Host-Based Access Controls (HBAC), sudo policies and other FreeIPA functions.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-project-with-keycloak-authentication_admin">13.8. Configuring Foreman with Keycloak Authentication</h3>
<div class="paragraph">
<p>Use this section to configure Foreman to use Keycloak as an OpenID provider for external authentication.</p>
</div>
<div class="sect3">
<h4 id="prerequisites-for-integrating-project-with-keycloak_keycloak-general">13.8.1. Prerequisites for Configuring Foreman with Keycloak Authentication</h4>
<div class="paragraph">
<p>Before configuring Foreman with Keycloak external authentication, ensure that you meet the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A working installation of Keycloak server that uses HTTPS instead of HTTP.</p>
</li>
<li>
<p>A Keycloak account with admin privileges.</p>
</li>
<li>
<p>A realm for Foreman user accounts created in Keycloak.</p>
</li>
<li>
<p>If the certificates or the CA are self-signed, ensure that they are added to the end-user certificate trust store.</p>
</li>
<li>
<p>Users imported or added to Keycloak.</p>
<div class="paragraph">
<p>If you have an existing user database configured such as LDAP or Kerberos, you can import users from it by configuring user federation.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user-storage-federation">User Storage Federation</a> in the <em>Red&#160;Hat Single Sign-On Server Administration Guide</em>.</p>
</div>
<div class="paragraph">
<p>If you do not have an existing user database configured, you can manually create users in Keycloak.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user_management#create-new-user">Creating New Users</a> in the <em>Red&#160;Hat Single Sign-On Server Administration Guide</em>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="registering-project-as-a-keycloak-client_keycloak-general">13.8.2. Registering Foreman as a Keycloak Client</h4>
<div class="paragraph">
<p>Use this procedure to register Foreman to Keycloak as a client and configure Foreman to use Keycloak as an authentication source.</p>
</div>
<div class="paragraph">
<p>You can configure Foreman and Keycloak with two different authentication methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Users authenticate to Foreman using the Foreman web UI.</p>
</li>
<li>
<p>Users authenticate to Foreman using the Foreman CLI.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You must decide on how you want your users to authenticate in advance because both methods require different Foreman clients to be registered to Keycloak and configured.
The steps to register and configure Foreman client in Keycloak are distinguished within the procedure.</p>
</div>
<div class="paragraph">
<p>You can also register two different Foreman clients to Keycloak if you want to use both authentication methods and configure both clients accordingly.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the Foreman server, install the following packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install mod_auth_openidc keycloak-httpd-client-install</pre>
</div>
</div>
</li>
<li>
<p>Register Foreman to Keycloak as a client.
Note that you the registration process for logging in using the web UI and the CLI are different.
You can register two clients Foreman clients to Keycloak to be able to log in to Foreman from the web UI and the CLI.</p>
<div class="ulist">
<ul>
<li>
<p>If you want you users to authenticate to Foreman using the web UI, create a client as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name foreman-openidc \
--keycloak-server-url "<em>https://Keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
<div class="paragraph">
<p>Enter the password for the administer account when prompted.
This command creates a client for Foreman in Keycloak.</p>
</div>
<div class="paragraph">
<p>Then, configure Foreman to use Keycloak as an authentication source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "foreman-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
<li>
<p>If you want your users to authenticate to Foreman using the CLI, create a client as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name hammer-openidc \
--keycloak-server-url "<em>https://Keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
<div class="paragraph">
<p>Enter the password for the administer account when prompted.
This command creates a client for Foreman in Keycloak.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Restart the <code>httpd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-project-client-in-keycloak_keycloak-general">13.8.3. Configuring the Foreman Client in Keycloak</h4>
<div class="paragraph">
<p>Use this procedure to configure the Foreman client in the Keycloak web UI and create group and audience mappers for the Foreman client.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Keycloak web UI, navigate to <strong>Clients</strong> and click the Foreman client.</p>
</li>
<li>
<p>Configure access type:</p>
<div class="ulist">
<ul>
<li>
<p>If you want your users to authenticate to Foreman using the Foreman web UI, from the <strong>Access Type</strong> list, select <strong>confidential</strong>.</p>
</li>
<li>
<p>If you want your users to authenticate to Foreman using the CLI, from the <strong>Access Type</strong> list, select <strong>public</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Valid redirect URI</strong> fields, add a valid redirect URI.</p>
<div class="ulist">
<ul>
<li>
<p>If you want your users to authenticate to Foreman using the Foreman web UI, in the blank field below the existing URI, enter a URI in the form <code>https://foreman.example.com/users/extlogin</code>. Note that you must add the string <code>/users/extlogin</code> after the Foreman FQDN.</p>
<div class="paragraph">
<p>After completing this step, the Foreman client for logging in using the Foreman web UI must have the following <strong>Valid Redirect URIs</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://foreman.example.com/users/extlogin/redirect_uri
https://foreman.example.com/users/extlogin</pre>
</div>
</div>
</li>
<li>
<p>If you want your users to authenticate to Foreman using the CLI, in the blank field below the existing URI, enter <strong>urn:ietf:wg:oauth:2.0:oob</strong>.</p>
<div class="paragraph">
<p>After completing this step, the Foreman client for logging in using the CLI must have the following <strong>Valid Redirect URIs</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://foreman.example.com/users/extlogin/redirect_uri
urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Click the <strong>Mappers</strong> tab and click <strong>Create</strong> to add an audience mapper.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the audience mapper.</p>
</li>
<li>
<p>From the <strong>Mapper Type</strong> list, select <strong>Audience</strong>.</p>
</li>
<li>
<p>From the <strong>Included Client Audience</strong> list, select the Foreman client.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Click <strong>Create</strong> to add a group mapper so that you can specify authorization in Foreman based on group membership.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the group mapper.</p>
</li>
<li>
<p>From the <strong>Mapper Type</strong> list, select <strong>Group Membership</strong>.</p>
</li>
<li>
<p>In the <strong>Token Claim Name</strong> field, enter <strong>groups</strong>.</p>
</li>
<li>
<p>Set the <strong>Full group path</strong> setting to OFF.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-project-settings-for-keycloak-authentication_keycloak-general">13.8.4. Configuring Foreman Settings for Keycloak Authentication</h4>
<div class="paragraph">
<p>Use this section to configure Foreman for Keycloak authentication using the Foreman web UI or the CLI.</p>
</div>
<div class="sect4">
<h5 id="configuring-project-settings-for-keycloak-authentication-using-the-web-ui_keycloak-general">Configuring Foreman Settings for Keycloak Authentication Using the Web UI</h5>
<div class="paragraph">
<p>Use this procedure to configure Foreman settings for Keycloak authentication using the Foreman web UI.</p>
</div>
<div class="paragraph">
<p>Note that you can navigate to the following URL within your realm to obtain values to configure Foreman settings: <code>https://Keycloak.example.com/auth/realms/Foreman_Realm/.well-known/openid-configuration</code></p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ensure that the <strong>Access Type</strong> setting in the Foreman client in the Keycloak web UI is set to <strong>confidential</strong></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Authentication</strong> tab.</p>
</li>
<li>
<p>Locate the <strong>Authorize login delegation</strong> row, and in the <strong>Value</strong> column, set the value to <strong>Yes</strong>.</p>
</li>
<li>
<p>Locate the <strong>Authorize login delegation auth source user autocreate</strong> row, and in the <strong>Value</strong> column,
set the value to <strong>External</strong>.</p>
</li>
<li>
<p>Locate the <strong>Login delegation logout URL</strong> row, and in the <strong>Value</strong> column, set the value to <strong>https://foreman.example.com/users/extlogout</strong>.</p>
</li>
<li>
<p>Locate the <strong>OIDC Algorithm</strong> row, and in the <strong>Value</strong> column, set the algorithm for encoding on Keycloak to <strong>RS256</strong>.</p>
</li>
<li>
<p>Locate the <strong>OIDC Audience</strong> row, and in the <strong>Value</strong> column, set the value to the client ID for Keycloak.</p>
</li>
<li>
<p>Locate the <strong>OIDC Issuer</strong> row, and in the <strong>Value</strong> column, set the value to <strong><em>https://Keycloak.example.com/auth/realms/Foreman_Realm</em></strong>.</p>
</li>
<li>
<p>Locate the <strong>OIDC JWKs URL</strong> row, and in the <strong>Value</strong> column, set the value to <strong><em>https://Keycloak.example.com/auth/realms/Foreman_Realm/protocol/openid-connect/certs</em></strong>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Authentication Sources</strong> and click <strong>External</strong>.</p>
</li>
<li>
<p>Click <strong>Create LDAP Authentication Source</strong> and select the Keycloak server.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add locations that can use the Keycloak authentication source.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add organizations that can use the Keycloak authentication source.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="configuring-project-settings-for-keycloak-authentication-using-the-cli_keycloak-general">Configuring Foreman Settings for Keycloak Authentication Using the CLI</h5>
<div class="paragraph">
<p>Use this procedure to configure Foreman settings for Keycloak authentication using the Foreman CLI.</p>
</div>
<div class="paragraph">
<p>Note that you can navigate to the following URL within your realm to obtain values to configure Foreman settings: <code>https://Keycloak.example.com/auth/realms/Foreman_Realm/.well-known/openid-configuration</code></p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ensure that the <strong>Access Type</strong> setting in the Foreman client in the Keycloak web UI is set to <strong>public</strong></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman, set the login delegation to <code>true</code> so that users can authenticate using the Open IDC protocol:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name authorize_login_delegation --value true</pre>
</div>
</div>
</li>
<li>
<p>Set the login delegation logout URL:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name login_delegation_logout_url \
--value https://foreman.example.com/users/extlogout</pre>
</div>
</div>
</li>
<li>
<p>Set the algorithm for encoding on Keycloak, for example, <code>RS256</code>:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name oidc_algorithm --value 'RS256'</pre>
</div>
</div>
</li>
<li>
<p>Open the <code><em>Keycloak.example.com</em>/auth/realms/<em>Keycloak_REALM</em>/.well-known/openid-configuration</code> URL and note the values to populate the options in the following steps.</p>
</li>
<li>
<p>Add the value for the Hammer client in the Open IDC audience:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you register several Keycloak clients to Foreman, ensure that you append all audiences in the array.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-foreman-openidc', '<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set the value for the Open IDC issuer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_issuer \
--value "<em>Keycloak.example.com</em>/auth/realms/<em>Keycloak_Realm</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set the value for Open IDC Java Web Token (JWT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_jwks_url \
--value "<em>Keycloak.example.com</em>/auth/realms/<em>Keycloak_Realm</em>/protocol/openid-connect/certs"</pre>
</div>
</div>
</li>
<li>
<p>Retrieve the ID of the Keycloak authentication source:</p>
<div class="listingblock">
<div class="content">
<pre># hammer auth-source external list</pre>
</div>
</div>
</li>
<li>
<p>Set the location and organization:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth-source external update --id <em>Authentication Source ID</em> \
--location-ids <em>Location ID</em> --organization-ids <em>Organization ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="logging-in-to-the-project-web-ui-using-keycloak_keycloak-general">13.8.5. Logging in to the Foreman web UI Using Keycloak</h4>
<div class="paragraph">
<p>Use this procedure to log in to the Foreman web UI using Keycloak.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>In your browser, log in to Foreman and enter your credentials.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="logging-in-to-the-project-cli-using-keycloak_keycloak-general">13.8.6. Logging in to the Foreman CLI Using Keycloak</h4>
<div class="paragraph">
<p>Use this procedure to authenticate to the Foreman CLI using the code grant type.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To authenticate to the Foreman CLI using the code grant type, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--two-factor \
--oidc-token-endpoint 'https://<em>Keycloak.example.com</em>/auth/realms/ssl-realm/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>Keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-foreman-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
<div class="paragraph">
<p>The command prompts you to enter a success code.</p>
</div>
</li>
<li>
<p>To retrieve the success code, navigate to the URL that the command returns and provide the required information.</p>
</li>
<li>
<p>Copy the success code that the web UI returns.</p>
</li>
<li>
<p>In the command prompt of <code>hammer auth login oauth</code>, enter the success code to authenticate to the Foreman CLI.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-group-mapping-for-keycloak-authentication_keycloak-general">13.8.7. Configuring Group Mapping for Keycloak Authentication</h4>
<div class="paragraph">
<p>Optionally, to implement the Role Based Access Control (RBAC), create a group in Foreman, assign a role to this group, and then map an Active Directory group to the Foreman group.
As a result, anyone in the given group in Keycloak are logged in under the corresponding Foreman group.
This example configures users of the Foreman-admin user group in the Active Directory to authenticate as users with administrator privileges on Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>, and click the <strong>Create User Group</strong> button.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the user group.
The name should not be the same as in the Active Directory.</p>
</li>
<li>
<p>Do not add users and user groups to the right-hand columns.
Click the <strong>Roles</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Administer</strong> check box.</p>
</li>
<li>
<p>Click the <strong>External Groups</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add external user group</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name of the Active Directory group.</p>
</li>
<li>
<p>From the list, select <strong>EXTERNAL</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-keycloak-authentication-with-totp_admin">13.9. Configuring Keycloak Authentication with TOTP</h3>
<div class="paragraph">
<p>Use this section to configure Foreman to use Keycloak as an OpenID provider for external authentication with TOTP cards.</p>
</div>
<div class="sect3">
<h4 id="prerequisites-for-integrating-project-with-keycloak_keycloak-totp">13.9.1. Prerequisites for Configuring Foreman with Keycloak Authentication</h4>
<div class="paragraph">
<p>Before configuring Foreman with Keycloak external authentication, ensure that you meet the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A working installation of Keycloak server that uses HTTPS instead of HTTP.</p>
</li>
<li>
<p>A Keycloak account with admin privileges.</p>
</li>
<li>
<p>A realm for Foreman user accounts created in Keycloak.</p>
</li>
<li>
<p>If the certificates or the CA are self-signed, ensure that they are added to the end-user certificate trust store.</p>
</li>
<li>
<p>Users imported or added to Keycloak.</p>
<div class="paragraph">
<p>If you have an existing user database configured such as LDAP or Kerberos, you can import users from it by configuring user federation.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user-storage-federation">User Storage Federation</a> in the <em>Red&#160;Hat Single Sign-On Server Administration Guide</em>.</p>
</div>
<div class="paragraph">
<p>If you do not have an existing user database configured, you can manually create users in Keycloak.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user_management#create-new-user">Creating New Users</a> in the <em>Red&#160;Hat Single Sign-On Server Administration Guide</em>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="registering-project-as-a-keycloak-client_keycloak-totp">13.9.2. Registering Foreman as a Keycloak Client</h4>
<div class="paragraph">
<p>Use this procedure to register Foreman to Keycloak as a client and configure Foreman to use Keycloak as an authentication source.</p>
</div>
<div class="paragraph">
<p>You can configure Foreman and Keycloak with two different authentication methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Users authenticate to Foreman using the Foreman web UI.</p>
</li>
<li>
<p>Users authenticate to Foreman using the Foreman CLI.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You must decide on how you want your users to authenticate in advance because both methods require different Foreman clients to be registered to Keycloak and configured.
The steps to register and configure Foreman client in Keycloak are distinguished within the procedure.</p>
</div>
<div class="paragraph">
<p>You can also register two different Foreman clients to Keycloak if you want to use both authentication methods and configure both clients accordingly.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the Foreman server, install the following packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install mod_auth_openidc keycloak-httpd-client-install</pre>
</div>
</div>
</li>
<li>
<p>Register Foreman to Keycloak as a client.
Note that you the registration process for logging in using the web UI and the CLI are different.
You can register two clients Foreman clients to Keycloak to be able to log in to Foreman from the web UI and the CLI.</p>
<div class="ulist">
<ul>
<li>
<p>If you want you users to authenticate to Foreman using the web UI, create a client as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name foreman-openidc \
--keycloak-server-url "<em>https://Keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
<div class="paragraph">
<p>Enter the password for the administer account when prompted.
This command creates a client for Foreman in Keycloak.</p>
</div>
<div class="paragraph">
<p>Then, configure Foreman to use Keycloak as an authentication source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "foreman-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
<li>
<p>If you want your users to authenticate to Foreman using the CLI, create a client as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name hammer-openidc \
--keycloak-server-url "<em>https://Keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
<div class="paragraph">
<p>Enter the password for the administer account when prompted.
This command creates a client for Foreman in Keycloak.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Restart the <code>httpd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-project-client-in-keycloak_keycloak-totp">13.9.3. Configuring the Foreman Client in Keycloak</h4>
<div class="paragraph">
<p>Use this procedure to configure the Foreman client in the Keycloak web UI and create group and audience mappers for the Foreman client.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Keycloak web UI, navigate to <strong>Clients</strong> and click the Foreman client.</p>
</li>
<li>
<p>Configure access type:</p>
<div class="ulist">
<ul>
<li>
<p>If you want your users to authenticate to Foreman using the Foreman web UI, from the <strong>Access Type</strong> list, select <strong>confidential</strong>.</p>
</li>
<li>
<p>If you want your users to authenticate to Foreman using the CLI, from the <strong>Access Type</strong> list, select <strong>public</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Valid redirect URI</strong> fields, add a valid redirect URI.</p>
<div class="ulist">
<ul>
<li>
<p>If you want your users to authenticate to Foreman using the Foreman web UI, in the blank field below the existing URI, enter a URI in the form <code>https://foreman.example.com/users/extlogin</code>. Note that you must add the string <code>/users/extlogin</code> after the Foreman FQDN.</p>
<div class="paragraph">
<p>After completing this step, the Foreman client for logging in using the Foreman web UI must have the following <strong>Valid Redirect URIs</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://foreman.example.com/users/extlogin/redirect_uri
https://foreman.example.com/users/extlogin</pre>
</div>
</div>
</li>
<li>
<p>If you want your users to authenticate to Foreman using the CLI, in the blank field below the existing URI, enter <strong>urn:ietf:wg:oauth:2.0:oob</strong>.</p>
<div class="paragraph">
<p>After completing this step, the Foreman client for logging in using the CLI must have the following <strong>Valid Redirect URIs</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://foreman.example.com/users/extlogin/redirect_uri
urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Click the <strong>Mappers</strong> tab and click <strong>Create</strong> to add an audience mapper.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the audience mapper.</p>
</li>
<li>
<p>From the <strong>Mapper Type</strong> list, select <strong>Audience</strong>.</p>
</li>
<li>
<p>From the <strong>Included Client Audience</strong> list, select the Foreman client.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Click <strong>Create</strong> to add a group mapper so that you can specify authorization in Foreman based on group membership.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the group mapper.</p>
</li>
<li>
<p>From the <strong>Mapper Type</strong> list, select <strong>Group Membership</strong>.</p>
</li>
<li>
<p>In the <strong>Token Claim Name</strong> field, enter <strong>groups</strong>.</p>
</li>
<li>
<p>Set the <strong>Full group path</strong> setting to OFF.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-project-settings-for-keycloak-authentication_keycloak-totp">13.9.4. Configuring Foreman Settings for Keycloak Authentication</h4>
<div class="paragraph">
<p>Use this section to configure Foreman for Keycloak authentication using the Foreman web UI or the CLI.</p>
</div>
<div class="sect4">
<h5 id="configuring-project-settings-for-keycloak-authentication-using-the-web-ui_keycloak-totp">Configuring Foreman Settings for Keycloak Authentication Using the Web UI</h5>
<div class="paragraph">
<p>Use this procedure to configure Foreman settings for Keycloak authentication using the Foreman web UI.</p>
</div>
<div class="paragraph">
<p>Note that you can navigate to the following URL within your realm to obtain values to configure Foreman settings: <code>https://Keycloak.example.com/auth/realms/Foreman_Realm/.well-known/openid-configuration</code></p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ensure that the <strong>Access Type</strong> setting in the Foreman client in the Keycloak web UI is set to <strong>confidential</strong></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Authentication</strong> tab.</p>
</li>
<li>
<p>Locate the <strong>Authorize login delegation</strong> row, and in the <strong>Value</strong> column, set the value to <strong>Yes</strong>.</p>
</li>
<li>
<p>Locate the <strong>Authorize login delegation auth source user autocreate</strong> row, and in the <strong>Value</strong> column,
set the value to <strong>External</strong>.</p>
</li>
<li>
<p>Locate the <strong>Login delegation logout URL</strong> row, and in the <strong>Value</strong> column, set the value to <strong>https://foreman.example.com/users/extlogout</strong>.</p>
</li>
<li>
<p>Locate the <strong>OIDC Algorithm</strong> row, and in the <strong>Value</strong> column, set the algorithm for encoding on Keycloak to <strong>RS256</strong>.</p>
</li>
<li>
<p>Locate the <strong>OIDC Audience</strong> row, and in the <strong>Value</strong> column, set the value to the client ID for Keycloak.</p>
</li>
<li>
<p>Locate the <strong>OIDC Issuer</strong> row, and in the <strong>Value</strong> column, set the value to <strong><em>https://Keycloak.example.com/auth/realms/Foreman_Realm</em></strong>.</p>
</li>
<li>
<p>Locate the <strong>OIDC JWKs URL</strong> row, and in the <strong>Value</strong> column, set the value to <strong><em>https://Keycloak.example.com/auth/realms/Foreman_Realm/protocol/openid-connect/certs</em></strong>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Authentication Sources</strong> and click <strong>External</strong>.</p>
</li>
<li>
<p>Click <strong>Create LDAP Authentication Source</strong> and select the Keycloak server.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add locations that can use the Keycloak authentication source.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add organizations that can use the Keycloak authentication source.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="configuring-project-settings-for-keycloak-authentication-using-the-cli_keycloak-totp">Configuring Foreman Settings for Keycloak Authentication Using the CLI</h5>
<div class="paragraph">
<p>Use this procedure to configure Foreman settings for Keycloak authentication using the Foreman CLI.</p>
</div>
<div class="paragraph">
<p>Note that you can navigate to the following URL within your realm to obtain values to configure Foreman settings: <code>https://Keycloak.example.com/auth/realms/Foreman_Realm/.well-known/openid-configuration</code></p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ensure that the <strong>Access Type</strong> setting in the Foreman client in the Keycloak web UI is set to <strong>public</strong></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman, set the login delegation to <code>true</code> so that users can authenticate using the Open IDC protocol:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name authorize_login_delegation --value true</pre>
</div>
</div>
</li>
<li>
<p>Set the login delegation logout URL:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name login_delegation_logout_url \
--value https://foreman.example.com/users/extlogout</pre>
</div>
</div>
</li>
<li>
<p>Set the algorithm for encoding on Keycloak, for example, <code>RS256</code>:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name oidc_algorithm --value 'RS256'</pre>
</div>
</div>
</li>
<li>
<p>Open the <code><em>Keycloak.example.com</em>/auth/realms/<em>Keycloak_REALM</em>/.well-known/openid-configuration</code> URL and note the values to populate the options in the following steps.</p>
</li>
<li>
<p>Add the value for the Hammer client in the Open IDC audience:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you register several Keycloak clients to Foreman, ensure that you append all audiences in the array.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-foreman-openidc', '<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set the value for the Open IDC issuer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_issuer \
--value "<em>Keycloak.example.com</em>/auth/realms/<em>Keycloak_Realm</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set the value for Open IDC Java Web Token (JWT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_jwks_url \
--value "<em>Keycloak.example.com</em>/auth/realms/<em>Keycloak_Realm</em>/protocol/openid-connect/certs"</pre>
</div>
</div>
</li>
<li>
<p>Retrieve the ID of the Keycloak authentication source:</p>
<div class="listingblock">
<div class="content">
<pre># hammer auth-source external list</pre>
</div>
</div>
</li>
<li>
<p>Set the location and organization:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth-source external update --id <em>Authentication Source ID</em> \
--location-ids <em>Location ID</em> --organization-ids <em>Organization ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-project-with-keycloak-for-totp-authentication_keycloak-totp">13.9.5. Configuring Foreman with Keycloak for TOTP Authentication</h4>
<div class="paragraph">
<p>Use this procedure to configure Foreman to use Keycloak as an OpenID provider for external authentication with Time-based One-time Password (TOTP).</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Keycloak web UI, navigate to the Foreman realm.</p>
</li>
<li>
<p>Navigate to <strong>Authentication</strong>, and click the <strong>OTP Policy</strong> tab.</p>
</li>
<li>
<p>Ensure that the <strong>Supported Applications</strong> field includes FreeOTP or Google Authenticator.</p>
</li>
<li>
<p>Configure the OTP settings to suit your requirements.</p>
</li>
<li>
<p>Optional: If you want to use TOTP authentication as a default authentication method for all users, click the <strong>Flows</strong> tab, and to the right of the <strong>OTP Form</strong> setting, select <strong>REQUIRED</strong>.</p>
</li>
<li>
<p>Click the <strong>Required Actions</strong> tab.</p>
</li>
<li>
<p>To the right of the <strong>Configure OTP</strong> row, select the <strong>Default Action</strong> check box.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="logging-in-to-the-project-web-ui-using-keycloak-totp-authentication_keycloak-totp">13.9.6. Logging in to the Foreman web UI Using Keycloak TOTP Authentication</h4>
<div class="paragraph">
<p>Use this procedure to log in to the Foreman web UI using Keycloak TOTP authentication.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to Foreman, Foreman redirects you to the Keycloak login screen.</p>
</li>
<li>
<p>Enter your username and password, and click <strong>Log In</strong>.</p>
</li>
<li>
<p>The first attempt to log in, Keycloak requests you to configure your client by scanning the barcode and entering the pin displayed.</p>
</li>
<li>
<p>After you configure your client and enter a valid PIN, Keycloak redirects you to Foreman and
logs you in.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="logging-in-to-the-project-cli-using-keycloak_keycloak-totp">13.9.7. Logging in to the Foreman CLI Using Keycloak</h4>
<div class="paragraph">
<p>Use this procedure to authenticate to the Foreman CLI using the code grant type.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To authenticate to the Foreman CLI using the code grant type, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--two-factor \
--oidc-token-endpoint 'https://<em>Keycloak.example.com</em>/auth/realms/ssl-realm/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>Keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-foreman-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
<div class="paragraph">
<p>The command prompts you to enter a success code.</p>
</div>
</li>
<li>
<p>To retrieve the success code, navigate to the URL that the command returns and provide the required information.</p>
</li>
<li>
<p>Copy the success code that the web UI returns.</p>
</li>
<li>
<p>In the command prompt of <code>hammer auth login oauth</code>, enter the success code to authenticate to the Foreman CLI.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-group-mapping-for-keycloak-authentication_keycloak-totp">13.9.8. Configuring Group Mapping for Keycloak Authentication</h4>
<div class="paragraph">
<p>Optionally, to implement the Role Based Access Control (RBAC), create a group in Foreman, assign a role to this group, and then map an Active Directory group to the Foreman group.
As a result, anyone in the given group in Keycloak are logged in under the corresponding Foreman group.
This example configures users of the Foreman-admin user group in the Active Directory to authenticate as users with administrator privileges on Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>, and click the <strong>Create User Group</strong> button.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the user group.
The name should not be the same as in the Active Directory.</p>
</li>
<li>
<p>Do not add users and user groups to the right-hand columns.
Click the <strong>Roles</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Administer</strong> check box.</p>
</li>
<li>
<p>Click the <strong>External Groups</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add external user group</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name of the Active Directory group.</p>
</li>
<li>
<p>From the list, select <strong>EXTERNAL</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-keycloak-authentication-with-cac-cards_admin">13.10. Configuring Keycloak Authentication with PIV Cards</h3>
<div class="paragraph">
<p>Use this section to configure Foreman to use Keycloak as an OpenID provider for external authentication with PIV cards.</p>
</div>
<div class="sect3">
<h4 id="prerequisites-for-integrating-project-with-keycloak_keycloak-cac-cards">13.10.1. Prerequisites for Configuring Foreman with Keycloak Authentication</h4>
<div class="paragraph">
<p>Before configuring Foreman with Keycloak external authentication, ensure that you meet the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A working installation of Keycloak server that uses HTTPS instead of HTTP.</p>
</li>
<li>
<p>A Keycloak account with admin privileges.</p>
</li>
<li>
<p>A realm for Foreman user accounts created in Keycloak.</p>
</li>
<li>
<p>If the certificates or the CA are self-signed, ensure that they are added to the end-user certificate trust store.</p>
</li>
<li>
<p>Users imported or added to Keycloak.</p>
<div class="paragraph">
<p>If you have an existing user database configured such as LDAP or Kerberos, you can import users from it by configuring user federation.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user-storage-federation">User Storage Federation</a> in the <em>Red&#160;Hat Single Sign-On Server Administration Guide</em>.</p>
</div>
<div class="paragraph">
<p>If you do not have an existing user database configured, you can manually create users in Keycloak.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user_management#create-new-user">Creating New Users</a> in the <em>Red&#160;Hat Single Sign-On Server Administration Guide</em>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="registering-project-as-a-keycloak-client_keycloak-cac-cards">13.10.2. Registering Foreman as a Keycloak Client</h4>
<div class="paragraph">
<p>Use this procedure to register Foreman to Keycloak as a client and configure Foreman to use Keycloak as an authentication source.</p>
</div>
<div class="paragraph">
<p>You can configure Foreman and Keycloak with two different authentication methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Users authenticate to Foreman using the Foreman web UI.</p>
</li>
<li>
<p>Users authenticate to Foreman using the Foreman CLI.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You must decide on how you want your users to authenticate in advance because both methods require different Foreman clients to be registered to Keycloak and configured.
The steps to register and configure Foreman client in Keycloak are distinguished within the procedure.</p>
</div>
<div class="paragraph">
<p>You can also register two different Foreman clients to Keycloak if you want to use both authentication methods and configure both clients accordingly.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the Foreman server, install the following packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install mod_auth_openidc keycloak-httpd-client-install</pre>
</div>
</div>
</li>
<li>
<p>Register Foreman to Keycloak as a client.
Note that you the registration process for logging in using the web UI and the CLI are different.
You can register two clients Foreman clients to Keycloak to be able to log in to Foreman from the web UI and the CLI.</p>
<div class="ulist">
<ul>
<li>
<p>If you want you users to authenticate to Foreman using the web UI, create a client as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name foreman-openidc \
--keycloak-server-url "<em>https://Keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
<div class="paragraph">
<p>Enter the password for the administer account when prompted.
This command creates a client for Foreman in Keycloak.</p>
</div>
<div class="paragraph">
<p>Then, configure Foreman to use Keycloak as an authentication source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "foreman-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
<li>
<p>If you want your users to authenticate to Foreman using the CLI, create a client as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name hammer-openidc \
--keycloak-server-url "<em>https://Keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
<div class="paragraph">
<p>Enter the password for the administer account when prompted.
This command creates a client for Foreman in Keycloak.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Restart the <code>httpd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-project-client-in-keycloak_keycloak-cac-cards">13.10.3. Configuring the Foreman Client in Keycloak</h4>
<div class="paragraph">
<p>Use this procedure to configure the Foreman client in the Keycloak web UI and create group and audience mappers for the Foreman client.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Keycloak web UI, navigate to <strong>Clients</strong> and click the Foreman client.</p>
</li>
<li>
<p>Configure access type:</p>
<div class="ulist">
<ul>
<li>
<p>If you want your users to authenticate to Foreman using the Foreman web UI, from the <strong>Access Type</strong> list, select <strong>confidential</strong>.</p>
</li>
<li>
<p>If you want your users to authenticate to Foreman using the CLI, from the <strong>Access Type</strong> list, select <strong>public</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Valid redirect URI</strong> fields, add a valid redirect URI.</p>
<div class="ulist">
<ul>
<li>
<p>If you want your users to authenticate to Foreman using the Foreman web UI, in the blank field below the existing URI, enter a URI in the form <code>https://foreman.example.com/users/extlogin</code>. Note that you must add the string <code>/users/extlogin</code> after the Foreman FQDN.</p>
<div class="paragraph">
<p>After completing this step, the Foreman client for logging in using the Foreman web UI must have the following <strong>Valid Redirect URIs</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://foreman.example.com/users/extlogin/redirect_uri
https://foreman.example.com/users/extlogin</pre>
</div>
</div>
</li>
<li>
<p>If you want your users to authenticate to Foreman using the CLI, in the blank field below the existing URI, enter <strong>urn:ietf:wg:oauth:2.0:oob</strong>.</p>
<div class="paragraph">
<p>After completing this step, the Foreman client for logging in using the CLI must have the following <strong>Valid Redirect URIs</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://foreman.example.com/users/extlogin/redirect_uri
urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Click the <strong>Mappers</strong> tab and click <strong>Create</strong> to add an audience mapper.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the audience mapper.</p>
</li>
<li>
<p>From the <strong>Mapper Type</strong> list, select <strong>Audience</strong>.</p>
</li>
<li>
<p>From the <strong>Included Client Audience</strong> list, select the Foreman client.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Click <strong>Create</strong> to add a group mapper so that you can specify authorization in Foreman based on group membership.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the group mapper.</p>
</li>
<li>
<p>From the <strong>Mapper Type</strong> list, select <strong>Group Membership</strong>.</p>
</li>
<li>
<p>In the <strong>Token Claim Name</strong> field, enter <strong>groups</strong>.</p>
</li>
<li>
<p>Set the <strong>Full group path</strong> setting to OFF.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-project-settings-for-keycloak-authentication_keycloak-cac-cards">13.10.4. Configuring Foreman Settings for Keycloak Authentication</h4>
<div class="paragraph">
<p>Use this section to configure Foreman for Keycloak authentication using the Foreman web UI or the CLI.</p>
</div>
<div class="sect4">
<h5 id="configuring-project-settings-for-keycloak-authentication-using-the-web-ui_keycloak-cac-cards">Configuring Foreman Settings for Keycloak Authentication Using the Web UI</h5>
<div class="paragraph">
<p>Use this procedure to configure Foreman settings for Keycloak authentication using the Foreman web UI.</p>
</div>
<div class="paragraph">
<p>Note that you can navigate to the following URL within your realm to obtain values to configure Foreman settings: <code>https://Keycloak.example.com/auth/realms/Foreman_Realm/.well-known/openid-configuration</code></p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ensure that the <strong>Access Type</strong> setting in the Foreman client in the Keycloak web UI is set to <strong>confidential</strong></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Authentication</strong> tab.</p>
</li>
<li>
<p>Locate the <strong>Authorize login delegation</strong> row, and in the <strong>Value</strong> column, set the value to <strong>Yes</strong>.</p>
</li>
<li>
<p>Locate the <strong>Authorize login delegation auth source user autocreate</strong> row, and in the <strong>Value</strong> column,
set the value to <strong>External</strong>.</p>
</li>
<li>
<p>Locate the <strong>Login delegation logout URL</strong> row, and in the <strong>Value</strong> column, set the value to <strong>https://foreman.example.com/users/extlogout</strong>.</p>
</li>
<li>
<p>Locate the <strong>OIDC Algorithm</strong> row, and in the <strong>Value</strong> column, set the algorithm for encoding on Keycloak to <strong>RS256</strong>.</p>
</li>
<li>
<p>Locate the <strong>OIDC Audience</strong> row, and in the <strong>Value</strong> column, set the value to the client ID for Keycloak.</p>
</li>
<li>
<p>Locate the <strong>OIDC Issuer</strong> row, and in the <strong>Value</strong> column, set the value to <strong><em>https://Keycloak.example.com/auth/realms/Foreman_Realm</em></strong>.</p>
</li>
<li>
<p>Locate the <strong>OIDC JWKs URL</strong> row, and in the <strong>Value</strong> column, set the value to <strong><em>https://Keycloak.example.com/auth/realms/Foreman_Realm/protocol/openid-connect/certs</em></strong>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Authentication Sources</strong> and click <strong>External</strong>.</p>
</li>
<li>
<p>Click <strong>Create LDAP Authentication Source</strong> and select the Keycloak server.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add locations that can use the Keycloak authentication source.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add organizations that can use the Keycloak authentication source.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="configuring-project-settings-for-keycloak-authentication-using-the-cli_keycloak-cac-cards">Configuring Foreman Settings for Keycloak Authentication Using the CLI</h5>
<div class="paragraph">
<p>Use this procedure to configure Foreman settings for Keycloak authentication using the Foreman CLI.</p>
</div>
<div class="paragraph">
<p>Note that you can navigate to the following URL within your realm to obtain values to configure Foreman settings: <code>https://Keycloak.example.com/auth/realms/Foreman_Realm/.well-known/openid-configuration</code></p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ensure that the <strong>Access Type</strong> setting in the Foreman client in the Keycloak web UI is set to <strong>public</strong></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman, set the login delegation to <code>true</code> so that users can authenticate using the Open IDC protocol:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name authorize_login_delegation --value true</pre>
</div>
</div>
</li>
<li>
<p>Set the login delegation logout URL:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name login_delegation_logout_url \
--value https://foreman.example.com/users/extlogout</pre>
</div>
</div>
</li>
<li>
<p>Set the algorithm for encoding on Keycloak, for example, <code>RS256</code>:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name oidc_algorithm --value 'RS256'</pre>
</div>
</div>
</li>
<li>
<p>Open the <code><em>Keycloak.example.com</em>/auth/realms/<em>Keycloak_REALM</em>/.well-known/openid-configuration</code> URL and note the values to populate the options in the following steps.</p>
</li>
<li>
<p>Add the value for the Hammer client in the Open IDC audience:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you register several Keycloak clients to Foreman, ensure that you append all audiences in the array.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-foreman-openidc', '<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set the value for the Open IDC issuer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_issuer \
--value "<em>Keycloak.example.com</em>/auth/realms/<em>Keycloak_Realm</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set the value for Open IDC Java Web Token (JWT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_jwks_url \
--value "<em>Keycloak.example.com</em>/auth/realms/<em>Keycloak_Realm</em>/protocol/openid-connect/certs"</pre>
</div>
</div>
</li>
<li>
<p>Retrieve the ID of the Keycloak authentication source:</p>
<div class="listingblock">
<div class="content">
<pre># hammer auth-source external list</pre>
</div>
</div>
</li>
<li>
<p>Set the location and organization:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth-source external update --id <em>Authentication Source ID</em> \
--location-ids <em>Location ID</em> --organization-ids <em>Organization ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-cac-cards">13.10.5. Configuring Keycloak Settings for Authentication With PIV Cards</h4>
<div class="paragraph">
<p>You must configure Keycloak settings for authentication with PIV cards.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Keycloak web UI, navigate to the <strong>Authentication</strong> tab.</p>
</li>
<li>
<p>From the <strong>Flows</strong> list, select <strong>Browser</strong>.</p>
</li>
<li>
<p>Click <strong>Copy</strong> to copy this flow.</p>
</li>
<li>
<p>In the <strong>Copy Authentication Flow</strong> window, enter a new name for the flow and click <strong>OK</strong>.</p>
</li>
<li>
<p>In the copied flow, delete <strong>Username Password Form</strong> and <strong>OTP Form</strong> entries.</p>
</li>
<li>
<p>Click <strong>Add execution</strong>.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>X509/Validate Username Form</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>In the <strong>X509/Validate Username Form</strong> raw, select <strong>ALTERNATIVE</strong>.</p>
</li>
<li>
<p>In the <strong>X509/Validate Username Form</strong> raw, click <strong>Actions</strong> &gt; <strong>Config</strong>.</p>
</li>
<li>
<p>In the <strong>Alias</strong> field, enter a name for this configuration.</p>
</li>
<li>
<p>From the <strong>User Identity Source</strong> list, select <strong>Subject’s Common Name</strong>,</p>
</li>
<li>
<p>From the <strong>User mapping method</strong> list, select <strong>Username or Email</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Authentication</strong> &gt; <strong>Bindings</strong>.</p>
</li>
<li>
<p>From the <strong>Browser Flow</strong> list, select the created flow.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-users-os-for-keycloak-authentication-with-cac-cards_keycloak-cac-cards">13.10.6. Configuring Users' OS for Keycloak Authentication with PIV Cards</h4>
<div class="paragraph">
<p>Complete this procedure on each system from which you want to be able to log in to Foreman using Keycloak PIV cards.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install required packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">yum install opensc -y</pre>
</div>
</div>
</li>
<li>
<p>Install the Firefox browser if not installed.</p>
</li>
<li>
<p>Launch Firefox and navigate to <strong>Preferences</strong>.</p>
</li>
<li>
<p>Click the <strong>Privacy and Security</strong> tab.</p>
</li>
<li>
<p>Click <strong>Security Devices</strong>.</p>
</li>
<li>
<p>Click <strong>Load</strong>.</p>
</li>
<li>
<p>In the Load PKCS#11 Device Driver window, in the <strong>Module Name</strong> field, enter a name for this device.</p>
</li>
<li>
<p>In the <strong>Module filename</strong> field, enter <strong>/usr/lib64/pkcs11/opensc-pkcs11.so</strong>.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
<li>
<p>If the PIV card is connected to system, restart the <code>pcscd</code> service.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="logging-in-to-the-project-web-ui-using-keycloak-cac-cards_keycloak-cac-cards">13.10.7. Logging in to the Foreman web UI Using Keycloak PIV Cards</h4>
<div class="paragraph">
<p>Use this procedure to log in to the Foreman web UI using the Keycloak PIV cards.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Firefox, log in to Foreman and enter your credentials.</p>
</li>
<li>
<p>When prompted, enter the PIN of the PIV card.</p>
</li>
<li>
<p>Choose the certificate for authentication.
Browser verifies this certificate with Keycloak.
Once authenticated, browser redirects you back to Foreman and logs you in.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="logging-in-to-the-project-cli-using-keycloak_keycloak-cac-cards">13.10.8. Logging in to the Foreman CLI Using Keycloak</h4>
<div class="paragraph">
<p>Use this procedure to authenticate to the Foreman CLI using the code grant type.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To authenticate to the Foreman CLI using the code grant type, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--two-factor \
--oidc-token-endpoint 'https://<em>Keycloak.example.com</em>/auth/realms/ssl-realm/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>Keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-foreman-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
<div class="paragraph">
<p>The command prompts you to enter a success code.</p>
</div>
</li>
<li>
<p>To retrieve the success code, navigate to the URL that the command returns and provide the required information.</p>
</li>
<li>
<p>Copy the success code that the web UI returns.</p>
</li>
<li>
<p>In the command prompt of <code>hammer auth login oauth</code>, enter the success code to authenticate to the Foreman CLI.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-group-mapping-for-keycloak-authentication_keycloak-cac-cards">13.10.9. Configuring Group Mapping for Keycloak Authentication</h4>
<div class="paragraph">
<p>Optionally, to implement the Role Based Access Control (RBAC), create a group in Foreman, assign a role to this group, and then map an Active Directory group to the Foreman group.
As a result, anyone in the given group in Keycloak are logged in under the corresponding Foreman group.
This example configures users of the Foreman-admin user group in the Active Directory to authenticate as users with administrator privileges on Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>, and click the <strong>Create User Group</strong> button.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the user group.
The name should not be the same as in the Active Directory.</p>
</li>
<li>
<p>Do not add users and user groups to the right-hand columns.
Click the <strong>Roles</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Administer</strong> check box.</p>
</li>
<li>
<p>Click the <strong>External Groups</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add external user group</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name of the Active Directory group.</p>
</li>
<li>
<p>From the list, select <strong>EXTERNAL</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="disabling-keycloak-authentication_admin">13.11. Disabling Keycloak Authentication</h3>
<div class="paragraph">
<p>If you want to disable Keycloak authentication in Foreman, complete this procedure.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the following command to disable Keycloak Authentication:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --reset-foreman-keycloak</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Administering-Monitoring_Resources">14. Monitoring Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following chapter details how to configure monitoring and reporting for managed systems.
This includes host configuration, content views, compliance, subscriptions, registered hosts, promotions and synchronization.</p>
</div>
<div class="sect2">
<h3 id="chap-Administering-Using_the_Red_Hat_Satellite_Content_Dashboard">14.1. Using the Foreman Content Dashboard</h3>
<div class="paragraph">
<p>The Foreman content dashboard contains various widgets which provide an overview of the host configuration, Content Views, compliance reports, subscriptions and hosts currently registered, promotions and synchronization, and a list of the latest notifications.</p>
</div>
<div class="paragraph">
<p>Navigate to <strong>Monitor</strong> &gt; <strong>Dashboard</strong> to access the content dashboard.
The dashboard can be rearranged by clicking on a widget and dragging it to a different position.
The following widgets are available:</p>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Host_Configuration_Status" class="dlist">
<dl>
<dt class="hdlist1"><strong>Host Configuration Status</strong></dt>
<dd>
<p>An overview of the configuration states and the number of hosts associated with it during the last reporting interval.
The following table shows the descriptions of the possible configuration states.</p>
<table id="tabl-Administering-Host_Configuration_Status-Host_Configuration_Status" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Host Configuration States</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Icon</th>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/1.png" alt="1"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts that had performed modifications without error</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host that successfully performed modifications during the last reporting interval.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/2.png" alt="2"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts in error state</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts on which an error was detected during the last reporting interval.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/3.png" alt="3"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Good host reports in the last 35 minutes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts without error that did not perform any modifications in the last 35 minutes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/4.png" alt="4"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts that had pending changes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts on which some resources would be applied but Puppet was configured to run in the <code>noop</code> mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/5.png" alt="5"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Out of sync hosts</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts that were not synchronized and the report was not received during the last reporting interval.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/6.png" alt="6"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts with no reports</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts for which no reports were collected during the last reporting interval.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/7.png" alt="7"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts with alerts disabled</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts which are not being monitored.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Click the particular configuration status to view hosts associated with it.</p>
</div>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Host_Configuration_Chart" class="dlist">
<dl>
<dt class="hdlist1"><strong>Host Configuration Chart</strong></dt>
<dd>
<p>A pie chart shows the proportion of the configuration status and the percentage of all hosts associated with it.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Latest_Notifications" class="dlist">
<dl>
<dt class="hdlist1"><strong>Latest Events</strong></dt>
<dd>
<p>A list of messages produced by hosts including administration information, product and subscription changes, and any errors.</p>
<div class="paragraph">
<p>Monitor this section for global notifications sent to all users and to detect any unusual activity or errors.</p>
</div>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Run_Distribution" class="dlist">
<dl>
<dt class="hdlist1"><strong>Run Distribution (last 30 minutes)</strong></dt>
<dd>
<p>A graph shows the distribution of the running Puppet agents during the last puppet interval which is 30 minutes by default.
In this case, each column represents a number of reports received from clients during 3 minutes.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-New_Hosts" class="dlist">
<dl>
<dt class="hdlist1"><strong>New Hosts</strong></dt>
<dd>
<p>A list of the recently created hosts.
Click the host for more details.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Task_Status" class="dlist">
<dl>
<dt class="hdlist1"><strong>Task Status</strong></dt>
<dd>
<p>A summary of all current tasks, grouped by their state and result.
Click the number to see the list of corresponding tasks.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Latest_Warning-Error_Tasks" class="dlist">
<dl>
<dt class="hdlist1"><strong>Latest Warning/Error Tasks</strong></dt>
<dd>
<p>A list of the latest tasks that have been stopped due to a warning or error.
Click a task to see more details.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Discovered_Hosts" class="dlist">
<dl>
<dt class="hdlist1"><strong>Discovered Hosts</strong></dt>
<dd>
<p>A list of all bare-metal hosts detected on the provisioning network by the Discovery plug-in.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Latest_Errata" class="dlist">
<dl>
<dt class="hdlist1"><strong>Latest Errata</strong></dt>
<dd>
<p>A list of all errata available for hosts registered to Foreman.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Content_Views" class="dlist">
<dl>
<dt class="hdlist1"><strong>Content Views</strong></dt>
<dd>
<p>A list of all Content Views in Foreman and their publish status.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Sync_Overview" class="dlist">
<dl>
<dt class="hdlist1"><strong>Sync Overview</strong></dt>
<dd>
<p>An overview of all products or repositories enabled in Foreman and their synchronization status.
All products that are in the queue for synchronization, are unsynchronized or have been previously synchronized are listed in this section.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Host_Subscription_Status" class="dlist">
<dl>
<dt class="hdlist1"><strong>Host Subscription Status</strong></dt>
<dd>
<p>An overview of the subscriptions currently consumed by the hosts registered to Foreman.
A subscription is a purchased certificate that unlocks access to software, upgrades, and security fixes for hosts.
The following table shows the possible states of subscriptions.</p>
<table id="tabl-Administering-Host_Subscription_Status-Host_Subscription_States" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Host Subscription States</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Icon</th>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/1229.png" alt="1229"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Invalid</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts that have products installed, but are not correctly subscribed.
These hosts need attention immediately.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/1230.png" alt="1230"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Partial</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts that have a subscription and a valid entitlement, but are not using their full entitlements.
These hosts should be monitored to ensure they are configured as expected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/1228.png" alt="1228"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valid</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts that have a valid entitlement and are using their full entitlements.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Click the subscription type to view hosts associated with subscriptions of the selected type.</p>
</div>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Subscription_Status" class="dlist">
<dl>
<dt class="hdlist1"><strong>Subscription Status</strong></dt>
<dd>
<p>An overview of the current subscription totals that shows the number of active subscriptions, the number of subscriptions that expire in the next 120 days, and the number of subscriptions that have recently expired.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Host_Collections" class="dlist">
<dl>
<dt class="hdlist1"><strong>Host Collections</strong></dt>
<dd>
<p>A list of all host collections in Foreman and their status, including the number of content hosts in each host collection.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Virt-who_Configuration_Status" class="dlist">
<dl>
<dt class="hdlist1"><strong>Virt-who Configuration Status</strong></dt>
<dd>
<p>An overview of the status of reports received from the <code>virt-who</code> daemon running on hosts in the environment.
The following table shows the possible states.</p>
<table id="tabl-Administering-Virt-who_Configuration_Status-Virt-who_Configuration_States" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Virt-who Configuration States</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>No Reports</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No report has been received because either an error occurred during the virt-who configuration deployment, or the configuration has not been deployed yet, or virt-who cannot connect to Foreman during the scheduled interval.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>No Change</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No report has been received because hypervisor did not detect any changes on the virtual machines, or virt-who failed to upload the reports during the scheduled interval.
If you added a virtual machine but the configuration is in the <strong>No Change</strong> state, check that virt-who is running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The report has been received without any errors during the scheduled interval.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Total Configurations</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A total number of virt-who configurations.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Click the configuration status to see all configurations in this state.</p>
</div>
<div class="paragraph">
<p>The widget also lists the three latest configurations in the <strong>No Change</strong> state under <strong>Latest Configurations Without Change</strong>.</p>
</div>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Latest_Compliance_Reports" class="dlist">
<dl>
<dt class="hdlist1"><strong>Latest Compliance Reports</strong></dt>
<dd>
<p>A list of the latest compliance reports.
Each compliance report shows a number of rules passed (P), failed (F), or othered (O).
Click the host for the detailed compliance report.
Click the policy for more details on that policy.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Compliance_Reports_Breakdown" class="dlist">
<dl>
<dt class="hdlist1"><strong>Compliance Reports Breakdown</strong></dt>
<dd>
<p>A pie chart shows the distribution of compliance reports according to their status.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Red_Hat_Insights_Actions" class="dlist">
<dl>
<dt class="hdlist1"><strong>Red&#160;Hat Insights Actions</strong></dt>
<dd>
<p>Red&#160;Hat Insights is a tool embedded in Foreman that checks the environment and suggests actions you can take.
The actions are divided into 4 categories: Availability, Stability, Performance, and Security.</p>
</dd>
</dl>
</div>
<div id="varl-Administering-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Red_Hat_Insights_Risk_Summary" class="dlist">
<dl>
<dt class="hdlist1"><strong>Red&#160;Hat Insights Risk Summary</strong></dt>
<dd>
<p>A table shows the distribution of the actions according to the risk levels.
Risk level represents how critical the action is and how likely it is to cause an actual issue.
The possible risk levels are: Low, Medium, High, and Critical.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>It is not possible to change the date format displayed in the Foreman web UI.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="sect-Administering-Using_the_Red_Hat_Satellite_Content_Dashboard-Managing_Tasks">14.1.1. Managing Tasks</h4>
<div class="paragraph">
<p>Foreman keeps a complete log of all planned or performed tasks, such as repositories synchronised, errata applied, and Content Views published.
To review the log, navigate to <strong>Monitor</strong> &gt; <strong>Tasks</strong>.</p>
</div>
<div class="paragraph">
<p>In the Task window, you can search for specific tasks, view their status, details, and elapsed time since they started.
You can also cancel and resume one or more tasks.</p>
</div>
<div class="paragraph">
<p>The tasks are managed using the Dynflow engine.
Remote tasks have a timeout which can be adjusted as needed.</p>
</div>
<div id="proc-Administering-Using_the_Red_Hat_Satellite_Content_Dashboard-Managing_Tasks-To_Adjust_Timeout_Settings" class="olist arabic">
<div class="title">To Adjust Timeout Settings:</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Enter <em>%_timeout</em> in the search box and click <strong>Search</strong>.
The search should return four settings, including a description.</p>
</li>
<li>
<p>In the <strong>Value</strong> column, click the icon next to a number to edit it.</p>
</li>
<li>
<p>Enter the desired value in seconds, and click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Adjusting the <em>%_finish_timeout</em> values might help in case of low bandwidth.
Adjusting the <em>%_accept_timeout</em> values might help in case of high latency.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a task is initialized, any back-end service that will be used in the task, such as Candlepin or Pulp, will be checked for correct functioning.
If the check fails, you will receive an error similar to the following one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">There was an issue with the backend service candlepin: Connection refused – connect(2).</pre>
</div>
</div>
<div class="paragraph">
<p>If the back-end service checking feature turns out to be causing any trouble, it can be disabled as follows.</p>
</div>
<div id="proc-Administering-Using_the_Red_Hat_Satellite_Content_Dashboard-Managing_Tasks-To_Disable_Checking_For_Services" class="olist arabic">
<div class="title">To Disable Checking for Services:</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Enter <em>check_services_before_actions</em> in the search box and click <strong>Search</strong>.</p>
</li>
<li>
<p>In the <strong>Value</strong> column, click the icon to edit the value.</p>
</li>
<li>
<p>From the drop-down menu, select <strong>false</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Configuring_RSS_Notifications">14.2. Configuring RSS Notifications</h3>
<div class="paragraph">
<p>To view Foreman event notification alerts, click the <strong>Notifications</strong> icon in the upper right of the screen.</p>
</div>
<div class="paragraph">
<p>By default, the Notifications area displays RSS feed events published in the <a href="https://theforeman.org/blog/">Foreman Blog</a>.</p>
</div>
<div class="paragraph">
<p>The feed is refreshed every 12 hours and the Notifications area is updated whenever new events become available.</p>
</div>
<div class="paragraph">
<p>You can configure the RSS feed notifications by changing the URL feed.
The supported feed format is RSS 2.0 and Atom.
For an example of the RSS 2.0 feed structure, see the <a href="https://access.redhat.com/blogs/1169563/feed">Foreman Blog feed</a>.
For an example of the Atom feed structure, see the <a href="https://theforeman.org/feed.xml">Foreman blog feed</a>.</p>
</div>
<div id="proc-Administering-Configuring_the_Notifications_Drawer-To_Configure_an_RSS_Feed_to_Notifications" class="olist arabic">
<div class="title">To Configure RSS Feed Notifications:</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and select the <strong>Notifications</strong> tab.</p>
</li>
<li>
<p>In the RSS URL row, click the edit icon in the <strong>Value</strong> column and type the required URL.</p>
</li>
<li>
<p>In the RSS enable row, click the edit icon in the <strong>Value</strong> column to enable or disable this feature.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Monitoring_Satellite_Server">14.3. Monitoring Foreman&#160;server</h3>
<div class="paragraph">
<p>From the <strong>About</strong> page in Foreman&#160;server web UI, you can find an overview of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>System Status, including Smart&#160;Proxies, Available Providers, Compute Resources, and Plug-ins</p>
</li>
<li>
<p>Support information</p>
</li>
<li>
<p>System Information</p>
</li>
<li>
<p>Backend System Status</p>
</li>
<li>
<p>Installed packages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To navigate to the <strong>About</strong> page:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the upper right corner of Foreman&#160;server web UI, click <strong>Administer</strong> &gt; <strong>About</strong>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>After Pulp failure, the status of Pulp might show <strong>OK</strong> instead of <strong>Error</strong> for up to 10 minutes due to synchronization delay.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="chap-Administering-Monitoring_Capsule_Servers">14.4. Monitoring Smart&#160;Proxy&#160;server</h3>
<div class="paragraph">
<p>The following section shows how to use the Foreman web UI to find Smart&#160;Proxy information valuable for maintenance and troubleshooting.</p>
</div>
<div class="sect3">
<h4 id="sect-Administering-Viewing_Capsule_Details">14.4.1. Viewing General Smart&#160;Proxy Information</h4>
<div class="paragraph">
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong> to view a table of Smart&#160;Proxy&#160;servers registered to Foreman&#160;server.
The information contained in the table answers the following questions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Is Smart&#160;Proxy&#160;server running?</strong></dt>
<dd>
<p>This is indicated by a green icon in the <strong>Status</strong> column.
A red icon indicates an inactive Smart&#160;Proxy, use the <code>service foreman-proxy restart</code> command on Smart&#160;Proxy&#160;server to activate it.</p>
</dd>
<dt class="hdlist1"><strong>What services are enabled on Smart&#160;Proxy&#160;server?</strong></dt>
<dd>
<p>In the <strong>Features</strong> column you can verify if Smart&#160;Proxy for example provides a DHCP service or acts as a Pulp mirror.
Smart&#160;Proxy features can be enabled during installation or configured in addition.
For more information, see <a href="https://docs.theforeman.org/3.0/Installing_Proxy_on_Red_Hat/index-foreman-el.html#">Installing Smart&#160;Proxy&#160;server</a>.</p>
</dd>
<dt class="hdlist1"><strong>What organizations and locations is Smart&#160;Proxy&#160;server assigned to?</strong></dt>
<dd>
<p>A Smart&#160;Proxy&#160;server can be assigned to multiple organizations and locations, but only Smart&#160;Proxies belonging to the currently selected organization are displayed.
To list all Smart&#160;Proxies, select <strong>Any Organization</strong> from the context menu in the top left corner.</p>
<div class="paragraph">
<p>After changing the Smart&#160;Proxy configuration, select <strong>Refresh</strong> from the drop-down menu in the <strong>Actions</strong> column to make sure the Smart&#160;Proxy table is up to date.</p>
</div>
<div class="paragraph">
<p>Click the Smart&#160;Proxy name to view further details.
At the <strong>Overview</strong> tab, you can find the same information as in the Smart&#160;Proxy table.
In addition, you can answer to the following questions:</p>
</div>
</dd>
<dt class="hdlist1"><strong>Which hosts are managed by Smart&#160;Proxy&#160;server?</strong></dt>
<dd>
<p>The number of associated hosts is displayed next to the <strong>Hosts managed</strong> label.
Click the number to view the details of associated hosts.</p>
</dd>
<dt class="hdlist1"><strong>How much storage space is available on Smart&#160;Proxy&#160;server?</strong></dt>
<dd>
<p>The amount of storage space occupied by the Pulp content in <code>/var/lib/pulp</code> is displayed.
Also the remaining storage space available on the Smart&#160;Proxy can be ascertained.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect-Administering-Monitoring_Services">14.4.2. Monitoring Services</h4>
<div class="paragraph">
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong> and click the name of the selected Smart&#160;Proxy.
At the <strong>Services</strong> tab, you can find basic information on Smart&#160;Proxy services, such as the list of DNS domains, or the number of Pulp workers.
The appearance of the page depends on what services are enabled on Smart&#160;Proxy&#160;server.
Services providing more detailed status information can have dedicated tabs at the Smart&#160;Proxy page (see <a href="#sect-Administering-Monitoring_Puppet">Monitoring Puppet</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-Administering-Monitoring_Puppet">14.4.3. Monitoring Puppet</h4>
<div class="paragraph">
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong> and click the name of the selected Smart&#160;Proxy.
At the <strong>Puppet</strong> tab you can find the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A summary of Puppet events, an overview of latest Puppet runs, and the synchronization status of associated hosts at the <strong>General</strong> sub-tab.</p>
</li>
<li>
<p>A list of Puppet environments at the <strong>Environments</strong> sub-tab.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the <strong>Puppet CA</strong> tab you can find the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A certificate status overview and the number of autosign entries at the <strong>General</strong> sub-tab.</p>
</li>
<li>
<p>A table of CA certificates associated with the Smart&#160;Proxy at the <strong>Certificates</strong> sub-tab.
Here you can inspect the certificate expiry data, or cancel the certificate by clicking <strong>Revoke</strong>.</p>
</li>
<li>
<p>A list of autosign entries at the  <strong>Autosign entries</strong> sub-tab.
Here you can create an entry by clicking <strong>New</strong> or delete one by clicking <strong>Delete</strong>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-foreman-webhooks_admin">15. Using Webhooks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A webhook is a way for a web page or web application to provide other applications with information in real time.
Webhooks are only triggered after an event occurs.
The request usually contains details of the event.
An event triggers callbacks, such as sending an e-mail confirming a host has been provisioned.
Webhooks enable you to define a call to an external API based on Foreman internal event using a fire-and-forget message exchange pattern.
The application sending the request does not wait for the response, or ignores it.</p>
</div>
<div class="paragraph">
<p>Because webhooks use HTTP, no new infrastructure needs be added to existing web services.</p>
</div>
<div class="paragraph">
<p>The typical use case for webhooks in Foreman is making a call to a monitoring system when a host is created or deleted.</p>
</div>
<div class="paragraph">
<p>Webhooks are useful where the action you want to perform in the external system can be achieved through its API.
Where it is necessary to run additional commands or edit files, the shellhooks plugin for Smart&#160;Proxies is available.
The shellhooks plugin enables you to define a shell script on the Smart&#160;Proxy that can be executed through the API.</p>
</div>
<div class="paragraph">
<p>You can use webhooks successfully without installing the shellhooks plugin.</p>
</div>
<div class="paragraph">
<p>For a list of available events, see <a href="#webhooks-available-events_admin">Available webhook events</a>.</p>
</div>
<div class="sect2">
<h3 id="migrating-to-webhooks_admin">15.1. Migrating to Webhooks</h3>
<div class="paragraph">
<p>The legacy <code>foreman_hooks</code> plugin provided full access to model objects that the webhooks plugin does not intentionally provide.</p>
</div>
<div class="paragraph">
<p>The scope of what is available is limited by the safemode and all objects and macros are both subject to an API stability promise and are fully documented.</p>
</div>
<div class="paragraph">
<p>The number of events triggered by webhooks is substantially fewer than with <code>foreman_hooks</code>.</p>
</div>
<div class="paragraph">
<p>Webhooks are processed asynchronously so there is minimal risk of tampering with internals of the system.
It is not possible to migrate from <code>foreman_hooks</code> without creating payloads for each individual webhook script.
However, the webhooks plugin comes with several example payload templates.
You can also use the example payloads with shellhooks to simplify migration.</p>
</div>
<div class="paragraph">
<p>Both script and payload templates must be customized to achieve similar results.</p>
</div>
</div>
<div class="sect2">
<h3 id="installing-webhooks-plugin_admin">15.2. Installing Webhooks</h3>
<div class="paragraph">
<p>Use the following procedure to install webhooks.
After installing webhooks, you can configure Foreman&#160;server to send webhook requests.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Install webhooks using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-webhooks</pre>
</div>
</div>
</li>
<li>
<p>Optionally, you can install the CLI plugin using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install tfm-rubygem-hammer_cli_foreman_webhooks</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-webhook-template_admin">15.3. Creating a Webhook Template</h3>
<div class="paragraph">
<p>Use the following procedure to create a webhook template in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> <strong>&gt;</strong> <strong>Webhooks Templates</strong>.</p>
</li>
<li>
<p>Click <strong>Clone an existing template</strong> or <strong>Create Template</strong>.</p>
</li>
<li>
<p>Enter a name for the template.</p>
</li>
<li>
<p>Use the editor to make changes to the template payload.</p>
<div class="paragraph">
<p>A webhook HTTP payload must be created using Foreman template syntax.
The webhook template can use a special variable called <code>@object</code> that can represent the main object of the event.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.theforeman.org/3.0/Managing_Hosts/index-foreman-el.html#appe-Managing_Hosts-Template_Writing_Reference">Template Writing Reference</a> in <em>Managing Hosts</em> and for available template macros and methods, visit <code>/templates_doc</code> on Foreman&#160;server.</p>
</div>
</li>
<li>
<p>Optional: Enter the description and audit comment.</p>
</li>
<li>
<p>Assign organizations and locations.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-webhook_admin">15.4. Creating a Webhook</h3>
<div class="paragraph">
<p>You can customize events, payloads, HTTP authentication, content type, and headers through the Foreman web UI.</p>
</div>
<div class="paragraph">
<p>Use the following procedure to create a webhook in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, click <strong>Administer</strong> <strong>&gt;</strong> <strong>Webhooks</strong>.</p>
</li>
<li>
<p>Click <strong>Create Webhook</strong>.</p>
</li>
<li>
<p>Click <strong>Subscribe to</strong> to select an event.</p>
</li>
<li>
<p>Enter a name.</p>
</li>
<li>
<p>Enter a target URL.
Webhooks make HTTP requests to pre-configured URLs.
The target URL can be a dynamic URL.
When using the shellhooks plugin, the URL should be in the form <code>https://smartproxy.example.com:8443/shellhooks/my_script</code>.</p>
</li>
<li>
<p>Click <strong>Template</strong> to select a template.</p>
</li>
<li>
<p>Enter an HTTP method.</p>
</li>
<li>
<p>Check the <strong>Enabled</strong> flag if you want to create an active webhook.</p>
</li>
<li>
<p>Click the <strong>Credentials</strong> tab.</p>
</li>
<li>
<p>Optional: If HTTP authentication is required, enter the username and password.</p>
</li>
<li>
<p>Select <strong>Verify SSL</strong> if the server certificate should be verified against the system certificate store or Foreman CA.</p>
</li>
<li>
<p>Select <strong>Proxy Authorization</strong> when using shellhooks, otherwise clear this box.</p>
</li>
<li>
<p>On the <strong>Additional</strong> tab, enter the HTTP Content Type.
For example, <code>application/json</code>, <code>application/xml</code> or <code>text/plain</code> on the payload you define.
The application does not attempt to convert the content to match the specified content type.</p>
</li>
<li>
<p>Optional: Provide HTTP headers as JSON.
ERB is also allowed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When configuring webhooks with endpoints with non-standard HTTP or HTTPS ports, an SELinux port must be assigned, see <a href="https://docs.theforeman.org/3.0/Installing_Server_on_Red_Hat/index-foreman-el.html#configuring-selinux-to-ensure-access-on-custom-ports_admin">Configuring SELinux to Ensure Access to Foreman on Custom Ports</a> in <em>Installing Foreman 3.0 server on Enterprise Linux</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="webhooks-available-events_admin">15.5. Available Webhook Events</h3>
<div class="paragraph">
<p>The following table contains a list of webhook events that are available from the Foreman web UI.
<code>Action</code> events trigger webhooks only on <code>success</code>, so if an action fails, a webhook is not triggered.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Katello Content View Promote Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A content view was successfully promoted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Katello Content View Publish Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A repository was successfully synchronized.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A generic remote execution job succeeded for a host.
This event is emitted for all Remote Execution jobs, when complete.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Katello Errata Install Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install errata using the Katello interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Katello Group Install Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install package group using the Katello interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Katello Package Install Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install package using the Katello interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Katello Group Remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove package group using the Katello interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Katello Package Remove Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove package using the Katello interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Katello Service Restart Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restart Services using the Katello interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Katello Group Update Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update package group using the Katello interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Katello Package Update Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update package using the Katello interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Foreman OpenSCAP Run Scans Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run OpenSCAP scan.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Ansible Run Host Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runs an Ansible playbook containing all the roles defined for a host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Ansible Run Capsule Upgrade Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upgrade Capsules on given Capsule server hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Ansible Configure Cloud Connector Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Cloud Connector on given hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Ansible Run Playbook Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run an Ansible playbook against given hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Ansible Enable Web Console Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run an Ansible playbook to enable the web console on given hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Puppet Run Host Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perform a single Puppet run.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Katello Module Stream Action Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perform a module stream action using the Katello interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Leapp Pre-upgrade Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upgradeability check for RHEL 7 host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Leapp Remediation Plan Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run Remediation plan with Leapp.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions Remote Execution Run Host Job Leapp Upgrade Succeeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run Leapp upgrade job for RHEL 7 host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build Entered</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A host entered the build mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build Exited</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A host build mode was canceled, either it was successfully provisioned or the user canceled the build manually.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content View Created/Updated/Destroyed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common database operations on a content view.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain Created/Updated/Destroyed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common database operations on a domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host Created/Updated/Destroyed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common database operations on a host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostgroup Created/Updated/Destroyed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common database operations on a hostgroup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Model Created/Updated/Destroyed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common database operations on a model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status Changed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global host status of a host changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subnet Created/Updated/Destroyed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common database operations on a subnet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template Render Performed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A report template was rendered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Created/Updated/Destroyed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common database operations on a user.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="shellhooks_admin">15.6. Shellhooks</h3>
<div class="paragraph">
<p>With webhooks, one Foreman event can only be mapped to one API call.
For advanced integrations, where a single shell script can contain multiple commands, you can install a Smart&#160;Proxy shellhooks plugin that exposes executables using a REST HTTP API.</p>
</div>
<div class="paragraph">
<p>A webhook can then be configured to reach out to a Smart&#160;Proxy API to run a predefined shellhook, which, for example, can contain commands or edit files.</p>
</div>
<div class="paragraph">
<p>Scripts must be placed in <code>/var/lib/foreman-proxy/shellhooks</code> as executables with only alphanumeric characters and underscores in the name.</p>
</div>
<div class="paragraph">
<p>The HTTPS payload is passed using standard input, optional command line arguments can be provided using X-Shellhook-Arg-1 <em>to</em> N.</p>
</div>
<div class="paragraph">
<p>The HTTP method must be POST.
An example URL would be: <code>https://smartproxy.example.com:8443/shellhooks/my_script</code>.</p>
</div>
<div class="paragraph">
<p>You must enable <strong>Proxy Authorization</strong> for each webhook that is connected to a shellhook, to enable it to authorize a call.</p>
</div>
<div class="paragraph">
<p>Standard output and error are redirected to the Smart&#160;Proxy log as messages with debug or warning levels respectively.</p>
</div>
<div class="paragraph">
<p>There is no return value from shellhook HTTPS calls.</p>
</div>
</div>
<div class="sect2">
<h3 id="installing-shellhooks-plugin_admin">15.7. Installing the Shellhooks Plugin</h3>
<div class="paragraph">
<p>Optionally, you can install and enable the shellhooks plugin on each Smart&#160;Proxy used for shellhooks, using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-proxy-plugin-shellhooks</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-shellhook_argumentsadmin">15.8. Using Shellhook Arguments</h3>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To pass arguments into a shellhook script, create the following HTTP headers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
  "X-Shellhook-Arg-1": "&lt;%= @object.content_view_version_id %&gt;,
  "X-Shellhook-Arg-2": "&lt;%= @object.content_view_name %&gt;
}</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure the content renders to a valid JSON.
Also, only pass safe fields like database ID, name, or labels which do not include new lines or quote characters.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Administering-Searching_and_Bookmarking">16. Searching and Bookmarking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Foreman web UI features powerful search functionality which is available on most pages of the web UI.
It enables you to search all kinds of resources that Foreman&#160;server manages.
Searches accept both free text and syntax-based queries, which can be built using extensive input prediction.
Search queries can be saved as bookmarks for future reuse.</p>
</div>
<div class="sect2">
<h3 id="sect-Administering-Searching_and_Bookmarking-Building_Search_Queries">16.1. Building Search Queries</h3>
<div class="paragraph">
<p>As you start typing a search query, a list of valid options to complete the current part of the query appears.
You can either select an option from the list and keep building the query using the prediction, or continue typing.
To learn how free text is interpreted by the search engine, see <a href="#sect-Administering-Searching_and_Bookmarking-Using_Free_Text_Search">Using Free Text Search</a>.</p>
</div>
<div class="sect3">
<h4 id="sect-Administering-Query_Syntax">16.1.1. Query Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>parameter</em> <em>operator</em> <em>value</em></pre>
</div>
</div>
<div class="paragraph">
<p>Available fields, resources to search, and the way the query is interpreted all depend on context, that is, the page where you perform the search.
For example, the field "hostgroup" on the Hosts page is equivalent to the field "name" on the Host Groups page.
The field type also determines available operators and accepted values.
For a list of all operators, see <a href="#sect-Administering-Operators">Operators</a>.
For descriptions of value formats, see <a href="#sect-Administering-Values">Values</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-Administering-Operators">16.1.2. Operators</h4>
<div class="paragraph">
<p>All operators that can be used between <em>parameter</em> and <em>value</em> are listed in the following table.
Other symbols and special characters that might appear in a prediction-built query, such as colons, do not have special meaning and are treated as free text.</p>
</div>
<table id="tabl-Administering-Operators-Comparison_Operators" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Comparison Operators Accepted by Search</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 33.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EQUALS</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Accepts numerical, temporal, or text values.
For text, exact case sensitive matches are returned.</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><code>hostgroup = RHEL7</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT EQUALS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">~</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIKE</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Accepts text or temporal values.
Returns case insensitive matches.
Accepts the following wildcards: _ for a single character, % or * for any number of characters including zero.
If no wildcard is specified, the string is treated as if surrounded by wildcards: %rhel7%</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><code>hostgroup ~ rhel%</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!~</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT LIKE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GREATER THAN</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Accepts numerical or temporal values.
For temporal values, the operator &gt; is interpreted as "later than", and &lt; as "earlier than".
Both operators can be combined with EQUALS: &gt;= &lt;=</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><code>registered_at &gt; 10-January-2017</code>
<br>
The search will return hosts that have been registered after the given date, that is, between 10th January 2017 and now.</p>
</div>
<div class="paragraph">
<p><code>registered_at &lt;= Yesterday</code>
<br>
The search will return hosts that have been registered yesterday or earlier.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LESS THAN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Compares an expression against a list of values, as in SQL.
Returns matches that contain or not contain the values, respectively.</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><code>release_version !^ 7</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT IN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAS or set?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#160;</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Returns values that are present or not present, respectively.</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><code>has hostgroup</code> or <code>set? hostgroup</code>
<br>
On the Puppet Classes page, the search will return classes that are assigned to at least one host group.</p>
</div>
<div class="paragraph">
<p><code>not has hostgroup</code> or <code>null? hostgroup</code>
<br>
On the Dashboard with an overview of hosts, the search will return all hosts that have no assigned host group.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT HAS or null?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#160;</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Simple queries that follow the described syntax can be combined into more complex ones using logical operators AND, OR, and NOT.
Alternative notations of the operators are also accepted:</p>
</div>
<table id="tabl-Administering-Query_Syntax-Logical_Operators" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Logical Operators Accepted by Search</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top" colspan="3">Alternative Notations</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">and</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&amp;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&amp;&amp;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;whitespace&gt;</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>class = motd AND environment ~ production</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">or</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">|</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">||</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#160;</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>errata_status = errata_needed || errata_status = security_needed</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">not</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">–</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">!</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#160;</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>hostgroup ~ rhel7 not status.failed</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="sect-Administering-Values">16.1.3. Values</h4>
<div id="varl-Administering-Values-Text_Values" class="dlist">
<dl>
<dt class="hdlist1"><strong>Text Values</strong></dt>
<dd>
<p>Text containing whitespaces must be enclosed in quotes.
A whitespace is otherwise interpreted as the AND operator.</p>
<div class="paragraph">
<p><strong>Examples:</strong></p>
</div>
<div class="paragraph">
<p><code>hostgroup = "Web servers"</code></p>
</div>
<div class="paragraph">
<p>The search will return hosts with assigned host group named "Web servers".</p>
</div>
<div class="paragraph">
<p><code>hostgroup = Web servers</code></p>
</div>
<div class="paragraph">
<p>The search will return hosts in the host group Web with any field matching %servers%.</p>
</div>
</dd>
</dl>
</div>
<div id="varl-Administering-Values-Temporal_Values" class="dlist">
<dl>
<dt class="hdlist1"><strong>Temporal Values</strong></dt>
<dd>
<p>Many date and time formats are accepted, including the following:</p>
<div class="ulist">
<ul>
<li>
<p>"10 January 2017"</p>
</li>
<li>
<p>"10 Jan 2017"</p>
</li>
<li>
<p>10-January-2017</p>
</li>
<li>
<p>10/January/2017</p>
</li>
<li>
<p>"January 10, 2017"</p>
</li>
<li>
<p>Today, Yesterday, and the like.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Avoid ambiguous date formats, such as 02/10/2017 or 10-02-2017.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Searching_and_Bookmarking-Using_Free_Text_Search">16.2. Using Free Text Search</h3>
<div class="paragraph">
<p>When you enter free text, it will be searched for across multiple fields.
For example, if you type "64", the search will return all hosts that have that number in their name, IP address, MAC address, and architecture.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Multi-word queries must be enclosed in quotes, otherwise the whitespace is interpreted as the AND operator.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because of searching across all fields, free text search results are not very accurate and searching can be slow, especially on a large number of hosts.
For this reason, we recommend that you avoid free text and use more specific, syntax-based queries whenever possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering-Searching_and_Bookmarking-Bookmarking">16.3. Managing Bookmarks</h3>
<div class="paragraph">
<p>You can save search queries as bookmarks for reuse.
You can also delete or modify a bookmark.</p>
</div>
<div class="paragraph">
<p>Bookmarks appear only on the page on which they were created.
On some pages, there are default bookmarks available for the common searches, for example, all <code>active</code> or <code>disabled</code> hosts.</p>
</div>
<div class="sect3">
<h4 id="sect-Administering-Searching_and_Bookmarking-Creating_Bookmarks">16.3.1. Creating Bookmarks</h4>
<div class="paragraph">
<p>This section details how to save a search query as a bookmark.
You must save the search query on the relevant page to create a bookmark for that page, for example, saving a host related search query on the Hosts page.</p>
</div>
<div id="sect-Administering-Searching_and_Bookmarking-To_Create_a_Bookmark" class="olist arabic">
<div class="title">To Create a Bookmark:</div>
<ol class="arabic">
<li>
<p>Navigate to the page where you want to create a bookmark.</p>
</li>
<li>
<p>In the <strong>Search</strong> field, enter the search query you want to save.</p>
</li>
<li>
<p>Select the arrow to the right of the <strong>Search</strong> button and then select <strong>Bookmark this search</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the new bookmark.</p>
</li>
<li>
<p>In the <strong>Search query</strong> field, ensure your search query is correct.</p>
</li>
<li>
<p>Ensure the <strong>Public</strong> check box is set correctly:</p>
<div class="ulist">
<ul>
<li>
<p>Select the <strong>Public</strong> check box to set the bookmark as public and visible to all users.</p>
</li>
<li>
<p>Clear the <strong>Public</strong> check box to set the bookmark as private and only visible to the user who created it.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To confirm the creation, either select the arrow to the right of the <strong>Search</strong> button to display the list of bookmarks, or navigate to <strong>Administer</strong> &gt; <strong>Bookmarks</strong> and then check the <strong>Bookmarks</strong> list for the name of the bookmark.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-Administering-Searching_and_Bookmarking-Deleting_Bookmarks">16.3.2. Deleting Bookmarks</h4>
<div class="paragraph">
<p>You can delete bookmarks on the Bookmarks page.</p>
</div>
<div id="sect-Administering-Searching_and_Bookmarking-To_Delete_a_Bookmark" class="olist arabic">
<div class="title">To Delete a Bookmark:</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Bookmarks</strong>.</p>
</li>
<li>
<p>On the Bookmarks page, click <strong>Delete</strong> for the Bookmark you want to delete.</p>
</li>
<li>
<p>When the confirmation window opens, click <strong>OK</strong> to confirm the deletion.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To confirm the deletion, check the <strong>Bookmarks</strong> list for the name of the bookmark.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="satellite-settings_admin">Appendix A: Foreman Settings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains noteworthy information or known issues about settings that you can edit in the Foreman web UI by navigating to <code>Administer</code> &gt; <code>Settings</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. General Settings Information</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Setting</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Fix DB cache</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman maintains a cache of permissions and roles.
When set to <code>Yes</code>, Foreman recreates this cache on the next restart.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Provisioning Settings Information</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Setting</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type of name generator</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the method used to generate a host name when creating a new host.</p>
<p class="tableblock">The default <code>Random-based</code> option generates a unique random host name which you can but do not have to use.
This is useful for users who create many hosts and do not know how to name them.</p>
<p class="tableblock">The <code>MAC-based</code> option is for bare-metal hosts only.
If you delete a host and create it later on, it receives the same host name based on the MAC address.
This can be useful for users who recycle servers and want them to always get the same host name.</p>
<p class="tableblock">The <code>Off</code> option disables the name generator function and leaves the host name field blank.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Safemode rendering</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables safe mode rendering of provisioning templates.
The default and recommended option <code>Yes</code> denies the access to variables and any object that is not whitelisted within Foreman.</p>
<p class="tableblock">When set to <code>No</code>, any object may be accessed by a user with permission to use templating features, either via editing of templates, parameters or smart variables.
This permits users full remote code execution on Foreman&#160;server, effectively disabling all authorization.
This is not a safe option, especially in bigger companies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Exclude pattern for facts stored in Foreman</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Until <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1759111">BZ#1759111</a> is resolved, note that if you use the wildcard value, for example <code>docker*</code>, to exclude all facts beginning with <code>docker</code>, this also excludes facts that contain the excluded term in any part of the name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ignore interfaces with matching identifier</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Until <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1759111">BZ#1759111</a> is resolved, note that if you use the wildcard value, for example <code>docker*</code>, to ignore all facts beginning with <code>docker</code>, this also excludes facts that contain the ignored term in any part of the name.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.0<br>
Last updated Jan 2022
</div>
</div>
</body>
</html>