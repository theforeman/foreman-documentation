<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Tuning Performance of Foreman</title>
<style>
*,::before,::after{box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:100%}body{background:#fff;color:rgba(0,0,0,0.8);padding:0;margin:0;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:inherit;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,p,blockquote,th,td{margin:0;padding:0}a{background:none;color:#2156a5;text-decoration:underline;line-height:inherit}a:active,a:hover{cursor:pointer;outline:0}a:focus{outline:thin dotted}a:hover,a:focus{color:#1d4b8f}abbr{font-size:0.9em}abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}b,strong{font-weight:bold;line-height:inherit}strong strong{font-weight:400}code,kbd,pre{font-family:"Droid Sans Mono", "DejaVu Sans Mono", monospace;font-size:1em}code{font-weight:400;color:rgba(0,0,0,0.9)}pre{color:rgba(0,0,0,0.9);line-height:1.45;text-rendering:optimizeSpeed;white-space:pre-wrap}dfn{font-style:italic}em,i{font-style:italic;line-height:inherit}em em{font-style:normal}hr{border:solid #dddddf;border-width:1px 0 0;clear:both;height:0;margin:1.25em 0 1.1875em}mark{background:#ff0;color:#000}p{line-height:1.6;margin-bottom:1.25rem;text-rendering:optimizeLegibility}q{quotes:"\201C" "\201D" "\2018" "\2019"}small{font-size:60%;line-height:inherit}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img,object[type^="image/"],svg{display:inline-block;height:auto;max-width:100%;vertical-align:middle}img{border:0;-ms-interpolation-mode:bicubic}object{max-width:100%}svg:not(:root){overflow:hidden}figure{margin:0}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}.left{float:left !important}.right{float:right !important}.text-left{text-align:left !important}.text-right{text-align:right !important}.text-center{text-align:center !important}.text-justify{text-align:justify !important}.hide{display:none}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:0.25em}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.2;word-spacing:-0.05em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em;margin-left:1.125em}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,0.85)}@media screen and (min-width: 768px){h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;border:1px solid #dedede;border-collapse:collapse;border-spacing:0;margin-bottom:1.25em;word-wrap:normal}table thead,table tfoot{background:#f7f8f7}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,0.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,0.8)}table tr.even,table tr.alt{background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.center{margin-left:auto;margin-right:auto}.stretch{width:100%}.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:"";display:table}.clearfix::after,.float-group::after{clear:both}:not(pre).nobreak{word-wrap:normal}:not(pre).nowrap{white-space:nowrap}:not(pre).pre-wrap{white-space:pre-wrap}:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal !important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}pre>code{display:block}pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}.keyseq{color:rgba(51,51,51,0.8)}kbd{display:inline-block;color:rgba(0,0,0,0.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,0.2),inset 0 0 0 0.1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menuref{color:#000}.menuseq b:not(.caret),.menuref{font-weight:inherit}.menuseq{word-spacing:-0.02em}.menuseq b.caret{font-size:1.25em;line-height:0.8}.menuseq i.caret{font-weight:bold;text-align:center;width:0.45em}b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}b.button::before{content:"[";padding:0 3px 0 2px}b.button::after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,0.9)}body>div[id]{margin:0 auto;max-width:62.5em;position:relative;padding-left:.9375em;padding-right:.9375em;width:100%}body>div[id]::before,body>div[id]::after,#content #footnotes::before{content:"";display:table;clear:both}#content{margin-top:1.25em;margin-bottom:0.625em}#content::before{content:none}#header>h1:first-child{color:rgba(0,0,0,0.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,0.6);display:flex;flex-flow:row wrap}#header .details span:first-child{margin-left:-0.125em}#header .details span.email a{color:rgba(0,0,0,0.85)}#header .details br{display:none}#header .details br+span::before{content:"\00a0\2013\00a0"}#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,0.85)}#header .details br+span#revremark::before{content:"\00a0|\00a0"}#header #revnumber{text-transform:capitalize}#header #revnumber::after{content:"\00a0"}#content>h1:first-child:not([class]){color:rgba(0,0,0,0.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #e7e7e9;padding-bottom:0.5em}#toc>ul{margin-left:0.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:0.5em 0}#toc ul{font-family:"Open Sans", "DejaVu Sans", sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:0.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media screen and (min-width: 768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0 !important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0 !important;border-bottom-width:0 !important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:0.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}@media screen and (min-width: 1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:0.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:none;background:#025d8c;padding:1.25em}#footer-text{color:rgba(255,255,255,0.8);line-height:1.44}.sect1{padding-bottom:0.625em}@media screen and (min-width: 768px){#content{margin-bottom:1.25em}.sect1{padding-bottom:1.25em}}.sect1:last-child{padding-bottom:0}.sect1+.sect1{border-top:1px solid #e7e7e9}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none !important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:0.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}details{margin-left:1.25rem}details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}details>summary::-webkit-details-marker{display:none}details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:1rem;font-style:italic}table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,0.85)}.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans", "DejaVu Sans", sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,0.6);word-wrap:anywhere}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#fffef7;border-radius:4px;box-shadow:0 1px 4px #e0e0dc}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:0.8125em}@media screen and (min-width: 768px){.literalblock pre,.listingblock>.content>pre{font-size:0.90625em}}@media screen and (min-width: 1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,0.9)}.listingblock>.content{position:relative}.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:0.5}.listingblock:hover code[data-lang]::before{display:block}.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:0.5}.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.prettyprint{background:#f7f7f8}pre.prettyprint .linenums{line-height:1.45;margin-left:2em}pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}pre.prettyprint li code[data-lang]::before{opacity:1}pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}table.linenotable td.code{padding-left:0.75em}table.linenotable td.linenos{width:0.01%}table.linenotable td.linenos,pre.pygments .linenos,pre.rouge .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}pre.pygments span.linenos,pre.rouge span.linenos{display:inline-block;margin-right:0.75em}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:0.75em}.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,0.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,0.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}.verseblock{margin:0 1em 1.25em}.verseblock pre{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-size:1.15rem;color:rgba(0,0,0,0.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:0.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,0.6)}.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}.quoteblock.abstract{margin:0 1em 1.25em;display:block}.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:0.25em solid #dddddf}.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}p.tableblock:last-child{margin-bottom:0}td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}td.tableblock>.content>:last-child{margin-bottom:-1.25em}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all>*>tr>*{border-width:1px}table.grid-cols>*>tr>*{border-width:0 1px}table.grid-rows>*>tr>*{border-width:1px 0}table.frame-all{border-width:1px}table.frame-ends{border-width:1px 0}table.frame-sides{border-width:0 1px}table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,0.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:0.625em}ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:0.625em}ul.unstyled,ol.unstyled{margin-left:0}li>p:empty:only-child::before{content:"";display:inline-block}ul.checklist>li>p:first-child{margin-left:-1em}ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:0.125em}ul.checklist>li>p:first-child>input[type=checkbox]:first-child{font:inherit;margin:0 .25em 0 0;padding:0}ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 0.625em -1.25em}ul.inline>li{margin-left:1.25em}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{vertical-align:top;padding:0 0.625em}td.hdlist1{font-weight:bold;padding-bottom:1.25em}td.hdlist2{word-wrap:anywhere}.literalblock+.colist,.listingblock+.colist{margin-top:-0.5em}.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}.colist td:not([class]):first-child img{max-width:none}.colist td:not([class]):last-child{padding:0.25em 0}.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}.imageblock.left{margin:0.25em 0.625em 1.25em 0}.imageblock.right{margin:0.25em 0 1.25em 0.625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 0.125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:0.625em}.image.right{margin-left:0.625em}a.image{text-decoration:none;display:inline-block}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:0.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:0.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:0.75em 0}div.page-break{display:none}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background:#00fafa}.black{color:#000}.black-background{background:#000}.blue{color:#0000bf}.blue-background{background:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background:#fa00fa}.gray{color:#606060}.gray-background{background:#7d7d7d}.green{color:#006000}.green-background{background:#007d00}.lime{color:#00bf00}.lime-background{background:#00fa00}.maroon{color:#600000}.maroon-background{background:#7d0000}.navy{color:#000060}.navy-background{background:#00007d}.olive{color:#606000}.olive-background{background:#7d7d00}.purple{color:#600060}.purple-background{background:#7d007d}.red{color:#bf0000}.red-background{background:#fa0000}.silver{color:#909090}.silver-background{background:#bcbcbc}.teal{color:#006060}.teal-background{background:#007d7d}.white{color:#bfbfbf}.white-background{background:#fafafa}.yellow{color:#bfbf00}.yellow-background{background:#fafa00}span.icon>.fa{cursor:default}a span.icon>.fa{cursor:inherit}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,0.5);cursor:default}.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,0.8);color:#111}.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff !important;background:rgba(0,0,0,0.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans", "DejaVu Sans", sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff !important}.conum[data-value]+b{display:none}.conum[data-value]::after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-0.125em}b.conum *{color:inherit !important}.conum:not([data-value]):empty{display:none}dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}h1,h2,p,td.content,span.alt,summary{letter-spacing:-0.01em}p strong,td.content strong,div.footnote strong{letter-spacing:-0.005em}p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.print-only{display:none !important}@page{margin:1.25cm 0.75cm}@media print{*{box-shadow:none !important;text-shadow:none !important}html{font-size:80%}a{color:inherit !important;text-decoration:underline !important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none !important}a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:0.25em}abbr[title]{border-bottom:1px dotted}abbr[title]::after{content:" (" attr(title) ")"}pre,blockquote,tr,img,object,svg{page-break-inside:avoid}thead{display:table-header-group}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}body>div[id]{max-width:none}#toc,.sidebarblock,.exampleblock>.content{background:none !important}#toc{border-bottom:1px solid #dddddf !important;padding-bottom:0 !important}body.book #header{text-align:center}body.book #header>h1:first-child{border:0 !important;margin:2.5em 0 1em}body.book #header .details{border:0 !important;display:block;padding:0 !important}body.book #header .details span:first-child{margin-left:0 !important}body.book #header .details br{display:block}body.book #header .details br+span::before{content:none !important}body.book #toc{border:0 !important;text-align:left !important;padding:0 !important;margin:0 !important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]::before{display:block}div.page-break{display:block;page-break-after:always}#footer{padding:0 0.9375em}.hide-on-print{display:none !important}.print-only{display:block !important}.hide-for-print{display:none !important}.show-for-print{display:inherit !important}}@media amzn-kf8, print{#header>h1:first-child{margin-top:1.25rem}.sect1{padding:0 !important}.sect1+.sect1{border:0}#footer{background:none}#footer-text{color:rgba(0,0,0,0.6);font-size:0.9em}}@media amzn-kf8{body>div[id]{padding:0}}body{padding:0;margin:0;margin-top:70px !important}.container{position:relative;z-index:1;padding-top:50px;min-height:100%}.container p{font-family:sans-serif;font-size:1.2em}nav{position:fixed;z-index:9999;left:0;right:0;top:0;height:70px;padding:0 1.5em;background-color:#025d8c;font-family:sans-serif;line-height:70px}nav .logo{width:50px;vertical-align:middle}nav .nav-menu{position:absolute;right:0.3em;top:0;padding:0;margin:0;list-style:none}nav .nav-item{display:inline-block}nav .nav-item>a{display:inline-block;padding:0 2.5em;line-height:70px;color:#fff;text-decoration:none}nav .dropdown{position:relative}nav .dropdown a::after{content:"";display:inline-block;margin-left:0.5em;vertical-align:middle;border-top:0.3em solid #fff;border-right:0.3em solid transparent;border-left:0.3em solid transparent}nav .dropdown.show a::after{transform:rotate(180deg)}nav .dropdown-menu{display:none;position:absolute;left:0;right:0;top:100%;padding:0.5em 0;margin-top:-0.5em;border:1px solid rgba(0,0,0,0.3);border-radius:0.5em;background-color:#fff;width:max-content}nav .dropdown-menu-left{left:auto;right:0}nav .dropdown.show .dropdown-menu{display:block}nav .dropdown-div{display:block;padding:0.4em 0;line-height:4em}nav .dropdown-div a::after{content:none;margin-left:0;border-top:0;border-right:0;border-left:0}nav .dropdown-item{display:block;padding:0 1.5em;font-size:0.875em;color:#000;line-height:1.6em;text-decoration:none}nav .btn-hamburger{display:none;position:absolute;right:1.5em;top:50%;background-color:transparent;border:0;cursor:pointer;outline:none;transform:translateY(-50%)}nav .btn-hamburger span{display:block;width:30px;height:4px;background-color:#fff;margin:6px;border-radius:2px;transition:0.3s ease-in-out}nav .btn-hamburger span:nth-child(4),nav .btn-hamburger span:nth-child(5){position:absolute;top:10px;opacity:0.5}nav .btn-hamburger span:nth-child(4){transform:rotate(45deg) scale(0)}nav .btn-hamburger span:nth-child(5){transform:rotate(-45deg) scale(0)}nav.opened .btn-hamburger span:nth-child(4){opacity:1;transform:rotate(45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(5){opacity:1;transform:rotate(-45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(1),nav.opened .btn-hamburger span:nth-child(2),nav.opened .btn-hamburger span:nth-child(3){opacity:0}@media screen and (max-width: 768px){nav .nav-menu{position:fixed;left:0;right:0;top:70px;bottom:100%;display:flex;flex-direction:column;justify-content:start;background-color:#363d4e;transition:bottom 0.5s ease-in-out;overflow:hidden}nav.opened .nav-menu{bottom:0}nav .nav-item>a{display:block}nav .dropdown-menu{position:relative;top:0;margin:0 1.5em}nav .btn-hamburger{display:block}}@media screen{div.narrow{max-width:1080px;margin:0 auto !important;margin-top:70px auto !important;float:none !important}#toc.toc2{margin-top:70px !important}}

</style>
<!-- docinfo -->
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Tuning Performance of Foreman</h1>
<div class="details">
<span id="revnumber">version 3.5,</span>
<span id="revdate">published Apr 26 2023</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Introduction_to_Performance_Tuning_performance-tuning">1. Introduction to Performance Tuning</a></li>
<li><a href="#Performance_Tuning_Quickstart_performance-tuning">2. Performance Tuning Quickstart</a></li>
<li><a href="#Performance_Tuning_System_Requirements_performance-tuning">3. Performance Tuning System Requirements</a></li>
<li><a href="#Determining_Hardware_and_OS_Configuration_performance-tuning">4. Determining Hardware and OS Configuration</a>
<ul class="sectlevel2">
<li><a href="#Benchmarking_Disk_Performance_performance-tuning">4.1. Benchmarking Disk Performance</a></li>
<li><a href="#Enabling_Tuned_Profiles_performance-tuning">4.2. Enabling Tuned Profiles</a></li>
<li><a href="#Disable_Transparent_Hugepage_performance-tuning">4.3. Disable Transparent Hugepage</a></li>
</ul>
</li>
<li><a href="#Configuring_Project_for_Performance_performance-tuning">5. Configuring Foreman for Performance</a>
<ul class="sectlevel2">
<li><a href="#Applying_configurations_performance-tuning">5.1. Applying configurations</a></li>
<li><a href="#Puma_Tunings_performance-tuning">5.2. Puma Tunings</a></li>
<li><a href="#Apache_HTTPD_Performance_Tuning_performance-tuning">5.3. Apache HTTPD Performance Tuning</a></li>
<li><a href="#qdrouterd_and_qpid_Tuning_performance-tuning">5.4. qdrouterd and qpid Tuning</a></li>
<li><a href="#Dynflow_Tuning_performance-tuning">5.5. Dynflow Tuning</a></li>
<li><a href="#REX_pull_based_transport_performance-tuning">5.6. REX pull-based transport</a></li>
<li><a href="#PostgreSQL_Tuning_performance-tuning">5.7. PostgreSQL Tuning</a></li>
<li><a href="#Redis_Tuning_performance-tuning">5.8. Redis Tuning</a></li>
<li><a href="#Smart_Proxy_Configuration_Tuning_performance-tuning">5.9. Smart&#160;Proxy Configuration Tuning</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="Introduction_to_Performance_Tuning_performance-tuning"><a class="anchor" href="#Introduction_to_Performance_Tuning_performance-tuning"></a>1. Introduction to Performance Tuning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document provides guidelines for tuning Foreman for performance and scalability.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Performance_Tuning_Quickstart_performance-tuning"><a class="anchor" href="#Performance_Tuning_Quickstart_performance-tuning"></a>2. Performance Tuning Quickstart</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can tune your Foreman&#160;server based on expected managed host counts and hardware allocation using built in tuning profiles included in Foreman that are available using the installation routine&#8217;s tuning flag.
For more information, see <a href="https://docs.theforeman.org/3.5/Installing_Server/index-katello.html#tuning-with-predefined-profiles_foreman">Tuning Foreman&#160;server with Predefined Profiles</a> in <em>Installing Foreman 3.5 Server with Katello 4.7 Plugin on RHEL/CentOS</em>.</p>
</div>
<div class="paragraph">
<p>There are four sizes provided based on estimates of the number of managed hosts your Foreman manages.
You can find the specific tuning settings for each profile in the configuration files contained in <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/sizes</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Number of managed hosts</th>
<th class="tableblock halign-left valign-top">Recommend RAM</th>
<th class="tableblock halign-left valign-top">Recommend Cores</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0&#8202;&#8211;&#8202;5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 GiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">medium</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000&#8202;&#8211;&#8202;10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 GiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000&#8202;&#8211;&#8202;20000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 GiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extra-large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20000&#8202;&#8211;&#8202;60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 GiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extra-extra-large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256 GiB+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48+</p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select an installation size: <code>default</code>, <code>medium</code>, <code>large</code>, <code>extra-large</code>, or <code>extra-extra-large</code>.
The default value is <code>default</code>.</p>
</li>
<li>
<p>Run <code>foreman-installer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --tuning "<em>My_Installation_Size</em>"</pre>
</div>
</div>
</li>
<li>
<p>Optional: Run a health check.
For more information, see <a href="#Applying_configurations_performance-tuning">Applying configurations</a>.</p>
</li>
<li>
<p>Optional: Tune the Ruby app server directly using the Puma Tuning section.
For more information, see <a href="#Puma_Tunings_performance-tuning">Puma Tunings</a>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Performance_Tuning_System_Requirements_performance-tuning"><a class="anchor" href="#Performance_Tuning_System_Requirements_performance-tuning"></a>3. Performance Tuning System Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can find the hardware and software requirements in <a href="https://docs.theforeman.org/3.5/Installing_Server/index-katello.html#Preparing_your_Environment_for_Installation_foreman">Preparing your Environment for Installation</a> in <em>Installing Foreman 3.5 Server with Katello 4.7 Plugin on RHEL/CentOS</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Determining_Hardware_and_OS_Configuration_performance-tuning"><a class="anchor" href="#Determining_Hardware_and_OS_Configuration_performance-tuning"></a>4. Determining Hardware and OS Configuration</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">CPU</dt>
<dd>
<p>The more physical cores that are available to Foreman, the higher throughput can be achieved for the tasks.
Some of the Foreman components such as Puppet and PostgreSQL are CPU intensive applications and can really benefit from the higher number of available CPU cores.</p>
</dd>
<dt class="hdlist1">Memory</dt>
<dd>
<p>The higher amount of memory available in the system running Foreman, the better will be the response times for the Foreman operations.
Since Foreman uses PostgreSQL as the database solutions, any additional memory coupled with the tunings will provide a boost to the response times of the applications due to increased data retention in the memory.</p>
</dd>
<dt class="hdlist1">Disk</dt>
<dd>
<p>With Foreman doing heavy IOPS due to repository synchronizations, package data retrieval, high frequency database updates for the subscription records of the content hosts, it is advised that Foreman be installed on a high speed SSD so as to avoid performance bottlenecks which may happen due to increased disk reads or writes.
Foreman requires disk IO to be at or above 60&#8202;&#8211;&#8202;80 megabytes per second of average throughput for read operations.
Anything below this value can have severe implications for the operation of the Foreman.
Foreman components such as PostgreSQL benefit from using SSDs due to their lower latency compared to HDDs.</p>
</dd>
<dt class="hdlist1">Network</dt>
<dd>
<p>The communication between the Foreman&#160;server and Smart&#160;Proxies is impacted by the network performance.
A decent network with a minimum jitter and low latency is required to enable hassle free operations such as Foreman&#160;server and Smart&#160;Proxies synchronization (at least ensure it is not causing connection resets, etc).</p>
</dd>
<dt class="hdlist1">Server Power Management</dt>
<dd>
<p>Your server by default is likely to be configured to conserve power.
While this is a good approach to keep the max power consumption in check, it also has a side effect of lowering the performance that Foreman may be able to achieve.
For a server running Foreman, it is recommended to set the BIOS to enable the system to be run in performance mode to boost the maximum performance levels that Foreman can achieve.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="Benchmarking_Disk_Performance_performance-tuning"><a class="anchor" href="#Benchmarking_Disk_Performance_performance-tuning"></a>4.1. Benchmarking Disk Performance</h3>
<div class="paragraph">
<p>We are working to update <code>foreman-maintain</code> to only warn the users when its internal quick storage benchmark results in numbers below our recommended throughput.</p>
</div>
<div class="paragraph">
<p>Also working on an updated benchmark script you can run (which will likely be integrated into <code>foreman-maintain</code> in the future) to get a more accurate real-world storage information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>You may have to temporarily reduce the RAM in order to run the I/O benchmark.
For example, if your Foreman&#160;server has 256 GiB RAM, tests would require 512 GiB of storage to run.
As a workaround, you can add <code>mem=20G</code> kernel option in grub during system boot to temporary reduce the size of the RAM.
The benchmark creates a file twice the size of the RAM in the specified directory and executes a series of storage I/O tests against it.
The size of the file ensures that the test is not just testing the filesystem caching.
If you benchmark other filesystems, for example smaller volumes such as PostgreSQL storage, you might have to reduce the RAM size as described above.</p>
</li>
<li>
<p>If you are using different storage solutions such as SAN or iSCSI, you can expect a different performance.</p>
</li>
<li>
<p>Foreman developers recommends you to stop all services before executing this script and you will be prompted to do so.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This test does not use direct I/O and will utilize file caching as normal operations would.</p>
</div>
<div class="paragraph">
<p>You can find our first version of the script <a href="https://github.com/RedHatSatellite/satellite-support/blob/master/storage-benchmark">storage-benchmark</a>.
To execute it, just download the script to your Foreman, make it executable, and run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ./storage-benchmark /var/lib/pulp</pre>
</div>
</div>
<div class="paragraph">
<p>As noted in the README block in the script, generally you wish to see on average 100MB/sec or higher in the tests below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Local SSD based storage should give values of 600MB/sec or higher.</p>
</li>
<li>
<p>Spinning disks should give values in the range of 100&#8202;&#8211;&#8202;200MB/sec or higher.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you see values below this, please open a support ticket for assistance.</p>
</div>
</div>
<div class="sect2">
<h3 id="Enabling_Tuned_Profiles_performance-tuning"><a class="anchor" href="#Enabling_Tuned_Profiles_performance-tuning"></a>4.2. Enabling Tuned Profiles</h3>
<div class="paragraph">
<p>Red&#160;Hat Enterprise Linux 7 enables the tuned daemon by default during installation.
On bare-metal, Foreman developers recommends to run the <code>throughput-performance</code> tuned profile on Foreman&#160;server and Smart&#160;Proxies.
On virtual machines, Foreman developers recommends to run the <code>virtual-guest</code> profile.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Check if <code>tuned</code> is running:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl status tuned</pre>
</div>
</div>
</li>
<li>
<p>If <code>tuned</code> is not running, enable it:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl enable --now tuned</pre>
</div>
</div>
</li>
<li>
<p>Optional: View a list of available <code>tuned</code> profiles:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># tuned-adm list</pre>
</div>
</div>
</li>
<li>
<p>Enable a <code>tuned</code> profile depending on your scenario:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># tuned-adm profile "<em>My_Tuned_Profile</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Disable_Transparent_Hugepage_performance-tuning"><a class="anchor" href="#Disable_Transparent_Hugepage_performance-tuning"></a>4.3. Disable Transparent Hugepage</h3>
<div class="paragraph">
<p>Transparent Hugepage is a memory management technique used by the Linux kernel to reduce the overhead of using the Translation Lookaside Buffer (TLB) by using larger sized memory pages.
Due to databases having Sparse Memory Access patterns instead of Contiguous Memory access patterns, database workloads often perform poorly when Transparent Hugepage is enabled.
To improve PostgreSQL and Redis performance, disable Transparent Hugepage.
In deployments where the databases are running on separate servers, there may be a small benefit to using Transparent Hugepage on the Foreman&#160;server only.</p>
</div>
<div class="paragraph">
<p>For more information on how to disable Transparent Hugepage, see <a href="https://access.redhat.com/solutions/1320153">How to disable transparent hugepages (THP) on Red Hat Enterprise Linux</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_Project_for_Performance_performance-tuning"><a class="anchor" href="#Configuring_Project_for_Performance_performance-tuning"></a>5. Configuring Foreman for Performance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman comes with a number of components that communicate with each other.
You can tune these components independently of each other to achieve the maximum possible performance for your scenario.</p>
</div>
<div class="paragraph">
<p>You will see no significant performance difference between Foreman installed on Enterprise Linux 7 and Enterprise Linux 8.</p>
</div>
<div class="sect2">
<h3 id="Applying_configurations_performance-tuning"><a class="anchor" href="#Applying_configurations_performance-tuning"></a>5.1. Applying configurations</h3>
<div class="paragraph">
<p>In following sections we suggest various tunables and how to apply them.
Please always test changing these in non production environment first, with valid backup and with proper outage window as in most of the cases Foreman restart is required.</p>
</div>
<div class="paragraph">
<p>It is also a good practice to setup a monitoring before applying any change as it will allow you to evaluate effect of the change.
Our testing environment might be too far from what you will see although we are trying hard to mimic real world environment.</p>
</div>
<div class="paragraph">
<div class="title">Changing systemd service files</div>
<p>If you have changed some systemd service file, you need to notify systemd daemon to reload the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># systemctl daemon-reload</pre>
</div>
</div>
<div class="paragraph">
<p>Restart Foreman services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain service restart</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Changing configuration files</div>
<p>If you have changed a configuration file such as <code>/etc/foreman-installer/custom-hiera.yaml</code>, rerun installer to apply your changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Running installer with additional options</div>
<p>If you need to rerun installer with some new options added:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer <em>new options</em></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Checking basic sanity of the setup</div>
<p>Optional: After any change, run this quick Foreman health-check:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-maintain health check</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Puma_Tunings_performance-tuning"><a class="anchor" href="#Puma_Tunings_performance-tuning"></a>5.2. Puma Tunings</h3>
<div class="paragraph">
<p>Puma is a ruby application server which is used for serving the Foreman related requests to the clients.
For any Foreman configuration that is supposed to handle a large number of clients or frequent operations, it is important for the Puma to be tuned appropriately.</p>
</div>
<div class="sect3">
<h4 id="Puma_Threads_performance-tuning"><a class="anchor" href="#Puma_Threads_performance-tuning"></a>5.2.1. Puma Threads</h4>
<div class="paragraph">
<p>Number of Puma threads (per Puma worker) is configured using two values: <code>threads_min</code> and <code>threads_max</code>.</p>
</div>
<div class="paragraph">
<p>Value of <code>threads_min</code> determines how many threads each worker spawns at a worker start.
Then, as concurrent requests are coming and more threads is needed, worker will be spawning more and more workers up to <code>threads_max</code> limit.</p>
</div>
<div class="paragraph">
<p>We recommend setting <code>threads_min</code> to same value as <code>threads_max</code> as having fewer Puma threads lead to higher memory usage on your Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>For example, we have compared these two setups using concurrent registrations test:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Foreman VM with 8 CPUs, 40 GiB RAM</th>
<th class="tableblock halign-left valign-top">Foreman VM with 8 CPUs, 40 GiB RAM</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-min=0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-min=16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-max=16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-max=16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-workers=2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-workers=2</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Setting the minimum Puma threads to <code>16</code> results in about 12% less memory usage as compared to <code>threads_min=0</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Puma_Workers_and_Threads_Auto_Tuning_performance-tuning"><a class="anchor" href="#Puma_Workers_and_Threads_Auto_Tuning_performance-tuning"></a>5.2.2. Puma Workers and Threads Auto-Tuning</h4>
<div class="paragraph">
<p>If you do not provide any Puma workers and thread values with <code>foreman-installer</code> or they are not present in your Foreman configuration, the <code>foreman-installer</code> configures a balanced number of workers.
It follows this formula:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>min(CPU_COUNT * 1.5, RAM_IN_GB - 1.5)</pre>
</div>
</div>
<div class="paragraph">
<p>This should be fine for most cases, but with some usage patterns tuning is needed to either limit the amount of resources dedicated to Puma (so other Foreman components can use these) or for any other reason.
Each Puma worker consumes around 1 GiB of RAM.</p>
</div>
<div class="listingblock">
<div class="title">View your current Foreman&#160;server settings</div>
<div class="content">
<pre># cat /etc/systemd/system/foreman.service.d/installer.conf</pre>
</div>
</div>
<div class="listingblock">
<div class="title">View the currently active Puma workers</div>
<div class="content">
<pre># systemctl status foreman</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Manually_tuning_Puma_workers_and_threads_count_performance-tuning"><a class="anchor" href="#Manually_tuning_Puma_workers_and_threads_count_performance-tuning"></a>5.2.3. Manually tuning Puma workers and threads count</h4>
<div class="paragraph">
<p>If you decide not to rely on <a href="#Puma_Workers_and_Threads_Auto_Tuning_performance-tuning">Puma Workers and Threads Auto-Tuning</a>, you can apply custom numbers for these tunables.
In the example below we are using 2 workers, 5 and 5 threads:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-foreman-service-puma-workers=2 \
--foreman-foreman-service-puma-threads-min=5 \
--foreman-foreman-service-puma-threads-max=5</pre>
</div>
</div>
<div class="paragraph">
<p>Apply your changes to Foreman&#160;server.
For more information, see <a href="#Applying_configurations_performance-tuning">Applying configurations</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Puma_Workers_and_Threads_Recommendations_performance-tuning"><a class="anchor" href="#Puma_Workers_and_Threads_Recommendations_performance-tuning"></a>5.2.4. Puma Workers and Threads Recommendations</h4>
<div class="paragraph">
<p>In order to recommend thread and worker configurations for the different tuning profiles, we conducted Puma tuning testing on Foreman with different tuning profiles.
The main test used in this testing was concurrent registration with the following combinations along with different number of workers and threads.
Our recommendation is based purely on concurrent registration performance, so it might not reflect your exact use-case.
For example, if your setup is very content oriented with lots of publishes and promotes, you might want to limit resources consumed by Puma in favor of Pulp and PostgreSQL.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16%;">
<col style="width: 19%;">
<col style="width: 7%;">
<col style="width: 7%;">
<col style="width: 31%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Number of managed hosts</th>
<th class="tableblock halign-left valign-top">RAM</th>
<th class="tableblock halign-left valign-top">Cores</th>
<th class="tableblock halign-left valign-top">Recommended Puma Threads for both min &amp; max</th>
<th class="tableblock halign-left valign-top">Recommended Puma Workers</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0&#8202;&#8211;&#8202;5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 GiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4&#8202;&#8211;&#8202;6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">medium</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000&#8202;&#8211;&#8202;10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 GiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8&#8202;&#8211;&#8202;12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000&#8202;&#8211;&#8202;20000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 GiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12&#8202;&#8211;&#8202;18</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extra-large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20000&#8202;&#8211;&#8202;60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128 GiB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16&#8202;&#8211;&#8202;24</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extra-extra-large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">256 GiB+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20&#8202;&#8211;&#8202;26</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Tuning number of workers is the more important aspect here and in some case we have seen up to 52% performance increase.
Although installer uses 5 min/max threads by default, we recommend 16 threads with all the tuning profiles in the table above.
That is because we have seen up to 23% performance increase with 16 threads (14% for 8 and 10% for 32) when compared to setup with 4 threads.</p>
</div>
<div class="paragraph">
<p>To figure out these recommendations we used concurrent registrations test case which is a very specific use-case.
It can be different on your Foreman which might have more balanced use-case (not only registrations).
Keeping default 5 min/max threads is a good choice as well.</p>
</div>
<div class="paragraph">
<p>These are some of our measurements that lead us to these recommendations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 17%;">
<col style="width: 21%;">
<col style="width: 20%;">
<col style="width: 21%;">
<col style="width: 21%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">4 workers, 4 threads</th>
<th class="tableblock halign-left valign-top">4 workers, 8 threads</th>
<th class="tableblock halign-left valign-top">4 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">4 workers, 32 threads</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Improvement</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10%</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use 4&#8202;&#8211;&#8202;6 workers on a default setup (4 CPUs) &#8211; we have seen about 25% higher performance with 5 workers when compared to 2 workers, but 8% lower performance with 8 workers when compared to 2 workers &#8211; see table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 17%;">
<col style="width: 21%;">
<col style="width: 20%;">
<col style="width: 21%;">
<col style="width: 21%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">2 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">4 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">6 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">8 workers, 16 threads</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Improvement</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">26%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-8%</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use 8&#8202;&#8211;&#8202;12 workers on a medium setup (8 CPUs) &#8211; see table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16%;">
<col style="width: 17%;">
<col style="width: 16%;">
<col style="width: 17%;">
<col style="width: 17%;">
<col style="width: 17%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">2 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">4 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">8 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">12 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">16 workers, 16 threads</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Improvement</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">51%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">52%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">52%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">42%</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use 16&#8202;&#8211;&#8202;24 workers on a 32 CPUs setup (this was tested on a 90 GiB RAM machine and memory turned out to be a factor here as system started swapping &#8211; proper <em>extra-large</em> should have 128 GiB), higher number of workers was problematic for higher registration concurrency levels we tested, so we cannot recommend it.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 13%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">4 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">8 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">16 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">24 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">32 workers, 16 threads</th>
<th class="tableblock halign-left valign-top">48 workers, 16 threads</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Improvement</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">37%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">44%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">52%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">too many failures</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">too many failures</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Configuring_Puma_Workers_performance-tuning"><a class="anchor" href="#Configuring_Puma_Workers_performance-tuning"></a>5.2.5. Configuring Puma Workers</h4>
<div class="paragraph">
<p>If you have enough CPUs, adding more workers adds more performance.
For example, we have compared Foreman setups with 8 and 16 CPUs:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. foreman-installer options used to test effect of workers count</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Foreman VM with 8 CPUs, 40 GiB RAM</th>
<th class="tableblock halign-left valign-top">Foreman VM with 16 CPUs, 40 GiB RAM</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-min=16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-min=16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-max=16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-max=16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-workers={2|4|8|16}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-workers={2|4|8|16}</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In 8 CPUs setup, changing the number of workers from 2 to 16, improved concurrent registration time by 36%.
In 16 CPUs setup, the same change caused 55% improvement.</p>
</div>
<div class="paragraph">
<p>Adding more workers can also help with total registration concurrency Foreman can handle.
In our measurements, setup with 2 workers were able to handle up to 480 concurrent registrations, but adding more workers improved the situation.</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Puma_Threads_performance-tuning"><a class="anchor" href="#Configuring_Puma_Threads_performance-tuning"></a>5.2.6. Configuring Puma Threads</h4>
<div class="paragraph">
<p>More threads allow for lower time to register hosts in parallel.
For example, we have compared these two setups:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Foreman VM with 8 CPUs, 40 GiB RAM</th>
<th class="tableblock halign-left valign-top">Foreman VM with 8 CPUs, 40 GiB RAM</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-min=16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-min=8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-max=16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-threads-max=8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-workers=2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--foreman-foreman-service-puma-workers=4</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Using more workers and the same total number of threads results in about 11% of speedup in highly concurrent registrations scenario.
Moreover, adding more workers did not consume more CPU and RAM but gets more performance.</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Puma_DB_Pool_performance-tuning"><a class="anchor" href="#Configuring_Puma_DB_Pool_performance-tuning"></a>5.2.7. Configuring Puma DB Pool</h4>
<div class="paragraph">
<p>The effective value of <code>$db_pool</code> is automatically set to equal <code>$foreman::foreman_service_puma_threads_max</code>.
It is the maximum of <code>$foreman::db_pool</code> and <code>$foreman::foreman_service_puma_threads_max</code> but both have default value 5, so any increase to the max threads above 5 automatically increases the database connection pool by the same amount.</p>
</div>
<div class="paragraph">
<p>If you encounter <code>ActiveRecord::ConnectionTimeoutError: could not obtain a connection from the pool within 5.000 seconds (waited 5.006 seconds); all pooled connections were in use</code> error in <code>/var/log/foreman/production.log</code>, you might want to increase this value.</p>
</div>
<div class="listingblock">
<div class="title">View current db_pool setting</div>
<div class="content">
<pre># grep pool /etc/foreman/database.yml
  pool: 5</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Manually_tuning_db_pool_performance-tuning"><a class="anchor" href="#Manually_tuning_db_pool_performance-tuning"></a>5.2.8. Manually tuning db_pool</h4>
<div class="paragraph">
<p>If you decide not to rely on automatically configured value, you can apply custom number like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-db-pool 10</pre>
</div>
</div>
<div class="paragraph">
<p>Apply your changes to Foreman&#160;server.
For more information, see <a href="#Applying_configurations_performance-tuning">Applying configurations</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Apache_HTTPD_Performance_Tuning_performance-tuning"><a class="anchor" href="#Apache_HTTPD_Performance_Tuning_performance-tuning"></a>5.3. Apache HTTPD Performance Tuning</h3>
<div class="paragraph">
<p>Apache httpd forms a core part of the Foreman and acts as a web server for handling the requests that are being made through the Foreman web UI or exposed APIs.
To increase the concurrency of the operations, httpd forms the first point where tuning can help to boost the performance of your Foreman.</p>
</div>
<div class="sect3">
<h4 id="Configuring_the_Open_Files_Limit_for_Apache_HTTPD_performance-tuning"><a class="anchor" href="#Configuring_the_Open_Files_Limit_for_Apache_HTTPD_performance-tuning"></a>5.3.1. Configuring the Open Files Limit for Apache HTTPD</h4>
<div class="paragraph">
<p>With the tuning in place, Apache httpd can easily open a lot of file descriptors on the server which may exceed the default limit of most of the Linux systems in place.
To avoid any kind of issues that may arise as a result of exceeding max open files limit on the system, please create the following file and directory and set the contents of the file as specified in the below given example:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the maximum open files limit in <code>/etc/systemd/system/httpd.service.d/limits.conf</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[Service]
LimitNOFILE=640000</pre>
</div>
</div>
</li>
<li>
<p>Apply your changes to Foreman&#160;server.
For more information, see <a href="#Applying_configurations_performance-tuning">Applying configurations</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="tuning_apache_httpd_child_processes_performance-tuning"><a class="anchor" href="#tuning_apache_httpd_child_processes_performance-tuning"></a>5.3.2. Tuning Apache Httpd Child Processes</h4>
<div class="paragraph">
<p>By default, httpd uses event request handling mechanism.
When the number of requests to httpd exceeds the maximum number of child processes that can be launched to handle the incoming connections, httpd raises an HTTP 503 Service Unavailable error.
Amidst httpd running out of processes to handle, the incoming connections can also result in multiple component failures on your Foreman services side due to the dependency of some components on the availability of httpd processes.</p>
</div>
<div class="paragraph">
<p>You can adapt the configuration of httpd event to handle more concurrent requests based on your expected peak load.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Configuring these numbers in <code>custom-hiera.yaml</code> locks them.
If you change these numbers using <code>foreman-installer --tuning=<em>My_Tuning_Option</em></code>, your <code>custom-hiera.yaml</code> will overwrite this setting.
Set your numbers only if you have specific need for it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Modify the number of concurrent requests in '/etc/foreman-installer/custom-hiera.yaml' by changing or adding the following lines:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">apache::mod::event::serverlimit: 64
apache::mod::event::maxrequestworkers: 1024
apache::mod::event::maxrequestsperchild: 4000</pre>
</div>
</div>
<div class="paragraph">
<p>The example is identical to running <code>foreman-installer --tuning=medium</code> or higher on Foreman&#160;server.</p>
</div>
</li>
<li>
<p>Apply your changes to Foreman&#160;server.
For more information, see <a href="#Applying_configurations_performance-tuning">Applying configurations</a>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="qdrouterd_and_qpid_Tuning_performance-tuning"><a class="anchor" href="#qdrouterd_and_qpid_Tuning_performance-tuning"></a>5.4. qdrouterd and qpid Tuning</h3>
<div class="sect3">
<h4 id="Calculating_the_maximum_open_files_limit_for_qdrouterd_performance-tuning"><a class="anchor" href="#Calculating_the_maximum_open_files_limit_for_qdrouterd_performance-tuning"></a>5.4.1. Calculating the maximum open files limit for qdrouterd</h4>
<div class="paragraph">
<p>In deployments using <code>katello-agent</code> infrastructure with a large number of content hosts, it may be necessary to increase the maximum open files for qdrouterd.</p>
</div>
<div class="paragraph">
<p>Calculate the limit for open files in qdrouterd using this formula: <code>(N x 3) + 100</code>, where N is the number of content hosts.
Each content host may consume up to three file descriptors in the router and 100 file descriptors are required to run the router itself.</p>
</div>
<div class="paragraph">
<p>The following settings permit Foreman to scale up to 10.000 content hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the maximum open files limit in <code>/etc/foreman-installer/custom-hiera.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">qpid::router::open_file_limit: "<em>My_Value</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>The default value is <code>150100</code>.</p>
</div>
</li>
<li>
<p>Apply your changes to Foreman&#160;server.
For more information, see <a href="#Applying_configurations_performance-tuning">Applying configurations</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Calculating_the_maximum_open_files_limit_for_qpidd_performance-tuning"><a class="anchor" href="#Calculating_the_maximum_open_files_limit_for_qpidd_performance-tuning"></a>5.4.2. Calculating the maximum open files limit for qpidd</h4>
<div class="paragraph">
<p>In deployments using <code>katello-agent</code> infrastructure with a large number of content hosts, it may be necessary to increase the maximum open files for qpidd.</p>
</div>
<div class="paragraph">
<p>Calculate the limit for open files in qpidd using this formula: <code>(N x 4) + 500</code>, where N is the number of content hosts.
A single content host can consume up to four file descriptors and 500 file descriptors are required for the operations of Broker (a component of qpidd).</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the maximum open files limit in <code>/etc/foreman-installer/custom-hiera.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">qpid::open_file_limit: "<em>My_Value</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>The default value is <code>65536</code>.</p>
</div>
</li>
<li>
<p>Apply your changes to Foreman&#160;server.
For more information, see <a href="#Applying_configurations_performance-tuning">Applying configurations</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_the_Maximum_Asynchronous_Input_Output_Requests_performance-tuning"><a class="anchor" href="#Configuring_the_Maximum_Asynchronous_Input_Output_Requests_performance-tuning"></a>5.4.3. Configuring the Maximum Asynchronous Input-Output Requests</h4>
<div class="paragraph">
<p>In deployments using <code>katello-agent</code> infrastructure with a large number of content hosts, it may be necessary to increase the maximum allowable concurrent AIO requests.
You can increase the maximum number of allowed concurrent AIO requests by increasing the kernel parameter <code>fs.aio-max-nr</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the value of <code>fs.aio-max-nr</code> to the desired maximum in a file in <code>/etc/sysctl.d</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">fs.aio-max-nr=<em>My_Maximum_Concurrent_AIO_Requests</em></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure this number is bigger than 33 multiplied by the maximum number of content hosts you plan to register to Foreman.</p>
</div>
</li>
<li>
<p>Apply the changes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sysctl -p</pre>
</div>
</div>
</li>
<li>
<p>Optional: Reboot your Foreman&#160;server to ensure that this change is applied.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Storage_Considerations_performance-tuning"><a class="anchor" href="#Storage_Considerations_performance-tuning"></a>5.4.4. Storage Considerations</h4>
<div class="paragraph">
<p>Ensure you provide enough storage space for <code>/var/lib/qpidd</code> in advance when you are planning an installation that will use <code>katello-agent</code> extensively.
On Foreman&#160;server, <code>/var/lib/qpidd</code> requires 2MiB disk space per content host.</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_the_qpid_mgmt_pub_interval_Parameter_performance-tuning"><a class="anchor" href="#Configuring_the_qpid_mgmt_pub_interval_Parameter_performance-tuning"></a>5.4.5. Configuring the QPID mgmt-pub-interval Parameter</h4>
<div class="paragraph">
<p>You might see the following error in journal (use <code>journalctl</code> command to access it) in Enterprise Linux 7:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman.example.com qpidd[92464]: [Broker] error Channel exception: not-attached: Channel 2 is not attached(/builddir/build/BUILD/qpid-cpp-0.30/src/qpid/amqp_0_10/SessionHandler.cpp: 39
foreman.example.com qpidd[92464]: [Protocol] error Connectionqpid.10.1.10.1:5671-10.1.10.1:53790 timed out: closing</pre>
</div>
</div>
<div class="paragraph">
<p>This error message appears because qpid maintains management objects for queues, sessions, and connections and recycles them every ten seconds by default.
The same object with the same ID is created, deleted, and created again.
The old management object is not yet purged, which is why qpid throws this error.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the <code>mgmt-pub-interval</code> parameter in <code>/etc/foreman-installer/custom-hiera.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">qpid::mgmt_pub_interval: 5</pre>
</div>
</div>
</li>
<li>
<p>Apply your changes to Foreman&#160;server.
For more information, see <a href="#Applying_configurations_performance-tuning">Applying configurations</a>.</p>
<div class="paragraph">
<p>For more information, see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1335694#c7">BZ 1335694</a>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Dynflow_Tuning_performance-tuning"><a class="anchor" href="#Dynflow_Tuning_performance-tuning"></a>5.5. Dynflow Tuning</h3>
<div class="paragraph">
<p>Dynflow is the workflow management system and task orchestrator which is a Foreman plugin and is used to execute the different tasks of Foreman in an out-of-order execution manner.
Under the conditions when there are a lot of clients checking in on Foreman and running a number of tasks, Dynflow can take some help from an added tuning specifying how many executors can it launch.</p>
</div>
<div class="paragraph">
<p>For more information about the tunings involved related to Dynflow, see <code>https://foreman.example.com/foreman_tasks/sidekiq</code>.</p>
</div>
<div class="paragraph">
<div class="title">Increase number of Sidekiq workers</div>
<p>Foreman contains a Dynflow service called <code>dynflow-sidekiq</code> that performs tasks scheduled by Dynflow.
Sidekiq workers can be grouped into various queues to ensure lots of tasks of one type will not block execution of tasks of other type.</p>
</div>
<div class="paragraph">
<p>Foreman developers recommends to increase the number of sidekiq workers to scale the Foreman tasking system for bulk concurrent tasks, for example for multiple Content View publications and promotions, content synchronizations, and synchronizations to Smart&#160;Proxy&#160;servers.
There are two options available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can increase the number of threads used by a worker (worker&#8217;s concurrency).
This has limited impact for values larger than five due to Ruby implementation of the concurrency of threads.</p>
</li>
<li>
<p>You can increase the number of workers, which is recommended.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Increase the number of workers from one worker to three while remaining five threads/concurrency of each:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-dynflow-worker-instances 3    # optionally, add --foreman-dynflow-worker-concurrency 5</pre>
</div>
</div>
</li>
<li>
<p>Optional: Check if there are three worker services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl -a | grep dynflow-sidekiq@worker-[0-9]
dynflow-sidekiq@worker-1.service        loaded    active   running   Foreman jobs daemon - worker-1 on sidekiq
dynflow-sidekiq@worker-2.service        loaded    active   running   Foreman jobs daemon - worker-2 on sidekiq
dynflow-sidekiq@worker-3.service        loaded    active   running   Foreman jobs daemon - worker-3 on sidekiq</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="REX_pull_based_transport_performance-tuning"><a class="anchor" href="#REX_pull_based_transport_performance-tuning"></a>5.6. REX pull-based transport</h3>
<div class="paragraph">
<p>Foreman has a pull-based transport that has the features of REX but with a deployment model similar to katello-agent.
This transport uses MQTT as its messaging protocol and includes an MQTT client running on each host.
In order to tune the MQTT server (<code>mosquitto</code>) and increase the number of hosts connected to it, you can follow the following procedure on the Foreman&#160;server:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable pull-based remote execution on your Foreman&#160;server or Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-installer --foreman-proxy-plugin-remote-execution-script-mode pull-mqtt</pre>
</div>
</div>
<div class="paragraph">
<p>Note that your Foreman&#160;server or Smart&#160;Proxy&#160;server can only use one transport mode, either SSH or MQTT.</p>
</div>
</li>
<li>
<p>To increase the default number of hosts accepted by the MQTT server, create the following system unit definition file and set its contents as specified in the below given example (this will allow the <code>mosquitto</code> service to handle ~5000 hosts):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">cat &gt;/etc/systemd/system/mosquitto.service.d/limits.conf &lt;&lt;<em>EOF</em>
[Service]
LimitNOFILE=5000
<em>EOF</em></pre>
</div>
</div>
</li>
<li>
<p>Run the following commands to apply your changes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl daemon-reload
# systemctl restart mosquitto.service</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="PostgreSQL_Tuning_performance-tuning"><a class="anchor" href="#PostgreSQL_Tuning_performance-tuning"></a>5.7. PostgreSQL Tuning</h3>
<div class="paragraph">
<p>PostgreSQL is the primary SQL based database that is used by Foreman for the storage of persistent context across a wide variety of tasks that Foreman does.
The database sees an extensive usage is usually working on to provide the Foreman with the data which it needs for its smooth functioning.
This makes PostgreSQL a heavily used process which if tuned can have a number of benefits on the overall operational response of Foreman.</p>
</div>
<div class="paragraph">
<p>The PostgreSQL authors recommend disabling Transparent Hugepage on servers running PostgreSQL.
For more information, see <a href="#Disable_Transparent_Hugepage_performance-tuning">Disable Transparent Hugepage</a>.</p>
</div>
<div class="paragraph">
<p>You can apply a set of tunings to PostgreSQL to improve its response times, which will modify the <code>postgresql.conf</code> file.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Append <code>/etc/foreman-installer/custom-hiera.yaml</code> to tune PostgreSQL:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">postgresql::server::config_entries:
  max_connections: 1000
  shared_buffers: 2GB
  work_mem: 8MB
  autovacuum_vacuum_cost_limit: 2000</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this to effectively tune down your Foreman instance irrespective of a tuning profile.</p>
</div>
</li>
<li>
<p>Apply your changes to Foreman&#160;server.
For more information, see <a href="#Applying_configurations_performance-tuning">Applying configurations</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the above tuning configuration, there are a certain set of keys which we have altered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>max_connections</code>: The key defines the maximum number of connections that can be accepted by the PostgreSQL processes that are running.</p>
</li>
<li>
<p><code>shared_buffers</code>: The shared buffers define the memory used by all the active connections inside PostgreSQL to store the data for the different database operations.
An optimal value for this will vary between 2 GiB to a maximum of 25% of your total system memory depending upon the frequency of the operations being conducted on Foreman.</p>
</li>
<li>
<p><code>work_mem</code>: The work_mem is the memory that is allocated on per process basis for PostgreSQL and is used to store the intermediate results of the operations that are being performed by the process.
Setting this value to 8 MB should be more than enough for most of the intensive operations on Foreman.</p>
</li>
<li>
<p><code>autovacuum_vacuum_cost_limit</code>: The key defines the cost limit value for the vacuuming operation inside the autovacuum process to clean up the dead tuples inside the database relations.
The cost limit defines the number of tuples that can be processed in a single run by the process.
Foreman developers recommends setting the value to <code>2000</code> as it is for the <em>medium</em>, <em>large</em>, <em>extra-large</em>, and <em>extra-extra-large</em> profiles, based on the general load that Foreman pushes on the PostgreSQL server process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1867311#c12">BZ1867311: Upgrade fails when checkpoint_segments postgres parameter configured</a>.</p>
</div>
<div class="sect3">
<h4 id="Benchmarking_raw_DB_Performance_performance-tuning"><a class="anchor" href="#Benchmarking_raw_DB_Performance_performance-tuning"></a>5.7.1. Benchmarking raw DB performance</h4>
<div class="paragraph">
<p>To get a list of the top table sizes in disk space for both Candlepin, Foreman, and Pulp check <a href="https://github.com/RedHatSatellite/satellite-support/blob/master/postgres-size-report">postgres-size-report</a> script in <a href="https://github.com/RedHatSatellite/satellite-support">satellite-support</a> git repository.</p>
</div>
<div class="paragraph">
<p>PGbench utility (note you may need to resize PostgreSQL data directory <code>/var/lib/pgsql</code> directory to 100 GiB or what does benchmark take to run) might be used to measure PostgreSQL performance on your system.
Use <code>dnf install postgresql-contrib</code> to install it.
For more information, see <a href="https://github.com/RedHatSatellite/satellite-support">github.com/RedHatSatellite/satellite-support</a>.</p>
</div>
<div class="paragraph">
<p>Choice of filesystem for PostgreSQL data directory might matter as well.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Never do any testing on production system and without valid backup.</p>
</li>
<li>
<p>Before you start testing, see how big the database files are.
Testing with a really small database would not produce any meaningful results.
For example, if the DB is only 20 GiB and the buffer pool is 32 GiB, it won&#8217;t show problems with large number of connections because the data will be completely buffered.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Redis_Tuning_performance-tuning"><a class="anchor" href="#Redis_Tuning_performance-tuning"></a>5.8. Redis Tuning</h3>
<div class="paragraph">
<p>Redis is an in-memory data store.
It is used by multiple services in Foreman.
The Dynflow and Pulp tasking systems use it to track their tasks.
Given the way Foreman uses Redis, its memory consumption should be stable.</p>
</div>
<div class="paragraph">
<p>The Redis authors recommend disabling Transparent Hugepage on servers running Redis.
For more about it please see <a href="#Disable_Transparent_Hugepage_performance-tuning">Disable Transparent Hugepage</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Smart_Proxy_Configuration_Tuning_performance-tuning"><a class="anchor" href="#Smart_Proxy_Configuration_Tuning_performance-tuning"></a>5.9. Smart&#160;Proxy Configuration Tuning</h3>
<div class="paragraph">
<p>Smart&#160;Proxies are meant to offload part of Foreman load and provide access to different networks related to distributing content to clients but they can also be used to execute remote execution jobs.
What they cannot help with is anything which extensively uses Foreman API as host registration or package profile update.</p>
</div>
<div class="sect3">
<h4 id="Smart_Proxy_Performance_Tests_performance-tuning"><a class="anchor" href="#Smart_Proxy_Performance_Tests_performance-tuning"></a>5.9.1. Smart&#160;Proxy Performance Tests</h4>
<div class="paragraph">
<p>We have measured multiple test cases on multiple Smart&#160;Proxy configurations:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 79%;">
<colgroup>
<col style="width: 48%;">
<col style="width: 19%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Smart&#160;Proxy HW configuration</th>
<th class="tableblock halign-left valign-top">CPUs</th>
<th class="tableblock halign-left valign-top">RAM</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12 GiB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24 GiB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extra large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">46 GiB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Content delivery use case</div>
<p>In a download test where we concurrently downloaded a 40MB repo of 2000 packages on 100, 200, .. 1000 hosts, we saw roughly 50% improvement in average download duration every time when we doubled Smart&#160;Proxy&#160;server resources.
For more precise numbers, see the table below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Concurrent downloading hosts</th>
<th class="tableblock halign-left valign-top">Minimal (4 CPU and 12 GiB RAM) &#8594; Large (8 CPU and 24 GiB RAM)</th>
<th class="tableblock halign-left valign-top">Large (8 CPU and 24 GiB RAM) &#8594; Extra Large (16 CPU and 46 GiB RAM)</th>
<th class="tableblock halign-left valign-top">Minimal (4 CPU and 12 GiB RAM) &#8594; Extra Large (16 CPU and 46 GiB RAM)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Average Improvement</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~ 50% (e.g. for 700 concurrent downloads in average 9 seconds vs. 4.4 seconds per package)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~ 40% (e.g. for 700 concurrent downloads in average 4.4 seconds vs. 2.5 seconds per package)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~ 70% (e.g. for 700 concurrent downloads in average 9 seconds vs. 2.5 seconds per package)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When we compared download performance from Foreman&#160;server vs. from Smart&#160;Proxy&#160;server, we have seen only about 5% speedup, but that is expected as Smart&#160;Proxy&#160;server&#8217;s main benefit is in getting content closer to geographically distributed clients (or clients in different networks) and in handling part of the load Foreman&#160;server would have to handle itself.
In some smaller hardware configurations (8 CPUs and 24 GiB), Foreman&#160;server was not able to handle downloads from more than 500 concurrent clients, while a Smart&#160;Proxy&#160;server with the same hardware configuration was able to service more than 1000 and possibly even more.</p>
</div>
<div class="paragraph">
<div class="title">Frequent registrations use case</div>
<p>For concurrent registrations a bottleneck is CPU speed, but all configs were able to handle even high concurrency without swapping.
Hardware resources used for Smart&#160;Proxy have only minimal impact on registration performance.
For example, Smart&#160;Proxy&#160;server with 16 CPUs and 46 GiB RAM have at most a 9% registration speed improvement when compared to a Smart&#160;Proxy&#160;server with 4 CPUs and 12 GiB RAM.</p>
</div>
<div class="paragraph">
<div class="title">Remote execution use case</div>
<p>We have tested executing Remote Execution jobs via both SSH and Ansible backend on 500, 2000 and 4000 hosts.
All configurations were able to handle all of the tests without errors, except for the smallest configuration (4 CPUs and 12 GiB memory) which failed to finish on all 4000 hosts.</p>
</div>
<div class="paragraph">
<div class="title">Content sync use case</div>
<p>In a sync test where we synced Red&#160;Hat Enterprise Linux 6, 7, 8 BaseOS and 8 AppStream we have not seen significant differences among Smart&#160;Proxy configurations.
This will be different for syncing a higher number of content views in parallel.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.5<br>
Last updated Apr 2023
</div>
</div>
</body>
</html>