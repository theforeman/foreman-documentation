<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Configuring Hosts Using Ansible</title>
<style>
*,::before,::after{box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:100%}body{background:#fff;color:rgba(0,0,0,0.8);padding:0;margin:0;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:inherit;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,p,blockquote,th,td{margin:0;padding:0}a{background:none;color:#2156a5;text-decoration:underline;line-height:inherit}a:active,a:hover{cursor:pointer;outline:0}a:focus{outline:thin dotted}a:hover,a:focus{color:#1d4b8f}abbr{font-size:0.9em}abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}b,strong{font-weight:bold;line-height:inherit}strong strong{font-weight:400}code,kbd,pre{font-family:"Droid Sans Mono", "DejaVu Sans Mono", monospace;font-size:1em}code{font-weight:400;color:rgba(0,0,0,0.9)}pre{color:rgba(0,0,0,0.9);line-height:1.45;text-rendering:optimizeSpeed;white-space:pre-wrap}dfn{font-style:italic}em,i{font-style:italic;line-height:inherit}em em{font-style:normal}hr{border:solid #dddddf;border-width:1px 0 0;clear:both;height:0;margin:1.25em 0 1.1875em}mark{background:#ff0;color:#000}p{line-height:1.6;margin-bottom:1.25rem;text-rendering:optimizeLegibility}q{quotes:"\201C" "\201D" "\2018" "\2019"}small{font-size:60%;line-height:inherit}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img,object[type^="image/"],svg{display:inline-block;height:auto;max-width:100%;vertical-align:middle}img{border:0;-ms-interpolation-mode:bicubic}object{max-width:100%}svg:not(:root){overflow:hidden}figure{margin:0}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}.left{float:left !important}.right{float:right !important}.text-left{text-align:left !important}.text-right{text-align:right !important}.text-center{text-align:center !important}.text-justify{text-align:justify !important}.hide{display:none}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:0.25em}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.2;word-spacing:-0.05em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em;margin-left:1.125em}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,0.85)}@media screen and (min-width: 768px){h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;border:1px solid #dedede;border-collapse:collapse;border-spacing:0;margin-bottom:1.25em;word-wrap:normal}table thead,table tfoot{background:#f7f8f7}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,0.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,0.8)}table tr.even,table tr.alt{background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.center{margin-left:auto;margin-right:auto}.stretch{width:100%}.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:"";display:table}.clearfix::after,.float-group::after{clear:both}:not(pre).nobreak{word-wrap:normal}:not(pre).nowrap{white-space:nowrap}:not(pre).pre-wrap{white-space:pre-wrap}:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal !important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}pre>code{display:block}pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}.keyseq{color:rgba(51,51,51,0.8)}kbd{display:inline-block;color:rgba(0,0,0,0.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,0.2),inset 0 0 0 0.1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menuref{color:#000}.menuseq b:not(.caret),.menuref{font-weight:inherit}.menuseq{word-spacing:-0.02em}.menuseq b.caret{font-size:1.25em;line-height:0.8}.menuseq i.caret{font-weight:bold;text-align:center;width:0.45em}b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}b.button::before{content:"[";padding:0 3px 0 2px}b.button::after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,0.9)}body>div[id]{margin:0 auto;max-width:62.5em;position:relative;padding-left:.9375em;padding-right:.9375em;width:100%}body>div[id]::before,body>div[id]::after,#content #footnotes::before{content:"";display:table;clear:both}#content{margin-top:1.25em;margin-bottom:0.625em}#content::before{content:none}#header>h1:first-child{color:rgba(0,0,0,0.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,0.6);display:flex;flex-flow:row wrap}#header .details span:first-child{margin-left:-0.125em}#header .details span.email a{color:rgba(0,0,0,0.85)}#header .details br{display:none}#header .details br+span::before{content:"\00a0\2013\00a0"}#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,0.85)}#header .details br+span#revremark::before{content:"\00a0|\00a0"}#header #revnumber{text-transform:capitalize}#header #revnumber::after{content:"\00a0"}#content>h1:first-child:not([class]){color:rgba(0,0,0,0.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #e7e7e9;padding-bottom:0.5em}#toc>ul{margin-left:0.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:0.5em 0}#toc ul{font-family:"Open Sans", "DejaVu Sans", sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:0.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media screen and (min-width: 768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0 !important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0 !important;border-bottom-width:0 !important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:0.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}@media screen and (min-width: 1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:0.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:none;background:#025d8c;padding:1.25em}#footer-text{color:rgba(255,255,255,0.8);line-height:1.44}.sect1{padding-bottom:0.625em}@media screen and (min-width: 768px){#content{margin-bottom:1.25em}.sect1{padding-bottom:1.25em}}.sect1:last-child{padding-bottom:0}.sect1+.sect1{border-top:1px solid #e7e7e9}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none !important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:0.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}details{margin-left:1.25rem}details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}details>summary::-webkit-details-marker{display:none}details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:1rem;font-style:italic}table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,0.85)}.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans", "DejaVu Sans", sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,0.6);word-wrap:anywhere}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#fffef7;border-radius:4px;box-shadow:0 1px 4px #e0e0dc}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:0.8125em}@media screen and (min-width: 768px){.literalblock pre,.listingblock>.content>pre{font-size:0.90625em}}@media screen and (min-width: 1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,0.9)}.listingblock>.content{position:relative}.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:0.5}.listingblock:hover code[data-lang]::before{display:block}.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:0.5}.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.prettyprint{background:#f7f7f8}pre.prettyprint .linenums{line-height:1.45;margin-left:2em}pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}pre.prettyprint li code[data-lang]::before{opacity:1}pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}table.linenotable td.code{padding-left:0.75em}table.linenotable td.linenos{width:0.01%}table.linenotable td.linenos,pre.pygments .linenos,pre.rouge .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}pre.pygments span.linenos,pre.rouge span.linenos{display:inline-block;margin-right:0.75em}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:0.75em}.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,0.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,0.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}.verseblock{margin:0 1em 1.25em}.verseblock pre{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-size:1.15rem;color:rgba(0,0,0,0.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:0.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,0.6)}.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}.quoteblock.abstract{margin:0 1em 1.25em;display:block}.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:0.25em solid #dddddf}.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}p.tableblock:last-child{margin-bottom:0}td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}td.tableblock>.content>:last-child{margin-bottom:-1.25em}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all>*>tr>*{border-width:1px}table.grid-cols>*>tr>*{border-width:0 1px}table.grid-rows>*>tr>*{border-width:1px 0}table.frame-all{border-width:1px}table.frame-ends{border-width:1px 0}table.frame-sides{border-width:0 1px}table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,0.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:0.625em}ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:0.625em}ul.unstyled,ol.unstyled{margin-left:0}li>p:empty:only-child::before{content:"";display:inline-block}ul.checklist>li>p:first-child{margin-left:-1em}ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:0.125em}ul.checklist>li>p:first-child>input[type=checkbox]:first-child{font:inherit;margin:0 .25em 0 0;padding:0}ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 0.625em -1.25em}ul.inline>li{margin-left:1.25em}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{vertical-align:top;padding:0 0.625em}td.hdlist1{font-weight:bold;padding-bottom:1.25em}td.hdlist2{word-wrap:anywhere}.literalblock+.colist,.listingblock+.colist{margin-top:-0.5em}.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}.colist td:not([class]):first-child img{max-width:none}.colist td:not([class]):last-child{padding:0.25em 0}.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}.imageblock.left{margin:0.25em 0.625em 1.25em 0}.imageblock.right{margin:0.25em 0 1.25em 0.625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 0.125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:0.625em}.image.right{margin-left:0.625em}a.image{text-decoration:none;display:inline-block}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:0.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:0.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:0.75em 0}div.page-break{display:none}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background:#00fafa}.black{color:#000}.black-background{background:#000}.blue{color:#0000bf}.blue-background{background:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background:#fa00fa}.gray{color:#606060}.gray-background{background:#7d7d7d}.green{color:#006000}.green-background{background:#007d00}.lime{color:#00bf00}.lime-background{background:#00fa00}.maroon{color:#600000}.maroon-background{background:#7d0000}.navy{color:#000060}.navy-background{background:#00007d}.olive{color:#606000}.olive-background{background:#7d7d00}.purple{color:#600060}.purple-background{background:#7d007d}.red{color:#bf0000}.red-background{background:#fa0000}.silver{color:#909090}.silver-background{background:#bcbcbc}.teal{color:#006060}.teal-background{background:#007d7d}.white{color:#bfbfbf}.white-background{background:#fafafa}.yellow{color:#bfbf00}.yellow-background{background:#fafa00}span.icon>.fa{cursor:default}a span.icon>.fa{cursor:inherit}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,0.5);cursor:default}.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,0.8);color:#111}.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff !important;background:rgba(0,0,0,0.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans", "DejaVu Sans", sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff !important}.conum[data-value]+b{display:none}.conum[data-value]::after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-0.125em}b.conum *{color:inherit !important}.conum:not([data-value]):empty{display:none}dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}h1,h2,p,td.content,span.alt,summary{letter-spacing:-0.01em}p strong,td.content strong,div.footnote strong{letter-spacing:-0.005em}p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.print-only{display:none !important}@page{margin:1.25cm 0.75cm}@media print{*{box-shadow:none !important;text-shadow:none !important}html{font-size:80%}a{color:inherit !important;text-decoration:underline !important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none !important}a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:0.25em}abbr[title]{border-bottom:1px dotted}abbr[title]::after{content:" (" attr(title) ")"}pre,blockquote,tr,img,object,svg{page-break-inside:avoid}thead{display:table-header-group}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}body>div[id]{max-width:none}#toc,.sidebarblock,.exampleblock>.content{background:none !important}#toc{border-bottom:1px solid #dddddf !important;padding-bottom:0 !important}body.book #header{text-align:center}body.book #header>h1:first-child{border:0 !important;margin:2.5em 0 1em}body.book #header .details{border:0 !important;display:block;padding:0 !important}body.book #header .details span:first-child{margin-left:0 !important}body.book #header .details br{display:block}body.book #header .details br+span::before{content:none !important}body.book #toc{border:0 !important;text-align:left !important;padding:0 !important;margin:0 !important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]::before{display:block}div.page-break{display:block;page-break-after:always}#footer{padding:0 0.9375em}.hide-on-print{display:none !important}.print-only{display:block !important}.hide-for-print{display:none !important}.show-for-print{display:inherit !important}}@media amzn-kf8, print{#header>h1:first-child{margin-top:1.25rem}.sect1{padding:0 !important}.sect1+.sect1{border:0}#footer{background:none}#footer-text{color:rgba(0,0,0,0.6);font-size:0.9em}}@media amzn-kf8{body>div[id]{padding:0}}body{padding:0;margin:0;margin-top:70px !important}.container{position:relative;z-index:1;padding-top:50px;min-height:100%}.container p{font-family:sans-serif;font-size:1.2em}nav{position:fixed;z-index:9999;left:0;right:0;top:0;height:70px;padding:0 1.5em;background-color:#025d8c;font-family:sans-serif;line-height:70px}nav .logo{width:50px;vertical-align:middle}nav .nav-menu{position:absolute;right:0.3em;top:0;padding:0;margin:0;list-style:none}nav .nav-item{display:inline-block}nav .nav-item>a{display:inline-block;padding:0 2.5em;line-height:70px;color:#fff;text-decoration:none}nav .dropdown{position:relative}nav .dropdown a::after{content:"";display:inline-block;margin-left:0.5em;vertical-align:middle;border-top:0.3em solid #fff;border-right:0.3em solid transparent;border-left:0.3em solid transparent}nav .dropdown.show a::after{transform:rotate(180deg)}nav .dropdown-menu{display:none;position:absolute;left:0;right:0;top:100%;padding:0.5em 0;margin-top:-0.5em;border:1px solid rgba(0,0,0,0.3);border-radius:0.5em;background-color:#fff;width:max-content}nav .dropdown-menu-left{left:auto;right:0}nav .dropdown.show .dropdown-menu{display:block}nav .dropdown-div{display:block;padding:0.4em 0;line-height:4em}nav .dropdown-div a::after{content:none;margin-left:0;border-top:0;border-right:0;border-left:0}nav .dropdown-item{display:block;padding:0 1.5em;font-size:0.875em;color:#000;line-height:1.6em;text-decoration:none}nav .btn-hamburger{display:none;position:absolute;right:1.5em;top:50%;background-color:transparent;border:0;cursor:pointer;outline:none;transform:translateY(-50%)}nav .btn-hamburger span{display:block;width:30px;height:4px;background-color:#fff;margin:6px;border-radius:2px;transition:0.3s ease-in-out}nav .btn-hamburger span:nth-child(4),nav .btn-hamburger span:nth-child(5){position:absolute;top:10px;opacity:0.5}nav .btn-hamburger span:nth-child(4){transform:rotate(45deg) scale(0)}nav .btn-hamburger span:nth-child(5){transform:rotate(-45deg) scale(0)}nav.opened .btn-hamburger span:nth-child(4){opacity:1;transform:rotate(45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(5){opacity:1;transform:rotate(-45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(1),nav.opened .btn-hamburger span:nth-child(2),nav.opened .btn-hamburger span:nth-child(3){opacity:0}@media screen and (max-width: 768px){nav .nav-menu{position:fixed;left:0;right:0;top:70px;bottom:100%;display:flex;flex-direction:column;justify-content:start;background-color:#363d4e;transition:bottom 0.5s ease-in-out;overflow:hidden}nav.opened .nav-menu{bottom:0}nav .nav-item>a{display:block}nav .dropdown-menu{position:relative;top:0;margin:0 1.5em}nav .btn-hamburger{display:block}}@media screen{div.narrow{max-width:1080px;margin:0 auto !important;margin-top:70px auto !important;float:none !important}#toc.toc2{margin-top:70px !important}}

</style>
<!-- docinfo -->
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Configuring Hosts Using Ansible</h1>
<div class="details">
<span id="revnumber">version 3.4 (unsupported),</span>
<span id="revdate">published Apr 26 2023</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Getting_Started_with_Ansible_in_foreman_ansible">1. Getting Started with Ansible in Foreman</a>
<ul class="sectlevel2">
<li><a href="#supported-ansible-versions_ansible">1.1. Supported Ansible Versions</a></li>
<li><a href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible">1.2. Configuring Your Foreman to Run Ansible Roles</a></li>
<li><a href="#Enabling_Ansible_Integration_with_foreman_ansible">1.3. Enabling Ansible Integration with Foreman</a></li>
<li><a href="#Importing_Ansible_Roles_and_Variables_ansible">1.4. Importing Ansible Roles and Variables</a></li>
<li><a href="#Overriding_Ansible_Variables_in_foreman_ansible">1.5. Overriding Ansible Variables in Foreman</a></li>
<li><a href="#synchronizing-ansible-collections_ansible">1.6. Synchronizing Ansible Collections</a></li>
</ul>
</li>
<li><a href="#Using_Ansible_Roles_to_Automate_Repetitive_Tasks_on_Clients_ansible">2. Using Ansible Roles to Automate Repetitive Tasks on Clients</a>
<ul class="sectlevel2">
<li><a href="#Assigning_Ansible_Roles_to_an_Existing_Host_ansible">2.1. Assigning Ansible Roles to an Existing Host</a></li>
<li><a href="#removing-ansible-roles-from-a-host_ansible">2.2. Removing Ansible Roles from a Host</a></li>
<li><a href="#changing-the-order-of-ansible-roles_ansible">2.3. Changing the Order of Ansible Roles</a></li>
<li><a href="#running-ansible-roles-on-a-host_ansible">2.4. Running Ansible Roles on a Host</a></li>
<li><a href="#Assigning_Ansible_Roles_to_a_Host_Group_ansible">2.5. Assigning Ansible Roles to a Host Group</a></li>
<li><a href="#running-ansible-roles-on-a-host-group_ansible">2.6. Running Ansible Roles on a Host Group</a></li>
<li><a href="#running-ansible-roles-in-check-mode_ansible">2.7. Running Ansible Roles in Check Mode</a></li>
</ul>
</li>
<li><a href="#Configuring_and_Setting_Up_Remote_Jobs_ansible">3. Configuring and Setting Up Remote Jobs</a>
<ul class="sectlevel2">
<li><a href="#about-running-jobs-on-hosts_ansible">3.1. About Running Jobs on Hosts</a></li>
<li><a href="#remote-execution-workflow_ansible">3.2. Remote Execution Workflow</a></li>
<li><a href="#permissions-for-remote-execution_ansible">3.3. Permissions for Remote Execution</a></li>
<li><a href="#transport-modes-for-remote-execution_ansible">3.4. Transport Modes for Remote Execution</a></li>
<li><a href="#creating-a-job-template_ansible">3.5. Creating a Job Template</a></li>
<li><a href="#importing-an-ansible-playbook-by-name_ansible">3.6. Importing an Ansible Playbook by Name</a></li>
<li><a href="#importing-all-available-ansible-playbooks_ansible">3.7. Importing All Available Ansible Playbooks</a></li>
<li><a href="#Configuring_the_Fallback_to_any_smart-proxy_Remote_Execution_Setting_in_foreman_ansible">3.8. Configuring the Fallback to Any Smart&#160;Proxy Remote Execution Setting in Foreman</a></li>
<li><a href="#Configuring_the_Global_smart-proxy_Remote_Execution_Setting_in_foreman_ansible">3.9. Configuring the Global Smart&#160;Proxy Remote Execution Setting in Foreman</a></li>
<li><a href="#Configuring_foreman_to_Use_an_Alternative_Directory_to_Execute_Remote_Jobs_on_Hosts_ansible">3.10. Configuring Foreman to Use an Alternative Directory to Execute Remote Jobs on Hosts</a></li>
<li><a href="#Distributing_SSH_Keys_for_Remote_Execution_ansible">3.11. Distributing SSH Keys for Remote Execution</a></li>
<li><a href="#distributing-ssh-keys-for-remote-execution-manually_ansible">3.12. Distributing SSH Keys for Remote Execution Manually</a></li>
<li><a href="#Using_the_foreman_API_to_Obtain_SSH_Keys_for_Remote_Execution_ansible">3.13. Using the Foreman API to Obtain SSH Keys for Remote Execution</a></li>
<li><a href="#Configuring_a_AutoYaST_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible">3.14. Configuring a AutoYaST Template to Distribute SSH Keys During Provisioning</a></li>
<li><a href="#Configuring_a_Kickstart_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible">3.15. Configuring a Kickstart Template to Distribute SSH Keys During Provisioning</a></li>
<li><a href="#Configuring_a_Preseed_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible">3.16. Configuring a Preseed Template to Distribute SSH Keys During Provisioning</a></li>
<li><a href="#configuring-a-keytab-for-kerberos-ticket-granting-tickets_ansible">3.17. Configuring a keytab for Kerberos Ticket Granting Tickets</a></li>
<li><a href="#configuring-kerberos-authentication-for-remote-execution_ansible">3.18. Configuring Kerberos Authentication for Remote Execution</a></li>
<li><a href="#setting-up-job-templates_ansible">3.19. Setting up Job Templates</a></li>
<li><a href="#executing-a-remote-job_ansible">3.20. Executing a Remote Job</a></li>
<li><a href="#scheduling-a-recurring-ansible-job-for-a-host_ansible">3.21. Scheduling a Recurring Ansible Job for a Host</a></li>
<li><a href="#Scheduling_a_Recurring_Ansible_Job_for_a_Host_Group_ansible">3.22. Scheduling a Recurring Ansible Job for a Host Group</a></li>
<li><a href="#Monitoring_Jobs_ansible">3.23. Monitoring Jobs</a></li>
</ul>
</li>
<li><a href="#Integrating_foreman_and_AWX_ansible">4. Integrating Foreman and AWX</a>
<ul class="sectlevel2">
<li><a href="#Adding_foreman_Server_to_AWX_as_a_Dynamic_Inventory_Item_ansible">4.1. Adding Foreman&#160;server to AWX as a Dynamic Inventory Item</a></li>
<li><a href="#Configuring_Provisioning_Callback_for_a_Host_ansible">4.2. Configuring Provisioning Callback for a Host</a></li>
</ul>
</li>
<li><a href="#Job_Template_Examples_and_Extensions_ansible">5. Job Template Examples and Extensions</a>
<ul class="sectlevel2">
<li><a href="#Customizing_Job_Templates_ansible">5.1. Customizing Job Templates</a></li>
<li><a href="#default-job-template-categories_ansible">5.2. Default Job Template Categories</a></li>
<li><a href="#Example_restorecon_Template_ansible">5.3. Example restorecon Template</a></li>
<li><a href="#Rendering_a_restorecon_Template_ansible">5.4. Rendering a restorecon Template</a></li>
<li><a href="#Executing_a_restorecon_Template_on_Multiple_Hosts_ansible">5.5. Executing a restorecon Template on Multiple Hosts</a></li>
<li><a href="#Including_Power_Actions_in_Templates_ansible">5.6. Including Power Actions in Templates</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="Getting_Started_with_Ansible_in_foreman_ansible"><a class="anchor" href="#Getting_Started_with_Ansible_in_foreman_ansible"></a>1. Getting Started with Ansible in Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this guide to configure Foreman to use Ansible for remote execution.</p>
</div>
<div class="sect2">
<h3 id="supported-ansible-versions_ansible"><a class="anchor" href="#supported-ansible-versions_ansible"></a>1.1. Supported Ansible Versions</h3>
<div class="paragraph">
<p>Foreman uses Ansible as provided by the base operating system of Foreman&#160;server or any Smart&#160;Proxies for remote execution.
Therefore, the supported version of Ansible depends on your base OS configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Your_foreman_to_Run_Ansible_Roles_ansible"><a class="anchor" href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible"></a>1.2. Configuring Your Foreman to Run Ansible Roles</h3>
<div class="paragraph">
<p>In Foreman, you can import Ansible roles to help with automation of routine tasks.
To enable Ansible on Foreman&#160;server, see <a href="#Enabling_Ansible_Integration_with_foreman_ansible">Enabling Ansible Integration with Foreman</a>.</p>
</div>
<div id="Ansible-paths_ansible" class="paragraph">
<div class="title">Ansible paths</div>
<p>Foreman imports Ansible roles and variables from paths based on configuration in <code>/etc/ansible/ansible.cfg</code>.
Foreman then runs imported roles from paths based on configuration in <code>/etc/foreman-proxy/ansible.cfg</code>.
In both cases, Foreman reads the paths from <code>roles_path</code> and <code>collections_paths</code> directives.
Keep these two cfg files in sync, otherwise you might import roles that cannot be run or you will not see roles you can run.</p>
</div>
<div class="paragraph">
<p>If none of the paths are specified in the configuration files, the following default paths are used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/etc/ansible/roles</code></p>
</li>
<li>
<p><code>/usr/share/ansible/roles</code></p>
</li>
<li>
<p><code>/etc/ansible/collections</code></p>
</li>
<li>
<p><code>/usr/share/ansible/collections</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure your <a href="#Ansible-paths_ansible">Ansible paths</a> on the Foreman&#160;server and all Smart&#160;Proxy&#160;servers where you want to use the roles.</p>
</li>
<li>
<p>Add the roles to a directory in an <a href="#Ansible-paths_ansible">Ansible path</a> on the Foreman&#160;server and all Smart&#160;Proxy&#160;servers from where you want to use the roles.
If you want to use custom or third party Ansible roles, ensure to configure an external version control system to synchronize roles between Foreman&#160;server and Smart&#160;Proxy&#160;servers.</p>
</li>
<li>
<p>On all Smart&#160;Proxy&#160;servers that you want to use to run Ansible roles on hosts, enable the Ansible plug-in:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --no-enable-foreman --no-enable-foreman-plugin-puppet --no-enable-foreman-cli --no-enable-foreman-cli-puppet \
--enable-foreman-proxy-plugin-ansible</pre>
</div>
</div>
</li>
<li>
<p>Distribute SSH keys to enable Smart&#160;Proxies to connect to hosts using SSH.
For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#ssh-keys-for-remote-execution-overview_managing-hosts">Distributing SSH Keys for Remote Execution</a> in <em>Managing Hosts</em>.
Foreman runs Ansible roles the same way it runs remote execution jobs.</p>
</li>
<li>
<p>Import the Ansible roles into Foreman.</p>
</li>
<li>
<p>Proceed to <a href="#Using_Ansible_Roles_to_Automate_Repetitive_Tasks_on_Clients_ansible">Using Ansible Roles to Automate Repetitive Tasks on Clients</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Enabling_Ansible_Integration_with_foreman_ansible"><a class="anchor" href="#Enabling_Ansible_Integration_with_foreman_ansible"></a>1.3. Enabling Ansible Integration with Foreman</h3>
<div class="paragraph">
<p>Perform the following procedure to enable the Ansible plug-in on your Foreman&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enable the Ansible plug-in on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-plugin-ansible \
--enable-foreman-proxy-plugin-ansible</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Importing_Ansible_Roles_and_Variables_ansible"><a class="anchor" href="#Importing_Ansible_Roles_and_Variables_ansible"></a>1.4. Importing Ansible Roles and Variables</h3>
<div class="paragraph">
<p>You can import Ansible roles and variables from the <a href="#Ansible-paths_ansible">Ansible paths</a> on Foreman&#160;server or Smart&#160;Proxy that has Ansible enabled.</p>
</div>
<div class="paragraph">
<p>Note that some roles take longer to import than others.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ensure that the roles and variables that you import are located in the <a href="#Ansible-paths_ansible">Ansible paths</a> on all Smart&#160;Proxies from where you want to use the roles.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Click <strong>Import</strong> to select the Smart&#160;Proxy from which you want to import.</p>
</li>
<li>
<p>Select the roles that you want to import.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Overriding_Ansible_Variables_in_foreman_ansible"><a class="anchor" href="#Overriding_Ansible_Variables_in_foreman_ansible"></a>1.5. Overriding Ansible Variables in Foreman</h3>
<div class="paragraph">
<p>If you run Ansible roles in Foreman, you can use Foreman to override Ansible variables for those roles.</p>
</div>
<div class="paragraph">
<p>The following procedure refers to hosts and host groups.
For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#"><em>Managing Hosts</em></a>.</p>
</div>
<div class="paragraph">
<div class="title">Precedence in Overriding Variables</div>
<p>If you use an Ansible role to run a task as a user that is not the <code>Effective User</code>, there is a strict order of precedence for overriding Ansible variables.
To ensure the variable that you override follows the correct order of precedence, see <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#ansible-variable-precedence">Variable precedence: Where should I put a variable?</a></p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>You must have Ansible variables in Foreman.
For more information, see <a href="#Importing_Ansible_Roles_and_Variables_ansible">Importing Ansible Roles and Variables</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Variables</strong>.</p>
</li>
<li>
<p>Select the Ansible variable that you want to override and manage with Foreman.</p>
</li>
<li>
<p>In the <strong>Default Behavior</strong> area, select the <strong>Override</strong> checkbox.</p>
</li>
<li>
<p>In the <strong>Parameter Type</strong> field, select the value type for validation such as <strong>string</strong> or <strong>boolean</strong>.
The types <strong>array</strong> and <strong>hash</strong> have further options for handling upon a variable match.
For more information, see <a href="#prioritize-order">the <em>Prioritize Attribute Order</em> area</a> below.</p>
</li>
<li>
<p>In the <strong>Default Value</strong> field, enter the default value that you want to use if there is no match for the variable.</p>
</li>
<li>
<p>Optional: If you do not want to display the value of the variable as plain text in the Foreman web UI, select the <strong>Hidden Value</strong> checkbox to display the content of the variable as asterisks.
This is useful for sensitive values such as passwords or secret tokens.</p>
</li>
<li>
<p>Optional: Expand the <strong>Optional Input Validator</strong> area and specify conditions that will be used to validate concrete values of the variable:</p>
<div class="ulist">
<ul>
<li>
<p>Select <strong>Required</strong> if you want to enforce users to fill in this variable.</p>
</li>
<li>
<p>In the <strong>Validator Type</strong> field, select how the value will be validated:</p>
<div class="ulist">
<ul>
<li>
<p><code>list</code> &#8211; The value will be validated against an enumeration of allowed values.</p>
</li>
<li>
<p><code>regex</code> &#8211; The value will be validated against a regular expression pattern.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: <span id="prioritize-order">In the <strong>Prioritize Attribute Order</strong> area</span>, specify the order of priority to match an override with a host by host attributes.
Order at the top takes higher precedence.
The first match wins.</p>
<div class="paragraph">
<p>You can combine multiple attributes into a single matcher key using a comma as the AND operation.
For example, the matcher key of <code>hostgroup, environment</code> would expect matchers such as <code>hostgroup = "web servers"</code> AND <code>environment = production</code>.</p>
</div>
<div class="paragraph">
<p>If you use the parameter type <strong>array</strong> or <strong>hash</strong>, you can further set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Merge Overrides</strong> &#8211; Merges members of the arrays/hashes instead of replacing the whole array or hash.
If the hashes contain the same key, the value is overwritten by the value of the host.</p>
</li>
<li>
<p><strong>Merge Default</strong> &#8211; Adds the default value to the array or hash.</p>
</li>
<li>
<p><strong>Avoid Duplicates</strong> &#8211; Ensures that the values in the array or hash are unique.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: Expand the <strong>Specify Matchers</strong> area and specify criteria for selecting hosts on which the variable overrides.</p>
</li>
<li>
<p>To save the override settings, click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To use the Ansible variable, add the variable as a parameter to your host or host group, or add the variable as a global parameter.</p>
</div>
<div class="olist arabic">
<div class="title">Adding the Variable to a Host</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts &gt; All Hosts</strong> and select the host that you want to use.</p>
</li>
<li>
<p>Click the <strong>Ansible</strong> tab, and in the <strong>Variables</strong> area, click the pencil icon to edit the value of the variable.</p>
</li>
<li>
<p>Click the tick icon to accept the value of the changed variable or the cross icon to cancel the change.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Adding the Variable to a Host Group</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>, and select the host group that you want to use.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab, and in the <strong>Host Group Parameters</strong> area, click <strong>Add Parameter</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, add the Ansible variable name.</p>
</li>
<li>
<p>From the <strong>Type</strong> list, select the type of the variable for validation.</p>
</li>
<li>
<p>In the <strong>Value</strong> field, enter the value for the variable.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Adding the Variable as a Global Parameter</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Global Parameters</strong>, and click <strong>Create Parameter</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, add the Ansible variable name.</p>
</li>
<li>
<p>From the <strong>Type</strong> list, select the type of the variable for validation.</p>
</li>
<li>
<p>In the <strong>Value</strong> field, enter the value for the variable.</p>
</li>
<li>
<p>Optional: If you do not want to display the Ansible variable in plain text, select the <strong>Hidden Values</strong> checkbox to display the content of the variable as asterisks in the Foreman web UI.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="synchronizing-ansible-collections_ansible"><a class="anchor" href="#synchronizing-ansible-collections_ansible"></a>1.6. Synchronizing Ansible Collections</h3>
<div class="paragraph">
<p>On Foreman, you can synchronize your Ansible Collections from any Ansible Galaxy and other Foreman instances.
Ansible Collections will appear on Foreman as a new repository type in the Foreman web UI menu under <strong>Content</strong> after the sync.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Content</strong> &gt; <strong>Products</strong>.</p>
</li>
<li>
<p>Select the required product name.</p>
</li>
<li>
<p>In the <strong>Products</strong> window, select the name of a product that you want to create a repository for.</p>
</li>
<li>
<p>Click the <strong>Repositories</strong> tab, and then click <strong>New Repository</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the repository.</p>
<div class="paragraph">
<p>The <strong>Label</strong> field is populated automatically based on the name.</p>
</div>
</li>
<li>
<p>From the <strong>Type</strong> list, select <strong>ansible collection</strong>.</p>
</li>
<li>
<p>In the <strong>Upstream URL</strong> field, enter the URL for the upstream collections repository.</p>
<div class="paragraph">
<p>The URL can be any Ansible Galaxy endpoint.
For example, <code>https://galaxy.ansible.com</code>.</p>
</div>
</li>
<li>
<p>Optional: In the <strong>Requirements.yml</strong> field, you can specify the list of collections you want to sync from the endpoint, as well as their versions.</p>
<div class="paragraph">
<p>If you do not specify the list of collections, everything from the endpoint will be synced.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Yaml" data-lang="Yaml">---
collections:
- name: my_namespace.my_collection
  version: 1.2.3</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.ansible.com/ansible/latest/galaxy/user_guide.html#install-multiple-collections-with-a-requirements-file">Install multiple collections with a requirements file</a> in <em>Galaxy User Guide</em>.</p>
</div>
</li>
<li>
<p>Authenticate.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To sync Foreman from <strong>Private Automation Hub</strong>, enter your token in the <strong>Auth Token</strong> field.</p>
</li>
<li>
<p>To sync Foreman from <code>console.redhat.com</code>, enter your token in the <strong>Auth Token</strong> field and enter your SSO URL in the the <strong>Auth URL</strong> field.</p>
</li>
<li>
<p>To sync Foreman from Foreman, leave both authentication fields blank.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Navigate to the Ansible Collections repository.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> menu, select <strong>Sync Now</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Using_Ansible_Roles_to_Automate_Repetitive_Tasks_on_Clients_ansible"><a class="anchor" href="#Using_Ansible_Roles_to_Automate_Repetitive_Tasks_on_Clients_ansible"></a>2. Using Ansible Roles to Automate Repetitive Tasks on Clients</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Assigning_Ansible_Roles_to_an_Existing_Host_ansible"><a class="anchor" href="#Assigning_Ansible_Roles_to_an_Existing_Host_ansible"></a>2.1. Assigning Ansible Roles to an Existing Host</h3>
<div class="paragraph">
<p>You can use Ansible roles for remote management of Foreman clients.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you have configured and imported Ansible roles.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts &gt; All Hosts</strong>.</p>
</li>
<li>
<p>Select the host and click <strong>Edit</strong>.</p>
</li>
<li>
<p>On the <strong>Ansible Roles</strong> tab, select the role that you want to add from the <strong>Available Ansible Roles</strong> list.</p>
</li>
<li>
<p>Click the <strong>+</strong> icon to add the role to the host.
You can add more than one role.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After you assign Ansible roles to hosts, you can use Ansible for remote execution.
For more information, see <a href="#Distributing_SSH_Keys_for_Remote_Execution_ansible">Distributing SSH Keys for Remote Execution</a>.</p>
</div>
<div class="paragraph">
<div class="title">Overriding Parameter Variables</div>
<p>On the <strong>Parameters</strong> tab, click <strong>Add Parameter</strong> to add any parameter variables that you want to pass to job templates at run time.
This includes all Ansible playbook parameters and host parameters that you want to associate with the host.
To use a parameter variable with an Ansible job template, you must add a <strong>Host Parameter</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="removing-ansible-roles-from-a-host_ansible"><a class="anchor" href="#removing-ansible-roles-from-a-host_ansible"></a>2.2. Removing Ansible Roles from a Host</h3>
<div class="paragraph">
<p>Use the following procedure to remove Ansible roles from a host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts &gt; All Hosts</strong>.</p>
</li>
<li>
<p>Select the host and click <strong>Edit</strong>.</p>
</li>
<li>
<p>Select the <strong>Ansible Roles</strong> tab.</p>
</li>
<li>
<p>In the <strong>Assigned Ansible Roles</strong> area, click the <strong>-</strong> icon to remove the role from the host.
Repeat to remove more roles.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="changing-the-order-of-ansible-roles_ansible"><a class="anchor" href="#changing-the-order-of-ansible-roles_ansible"></a>2.3. Changing the Order of Ansible Roles</h3>
<div class="paragraph">
<p>Use the following procedure to change the order of Ansible roles applied to a host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts &gt; All Hosts</strong>.</p>
</li>
<li>
<p>Select a host.</p>
</li>
<li>
<p>Select the <strong>Ansible Roles</strong> tab.</p>
</li>
<li>
<p>In the <strong>Assigned Ansible Roles</strong> area, you can change the order of the roles by dragging and dropping the roles into the preferred position.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the order of the Ansible roles.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="running-ansible-roles-on-a-host_ansible"><a class="anchor" href="#running-ansible-roles-on-a-host_ansible"></a>2.4. Running Ansible Roles on a Host</h3>
<div class="paragraph">
<p>You can run Ansible roles on a host through the Foreman web UI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must configure your deployment to run Ansible roles.
For more information, see <a href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible">Configuring Your Foreman to Run Ansible Roles</a>.</p>
</li>
<li>
<p>You must have assigned the Ansible roles to the host.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</li>
<li>
<p>Select the checkbox of the host that contains the Ansible role you want to run.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Run all Ansible roles</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can view the status of your Ansible job on the <strong>Run Ansible roles</strong> page.
To rerun a job, click the <strong>Rerun</strong> button.</p>
</div>
</div>
<div class="sect2">
<h3 id="Assigning_Ansible_Roles_to_a_Host_Group_ansible"><a class="anchor" href="#Assigning_Ansible_Roles_to_a_Host_Group_ansible"></a>2.5. Assigning Ansible Roles to a Host Group</h3>
<div class="paragraph">
<p>You can use Ansible roles for remote management of Foreman clients.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>You must configure your deployment to run Ansible roles.
For more information, see <a href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible">Configuring Your Foreman to Run Ansible Roles</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>.</p>
</li>
<li>
<p>Click the host group name to which you want to assign an Ansible role.</p>
</li>
<li>
<p>On the <strong>Ansible Roles</strong> tab, select the role that you want to add from the <strong>Available Ansible Roles</strong> list.</p>
</li>
<li>
<p>Click the <strong>+</strong> icon to add the role to the host group.
You can add more than one role.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="running-ansible-roles-on-a-host-group_ansible"><a class="anchor" href="#running-ansible-roles-on-a-host-group_ansible"></a>2.6. Running Ansible Roles on a Host Group</h3>
<div class="paragraph">
<p>You can run Ansible roles on a host group through the Foreman web UI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must configure your deployment to run Ansible roles.
For more information, see <a href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible">Configuring Your Foreman to Run Ansible Roles</a>.</p>
</li>
<li>
<p>You must have assigned the Ansible roles to the host group.</p>
</li>
<li>
<p>You must have at least one host in your host group.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>.</p>
</li>
<li>
<p>From the list in the <strong>Actions</strong> column for the host group, select <strong>Run all Ansible roles</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can view the status of your Ansible job on the <strong>Run Ansible roles</strong> page.
To rerun a job, click the <strong>Rerun</strong> button.</p>
</div>
</div>
<div class="sect2">
<h3 id="running-ansible-roles-in-check-mode_ansible"><a class="anchor" href="#running-ansible-roles-in-check-mode_ansible"></a>2.7. Running Ansible Roles in Check Mode</h3>
<div class="paragraph">
<p>You can run Ansible roles in check mode through the Foreman web UI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must configure your deployment to run Ansible roles.
For more information, see <a href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible">Configuring Your Foreman to Run Ansible Roles</a>.</p>
</li>
<li>
<p>You must have assigned the Ansible roles to the host group.</p>
</li>
<li>
<p>You must have at least one host in your host group.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> <strong>&gt;</strong> <strong>All Hosts</strong>.</p>
</li>
<li>
<p>Click <strong>Edit</strong> for the host you want to enable check mode for.</p>
</li>
<li>
<p>In the <strong>Parameters</strong> tab, ensure that the host has a parameter named <code>ansible_roles_check_mode</code> with type <code>boolean</code> set to <code>true</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_and_Setting_Up_Remote_Jobs_ansible"><a class="anchor" href="#Configuring_and_Setting_Up_Remote_Jobs_ansible"></a>3. Configuring and Setting Up Remote Jobs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this section as a guide to configuring Foreman to execute jobs on remote hosts.</p>
</div>
<div class="paragraph">
<p>Any command that you want to apply to a remote host must be defined as a job template.
After you have defined a job template you can execute it multiple times.</p>
</div>
<div class="sect2">
<h3 id="about-running-jobs-on-hosts_ansible"><a class="anchor" href="#about-running-jobs-on-hosts_ansible"></a>3.1. About Running Jobs on Hosts</h3>
<div class="paragraph">
<p>You can run jobs on hosts remotely from Smart&#160;Proxies using shell scripts or Ansible tasks and playbooks.
This is referred to as remote execution.</p>
</div>
<div class="paragraph">
<p>For custom Ansible roles that you create, or roles that you download, you must install the package containing the roles on the Smart&#160;Proxy base operating system.
Before you can use Ansible roles, you must import the roles into Foreman from the Smart&#160;Proxy where they are installed.</p>
</div>
<div class="paragraph">
<p>Communication occurs through Smart&#160;Proxy&#160;server, which means that Foreman&#160;server does not require direct access to the target host, and can scale to manage many hosts.
For more information, see <a href="#transport-modes-for-remote-execution_ansible">Transport Modes for Remote Execution</a>.</p>
</div>
<div class="paragraph">
<p>Foreman uses ERB syntax job templates.
For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#Template_Writing_Reference_managing-hosts">Template Writing Reference</a> in <em>Managing Hosts</em>.</p>
</div>
<div class="paragraph">
<p>Several job templates for shell scripts and Ansible are included by default.
For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#setting-up-job-templates_managing-hosts">Setting up Job Templates</a> in <em>Managing Hosts</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Any Smart&#160;Proxy&#160;server base operating system is a client of Foreman&#160;server&#8217;s internal Smart&#160;Proxy, and therefore this section applies to any type of host connected to Foreman&#160;server, including Smart&#160;Proxies.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can run jobs on multiple hosts at once, and you can use variables in your commands for more granular control over the jobs you run.
You can use host facts and parameters to populate the variable values.</p>
</div>
<div class="paragraph">
<p>In addition, you can specify custom values for templates when you run the command.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#executing-a-remote-job_managing-hosts">Executing a Remote Job</a> in <em>Managing Hosts</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="remote-execution-workflow_ansible"><a class="anchor" href="#remote-execution-workflow_ansible"></a>3.2. Remote Execution Workflow</h3>
<div class="paragraph">
<p>When you run a remote job on hosts, for every host, Foreman performs the following actions to find a remote execution Smart&#160;Proxy to use.</p>
</div>
<div class="paragraph">
<p>Foreman searches only for Smart&#160;Proxies that have the Ansible feature enabled.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Foreman finds the host&#8217;s interfaces that have the <strong>Remote execution</strong> checkbox selected.</p>
</li>
<li>
<p>Foreman finds the subnets of these interfaces.</p>
</li>
<li>
<p>Foreman finds remote execution Smart&#160;Proxies assigned to these subnets.</p>
</li>
<li>
<p>From this set of Smart&#160;Proxies, Foreman selects the Smart&#160;Proxy that has the least number of running jobs.
By doing this, Foreman ensures that the jobs load is balanced between remote execution Smart&#160;Proxies.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you have enabled <strong>Prefer registered through Smart&#160;Proxy for remote execution</strong>, Foreman runs the REX job using the Smart&#160;Proxy the host is registered to.</p>
</div>
<div class="paragraph">
<p>By default, <strong>Prefer registered through Smart&#160;Proxy for remote execution</strong> is set to <strong>No</strong>.
To enable it, in the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and on the <strong>Content</strong> tab, set <code>Prefer registered through Smart&#160;Proxy for remote execution</code> to <strong>Yes</strong>.
This ensures that Foreman performs REX jobs on hosts by the Smart&#160;Proxy to which they are registered to.</p>
</div>
<div class="paragraph">
<p>If Foreman does not find a remote execution Smart&#160;Proxy at this stage, and if the <strong>Fallback to Any Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman selects the most lightly loaded Smart&#160;Proxy from the following types of Smart&#160;Proxies that are assigned to the host:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DHCP, DNS and TFTP Smart&#160;Proxies assigned to the host&#8217;s subnets</p>
</li>
<li>
<p>DNS Smart&#160;Proxy assigned to the host&#8217;s domain</p>
</li>
<li>
<p>Realm Smart&#160;Proxy assigned to the host&#8217;s realm</p>
</li>
<li>
<p>Puppet server Smart&#160;Proxy</p>
</li>
<li>
<p>Puppet CA Smart&#160;Proxy</p>
</li>
<li>
<p>OpenSCAP Smart&#160;Proxy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If Foreman does not find a remote execution Smart&#160;Proxy at this stage, and if the <strong>Enable Global Smart&#160;Proxy</strong> setting is enabled, Foreman selects the most lightly loaded remote execution Smart&#160;Proxy from the set of all Smart&#160;Proxies in the host&#8217;s organization and location to execute a remote job.</p>
</div>
</div>
<div class="sect2">
<h3 id="permissions-for-remote-execution_ansible"><a class="anchor" href="#permissions-for-remote-execution_ansible"></a>3.3. Permissions for Remote Execution</h3>
<div class="paragraph">
<p>You can control which roles can run which jobs within your infrastructure, including which hosts they can target.
The remote execution feature provides two built-in roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Remote Execution Manager</strong>: Can access all remote execution features and functionality.</p>
</li>
<li>
<p><strong>Remote Execution User</strong>: Can only run jobs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can clone the <strong>Remote Execution User</strong> role and customize its filter for increased granularity.
If you adjust the filter with the <code>view_job_templates</code> permission on a customized role, you can only see and trigger jobs based on matching job templates.
You can use the <code>view_hosts</code> and <code>view_smart_proxies</code> permissions to limit which hosts or Smart&#160;Proxies are visible to the role.</p>
</div>
<div class="paragraph">
<p>The <code>execute_template_invocation</code> permission is a special permission that is checked immediately before execution of a job begins.
This permission defines which job template you can run on a particular host.
This allows for even more granularity when specifying permissions.</p>
</div>
<div class="paragraph">
<p>You can run remote execution jobs against Foreman and Smart&#160;Proxy registered as hosts to Foreman with the <code>execute_jobs_on_infrastructure_hosts</code> permission.
Standard <strong>Manager</strong> and <strong>Site Manager</strong> roles have this permission by default.
If you use either the <strong>Manager</strong> or <strong>Site Manager</strong> role, or if you use a custom role with the <code>execute_jobs_on_infrastructure_hosts</code> permission, you can execute remote jobs against registered Foreman and Smart&#160;Proxy hosts.</p>
</div>
<div class="paragraph">
<p>For more information on working with roles and permissions, see <a href="https://docs.theforeman.org/3.4/Administering_Project/index-foreman-deb.html#Creating_and_Managing_Roles_admin">Creating and Managing Roles</a> in <em>Administering Foreman</em>.</p>
</div>
<div class="paragraph">
<p>The following example shows filters for the <code>execute_template_invocation</code> permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">name = Reboot and host.name = staging.example.com
name = Reboot and host.name ~ *.staging.example.com
name = "Restart service" and host_group.name = webservers</pre>
</div>
</div>
<div class="paragraph">
<p>Use the first line in this example to apply the <strong>Reboot</strong> template to one selected host.
Use the second line to define a pool of hosts with names ending with <code>.staging.example.com</code>.
Use the third line to bind the template with a host group.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Permissions assigned to users with these roles can change over time.
If you have already scheduled some jobs to run in the future, and the permissions change, this can result in execution failure because permissions are checked immediately before job execution.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="transport-modes-for-remote-execution_ansible"><a class="anchor" href="#transport-modes-for-remote-execution_ansible"></a>3.4. Transport Modes for Remote Execution</h3>
<div class="paragraph">
<p>You can configure your Foreman to use two different modes of transport for remote job execution.</p>
</div>
<div class="paragraph">
<p>On Smart&#160;Proxies in <code>ssh</code> mode, remote execution uses the SSH service to transport job details.
This is the default transport mode.
The SSH service must be enabled and active on the target hosts.
The remote execution Smart&#160;Proxy must have access to the SSH port on the target hosts.
Unless you have a different setting, the standard SSH port is 22.</p>
</div>
<div class="paragraph">
<p>On Smart&#160;Proxies in <code>pull-mqtt</code> mode, remote execution uses Message Queueing Telemetry Transport (MQTT) to publish jobs it receives from Foreman&#160;server.
The host subscribes to the MQTT broker on Smart&#160;Proxy for job notifications using the <code>yggdrasil</code> pull client.
After the host receives a notification, it pulls job details from Smart&#160;Proxy over HTTPS, runs the job, and reports results back to Smart&#160;Proxy.</p>
</div>
<div class="paragraph">
<p>To use the <code>pull-mqtt</code> mode, you must enable it on Smart&#160;Proxy&#160;server and configure the pull client on the target hosts.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>To enable pull mode on Smart&#160;Proxy&#160;server, see <a href="https://docs.theforeman.org/3.4/Installing_Proxy/index-foreman-deb.html#configuring-remote-execution-for-pull-client_smart-proxy">Configuring Remote Execution for Pull Client</a> in <em>Installing an External Smart Proxy Server on Debian/Ubuntu</em>.</p>
</li>
<li>
<p>To migrate a host from Katello Agent, see <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#Migrating_From_Katello_Agent_to_Remote_Execution_managing-hosts">Migrating from Katello Agent to Remote Execution</a>.</p>
</li>
<li>
<p>To enable pull mode on a new host, continue either with <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#Creating_a_Host_managing-hosts">Creating a Host</a> or <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#Registering_Hosts_managing-hosts">Registering Hosts</a> in <em>Managing Hosts</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-job-template_ansible"><a class="anchor" href="#creating-a-job-template_ansible"></a>3.5. Creating a Job Template</h3>
<div class="paragraph">
<p>Use this procedure to create a job template.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-a-job-template_ansible">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Job templates</strong>.</p>
</li>
<li>
<p>Click <strong>New Job Template</strong>.</p>
</li>
<li>
<p>Click the <strong>Template</strong> tab, and in the <strong>Name</strong> field, enter a unique name for your job template.</p>
</li>
<li>
<p>Select <strong>Default</strong> to make the template available for all organizations and locations.</p>
</li>
<li>
<p>Create the template directly in the template editor or upload it from a text file by clicking <strong>Import</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Audit Comment</strong> field, add information about the change.</p>
</li>
<li>
<p>Click the <strong>Job</strong> tab, and in the <strong>Job category</strong> field, enter your own category or select from the default categories listed in <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#default-job-template-categories_managing-hosts">Default Job Template Categories</a> in <em>Managing Hosts</em>.</p>
</li>
<li>
<p>Optional: In the <strong>Description Format</strong> field, enter a description template.
For example, <code>Install package %{package_name}</code>.
You can also use <code>%{template_name}</code> and <code>%{job_category}</code> in your template.</p>
</li>
<li>
<p>From the <strong>Provider Type</strong> list, select <strong>SSH</strong> for shell scripts and <strong>Ansible</strong> for Ansible tasks or playbooks.</p>
</li>
<li>
<p>Optional: In the <strong>Timeout to kill</strong> field, enter a timeout value to terminate the job if it does not complete.</p>
</li>
<li>
<p>Optional: Click <strong>Add Input</strong> to define an input parameter.
Parameters are requested when executing the job and do not have to be defined in the template.
For examples, see the <strong>Help</strong> tab.</p>
</li>
<li>
<p>Optional: Click <strong>Foreign input set</strong> to include other templates in this job.</p>
</li>
<li>
<p>Optional: In the <strong>Effective user</strong> area, configure a user if the command cannot use the default <code>remote_execution_effective_user</code> setting.</p>
</li>
<li>
<p>Optional: If this template is a snippet to be included in other templates, click the <strong>Type</strong> tab and select <strong>Snippet</strong>.</p>
</li>
<li>
<p>Click the <strong>Location</strong> tab and add the locations where you want to use the template.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add the organizations where you want to use the template.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can extend and customize job templates by including other templates in the template syntax.
For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#template_writing_reference_managing-hosts">Template Writing Reference</a> and <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#job_template_examples_and_extensions_managing-hosts">Job Template Examples and Extensions</a> in <em>Managing Hosts</em>.</p>
</div>
<div id="cli-creating-a-job-template_ansible" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a job template using a template-definition file, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#hammer job-template create \
--file "<em>Path_to_My_Template_File</em>" \
--job-category "<em>My_Category_Name</em>" \
--name "<em>My_Template_Name</em>" \
--provider-type SSH</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="importing-an-ansible-playbook-by-name_ansible"><a class="anchor" href="#importing-an-ansible-playbook-by-name_ansible"></a>3.6. Importing an Ansible Playbook by Name</h3>
<div class="paragraph">
<p>You can import Ansible playbooks by name to Foreman from collections installed on Smart&#160;Proxy.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ansible plug-in in Foreman is enabled</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Fetch the available Ansible playbooks using the following API request:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -X GET 'Content-Type: application/json' https://<em>foreman.example.com</em>/ansible/api/v2/ansible_playbooks/fetch?proxy_id=<em>My</em>smart-proxy_ID_</pre>
</div>
</div>
</li>
<li>
<p>Select the Ansible playbook you want to import and note its name.</p>
</li>
<li>
<p>Import the Ansible playbook using its name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -X PUT 'Content-Type: application/json' -d '{ "playbook_names": ["<em>My_Playbook_Name</em>"] }' https://<em>foreman.example.com</em>/ansible/api/v2/ansible_playbooks/sync?proxy_id=<em>My</em>smart-proxy_ID_</pre>
</div>
</div>
<div class="paragraph">
<p>You get a notification in the Foreman web UI after the import completes.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="importing-all-available-ansible-playbooks_ansible"><a class="anchor" href="#importing-all-available-ansible-playbooks_ansible"></a>3.7. Importing All Available Ansible Playbooks</h3>
<div class="paragraph">
<p>You can import all the available Ansible playbooks to Foreman from collections installed on Smart&#160;Proxy.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ansible plug-in in Foreman is enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Import the Ansible playbooks using the following API request:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -X PUT 'Content-Type: application/json' https://<em>foreman.example.com</em>/ansible/api/v2/ansible_playbooks/sync?proxy_id=<em>My-smart-proxy-ID</em></pre>
</div>
</div>
<div class="paragraph">
<p>You get a notification in the Foreman web UI after the import completes.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_the_Fallback_to_any_smart-proxy_Remote_Execution_Setting_in_foreman_ansible"><a class="anchor" href="#Configuring_the_Fallback_to_any_smart-proxy_Remote_Execution_Setting_in_foreman_ansible"></a>3.8. Configuring the Fallback to Any Smart&#160;Proxy Remote Execution Setting in Foreman</h3>
<div class="paragraph">
<p>You can enable the <strong>Fallback to Any Smart&#160;Proxy</strong> setting to configure Foreman to search for remote execution Smart&#160;Proxies from the list of Smart&#160;Proxies that are assigned to hosts.
This can be useful if you need to run remote jobs on hosts that have no subnets configured or if the hosts' subnets are assigned to Smart&#160;Proxies that do not have the remote execution feature enabled.</p>
</div>
<div class="paragraph">
<p>If the <strong>Fallback to Any Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman also selects the most lightly loaded Smart&#160;Proxy from the set of all Smart&#160;Proxies assigned to the host, such as the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DHCP, DNS and TFTP Smart&#160;Proxies assigned to the host&#8217;s subnets</p>
</li>
<li>
<p>DNS Smart&#160;Proxy assigned to the host&#8217;s domain</p>
</li>
<li>
<p>Realm Smart&#160;Proxy assigned to the host&#8217;s realm</p>
</li>
<li>
<p>Puppet server Smart&#160;Proxy</p>
</li>
<li>
<p>Puppet CA Smart&#160;Proxy</p>
</li>
<li>
<p>OpenSCAP Smart&#160;Proxy</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Click <strong>Remote Execution</strong>.</p>
</li>
<li>
<p>Configure the <strong>Fallback to Any Smart&#160;Proxy</strong> setting.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the <code>hammer settings set</code> command on Foreman to configure the <strong>Fallback to Any Smart&#160;Proxy</strong> setting.
To set the value to <code>true</code>, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set \
--name=remote_execution_fallback_proxy \
--value=true</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_the_Global_smart-proxy_Remote_Execution_Setting_in_foreman_ansible"><a class="anchor" href="#Configuring_the_Global_smart-proxy_Remote_Execution_Setting_in_foreman_ansible"></a>3.9. Configuring the Global Smart&#160;Proxy Remote Execution Setting in Foreman</h3>
<div class="paragraph">
<p>By default, Foreman searches for remote execution Smart&#160;Proxies in hosts' organizations and locations regardless of whether Smart&#160;Proxies are assigned to hosts' subnets or not.
You can disable the <strong>Enable Global Smart&#160;Proxy</strong> setting if you want to limit the search to the Smart&#160;Proxies that are assigned to hosts' subnets.</p>
</div>
<div class="paragraph">
<p>If the <strong>Enable Global Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman also selects the most lightly loaded remote execution Smart&#160;Proxy from the set of all Smart&#160;Proxies in the host&#8217;s organization and location to execute a remote job.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Click <strong>Remote Execution</strong>.</p>
</li>
<li>
<p>Configure the <strong>Enable Global Smart&#160;Proxy</strong> setting.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the <code>hammer settings set</code> command on Foreman to configure the <code>Enable Global Smart&#160;Proxy</code> setting.
To set the value to <code>true</code>, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set \
--name=remote_execution_global_proxy \
--value=true</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_foreman_to_Use_an_Alternative_Directory_to_Execute_Remote_Jobs_on_Hosts_ansible"><a class="anchor" href="#Configuring_foreman_to_Use_an_Alternative_Directory_to_Execute_Remote_Jobs_on_Hosts_ansible"></a>3.10. Configuring Foreman to Use an Alternative Directory to Execute Remote Jobs on Hosts</h3>
<div class="paragraph">
<p>Ansible puts its own files it requires into the <code>$HOME/.ansible/tmp</code> directory, where <code>$HOME</code> is the home directory of the remote user.
You have the option to set a different directory if required.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a new directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir <em>/My_Remote_Working_Directory</em></pre>
</div>
</div>
</li>
<li>
<p>Configure the system:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-plugin-ansible-working-dir <em>/My_Remote_Working_Directory</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Distributing_SSH_Keys_for_Remote_Execution_ansible"><a class="anchor" href="#Distributing_SSH_Keys_for_Remote_Execution_ansible"></a>3.11. Distributing SSH Keys for Remote Execution</h3>
<div class="paragraph">
<p>For Smart&#160;Proxies in <code>ssh</code> mode, remote execution connections are authenticated using SSH.
The public SSH key from Smart&#160;Proxy must be distributed to its attached hosts that you want to manage.</p>
</div>
<div class="paragraph">
<p>Ensure that the SSH service is enabled and running on the hosts.
Configure any network or host-based firewalls to enable access to port 22.</p>
</div>
<div class="paragraph">
<p>Use one of the following methods to distribute the public SSH key from Smart&#160;Proxy to target hosts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#distributing-ssh-keys-for-remote-execution-manually_ansible">Distributing SSH Keys for Remote Execution Manually</a>.</p>
</li>
<li>
<p><a href="#Using_the_foreman_API_to_Obtain_SSH_Keys_for_Remote_Execution_ansible">Using the Foreman API to Obtain SSH Keys for Remote Execution</a>.</p>
</li>
<li>
<p><a href="#Configuring_a_Kickstart_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible">Configuring a Kickstart Template to Distribute SSH Keys During Provisioning</a>.</p>
</li>
<li>
<p>For new Foreman hosts, you can deploy SSH keys to Foreman hosts during registration using the global registration template.
For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#Registering_Hosts_managing-hosts">Registering a Host to Foreman Using the Global Registration Template</a> in <em>Managing Hosts</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Foreman distributes SSH keys for the remote execution feature to the hosts provisioned from Foreman by default.</p>
</div>
<div class="paragraph">
<p>If the hosts are running on Amazon Web Services, enable password authentication.
For more information, see <a href="https://aws.amazon.com/premiumsupport/knowledge-center/new-user-accounts-linux-instance">New User Accounts</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="distributing-ssh-keys-for-remote-execution-manually_ansible"><a class="anchor" href="#distributing-ssh-keys-for-remote-execution-manually_ansible"></a>3.12. Distributing SSH Keys for Remote Execution Manually</h3>
<div class="paragraph">
<p>To distribute SSH keys manually, complete the following steps:</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Copy the SSH pub key from your  Smart&#160;Proxy to your target host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh-copy-id -i ~foreman-proxy/.ssh/id_rsa_foreman_proxy.pub <em>root@client.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>Repeat this step for each target host you want to manage.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To confirm that the key was successfully copied to the target host, enter the following command on Smart&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh -i ~foreman-proxy/.ssh/id_rsa_foreman_proxy <em>root@client.example.com</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Using_the_foreman_API_to_Obtain_SSH_Keys_for_Remote_Execution_ansible"><a class="anchor" href="#Using_the_foreman_API_to_Obtain_SSH_Keys_for_Remote_Execution_ansible"></a>3.13. Using the Foreman API to Obtain SSH Keys for Remote Execution</h3>
<div class="paragraph">
<p>To use the Foreman API to download the public key from Smart&#160;Proxy, complete this procedure on each target host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the target host, create the <code>~/.ssh</code> directory to store the SSH key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir ~/.ssh</pre>
</div>
</div>
</li>
<li>
<p>Download the SSH key from Smart&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl https://<em>smartproxy.example.com</em>:8443/ssh/pubkey &gt;&gt; ~/.ssh/authorized_keys</pre>
</div>
</div>
</li>
<li>
<p>Configure permissions for the <code>~/.ssh</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 700 ~/.ssh</pre>
</div>
</div>
</li>
<li>
<p>Configure permissions for the <code>authorized_keys</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 600 ~/.ssh/authorized_keys</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_a_AutoYaST_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"><a class="anchor" href="#Configuring_a_AutoYaST_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"></a>3.14. Configuring a AutoYaST Template to Distribute SSH Keys During Provisioning</h3>
<div class="paragraph">
<p>You can add a <code>remote_execution_ssh_keys</code> snippet to your custom AutoYaST template to deploy SSH Keys to hosts during provisioning.
AutoYaST templates that Foreman ships include this snippet by default.
Foreman copies the SSH key for remote execution to the systems during provisioning.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To include the public key in newly-provisioned hosts, add the following snippet to the AutoYaST template that you use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%= snippet 'remote_execution_ssh_keys' %&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_a_Kickstart_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"><a class="anchor" href="#Configuring_a_Kickstart_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"></a>3.15. Configuring a Kickstart Template to Distribute SSH Keys During Provisioning</h3>
<div class="paragraph">
<p>You can add a <code>remote_execution_ssh_keys</code> snippet to your custom Kickstart template to deploy SSH Keys to hosts during provisioning.
Kickstart templates that Foreman ships include this snippet by default.
Foreman copies the SSH key for remote execution to the systems during provisioning.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To include the public key in newly-provisioned hosts, add the following snippet to the Kickstart template that you use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%= snippet 'remote_execution_ssh_keys' %&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_a_Preseed_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"><a class="anchor" href="#Configuring_a_Preseed_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"></a>3.16. Configuring a Preseed Template to Distribute SSH Keys During Provisioning</h3>
<div class="paragraph">
<p>You can add a <code>remote_execution_ssh_keys</code> snippet to your custom Preseed template to deploy SSH Keys to hosts during provisioning.
Preseed templates that Foreman ships include this snippet by default.
Foreman copies the SSH key for remote execution to the systems during provisioning.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To include the public key in newly-provisioned hosts, add the following snippet to the Preseed template that you use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%= snippet 'remote_execution_ssh_keys' %&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-keytab-for-kerberos-ticket-granting-tickets_ansible"><a class="anchor" href="#configuring-a-keytab-for-kerberos-ticket-granting-tickets_ansible"></a>3.17. Configuring a keytab for Kerberos Ticket Granting Tickets</h3>
<div class="paragraph">
<p>Use this procedure to configure Foreman to use a keytab to obtain Kerberos ticket granting tickets.
If you do not set up a keytab, you must manually retrieve tickets.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the ID of the <code>foreman-proxy</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id -u foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Modify the <code>umask</code> value so that new files have the permissions <code>600</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># umask 077</pre>
</div>
</div>
</li>
<li>
<p>Create the directory for the keytab:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p "/var/kerberos/krb5/user/<em>My_User_ID</em>"</pre>
</div>
</div>
</li>
<li>
<p>Create a keytab or copy an existing keytab to the directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp <em>My_Client.keytab</em> /var/kerberos/krb5/user/<em>My_User_ID</em>/client.keytab</pre>
</div>
</div>
</li>
<li>
<p>Change the directory owner to the <code>foreman-proxy</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R foreman-proxy:foreman-proxy "/var/kerberos/krb5/user/<em>My_User_ID</em>"</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the keytab file is read-only:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod -wx "/var/kerberos/krb5/user/<em>My_User_ID</em>/client.keytab"</pre>
</div>
</div>
</li>
<li>
<p>Restore the SELinux context:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -RvF /var/kerberos/krb5</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-kerberos-authentication-for-remote-execution_ansible"><a class="anchor" href="#configuring-kerberos-authentication-for-remote-execution_ansible"></a>3.18. Configuring Kerberos Authentication for Remote Execution</h3>
<div class="paragraph">
<p>You can use Kerberos authentication to establish an SSH connection for remote execution on Foreman hosts.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Enroll Foreman&#160;server on the Kerberos server</p>
</li>
<li>
<p>Enroll the Foreman target host on the Kerberos server</p>
</li>
<li>
<p>Configure and initialize a Kerberos user account for remote execution</p>
</li>
<li>
<p>Ensure that the foreman-proxy user on Foreman has a valid Kerberos ticket granting ticket</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To install and enable Kerberos authentication for remote execution, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-plugin-remote-execution-script-ssh-kerberos-auth true</pre>
</div>
</div>
</li>
<li>
<p>To edit the default user for remote execution, in the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and click the <strong>Remote Execution</strong> tab.
In the <strong>SSH User</strong> row, edit the second column and add the user name for the Kerberos account.</p>
</li>
<li>
<p>Navigate to <strong>remote_execution_effective_user</strong> and edit the second column to add the user name for the Kerberos account.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To confirm that Kerberos authentication is ready to use, run a remote job on the host.
For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Configurations_Ansible/index-foreman-deb.html#executing-a-remote-job_ansible">Executing a Remote Job</a> in <em>Configuring Hosts Using Ansible</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-job-templates_ansible"><a class="anchor" href="#setting-up-job-templates_ansible"></a>3.19. Setting up Job Templates</h3>
<div class="paragraph">
<p>Foreman provides default job templates that you can use for executing jobs.
To view the list of job templates, navigate to <strong>Hosts</strong> &gt; <strong>Job templates</strong>.
If you want to use a template without making changes, proceed to <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#executing-a-remote-job_managing-hosts">Executing a Remote Job</a> in <em>Managing Hosts</em>.</p>
</div>
<div class="paragraph">
<p>You can use default templates as a base for developing your own.
Default job templates are locked for editing.
Clone the template and edit the clone.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To clone a template, in the <strong>Actions</strong> column, select <strong>Clone</strong>.</p>
</li>
<li>
<p>Enter a unique name for the clone and click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Job templates use the Embedded Ruby (ERB) syntax.
For more information about writing templates, see the <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#Template_Writing_Reference_managing-hosts">Template Writing Reference</a> in <em>Managing Hosts</em>.</p>
</div>
<div class="paragraph">
<div class="title">Ansible Considerations</div>
<p>To create an Ansible job template, use the following procedure and instead of ERB syntax, use YAML syntax.
Begin the template with <code>---</code>.
You can embed an Ansible playbook YAML file into the job template body.
You can also add ERB syntax to customize your YAML Ansible template.
You can also import Ansible playbooks in Foreman.
For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#Synchronizing_Templates_Repositories_managing-hosts">Synchronizing Repository Templates</a> in <em>Managing Hosts</em>.</p>
</div>
<div class="paragraph">
<div class="title">Parameter Variables</div>
<p>At run time, job templates can accept parameter variables that you define for a host.
Note that only the parameters visible on the <strong>Parameters</strong> tab at the host&#8217;s edit page can be used as input parameters for job templates.
If you do not want your Ansible job template to accept parameter variables at run time, in the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and click the <strong>Ansible</strong> tab.
In the <strong>Top level Ansible variables</strong> row, change the <strong>Value</strong> parameter to <strong>No</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="executing-a-remote-job_ansible"><a class="anchor" href="#executing-a-remote-job_ansible"></a>3.20. Executing a Remote Job</h3>
<div class="paragraph">
<p>You can execute a job that is based on a job template against one or more hosts.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-executing-a-remote-job_ansible">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and select the target hosts on which you want to execute a remote job.
You can use the search field to filter the host list.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Schedule a Job</strong>.</p>
</li>
<li>
<p>On the <strong>Job invocation</strong> page, define the main job settings:</p>
</li>
<li>
<p>Select the <strong>Job category</strong> and the <strong>Job template</strong> you want to use.</p>
</li>
<li>
<p>Optional: Select a stored search string in the <strong>Bookmark</strong> list to specify the target hosts.</p>
</li>
<li>
<p>Optional: Further limit the targeted hosts by entering a <strong>Search query</strong>.
The <strong>Resolves to</strong> line displays the number of hosts affected by your query.
Use the refresh button to recalculate the number after changing the query.
The preview icon lists the targeted hosts.</p>
</li>
<li>
<p>The remaining settings depend on the selected job template.
See <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#creating-a-job-template_managing-hosts">Creating a Job Template</a> for information on adding custom parameters to a template.</p>
</li>
<li>
<p>Optional: To configure advanced settings for the job, click <strong>Display advanced fields</strong>.
Some of the advanced settings depend on the job template, the following settings are general:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Effective user</strong> defines the user for executing the job, by default it is the SSH user.</p>
</li>
<li>
<p><strong>Concurrency level</strong> defines the maximum number of jobs executed at once, which can prevent overload of systems' resources in a case of executing the job on a large number of hosts.</p>
</li>
<li>
<p><strong>Timeout to kill</strong> defines time interval in seconds after which the job should be killed, if it is not finished already.
A task which could not be started during the defined interval, for example, if the previous task took too long to finish, is canceled.</p>
</li>
<li>
<p><strong>Type of query</strong> defines when the search query is evaluated.
This helps to keep the query up to date for scheduled tasks.</p>
</li>
<li>
<p><strong>Execution ordering</strong> determines the order in which the job is executed on hosts: alphabetical or randomized.</p>
<div class="paragraph">
<p><strong>Concurrency level</strong> and <strong>Timeout to kill</strong> settings enable you to tailor job execution to fit your infrastructure hardware and needs.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>To run the job immediately, ensure that <strong>Schedule</strong> is set to <strong>Execute now</strong>.
You can also define a one-time future job, or set up a recurring job.
For recurring tasks, you can define start and end dates, number and frequency of runs.
You can also use cron syntax to define repetition.
For more information about cron, see <a href="https://www.redhat.com/sysadmin/automate-linux-tasks-cron">Automate your Linux system tasks with cron</a>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.
You can view status of the jobs in the <strong>Recent Jobs</strong> section on the same page.</p>
</li>
</ol>
</div>
<div id="cli-executing-a-remote-job_ansible" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command on Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set \
--name=remote_execution_global_proxy \
--value=false</pre>
</div>
</div>
</li>
<li>
<p>Find the ID of the job template you want to use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer job-template list</pre>
</div>
</div>
</li>
<li>
<p>Show the template details to see parameters required by your template:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer job-template info --id <em>My_Template_ID</em></pre>
</div>
</div>
</li>
<li>
<p>Execute a remote job with custom parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#hammer job-invocation create \
--inputs <em>My_Key_1</em>="<em>My_Value_1</em>",<em>My_Key_2</em>="<em>My_Value_2</em>",... \
--job-template "<em>My_Template_Name</em>" \
--search-query "<em>My_Search_Query</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code><em>My_Search_Query</em></code> with the filter expression that defines hosts, for example <code>"name ~ <em>My_Pattern</em>"</code>.
For more information about executing remote commands with hammer, enter <code>hammer job-template --help</code> and <code>hammer job-invocation --help</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="scheduling-a-recurring-ansible-job-for-a-host_ansible"><a class="anchor" href="#scheduling-a-recurring-ansible-job-for-a-host_ansible"></a>3.21. Scheduling a Recurring Ansible Job for a Host</h3>
<div class="paragraph">
<p>You can schedule a recurring job to run Ansible roles on hosts.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ensure you have the <code>view_foreman_tasks</code>, <code>view_job_invocations</code>, and <code>view_recurring_logics</code> permissions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts &gt; All Hosts</strong> and select the target host on which you want to execute a remote job.</p>
</li>
<li>
<p>On the <strong>Ansible</strong> tab, select <strong>Jobs</strong>.</p>
</li>
<li>
<p>Click <strong>Schedule recurring job</strong>.</p>
</li>
<li>
<p>Define the repetition frequency, start time, and date of the first run in the <strong>Create New Recurring Ansible Run</strong> window.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Optional: View the scheduled Ansible job in host overview or by navigating to <strong>Ansible</strong> &gt; <strong>Jobs</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Scheduling_a_Recurring_Ansible_Job_for_a_Host_Group_ansible"><a class="anchor" href="#Scheduling_a_Recurring_Ansible_Job_for_a_Host_Group_ansible"></a>3.22. Scheduling a Recurring Ansible Job for a Host Group</h3>
<div class="paragraph">
<p>You can schedule a recurring job to run Ansible roles on host groups.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host groups</strong>.</p>
</li>
<li>
<p>In the <strong>Actions</strong> column, select <strong>Configure Ansible Job</strong> for the host group you want to schedule an Ansible roles run for.</p>
</li>
<li>
<p>Click <strong>Schedule recurring job</strong>.</p>
</li>
<li>
<p>Define the repetition frequency, start time, and date of the first run in the <strong>Create New Recurring Ansible Run</strong> window.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Monitoring_Jobs_ansible"><a class="anchor" href="#Monitoring_Jobs_ansible"></a>3.23. Monitoring Jobs</h3>
<div class="paragraph">
<p>You can monitor the progress of a job while it is running.
This can help in any troubleshooting that may be required.</p>
</div>
<div class="paragraph">
<p>Ansible jobs run on batches of 100 hosts, so you cannot cancel a job running on a specific host.
A job completes only after the Ansible playbook runs on all hosts in the batch.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Monitor &gt; Jobs</strong>.
This page is automatically displayed if you triggered the job with the <code>Execute now</code> setting.
To monitor scheduled jobs, navigate to <strong>Monitor</strong> &gt; <strong>Jobs</strong> and select the job run you wish to inspect.</p>
</li>
<li>
<p>On the Job page, click the <strong>Hosts</strong> tab.
This displays the list of hosts on which the job is running.</p>
</li>
<li>
<p>In the <strong>Host</strong> column, click the name of the host that you want to inspect.
This displays the <strong>Detail of Commands</strong> page where you can monitor the job execution in real time.</p>
</li>
<li>
<p>Click <strong>Back to Job</strong> at any time to return to the <strong>Job Details</strong> page.</p>
</li>
</ol>
</div>
<div id="cli-Monitoring_Jobs_ansible" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Find the ID of a job:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#hammer job-invocation list</pre>
</div>
</div>
</li>
<li>
<p>Monitor the job output:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#hammer job-invocation output \
--host "<em>My_Host_Name</em>" \
--id <em>My_Job_ID</em></pre>
</div>
</div>
</li>
<li>
<p>Optional: To cancel a job, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#hammer job-invocation cancel \
--id <em>My_Job_ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Integrating_foreman_and_AWX_ansible"><a class="anchor" href="#Integrating_foreman_and_AWX_ansible"></a>4. Integrating Foreman and AWX</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can integrate Foreman and AWX to use Foreman&#160;server as a dynamic inventory source for AWX.</p>
</div>
<div class="paragraph">
<p>You can also use the provisioning callback function to run playbooks on hosts managed by Foreman, from either the host or AWX.
When provisioning new hosts from Foreman&#160;server, you can use the provisioning callback function to trigger playbook runs from AWX.
The playbook configures the host after the provisioning process.</p>
</div>
<div class="sect2">
<h3 id="Adding_foreman_Server_to_AWX_as_a_Dynamic_Inventory_Item_ansible"><a class="anchor" href="#Adding_foreman_Server_to_AWX_as_a_Dynamic_Inventory_Item_ansible"></a>4.1. Adding Foreman&#160;server to AWX as a Dynamic Inventory Item</h3>
<div class="paragraph">
<p>To add Foreman&#160;server to AWX as a dynamic inventory item, you must create a credential for a Foreman&#160;server user on AWX, add an AWX user to the credential, and then configure an inventory source.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>If your Foreman deployment is large, for example, managing tens of thousands of hosts, using a non-admin user can negatively impact performance because of time penalties that accrue during authorization checks.
For large deployments, consider using an admin user.</p>
</li>
<li>
<p>For non-admin users, you must assign the <code>AWX Inventory Reader</code> role to your Foreman&#160;server user.
For more information about managing users, roles, and permission filters, see <a href="https://docs.theforeman.org/3.4/Administering_Project/index-foreman-deb.html#Creating_and_Managing_Roles_admin">Creating and Managing Roles</a> in <em>Administering Foreman</em>.</p>
</li>
<li>
<p>You must host your Foreman&#160;server and AWX on the same network or subnet.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWX web UI, create a credential for your Foreman.
For more information about creating credentials, see <a href="http://docs.ansible.com/ansible-tower/latest/html/userguide/credentials.html#add-a-new-credential">Add a New Credential</a> and <a href="http://docs.ansible.com/ansible-tower/latest/html/userguide/credentials.html#red-hat-satellite-6">Foreman Credentials</a> in the <em>AWX User Guide</em>.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Foreman Credentials</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Credential Type</strong>:</th>
<th class="tableblock halign-left valign-top"><strong>Foreman</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Foreman URL</strong>:</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>https://<em>foreman.example.com</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Username</strong>:</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The username of the Foreman user with the integration role.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Password</strong>:</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The password of the Foreman user.</p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Add an AWX user to the new credential.
For more information about adding a user to a credential, see <a href="http://docs.ansible.com/ansible-tower/latest/html/userguide/credentials.html#getting-started-with-credentials">Getting Started with Credentials</a> in the <em>AWX User Guide</em>.</p>
</li>
<li>
<p>Add a new inventory.
For more information, see <a href="http://docs.ansible.com/ansible-tower/latest/html/userguide/inventories.html#add-a-new-inventory">Add a new inventory</a> in the <em>AWX User Guide</em>.</p>
</li>
<li>
<p>In the new inventory, add Foreman&#160;server as the inventory source, specifying the following inventory source options.
For more information, see <a href="https://docs.ansible.com/ansible-tower/latest/html/userguide/inventories.html#add-source">Add Source</a> in the <em>AWX User Guide</em>.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Inventory Source Options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Source</strong></th>
<th class="tableblock halign-left valign-top"><strong>Foreman</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Credential</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The credential you create for Foreman&#160;server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Overwrite</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Overwrite Variables</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Update on Launch</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Cache Timeout</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>90</em></p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Ensure that you synchronize the source that you add.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Callback_for_a_Host_ansible"><a class="anchor" href="#Configuring_Provisioning_Callback_for_a_Host_ansible"></a>4.2. Configuring Provisioning Callback for a Host</h3>
<div class="paragraph">
<p>When you create hosts in Foreman, you can use AWX to run playbooks to configure your newly created hosts.
This is called <em>provisioning callback</em> in AWX.</p>
</div>
<div class="paragraph">
<p>The provisioning callback function triggers a playbook run from AWX as part of the provisioning process.
The playbook configures the host after the provisioning process.</p>
</div>
<div class="paragraph">
<p>For more information about provisioning callbacks, see <a href="http://docs.ansible.com/ansible-tower/latest/html/userguide/job_templates.html#provisioning-callbacks">Provisioning Callbacks</a> in the <em>AWX User Guide</em>.</p>
</div>
<div class="paragraph">
<p>In Foreman&#160;server, the <code>Kickstart Default</code> and <code>Kickstart Default Finish</code> templates include three snippets:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>ansible_provisioning_callback</code></p>
</li>
<li>
<p><code>ansible_tower_callback_script</code></p>
</li>
<li>
<p><code>ansible_tower_callback_service</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can add parameters to hosts or host groups to provide the credentials that these snippets can use to run Ansible playbooks on your newly created hosts.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before you can configure provisioning callbacks, you must add Foreman as a dynamic inventory in AWX.
For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Configurations_Ansible/index-foreman-deb.html#Integrating_foreman_and_AWX_ansible">Integrating Foreman and AWX</a>.</p>
</div>
<div class="paragraph">
<p>In the AWX web UI, you must complete the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a machine credential for your new host.
Ensure that you enter the same password in the credential that you plan to assign to the host that you create in Foreman.
For more information, see <a href="https://docs.ansible.com/ansible-tower/latest/html/userguide/credentials.html#add-a-new-credential">Add a New Credential</a> in the <em>AWX User Guide</em>.</p>
</li>
<li>
<p>Create a project.
For more information, see <a href="https://docs.ansible.com/ansible-tower/latest/html/userguide/projects.html">Projects</a> in the <em>AWX User Guide</em>.</p>
</li>
<li>
<p>Add a job template to your project.
For more information, see <a href="https://docs.ansible.com/ansible-tower/latest/html/userguide/job_templates.html#create-a-job-template">Job Templates</a> in the <em>AWX User Guide</em>.</p>
</li>
<li>
<p>In your job template, you must enable provisioning callbacks, generate the host configuration key, and note the <em>template_ID</em> of your job template.
For more information about job templates, see <a href="http://docs.ansible.com/ansible-tower/latest/html/userguide/job_templates.html#">Job Templates</a> in the <em>AWX User Guide</em>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Group</strong>.</p>
</li>
<li>
<p>Create a host group or edit an existing host group.</p>
</li>
<li>
<p>In the Host Group window, click the <strong>Parameters</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add Parameter</strong>.</p>
</li>
<li>
<p>Enter the following information for each new parameter:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Host Parameters</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ansible_tower_provisioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables Provisioning Callback.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ansible_tower_fqdn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tower.example.com</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified domain name (FQDN) of your AWX.
Do not add <code>https</code> because this is appended by AWX.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ansible_job_template_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>template_ID</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of your provisioning template that you can find in the URL of the template: <code>/templates/job_template/<em>5</em></code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ansible_host_config_key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>config_KEY</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host configuration key that your job template generates in AWX.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Create a host using the host group.</p>
</li>
<li>
<p>On the new host, enter the following command to start the <code>ansible-callback</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start ansible-callback</pre>
</div>
</div>
</li>
<li>
<p>On the new host, enter the following command to output the status of the <code>ansible-callback</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl status ansible-callback</pre>
</div>
</div>
<div class="paragraph">
<p>Provisioning callback is configured correctly if the command returns the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">SAT_host systemd[1]: Started Provisioning callback to AWX...</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Manual Provisioning Callback</div>
<ul>
<li>
<p>You can use the provisioning callback URL and the host configuration key from a host to call AWX:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -k -s --data curl --insecure --data host_config_key=<em>my_config_key</em> \
https://<em>tower.example.com</em>/api/v2/job_templates/<em>8</em>/callback/</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that you use <code>https</code> when you enter the provisioning callback URL.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This triggers the playbook run specified in the template against the host.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Job_Template_Examples_and_Extensions_ansible"><a class="anchor" href="#Job_Template_Examples_and_Extensions_ansible"></a>5. Job Template Examples and Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this section as a reference to help modify, customize, and extend your job templates to suit your requirements.</p>
</div>
<div class="sect2">
<h3 id="Customizing_Job_Templates_ansible"><a class="anchor" href="#Customizing_Job_Templates_ansible"></a>5.1. Customizing Job Templates</h3>
<div class="paragraph">
<p>When creating a job template, you can include an existing template in the template editor field.
This way you can combine templates, or create more specific templates from the general ones.</p>
</div>
<div class="paragraph">
<p>The following template combines default templates to install and start the <strong>nginx</strong> service on clients:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Ruby" data-lang="Ruby">&lt;%= render_template 'Package Action - SSH Default', :action =&gt; 'install', :package =&gt; 'nginx' %&gt;
&lt;%= render_template 'Service Action - SSH Default', :action =&gt; 'start', :service_name =&gt; 'nginx' %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above template specifies parameter values for the rendered template directly.
It is also possible to use the <strong>input()</strong> method to allow users to define input for the rendered template on job execution.
For example, you can use the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Ruby" data-lang="Ruby">&lt;%= render_template 'Package Action - SSH Default', :action =&gt; 'install', :package =&gt; input("package") %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above template, you have to import the parameter definition from the rendered template.
To do so, navigate to the <strong>Jobs</strong> tab, click <strong>Add Foreign Input Set</strong>, and select the rendered template from the <strong>Target template</strong> list.
You can import all parameters or specify a comma separated list.</p>
</div>
</div>
<div class="sect2">
<h3 id="default-job-template-categories_ansible"><a class="anchor" href="#default-job-template-categories_ansible"></a>5.2. Default Job Template Categories</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Job template category</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for performing package related actions.
Install, update, and remove actions are included by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puppet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for executing Puppet runs on target hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for performing power related actions.
Restart and shutdown actions are included by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Commands</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for executing custom commands on remote hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Templates for performing service related actions.
Start, stop, restart, and status actions are included by default.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Example_restorecon_Template_ansible"><a class="anchor" href="#Example_restorecon_Template_ansible"></a>5.3. Example restorecon Template</h3>
<div class="paragraph">
<p>This example shows how to create a template called <strong>Run Command - restorecon</strong> that restores the default <strong>SELinux</strong> context for all files in the selected directory on target hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Job templates</strong>.
Click <strong>New Job Template</strong>.</p>
</li>
<li>
<p>Enter <strong>Run Command - restorecon</strong> in the <strong>Name</strong> field.
Select <strong>Default</strong> to make the template available to all organizations.
Add the following text to the template editor:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Ruby" data-lang="Ruby">restorecon -RvF &lt;%= input("directory") %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;%= input("directory") %&gt;</code> string is replaced by a user-defined directory during job invocation.</p>
</div>
</li>
<li>
<p>On the <strong>Job</strong> tab, set <strong>Job category</strong> to <code>Commands</code>.</p>
</li>
<li>
<p>Click <strong>Add Input</strong> to allow job customization.
Enter <code>directory</code> to the <strong>Name</strong> field.
The input name must match the value specified in the template editor.</p>
</li>
<li>
<p>Click <strong>Required</strong> so that the command cannot be executed without the user specified parameter.</p>
</li>
<li>
<p>Select <strong>User input</strong> from the <strong>Input type</strong> list.
Enter a description to be shown during job invocation, for example <code>Target directory for restorecon</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.
For more information, see <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#Executing_a_restorecon_Template_on_Multiple_Hosts_managing-hosts">Executing a restorecon Template on Multiple Hosts</a> in <em>Managing Hosts</em>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Rendering_a_restorecon_Template_ansible"><a class="anchor" href="#Rendering_a_restorecon_Template_ansible"></a>5.4. Rendering a restorecon Template</h3>
<div class="paragraph">
<p>This example shows how to create a template derived from the <strong>Run command - restorecon</strong> template created in <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#Example_restorecon_Template_managing-hosts">Example restorecon Template</a>.
This template does not require user input on job execution, it will restore the SELinux context in all files under the <code>/home/</code> directory on target hosts.</p>
</div>
<div class="paragraph">
<p>Create a new template as described in <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#setting-up-job-templates_managing-hosts">Setting up Job Templates</a>, and specify the following string in the template editor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Ruby" data-lang="Ruby">&lt;%=render_template("Run Command - restorecon", :directory =&gt; "/home") %&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Executing_a_restorecon_Template_on_Multiple_Hosts_ansible"><a class="anchor" href="#Executing_a_restorecon_Template_on_Multiple_Hosts_ansible"></a>5.5. Executing a restorecon Template on Multiple Hosts</h3>
<div class="paragraph">
<p>This example shows how to run a job based on the template created in <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#Example_restorecon_Template_managing-hosts">Example restorecon Template</a> on multiple hosts.
The job restores the SELinux context in all files under the <code>/home/</code> directory.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong> and select target hosts.
Select <strong>Schedule Remote Job</strong> from the <strong>Select Action</strong> list.</p>
</li>
<li>
<p>In the <strong>Job invocation</strong> page, select the <code>Commands</code> job category and the <code>Run Command - restorecon</code> job template.</p>
</li>
<li>
<p>Type <code>/home</code> in the <strong>directory</strong> field.</p>
</li>
<li>
<p>Set <strong>Schedule</strong> to <code>Execute now</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.
You are taken to the <strong>Job invocation</strong> page where you can monitor the status of job execution.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Including_Power_Actions_in_Templates_ansible"><a class="anchor" href="#Including_Power_Actions_in_Templates_ansible"></a>5.6. Including Power Actions in Templates</h3>
<div class="paragraph">
<p>This example shows how to set up a job template for performing power actions, such as reboot.
This procedure prevents Foreman from interpreting the disconnect exception upon reboot as an error, and consequently, remote execution of the job works correctly.</p>
</div>
<div class="paragraph">
<p>Create a new template as described in <a href="https://docs.theforeman.org/3.4/Managing_Hosts/index-foreman-deb.html#setting-up-job-templates_managing-hosts">Setting up Job Templates</a>, and specify the following string in the template editor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Ruby" data-lang="Ruby">&lt;%= render_template("Power Action - SSH Default", :action =&gt; "restart") %&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.4 (unsupported)<br>
Last updated Apr 2023
</div>
</div>
</body>
</html>