<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<title>Configuring hosts by using Ansible</title>
<style>
﻿*,::before,::after{box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:100%}body{background:#fff;color:rgba(0,0,0,0.8);padding:0;margin:0;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:inherit;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,p,blockquote,th,td{margin:0;padding:0}a{background:none;color:#2156a5;text-decoration:underline;line-height:inherit}a:active,a:hover{cursor:pointer;outline:0}a:focus{outline:thin dotted}a:hover,a:focus{color:#1d4b8f}abbr{font-size:0.9em}abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}b,strong{font-weight:bold;line-height:inherit}strong strong{font-weight:400}code,kbd,pre{font-family:"Droid Sans Mono", "DejaVu Sans Mono", monospace;font-size:1em}code{font-weight:400;color:rgba(0,0,0,0.9)}pre{color:rgba(0,0,0,0.9);line-height:1.45;text-rendering:optimizeSpeed;white-space:pre-wrap}dfn{font-style:italic}em,i{font-style:italic;line-height:inherit}em em{font-style:normal}hr{border:solid #dddddf;border-width:1px 0 0;clear:both;height:0;margin:1.25em 0 1.1875em}mark{background:#ff0;color:#000}p{line-height:1.6;margin-bottom:1.25rem;text-rendering:optimizeLegibility}q{quotes:"“" "”" "‘" "’"}small{font-size:60%;line-height:inherit}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img,object[type^="image/"],svg{display:inline-block;height:auto;max-width:100%;vertical-align:middle}img{border:0;-ms-interpolation-mode:bicubic}object{max-width:100%}svg:not(:root){overflow:hidden}figure{margin:0}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}.left{float:left !important}.right{float:right !important}.text-left{text-align:left !important}.text-right{text-align:right !important}.text-center{text-align:center !important}.text-justify{text-align:justify !important}.hide{display:none}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:0.25em}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.2;word-spacing:-0.05em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em;margin-left:1.125em}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,0.85)}@media screen and (min-width: 768px){h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;border:1px solid #dedede;border-collapse:collapse;border-spacing:0;margin-bottom:1.25em;word-wrap:normal}table thead,table tfoot{background:#f7f8f7}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,0.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,0.8)}table tr.even,table tr.alt{background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.center{margin-left:auto;margin-right:auto}.stretch{width:100%}.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:"";display:table}.clearfix::after,.float-group::after{clear:both}:not(pre).nobreak{word-wrap:normal}:not(pre).nowrap{white-space:nowrap}:not(pre).pre-wrap{white-space:pre-wrap}:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal !important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}pre>code{display:block}pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}.keyseq{color:rgba(51,51,51,0.8)}kbd{display:inline-block;color:rgba(0,0,0,0.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,0.2),inset 0 0 0 0.1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menuref{color:#000}.menuseq b:not(.caret),.menuref{font-weight:inherit}.menuseq{word-spacing:-0.02em}.menuseq b.caret{font-size:1.25em;line-height:0.8}.menuseq i.caret{font-weight:bold;text-align:center;width:0.45em}b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}b.button::before{content:"[";padding:0 3px 0 2px}b.button::after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,0.9)}body>div[id]{margin:0 auto;max-width:62.5em;position:relative;padding-left:.9375em;padding-right:0.9375em}body>div[id]::before,body>div[id]::after,#content #footnotes::before{content:"";display:table;clear:both}#content{margin-top:1.25em;margin-bottom:0.625em}#content::before{content:none}#header>h1:first-child{color:rgba(0,0,0,0.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,0.6);display:flex;flex-flow:row wrap}#header .details span:first-child{margin-left:-0.125em}#header .details span.email a{color:rgba(0,0,0,0.85)}#header .details br{display:none}#header .details br+span::before{content:" – "}#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,0.85)}#header .details br+span#revremark::before{content:" | "}#header #revnumber{text-transform:capitalize}#header #revnumber::after{content:" "}#content>h1:first-child:not([class]){color:rgba(0,0,0,0.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #e7e7e9;padding-bottom:0.5em}#toc>ul{margin-left:0.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:0.5em 0}#toc ul{font-family:"Open Sans", "DejaVu Sans", sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:0.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media screen and (min-width: 768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0 !important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0 !important;border-bottom-width:0 !important;z-index:1000;padding:1.25em 1em;height:calc(100% - (70px + 2.5em));overflow:auto}#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:0.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}@media screen and (min-width: 1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:0.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:none;background:#025d8c;padding:1.25em;margin-left:2em}#footer-text{color:rgba(255,255,255,0.8);line-height:1.44}h1:before,h2:before,h3:before,h4:before,h5:before,h6:before,div.title:before{display:block;content:" ";height:90px;margin-top:-90px;visibility:hidden}.sect1{padding-bottom:0.625em}@media screen and (min-width: 768px){#content{margin-bottom:1.25em}.sect1{padding-bottom:1.25em}}.sect1:last-child{padding-bottom:0}.sect1+.sect1{border-top:1px solid #e7e7e9}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none !important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:0.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}details{margin-left:1.25rem}details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}details>summary::-webkit-details-marker{display:none}details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:1rem;font-style:italic}table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,0.85)}.admonitionblock>table{border-collapse:separate;border:1;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans", "DejaVu Sans", sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,0.6);word-wrap:anywhere}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#fffef7;border-radius:4px;box-shadow:0 1px 4px #e0e0dc}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:0.8125em}@media screen and (min-width: 768px){.literalblock pre,.listingblock>.content>pre{font-size:0.90625em}}@media screen and (min-width: 1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,0.9)}.listingblock>.content{position:relative}.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:0.5}.listingblock:hover code[data-lang]::before{display:block}.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:0.5}.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.prettyprint{background:#f7f7f8}pre.prettyprint .linenums{line-height:1.45;margin-left:2em}pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}pre.prettyprint li code[data-lang]::before{opacity:1}pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}table.linenotable td.code{padding-left:0.75em}table.linenotable td.linenos{width:0.01%}table.linenotable td.linenos,pre.pygments .linenos,pre.rouge .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}pre.pygments span.linenos,pre.rouge span.linenos{display:inline-block;margin-right:0.75em}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:0.75em}.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,0.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,0.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}.verseblock{margin:0 1em 1.25em}.verseblock pre{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-size:1.15rem;color:rgba(0,0,0,0.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:0.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,0.6)}.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}.quoteblock.abstract{margin:0 1em 1.25em;display:block}.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:0.25em solid #dddddf}.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}p.tableblock:last-child{margin-bottom:0}td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}td.tableblock>.content>:last-child{margin-bottom:-1.25em}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all>*>tr>*{border-width:1px}table.grid-cols>*>tr>*{border-width:0 1px}table.grid-rows>*>tr>*{border-width:1px 0}table.frame-all{border-width:1px}table.frame-ends{border-width:1px 0}table.frame-sides{border-width:0 1px}table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,0.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:0.625em}ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:0.625em}ul.unstyled,ol.unstyled{margin-left:0}li>p:empty:only-child::before{content:"";display:inline-block}ul.checklist>li>p:first-child{margin-left:-1em}ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:0.125em}ul.checklist>li>p:first-child>input[type=checkbox]:first-child{font:inherit;margin:0 .25em 0 0;padding:0}ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 0.625em -1.25em}ul.inline>li{margin-left:1.25em}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{vertical-align:top;padding:0 0.625em}td.hdlist1{font-weight:bold;padding-bottom:1.25em}td.hdlist2{word-wrap:anywhere}.literalblock+.colist,.listingblock+.colist{margin-top:-0.5em}.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}.colist td:not([class]):first-child img{max-width:none}.colist td:not([class]):last-child{padding:0.25em 0}.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}.imageblock.left{margin:0.25em 0.625em 1.25em 0}.imageblock.right{margin:0.25em 0 1.25em 0.625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 0.125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:0.625em}.image.right{margin-left:0.625em}a.image{text-decoration:none;display:inline-block}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:0.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:0.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:0.75em 0}div.page-break{display:none}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background:#00fafa}.black{color:#000}.black-background{background:#000}.blue{color:#0000bf}.blue-background{background:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background:#fa00fa}.gray{color:#606060}.gray-background{background:#7d7d7d}.green{color:#006000}.green-background{background:#007d00}.lime{color:#00bf00}.lime-background{background:#00fa00}.maroon{color:#600000}.maroon-background{background:#7d0000}.navy{color:#000060}.navy-background{background:#00007d}.olive{color:#606000}.olive-background{background:#7d7d00}.purple{color:#600060}.purple-background{background:#7d007d}.red{color:#bf0000}.red-background{background:#fa0000}.silver{color:#909090}.silver-background{background:#bcbcbc}.teal{color:#006060}.teal-background{background:#007d7d}.white{color:#bfbfbf}.white-background{background:#fafafa}.yellow{color:#bfbf00}.yellow-background{background:#fafa00}span.icon>.fa{cursor:default}a span.icon>.fa{cursor:inherit}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,0.5);cursor:default}.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,0.8);color:#111}.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff !important;background:rgba(0,0,0,0.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans", "DejaVu Sans", sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff !important}.conum[data-value]+b{display:none}.conum[data-value]::after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-0.125em}b.conum *{color:inherit !important}.conum:not([data-value]):empty{display:none}dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}h1,h2,p,td.content,span.alt,summary{letter-spacing:-0.01em}p strong,td.content strong,div.footnote strong{letter-spacing:-0.005em}p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.print-only{display:none !important}@page{margin:1.25cm 0.75cm}@media print{*{box-shadow:none !important;text-shadow:none !important}html{font-size:80%}a{color:inherit !important;text-decoration:underline !important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none !important}a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:0.25em}abbr[title]{border-bottom:1px dotted}abbr[title]::after{content:" (" attr(title) ")"}pre,blockquote,tr,img,object,svg{page-break-inside:avoid}thead{display:table-header-group}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}body>div[id]{max-width:none}#toc,.sidebarblock,.exampleblock>.content{background:none !important}#toc{border-bottom:1px solid #dddddf !important;padding-bottom:0 !important}body.book #header{text-align:center}body.book #header>h1:first-child{border:0 !important;margin:2.5em 0 1em}body.book #header .details{border:0 !important;display:block;padding:0 !important}body.book #header .details span:first-child{margin-left:0 !important}body.book #header .details br{display:block}body.book #header .details br+span::before{content:none !important}body.book #toc{border:0 !important;text-align:left !important;padding:0 !important;margin:0 !important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]::before{display:block}div.page-break{display:block;page-break-after:always}#footer{padding:0 0.9375em}.hide-on-print{display:none !important}.print-only{display:block !important}.hide-for-print{display:none !important}.show-for-print{display:inherit !important}}@media amzn-kf8, print{#header>h1:first-child{margin-top:1.25rem}.sect1{padding:0 !important}.sect1+.sect1{border:0}#footer{background:none}#footer-text{color:rgba(0,0,0,0.6);font-size:0.9em}}@media amzn-kf8{body>div[id]{padding:0}}body{padding:0;margin:0;margin-top:70px !important}.container{position:relative;z-index:1;padding-top:50px;min-height:100%}.container p{font-family:sans-serif;font-size:1.2em}nav{position:fixed;z-index:9999;left:0;right:0;top:0;height:70px;padding:0 1.5em;background-color:#025d8c;font-family:sans-serif;line-height:70px}nav .logo{width:50px}nav .nav-heading{color:#fff;font-family:ostrich-black;font-size:1.8em;padding:0.5em;vertical-align:sub}nav .nav-logo-heading{text-decoration:none}nav .nav-menu{position:absolute;right:0.3em;top:0;padding:0;margin:0;list-style:none}nav .nav-item{display:inline-block}nav .nav-item>a{display:inline-block;padding:0 2.5em;line-height:70px;color:#fff;text-decoration:none}nav .dropdown{position:relative}nav .dropdown a::after{content:"";display:inline-block;margin-left:0.5em;vertical-align:middle;border-top:0.3em solid #fff;border-right:0.3em solid transparent;border-left:0.3em solid transparent}nav .dropdown.show a::after{transform:rotate(180deg)}nav .dropdown-menu{display:none;position:absolute;left:0;right:0;top:100%;padding:0.5em 0;margin-top:-0.5em;border:1px solid rgba(0,0,0,0.3);border-radius:0.5em;background-color:#fff;width:max-content;max-height:80vh;overflow:scroll}nav .dropdown-menu-left{left:auto;right:0}nav .dropdown.show .dropdown-menu{display:block}nav .dropdown-div{display:block;padding:0.4em 0;line-height:4em}nav .dropdown-div a::after{content:none;margin-left:0;border-top:0;border-right:0;border-left:0}nav .dropdown-item{display:block;padding:0 1.5em;font-size:0.875em;color:#000;line-height:1.6em;text-decoration:none}nav .btn-hamburger{display:none;position:absolute;right:1.5em;top:50%;background-color:transparent;border:0;cursor:pointer;outline:none;transform:translateY(-50%)}nav .btn-hamburger span{display:block;width:30px;height:4px;background-color:#fff;margin:6px;border-radius:2px;transition:0.3s ease-in-out}nav .btn-hamburger span:nth-child(4),nav .btn-hamburger span:nth-child(5){position:absolute;top:10px;opacity:0.5}nav .btn-hamburger span:nth-child(4){transform:rotate(45deg) scale(0)}nav .btn-hamburger span:nth-child(5){transform:rotate(-45deg) scale(0)}nav.opened .btn-hamburger span:nth-child(4){opacity:1;transform:rotate(45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(5){opacity:1;transform:rotate(-45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(1),nav.opened .btn-hamburger span:nth-child(2),nav.opened .btn-hamburger span:nth-child(3){opacity:0}@media screen and (max-width: 768px){nav .nav-menu{position:fixed;left:0;right:0;top:70px;bottom:100%;display:flex;flex-direction:column;justify-content:start;background-color:#363d4e;transition:bottom 0.5s ease-in-out;overflow:hidden}nav.opened .nav-menu{bottom:0}nav .nav-item>a{display:block}nav .dropdown-menu{position:relative;top:0;margin:0 1.5em}nav .btn-hamburger{display:block}}@font-face{font-family:ostrich-black;src:url("../ostrich-black.ttf") format("truetype")}/*!
* "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License
* https://github.com/simonwhitaker/github-fork-ribbon-css

The MIT License (MIT)

Copyright (c) 2013 Simon Whitaker

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/.github-fork-ribbon,.release-ribbon,.issue-ribbon{width:12.1em;height:12.1em;position:absolute;overflow:hidden;top:70px;right:0;z-index:9998;pointer-events:none;font-size:13px;text-decoration:none;text-indent:-999999px}.github-fork-ribbon.fixed,.fixed.release-ribbon,.fixed.issue-ribbon{position:fixed}.github-fork-ribbon:hover,.release-ribbon:hover,.issue-ribbon:hover,.github-fork-ribbon:active,.release-ribbon:active,.issue-ribbon:active{background-color:transparent}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before,.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{position:absolute;display:block;width:15.38em;height:1.54em;top:3.23em;right:-3.23em;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before{content:"";padding:.38em 0;background-color:#a00;background-image:-webkit-gradient(linear, left top, left bottom, from(transparent), to(rgba(0,0,0,0.15)));background-image:-webkit-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-moz-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-ms-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-o-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:linear-gradient(to bottom, transparent, rgba(0,0,0,0.15));-webkit-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);-moz-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);pointer-events:auto}.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{content:attr(data-ribbon);color:#fff;font:700 1em "Helvetica Neue", Helvetica, Arial, sans-serif;line-height:1.54em;text-decoration:none;text-shadow:0 -0.08em rgba(0,0,0,0.5);text-align:center;text-indent:0;padding:.15em 0;margin:.15em 0;border-width:.08em 0;border-style:dotted;border-color:#fff;border-color:rgba(255,255,255,0.7)}.github-fork-ribbon.left-top,.left-top.release-ribbon,.left-top.issue-ribbon,.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon{right:auto;left:0}.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon,.github-fork-ribbon.right-bottom,.right-bottom.release-ribbon,.right-bottom.issue-ribbon{top:auto;bottom:0}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after{right:auto;left:-3.23em}.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{top:auto;bottom:3.23em}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}.release-ribbon:before{background-color:#a00}.issue-ribbon:before{background-color:#025d8c}@media screen{div.narrow{max-width:1080px;margin:0 auto !important;margin-top:70px auto !important;float:none !important}#toc.toc2{margin-top:70px !important}}

</style>
<!-- Generate a nice TOC -->
<script src="/js/jquery-1.11.3.min.js"></script>
<script src="/js/jquery-ui.min.js"></script>
<script src="/js/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we need -->

<style>
.tocify-header {
    /* font-style: italic; */
}

.tocify-subheader {
    font-style: normal;
    font-size: 95%;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    /* background-color: rgba(0, 0, 0, 0.05);*/
}

.tocify-focus > a {
    color: #ba3925;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>
<style>
/*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
.tabs {
  margin-bottom: 1.25em;
}

.tablist > ul {
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  margin: 0;
  padding: 0;
}

.tablist > ul li {
  align-items: center;
  background-color: #fff;
  cursor: pointer;
  display: flex;
  font-weight: bold;
  line-height: 1.5;
  padding: 0.25em 1em;
  position: relative;
}

.tablist > ul li:focus-visible {
  outline: none;
}

.tablist.ulist,
.tablist.ulist > ul li {
  margin: 0;
}

.tablist.ulist > ul li + li {
  margin-left: 0.25em;
}

.tabs .tablist li::after {
  content: "";
  display: block;
  height: 1px;
  position: absolute;
  bottom: -1px;
  left: 0;
  right: 0;
}

.tabs.is-loading .tablist li:not(:first-child),
.tabs:not(.is-loading) .tablist li:not(.is-selected) {
  background-color: #f5f5f5;
}

.tabs.is-loading .tablist li:first-child::after,
.tabs:not(.is-loading) .tablist li.is-selected::after {
  background-color: #fff;
}

/*
.tabs:not(.is-loading) .tablist li,
.tabs:not(.is-loading) .tablist li::after {
  transition: background-color 200ms ease-in-out;
}
*/

.tablist > ul p {
  line-height: inherit;
  margin: 0;
}

.tabpanel {
  background-color: #fff;
  padding: 1.25em;
}

.tablist > ul li,
.tabpanel {
  border: 1px solid #dcdcdc;
}

.tablist > ul li {
  border-bottom: 0;
}

.tabs.is-loading .tabpanel + .tabpanel,
.tabs:not(.is-loading) .tabpanel.is-hidden {
  display: none;
}

.tabpanel > :first-child {
  margin-top: 0;
}

/* #content is a signature of the Asciidoctor standalone HTML output */
#content .tabpanel > :last-child,
#content .tabpanel > :last-child > :last-child,
#content .tabpanel > :last-child > :last-child > li:last-child > :last-child {
  margin-bottom: 0;
}

.tablecontainer {
  overflow-x: auto;
}

#content .tablecontainer {
  margin-bottom: 1.25em;
}

#content .tablecontainer > table.tableblock {
  margin-bottom: 0;
}
</style>
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Configuring hosts by using Ansible</h1>
<div class="details">
<span id="revnumber">version 3.16,</span>
<span id="revdate">published Oct 24 2025</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Getting_Started_with_Ansible_in_foreman_ansible">1. Getting started with Ansible in Foreman</a>
<ul class="sectlevel2">
<li><a href="#supported-ansible-versions_ansible">1.1. Supported Ansible versions</a></li>
<li><a href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible">1.2. Configuring your Foreman to run Ansible roles</a></li>
<li><a href="#Enabling_Ansible_Integration_with_foreman_ansible">1.3. Enabling Ansible integration with Foreman</a></li>
<li><a href="#Importing_Ansible_Roles_and_Variables_ansible">1.4. Importing Ansible roles and variables</a></li>
<li><a href="#Overriding_Ansible_Variables_in_foreman_ansible">1.5. Overriding Ansible variables in Foreman</a></li>
<li><a href="#synchronizing-ansible-collections_ansible">1.6. Synchronizing Ansible Collections</a></li>
<li><a href="#customizing-ansible-configuration_ansible">1.7. Customizing Ansible configuration</a></li>
<li><a href="#using-ansible-vault-with-foreman_ansible">1.8. Using Ansible Vault with Foreman</a></li>
</ul>
</li>
<li><a href="#Using_Ansible_Roles_to_Automate_Repetitive_Tasks_on_Clients_ansible">2. Using Ansible roles to automate repetitive tasks on clients</a>
<ul class="sectlevel2">
<li><a href="#Assigning_Ansible_Roles_to_an_Existing_Host_ansible">2.1. Assigning Ansible roles to an existing host</a></li>
<li><a href="#removing-ansible-roles-from-a-host_ansible">2.2. Removing Ansible roles from a host</a></li>
<li><a href="#changing-the-order-of-ansible-roles_ansible">2.3. Changing the order of Ansible roles</a></li>
<li><a href="#running-ansible-roles-on-a-host_ansible">2.4. Running Ansible roles on a host</a></li>
<li><a href="#Assigning_Ansible_Roles_to_a_Host_Group_ansible">2.5. Assigning Ansible roles to a host group</a></li>
<li><a href="#running-ansible-roles-on-a-host-group_ansible">2.6. Running Ansible roles on a host group</a></li>
<li><a href="#running-ansible-roles-in-check-mode_ansible">2.7. Running Ansible roles in check mode</a></li>
</ul>
</li>
<li><a href="#running-an-ansible-playbook-from-foreman_ansible">3. Running an Ansible Playbook from Foreman</a>
<ul class="sectlevel2">
<li><a href="#host-parameters-in-ansible-playbooks">3.1. Host parameters in Ansible Playbooks</a></li>
</ul>
</li>
<li><a href="#Configuring_and_Setting_Up_Remote_Jobs_ansible">4. Configuring and setting up remote jobs</a>
<ul class="sectlevel2">
<li><a href="#Remote-Execution-in-Foreman_ansible">4.1. Remote execution in Foreman</a></li>
<li><a href="#remote-execution-workflow_ansible">4.2. Remote execution workflow</a></li>
<li><a href="#permissions-for-remote-execution_ansible">4.3. Permissions for remote execution</a></li>
<li><a href="#transport-modes-for-remote-execution_ansible">4.4. Transport modes for remote execution</a></li>
<li><a href="#installing-the-remote-execution-plugin">4.5. Installing the Remote Execution plugin</a></li>
<li><a href="#creating-a-job-template-by-using-web-ui">4.6. Creating a job template by using Foreman web UI</a></li>
<li><a href="#creating-a-job-template-by-using-cli">4.7. Creating a job template by using Hammer CLI</a></li>
<li><a href="#importing-an-ansible-playbook-by-name_ansible">4.8. Importing an Ansible Playbook by name</a></li>
<li><a href="#importing-all-available-ansible-playbooks_ansible">4.9. Importing all available Ansible Playbooks</a></li>
<li><a href="#configuring-the-fallback-to-any-smart-proxy-remote-execution-setting-by-using-web-ui">4.10. Configuring the fallback to any Smart&#160;Proxy remote execution setting by using Foreman web UI</a></li>
<li><a href="#configuring-the-fallback-to-any-smart-proxy-remote-execution-setting-by-using-cli">4.11. Configuring the fallback to any Smart&#160;Proxy remote execution setting by using Hammer CLI</a></li>
<li><a href="#configuring-the-global-smart-proxy-remote-execution-setting-by-using-web-ui">4.12. Configuring the global Smart&#160;Proxy remote execution setting by using Foreman web UI</a></li>
<li><a href="#configuring-the-global-smart-proxy-remote-execution-setting-by-using-cli">4.13. Configuring the global Smart&#160;Proxy remote execution setting by using Hammer CLI</a></li>
<li><a href="#setting-an-alternative-directory-for-remote-execution-jobs-in-push-mode_ansible">4.14. Configuring Foreman to use an alternative directory to execute remote jobs on hosts</a></li>
<li><a href="#altering-the-privilege-elevation-method_ansible">4.15. Altering the privilege elevation method</a></li>
<li><a href="#Distributing_SSH_Keys_for_Remote_Execution_ansible">4.16. Distributing SSH keys for remote execution</a></li>
<li><a href="#distributing-ssh-keys-for-remote-execution-manually_ansible">4.17. Distributing SSH keys for remote execution manually</a></li>
<li><a href="#adding-a-passphrase-to-ssh-key-used-for-remote-execution_ansible">4.18. Adding a passphrase to SSH key used for remote execution</a></li>
<li><a href="#Using_the_foreman_API_to_Obtain_SSH_Keys_for_Remote_Execution_ansible">4.19. Using the Foreman API to obtain SSH keys for remote execution</a></li>
<li><a href="#Configuring_a_AutoYaST_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible">4.20. Configuring a AutoYaST template to distribute SSH keys during provisioning</a></li>
<li><a href="#Configuring_a_Kickstart_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible">4.21. Configuring a Kickstart template to distribute SSH keys during provisioning</a></li>
<li><a href="#Configuring_a_Preseed_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible">4.22. Configuring a Preseed template to distribute SSH keys during provisioning</a></li>
<li><a href="#configuring-a-keytab-for-kerberos-ticket-granting-tickets_ansible">4.23. Configuring a keytab for Kerberos ticket granting tickets</a></li>
<li><a href="#configuring-kerberos-authentication-for-remote-execution_ansible">4.24. Configuring Kerberos authentication for remote execution</a></li>
<li><a href="#customizing-job-templates">4.25. Customizing job templates</a></li>
<li><a href="#executing-a-remote-job-by-using-web-ui">4.26. Executing a remote job by using Foreman web UI</a></li>
<li><a href="#executing-a-remote-job-by-using-cli">4.27. Executing a remote job by using Hammer CLI</a></li>
<li><a href="#advanced-settings-in-the-job-wizard_ansible">4.28. Advanced settings in the job wizard</a></li>
<li><a href="#using-extended-cron-lines_ansible">4.29. Using extended cron lines</a></li>
<li><a href="#scheduling-a-recurring-ansible-job-for-a-host_ansible">4.30. Scheduling a recurring Ansible job for a host</a></li>
<li><a href="#Scheduling_a_Recurring_Ansible_Job_for_a_Host_Group_ansible">4.31. Scheduling a recurring Ansible job for a host group</a></li>
<li><a href="#setting-the-job-rate-limit-on-smart-proxy_ansible">4.32. Setting the job rate limit on Smart&#160;Proxy</a></li>
</ul>
</li>
<li><a href="#Integrating_foreman_and_AWX_ansible">5. Integrating Foreman and AWX</a>
<ul class="sectlevel2">
<li><a href="#Adding_foreman_Server_to_AWX_as_a_Dynamic_Inventory_Item_ansible">5.1. Adding Foreman&#160;server to AWX as a dynamic inventory item</a></li>
<li><a href="#Configuring_Provisioning_Callback_for_a_Host_ansible">5.2. Configuring provisioning callback for a host</a></li>
</ul>
</li>
<li><a href="#Job_Template_Examples_and_Extensions_ansible">6. Job template examples and extensions</a>
<ul class="sectlevel2">
<li><a href="#Customizing_Job_Templates_ansible">6.1. Customizing job templates</a></li>
<li><a href="#creating-a-job-template-to-restore-selinux-context">6.2. Creating a job template to restore SELinux context</a></li>
<li><a href="#Rendering_a_restorecon_Template_ansible">6.3. Rendering a restorecon template</a></li>
<li><a href="#Executing_a_restorecon_Template_on_Multiple_Hosts_ansible">6.4. Executing a restorecon template on multiple hosts</a></li>
<li><a href="#Including_Power_Actions_in_Templates_ansible">6.5. Including power actions in templates</a></li>
</ul>
</li>
<li><a href="#Host_Parameter_Hierarchy_ansible">Appendix A: Host parameter hierarchy</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="Getting_Started_with_Ansible_in_foreman_ansible"><a class="anchor" href="#Getting_Started_with_Ansible_in_foreman_ansible"></a>1. Getting started with Ansible in Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this guide to configure Foreman to use Ansible for remote execution.</p>
</div>
<div class="sect2">
<h3 id="supported-ansible-versions_ansible"><a class="anchor" href="#supported-ansible-versions_ansible"></a>1.1. Supported Ansible versions</h3>
<div class="paragraph">
<p>Foreman uses Ansible as provided by the base operating system of Foreman&#160;server or any Smart&#160;Proxies for remote execution.
Therefore, the supported version of Ansible depends on your base operating system configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Your_foreman_to_Run_Ansible_Roles_ansible"><a class="anchor" href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible"></a>1.2. Configuring your Foreman to run Ansible roles</h3>
<div class="paragraph">
<p>In Foreman, you can import Ansible roles to help with automation of routine tasks.
To enable Ansible on Foreman&#160;server, see <a href="#Enabling_Ansible_Integration_with_foreman_ansible">Enabling Ansible integration with Foreman</a>.</p>
</div>
<div id="Ansible-paths_ansible" class="paragraph">
<div class="title">Ansible paths</div>
<p>Foreman imports and runs Ansible roles from the following paths:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/etc/ansible/roles</code></p>
</li>
<li>
<p><code>/usr/share/ansible/roles</code></p>
</li>
<li>
<p><code>/etc/ansible/collections</code></p>
</li>
<li>
<p><code>/usr/share/ansible/collections</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Roles and collections from installed packages are placed under <code>/usr/share/ansible</code>.
If you want to add custom roles or collections, place them under <code>/etc/ansible</code>.</p>
</div>
<div class="paragraph">
<p>The paths are configured by Foreman.
For more information, see <a href="#customizing-ansible-configuration_ansible">Customizing Ansible configuration</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the roles to a directory in an <a href="#Ansible-paths_ansible">Ansible path</a> on Foreman&#160;server and all Smart&#160;Proxy&#160;servers from where you want to use the roles.
If you want to use custom or third party Ansible roles, ensure to configure an external version control system to synchronize roles between Foreman&#160;server and Smart&#160;Proxy&#160;servers.</p>
</li>
<li>
<p>On all Smart&#160;Proxy&#160;servers that you want to use to run Ansible roles on hosts, enable the Ansible plugin:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-proxy-plugin-ansible</pre>
</div>
</div>
</li>
<li>
<p>Distribute SSH keys to enable Smart&#160;Proxies to connect to hosts using SSH.
For more information, see <a href="#Distributing_SSH_Keys_for_Remote_Execution_ansible">Distributing SSH keys for remote execution</a>.
Foreman runs Ansible roles the same way it runs remote execution jobs.</p>
</li>
<li>
<p>Import the Ansible roles into Foreman.</p>
</li>
<li>
<p>Proceed to <a href="#Using_Ansible_Roles_to_Automate_Repetitive_Tasks_on_Clients_ansible">Using Ansible roles to automate repetitive tasks on clients</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Enabling_Ansible_Integration_with_foreman_ansible"><a class="anchor" href="#Enabling_Ansible_Integration_with_foreman_ansible"></a>1.3. Enabling Ansible integration with Foreman</h3>
<div class="paragraph">
<p>Perform the following procedure to enable the Ansible plugin on your Foreman&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enable the Ansible plugin on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-plugin-ansible \
--enable-foreman-proxy-plugin-ansible</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Importing_Ansible_Roles_and_Variables_ansible"><a class="anchor" href="#Importing_Ansible_Roles_and_Variables_ansible"></a>1.4. Importing Ansible roles and variables</h3>
<div class="paragraph">
<p>You can import Ansible roles and variables from the <a href="#Ansible-paths_ansible">Ansible paths</a> on Foreman&#160;server or Smart&#160;Proxy&#160;servers that has Ansible enabled.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the roles and variables that you import are located in the <a href="#Ansible-paths_ansible">Ansible paths</a> on all Smart&#160;Proxies from where you want to use the roles.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Ansible</strong> &gt; <strong>Roles</strong>.</p>
</li>
<li>
<p>Click <strong>Import</strong> to select the Smart&#160;Proxy from which you want to import.</p>
</li>
<li>
<p>Select the roles that you want to import.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Overriding_Ansible_Variables_in_foreman_ansible"><a class="anchor" href="#Overriding_Ansible_Variables_in_foreman_ansible"></a>1.5. Overriding Ansible variables in Foreman</h3>
<div class="paragraph">
<p>If you run Ansible roles in Foreman, you can use Foreman to override Ansible variables for those roles.</p>
</div>
<div class="paragraph">
<p>The following procedure refers to hosts and host groups.
For more information, see <a href="https://docs.theforeman.org/3.16/Managing_Hosts/index-foreman-deb.html#"><em>Managing hosts</em></a>.</p>
</div>
<div class="paragraph">
<div class="title">Precedence in overriding variables</div>
<p>If you use an Ansible role to run a task as a user that is not the <code>Effective User</code>, there is a strict order of precedence for overriding Ansible variables.
To ensure the variable that you override follows the correct order of precedence, see <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#ansible-variable-precedence">Variable precedence: Where should I put a variable?</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have Ansible variables in Foreman.
For more information, see <a href="#Importing_Ansible_Roles_and_Variables_ansible">Importing Ansible roles and variables</a></p>
</li>
<li>
<p>To use overridden Ansible variables, a user must have a role that allows them to see the attributes that are matched against hosts.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Ansible</strong> &gt; <strong>Variables</strong>.</p>
</li>
<li>
<p>Select the Ansible variable that you want to override and manage with Foreman.</p>
</li>
<li>
<p>In the <strong>Default Behavior</strong> area, select the <strong>Override</strong> checkbox.</p>
</li>
<li>
<p>In the <strong>Parameter Type</strong> field, select the value type for validation such as <strong>string</strong> or <strong>boolean</strong>.
The types <strong>array</strong> and <strong>hash</strong> have further options for handling upon a variable match.
For more information, see <a href="#prioritize-order">the <em>Prioritize Attribute Order</em> area</a> below.</p>
</li>
<li>
<p>In the <strong>Default Value</strong> field, enter the default value that you want to use if there is no match for the variable.</p>
</li>
<li>
<p>Optional: If you do not want to display the value of the variable as plain text in the Foreman web UI, select the <strong>Hidden Value</strong> checkbox to display the content of the variable as asterisks.
This is useful for sensitive values such as passwords or secret tokens.</p>
</li>
<li>
<p>Optional: Expand the <strong>Optional Input Validator</strong> area and specify conditions that will be used to validate concrete values of the variable:</p>
<div class="ulist">
<ul>
<li>
<p>Select <strong>Required</strong> if you want to enforce users to fill in this variable.</p>
</li>
<li>
<p>In the <strong>Validator Type</strong> field, select how the value will be validated:</p>
<div class="ulist">
<ul>
<li>
<p><code>list</code> &#8211; The value will be validated against an enumeration of allowed values.</p>
</li>
<li>
<p><code>regex</code> &#8211; The value will be validated against a regular expression pattern.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: <span id="prioritize-order">In the <strong>Prioritize Attribute Order</strong> area</span>, specify the order of priority to match an override with a host by host attributes.
Order at the top takes higher precedence.
The first match wins.</p>
<div class="paragraph">
<p>You can combine multiple attributes into a single matcher key using a comma as the AND operation.
For example, the matcher key of <code>hostgroup, environment</code> would expect matchers such as <code>hostgroup = "web servers"</code> AND <code>environment = production</code>.</p>
</div>
<div class="paragraph">
<p>If you use the parameter type <strong>array</strong> or <strong>hash</strong>, you can further set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Merge Overrides</strong> &#8211; Merges members of the arrays/hashes instead of replacing the whole array or hash.
If the hashes contain the same key, the value is overwritten by the value of the host.</p>
</li>
<li>
<p><strong>Merge Default</strong> &#8211; Adds the default value to the array or hash.</p>
</li>
<li>
<p><strong>Avoid Duplicates</strong> &#8211; Ensures that the values in the array or hash are unique.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: Expand the <strong>Specify Matchers</strong> area and specify criteria for selecting hosts on which the variable overrides.</p>
</li>
<li>
<p>To save the override settings, click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To use the Ansible variable, add the variable as a parameter to your host or host group, or add the variable as a global parameter.</p>
</div>
<div class="olist arabic">
<div class="title">Adding the variable to a host</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts &gt; All Hosts</strong> and select the host that you want to use.</p>
</li>
<li>
<p>Click the <strong>Ansible</strong> tab, and in the <strong>Variables</strong> area, click the pencil icon to edit the value of the variable.</p>
</li>
<li>
<p>Click the tick icon to accept the value of the changed variable or the cross icon to cancel the change.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Adding the variable to a host group</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>, and select the host group that you want to use.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab, and in the <strong>Host Group Parameters</strong> area, click <strong>Add Parameter</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, add the Ansible variable name.</p>
</li>
<li>
<p>From the <strong>Type</strong> list, select the type of the variable for validation.</p>
</li>
<li>
<p>In the <strong>Value</strong> field, enter the value for the variable.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Adding the variable as a global parameter</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Global Parameters</strong>, and click <strong>Create Parameter</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, add the Ansible variable name.</p>
</li>
<li>
<p>From the <strong>Type</strong> list, select the type of the variable for validation.</p>
</li>
<li>
<p>In the <strong>Value</strong> field, enter the value for the variable.</p>
</li>
<li>
<p>Optional: If you do not want to display the Ansible variable in plain text, select the <strong>Hidden Values</strong> checkbox to display the content of the variable as asterisks in the Foreman web UI.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="synchronizing-ansible-collections_ansible"><a class="anchor" href="#synchronizing-ansible-collections_ansible"></a>1.6. Synchronizing Ansible Collections</h3>
<div class="paragraph">
<p>On Foreman, you can synchronize your Ansible Collections from any Ansible Galaxy and other Foreman instances.
Ansible Collections will appear on Foreman as a new repository type in the Foreman web UI menu under <strong>Content</strong> after the sync.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Content</strong> &gt; <strong>Products</strong>.</p>
</li>
<li>
<p>Select the required product name.</p>
</li>
<li>
<p>In the <strong>Products</strong> window, select the name of a product that you want to create a repository for.</p>
</li>
<li>
<p>Click the <strong>Repositories</strong> tab, and then click <strong>New Repository</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the repository.</p>
<div class="paragraph">
<p>The <strong>Label</strong> field is populated automatically based on the name.</p>
</div>
</li>
<li>
<p>From the <strong>Type</strong> list, select <strong>ansible collection</strong>.</p>
</li>
<li>
<p>In the <strong>Upstream URL</strong> field, enter the URL for the upstream collections repository.</p>
<div class="paragraph">
<p>The URL can be any Ansible Galaxy endpoint.
For example, <code>https://galaxy.ansible.com</code>.</p>
</div>
</li>
<li>
<p>Optional: In the <strong>Requirements.yml</strong> field, you can specify the list of collections you want to sync from the endpoint, as well as their versions.</p>
<div class="paragraph">
<p>If you do not specify the list of collections, everything from the endpoint will be synced.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
collections:
- name: my_namespace.my_collection
  version: 1.2.3</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.ansible.com/ansible/latest/galaxy/user_guide.html#installing-roles-and-collections-from-the-same-requirements-yml-file">Installing roles and collections from the same requirements.yml file</a> in the <em>Galaxy User Guide</em>.</p>
</div>
</li>
<li>
<p>Optional: Deselect <strong>Sync Dependencies</strong> if you do not want Foreman to resolve and synchronize dependencies.
By default, Foreman synchronizes all required dependencies.</p>
</li>
<li>
<p>Authenticate.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To sync Foreman from <strong>Private Automation Hub</strong>, enter your token in the <strong>Auth Token</strong> field.</p>
</li>
<li>
<p>To sync Foreman from <code>console.redhat.com</code>, enter your token in the <strong>Auth Token</strong> field and enter your SSO URL in the the <strong>Auth URL</strong> field.</p>
</li>
<li>
<p>To sync Foreman from Foreman, leave both authentication fields blank.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Navigate to the Ansible Collections repository.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> menu, select <strong>Sync Now</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="customizing-ansible-configuration_ansible"><a class="anchor" href="#customizing-ansible-configuration_ansible"></a>1.7. Customizing Ansible configuration</h3>
<div class="paragraph">
<p>Foreman manages essential Ansible configuration that is required for Ansible integration with Foreman.
However, you can customize other Ansible configuration options as usual.</p>
</div>
<div class="paragraph">
<p>Foreman stores the essential Ansible configuration as environment variables in <code>/etc/foreman-proxy/ansible.env</code>.
This file is managed by <code>foreman-installer</code>.</p>
</div>
<div class="paragraph">
<p>Ansible reads configuration from a configuration file and the environment provided by Smart&#160;Proxy.
If you need to customize Ansible configuration, you can do so in the system-wide <code>/etc/ansible/ansible.cfg</code> file or in the <code>/usr/share/foreman-proxy/.ansible.cfg</code> file in the home directory of the <code>foreman-proxy</code> user.
Note that if you use <code>/usr/share/foreman-proxy/.ansible.cfg</code>, Ansible spawned by Foreman ignores configuration in <code>/etc/ansible/ansible.cfg</code>.</p>
</div>
<div class="paragraph">
<p>Note that environment variables take precedence over values in <code>ansible.cfg</code>, which ensures that the essential configuration required by Foreman is retained.</p>
</div>
<div class="paragraph">
<p>The following table lists the essential Ansible configuration options managed by Foreman.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Essential Ansible configuration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Environment Variable</th>
<th class="tableblock halign-left valign-top">Config Key</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANSIBLE_CALLBACKS_ENABLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">callbacks_enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables callback to Foreman; equivalent to <code>callback_whitelist</code> for cross-version compatibility</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANSIBLE_CALLBACK_WHITELIST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">callback_whitelist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables callback to Foreman; equivalent to <code>callbacks_enabled</code> for cross-version compatibility</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANSIBLE_COLLECTIONS_PATHS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">collections_paths</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of paths to Ansible collections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANSIBLE_HOST_KEY_CHECKING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">host_key_checking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables checking of host keys during SSH connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANSIBLE_LOCAL_TEMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">local_tmp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary directory on Smart&#160;Proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANSIBLE_ROLES_PATH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">roles_path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of paths to Ansible roles</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANSIBLE_SSH_ARGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssh_args</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arguments passed to SSH connection</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html">Ansible Configuration Settings</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-ansible-vault-with-foreman_ansible"><a class="anchor" href="#using-ansible-vault-with-foreman_ansible"></a>1.8. Using Ansible Vault with Foreman</h3>
<div class="paragraph">
<p>You can encrypt sensitive Ansible data files using the Ansible Vault tool and configure Ansible to access the encrypted files using a password stored in a file.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>If you customized <code>/etc/ansible/ansible.cfg</code>, copy your configuration from <code>/etc/ansible/ansible.cfg</code> to <code>/usr/share/foreman-proxy/.ansible.cfg</code>.</p>
</li>
<li>
<p>Encrypt the sensitive file using the <code>ansible-vault</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-vault encrypt /etc/ansible/roles/<em>Role_Name</em>/vars/main.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>ansible-vault</code> changes the file permissions to <code>600</code>.</p>
</div>
</li>
<li>
<p>Change the group and permissions of the encrypted file to ensure that the <code>foreman-proxy</code> user can read it:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chgrp foreman-proxy /etc/ansible/roles/<em>Role_Name</em>/vars/main.yml
# chmod 0640 /etc/ansible/roles/<em>Role_Name</em>/vars/main.yml</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/usr/share/foreman-proxy/.ansible_vault_password</code> file and enter the Vault password into it.</p>
</li>
<li>
<p>Change the user and permissions of the <code>.ansible_vault_password</code> file to ensure that only the <code>foreman-proxy</code> user can read it:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown foreman-proxy:foreman-proxy /usr/share/foreman-proxy/.ansible_vault_password
# chmod 0400 /usr/share/foreman-proxy/.ansible_vault_password</pre>
</div>
</div>
</li>
<li>
<p>Add the path of the Vault password file to the <code>[defaults]</code> section in <code>/usr/share/foreman-proxy/.ansible.cfg</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[defaults]
vault_password_file = /usr/share/foreman-proxy/.ansible_vault_password</pre>
</div>
</div>
<div class="paragraph">
<p>The path to the Vault password file must be absolute.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Using_Ansible_Roles_to_Automate_Repetitive_Tasks_on_Clients_ansible"><a class="anchor" href="#Using_Ansible_Roles_to_Automate_Repetitive_Tasks_on_Clients_ansible"></a>2. Using Ansible roles to automate repetitive tasks on clients</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Assigning_Ansible_Roles_to_an_Existing_Host_ansible"><a class="anchor" href="#Assigning_Ansible_Roles_to_an_Existing_Host_ansible"></a>2.1. Assigning Ansible roles to an existing host</h3>
<div class="paragraph">
<p>You can use Ansible roles for remote management of Foreman clients.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you have configured and imported Ansible roles.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts &gt; All Hosts</strong>.</p>
</li>
<li>
<p>Select the host and click <strong>Edit</strong>.</p>
</li>
<li>
<p>On the <strong>Ansible Roles</strong> tab, select the role that you want to add from the <strong>Available Ansible Roles</strong> list.</p>
</li>
<li>
<p>Click the <strong>+</strong> icon to add the role to the host.
You can add more than one role.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After you assign Ansible roles to hosts, you can use Ansible for remote execution.
For more information, see <a href="#Distributing_SSH_Keys_for_Remote_Execution_ansible">Distributing SSH keys for remote execution</a>.</p>
</div>
<div class="paragraph">
<div class="title">Overriding parameter variables</div>
<p>On the <strong>Parameters</strong> tab, click <strong>Add Parameter</strong> to add any parameter variables that you want to pass to job templates at run time.
This includes all Ansible Playbook parameters and host parameters that you want to associate with the host.
To use a parameter variable with an Ansible job template, you must add a <strong>Host Parameter</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="removing-ansible-roles-from-a-host_ansible"><a class="anchor" href="#removing-ansible-roles-from-a-host_ansible"></a>2.2. Removing Ansible roles from a host</h3>
<div class="paragraph">
<p>Use the following procedure to remove Ansible roles from a host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts &gt; All Hosts</strong>.</p>
</li>
<li>
<p>Select the host and click <strong>Edit</strong>.</p>
</li>
<li>
<p>Select the <strong>Ansible Roles</strong> tab.</p>
</li>
<li>
<p>In the <strong>Assigned Ansible Roles</strong> area, click the <strong>-</strong> icon to remove the role from the host.
Repeat to remove more roles.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="changing-the-order-of-ansible-roles_ansible"><a class="anchor" href="#changing-the-order-of-ansible-roles_ansible"></a>2.3. Changing the order of Ansible roles</h3>
<div class="paragraph">
<p>Use the following procedure to change the order of Ansible roles applied to a host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts &gt; All Hosts</strong>.</p>
</li>
<li>
<p>Select a host.</p>
</li>
<li>
<p>Select the <strong>Ansible Roles</strong> tab.</p>
</li>
<li>
<p>In the <strong>Assigned Ansible Roles</strong> area, you can change the order of the roles by dragging and dropping the roles into the preferred position.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the order of the Ansible roles.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="running-ansible-roles-on-a-host_ansible"><a class="anchor" href="#running-ansible-roles-on-a-host_ansible"></a>2.4. Running Ansible roles on a host</h3>
<div class="paragraph">
<p>You can run Ansible roles on a host through the Foreman web UI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must configure your deployment to run Ansible roles.
For more information, see <a href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible">Configuring your Foreman to run Ansible roles</a>.</p>
</li>
<li>
<p>You must have assigned the Ansible roles to the host.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</li>
<li>
<p>Select the checkbox of the host that contains the Ansible role you want to run.</p>
</li>
<li>
<p>From the <strong>Select Action</strong> list, select <strong>Run all Ansible roles</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can view the status of your Ansible job on the <strong>Run Ansible roles</strong> page.
To rerun a job, click <strong>Rerun</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Assigning_Ansible_Roles_to_a_Host_Group_ansible"><a class="anchor" href="#Assigning_Ansible_Roles_to_a_Host_Group_ansible"></a>2.5. Assigning Ansible roles to a host group</h3>
<div class="paragraph">
<p>You can use Ansible roles for remote management of Foreman clients.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must configure your deployment to run Ansible roles.
For more information, see <a href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible">Configuring your Foreman to run Ansible roles</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>.</p>
</li>
<li>
<p>Click the host group name to which you want to assign an Ansible role.</p>
</li>
<li>
<p>On the <strong>Ansible Roles</strong> tab, select the role that you want to add from the <strong>Available Ansible Roles</strong> list.</p>
</li>
<li>
<p>Click the <strong>+</strong> icon to add the role to the host group.
You can add more than one role.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="running-ansible-roles-on-a-host-group_ansible"><a class="anchor" href="#running-ansible-roles-on-a-host-group_ansible"></a>2.6. Running Ansible roles on a host group</h3>
<div class="paragraph">
<p>You can run Ansible roles on a host group through the Foreman web UI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must configure your deployment to run Ansible roles.
For more information, see <a href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible">Configuring your Foreman to run Ansible roles</a>.</p>
</li>
<li>
<p>You must have assigned the Ansible roles to the host group.</p>
</li>
<li>
<p>You must have at least one host in your host group.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>.</p>
</li>
<li>
<p>From the list in the <strong>Actions</strong> column for the host group, select <strong>Run all Ansible roles</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can view the status of your Ansible job on the <strong>Run Ansible roles</strong> page.
Click <strong>Rerun</strong> to rerun a job.</p>
</div>
</div>
<div class="sect2">
<h3 id="running-ansible-roles-in-check-mode_ansible"><a class="anchor" href="#running-ansible-roles-in-check-mode_ansible"></a>2.7. Running Ansible roles in check mode</h3>
<div class="paragraph">
<p>You can run Ansible roles in check mode through the Foreman web UI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must configure your deployment to run Ansible roles.
For more information, see <a href="#Configuring_Your_foreman_to_Run_Ansible_Roles_ansible">Configuring your Foreman to run Ansible roles</a>.</p>
</li>
<li>
<p>You must have assigned the Ansible roles to the host group.</p>
</li>
<li>
<p>You must have at least one host in your host group.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> <strong>&gt;</strong> <strong>All Hosts</strong>.</p>
</li>
<li>
<p>Click <strong>Edit</strong> for the host you want to enable check mode for.</p>
</li>
<li>
<p>In the <strong>Parameters</strong> tab, ensure that the host has a parameter named <code>ansible_roles_check_mode</code> with type <code>boolean</code> set to <code>true</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-an-ansible-playbook-from-foreman_ansible"><a class="anchor" href="#running-an-ansible-playbook-from-foreman_ansible"></a>3. Running an Ansible Playbook from Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can run an Ansible Playbook on a host or host group by executing a remote job in Foreman.</p>
</div>
<div class="paragraph">
<div class="title">Limitation of host parameters in Ansible Playbook job templates</div>
<p>When you execute an Ansible Playbook on multiple hosts, Foreman renders the playbook for all hosts in the batch, but only uses the rendered playbook of the first host to execute it on all hosts in the batch.
Therefore, you cannot modify the behavior of the playbook per host by using a host parameter in the template control flow constructs.
Host parameters are translated into Ansible variables, so you can use them to control the behavior in native Ansible constructs.
For more information, see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=2282275">BZ#2282275</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ansible plugin in Foreman is enabled.</p>
</li>
<li>
<p>Remote job execution is configured.
For more information, see <a href="#Configuring_and_Setting_Up_Remote_Jobs_ansible">Configuring and setting up remote jobs</a>.</p>
</li>
<li>
<p>You have an Ansible Playbook ready to use.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Jobs</strong>.</p>
</li>
<li>
<p>Click <strong>Run Job</strong>.</p>
</li>
<li>
<p>In <strong>Job category</strong>, select <code>Ansible Playbook</code>.</p>
</li>
<li>
<p>In <strong>Job template</strong>, select <code>Ansible - Run playbook</code>.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Select the hosts on which you want to run the playbook.</p>
</li>
<li>
<p>In the <strong>playbook</strong> field, paste the content of your Ansible Playbook.</p>
</li>
<li>
<p>Follow the wizard to complete setting the remote job.
For more information, see <a href="#Configuring_and_Setting_Up_Remote_Jobs_ansible">Configuring and setting up remote jobs</a>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to run the Ansible Playbook on your hosts.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>Alternatively, you can import Ansible Playbooks from Smart&#160;Proxy&#160;servers.
For more information, see the following resources:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#importing-an-ansible-playbook-by-name_ansible">Importing an Ansible Playbook by name</a></p>
</li>
<li>
<p><a href="#importing-all-available-ansible-playbooks_ansible">Importing all available Ansible Playbooks</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#host-parameters-in-ansible-playbooks">Host parameters in Ansible Playbooks</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="host-parameters-in-ansible-playbooks"><a class="anchor" href="#host-parameters-in-ansible-playbooks"></a>3.1. Host parameters in Ansible Playbooks</h3>
<div class="paragraph">
<p>You can use host parameters from Foreman in Ansible Playbooks.</p>
</div>
<div class="listingblock">
<div class="title">Example Ansible Playbook to access host parameters</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">---
- name: "Ansible Playbook to access host parameters"
  hosts: all
  tasks:
    - name: "View a host parameter"
      ansible.builtin.debug:
        msg: "{{ hostvars[inventory_hostname]['<em>My_Host_Parameter</em>'] }}"
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ansible will access the host parameter and show its value.
If you set the host parameter to an ERB template, for example, <code>&lt;%= @host.capabilities.include?(:snapshots) %&gt;</code>, Foreman will render it and provide the result to Ansible.
Ansible receives only the rendered value, not the ERB template itself.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Host_Parameter_Hierarchy_ansible">Host parameter hierarchy</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_and_Setting_Up_Remote_Jobs_ansible"><a class="anchor" href="#Configuring_and_Setting_Up_Remote_Jobs_ansible"></a>4. Configuring and setting up remote jobs</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Foreman supports remote execution of commands on hosts.
Using remote execution, you can perform various tasks on multiple hosts simultaneously.</p>
</div>
<div class="sect2">
<h3 id="Remote-Execution-in-Foreman_ansible"><a class="anchor" href="#Remote-Execution-in-Foreman_ansible"></a>4.1. Remote execution in Foreman</h3>
<div class="paragraph _abstract">
<p>With remote execution, you can run jobs on hosts from Smart&#160;Proxies by using shell scripts or Ansible roles and playbooks.</p>
</div>
<div class="paragraph">
<p>Use remote execution for the following benefits in Foreman:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run jobs on multiple hosts at once.</p>
</li>
<li>
<p>Use variables in your commands for more granular control over the jobs you run.</p>
</li>
<li>
<p>Use host facts and parameters to populate the variable values.</p>
</li>
<li>
<p>Specify custom values for templates when you run the command.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Communication for remote execution occurs through Smart&#160;Proxy&#160;server, which means that Foreman&#160;server does not require direct access to the target host, and can scale to manage many hosts.
For more information, see <a href="#transport-modes-for-remote-execution_ansible">Transport modes for remote execution</a>.</p>
</div>
<div class="paragraph">
<p>To use remote execution, you must define a job template.
A job template is a command that you want to apply to remote hosts.
You can execute a job template multiple times.</p>
</div>
<div class="paragraph">
<p>Foreman uses ERB syntax job templates.
For more information, see <a href="https://docs.theforeman.org/3.16/Managing_Hosts/index-foreman-deb.html#Template_Writing_Reference_managing-hosts">Template writing reference</a> in <em>Managing hosts</em>.</p>
</div>
<div class="paragraph">
<p>By default, Foreman includes several job templates for shell scripts and Ansible.
For more information, see <a href="#customizing-job-templates">Customizing job templates</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="remote-execution-workflow_ansible"><a class="anchor" href="#remote-execution-workflow_ansible"></a>4.2. Remote execution workflow</h3>
<div class="paragraph _abstract">
<p>When you run a remote job on hosts, for every host, Foreman performs a series of actions to find a remote execution Smart&#160;Proxy to use.</p>
</div>
<div class="paragraph">
<p>For custom Ansible roles that you create, or roles that you download, you must install the package containing the roles on your Smart&#160;Proxy&#160;server.
Before you can use Ansible roles, you must import the roles into Foreman from the Smart&#160;Proxy where they are installed.</p>
</div>
<div class="paragraph">
<p>Foreman searches only for Smart&#160;Proxies that have the Ansible feature enabled.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Foreman finds the host&#8217;s interfaces that have the <strong>Remote execution</strong> checkbox selected.</p>
</li>
<li>
<p>Foreman finds the subnets of these interfaces.</p>
</li>
<li>
<p>Foreman finds remote execution Smart&#160;Proxies assigned to these subnets.</p>
</li>
<li>
<p>From this set of Smart&#160;Proxies, Foreman selects the Smart&#160;Proxy that has the least number of running jobs.
By doing this, Foreman ensures that the jobs load is balanced between remote execution Smart&#160;Proxies.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you have enabled <strong>Prefer registered through Smart&#160;Proxy for remote execution</strong>, Foreman runs the REX job by using the Smart&#160;Proxy to which the host is registered.</p>
</div>
<div class="paragraph">
<p>By default, <strong>Prefer registered through Smart&#160;Proxy for remote execution</strong> is set to <strong>No</strong>.
To enable it, in the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and on the <strong>Content</strong> tab, set <code>Prefer registered through Smart&#160;Proxy for remote execution</code> to <strong>Yes</strong>.
This ensures that Foreman performs REX jobs on hosts by the Smart&#160;Proxy to which they are registered to.</p>
</div>
<div class="paragraph">
<p>If Foreman does not find a remote execution Smart&#160;Proxy at this stage, and if the <strong>Fallback to Any Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman selects the most lightly loaded Smart&#160;Proxy from the following types of Smart&#160;Proxies that are assigned to the host:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DHCP, DNS and TFTP Smart&#160;Proxies assigned to the host&#8217;s subnets</p>
</li>
<li>
<p>DNS Smart&#160;Proxy assigned to the host&#8217;s domain</p>
</li>
<li>
<p>Realm Smart&#160;Proxy assigned to the host&#8217;s realm</p>
</li>
<li>
<p>Puppet server Smart&#160;Proxy</p>
</li>
<li>
<p>Puppet CA Smart&#160;Proxy</p>
</li>
<li>
<p>OpenSCAP Smart&#160;Proxy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If Foreman does not find a remote execution Smart&#160;Proxy at this stage, and if the <strong>Enable Global Smart&#160;Proxy</strong> setting is enabled, Foreman selects the most lightly loaded remote execution Smart&#160;Proxy from the set of all Smart&#160;Proxies in the host&#8217;s organization and location to execute a remote job.</p>
</div>
</div>
<div class="sect2">
<h3 id="permissions-for-remote-execution_ansible"><a class="anchor" href="#permissions-for-remote-execution_ansible"></a>4.3. Permissions for remote execution</h3>
<div class="paragraph _abstract">
<p>You can control which roles can run which jobs within your infrastructure, including which hosts they can target.</p>
</div>
<div class="paragraph">
<p>The remote execution feature provides two built-in roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Remote Execution Manager</strong>: Can access all remote execution features and functionality.</p>
</li>
<li>
<p><strong>Remote Execution User</strong>: Can only run jobs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can clone the <strong>Remote Execution User</strong> role and customize its filter for increased granularity.
If you adjust the filter with the <code>view_job_templates</code> permission on a customized role, you can only see and trigger jobs based on matching job templates.
You can use the <code>view_hosts</code> and <code>view_smart_proxies</code> permissions to limit which hosts or Smart&#160;Proxies are visible to the role.</p>
</div>
<div class="paragraph">
<p>The <code>execute_template_invocation</code> permission is a special permission that is checked immediately before execution of a job begins.
This permission defines which job template you can run on a particular host.
This allows for even more granularity when specifying permissions.</p>
</div>
<div class="paragraph">
<p>You can run remote execution jobs against Foreman and Smart&#160;Proxy registered as hosts to Foreman with the <code>execute_jobs_on_infrastructure_hosts</code> permission.
Standard <strong>Manager</strong> and <strong>Site Manager</strong> roles have this permission by default.
If you use either the <strong>Manager</strong> or <strong>Site Manager</strong> role, or if you use a custom role with the <code>execute_jobs_on_infrastructure_hosts</code> permission, you can execute remote jobs against registered Foreman and Smart&#160;Proxy hosts.</p>
</div>
<div class="paragraph">
<p>For more information on working with roles and permissions, see <a href="https://docs.theforeman.org/3.16/Administering_Project/index-foreman-deb.html#creating-and-managing-roles">Creating and managing roles</a> in <em>Administering Foreman</em>.</p>
</div>
<div class="paragraph">
<p>The following example shows filters for the <code>execute_template_invocation</code> permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">name = Reboot and host.name = staging.example.com
name = Reboot and host.name ~ *.staging.example.com
name = "Restart service" and host_group.name = webservers</pre>
</div>
</div>
<div class="paragraph">
<p>Use the first line in this example to apply the <strong>Reboot</strong> template to one selected host.
Use the second line to define a pool of hosts with names ending with <code>.staging.example.com</code>.
Use the third line to bind the template with a host group.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Permissions assigned to users with these roles can change over time.
If you have already scheduled some jobs to run in the future, and the permissions change, this can result in execution failure because permissions are checked immediately before job execution.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="transport-modes-for-remote-execution_ansible"><a class="anchor" href="#transport-modes-for-remote-execution_ansible"></a>4.4. Transport modes for remote execution</h3>
<div class="paragraph _abstract">
<p>You can configure your Foreman to use two different modes of transport for remote job execution.</p>
</div>
<div class="paragraph">
<p>The following transport modes are available for remote execution.
You can configure single Smart&#160;Proxy to use either one mode or the other but not both.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Push-based transport</dt>
<dd>
<p>On Smart&#160;Proxies in <code>ssh</code> mode, remote execution uses the SSH service to transport job details.
This is the default transport mode.
The SSH service must be enabled and active on the target hosts.
The remote execution Smart&#160;Proxy must have access to the SSH port on the target hosts.
Unless you have a different setting, the standard SSH port is 22.</p>
<div class="paragraph">
<p>This transport mode supports both Script and Ansible providers.</p>
</div>
</dd>
<dt class="hdlist1">Pull-based transport</dt>
<dd>
<p>On Smart&#160;Proxies in <code>pull-mqtt</code> mode, remote execution uses Message Queueing Telemetry Transport (MQTT) to initiate the job execution it receives from Foreman&#160;server.
The host subscribes to the MQTT broker on Smart&#160;Proxy for job notifications by using the <code>yggdrasil</code> pull client.
After the host receives a notification from the MQTT broker, it pulls job details from Smart&#160;Proxy over HTTPS, runs the job, and reports results back to Smart&#160;Proxy.</p>
<div class="paragraph">
<p>This transport mode supports the Script provider only.</p>
</div>
<div class="paragraph">
<p>To use the <code>pull-mqtt</code> mode, you must enable it on Smart&#160;Proxy&#160;server and configure the pull client on hosts.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If your Smart&#160;Proxy already uses the <code>pull-mqtt</code> mode and you want to switch back to the <code>ssh</code> mode, run this <code>foreman-installer</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-plugin-remote-execution-script-mode ssh</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="installing-the-remote-execution-plugin"><a class="anchor" href="#installing-the-remote-execution-plugin"></a>4.5. Installing the Remote Execution plugin</h3>
<div class="paragraph _abstract">
<p>You can install and enable the Remote Execution plugin to run commands and jobs on hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the Remote Execution plugin on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-plugin-remote-execution \
--enable-foreman-plugin-remote-execution-cockpit \
--enable-foreman-proxy-plugin-remote-execution-script</pre>
</div>
</div>
</li>
<li>
<p>Optional: Enable the Hammer CLI plugin on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-cli-remote-execution</pre>
</div>
</div>
</li>
<li>
<p>Optional: Install the Remote Execution plugin on your Smart&#160;Proxy&#160;servers:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-proxy-plugin-remote-execution-script</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-job-template-by-using-web-ui"><a class="anchor" href="#creating-a-job-template-by-using-web-ui"></a>4.6. Creating a job template by using Foreman web UI</h3>
<div class="paragraph _abstract">
<p>Use this procedure to create a job template from the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Job templates</strong>.</p>
</li>
<li>
<p>Click <strong>New Job Template</strong>.</p>
</li>
<li>
<p>Click the <strong>Template</strong> tab, and in the <strong>Name</strong> field, enter a unique name for your job template.</p>
</li>
<li>
<p>Select <strong>Default</strong> to make the template available for all organizations and locations.</p>
</li>
<li>
<p>Create the template directly in the template editor or upload it from a text file by clicking <strong>Import</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Audit Comment</strong> field, add information about the change.</p>
</li>
<li>
<p>Click the <strong>Job</strong> tab, and in the <strong>Job category</strong> field, enter your own category or select from the default categories.</p>
</li>
<li>
<p>Optional: In the <strong>Description Format</strong> field, enter a description template.
For example, <code>Install package %{package_name}</code>.
You can also use <code>%{template_name}</code> and <code>%{job_category}</code> in your template.</p>
</li>
<li>
<p>From the <strong>Provider Type</strong> list, select <strong>SSH</strong> for shell scripts and <strong>Ansible</strong> for Ansible tasks or playbooks.</p>
</li>
<li>
<p>Optional: In the <strong>Timeout to kill</strong> field, enter a timeout value to terminate the job if it does not complete.</p>
</li>
<li>
<p>Optional: Click <strong>Add Input</strong> to define an input parameter.
Parameters are requested when executing the job and do not have to be defined in the template.
For examples, see the <strong>Help</strong> tab.</p>
</li>
<li>
<p>Optional: Click <strong>Foreign input set</strong> to include other templates in this job.</p>
</li>
<li>
<p>Optional: In the <strong>Effective user</strong> area, configure a user if the command cannot use the default <code>remote_execution_effective_user</code> setting.</p>
</li>
<li>
<p>Optional: If this template is a snippet to be included in other templates, click the <strong>Type</strong> tab and select <strong>Snippet</strong>.</p>
</li>
<li>
<p>Optional: If you use the Ansible provider, click the <strong>Ansible</strong> tab.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select <strong>Enable Ansible Callback</strong> to allow hosts to send facts, which are used to create configuration reports, back to Foreman after a job finishes.</p>
</li>
<li>
<p>Select <strong>Enable Ansible Check Mode</strong> to run jobs based on the template in Ansible check mode, which executes Ansible playbooks without making changes to hosts.
For more information on Ansible check mode, see <a href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_checkmode.html">Validating tasks: check mode and diff mode</a> in <em>Ansible Documentation</em>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click the <strong>Location</strong> tab and add the locations where you want to use the template.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add the organizations where you want to use the template.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/3.16/Managing_Hosts/index-foreman-deb.html#Template_Writing_Reference_managing-hosts">Template writing reference</a></p>
</li>
<li>
<p><a href="https://docs.theforeman.org/3.16/Managing_Hosts/index-foreman-deb.html#Job_Template_Examples_and_Extensions_managing-hosts">Job template examples and extensions in <em>Managing hosts</em></a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-job-template-by-using-cli"><a class="anchor" href="#creating-a-job-template-by-using-cli"></a>4.7. Creating a job template by using Hammer CLI</h3>
<div class="paragraph _abstract">
<p>Use this procedure to create a job template by using Hammer CLI.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a job template using a template-definition file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer job-template create \
--file "<em>Path_to_My_Template_File</em>" \
--job-category "<em>My_Category_Name</em>" \
--name "<em>My_Template_Name</em>" \
--provider-type SSH</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/3.16/Managing_Hosts/index-foreman-deb.html#Template_Writing_Reference_managing-hosts">Template writing reference</a></p>
</li>
<li>
<p><a href="https://docs.theforeman.org/3.16/Managing_Hosts/index-foreman-deb.html#Job_Template_Examples_and_Extensions_managing-hosts">Job template examples and extensions in <em>Managing hosts</em></a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="importing-an-ansible-playbook-by-name_ansible"><a class="anchor" href="#importing-an-ansible-playbook-by-name_ansible"></a>4.8. Importing an Ansible Playbook by name</h3>
<div class="paragraph _abstract">
<p>You can import Ansible Playbooks by name to Foreman from collections installed on Smart&#160;Proxy.</p>
</div>
<div class="paragraph">
<p>When you import an Ansible Playbook, Foreman creates a job template from the imported playbook and places the template in the <code>Ansible Playbook - Imported</code> job category.
If you have a custom collection, place it in <code>/etc/ansible/collections/ansible_collections/<em>My_Namespace</em>/<em>My_Collection</em></code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ansible plugin is enabled.</p>
</li>
<li>
<p>Your Foreman account has a role that grants the <code>import_ansible_playbooks</code> permission.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Fetch the available Ansible Playbooks by using the following API request:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl \
--header 'Content-Type: application/json' \
--request GET \
https://<em>foreman.example.com</em>/ansible/api/v2/ansible_playbooks/fetch?proxy_id=<em>My_Smart_Proxy_ID</em></pre>
</div>
</div>
</li>
<li>
<p>Select the Ansible Playbook you want to import and note its name.</p>
</li>
<li>
<p>Import the Ansible Playbook by its name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl \
--data '{ "playbook_names": ["<em>My_Playbook_Name</em>"] }' \
--header 'Content-Type: application/json' \
--request PUT \
https://<em>foreman.example.com</em>/ansible/api/v2/ansible_playbooks/sync?proxy_id=<em>My_Smart_Proxy_ID</em></pre>
</div>
</div>
<div class="paragraph">
<p>You get a notification in the Foreman web UI after the import completes.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>You can run the playbook by executing a remote job from the created job template.
For more information, see <a href="#Configuring_and_Setting_Up_Remote_Jobs_ansible">Configuring and setting up remote jobs</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="importing-all-available-ansible-playbooks_ansible"><a class="anchor" href="#importing-all-available-ansible-playbooks_ansible"></a>4.9. Importing all available Ansible Playbooks</h3>
<div class="paragraph _abstract">
<p>You can import all the available Ansible Playbooks to Foreman from collections installed on Smart&#160;Proxy.</p>
</div>
<div class="paragraph">
<p>When you import an Ansible Playbook, Foreman creates job templates from the imported playbooks and places the templates in the <code>Ansible Playbook - Imported</code> job category.
If you have a custom collection, place it in <code>/etc/ansible/collections/ansible_collections/<em>My_Namespace</em>/<em>My_Collection</em></code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ansible plugin is enabled.</p>
</li>
<li>
<p>Your Foreman account has a role that grants the <code>import_ansible_playbooks</code> permission.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Import the Ansible Playbooks by using the following API request:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -X PUT -H 'Content-Type: application/json' https://<em>foreman.example.com</em>/ansible/api/v2/ansible_playbooks/sync?proxy_id=<em>My_Smart_Proxy_ID</em></pre>
</div>
</div>
<div class="paragraph">
<p>You get a notification in the Foreman web UI after the import completes.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>You can run the playbooks by executing a remote job from the created job templates.
For more information, see <a href="#Configuring_and_Setting_Up_Remote_Jobs_ansible">Configuring and setting up remote jobs</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-fallback-to-any-smart-proxy-remote-execution-setting-by-using-web-ui"><a class="anchor" href="#configuring-the-fallback-to-any-smart-proxy-remote-execution-setting-by-using-web-ui"></a>4.10. Configuring the fallback to any Smart&#160;Proxy remote execution setting by using Foreman web UI</h3>
<div class="paragraph _abstract">
<p>You can enable the <strong>Fallback to Any Smart&#160;Proxy</strong> setting to configure Foreman to search for remote execution Smart&#160;Proxies from the list of Smart&#160;Proxies that are assigned to hosts.
This can be useful if you need to run remote jobs on hosts that have no subnets configured or if the subnets of the hosts are assigned to Smart&#160;Proxies that do not have the remote execution feature enabled.</p>
</div>
<div class="paragraph">
<p>If the <strong>Fallback to Any Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman also selects the most lightly loaded Smart&#160;Proxy from the set of all Smart&#160;Proxies assigned to the host, such as the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DHCP, DNS and TFTP Smart&#160;Proxies assigned to the subnets of the hosts</p>
</li>
<li>
<p>DNS Smart&#160;Proxy assigned to the host domain</p>
</li>
<li>
<p>Realm Smart&#160;Proxy assigned to the host realm</p>
</li>
<li>
<p>Puppet server Smart&#160;Proxy</p>
</li>
<li>
<p>Puppet CA Smart&#160;Proxy</p>
</li>
<li>
<p>OpenSCAP Smart&#160;Proxy</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Click <strong>Remote Execution</strong>.</p>
</li>
<li>
<p>Configure the <strong>Fallback to Any Smart&#160;Proxy</strong> setting.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-fallback-to-any-smart-proxy-remote-execution-setting-by-using-cli"><a class="anchor" href="#configuring-the-fallback-to-any-smart-proxy-remote-execution-setting-by-using-cli"></a>4.11. Configuring the fallback to any Smart&#160;Proxy remote execution setting by using Hammer CLI</h3>
<div class="paragraph _abstract">
<p>You can enable the <strong>Fallback to Any Smart&#160;Proxy</strong> setting to configure Foreman to search for remote execution Smart&#160;Proxies from the list of Smart&#160;Proxies that are assigned to hosts.
This can be useful if you need to run remote jobs on hosts that have no subnets configured or if the subnets of the hosts are assigned to Smart&#160;Proxies that do not have the remote execution feature enabled.</p>
</div>
<div class="paragraph">
<p>If the <strong>Fallback to Any Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman also selects the most lightly loaded Smart&#160;Proxy from the set of all Smart&#160;Proxies assigned to the host, such as the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DHCP, DNS and TFTP Smart&#160;Proxies assigned to the host&#8217;s subnets</p>
</li>
<li>
<p>DNS Smart&#160;Proxy assigned to the host&#8217;s domain</p>
</li>
<li>
<p>Realm Smart&#160;Proxy assigned to the host&#8217;s realm</p>
</li>
<li>
<p>Puppet server Smart&#160;Proxy</p>
</li>
<li>
<p>Puppet CA Smart&#160;Proxy</p>
</li>
<li>
<p>OpenSCAP Smart&#160;Proxy</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Configure the <strong>Fallback to Any Smart&#160;Proxy</strong> setting:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer settings set \
--name remote_execution_fallback_proxy \
--value true</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-global-smart-proxy-remote-execution-setting-by-using-web-ui"><a class="anchor" href="#configuring-the-global-smart-proxy-remote-execution-setting-by-using-web-ui"></a>4.12. Configuring the global Smart&#160;Proxy remote execution setting by using Foreman web UI</h3>
<div class="paragraph _abstract">
<p>By default, Foreman searches for remote execution Smart&#160;Proxies in hosts' organizations and locations regardless of whether Smart&#160;Proxies are assigned to hosts' subnets or not.
You can disable the <strong>Enable Global Smart&#160;Proxy</strong> setting if you want to limit the search to the Smart&#160;Proxies that are assigned to hosts' subnets.</p>
</div>
<div class="paragraph">
<p>If the <strong>Enable Global Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman also selects the most lightly loaded remote execution Smart&#160;Proxy from the set of all Smart&#160;Proxies in the host&#8217;s organization and location to execute a remote job.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Click <strong>Remote Execution</strong>.</p>
</li>
<li>
<p>Configure the <strong>Enable Global Smart&#160;Proxy</strong> setting.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-global-smart-proxy-remote-execution-setting-by-using-cli"><a class="anchor" href="#configuring-the-global-smart-proxy-remote-execution-setting-by-using-cli"></a>4.13. Configuring the global Smart&#160;Proxy remote execution setting by using Hammer CLI</h3>
<div class="paragraph _abstract">
<p>By default, Foreman searches for remote execution Smart&#160;Proxies in hosts' organizations and locations regardless of whether Smart&#160;Proxies are assigned to hosts' subnets or not.
You can disable the <strong>Enable Global Smart&#160;Proxy</strong> setting if you want to limit the search to the Smart&#160;Proxies that are assigned to hosts' subnets.</p>
</div>
<div class="paragraph">
<p>If the <strong>Enable Global Smart&#160;Proxy</strong> setting is enabled, Foreman adds another set of Smart&#160;Proxies to select the remote execution Smart&#160;Proxy from.
Foreman also selects the most lightly loaded remote execution Smart&#160;Proxy from the set of all Smart&#160;Proxies in the host&#8217;s organization and location to execute a remote job.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the <code>hammer settings set</code> command on Foreman to configure the <code>Enable Global Smart&#160;Proxy</code> setting.
To set the value to <code>true</code>, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer settings set \
--name remote_execution_global_proxy \
--value true</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="setting-an-alternative-directory-for-remote-execution-jobs-in-push-mode_ansible"><a class="anchor" href="#setting-an-alternative-directory-for-remote-execution-jobs-in-push-mode_ansible"></a>4.14. Configuring Foreman to use an alternative directory to execute remote jobs on hosts</h3>
<div class="paragraph">
<p>Ansible puts its own files it requires on the server side into the <code>/tmp</code> directory.
You have the option to set a different directory if required.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Foreman&#160;server or Smart&#160;Proxy&#160;server, create a new directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir <em>/My_Remote_Working_Directory</em></pre>
</div>
</div>
</li>
<li>
<p>Configure your Foreman&#160;server or Smart&#160;Proxy&#160;server to use the new directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-plugin-ansible-working-dir <em>/My_Remote_Working_Directory</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="altering-the-privilege-elevation-method_ansible"><a class="anchor" href="#altering-the-privilege-elevation-method_ansible"></a>4.15. Altering the privilege elevation method</h3>
<div class="paragraph _abstract">
<p>By default, push-based remote execution uses <code>sudo</code> to switch from the SSH user to the effective user that executes the script on your host.
In some situations, you might require to use another method, such as <code>su</code> or <code>dzdo</code>.
You can globally configure an alternative method in your Foreman settings.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your user account has a role assigned that grants the <code>view_settings</code> and <code>edit_settings</code> permissions.</p>
</li>
<li>
<p>If you want to use <code>dzdo</code> for Ansible jobs, ensure the <code>community.general</code> Ansible collection, which contains the required <strong>dzdo</strong> become plugin, is installed.
For more information, see <a href="https://docs.ansible.com/ansible/latest/collections_guide/collections_installing.html">Installing collections</a> in <em>Ansible documentation</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Select the <strong>Remote Execution</strong> tab.</p>
</li>
<li>
<p>Click the value of the <strong>Effective User Method</strong> setting.</p>
</li>
<li>
<p>Select the new value.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Distributing_SSH_Keys_for_Remote_Execution_ansible"><a class="anchor" href="#Distributing_SSH_Keys_for_Remote_Execution_ansible"></a>4.16. Distributing SSH keys for remote execution</h3>
<div class="paragraph _abstract">
<p>For Smart&#160;Proxies in <code>ssh</code> mode, remote execution connections are authenticated using SSH.
The public SSH key from Smart&#160;Proxy must be distributed to its attached hosts that you want to manage.</p>
</div>
<div class="paragraph">
<p>Ensure that the SSH service is enabled and running on the hosts.
Configure any network or host-based firewalls to enable access to port 22.</p>
</div>
<div class="paragraph">
<p>Use one of the following methods to distribute the public SSH key from Smart&#160;Proxy to target hosts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#distributing-ssh-keys-for-remote-execution-manually_ansible">Distributing SSH keys for remote execution manually</a>.</p>
</li>
<li>
<p><a href="#Using_the_foreman_API_to_Obtain_SSH_Keys_for_Remote_Execution_ansible">Using the Foreman API to obtain SSH keys for remote execution</a>.</p>
</li>
<li>
<p><a href="#Configuring_a_Kickstart_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible">Configuring a Kickstart template to distribute SSH keys during provisioning</a>.</p>
</li>
<li>
<p>For new Foreman hosts, you can deploy SSH keys to Foreman hosts during registration using the global registration template.
For more information, see <a href="https://docs.theforeman.org/3.16/Managing_Hosts/index-foreman-deb.html#Registering_Hosts_by_Using_Global_Registration_managing-hosts">Registering hosts by using global registration</a> in <em>Managing hosts</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Foreman distributes SSH keys for the remote execution feature to the hosts provisioned from Foreman by default.</p>
</div>
<div class="paragraph">
<p>If the hosts are running on Amazon Web Services, enable password authentication.
For more information, see <a href="https://aws.amazon.com/premiumsupport/knowledge-center/new-user-accounts-linux-instance">New User Accounts</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="distributing-ssh-keys-for-remote-execution-manually_ansible"><a class="anchor" href="#distributing-ssh-keys-for-remote-execution-manually_ansible"></a>4.17. Distributing SSH keys for remote execution manually</h3>
<div class="paragraph _abstract">
<p>You can distribute SSH keys for remote execution manually.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Copy the SSH pub key from your Smart&#160;Proxy to your target host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh-copy-id -i ~foreman-proxy/.ssh/id_rsa_foreman_proxy.pub <em>root@client.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>Repeat this step for each target host you want to manage.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>On your Smart&#160;Proxy, confirm that the key was successfully copied to the target host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh -i ~foreman-proxy/.ssh/id_rsa_foreman_proxy <em>root@client.example.com</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-a-passphrase-to-ssh-key-used-for-remote-execution_ansible"><a class="anchor" href="#adding-a-passphrase-to-ssh-key-used-for-remote-execution_ansible"></a>4.18. Adding a passphrase to SSH key used for remote execution</h3>
<div class="paragraph _abstract">
<p>By default, Smart&#160;Proxy uses a non-passphrase protected SSH key to execute remote jobs on hosts.
You can protect the SSH key with a passphrase by following this procedure.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>On your Foreman&#160;server or Smart&#160;Proxy&#160;server, use <code>ssh-keygen</code> to add a passphrase to your SSH key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh-keygen -p -f ~foreman-proxy/.ssh/id_rsa_foreman_proxy</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>Users now must use a passphrase when running remote execution jobs on hosts.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Using_the_foreman_API_to_Obtain_SSH_Keys_for_Remote_Execution_ansible"><a class="anchor" href="#Using_the_foreman_API_to_Obtain_SSH_Keys_for_Remote_Execution_ansible"></a>4.19. Using the Foreman API to obtain SSH keys for remote execution</h3>
<div class="paragraph _abstract">
<p>To use the Foreman API to download the public key from Smart&#160;Proxy, complete this procedure on each target host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the target host, create the <code>~/.ssh</code> directory to store the SSH key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir ~/.ssh</pre>
</div>
</div>
</li>
<li>
<p>Download the SSH key from Smart&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl https://<em>smartproxy.example.com</em>:8443/ssh/pubkey &gt;&gt; ~/.ssh/authorized_keys</pre>
</div>
</div>
</li>
<li>
<p>Configure permissions for the <code>~/.ssh</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 700 ~/.ssh</pre>
</div>
</div>
</li>
<li>
<p>Configure permissions for the <code>authorized_keys</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 600 ~/.ssh/authorized_keys</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_a_AutoYaST_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"><a class="anchor" href="#Configuring_a_AutoYaST_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"></a>4.20. Configuring a AutoYaST template to distribute SSH keys during provisioning</h3>
<div class="paragraph _abstract">
<p>You can add a <code>remote_execution_ssh_keys</code> snippet to your custom AutoYaST template to deploy SSH keys to hosts during provisioning.
AutoYaST templates that Foreman ships include this snippet by default.
Foreman copies the SSH key for remote execution to the systems during provisioning.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To include the public key in newly-provisioned hosts, add the following snippet to the AutoYaST template that you use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%= snippet 'remote_execution_ssh_keys' %&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_a_Kickstart_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"><a class="anchor" href="#Configuring_a_Kickstart_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"></a>4.21. Configuring a Kickstart template to distribute SSH keys during provisioning</h3>
<div class="paragraph _abstract">
<p>You can add a <code>remote_execution_ssh_keys</code> snippet to your custom Kickstart template to deploy SSH keys to hosts during provisioning.
Kickstart templates that Foreman ships include this snippet by default.
Foreman copies the SSH key for remote execution to the systems during provisioning.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To include the public key in newly-provisioned hosts, add the following snippet to the Kickstart template that you use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%= snippet 'remote_execution_ssh_keys' %&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_a_Preseed_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"><a class="anchor" href="#Configuring_a_Preseed_Template_to_Distribute_SSH_Keys_During_Provisioning_ansible"></a>4.22. Configuring a Preseed template to distribute SSH keys during provisioning</h3>
<div class="paragraph _abstract">
<p>You can add a <code>remote_execution_ssh_keys</code> snippet to your custom Preseed template to deploy SSH keys to hosts during provisioning.
Preseed templates that Foreman ships include this snippet by default.
Foreman copies the SSH key for remote execution to the systems during provisioning.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To include the public key in newly-provisioned hosts, add the following snippet to the Preseed template that you use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;%= snippet 'remote_execution_ssh_keys' %&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-keytab-for-kerberos-ticket-granting-tickets_ansible"><a class="anchor" href="#configuring-a-keytab-for-kerberos-ticket-granting-tickets_ansible"></a>4.23. Configuring a keytab for Kerberos ticket granting tickets</h3>
<div class="paragraph _abstract">
<p>Use this procedure to configure Foreman to use a keytab to obtain Kerberos ticket granting tickets.
If you do not set up a keytab, you must manually retrieve tickets.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the ID of the <code>foreman-proxy</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id -u foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Modify the <code>umask</code> value so that new files have the permissions <code>600</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># umask 077</pre>
</div>
</div>
</li>
<li>
<p>Create the directory for the keytab:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p "/var/kerberos/krb5/user/<em>My_User_ID</em>"</pre>
</div>
</div>
</li>
<li>
<p>Create a keytab or copy an existing keytab to the directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp <em>My_Client.keytab</em> /var/kerberos/krb5/user/<em>My_User_ID</em>/client.keytab</pre>
</div>
</div>
</li>
<li>
<p>Change the directory owner to the <code>foreman-proxy</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R foreman-proxy:foreman-proxy "/var/kerberos/krb5/user/<em>My_User_ID</em>"</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the keytab file is read-only:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod -wx "/var/kerberos/krb5/user/<em>My_User_ID</em>/client.keytab"</pre>
</div>
</div>
</li>
<li>
<p>Restore the SELinux context:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -RvF /var/kerberos/krb5</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-kerberos-authentication-for-remote-execution_ansible"><a class="anchor" href="#configuring-kerberos-authentication-for-remote-execution_ansible"></a>4.24. Configuring Kerberos authentication for remote execution</h3>
<div class="paragraph _abstract">
<p>You can use Kerberos authentication to establish an SSH connection for remote execution on Foreman hosts.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Enroll Foreman&#160;server on the Kerberos server</p>
</li>
<li>
<p>Enroll the Foreman target host on the Kerberos server</p>
</li>
<li>
<p>Configure and initialize a Kerberos user account for remote execution</p>
</li>
<li>
<p>Ensure that the <code>foreman-proxy</code> user on Foreman has a valid Kerberos ticket-granting ticket (TGT)</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable Kerberos authentication for remote execution:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-plugin-remote-execution-script-ssh-kerberos-auth true</pre>
</div>
</div>
</li>
<li>
<p>To edit the default user for remote execution, in the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and click the <strong>Remote Execution</strong> tab.
In the <strong>SSH User</strong> row, edit the second column and add the user name for the Kerberos account.</p>
</li>
<li>
<p>Navigate to <strong>remote_execution_effective_user</strong> and edit the second column to add the user name for the Kerberos account.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To confirm that Kerberos authentication is ready to use, run a remote job on the host.
For more information, see <a href="#Configuring_and_Setting_Up_Remote_Jobs_ansible">Configuring and setting up remote jobs</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="customizing-job-templates"><a class="anchor" href="#customizing-job-templates"></a>4.25. Customizing job templates</h3>
<div class="paragraph _abstract">
<p>Foreman provides default job templates that you can use for executing jobs.
Default job templates are locked for editing but you can clone them and edit the clone.</p>
</div>
<div class="paragraph">
<p>Job templates use the Embedded Ruby (ERB) syntax.
Ansible job templates use YAML syntax.</p>
</div>
<div class="paragraph">
<p>At run time, job templates can accept parameter variables that you define for a host.
Note that only the parameters visible on the <strong>Parameters</strong> tab at the host&#8217;s edit page can be used as input parameters for job templates.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Job templates</strong>.</p>
</li>
<li>
<p>To clone a template, in the <strong>Actions</strong> column, select <strong>Clone</strong>.</p>
</li>
<li>
<p>Enter a unique name for the clone and click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>In the list of job templates, click the cloned template to start editing it.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>An Ansible template must begin with <code>---</code>.
You can embed an Ansible Playbook YAML file into the job template body.
You can also add ERB syntax to customize your YAML Ansible template.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/3.16/Managing_Hosts/index-foreman-deb.html#Template_Writing_Reference_managing-hosts">Template Writing Reference in <em>Managing hosts</em></a></p>
</li>
<li>
<p><a href="https://docs.theforeman.org/3.16/Administering_Project/index-foreman-deb.html#synchronizing-template-repositories">Synchronizing template repositories in <em>Administering Foreman</em></a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="executing-a-remote-job-by-using-web-ui"><a class="anchor" href="#executing-a-remote-job-by-using-web-ui"></a>4.26. Executing a remote job by using Foreman web UI</h3>
<div class="paragraph _abstract">
<p>You can execute a job that is based on a job template against one or more hosts from the Foreman web UI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ansible jobs run in batches on multiple hosts, so you cannot cancel a job running on a specific host.
A job completes only after the Ansible Playbook runs on all hosts in the batch.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have the Remote Execution plugin enabled.
For more information, see <a href="#installing-the-remote-execution-plugin">Installing the Remote Execution plugin</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Jobs</strong> and click <strong>Run job</strong>.</p>
</li>
<li>
<p>Select the <strong>Job category</strong> and the <strong>Job template</strong> you want to use, then click <strong>Next</strong>.</p>
</li>
<li>
<p>Select hosts on which you want to run the job.
If you do not select any hosts, the job will run on all hosts you can see in the current context.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to select a host group and all of its subgroups, it is not sufficient to select the host group as the job would only run on hosts directly in that group and not on hosts in subgroups.
Instead, you must either select the host group and all of its subgroups or use this search query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">hostgroup_fullname ~ "<em>My_Host_Group</em>*"</pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>My_Host_Group</em> with the name of the top-level host group.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If required, provide inputs for the job template.
Different templates have different inputs and some templates do not have any inputs.
After entering all the required inputs, click <strong>Next</strong>.</p>
</li>
<li>
<p>Optional: To configure advanced settings for the job, fill in the <strong>Advanced fields</strong>.
To learn more about advanced settings, see <a href="#advanced-settings-in-the-job-wizard_ansible">Advanced settings in the job wizard</a>.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Schedule time for the job.</p>
<div class="ulist">
<ul>
<li>
<p>To execute the job immediately, keep the pre-selected <strong>Immediate execution</strong>.</p>
</li>
<li>
<p>To execute the job in future time, select <strong>Future execution</strong>.</p>
</li>
<li>
<p>To execute the job on regular basis, select <strong>Recurring execution</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: If you selected future or recurring execution, select the <strong>Query type</strong>, otherwise click <strong>Next</strong>.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Static query</strong> means that job executes on the exact list of hosts that you provided.</p>
</li>
<li>
<p><strong>Dynamic query</strong> means that the list of hosts is evaluated just before the job is executed.
If you entered the list of hosts based on some filter, the results can be different from when you first used that filter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Click <strong>Next</strong> after you have selected the query type.</p>
</div>
</li>
<li>
<p>Optional: If you selected future or recurring execution, provide additional details:</p>
<div class="ulist">
<ul>
<li>
<p>For <strong>Future execution</strong>, enter the <strong>Starts at</strong> date and time.
You also have the option to select the <strong>Starts before</strong> date and time.
If the job cannot start before that time, it will be canceled.</p>
</li>
<li>
<p>For <strong>Recurring execution</strong>, select the start date and time, frequency, and the condition for ending the recurring job.
You can choose the recurrence to never end, end at a certain time, or end after a given number of repetitions.
You can also add <strong>Purpose</strong> - a special label for tracking the job.
There can only be one active job with a given purpose at a time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Click <strong>Next</strong> after you have entered the required information.</p>
</div>
</li>
<li>
<p>Review job details.
You have the option to return to any part of the job wizard and edit the information.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to schedule the job for execution.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="executing-a-remote-job-by-using-cli"><a class="anchor" href="#executing-a-remote-job-by-using-cli"></a>4.27. Executing a remote job by using Hammer CLI</h3>
<div class="paragraph _abstract">
<p>You can execute a job that is based on a job template against one or more hosts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ansible jobs run in batches on multiple hosts, so you cannot cancel a job running on a specific host.
A job completes only after the Ansible Playbook runs on all hosts in the batch.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information about creating, monitoring, or canceling remote jobs with Hammer CLI, enter <code>hammer job-template --help</code> and <code>hammer job-invocation --help</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have the Remote Execution plugin enabled.
For more information, see <a href="#installing-the-remote-execution-plugin">Installing the Remote Execution plugin</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command on Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer settings set \
--name remote_execution_global_proxy \
--value false</pre>
</div>
</div>
</li>
<li>
<p>Find the ID of the job template you want to use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer job-template list</pre>
</div>
</div>
</li>
<li>
<p>Show the template details to see parameters required by your template:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer job-template info --id <em>My_Template_ID</em></pre>
</div>
</div>
</li>
<li>
<p>Execute a remote job with custom parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer job-invocation create \
--inputs <em>My_Key_1</em>="<em>My_Value_1</em>",<em>My_Key_2</em>="<em>My_Value_2</em>",... \
--job-template "<em>My_Template_Name</em>" \
--search-query "<em>My_Search_Query</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code><em>My_Search_Query</em></code> with the filter expression that defines hosts, for example <code>"name ~ <em>My_Pattern</em>"</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="advanced-settings-in-the-job-wizard_ansible"><a class="anchor" href="#advanced-settings-in-the-job-wizard_ansible"></a>4.28. Advanced settings in the job wizard</h3>
<div class="paragraph _abstract">
<p>Some job templates require you to enter advanced settings.
Some of the advanced settings are only visible to certain job templates.
Below is the list of general advanced settings.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SSH user</dt>
<dd>
<p>A user to be used for connecting to the host through SSH.</p>
</dd>
<dt class="hdlist1">Effective user</dt>
<dd>
<p>A user to be used for executing the job.
By default it is the SSH user.
If it differs from the SSH user, su or sudo, depending on your settings, is used to switch the accounts.</p>
<div class="ulist">
<ul>
<li>
<p>If you set an effective user in the advanced settings, Ansible sets <code>ansible_become_user</code> to your input value and <code>ansible_become</code> to <code>true</code>.
This means that if you use the parameters <code>become: true</code> and <code>become_user: <em>My_User</em></code> within a playbook, these will be overwritten by Foreman.</p>
</li>
<li>
<p>If your <em>SSH user</em> and <em>effective user</em> are identical, Foreman does not overwrite the <code>become_user</code>.
Therefore, you can set a custom <code>become_user</code> in your Ansible Playbook.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Description</dt>
<dd>
<p>A description template for the job.</p>
</dd>
<dt class="hdlist1">Timeout to kill</dt>
<dd>
<p>Time in seconds from the start of the job after which the job should be killed if it is not finished already.</p>
</dd>
<dt class="hdlist1">Time to pickup</dt>
<dd>
<p>Time in seconds after which the job is canceled if it is not picked up by a client.
This setting only applies to hosts using <code>pull-mqtt</code> transport.</p>
</dd>
<dt class="hdlist1">Password</dt>
<dd>
<p>Is used if SSH authentication method is a password instead of the SSH key.</p>
</dd>
<dt class="hdlist1">Private key passphrase</dt>
<dd>
<p>Is used if SSH keys are protected by a passphrase.</p>
</dd>
<dt class="hdlist1">Effective user password</dt>
<dd>
<p>Is used if effective user is different from the ssh user.</p>
</dd>
<dt class="hdlist1">Concurrency level</dt>
<dd>
<p>Defines the maximum number of jobs executed at once.
This can prevent overload of system resources in a case of executing the job on a large number of hosts.</p>
</dd>
<dt class="hdlist1">Execution ordering</dt>
<dd>
<p>Determines the order in which the job is executed on hosts.
It can be alphabetical or randomized.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="using-extended-cron-lines_ansible"><a class="anchor" href="#using-extended-cron-lines_ansible"></a>4.29. Using extended cron lines</h3>
<div class="paragraph _abstract">
<p>When scheduling a cron job with remote execution, you can use an extended cron line to specify the cadence of the job.</p>
</div>
<div class="paragraph">
<p>The standard cron line contains five fields that specify minute, hour, day of the month, month, and day of the week.
For example, <code>0 5 * * *</code> stands for every day at 5 AM.
If you want to learn more about the standard cron line, check <a href="https://crontab.guru">crontab guru</a>.</p>
</div>
<div class="paragraph">
<p>The extended cron line provides the following features:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">You can use <code>#</code> to specify a concrete week day in a month</dt>
<dd>
<p>For example:</p>
<div class="ulist">
<ul>
<li>
<p><code>0 0 * * mon#1</code> specifies first Monday of the month</p>
</li>
<li>
<p><code>0 0 * * fri#3,fri#4</code> specifies 3rd and 4th Fridays of the month</p>
</li>
<li>
<p><code>0 7 * * fri#-1</code> specifies the last Friday of the month at 07:00</p>
</li>
<li>
<p><code>0 7 * * fri#L</code> also specifies the last Friday of the month at 07:00</p>
</li>
<li>
<p><code>0 23 * * mon#2,tue</code> specifies the 2nd Monday of the month and every Tuesday, at 23:00</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">You can use <code>%</code> to specify every n-th day of the month</dt>
<dd>
<p>For example:</p>
<div class="ulist">
<ul>
<li>
<p><code>9 0 * * sun%2</code> specifies every other Sunday at 00:09</p>
</li>
<li>
<p><code>0 0 * * sun%2+1</code> specifies every odd Sunday</p>
</li>
<li>
<p><code>9 0 * * sun%2,tue%3</code> specifies every other Sunday and every third Tuesday</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">You can use <code>&amp;</code> to specify that the day of the month has to match the day of the week</dt>
<dd>
<p>For example:</p>
<div class="ulist">
<ul>
<li>
<p><code>0 0 30 * 1&amp;</code> specifies 30th day of the month, but only if it is Monday</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="scheduling-a-recurring-ansible-job-for-a-host_ansible"><a class="anchor" href="#scheduling-a-recurring-ansible-job-for-a-host_ansible"></a>4.30. Scheduling a recurring Ansible job for a host</h3>
<div class="paragraph _abstract">
<p>You can schedule a recurring job to run Ansible roles on hosts.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure you have the <code>view_foreman_tasks</code>, <code>view_job_invocations</code>, and <code>view_recurring_logics</code> permissions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts &gt; All Hosts</strong> and select the target host on which you want to execute a remote job.</p>
</li>
<li>
<p>On the <strong>Ansible</strong> tab, select <strong>Jobs</strong>.</p>
</li>
<li>
<p>Click <strong>Schedule recurring job</strong>.</p>
</li>
<li>
<p>Define the repetition frequency, start time, and date of the first run in the <strong>Create New Recurring Ansible Run</strong> window.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Optional: View the scheduled Ansible job in host overview or by navigating to <strong>Ansible</strong> &gt; <strong>Jobs</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Scheduling_a_Recurring_Ansible_Job_for_a_Host_Group_ansible"><a class="anchor" href="#Scheduling_a_Recurring_Ansible_Job_for_a_Host_Group_ansible"></a>4.31. Scheduling a recurring Ansible job for a host group</h3>
<div class="paragraph _abstract">
<p>You can schedule a recurring job to run Ansible roles on host groups.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host groups</strong>.</p>
</li>
<li>
<p>In the <strong>Actions</strong> column, select <strong>Configure Ansible Job</strong> for the host group you want to schedule an Ansible roles run for.</p>
</li>
<li>
<p>Click <strong>Schedule recurring job</strong>.</p>
</li>
<li>
<p>Define the repetition frequency, start time, and date of the first run in the <strong>Create New Recurring Ansible Run</strong> window.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="setting-the-job-rate-limit-on-smart-proxy_ansible"><a class="anchor" href="#setting-the-job-rate-limit-on-smart-proxy_ansible"></a>4.32. Setting the job rate limit on Smart&#160;Proxy</h3>
<div class="paragraph _abstract">
<p>You can limit the maximum number of active jobs on a Smart&#160;Proxy at a time to prevent performance spikes.</p>
</div>
<div class="paragraph">
<p>The job is active from the time Smart&#160;Proxy first tries to notify the host about the job until the job is finished on the host.</p>
</div>
<div class="paragraph">
<p>The job rate limit only applies to mqtt based jobs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The optimal maximum number of active jobs depends on the computing resources of your Smart&#160;Proxy&#160;server.
By default, the maximum number of active jobs is unlimited.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Set the maximum number of active jobs using <code>foreman-installer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-plugin-remote-execution-script-mqtt-rate-limit <em>MAX_JOBS_NUMBER</em></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-plugin-remote-execution-script-mqtt-rate-limit 200</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Integrating_foreman_and_AWX_ansible"><a class="anchor" href="#Integrating_foreman_and_AWX_ansible"></a>5. Integrating Foreman and AWX</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can integrate Foreman and AWX to use Foreman&#160;server as a dynamic inventory source for AWX.</p>
</div>
<div class="paragraph">
<p>You can also use the provisioning callback function to run playbooks on hosts managed by Foreman, from either the host or AWX.
When provisioning new hosts from Foreman&#160;server, you can use the provisioning callback function to trigger playbook runs from AWX.
The playbook configures the host after the provisioning process.</p>
</div>
<div class="sect2">
<h3 id="Adding_foreman_Server_to_AWX_as_a_Dynamic_Inventory_Item_ansible"><a class="anchor" href="#Adding_foreman_Server_to_AWX_as_a_Dynamic_Inventory_Item_ansible"></a>5.1. Adding Foreman&#160;server to AWX as a dynamic inventory item</h3>
<div class="paragraph">
<p>To add Foreman&#160;server to AWX as a dynamic inventory item, you must create a credential for a Foreman&#160;server user on AWX, add an AWX user to the credential, and then configure an inventory source.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>If your Foreman deployment is large, for example, managing tens of thousands of hosts, using a non-admin user can negatively impact performance because of time penalties that accrue during authorization checks.
For large deployments, consider using an admin user.</p>
</li>
<li>
<p>For non-admin users, you must assign the <code>Ansible Tower Inventory Reader</code> role to your Foreman&#160;server user.
For more information about managing users, roles, and permission filters, see <a href="https://docs.theforeman.org/3.16/Administering_Project/index-foreman-deb.html#creating-and-managing-roles">Creating and managing roles</a> in <em>Administering Foreman</em>.</p>
</li>
<li>
<p>You must host your Foreman&#160;server and AWX on the same network or subnet.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWX web UI, create a credential for your Foreman.
For more information about creating credentials, see
<a href="https://ansible.readthedocs.io/projects/awx/en/24.6.1/userguide/credentials.html#add-a-new-credential">Add a New Credential</a> and <a href="https://ansible.readthedocs.io/projects/awx/en/24.6.1/userguide/credentials.html#red-hat-satellite-6">Red Hat Satellite 6 credentials</a> in <em>AWX community documentation</em>.
Note that this part of the AWX documentation also applies to Foreman.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Foreman credentials</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Credential Type</strong>:</th>
<th class="tableblock halign-left valign-top"><strong>Foreman</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Foreman URL</strong>:</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>https://<em>foreman.example.com</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Username</strong>:</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The username of the Foreman user with the integration role.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Password</strong>:</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The password of the Foreman user.</p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Add an AWX user to the new credential.
For more information about adding a user to a credential, see
<a href="https://ansible.readthedocs.io/projects/awx/en/24.6.1/userguide/credentials.html#getting-started-with-credentials">Getting Started with Credentials</a> in <em>AWX community documentation</em>.</p>
</li>
<li>
<p>Add a new inventory.
For more information, see
<a href="https://ansible.readthedocs.io/projects/awx/en/24.6.1/userguide/inventories.html#add-a-new-inventory">Add a new inventory</a> in <em>AWX community documentation</em>.</p>
<div class="paragraph">
<p>In the new inventory, add Foreman&#160;server as the inventory source, specifying the following inventory source options.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Inventory source options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Source</strong></th>
<th class="tableblock halign-left valign-top"><strong>Foreman</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Credential</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The credential you create for Foreman&#160;server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Overwrite</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Overwrite Variables</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Update on Launch</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Cache Timeout</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>90</em></p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Ensure that you synchronize the source that you add.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Callback_for_a_Host_ansible"><a class="anchor" href="#Configuring_Provisioning_Callback_for_a_Host_ansible"></a>5.2. Configuring provisioning callback for a host</h3>
<div class="paragraph">
<p>When you create hosts in Foreman, you can use AWX to run playbooks to configure your newly created hosts.
This is called <em>provisioning callback</em> in AWX.</p>
</div>
<div class="paragraph">
<p>The provisioning callback function triggers a playbook run from AWX as part of the provisioning process.
The playbook configures the host after the provisioning process.</p>
</div>
<div class="paragraph">
<p>For more information about provisioning callbacks, see
<a href="https://ansible.readthedocs.io/projects/awx/en/24.6.1/userguide/job_templates.html#provisioning-callbacks">Provisioning Callbacks</a> in <em>AWX community documentation</em>.</p>
</div>
<div class="paragraph">
<p>In Foreman&#160;server, the <code>Kickstart Default</code> and <code>Kickstart Default Finish</code> templates include three snippets:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>ansible_provisioning_callback</code></p>
</li>
<li>
<p><code>ansible_tower_callback_script</code></p>
</li>
<li>
<p><code>ansible_tower_callback_service</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can add parameters to hosts or host groups to provide the credentials that these snippets can use to run Ansible Playbooks on your newly created hosts.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before you can configure provisioning callbacks, you must add Foreman as a dynamic inventory in AWX.
For more information, see <a href="#Integrating_foreman_and_AWX_ansible">Integrating Foreman and AWX</a>.</p>
</div>
<div class="paragraph">
<p>In the AWX web UI, you must complete the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a machine credential for your new host.
Ensure that you enter the same password in the credential that you plan to assign to the host that you create in Foreman.
For more information, see
<a href="https://ansible.readthedocs.io/projects/awx/en/24.6.1/userguide/credentials.html">Credentials</a> in <em>AWX community documentation</em>.</p>
</li>
<li>
<p>Create a project.
For more information, see
<a href="https://ansible.readthedocs.io/projects/awx/en/24.6.1/userguide/projects.html">Projects</a> in <em>AWX community documentation</em>.</p>
</li>
<li>
<p>Add a job template to your project.
In your job template, you must enable provisioning callbacks, generate the host configuration key, and note the <em>template_ID</em> of your job template.
For more information, see
<a href="https://ansible.readthedocs.io/projects/awx/en/24.6.1/userguide/job_templates.html">Job Templates</a> in <em>AWX community documentation</em>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Group</strong>.</p>
</li>
<li>
<p>Create a host group or edit an existing host group.</p>
</li>
<li>
<p>In the Host Group window, click the <strong>Parameters</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add Parameter</strong>.</p>
</li>
<li>
<p>Enter the following information for each new parameter:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Host parameters</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ansible_tower_provisioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables Provisioning Callback.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ansible_tower_api_url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="https://awx.example.com/api/controller/v2" class="bare">https://awx.example.com/api/controller/v2</a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the URL of your AWX, including the required API path.
For older versions of AWX, use <code>/api/v2</code> instead of <code>/api/controller/v2</code>.
If unsure, check the API endpoints of your instance to verify the correct path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ansible_job_template_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>template_ID</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of your provisioning template that you can find in the URL of the template: <code>/templates/job_template/<em>5</em></code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ansible_host_config_key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>config_KEY</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host configuration key that your job template generates in AWX.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Create a host using the host group.</p>
</li>
<li>
<p>On your new host, start the <code>ansible-callback</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start ansible-callback</pre>
</div>
</div>
</li>
<li>
<p>On your new host, check the the status of the <code>ansible-callback</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl status ansible-callback</pre>
</div>
</div>
<div class="paragraph">
<p>Provisioning callback is configured correctly if the command returns the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none">foreman.example.com systemd[1]: Started Provisioning callback to AWX...</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Manual provisioning callback</div>
<ul>
<li>
<p>You can use the provisioning callback URL and the host configuration key from a host to call AWX:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl \
--data curl \
--data host_config_key=<em>My_Host_Config_Key</em> \
--insecure \
--show-error \
--silent \
https://<em>awx.example.com</em>/api/v2/job_templates/<em>8</em>/callback/</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that you use <code>https</code> when you enter the provisioning callback URL.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This triggers the playbook run specified in the template against the host.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Job_Template_Examples_and_Extensions_ansible"><a class="anchor" href="#Job_Template_Examples_and_Extensions_ansible"></a>6. Job template examples and extensions</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Use this section as a reference to help modify, customize, and extend your job templates to suit your requirements.</p>
</div>
<div class="sect2">
<h3 id="Customizing_Job_Templates_ansible"><a class="anchor" href="#Customizing_Job_Templates_ansible"></a>6.1. Customizing job templates</h3>
<div class="paragraph _abstract">
<p>When creating a job template, you can include an existing template in the template editor field.
This way you can combine templates, or create more specific templates from the general ones.</p>
</div>
<div class="paragraph">
<p>The following template combines default templates to install and start the <strong>nginx</strong> service on clients:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">&lt;%= render_template 'Package Action - SSH Default', :action =&gt; 'install', :package =&gt; 'nginx' %&gt;
&lt;%= render_template 'Service Action - SSH Default', :action =&gt; 'start', :service_name =&gt; 'nginx' %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above template specifies parameter values for the rendered template directly.
It is also possible to use the <strong>input()</strong> method to allow users to define input for the rendered template on job execution.
For example, you can use the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">&lt;%= render_template 'Package Action - SSH Default', :action =&gt; 'install', :package =&gt; input("package") %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above template, you have to import the parameter definition from the rendered template.
To do so, navigate to the <strong>Jobs</strong> tab, click <strong>Add Foreign Input Set</strong>, and select the rendered template from the <strong>Target template</strong> list.
You can import all parameters or specify a comma separated list.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-job-template-to-restore-selinux-context"><a class="anchor" href="#creating-a-job-template-to-restore-selinux-context"></a>6.2. Creating a job template to restore SELinux context</h3>
<div class="paragraph _abstract">
<p>This example shows how to create a template called <strong>Run Command - restorecon</strong> that restores the default <strong>SELinux</strong> context for all files in the selected directory on target hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Job templates</strong>.</p>
</li>
<li>
<p>Click <strong>New Job Template</strong>.</p>
</li>
<li>
<p>Enter <strong>Run Command - restorecon</strong> in the <strong>Name</strong> field.
Select <strong>Default</strong> to make the template available to all organizations.
Add the following text to the template editor:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">restorecon -RvF &lt;%= input("directory") %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;%= input("directory") %&gt;</code> string is replaced by a user-defined directory during job invocation.</p>
</div>
</li>
<li>
<p>On the <strong>Job</strong> tab, set <strong>Job category</strong> to <code>Commands</code>.</p>
</li>
<li>
<p>Click <strong>Add Input</strong> to allow job customization.
Enter <code>directory</code> to the <strong>Name</strong> field.
The input name must match the value specified in the template editor.</p>
</li>
<li>
<p>Click <strong>Required</strong> so that the command cannot be executed without the user specified parameter.</p>
</li>
<li>
<p>Select <strong>User input</strong> from the <strong>Input type</strong> list.
Enter a description to be shown during job invocation, for example <code>Target directory for restorecon</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.
For more information, see <a href="#Executing_a_restorecon_Template_on_Multiple_Hosts_ansible">Executing a restorecon template on multiple hosts</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Rendering_a_restorecon_Template_ansible"><a class="anchor" href="#Rendering_a_restorecon_Template_ansible"></a>6.3. Rendering a restorecon template</h3>
<div class="paragraph _abstract">
<p>This example shows how to create a template derived from the <strong>Run command - restorecon</strong> template created in <a href="#creating-a-job-template-to-restore-selinux-context">Creating a job template to restore SELinux context</a>.</p>
</div>
<div class="paragraph">
<p>This template does not require user input on job execution, it will restore the SELinux context in all files under the <code>/home/</code> directory on target hosts.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a new template as described in <a href="#customizing-job-templates">Customizing job templates</a>, and specify the following string in the template editor:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">&lt;%= render_template("Run Command - restorecon", :directory =&gt; "/home") %&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Executing_a_restorecon_Template_on_Multiple_Hosts_ansible"><a class="anchor" href="#Executing_a_restorecon_Template_on_Multiple_Hosts_ansible"></a>6.4. Executing a restorecon template on multiple hosts</h3>
<div class="paragraph _abstract">
<p>This example shows how to run a job based on the template created in <a href="#creating-a-job-template-to-restore-selinux-context">Creating a job template to restore SELinux context</a> on multiple hosts.
The job restores the SELinux context in all files under the <code>/home/</code> directory.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Monitor</strong> &gt; <strong>Jobs</strong> and click <strong>Run job</strong>.</p>
</li>
<li>
<p>Select <strong>Commands</strong> as <strong>Job category</strong> and <strong>Run Command &#8211; restorecon</strong> as <strong>Job template</strong> and click <strong>Next</strong>.</p>
</li>
<li>
<p>Select the hosts on which you want to run the job.
If you do not select any hosts, the job will run on all hosts you can see in the current context.</p>
</li>
<li>
<p>In the <strong>directory</strong> field, provide a directory, for example <code>/home</code>, and click <strong>Next</strong>.</p>
</li>
<li>
<p>Optional: To configure advanced settings for the job, fill in the <strong>Advanced fields</strong>.
To learn more about advanced settings, see <a href="#advanced-settings-in-the-job-wizard_ansible">Advanced settings in the job wizard</a>.
When you are done entering the advanced settings or if it is not required, click <strong>Next</strong>.</p>
</li>
<li>
<p>Schedule time for the job.</p>
<div class="ulist">
<ul>
<li>
<p>To execute the job immediately, keep the pre-selected <strong>Immediate execution</strong>.</p>
</li>
<li>
<p>To execute the job in future time, select <strong>Future execution</strong>.</p>
</li>
<li>
<p>To execute the job on regular basis, select <strong>Recurring execution</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: If you selected future or recurring execution, select the <strong>Query type</strong>, otherwise click <strong>Next</strong>.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Static query</strong> means that the job executes on the exact list of hosts that you provided.</p>
</li>
<li>
<p><strong>Dynamic query</strong> means that the list of hosts is evaluated just before the job is executed.
If you entered the list of hosts based on some filter, the results can be different from when you first used that filter.</p>
<div class="paragraph">
<p>Click <strong>Next</strong> after you have selected the query type.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: If you selected future or recurring execution, provide additional details:</p>
<div class="ulist">
<ul>
<li>
<p>For <strong>Future execution</strong>, enter the <strong>Starts at</strong> date and time.
You also have the option to select the <strong>Starts before</strong> date and time.
If the job cannot start before that time, it will be canceled.</p>
</li>
<li>
<p>For <strong>Recurring execution</strong>, select the start date and time, frequency, and condition for ending the recurring job.
You can choose the recurrence to never end, end at a certain time, or end after a given number of repetitions.
You can also add <strong>Purpose</strong> - a special label for tracking the job.
There can only be one active job with a given purpose at a time.</p>
<div class="paragraph">
<p>Click <strong>Next</strong> after you have entered the required information.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Review job details.
You have the option to return to any part of the job wizard and edit the information.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to schedule the job for execution.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Including_Power_Actions_in_Templates_ansible"><a class="anchor" href="#Including_Power_Actions_in_Templates_ansible"></a>6.5. Including power actions in templates</h3>
<div class="paragraph _abstract">
<p>This example shows how to set up a job template for performing power actions, such as reboot.
This procedure prevents Foreman from interpreting the disconnect exception upon reboot as an error, and consequently, remote execution of the job works correctly.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a new template as described in <a href="#customizing-job-templates">Customizing job templates</a>, and specify the following string in the template editor:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">&lt;%= render_template("Power Action - SSH Default", :action =&gt; "restart") %&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Host_Parameter_Hierarchy_ansible"><a class="anchor" href="#Host_Parameter_Hierarchy_ansible"></a>Appendix A: Host parameter hierarchy</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>You can access host parameters when provisioning hosts.</p>
</div>
<div class="paragraph">
<p>Hosts inherit their parameters from the following locations, in order of increasing precedence:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter Level</th>
<th class="tableblock halign-left valign-top">Set in Foreman web UI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Globally defined parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Configure</strong> &gt; <strong>Global parameters</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Administer</strong> &gt; <strong>Organizations</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Administer</strong> &gt; <strong>Locations</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Infrastructure</strong> &gt; <strong>Domains</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subnet-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Infrastructure</strong> &gt; <strong>Subnets</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating system-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host group-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Configure</strong> &gt; <strong>Host Groups</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts</strong> &gt; <strong>All Hosts</strong></p></td>
</tr>
</tbody>
</table>
<!-- "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License -->
<!-- https://github.com/simonwhitaker/github-fork-ribbon-css -->
<a class="issue-ribbon right-bottom fixed" href="https://github.com/theforeman/foreman-documentation/issues/new?template=report-issue.md" data-ribbon="Report issue" title="Report issue">
Report issue
</a>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.16<br>
Last updated Oct 2025
</div>
</div>
<script>
;(function () { /*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
  'use strict'

  var config = (document.currentScript || {}).dataset || {}
  var forEach = Array.prototype.forEach

  init(document.querySelectorAll('.tabs'))

  function init (tabsBlocks) {
    if (!tabsBlocks.length) return
    forEach.call(tabsBlocks, function (tabs) {
      var syncIds = tabs.classList.contains('is-sync') ? {} : undefined
      var tablist = tabs.querySelector('.tablist ul')
      tablist.setAttribute('role', 'tablist')
      var start
      forEach.call(tablist.querySelectorAll('li'), function (tab, idx) {
        tab.tabIndex = -1
        tab.setAttribute('role', tab.classList.add('tab') || 'tab')
        var id, anchor, syncId
        if (!(id = tab.id) && (anchor = tab.querySelector('a[id]'))) {
          id = tab.id = anchor.parentNode.removeChild(anchor).id
        }
        var panel = id && tabs.querySelector('.tabpanel[aria-labelledby~="' + id + '"]')
        if (!panel) return idx ? undefined : toggleSelected(tab, true) // invalid state
        syncIds && (((syncId = tab.textContent.trim()) in syncIds) ? (syncId = undefined) : true) &&
          (syncIds[(tab.dataset.syncId = syncId)] = tab)
        idx || (syncIds && (start = { tab: tab, panel: panel })) ? toggleHidden(panel, true) : toggleSelected(tab, true)
        tab.setAttribute('aria-controls', panel.id)
        panel.setAttribute('role', 'tabpanel')
        var onClick = syncId === undefined ? activateTab : activateTabSync
        tab.addEventListener('click', onClick.bind({ tabs: tabs, tab: tab, panel: panel }))
      })
      if (!tabs.closest('.tabpanel')) {
        forEach.call(tabs.querySelectorAll('.tabpanel table.tableblock'), function (table) {
          var container = Object.assign(document.createElement('div'), { className: 'tablecontainer' })
          table.parentNode.insertBefore(container, table).appendChild(table)
        })
      }
      if (start) {
        var syncGroupId
        for (var i = 0, lst = tabs.classList, len = lst.length, className; i !== len; i++) {
          if (!(className = lst.item(i)).startsWith('data-sync-group-id=')) continue
          tabs.dataset.syncGroupId = syncGroupId = lst.remove(className) || className.slice(19).replace(/\u00a0/g, ' ')
          break
        }
        if (syncGroupId === undefined) tabs.dataset.syncGroupId = syncGroupId = Object.keys(syncIds).sort().join('|')
        var preferredSyncId = 'syncStorageKey' in config &&
          window[(config.syncStorageScope || 'local') + 'Storage'].getItem(config.syncStorageKey + '-' + syncGroupId)
        var tab = preferredSyncId && syncIds[preferredSyncId]
        tab && Object.assign(start, { tab: tab, panel: document.getElementById(tab.getAttribute('aria-controls')) })
        toggleSelected(start.tab, true) || toggleHidden(start.panel, false)
      }
    })
    onHashChange()
    toggleClassOnEach(tabsBlocks, 'is-loading', 'remove')
    window.setTimeout(toggleClassOnEach.bind(null, tabsBlocks, 'is-loaded', 'add'), 0)
    window.addEventListener('hashchange', onHashChange)
  }

  function activateTab (e) {
    var tab = this.tab
    var tabs = this.tabs || (this.tabs = tab.closest('.tabs'))
    var panel = this.panel || (this.panel = document.getElementById(tab.getAttribute('aria-controls')))
    querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (el) {
      toggleSelected(el, el === tab)
    })
    querySelectorWithSiblings(tabs, '.tabpanel', 'tabpanel').forEach(function (el) {
      toggleHidden(el, el !== panel)
    })
    if (!this.isSync && 'syncStorageKey' in config && 'syncGroupId' in tabs.dataset) {
      var storageKey = config.syncStorageKey + '-' + tabs.dataset.syncGroupId
      window[(config.syncStorageScope || 'local') + 'Storage'].setItem(storageKey, tab.dataset.syncId)
    }
    if (!e) return
    var loc = window.location
    var hashIdx = loc.hash ? loc.href.indexOf('#') : -1
    if (~hashIdx) window.history.replaceState(null, '', loc.href.slice(0, hashIdx))
    e.preventDefault()
  }

  function activateTabSync (e) {
    activateTab.call(this, e)
    var thisTabs = this.tabs
    var thisTab = this.tab
    var initialY = thisTabs.getBoundingClientRect().y
    forEach.call(document.querySelectorAll('.tabs'), function (tabs) {
      if (tabs === thisTabs || tabs.dataset.syncGroupId !== thisTabs.dataset.syncGroupId) return
      querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (tab) {
        if (tab.dataset.syncId === thisTab.dataset.syncId) activateTab.call({ tabs: tabs, tab: tab, isSync: true })
      })
    })
    var shiftedBy = thisTabs.getBoundingClientRect().y - initialY
    if (shiftedBy && (shiftedBy = Math.round(shiftedBy))) window.scrollBy({ top: shiftedBy, behavior: 'instant' })
  }

  function querySelectorWithSiblings (scope, selector, siblingClass) {
    var el = scope.querySelector(selector)
    if (!el) return []
    var result = [el]
    while ((el = el.nextElementSibling) && el.classList.contains(siblingClass)) result.push(el)
    return result
  }

  function toggleClassOnEach (elements, className, method) {
    forEach.call(elements, function (el) {
      el.classList[method](className)
    })
  }

  function toggleHidden (el, state) {
    el.classList[(el.hidden = state) ? 'add' : 'remove']('is-hidden')
  }

  function toggleSelected (el, state) {
    el.setAttribute('aria-selected', '' + state)
    el.classList[state ? 'add' : 'remove']('is-selected')
    el.tabIndex = state ? 0 : -1
  }

  function onHashChange () {
    var id = window.location.hash.slice(1)
    if (!id) return
    var tab = document.getElementById(~id.indexOf('%') ? decodeURIComponent(id) : id)
    if (!(tab && tab.classList.contains('tab'))) return
    'syncId' in tab.dataset ? activateTabSync.call({ tab: tab }) : activateTab.call({ tab: tab })
  }
})()
</script>
</body>
</html>