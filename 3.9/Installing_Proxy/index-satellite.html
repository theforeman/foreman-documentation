<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Installing Capsule Server</title>
<style>
﻿*,::before,::after{box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:100%}body{background:#fff;color:rgba(0,0,0,0.8);padding:0;margin:0;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:inherit;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,p,blockquote,th,td{margin:0;padding:0}a{background:none;color:#2156a5;text-decoration:underline;line-height:inherit}a:active,a:hover{cursor:pointer;outline:0}a:focus{outline:thin dotted}a:hover,a:focus{color:#1d4b8f}abbr{font-size:0.9em}abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}b,strong{font-weight:bold;line-height:inherit}strong strong{font-weight:400}code,kbd,pre{font-family:"Droid Sans Mono", "DejaVu Sans Mono", monospace;font-size:1em}code{font-weight:400;color:rgba(0,0,0,0.9)}pre{color:rgba(0,0,0,0.9);line-height:1.45;text-rendering:optimizeSpeed;white-space:pre-wrap}dfn{font-style:italic}em,i{font-style:italic;line-height:inherit}em em{font-style:normal}hr{border:solid #dddddf;border-width:1px 0 0;clear:both;height:0;margin:1.25em 0 1.1875em}mark{background:#ff0;color:#000}p{line-height:1.6;margin-bottom:1.25rem;text-rendering:optimizeLegibility}q{quotes:"“" "”" "‘" "’"}small{font-size:60%;line-height:inherit}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img,object[type^="image/"],svg{display:inline-block;height:auto;max-width:100%;vertical-align:middle}img{border:0;-ms-interpolation-mode:bicubic}object{max-width:100%}svg:not(:root){overflow:hidden}figure{margin:0}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}.left{float:left !important}.right{float:right !important}.text-left{text-align:left !important}.text-right{text-align:right !important}.text-center{text-align:center !important}.text-justify{text-align:justify !important}.hide{display:none}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:0.25em}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.2;word-spacing:-0.05em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em;margin-left:1.125em}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,0.85)}@media screen and (min-width: 768px){h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;border:1px solid #dedede;border-collapse:collapse;border-spacing:0;margin-bottom:1.25em;word-wrap:normal}table thead,table tfoot{background:#f7f8f7}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,0.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,0.8)}table tr.even,table tr.alt{background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.center{margin-left:auto;margin-right:auto}.stretch{width:100%}.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:"";display:table}.clearfix::after,.float-group::after{clear:both}:not(pre).nobreak{word-wrap:normal}:not(pre).nowrap{white-space:nowrap}:not(pre).pre-wrap{white-space:pre-wrap}:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal !important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}pre>code{display:block}pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}.keyseq{color:rgba(51,51,51,0.8)}kbd{display:inline-block;color:rgba(0,0,0,0.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,0.2),inset 0 0 0 0.1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menuref{color:#000}.menuseq b:not(.caret),.menuref{font-weight:inherit}.menuseq{word-spacing:-0.02em}.menuseq b.caret{font-size:1.25em;line-height:0.8}.menuseq i.caret{font-weight:bold;text-align:center;width:0.45em}b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}b.button::before{content:"[";padding:0 3px 0 2px}b.button::after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,0.9)}body>div[id]{margin:0 auto;max-width:62.5em;position:relative;padding-left:.9375em;padding-right:0.9375em}body>div[id]::before,body>div[id]::after,#content #footnotes::before{content:"";display:table;clear:both}#content{margin-top:1.25em;margin-bottom:0.625em}#content::before{content:none}#header>h1:first-child{color:rgba(0,0,0,0.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,0.6);display:flex;flex-flow:row wrap}#header .details span:first-child{margin-left:-0.125em}#header .details span.email a{color:rgba(0,0,0,0.85)}#header .details br{display:none}#header .details br+span::before{content:" – "}#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,0.85)}#header .details br+span#revremark::before{content:" | "}#header #revnumber{text-transform:capitalize}#header #revnumber::after{content:" "}#content>h1:first-child:not([class]){color:rgba(0,0,0,0.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #e7e7e9;padding-bottom:0.5em}#toc>ul{margin-left:0.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:0.5em 0}#toc ul{font-family:"Open Sans", "DejaVu Sans", sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:0.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media screen and (min-width: 768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0 !important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0 !important;border-bottom-width:0 !important;z-index:1000;padding:1.25em 1em;height:calc(100% - (70px + 2.5em));overflow:auto}#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:0.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}@media screen and (min-width: 1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:0.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:none;background:#025d8c;padding:1.25em;margin-left:2em}#footer-text{color:rgba(255,255,255,0.8);line-height:1.44}.sect1{padding-bottom:0.625em}@media screen and (min-width: 768px){#content{margin-bottom:1.25em}.sect1{padding-bottom:1.25em}}.sect1:last-child{padding-bottom:0}.sect1+.sect1{border-top:1px solid #e7e7e9}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none !important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:0.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}details{margin-left:1.25rem}details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}details>summary::-webkit-details-marker{display:none}details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:1rem;font-style:italic}table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,0.85)}.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans", "DejaVu Sans", sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,0.6);word-wrap:anywhere}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#fffef7;border-radius:4px;box-shadow:0 1px 4px #e0e0dc}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:0.8125em}@media screen and (min-width: 768px){.literalblock pre,.listingblock>.content>pre{font-size:0.90625em}}@media screen and (min-width: 1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,0.9)}.listingblock>.content{position:relative}.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:0.5}.listingblock:hover code[data-lang]::before{display:block}.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:0.5}.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.prettyprint{background:#f7f7f8}pre.prettyprint .linenums{line-height:1.45;margin-left:2em}pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}pre.prettyprint li code[data-lang]::before{opacity:1}pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}table.linenotable td.code{padding-left:0.75em}table.linenotable td.linenos{width:0.01%}table.linenotable td.linenos,pre.pygments .linenos,pre.rouge .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}pre.pygments span.linenos,pre.rouge span.linenos{display:inline-block;margin-right:0.75em}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:0.75em}.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,0.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,0.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}.verseblock{margin:0 1em 1.25em}.verseblock pre{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-size:1.15rem;color:rgba(0,0,0,0.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:0.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,0.6)}.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}.quoteblock.abstract{margin:0 1em 1.25em;display:block}.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:0.25em solid #dddddf}.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}p.tableblock:last-child{margin-bottom:0}td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}td.tableblock>.content>:last-child{margin-bottom:-1.25em}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all>*>tr>*{border-width:1px}table.grid-cols>*>tr>*{border-width:0 1px}table.grid-rows>*>tr>*{border-width:1px 0}table.frame-all{border-width:1px}table.frame-ends{border-width:1px 0}table.frame-sides{border-width:0 1px}table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,0.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:0.625em}ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:0.625em}ul.unstyled,ol.unstyled{margin-left:0}li>p:empty:only-child::before{content:"";display:inline-block}ul.checklist>li>p:first-child{margin-left:-1em}ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:0.125em}ul.checklist>li>p:first-child>input[type=checkbox]:first-child{font:inherit;margin:0 .25em 0 0;padding:0}ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 0.625em -1.25em}ul.inline>li{margin-left:1.25em}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{vertical-align:top;padding:0 0.625em}td.hdlist1{font-weight:bold;padding-bottom:1.25em}td.hdlist2{word-wrap:anywhere}.literalblock+.colist,.listingblock+.colist{margin-top:-0.5em}.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}.colist td:not([class]):first-child img{max-width:none}.colist td:not([class]):last-child{padding:0.25em 0}.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}.imageblock.left{margin:0.25em 0.625em 1.25em 0}.imageblock.right{margin:0.25em 0 1.25em 0.625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 0.125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:0.625em}.image.right{margin-left:0.625em}a.image{text-decoration:none;display:inline-block}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:0.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:0.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:0.75em 0}div.page-break{display:none}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background:#00fafa}.black{color:#000}.black-background{background:#000}.blue{color:#0000bf}.blue-background{background:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background:#fa00fa}.gray{color:#606060}.gray-background{background:#7d7d7d}.green{color:#006000}.green-background{background:#007d00}.lime{color:#00bf00}.lime-background{background:#00fa00}.maroon{color:#600000}.maroon-background{background:#7d0000}.navy{color:#000060}.navy-background{background:#00007d}.olive{color:#606000}.olive-background{background:#7d7d00}.purple{color:#600060}.purple-background{background:#7d007d}.red{color:#bf0000}.red-background{background:#fa0000}.silver{color:#909090}.silver-background{background:#bcbcbc}.teal{color:#006060}.teal-background{background:#007d7d}.white{color:#bfbfbf}.white-background{background:#fafafa}.yellow{color:#bfbf00}.yellow-background{background:#fafa00}span.icon>.fa{cursor:default}a span.icon>.fa{cursor:inherit}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,0.5);cursor:default}.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,0.8);color:#111}.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff !important;background:rgba(0,0,0,0.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans", "DejaVu Sans", sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff !important}.conum[data-value]+b{display:none}.conum[data-value]::after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-0.125em}b.conum *{color:inherit !important}.conum:not([data-value]):empty{display:none}dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}h1,h2,p,td.content,span.alt,summary{letter-spacing:-0.01em}p strong,td.content strong,div.footnote strong{letter-spacing:-0.005em}p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.print-only{display:none !important}@page{margin:1.25cm 0.75cm}@media print{*{box-shadow:none !important;text-shadow:none !important}html{font-size:80%}a{color:inherit !important;text-decoration:underline !important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none !important}a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:0.25em}abbr[title]{border-bottom:1px dotted}abbr[title]::after{content:" (" attr(title) ")"}pre,blockquote,tr,img,object,svg{page-break-inside:avoid}thead{display:table-header-group}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}body>div[id]{max-width:none}#toc,.sidebarblock,.exampleblock>.content{background:none !important}#toc{border-bottom:1px solid #dddddf !important;padding-bottom:0 !important}body.book #header{text-align:center}body.book #header>h1:first-child{border:0 !important;margin:2.5em 0 1em}body.book #header .details{border:0 !important;display:block;padding:0 !important}body.book #header .details span:first-child{margin-left:0 !important}body.book #header .details br{display:block}body.book #header .details br+span::before{content:none !important}body.book #toc{border:0 !important;text-align:left !important;padding:0 !important;margin:0 !important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]::before{display:block}div.page-break{display:block;page-break-after:always}#footer{padding:0 0.9375em}.hide-on-print{display:none !important}.print-only{display:block !important}.hide-for-print{display:none !important}.show-for-print{display:inherit !important}}@media amzn-kf8, print{#header>h1:first-child{margin-top:1.25rem}.sect1{padding:0 !important}.sect1+.sect1{border:0}#footer{background:none}#footer-text{color:rgba(0,0,0,0.6);font-size:0.9em}}@media amzn-kf8{body>div[id]{padding:0}}body{padding:0;margin:0;margin-top:70px !important}.container{position:relative;z-index:1;padding-top:50px;min-height:100%}.container p{font-family:sans-serif;font-size:1.2em}nav{position:fixed;z-index:9999;left:0;right:0;top:0;height:70px;padding:0 1.5em;background-color:#025d8c;font-family:sans-serif;line-height:70px}nav .logo{width:50px;vertical-align:middle}nav .nav-menu{position:absolute;right:0.3em;top:0;padding:0;margin:0;list-style:none}nav .nav-item{display:inline-block}nav .nav-item>a{display:inline-block;padding:0 2.5em;line-height:70px;color:#fff;text-decoration:none}nav .dropdown{position:relative}nav .dropdown a::after{content:"";display:inline-block;margin-left:0.5em;vertical-align:middle;border-top:0.3em solid #fff;border-right:0.3em solid transparent;border-left:0.3em solid transparent}nav .dropdown.show a::after{transform:rotate(180deg)}nav .dropdown-menu{display:none;position:absolute;left:0;right:0;top:100%;padding:0.5em 0;margin-top:-0.5em;border:1px solid rgba(0,0,0,0.3);border-radius:0.5em;background-color:#fff;width:max-content}nav .dropdown-menu-left{left:auto;right:0}nav .dropdown.show .dropdown-menu{display:block}nav .dropdown-div{display:block;padding:0.4em 0;line-height:4em}nav .dropdown-div a::after{content:none;margin-left:0;border-top:0;border-right:0;border-left:0}nav .dropdown-item{display:block;padding:0 1.5em;font-size:0.875em;color:#000;line-height:1.6em;text-decoration:none}nav .btn-hamburger{display:none;position:absolute;right:1.5em;top:50%;background-color:transparent;border:0;cursor:pointer;outline:none;transform:translateY(-50%)}nav .btn-hamburger span{display:block;width:30px;height:4px;background-color:#fff;margin:6px;border-radius:2px;transition:0.3s ease-in-out}nav .btn-hamburger span:nth-child(4),nav .btn-hamburger span:nth-child(5){position:absolute;top:10px;opacity:0.5}nav .btn-hamburger span:nth-child(4){transform:rotate(45deg) scale(0)}nav .btn-hamburger span:nth-child(5){transform:rotate(-45deg) scale(0)}nav.opened .btn-hamburger span:nth-child(4){opacity:1;transform:rotate(45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(5){opacity:1;transform:rotate(-45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(1),nav.opened .btn-hamburger span:nth-child(2),nav.opened .btn-hamburger span:nth-child(3){opacity:0}@media screen and (max-width: 768px){nav .nav-menu{position:fixed;left:0;right:0;top:70px;bottom:100%;display:flex;flex-direction:column;justify-content:start;background-color:#363d4e;transition:bottom 0.5s ease-in-out;overflow:hidden}nav.opened .nav-menu{bottom:0}nav .nav-item>a{display:block}nav .dropdown-menu{position:relative;top:0;margin:0 1.5em}nav .btn-hamburger{display:block}}/*!
* "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License
* https://github.com/simonwhitaker/github-fork-ribbon-css

The MIT License (MIT)

Copyright (c) 2013 Simon Whitaker

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/.github-fork-ribbon,.release-ribbon,.issue-ribbon{width:12.1em;height:12.1em;position:absolute;overflow:hidden;top:70px;right:0;z-index:9998;pointer-events:none;font-size:13px;text-decoration:none;text-indent:-999999px}.github-fork-ribbon.fixed,.fixed.release-ribbon,.fixed.issue-ribbon{position:fixed}.github-fork-ribbon:hover,.release-ribbon:hover,.issue-ribbon:hover,.github-fork-ribbon:active,.release-ribbon:active,.issue-ribbon:active{background-color:transparent}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before,.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{position:absolute;display:block;width:15.38em;height:1.54em;top:3.23em;right:-3.23em;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before{content:"";padding:.38em 0;background-color:#a00;background-image:-webkit-gradient(linear, left top, left bottom, from(transparent), to(rgba(0,0,0,0.15)));background-image:-webkit-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-moz-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-ms-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-o-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:linear-gradient(to bottom, transparent, rgba(0,0,0,0.15));-webkit-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);-moz-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);pointer-events:auto}.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{content:attr(data-ribbon);color:#fff;font:700 1em "Helvetica Neue", Helvetica, Arial, sans-serif;line-height:1.54em;text-decoration:none;text-shadow:0 -0.08em rgba(0,0,0,0.5);text-align:center;text-indent:0;padding:.15em 0;margin:.15em 0;border-width:.08em 0;border-style:dotted;border-color:#fff;border-color:rgba(255,255,255,0.7)}.github-fork-ribbon.left-top,.left-top.release-ribbon,.left-top.issue-ribbon,.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon{right:auto;left:0}.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon,.github-fork-ribbon.right-bottom,.right-bottom.release-ribbon,.right-bottom.issue-ribbon{top:auto;bottom:0}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after{right:auto;left:-3.23em}.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{top:auto;bottom:3.23em}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}.release-ribbon:before{background-color:#a00}.issue-ribbon:before{background-color:#025d8c}@media screen{div.narrow{max-width:1080px;margin:0 auto !important;margin-top:70px auto !important;float:none !important}#toc.toc2{margin-top:70px !important}}

</style>
<!-- docinfo -->
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Installing Capsule Server</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#providing-feedback-on-red-hat-documentation_capsule">Providing feedback on Red Hat documentation</a></li>
<li><a href="#preparing-environment-for-capsule-installation">1. Preparing your environment for installation</a>
<ul class="sectlevel2">
<li><a href="#system-requirements_capsule">1.1. System requirements</a></li>
<li><a href="#capsule-storage-requirements_capsule">1.2. Storage requirements</a></li>
<li><a href="#storage-guidelines_capsule">1.3. Storage guidelines</a></li>
<li><a href="#supported-operating-systems_capsule">1.4. Supported operating systems</a></li>
<li><a href="#capsule-port-and-firewall-requirements_capsule">1.5. Port and firewall requirements</a></li>
<li><a href="#enabling-connections-to-capsule_capsule">1.6. Enabling connections from Satellite&#160;Server and clients to a Capsule&#160;Server</a></li>
</ul>
</li>
<li><a href="#installing-capsule-server">2. Installing Capsule&#160;Server</a>
<ul class="sectlevel2">
<li><a href="#Registering_Proxy_to_Server_capsule">2.1. Registering to Satellite&#160;Server</a></li>
<li><a href="#configuring-repositories-proxy_capsule">2.2. Configuring repositories</a></li>
<li><a href="#using-fapolicyd-on-server_capsule">2.3. Optional: Using fapolicyd on Capsule&#160;Server</a></li>
<li><a href="#Installing_Proxy_Packages_capsule">2.4. Installing Capsule&#160;Server packages</a></li>
<li><a href="#configuring-capsule-server-with-ssl-certificates">2.5. Configuring Capsule&#160;Server with SSL certificates</a></li>
<li><a href="#assigning-organization-location-capsule-server_capsule">2.6. Assigning the correct organization and location to Capsule&#160;Server in the Satellite web UI</a></li>
</ul>
</li>
<li><a href="#performing-additional-configuration-on-capsule-server_capsule">3. Performing additional configuration on Capsule&#160;Server</a>
<ul class="sectlevel2">
<li><a href="#configuring-capsule-for-host-registration-and-provisioning_capsule">3.1. Configuring Capsule for host registration and provisioning</a></li>
<li><a href="#configuring-pull-based-transport-for-remote-execution_capsule">3.2. Configuring pull-based transport for remote execution</a></li>
<li><a href="#Enabling_OpenSCAP_on_capsule_Servers_capsule">3.3. Enabling OpenSCAP on Capsule&#160;Servers</a></li>
<li><a href="#Adding_Lifecycle_Environments_capsule">3.4. Adding lifecycle environments to Capsule&#160;Servers</a></li>
<li><a href="#enabling-power-management-on-hosts_capsule">3.5. Enabling power management on hosts</a></li>
<li><a href="#configuring-dns-dhcp-and-tftp-on-productname_capsule">3.6. Configuring DNS, DHCP, and TFTP on Capsule&#160;Server</a></li>
</ul>
</li>
<li><a href="#configuring-external-services">4. Configuring Capsule&#160;Server with external services</a>
<ul class="sectlevel2">
<li><a href="#configuring-external-dns_capsule">4.1. Configuring Capsule&#160;Server with external DNS</a></li>
<li><a href="#configuring-external-dhcp_capsule">4.2. Configuring Capsule&#160;Server with external DHCP</a></li>
<li><a href="#configuring-external-tftp_capsule">4.3. Configuring Capsule&#160;Server with external TFTP</a></li>
<li><a href="#configuring-external-idm-dns_capsule">4.4. Configuring Capsule&#160;Server with external IdM DNS</a></li>
</ul>
</li>
<li><a href="#Managing_DHCP_Using_Smart_Proxy_capsule">5. Managing DHCP using Capsule</a>
<ul class="sectlevel2">
<li><a href="#Securing_the_dhcpd_API_capsule">5.1. Securing the dhcpd API</a></li>
</ul>
</li>
<li><a href="#Managing_DNS_Using_Smart_Proxy_capsule">6. Managing DNS using Capsule</a></li>
<li><a href="#capsule-server-scalability-considerations_capsule">Appendix A: Capsule&#160;Server scalability considerations</a></li>
<li><a href="#troubleshooting-dnf-modules_capsule">Appendix B: Troubleshooting DNF modules</a>
<ul class="sectlevel2">
<li><a href="#Troubleshooting_Ruby_capsule">Ruby</a></li>
<li><a href="#Troubleshooting_Postgresql_capsule">PostgreSQL</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="providing-feedback-on-red-hat-documentation_capsule"><a class="anchor" href="#providing-feedback-on-red-hat-documentation_capsule"></a>Providing feedback on Red Hat documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We appreciate your feedback on our documentation.
Let us know how we can improve it.</p>
</div>
<div class="paragraph">
<p>Use the <strong>Create Issue</strong> form in Red Hat Jira to provide your feedback.
The Jira issue is created in the Red Hat Satellite Jira project, where you can track its progress.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure you have registered a <a href="https://access.redhat.com/">Red Hat account</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click the following link: <a href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12324223&amp;summary=Documentation%20feedback:%20%3CAdd%20summary%20here%3E&amp;issuetype=1&amp;components=12347630&amp;priority=10300"><strong>Create Issue</strong></a>.
If Jira displays a login error, log in and proceed after you are redirected to the form.</p>
</li>
<li>
<p>Complete the <strong>Summary</strong> and <strong>Description</strong> fields.
In the <strong>Description</strong> field, include the documentation URL, chapter or section number, and a detailed description of the issue.
Do not modify any other fields in the form.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-environment-for-capsule-installation"><a class="anchor" href="#preparing-environment-for-capsule-installation"></a>1. Preparing your environment for installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="system-requirements_capsule"><a class="anchor" href="#system-requirements_capsule"></a>1.1. System requirements</h3>
<div class="paragraph">
<p>The following requirements apply to the networked base operating system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>x86_64 architecture</p>
</li>
<li>
<p>The latest version of Red&#160;Hat Enterprise Linux 8</p>
</li>
<li>
<p>4-core 2.0 GHz CPU at a minimum</p>
</li>
<li>
<p>A minimum of 12 GB RAM is required for Capsule&#160;Server to function.
In addition, a minimum of 4 GB RAM of swap space is also recommended.
Capsule running with less RAM than the minimum value might not operate correctly.</p>
</li>
<li>
<p>A unique host name, which can contain lower-case letters, numbers, dots (.) and hyphens (-)</p>
</li>
<li>
<p>A current Red&#160;Hat Satellite subscription</p>
</li>
<li>
<p>Administrative user (root) access</p>
</li>
<li>
<p>Full forward and reverse DNS resolution using a fully-qualified domain name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Satellite only supports <code>UTF-8</code> encoding.
If your territory is USA and your language is English, set <code>en_US.utf-8</code> as the system-wide locale settings.
For more information about configuring system locale in Red&#160;Hat Enterprise Linux, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/assembly_changing-basic-environment-settings_configuring-basic-system-settings#proc_configuring-the-system-locale_assembly_changing-basic-environment-settings">Configuring System Locale guide</a>.</p>
</div>
<div class="paragraph">
<p>Your Satellite must have the Red Hat Satellite Infrastructure Subscription manifest in your Customer Portal.
Satellite must have satellite-capsule-6.x repository enabled and synced.
To create, manage, and export a Red&#160;Hat Subscription Manifest in the Customer Portal, see <a href="https://access.redhat.com/documentation/en-us/subscription_central/2023/html/creating_and_managing_manifests_for_a_connected_satellite_server/index">Creating and managing manifests for a connected Satellite&#160;Server</a> in <em>Subscription Central</em>.</p>
</div>
<div class="paragraph">
<p>Satellite&#160;Server and Capsule&#160;Server do not support shortnames in the hostnames.
When using custom certificates, the Common Name (CN) of the custom certificate must be a fully qualified domain name (FQDN) instead of a shortname.
This does not apply to the clients of a Satellite.</p>
</div>
<div class="paragraph">
<p>Before you install Capsule&#160;Server, ensure that your environment meets the requirements for installation.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>The version of Capsule must match with the version of Satellite installed.
It should not be different.
For example, the Capsule version 6.15 cannot be registered with the Satellite version 6.14.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Capsule&#160;Server must be installed on a freshly provisioned system that serves no other function except to run Capsule&#160;Server.
The freshly provisioned system must not have the following users provided by external identity providers to avoid conflicts with the local users that Capsule&#160;Server creates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>apache</p>
</li>
<li>
<p>foreman-proxy</p>
</li>
<li>
<p>postgres</p>
</li>
<li>
<p>pulp</p>
</li>
<li>
<p>puppet</p>
</li>
<li>
<p>redis</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on scaling your Capsule&#160;Servers, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_capsule_server/index#capsule-server-scalability-considerations_capsule">Capsule&#160;Server scalability considerations</a>.</p>
</div>
<div class="paragraph">
<div class="title">Certified hypervisors</div>
<p>Capsule&#160;Server is fully supported on both physical systems and virtual machines that run on hypervisors that are supported to run Red&#160;Hat Enterprise Linux.
For more information about certified hypervisors, see <a href="https://access.redhat.com/articles/973163">Certified Guest Operating Systems in Red&#160;Hat OpenStack Services on OpenShift, Red&#160;Hat&#160;Virtualization, Red Hat OpenShift Virtualization and Red&#160;Hat Enterprise Linux with KVM</a>.</p>
</div>
<div class="paragraph">
<div class="title">SELinux mode</div>
<p>SELinux must be enabled, either in enforcing or permissive mode.
Installation with disabled SELinux is not supported.</p>
</div>
<div class="paragraph">
<div class="title">Synchronized system clock</div>
<p>The system clock on the base operating system where you are installing your Capsule&#160;Server must be synchronized across the network.
If the system clock is not synchronized, SSL certificate verification might fail.
For example, you can use the Chrony suite for timekeeping.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/configuring-time-synchronization_configuring-basic-system-settings">Configuring time synchronization</a> in <em>Red&#160;Hat Enterprise Linux&#160;8 Configuring basic system settings</em>.</p>
</div>
<div class="paragraph">
<div class="title">FIPS mode</div>
<p>You can install Capsule on a Red&#160;Hat Enterprise Linux system that is operating in FIPS mode.
You cannot enable FIPS mode after the installation of Capsule.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/security_hardening/switching-rhel-to-fips-mode_security-hardening">Switching RHEL to FIPS mode</a> in <em>Red&#160;Hat Enterprise Linux&#160;8 Security hardening</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Satellite supports DEFAULT and FIPS crypto-policies.
The FUTURE crypto-policy is not supported for Satellite and Capsule installations.
The FUTURE policy is a stricter forward-looking security level intended for testing a possible future policy.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/security_hardening/using-the-system-wide-cryptographic-policies_security-hardening">Using system-wide cryptographic policies</a> in the Red&#160;Hat Enterprise Linux guide.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="capsule-storage-requirements_capsule"><a class="anchor" href="#capsule-storage-requirements_capsule"></a>1.2. Storage requirements</h3>
<div class="paragraph">
<p>The following table details storage requirements for specific directories.
These values are based on expected use case scenarios and can vary according to individual environments.</p>
</div>
<div class="paragraph">
<p>The runtime size was measured with Red&#160;Hat Enterprise Linux 6, 7, and 8 repositories synchronized.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Storage requirements for Capsule&#160;Server installation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Installation Size</th>
<th class="tableblock halign-left valign-top">Runtime Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/pulp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/pgsql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/puppetlabs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The size of the PostgreSQL database on your Capsule&#160;Server can grow significantly with an increasing number of lifecycle environments, content views, or repositories that are synchronized from your Satellite&#160;Server.
In the largest Satellite environments, the size of <code>/var/lib/pgsql</code> on Capsule&#160;Server can grow to double or triple the size of <code>/var/lib/pgsql</code> on your Satellite&#160;Server.</p>
</div>
</div>
<div class="sect2">
<h3 id="storage-guidelines_capsule"><a class="anchor" href="#storage-guidelines_capsule"></a>1.3. Storage guidelines</h3>
<div class="paragraph">
<p>Consider the following guidelines when installing Capsule&#160;Server to increase efficiency.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you mount the <code>/tmp</code> directory as a separate file system, you must use the <code>exec</code> mount option in the <code>/etc/fstab</code> file.
If <code>/tmp</code> is already mounted with the <code>noexec</code> option, you must change the option to <code>exec</code> and re-mount the file system.
This is a requirement for the <code>puppetserver</code> service to work.</p>
</li>
<li>
<p>Because most Capsule&#160;Server data is stored in the <code>/var</code> directory, mounting <code>/var</code> on LVM storage can help the system to scale.</p>
</li>
<li>
<p>Use high-bandwidth, low-latency storage for the <code>/var/lib/pulp/</code> directories.
As Red&#160;Hat Satellite has many operations that are I/O intensive, using high latency, low-bandwidth storage causes performance degradation.
Ensure your installation has a speed in the range 60&#8202;&#8211;&#8202;80 Megabytes per second.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use the <code>storage-benchmark</code> script to get this data.
For more information on using the <code>storage-benchmark</code> script, see <a href="https://access.redhat.com/solutions/3397771">Impact of Disk Speed on Satellite Operations</a>.</p>
</div>
<div class="ulist">
<div class="title">File system guidelines</div>
<ul>
<li>
<p>Do not use the GFS2 file system as the input-output latency is too high.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Log file storage</div>
<p>Log files are written to <code>/var/log/messages/,</code> <code>/var/log/httpd/</code>, and <code>/var/lib/foreman-proxy/openscap/content/</code>.
You can manage the size of these files using <strong>logrotate</strong>.
For more information, see <a href="https://access.redhat.com/solutions/1294">How to use logrotate utility to rotate log files</a>.</p>
</div>
<div class="paragraph">
<p>The exact amount of storage you require for log messages depends on your installation and setup.</p>
</div>
<div class="paragraph">
<div class="title">SELinux considerations for NFS mount</div>
<p>When the <code>/var/lib/pulp</code> directory is mounted using an NFS share, SELinux blocks the synchronization process.
To avoid this, specify the SELinux context of the <code>/var/lib/pulp</code> directory in the file system table by adding the following lines to <code>/etc/fstab</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nfs.example.com:/nfsshare  /var/lib/pulp  nfs  context="system_u:object_r:var_lib_t:s0"  1 2</pre>
</div>
</div>
<div class="paragraph">
<p>If NFS share is already mounted, remount it using the above configuration and enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># restorecon -R /var/lib/pulp</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Duplicated packages</div>
<p>Packages that are duplicated in different repositories are only stored once on the disk.
Additional repositories containing duplicate packages require less additional storage.
The bulk of storage resides in the <code>/var/lib/pulp/</code> directory.
These end points are not manually configurable.
Ensure that storage is available on the <code>/var</code> file system to prevent storage problems.</p>
</div>
<div class="paragraph">
<div class="title">Symbolic links</div>
<p>You cannot use symbolic links for <code>/var/lib/pulp/</code>.</p>
</div>
<div class="paragraph">
<div class="title">Synchronized RHEL ISO</div>
<p>If you plan to synchronize RHEL content ISOs to Satellite, note that all minor versions of Red&#160;Hat Enterprise Linux also synchronize.
You must plan to have adequate storage on your Satellite to manage this.</p>
</div>
</div>
<div class="sect2">
<h3 id="supported-operating-systems_capsule"><a class="anchor" href="#supported-operating-systems_capsule"></a>1.4. Supported operating systems</h3>
<div class="paragraph">
<p>You can install the operating system from a disc, local ISO image, kickstart, or any other method that Red&#160;Hat supports.
Red&#160;Hat Capsule&#160;Server is supported on the latest version of Red&#160;Hat Enterprise Linux 8 that is available at the time when Capsule&#160;Server is installed.
Previous versions of Red&#160;Hat Enterprise Linux including EUS or z-stream are not supported.</p>
</div>
<div class="paragraph">
<p>The following operating systems are supported by the installer, have packages, and are tested for deploying Satellite:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Operating systems supported by satellite-installer</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Architecture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red&#160;Hat Enterprise Linux 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64 only</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Red&#160;Hat advises against using an existing system because the Satellite installer will affect the configuration of several components.
Red&#160;Hat Capsule&#160;Server requires a Red&#160;Hat Enterprise Linux installation with the <code>@Base</code> package group with no other package-set modifications, and without third-party configurations or software not directly necessary for the direct operation of the server.
This restriction includes hardening and other non-Red&#160;Hat security software.
If you require such software in your infrastructure, install and verify a complete working Capsule&#160;Server first, then create a backup of the system before adding any non-Red&#160;Hat software.</p>
</div>
<div class="paragraph">
<p>Do not register Capsule&#160;Server to the Red&#160;Hat Content Delivery Network (CDN).</p>
</div>
<div class="paragraph">
<p>Red&#160;Hat does not support using the system for anything other than running Capsule&#160;Server.</p>
</div>
</div>
<div class="sect2">
<h3 id="capsule-port-and-firewall-requirements_capsule"><a class="anchor" href="#capsule-port-and-firewall-requirements_capsule"></a>1.5. Port and firewall requirements</h3>
<div class="paragraph">
<p>For the components of Satellite architecture to communicate, ensure that the required network ports are open and free on the base operating system.
You must also ensure that the required network ports are open on any network-based firewalls.</p>
</div>
<div class="paragraph">
<p>The installation of a Capsule&#160;Server fails if the ports between Satellite&#160;Server and Capsule&#160;Server are not open before installation starts.</p>
</div>
<div class="paragraph">
<p>Use this information to configure any network-based firewalls.
Note that some cloud solutions must be specifically configured to allow communications between machines because they isolate machines similarly to network-based firewalls.
If you use an application-based firewall, ensure that the application-based firewall permits all applications that are listed in the tables and known to your firewall.
If possible, disable the application checking and allow open port communication based on the protocol.</p>
</div>
<div class="paragraph">
<div class="title">Integrated Capsule</div>
<p>Satellite&#160;Server has an integrated Capsule and any host that is directly connected to Satellite&#160;Server is a Client of Satellite in the context of this section.
This includes the base operating system on which Capsule&#160;Server is running.</p>
</div>
<div class="paragraph">
<div class="title">Clients of Capsule</div>
<p>Hosts which are clients of Capsules, other than Satellite&#8217;s integrated Capsule, do not need access to Satellite&#160;Server.
For more information on Satellite Topology, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/overview_concepts_and_deployment_considerations/index#sect-Documentation-Architecture_Guide-Capsule_Networking">Capsule Networking</a> in <em>Overview, concepts, and deployment considerations</em>.</p>
</div>
<div class="paragraph">
<p>Required ports can change based on your configuration.</p>
</div>
<div class="paragraph">
<p>The following tables indicate the destination port and the direction of network traffic:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Capsule incoming traffic</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Required For</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Servers and clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name resolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP Server (optional)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443, 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Retrieval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443, 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Host Registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capsule CA RPM installation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red&#160;Hat Satellite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Mirroring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red&#160;Hat Satellite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capsule API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart Proxy functionality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Host registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiation</p>
<p class="tableblock">Uploading facts</p>
<p class="tableblock">Sending installed packages and traces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1883</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MQTT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull based REX (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content hosts for REX job notification (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provisioning templates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template retrieval for client installers, iPXE or UEFI HTTP Boot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXE Boot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8140</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puppet agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client updates (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Host registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated and only needed for Client hosts deployed before upgrades</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red&#160;Hat Satellite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capsule API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capsule functionality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Register Endpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client registration with an external Capsule&#160;Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenSCAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Client (if the OpenSCAP plugin is installed)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovered Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host discovery and provisioning (if the discovery plugin is installed)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull based REX (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content hosts for REX job notification (optional)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Any host that is directly connected to Satellite&#160;Server is a client in this context because it is a client of the integrated Capsule.
This includes the base operating system on which a Capsule&#160;Server is running.</p>
</div>
<div class="paragraph">
<p>A DHCP Capsule performs ICMP ping and TCP echo connection attempts to hosts in subnets with DHCP IPAM set to find out if an IP address considered for use is free.
This behavior can be turned off using <code>satellite-installer --foreman-proxy-dhcp-ping-free-ip=false</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Capsule outgoing traffic</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Required For</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ICMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free IP checking (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">echo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free IP checking (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run jobs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Servers on the Internet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolve DNS records (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capsule DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validation of DNS conflicts (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Satellite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capsule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capsule</p>
<p class="tableblock">Configuration management</p>
<p class="tableblock">Template retrieval</p>
<p class="tableblock">OpenSCAP</p>
<p class="tableblock">Remote Execution result upload</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red&#160;Hat Portal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOS report</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assisting support cases (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Satellite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Satellite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client communication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forward requests from Client to Satellite</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infoblox DHCP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When using Infoblox for DHCP, management of the DHCP leases (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">623</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BMC On/Off/Cycle/Status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7911</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP, OMAPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The DHCP target is configured using <code>--foreman-proxy-dhcp-server</code> and defaults to localhost</p>
<p class="tableblock">ISC and <code>remote_isc</code> use a configurable port that defaults to 7911 and uses OMAPI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capsule sends reboot command to the discovered host (optional)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>ICMP to Port 7 UDP and TCP must not be rejected, but can be dropped.
The DHCP Capsule sends an ECHO REQUEST to the Client network to verify that an IP address is free.
A response prevents IP addresses from being allocated.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="enabling-connections-to-capsule_capsule"><a class="anchor" href="#enabling-connections-to-capsule_capsule"></a>1.6. Enabling connections from Satellite&#160;Server and clients to a Capsule&#160;Server</h3>
<div class="paragraph">
<p>On the base operating system on which you want to install Capsule, you must enable incoming connections from Satellite&#160;Server and clients to Capsule&#160;Server and make these rules persistent across reboots.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the ports for clients on Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd \
--add-port="8000/tcp" \
--add-port="9090/tcp"</pre>
</div>
</div>
</li>
<li>
<p>Allow access to services on Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd \
--add-service=dns \
--add-service=dhcp \
--add-service=tftp \
--add-service=http \
--add-service=https \
--add-service=puppetmaster</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --list-all</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/securing_networks/using-and-configuring-firewalld_securing-networks">Using and Configuring firewalld</a> in <em>Red&#160;Hat Enterprise Linux 8 Securing networks</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-capsule-server"><a class="anchor" href="#installing-capsule-server"></a>2. Installing Capsule&#160;Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you install Capsule&#160;Server, you must ensure that your environment meets the requirements for installation.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_capsule_server/index#preparing-environment-for-capsule-installation">Preparing your Environment for Installation</a>.</p>
</div>
<div class="sect2">
<h3 id="Registering_Proxy_to_Server_capsule"><a class="anchor" href="#Registering_Proxy_to_Server_capsule"></a>2.1. Registering to Satellite&#160;Server</h3>
<div class="paragraph">
<p>Use this procedure to register the base operating system on which you want to install Capsule&#160;Server to Satellite&#160;Server.</p>
</div>
<div class="ulist">
<div class="title">Red&#160;Hat subscription manifest prerequisites</div>
<ul>
<li>
<p>On Satellite&#160;Server, a manifest must be installed and it must contain the appropriate repositories for the organization you want Capsule to belong to.</p>
</li>
<li>
<p>The manifest must contain repositories for the base operating system on which you want to install Capsule, as well as any clients that you want to connect to Capsule.</p>
</li>
<li>
<p>The repositories must be synchronized.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on manifests and repositories, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/managing_content/index#Managing_Red_Hat_Subscriptions_content-management">Managing Red Hat Subscriptions</a> in <em>Managing content</em>.</p>
</div>
<div class="ulist">
<div class="title">Proxy and network prerequisites</div>
<ul>
<li>
<p>The Satellite&#160;Server base operating system must be able to resolve the host name of the Capsule base operating system and vice versa.</p>
</li>
<li>
<p>Ensure HTTPS connection using client certificate authentication is possible between Capsule&#160;Server and Satellite&#160;Server.
HTTP proxies between Capsule&#160;Server and Satellite&#160;Server are not supported.</p>
</li>
<li>
<p>You must configure the host and network-based firewalls accordingly.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_capsule_server/index#capsule-port-and-firewall-requirements_capsule">Port and firewall requirements</a> in <em>Installing Capsule Server</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can register hosts with Satellite using the host registration feature in the Satellite web UI, Hammer CLI, or the Satellite API.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/managing_hosts/index#Registering_Hosts_managing-hosts">Registering Hosts</a> in <em>Managing hosts</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Register Host</strong>.</p>
</li>
<li>
<p>From the <strong>Activation Keys</strong> list, select the activation keys to assign to your host.</p>
</li>
<li>
<p>Click <strong>Generate</strong> to create the registration command.</p>
</li>
<li>
<p>Click on the <em>files</em> icon to copy the command to your clipboard.</p>
</li>
<li>
<p>Connect to your host using SSH and run the registration command.</p>
</li>
<li>
<p>Check the <code>/etc/yum.repos.d/redhat.repo</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Generate the host registration command using the Hammer CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host-registration generate-command \
--activation-keys "<em>My_Activation_Key</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>If your hosts do not trust the SSL certificate of Satellite&#160;Server, you can disable SSL validation by adding the <code>--insecure</code> flag to the registration command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host-registration generate-command \
--activation-keys "<em>My_Activation_Key</em>" \
--insecure true</pre>
</div>
</div>
</li>
<li>
<p>Connect to your host using SSH and run the registration command.</p>
</li>
<li>
<p>Check the <code>/etc/yum.repos.d/redhat.repo</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">API procedure</div>
<ol class="arabic">
<li>
<p>Generate the host registration command using the Satellite API:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -X POST https://satellite.example.com/api/registration_commands \
--user "<em>My_User_Name</em>" \
-H 'Content-Type: application/json' \
-d '{ "registration_command": { "activation_keys": ["<em>My_Activation_Key_1</em>, <em>My_Activation_Key_2</em>"] }}'</pre>
</div>
</div>
<div class="paragraph">
<p>If your hosts do not trust the SSL certificate of Satellite&#160;Server, you can disable SSL validation by adding the <code>--insecure</code> flag to the registration command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -X POST https://satellite.example.com/api/registration_commands \
--user "<em>My_User_Name</em>" \
-H 'Content-Type: application/json' \
-d '{ "registration_command": { "activation_keys": ["<em>My_Activation_Key_1</em>, <em>My_Activation_Key_2</em>"], "insecure": true }}'</pre>
</div>
</div>
<div class="paragraph">
<p>Use an activation key to simplify specifying the environments.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/managing_content/index#Managing_Activation_Keys_content-management">Managing Activation Keys</a> in <em>Managing content</em>.</p>
</div>
<div class="paragraph">
<p>To enter a password as a command line argument, use <code>username:password</code> syntax.
Keep in mind this can save the password in the shell history.
Alternatively, you can use a temporary personal access token instead of a password.
To generate a token in the Satellite web UI, navigate to <strong>My Account</strong> &gt; <strong>Personal Access Tokens</strong>.</p>
</div>
</li>
<li>
<p>Connect to your host using SSH and run the registration command.</p>
</li>
<li>
<p>Check the <code>/etc/yum.repos.d/redhat.repo</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-repositories-proxy_capsule"><a class="anchor" href="#configuring-repositories-proxy_capsule"></a>2.2. Configuring repositories</h3>
<div class="paragraph">
<p>Use this procedure to enable the repositories that are required to install Capsule&#160;Server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable all repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --disable "*"</pre>
</div>
</div>
</li>
<li>
<p>Enable the following repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable=rhel-8-for-x86_64-baseos-rpms \
--enable=rhel-8-for-x86_64-appstream-rpms \
--enable=satellite-capsule-6.15-for-rhel-8-x86_64-rpms \
--enable=satellite-maintenance-6.15-for-rhel-8-x86_64-rpms</pre>
</div>
</div>
</li>
<li>
<p>Enable the module:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module enable satellite-capsule:el8</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If there is any warning about conflicts with Ruby or PostgreSQL while enabling <code>satellite-capsule:el8</code> module, see <a href="#troubleshooting-dnf-modules_capsule">Troubleshooting DNF modules</a>.
For more information about modules and lifecycle streams on Red&#160;Hat Enterprise Linux 8, see <a href="https://access.redhat.com/support/policy/updates/rhel-app-streams-life-cycle">Red&#160;Hat Enterprise Linux Application Streams Lifecycle</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are installing Capsule&#160;Server as a virtual machine hosted on Red&#160;Hat&#160;Virtualization, you must also enable the <strong>Red&#160;Hat Common</strong> repository and then install Red&#160;Hat&#160;Virtualization guest agents and drivers.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html/virtual_machine_management_guide/installing_guest_agents_and_drivers_linux_linux_vm#Installing_the_Guest_Agents_and_Drivers_on_Red_Hat_Enterprise_Linux">Installing the Guest Agents and Drivers on Red&#160;Hat Enterprise Linux</a> in the <em>Virtual Machine Management Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optional: Verify that the required repositories are enabled:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf repolist enabled</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="using-fapolicyd-on-server_capsule"><a class="anchor" href="#using-fapolicyd-on-server_capsule"></a>2.3. Optional: Using fapolicyd on Capsule&#160;Server</h3>
<div class="paragraph">
<p>By enabling <code>fapolicyd</code> on your Satellite&#160;Server, you can provide an additional layer of security by monitoring and controlling access to files and directories.
The fapolicyd daemon uses the RPM database as a repository of trusted binaries and scripts.</p>
</div>
<div class="paragraph">
<p>You can turn on or off the fapolicyd on your Satellite&#160;Server or Capsule&#160;Server at any point.</p>
</div>
<div class="sect3">
<h4 id="installing-fapolicyd-on-server_capsule"><a class="anchor" href="#installing-fapolicyd-on-server_capsule"></a>2.3.1. Installing fapolicyd on Capsule&#160;Server</h4>
<div class="paragraph">
<p>You can install <code>fapolicyd</code> along with Capsule&#160;Server or can be installed on an existing Capsule&#160;Server.
If you are installing <code>fapolicyd</code> along with the new Capsule&#160;Server, the installation process will detect the fapolicyd in your Red&#160;Hat Enterprise Linux host and deploy the Capsule&#160;Server rules automatically.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure your host has access to the BaseOS repositories of Red&#160;Hat Enterprise Linux.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>For a new installation, install fapolicyd:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install fapolicyd</pre>
</div>
</div>
</li>
<li>
<p>For an existing installation, install fapolicyd using satellite-maintain packages install:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-maintain packages install fapolicyd</pre>
</div>
</div>
</li>
<li>
<p>Start the <code>fapolicyd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl enable --now fapolicyd</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify that the <code>fapolicyd</code> service is running correctly:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl status fapolicyd</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">New Satellite&#160;Server or Capsule&#160;Server installations</div>
<p>In case of new Satellite&#160;Server or Capsule&#160;Server installation, follow the standard installation procedures after installing and enabling fapolicyd on your Red&#160;Hat Enterprise Linux host.</p>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information on fapolicyd, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/security_hardening/assembly_blocking-and-allowing-applications-using-fapolicyd_security-hardening#doc-wrapper">Blocking and allowing applications using fapolicyd</a> in <em>Red Hat Enterprise Linux 8 Security hardening</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Installing_Proxy_Packages_capsule"><a class="anchor" href="#Installing_Proxy_Packages_capsule"></a>2.4. Installing Capsule&#160;Server packages</h3>
<div class="paragraph">
<p>Before installing Capsule&#160;Server packages, you must update all packages that are installed on the base operating system.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To install Capsule&#160;Server, complete the following steps:</p>
</div>
<div id="installing-foreman-proxy-packages-dnf_capsule" class="olist arabic">
<ol class="arabic">
<li>
<p>Update all packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf upgrade</pre>
</div>
</div>
</li>
<li>
<p>Install the Capsule&#160;Server packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install satellite-capsule</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-capsule-server-with-ssl-certificates"><a class="anchor" href="#configuring-capsule-server-with-ssl-certificates"></a>2.5. Configuring Capsule&#160;Server with SSL certificates</h3>
<div class="paragraph">
<p>Red&#160;Hat Satellite uses SSL certificates to enable encrypted communications between Satellite&#160;Server, external Capsule&#160;Servers, and all hosts.
Depending on the requirements of your organization, you must configure your Capsule&#160;Server with a default or custom certificate.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use a default SSL certificate, you must also configure each external Capsule&#160;Server with a distinct default SSL certificate.
For more information, see <a href="#configuring-capsule-default-certificate_capsule">Configuring Capsule&#160;Server with a default SSL certificate</a>.</p>
</li>
<li>
<p>If you use a custom SSL certificate, you must also configure each external Capsule&#160;Server with a distinct custom SSL certificate.
For more information, see <a href="#configuring-capsule-custom-server-certificate_capsule">Configuring Capsule&#160;Server with a custom SSL certificate</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring-capsule-default-certificate_capsule"><a class="anchor" href="#configuring-capsule-default-certificate_capsule"></a>2.5.1. Configuring Capsule&#160;Server with a default SSL certificate</h4>
<div class="paragraph">
<p>Use this section to configure Capsule&#160;Server with an SSL certificate that is signed by Satellite&#160;Server default Certificate Authority (CA).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Capsule&#160;Server is registered to Satellite&#160;Server.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_capsule_server/index#registering-to-satellite-server_capsule">Registering to Satellite&#160;Server</a>.</p>
</li>
<li>
<p>Capsule&#160;Server packages are installed.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_capsule_server/index#installing-capsule-server-packages_capsule">Installing Capsule&#160;Server Packages</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Satellite&#160;Server, to store all the source certificate files for your Capsule&#160;Server, create a directory that is accessible only to the <code>root</code> user, for example <code>/root/capsule_cert</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/<em>capsule_cert</em></pre>
</div>
</div>
</li>
<li>
<p>On Satellite&#160;Server, generate the <code>/root/capsule_cert/<em>capsule.example.com</em>-certs.tar</code> certificate archive for your Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># capsule-certs-generate \
--foreman-proxy-fqdn <em>capsule.example.com</em> \
--certs-tar /root/capsule_cert/<em>capsule.example.com</em>-certs.tar</pre>
</div>
</div>
<div class="paragraph">
<p>Retain a copy of the <code>satellite-installer</code> command that the <code>capsule-certs-generate</code> command returns for deploying the certificate to your Capsule&#160;Server.</p>
</div>
<div class="listingblock">
<div class="title">Example output of <code>capsule-certs-generate</code></div>
<div class="content">
<pre class="nowrap"><em>output omitted</em>
satellite-installer --scenario capsule \
--certs-tar-file "/root/capsule_cert/<em>capsule.example.com</em>-certs.tar" \
--foreman-proxy-register-in-foreman "true" \
--foreman-proxy-foreman-base-url "https://<em>satellite.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>satellite.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>capsule.example.com</em>" \
--foreman-proxy-oauth-consumer-key "<em>s97QxvUAgFNAQZNGg4F9zLq2biDsxM7f</em>" \
--foreman-proxy-oauth-consumer-secret "<em>6bpzAdMpRAfYaVZtaepYetomgBVQ6ehY</em>"</pre>
</div>
</div>
</li>
<li>
<p>On Satellite&#160;Server, copy the certificate archive file to your Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/capsule_cert/<em>capsule.example.com</em>-certs.tar \
root@<em>capsule.example.com</em>:/root/<em>capsule.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>On Capsule&#160;Server, to deploy the certificate, enter the <code>satellite-installer</code> command that the <code>capsule-certs-generate</code> command returns.</p>
<div class="paragraph">
<p>When network connections or ports to Satellite are not yet open, you can set the <code>--foreman-proxy-register-in-foreman</code> option to <code>false</code> to prevent Capsule from attempting to connect to Satellite and reporting errors.
Run the installer again with this option set to <code>true</code> when the network and firewalls are correctly configured.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not delete the certificate archive file after you deploy the certificate.
It is required, for example, when upgrading Capsule&#160;Server.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-capsule-custom-server-certificate_capsule"><a class="anchor" href="#configuring-capsule-custom-server-certificate_capsule"></a>2.5.2. Configuring Capsule&#160;Server with a custom SSL certificate</h4>
<div class="paragraph">
<p>If you configure Satellite&#160;Server to use a custom SSL certificate, you must also configure each of your external Capsule&#160;Servers with a distinct custom SSL certificate.</p>
</div>
<div class="paragraph">
<p>To configure your Capsule&#160;Server with a custom certificate, complete the following procedures on each Capsule&#160;Server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#creating-a-custom-ssl-certificate_capsule">Creating a custom SSL certificate for Capsule&#160;Server</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-capsule-server_capsule">Deploying a custom SSL certificate to Capsule&#160;Server</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-hosts_capsule">Deploying a custom SSL certificate to hosts</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="creating-a-custom-ssl-certificate_capsule"><a class="anchor" href="#creating-a-custom-ssl-certificate_capsule"></a>Creating a custom SSL certificate for Capsule&#160;Server</h5>
<div class="paragraph">
<p>On Satellite&#160;Server, create a custom certificate for your Capsule&#160;Server.
If you already have a custom SSL certificate for Capsule&#160;Server, skip this procedure.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To store all the source certificate files, create a directory that is accessible only to the <code>root</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/capsule_cert</pre>
</div>
</div>
</li>
<li>
<p>Create a private key with which to sign the certificate signing request (CSR).</p>
<div class="paragraph">
<p>Note that the private key must be unencrypted.
If you use a password-protected private key, remove the private key password.</p>
</div>
<div class="paragraph">
<p>If you already have a private key for this Capsule&#160;Server, skip this step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl genrsa -out <code>/root/capsule_cert/capsule_cert_key.pem</code> 4096</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/root/capsule_cert/openssl.cnf</code> configuration file for the CSR and include the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[ req ]
req_extensions = v3_req
distinguished_name = req_distinguished_name
prompt = no

[ req_distinguished_name ]
commonName = <em>capsule.example.com</em>

[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth, clientAuth
subjectAltName = @alt_names

[ alt_names ]
DNS.1 = <em>capsule.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>[ v3_req ]</code> parameters and their purpose, see <a href="https://www.rfc-editor.org/rfc/rfc5280">RFC 5280: Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>.</p>
</div>
</li>
<li>
<p>Optional: If you want to add Distinguished Name (DN) details to the CSR, add the following information to the <code>[ req_distinguished_name ]</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[req_distinguished_name]
CN = <em>capsule.example.com</em>
countryName =<em>My_Country_Name</em> <b class="conum">(1)</b>
stateOrProvinceName = <em>My_State_Or_Province_Name</em> <b class="conum">(2)</b>
localityName = <em>My_Locality_Name</em> <b class="conum">(3)</b>
organizationName = <em>My_Organization_Or_Company_Name</em>
organizationalUnitName = <em>My_Organizational_Unit_Name</em> <b class="conum">(4)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Two letter code</p>
</li>
<li>
<p>Full name</p>
</li>
<li>
<p>Full name (example: New York)</p>
</li>
<li>
<p>Division responsible for the certificate (example: IT department)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Generate CSR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl req -new \
-key <em>/root/capsule_cert/capsule_cert_key.pem</em> \ <b class="conum">(1)</b>
-config <em>/root/capsule_cert/openssl.cnf</em> \ <b class="conum">(2)</b>
-out <em>/root/capsule_cert/capsule_cert_csr.pem</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to the private key</p>
</li>
<li>
<p>Path to the configuration file</p>
</li>
<li>
<p>Path to the CSR to generate</p>
</li>
</ol>
</div>
</li>
<li>
<p>Send the certificate signing request to the certificate authority (CA).
The same CA must sign certificates for Satellite&#160;Server and Capsule&#160;Server.</p>
<div class="paragraph">
<p>When you submit the request, specify the lifespan of the certificate.
The method for sending the certificate request varies, so consult the CA for the preferred method.
In response to the request, you can expect to receive a CA bundle and a signed certificate, in separate files.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="deploying-a-custom-ssl-certificate-to-capsule-server_capsule"><a class="anchor" href="#deploying-a-custom-ssl-certificate-to-capsule-server_capsule"></a>Deploying a custom SSL certificate to Capsule&#160;Server</h5>
<div class="paragraph">
<p>Use this procedure to configure your Capsule&#160;Server with a custom SSL certificate signed by a Certificate Authority.
The <code>satellite-installer</code> command, which the <code>capsule-certs-generate</code> command returns, is unique to each Capsule&#160;Server.
Do not use the same command on more than one Capsule&#160;Server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Satellite&#160;Server is configured with a custom certificate.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_satellite_server_in_a_connected_network_environment/index#configuring-satellite-custom-server-certificate_satellite">Configuring Satellite&#160;Server with a Custom SSL Certificate</a> in <em>Installing Satellite&#160;Server in a connected network environment</em>.</p>
</li>
<li>
<p>Capsule&#160;Server is registered to Satellite&#160;Server.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_capsule_server/index#registering-to-satellite-server_capsule">Registering to Satellite&#160;Server</a>.</p>
</li>
<li>
<p>Capsule&#160;Server packages are installed.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_capsule_server/index#installing-capsule-server-packages_capsule">Installing Capsule&#160;Server Packages</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Satellite&#160;Server, generate a certificate bundle:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># capsule-certs-generate \
--foreman-proxy-fqdn <em>capsule.example.com</em> \
--certs-tar ~/<em>capsule.example.com</em>-certs.tar \
--server-cert /root/<em>capsule_cert/capsule_cert.pem</em> \ <b class="conum">(1)</b>
--server-key /root/<em>capsule_cert/capsule_cert_key.pem</em> \ <b class="conum">(2)</b>
--server-ca-cert /root/<em>capsule_cert/ca_cert_bundle.pem</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to Capsule&#160;Server certificate file that is signed by a Certificate Authority.</p>
</li>
<li>
<p>Path to the private key that was used to sign Capsule&#160;Server certificate.</p>
</li>
<li>
<p>Path to the Certificate Authority bundle.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Retain a copy of the <code>satellite-installer</code> command that the <code>capsule-certs-generate</code> command returns for deploying the certificate to your Capsule&#160;Server.</p>
<div class="listingblock">
<div class="title">Example output of <code>capsule-certs-generate</code></div>
<div class="content">
<pre class="nowrap"><em>output omitted</em>
satellite-installer --scenario capsule \
--certs-tar-file "/root/<em>capsule.example.com</em>-certs.tar" \
--foreman-proxy-register-in-foreman "true" \
--foreman-proxy-foreman-base-url "https://<em>satellite.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>satellite.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>capsule.example.com</em>" \
--foreman-proxy-oauth-consumer-key "<em>My_OAuth_Consumer_Key</em>" \
--foreman-proxy-oauth-consumer-secret "<em>My_OAuth_Consumer_Secret</em>"</pre>
</div>
</div>
</li>
<li>
<p>On your Satellite&#160;Server, copy the certificate archive file to your Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp ~/<em>capsule.example.com</em>-certs.tar \
root@<em>capsule.example.com</em>:/root/<em>capsule.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>On your Capsule&#160;Server, to deploy the certificate, enter the <code>satellite-installer</code> command that the <code>capsule-certs-generate</code> command returns.</p>
<div class="paragraph">
<p>If network connections or ports to Satellite are not yet open, you can set the <code>--foreman-proxy-register-in-foreman</code> option to <code>false</code> to prevent Capsule from attempting to connect to Satellite and reporting errors.
Run the installer again with this option set to <code>true</code> when the network and firewalls are correctly configured.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Do not delete the certificate archive file after you deploy the certificate.
It is required, for example, when upgrading Capsule&#160;Server.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="deploying-a-custom-ssl-certificate-to-hosts_capsule"><a class="anchor" href="#deploying-a-custom-ssl-certificate-to-hosts_capsule"></a>Deploying a custom SSL certificate to hosts</h5>
<div class="paragraph">
<p>After you configure Satellite to use a custom SSL certificate, you must deploy the certificate to hosts registered to Satellite.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Update the SSL certificate on each host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install http://<em>capsule.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assigning-organization-location-capsule-server_capsule"><a class="anchor" href="#assigning-organization-location-capsule-server_capsule"></a>2.6. Assigning the correct organization and location to Capsule&#160;Server in the Satellite web UI</h3>
<div class="paragraph">
<p>After installing Capsule&#160;Server packages, if there is more than one organization or location, you must assign the correct organization and location to Capsule to make Capsule visible in the Satellite web UI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Assigning a Capsule to the same location as your Satellite&#160;Server with an embedded Capsule prevents Red&#160;Hat&#160;Insights from uploading the Insights inventory.
To enable the inventory upload, synchronize SSH keys for both Capsules.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log into the Satellite web UI.</p>
</li>
<li>
<p>From the <strong>Organization</strong> list in the upper-left of the screen, select <strong>Any Organization</strong>.</p>
</li>
<li>
<p>From the <strong>Location</strong> list in the upper-left of the screen, select <strong>Any Location</strong>.</p>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and select Capsule&#160;Server.</p>
</li>
<li>
<p>From the <strong>Select Actions</strong> list, select <strong>Assign Organization</strong>.</p>
</li>
<li>
<p>From the <strong>Organization</strong> list, select the organization where you want to assign this Capsule.</p>
</li>
<li>
<p>Click <strong>Fix Organization on Mismatch</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Select Capsule&#160;Server. From the <strong>Select Actions</strong> list, select <strong>Assign Location</strong>.</p>
</li>
<li>
<p>From the <strong>Location</strong> list, select the location where you want to assign this Capsule.</p>
</li>
<li>
<p>Click <strong>Fix Location on Mismatch</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Administer</strong> &gt; <strong>Organizations</strong> and click the organization to which you have assigned Capsule.</p>
</li>
<li>
<p>Click <strong>Capsules</strong> tab and ensure that Capsule&#160;Server is listed under the <strong>Selected items</strong> list, then click <strong>Submit</strong>.</p>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Administer</strong> &gt; <strong>Locations</strong> and click the location to which you have assigned Capsule.</p>
</li>
<li>
<p>Click <strong>Capsules</strong> tab and ensure that Capsule&#160;Server is listed under the <strong>Selected items</strong> list, then click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Optionally, you can verify if Capsule&#160;Server is correctly listed in the Satellite web UI.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the organization from the <strong>Organization</strong> list.</p>
</li>
<li>
<p>Select the location from the <strong>Location</strong> list.</p>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performing-additional-configuration-on-capsule-server_capsule"><a class="anchor" href="#performing-additional-configuration-on-capsule-server_capsule"></a>3. Performing additional configuration on Capsule&#160;Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After installation, you can configure additional settings on your Capsule&#160;Server.</p>
</div>
<div class="sect2">
<h3 id="configuring-capsule-for-host-registration-and-provisioning_capsule"><a class="anchor" href="#configuring-capsule-for-host-registration-and-provisioning_capsule"></a>3.1. Configuring Capsule for host registration and provisioning</h3>
<div class="paragraph">
<p>Use this procedure to configure Capsule so that you can register and provision hosts using your Capsule&#160;Server instead of your Satellite&#160;Server.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>On Satellite&#160;Server, add the Capsule to the list of trusted proxies.</p>
<div class="paragraph">
<p>This is required for Satellite to recognize hosts' IP addresses forwarded over the <code>X-Forwarded-For</code> HTTP header set by Capsule.
For security reasons, Satellite recognizes this HTTP header only from localhost by default.
You can enter trusted proxies as valid IPv4 or IPv6 addresses of Capsules, or network ranges.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Do not use a network range that is too wide, because that poses a potential security risk.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enter the following command.
Note that the command overwrites the list that is currently stored in Satellite.
Therefore, if you have set any trusted proxies previously, you must include them in the command as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer \
--foreman-trusted-proxies "127.0.0.1/8" \
--foreman-trusted-proxies "::1" \
--foreman-trusted-proxies "<em>My_IP_address</em>" \
--foreman-trusted-proxies "<em>My_IP_range</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>The localhost entries are required, do not omit them.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>List the current trusted proxies using the full help of Satellite installer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --full-help | grep -A 2 "trusted-proxies"</pre>
</div>
</div>
</li>
<li>
<p>The current listing contains all trusted proxies you require.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-pull-based-transport-for-remote-execution_capsule"><a class="anchor" href="#configuring-pull-based-transport-for-remote-execution_capsule"></a>3.2. Configuring pull-based transport for remote execution</h3>
<div class="paragraph">
<p>By default, remote execution uses push-based SSH as the transport mechanism for the Script provider.
If your infrastructure prohibits outgoing connections from Capsule&#160;Server to hosts, you can use remote execution with pull-based transport instead, because the host initiates the connection to Capsule&#160;Server.
The use of pull-based transport is not limited to those infrastructures.</p>
</div>
<div class="paragraph">
<p>The pull-based transport comprises <code>pull-mqtt</code> mode on Capsules in combination with a pull client running on hosts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>pull-mqtt</code> mode works only with the Script provider.
Ansible and other providers will continue to use their default transport settings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The mode is configured per Capsule&#160;Server.
Some Capsule&#160;Servers can be configured to use <code>pull-mqtt</code> mode while others use SSH.
If this is the case, it is possible that one remote job on a given host will use the pull client and the next job on the same host will use SSH.
If you wish to avoid this scenario, configure all Capsule&#160;Servers to use the same mode.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable the pull-based transport on your Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --foreman-proxy-plugin-remote-execution-script-mode=pull-mqtt</pre>
</div>
</div>
</li>
<li>
<p>Configure the firewall to allow the MQTT service on port 1883:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-service=mqtt</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>In <code>pull-mqtt</code> mode, hosts subscribe for job notifications to either your Satellite&#160;Server or any Capsule&#160;Server through which they are registered.
Ensure that Satellite&#160;Server sends remote execution jobs to that same Satellite&#160;Server or Capsule&#160;Server:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Satellite web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Content</strong> tab, set the value of <strong>Prefer registered through Capsule for remote execution</strong> to <strong>Yes</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>Configure your hosts for the pull-based transport.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/managing_hosts/index#transport-modes-for-remote-execution_managing-hosts">Transport modes for remote execution</a> in <em>Managing hosts</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Enabling_OpenSCAP_on_capsule_Servers_capsule"><a class="anchor" href="#Enabling_OpenSCAP_on_capsule_Servers_capsule"></a>3.3. Enabling OpenSCAP on Capsule&#160;Servers</h3>
<div class="paragraph">
<p>On Satellite&#160;Server and the integrated Capsule of your Satellite&#160;Server, OpenSCAP is enabled by default.
To use the OpenSCAP plugin and content on external Capsules, you must enable OpenSCAP on each Capsule.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable OpenSCAP, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer \
--enable-foreman-proxy-plugin-openscap \
--foreman-proxy-plugin-openscap-ansible-module true \
--foreman-proxy-plugin-openscap-puppet-module true</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use Puppet to deploy compliance policies, you must enable it first.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/managing_configurations_using_puppet_integration/index#"><em>Managing configurations using Puppet integration</em></a>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Lifecycle_Environments_capsule"><a class="anchor" href="#Adding_Lifecycle_Environments_capsule"></a>3.4. Adding lifecycle environments to Capsule&#160;Servers</h3>
<div class="paragraph">
<p>If your Capsule&#160;Server has the content functionality enabled, you must add an environment so that Capsule can synchronize content from Satellite&#160;Server and provide content to host systems.</p>
</div>
<div class="paragraph">
<p>Do not assign the <em>Library</em> lifecycle environment to your Capsule&#160;Server because it triggers an automated Capsule sync every time the CDN updates a repository.
This might consume multiple system resources on Capsules, network bandwidth between Satellite and Capsules, and available disk space on Capsules.</p>
</div>
<div class="paragraph">
<p>You can use Hammer CLI on Satellite&#160;Server or the Satellite web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong>, and select the Capsule that you want to add a lifecycle to.</p>
</li>
<li>
<p>Click <strong>Edit</strong> and click the <strong>Lifecycle Environments</strong> tab.</p>
</li>
<li>
<p>From the left menu, select the lifecycle environments that you want to add to Capsule and click <strong>Submit</strong>.</p>
</li>
<li>
<p>To synchronize the content on the Capsule, click the <strong>Overview</strong> tab and click <strong>Synchronize</strong>.</p>
</li>
<li>
<p>Select either <strong>Optimized Sync</strong> or <strong>Complete Sync</strong>.</p>
<div class="paragraph">
<p>For definitions of each synchronization type, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/managing_content/index#Recovering_a_Corrupted_Repository_content-management">Recovering a Repository</a>.</p>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>To display a list of all Capsule&#160;Servers, on Satellite&#160;Server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule list</pre>
</div>
</div>
<div class="paragraph">
<p>Note the Capsule ID of the Capsule to which you want to add a lifecycle.</p>
</div>
</li>
<li>
<p>Using the ID, verify the details of your Capsule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule info \
--id <em>My</em>capsule_ID_</pre>
</div>
</div>
</li>
<li>
<p>To view the lifecycle environments available for your Capsule&#160;Server, enter the following command and note the ID and the organization name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content available-lifecycle-environments \
--id <em>My</em>capsule_ID_</pre>
</div>
</div>
</li>
<li>
<p>Add the lifecycle environment to your Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content add-lifecycle-environment \
--id <em>My</em>capsule_ID_ \
--lifecycle-environment-id <em>My_Lifecycle_Environment_ID</em>
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>Repeat for each lifecycle environment you want to add to Capsule&#160;Server.</p>
</div>
</li>
<li>
<p>Synchronize the content from Satellite to Capsule.</p>
<div class="ulist">
<ul>
<li>
<p>To synchronize all content from your Satellite&#160;Server environment to Capsule&#160;Server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content synchronize \
--id <em>My</em>capsule_ID_</pre>
</div>
</div>
</li>
<li>
<p>To synchronize a specific lifecycle environment from your Satellite&#160;Server to Capsule&#160;Server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content synchronize \
--id <em>My</em>capsule_ID_
--lifecycle-environment-id <em>My_Lifecycle_Environment_ID</em></pre>
</div>
</div>
</li>
<li>
<p>To synchronize all content from your Satellite&#160;Server to your Capsule&#160;Server without checking metadata:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer capsule content synchronize \
--id <em>My</em>capsule_ID_ \
--skip-metadata-check true</pre>
</div>
</div>
<div class="paragraph">
<p>This equals selecting <strong>Complete Sync</strong> in the Satellite web UI.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="enabling-power-management-on-hosts_capsule"><a class="anchor" href="#enabling-power-management-on-hosts_capsule"></a>3.5. Enabling power management on hosts</h3>
<div class="paragraph">
<p>To perform power management tasks on hosts using the intelligent platform management interface (IPMI) or a similar protocol, you must enable the baseboard management controller (BMC) module on Capsule&#160;Server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All hosts must have a network interface of BMC type.
Capsule&#160;Server uses this NIC to pass the appropriate credentials to the host.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/managing_hosts/index#Adding_a_Baseboard_Management_Controller_Interface_managing-hosts">Adding a Baseboard Management Controller (BMC) Interface</a> in <em>Managing hosts</em>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable BMC, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer \
--foreman-proxy-bmc "true" \
--foreman-proxy-bmc-default-provider "freeipmi"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-dns-dhcp-and-tftp-on-productname_capsule"><a class="anchor" href="#configuring-dns-dhcp-and-tftp-on-productname_capsule"></a>3.6. Configuring DNS, DHCP, and TFTP on Capsule&#160;Server</h3>
<div class="paragraph">
<p>To configure the DNS, DHCP, and TFTP services on Capsule&#160;Server, use the <code>satellite-installer</code> command with the options appropriate for your environment.</p>
</div>
<div class="paragraph">
<p>Any changes to the settings require entering the <code>satellite-installer</code> command again.
You can enter the command multiple times and each time it updates all configuration files with the changed values.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have the correct network name (<code>dns-interface</code>) for the DNS server.</p>
</li>
<li>
<p>You must have the correct interface name (<code>dhcp-interface</code>) for the DHCP server.</p>
</li>
<li>
<p>Contact your network administrator to ensure that you have the correct settings.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the <code>satellite-installer</code> command with the options appropriate for your environment.
The following example shows configuring full provisioning services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer \
--foreman-proxy-dns true \
--foreman-proxy-dns-managed true \
--foreman-proxy-dns-zone <em>example.com</em> \
--foreman-proxy-dns-reverse <em>2.0.192.in-addr.arpa</em> \
--foreman-proxy-dhcp true \
--foreman-proxy-dhcp-managed true \
--foreman-proxy-dhcp-range "<em>192.0.2.100</em> <em>192.0.2.150</em>" \
--foreman-proxy-dhcp-gateway <em>192.0.2.1</em> \
--foreman-proxy-dhcp-nameservers <em>192.0.2.2</em> \
--foreman-proxy-tftp true \
--foreman-proxy-tftp-managed true \
--foreman-proxy-tftp-servername <em>192.0.2.3</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can monitor the progress of the <code>satellite-installer</code> command displayed in your prompt.
You can view the logs in <code>/var/log/foreman-installer/satellite.log</code>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the <code>satellite-installer</code> command, enter <code>satellite-installer --help</code>.</p>
</li>
<li>
<p>For more information about configuring DNS, DHCP, and TFTP externally, see <a href="#configuring-external-services">Configuring Capsule&#160;Server with external services</a>.</p>
</li>
<li>
<p>For more information about configuring DHCP, DNS, and TFTP services, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/provisioning_hosts/index#Configuring_Network_Services_provisioning">Configuring Network Services</a> in <em>Provisioning hosts</em>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-external-services"><a class="anchor" href="#configuring-external-services"></a>4. Configuring Capsule&#160;Server with external services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you do not want to configure the DNS, DHCP, and TFTP services on Capsule&#160;Server, use this section to configure your Capsule&#160;Server to work with external DNS, DHCP, and TFTP services.</p>
</div>
<div class="sect2">
<h3 id="configuring-external-dns_capsule"><a class="anchor" href="#configuring-external-dns_capsule"></a>4.1. Configuring Capsule&#160;Server with external DNS</h3>
<div class="paragraph">
<p>You can configure Capsule&#160;Server with external DNS.
Capsule&#160;Server uses the <code>nsupdate</code> utility to update DNS records on the remote server.</p>
</div>
<div class="paragraph">
<p>To make any changes persistent, you must enter the <code>satellite-installer</code> command with the options appropriate for your environment.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have a configured external DNS server.</p>
</li>
<li>
<p>This guide assumes you have an existing installation.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the <code>/etc/rndc.key</code> file from the external DNS server to Capsule&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp root@<em>dns.example.com</em>:/etc/rndc.key /etc/foreman-proxy/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Configure the ownership, permissions, and SELinux context:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -v /etc/foreman-proxy/rndc.key
# chown -v root:foreman-proxy /etc/foreman-proxy/rndc.key
# chmod -v 640 /etc/foreman-proxy/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>To test the <code>nsupdate</code> utility, add a host remotely:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server <em>DNS_IP_Address</em>\n \
update add aaa.example.com 3600 IN A <em>Host_IP_Address</em>\n \
send\n" | nsupdate -k /etc/foreman-proxy/rndc.key
# nslookup aaa.example.com <em>DNS_IP_Address</em>
# echo -e "server <em>DNS_IP_Address</em>\n \
update delete aaa.example.com 3600 IN A <em>Host_IP_Address</em>\n \
send\n" | nsupdate -k /etc/foreman-proxy/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>satellite-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/dns.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --foreman-proxy-dns=true \
--foreman-proxy-dns-managed=false \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="<em>DNS_IP_Address</em>" \
--foreman-proxy-keyfile=/etc/foreman-proxy/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong>.</p>
</li>
<li>
<p>Locate the Capsule&#160;Server and select <strong>Refresh</strong> from the list in the <strong>Actions</strong> column.</p>
</li>
<li>
<p>Associate the DNS service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-dhcp_capsule"><a class="anchor" href="#configuring-external-dhcp_capsule"></a>4.2. Configuring Capsule&#160;Server with external DHCP</h3>
<div class="paragraph">
<p>To configure Capsule&#160;Server with external DHCP, you must complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#configuring-an-external-dhcp-server_capsule">Configuring an external DHCP server to use with Capsule&#160;Server</a></p>
</li>
<li>
<p><a href="#Configuring_Server_with_an_External_DHCP_Server_capsule">Configuring Satellite&#160;Server with an external DHCP server</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="configuring-an-external-dhcp-server_capsule"><a class="anchor" href="#configuring-an-external-dhcp-server_capsule"></a>4.2.1. Configuring an external DHCP server to use with Capsule&#160;Server</h4>
<div class="paragraph">
<p>To configure an external DHCP server running Red&#160;Hat Enterprise Linux to use with Capsule&#160;Server, you must install the ISC DHCP Service and Berkeley Internet Name Domain (BIND) utilities packages.
You must also share the DHCP configuration and lease files with Capsule&#160;Server.
The example in this procedure uses the distributed Network File System (NFS) protocol to share the DHCP configuration and lease files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you use dnsmasq as an external DHCP server, enable the <code>dhcp-no-override</code> setting.
This is required because Satellite creates configuration files on the TFTP server under the <code>grub2/</code> subdirectory.
If the <code>dhcp-no-override</code> setting is disabled, hosts fetch the bootloader and its configuration from the root directory, which might cause an error.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Red&#160;Hat Enterprise Linux host, install the ISC DHCP Service and Berkeley Internet Name Domain (BIND) utilities packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install dhcp-server bind-utils</pre>
</div>
</div>
</li>
<li>
<p>Generate a security token:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># tsig-keygen -a hmac-md5 omapi_key</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>dhcpd</code> configuration file for all subnets and add the key generated by <code>tsig-keygen</code>.
The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/dhcp/dhcpd.conf
default-lease-time 604800;
max-lease-time 2592000;
log-facility local7;

subnet <em>192.168.38.0</em> netmask <em>255.255.255.0</em> {
	range <em>192.168.38.10 192.168.38.100</em>;
	option routers <em>192.168.38.1</em>;
	option subnet-mask <em>255.255.255.0</em>;
	option domain-search "<em>virtual.lan</em>";
	option domain-name "<em>virtual.lan</em>";
	option domain-name-servers <em>8.8.8.8</em>;
}

omapi-port 7911;
key omapi_key {
	algorithm hmac-md5;
	secret "<em>My_Secret</em>";
};
omapi-key omapi_key;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>option routers</code> value is the IP address of your Satellite&#160;Server or Capsule&#160;Server that you want to use with an external DHCP service.</p>
</div>
</li>
<li>
<p>On Satellite&#160;Server, define each subnet.
Do not set DHCP Capsule for the defined Subnet yet.</p>
<div class="paragraph">
<p>To prevent conflicts, set up the lease and reservation ranges separately.
For example, if the lease range is 192.168.38.10 to 192.168.38.100, in the Satellite web UI define the reservation range as 192.168.38.101 to 192.168.38.250.</p>
</div>
</li>
<li>
<p>Configure the firewall for external access to the DHCP server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-service dhcp</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>On Satellite&#160;Server, determine the UID and GID of the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id -u foreman
<em>993</em>
# id -g foreman
<em>990</em></pre>
</div>
</div>
</li>
<li>
<p>On the DHCP server, create the <code>foreman</code> user and group with the same IDs as determined in a previous step:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># groupadd -g <em>990</em> foreman
# useradd -u <em>993</em> -g <em>990</em> -s /sbin/nologin foreman</pre>
</div>
</div>
</li>
<li>
<p>To ensure that the configuration files are accessible, restore the read and execute flags:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod o+rx /etc/dhcp/
# chmod o+r /etc/dhcp/dhcpd.conf
# chattr +i /etc/dhcp/ /etc/dhcp/dhcpd.conf</pre>
</div>
</div>
</li>
<li>
<p>Enable and start the DHCP service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl enable --now dhcpd</pre>
</div>
</div>
</li>
<li>
<p>Export the DHCP configuration and lease files using NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install nfs-utils
# systemctl enable --now nfs-server</pre>
</div>
</div>
</li>
<li>
<p>Create directories for the DHCP configuration and lease files that you want to export using NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /exports/var/lib/dhcpd /exports/etc/dhcp</pre>
</div>
</div>
</li>
<li>
<p>To create mount points for the created directories, add the following line to the <code>/etc/fstab</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/var/lib/dhcpd /exports/var/lib/dhcpd none bind,auto 0 0
/etc/dhcp /exports/etc/dhcp none bind,auto 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems in <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>Ensure the following lines are present in <code>/etc/exports</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/exports <em>192.168.38.1</em>(rw,async,no_root_squash,fsid=0,no_subtree_check)

/exports/etc/dhcp <em>192.168.38.1</em>(ro,async,no_root_squash,no_subtree_check,nohide)

/exports/var/lib/dhcpd <em>192.168.38.1</em>(ro,async,no_root_squash,no_subtree_check,nohide)</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the IP address that you enter is the Satellite or Capsule IP address that you want to use with an external DHCP service.</p>
</div>
</li>
<li>
<p>Reload the NFS server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># exportfs -rva</pre>
</div>
</div>
</li>
<li>
<p>Configure the firewall for DHCP omapi port 7911:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port=7911/tcp</pre>
</div>
</div>
</li>
<li>
<p>Optional: Configure the firewall for external access to NFS.
Clients are configured using NFSv3.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd \
--add-service mountd \
--add-service nfs \
--add-service rpc-bind \
--zone public</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Server_with_an_External_DHCP_Server_capsule"><a class="anchor" href="#Configuring_Server_with_an_External_DHCP_Server_capsule"></a>4.2.2. Configuring Satellite&#160;Server with an external DHCP server</h4>
<div class="paragraph">
<p>You can configure Capsule&#160;Server with an external DHCP server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you have configured an external DHCP server and that you have shared the DHCP configuration and lease files with Capsule&#160;Server.
For more information, see <a href="#configuring-an-external-dhcp-server_capsule">Configuring an external DHCP server to use with Capsule&#160;Server</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the <code>nfs-utils</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-maintain packages install nfs-utils</pre>
</div>
</div>
</li>
<li>
<p>Create the DHCP directories for NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /mnt/nfs/etc/dhcp /mnt/nfs/var/lib/dhcpd</pre>
</div>
</div>
</li>
<li>
<p>Change the file owner:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R foreman-proxy /mnt/nfs</pre>
</div>
</div>
</li>
<li>
<p>Verify communication with the NFS server and the Remote Procedure Call (RPC) communication paths:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># showmount -e <em>DHCP_Server_FQDN</em>
# rpcinfo -p <em>DHCP_Server_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>Add the following lines to the <code>/etc/fstab</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>DHCP_Server_FQDN</em>:/exports/etc/dhcp /mnt/nfs/etc/dhcp nfs
ro,vers=3,auto,nosharecache,context="system_u:object_r:dhcp_etc_t:s0" 0 0

<em>DHCP_Server_FQDN</em>:/exports/var/lib/dhcpd /mnt/nfs/var/lib/dhcpd nfs
ro,vers=3,auto,nosharecache,context="system_u:object_r:dhcpd_state_t:s0" 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems on <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>To verify that the <code>foreman-proxy</code> user can access the files that are shared over the network, display the DHCP configuration and lease files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su foreman-proxy -s /bin/bash
$ cat /mnt/nfs/etc/dhcp/dhcpd.conf
$ cat /mnt/nfs/var/lib/dhcpd/dhcpd.leases
$ exit</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>satellite-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/dhcp.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer \
--enable-foreman-proxy-plugin-dhcp-remote-isc \
--foreman-proxy-dhcp-provider=remote_isc \
--foreman-proxy-dhcp-server=<em>My_DHCP_Server_FQDN</em> \
--foreman-proxy-dhcp=true \
--foreman-proxy-plugin-dhcp-remote-isc-dhcp-config /mnt/nfs/etc/dhcp/dhcpd.conf \
--foreman-proxy-plugin-dhcp-remote-isc-dhcp-leases /mnt/nfs/var/lib/dhcpd/dhcpd.leases \
--foreman-proxy-plugin-dhcp-remote-isc-key-name=omapi_key \
--foreman-proxy-plugin-dhcp-remote-isc-key-secret=<em>My_Secret</em> \
--foreman-proxy-plugin-dhcp-remote-isc-omapi-port=7911</pre>
</div>
</div>
</li>
<li>
<p>Associate the DHCP service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-tftp_capsule"><a class="anchor" href="#configuring-external-tftp_capsule"></a>4.3. Configuring Capsule&#160;Server with external TFTP</h3>
<div class="paragraph">
<p>You can configure Capsule&#160;Server with external TFTP services.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the TFTP directory for NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /mnt/nfs/var/lib/tftpboot</pre>
</div>
</div>
</li>
<li>
<p>In the <code>/etc/fstab</code> file, add the following line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>TFTP_Server_IP_Address</em>:/exports/var/lib/tftpboot /mnt/nfs/var/lib/tftpboot nfs rw,vers=3,auto,nosharecache,context="system_u:object_r:tftpdir_rw_t:s0" 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems in <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>satellite-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/tftp.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer \
--foreman-proxy-tftp-root /mnt/nfs/var/lib/tftpboot \
--foreman-proxy-tftp=true</pre>
</div>
</div>
</li>
<li>
<p>If the TFTP service is running on a different server than the DHCP service, update the <code>tftp_servername</code> setting with the FQDN or IP address of the server that the TFTP service is running on:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --foreman-proxy-tftp-servername=<em>TFTP_Server_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong>.</p>
</li>
<li>
<p>Locate the Capsule&#160;Server and select <strong>Refresh</strong> from the list in the <strong>Actions</strong> column.</p>
</li>
<li>
<p>Associate the TFTP service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-idm-dns_capsule"><a class="anchor" href="#configuring-external-idm-dns_capsule"></a>4.4. Configuring Capsule&#160;Server with external IdM DNS</h3>
<div class="paragraph">
<p>When Satellite&#160;Server adds a DNS record for a host, it first determines which Capsule is providing DNS for that domain.
It then communicates with the Capsule that is configured to provide DNS service for your deployment and adds the record.
The hosts are not involved in this process.
Therefore, you must install and configure the IdM client on the Satellite or Capsule that is currently configured to provide a DNS service for the domain you want to manage using the IdM server.</p>
</div>
<div class="paragraph">
<p>Capsule&#160;Server can be configured to use a Red&#160;Hat Identity Management (IdM) server to provide DNS service.
For more information about Red&#160;Hat Identity Management, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/linux_domain_identity_authentication_and_policy_guide/">Linux Domain Identity, Authentication, and Policy Guide</a>.</p>
</div>
<div class="paragraph">
<p>To configure Capsule&#160;Server to use a Red&#160;Hat Identity Management (IdM) server to provide DNS service, use one of the following procedures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuring-dynamic-dns-update-with-gss-tsig-authentication_capsule">Configuring dynamic DNS update with GSS-TSIG authentication</a></p>
</li>
<li>
<p><a href="#configuring-dynamic-dns-update-with-tsig-authentication_capsule">Configuring dynamic DNS update with TSIG authentication</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To revert to internal DNS service, use the following procedure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#reverting-to-internal-dns-service_capsule">Reverting to internal DNS service</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You are not required to use Capsule&#160;Server to manage DNS.
When you are using the realm enrollment feature of Satellite, where provisioned hosts are enrolled automatically to IdM, the <code>ipa-client-install</code> script creates DNS records for the client.
Configuring Capsule&#160;Server with external IdM DNS and realm enrollment are mutually exclusive.
For more information about configuring realm enrollment, see
<a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_satellite_server_in_a_connected_network_environment/index#External_Authentication_for_Provisioned_Hosts_satellite">External Authentication for Provisioned Hosts</a> in <em>Installing Satellite&#160;Server in a connected network environment</em>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-dynamic-dns-update-with-gss-tsig-authentication_capsule"><a class="anchor" href="#configuring-dynamic-dns-update-with-gss-tsig-authentication_capsule"></a>4.4.1. Configuring dynamic DNS update with GSS-TSIG authentication</h4>
<div class="paragraph">
<p>You can configure the IdM server to use the generic security service algorithm for secret key transaction (GSS-TSIG) technology defined in <a href="https://tools.ietf.org/html/rfc3645">RFC3645</a>.
To configure the IdM server to use the GSS-TSIG technology, you must install the IdM client on the Capsule&#160;Server base operating system.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must ensure the IdM server is deployed and the host-based firewall is configured correctly.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_identity_management/index#port-requirements-for-idm_preparing-the-system-for-ipa-server-installation">Port Requirements for IdM</a> in the <em>Installing Identity Management Guide</em>.</p>
</li>
<li>
<p>You must contact the IdM server administrator to ensure that you obtain an account on the IdM server with permissions to create zones on the IdM server.</p>
</li>
<li>
<p>You should create a backup of the answer file.
You can use the backup to restore the answer file to its original state if it becomes corrupted.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_satellite_server_in_a_connected_network_environment/index#configuring-server_satellite">Configuring Satellite&#160;Server</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure dynamic DNS update with GSS-TSIG authentication, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Creating a Kerberos principal on the IdM server</div>
<ol class="arabic">
<li>
<p>Obtain a Kerberos ticket for the account obtained from the IdM administrator:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit <em>idm_user</em></pre>
</div>
</div>
</li>
<li>
<p>Create a new Kerberos principal for Capsule&#160;Server to use to authenticate on the IdM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa service-add <em>capsule.example.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Installing and configuring the idM client</div>
<ol class="arabic">
<li>
<p>On the base operating system of either the Satellite or Capsule that is managing the DNS service for your deployment, install the <code>ipa-client</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-maintain packages install ipa-client</pre>
</div>
</div>
</li>
<li>
<p>Configure the IdM client by running the installation script and following the on-screen prompts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install</pre>
</div>
</div>
</li>
<li>
<p>Obtain a Kerberos ticket:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit admin</pre>
</div>
</div>
</li>
<li>
<p>Remove any preexisting <code>keytab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
</li>
<li>
<p>Obtain the <code>keytab</code> for this system:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-getkeytab -p capsule/<em>satellite.example.com@EXAMPLE.COM</em> \
-s <em>idm1.example.com</em> -k /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When adding a keytab to a standby system with the same host name as the original system in service, add the <code>r</code> option to prevent generating new credentials and rendering the credentials on the original system invalid.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For the <code>dns.keytab</code> file, set the group and owner to <code>foreman-proxy</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown foreman-proxy:foreman-proxy /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
</li>
<li>
<p>Optional: To verify that the <code>keytab</code> file is valid, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit -kt /etc/foreman-proxy/dns.keytab \
capsule/<em>satellite.example.com@EXAMPLE.COM</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Configuring DNS zones in the IdM web UI</div>
<ol class="arabic">
<li>
<p>Create and configure the zone that you want to manage:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.</p>
</li>
<li>
<p>Select <strong>Add</strong> and enter the zone name.
For example, <code>example.com</code>.</p>
</li>
<li>
<p>Click <strong>Add and Edit</strong>.</p>
</li>
<li>
<p>Click the Settings tab and in the <strong>BIND update policy</strong> box, add the following to the semi-colon separated list:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant capsule\047<em>satellite.example.com@EXAMPLE.COM</em> wildcard * ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Enable <strong>Allow PTR sync</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create and configure the reverse zone:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Select <strong>Reverse zone IP network</strong> and add the network address in CIDR format to enable reverse lookups.</p>
</li>
<li>
<p>Click <strong>Add and Edit</strong>.</p>
</li>
<li>
<p>Click the <strong>Settings</strong> tab and in the <strong>BIND update policy</strong> box, add the following to the semi-colon separated list:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant capsule\047<em>satellite.example.com@EXAMPLE.COM</em> wildcard * ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Configuring the Satellite or Capsule&#160;Server that manages the DNS service for the domain</div>
<ol class="arabic">
<li>
<p>Configure your Satellite&#160;Server or Capsule&#160;Server to connect to your DNS service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer \
--foreman-proxy-dns-managed=false \
--foreman-proxy-dns-provider=nsupdate_gss \
--foreman-proxy-dns-server="<em>idm1.example.com</em>" \
--foreman-proxy-dns-tsig-keytab=/etc/foreman-proxy/dns.keytab \
--foreman-proxy-dns-tsig-principal="capsule/<em>satellite.example.com@EXAMPLE.COM</em>" \
--foreman-proxy-dns=true</pre>
</div>
</div>
</li>
<li>
<p>For each affected Capsule, update the configuration of that Capsule in the Satellite web UI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong>, locate the Capsule&#160;Server, and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Configure the domain:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and select the domain name.</p>
</li>
<li>
<p>In the <strong>Domain</strong> tab, ensure <strong>DNS Capsule</strong> is set to the Capsule where the subnet is connected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the subnet:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> and select the subnet name.</p>
</li>
<li>
<p>In the <strong>Subnet</strong> tab, set <strong>IPAM</strong> to <strong>None</strong>.</p>
</li>
<li>
<p>In the <strong>Domains</strong> tab, select the domain that you want to manage using the IdM server.</p>
</li>
<li>
<p>In the <strong>Capsules</strong> tab, ensure <strong>Reverse DNS Capsule</strong> is set to the Capsule where the subnet is connected.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-dynamic-dns-update-with-tsig-authentication_capsule"><a class="anchor" href="#configuring-dynamic-dns-update-with-tsig-authentication_capsule"></a>4.4.2. Configuring dynamic DNS update with TSIG authentication</h4>
<div class="paragraph">
<p>You can configure an IdM server to use the secret key transaction authentication for DNS (TSIG) technology that uses the <code>rndc.key</code> key file for authentication.
The TSIG protocol is defined in <a href="https://tools.ietf.org/html/rfc2845">RFC2845</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must ensure the IdM server is deployed and the host-based firewall is configured correctly.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/linux_domain_identity_authentication_and_policy_guide/installing-ipa#prereq-ports">Port Requirements</a> in the <em>Linux Domain Identity, Authentication, and Policy Guide</em>.</p>
</li>
<li>
<p>You must obtain <code>root</code> user access on the IdM server.</p>
</li>
<li>
<p>You must confirm whether Satellite&#160;Server or Capsule&#160;Server is configured to provide DNS service for your deployment.</p>
</li>
<li>
<p>You must configure DNS, DHCP and TFTP services on the base operating system of either the Satellite or Capsule that is managing the DNS service for your deployment.</p>
</li>
<li>
<p>You must create a backup of the answer file.
You can use the backup to restore the answer file to its original state if it becomes corrupted.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_satellite_server_in_a_connected_network_environment/index#configuring-server_satellite">Configuring Satellite&#160;Server</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure dynamic DNS update with TSIG authentication, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Enabling external updates to the DNS zone in the IdM server</div>
<ol class="arabic">
<li>
<p>On the IdM Server, add the following to the top of the <code>/etc/named.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">########################################################################

include "/etc/rndc.key";
controls  {
inet _IdM_Server_IP_Address_ port 953 allow { _Satellite_IP_Address_; } keys { "rndc-key"; };
};
########################################################################</pre>
</div>
</div>
</li>
<li>
<p>Reload the <code>named</code> service to make the changes take effect:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl reload named</pre>
</div>
</div>
</li>
<li>
<p>In the IdM web UI, navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong> and click the name of the zone.
In the <strong>Settings</strong> tab, apply the following changes:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add the following in the <code>BIND update policy</code> box:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant "rndc-key" zonesub ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Click <strong>Update</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Copy the <code>/etc/rndc.key</code> file from the IdM server to the base operating system of your Satellite&#160;Server.
Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /etc/rndc.key root@<em>satellite.example.com</em>:/etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>To set the correct ownership, permissions, and SELinux context for the <code>rndc.key</code> file, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -v /etc/rndc.key
# chown -v root:named /etc/rndc.key
# chmod -v 640 /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.
Normally, satellite-installer ensures that the <code>foreman-proxy</code> user belongs to the <code>named</code> UNIX group, however, in this scenario Satellite does not manage users and groups, therefore you need to assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># usermod -a -G named foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>On Satellite&#160;Server, enter the following <code>satellite-installer</code> command to configure Satellite to use the external DNS server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer \
--foreman-proxy-dns-managed=false \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="<em>IdM_Server_IP_Address</em>" \
--foreman-proxy-dns-ttl=86400 \
--foreman-proxy-dns=true \
--foreman-proxy-keyfile=/etc/rndc.key</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Testing external updates to the DNS zone in the IdM server</div>
<ol class="arabic">
<li>
<p>Ensure that the key in the <code>/etc/rndc.key</code> file on Satellite&#160;Server is the same key file that is used on the IdM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">key "rndc-key" {
        algorithm hmac-md5;
        secret "<em>secret-key</em>==";
};</pre>
</div>
</div>
</li>
<li>
<p>On Satellite&#160;Server, create a test DNS entry for a host.
For example, host <code><em>test.example.com</em></code> with an A record of <code>192.168.25.20</code> on the IdM server at <code>192.168.25.1</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server 192.168.25.1\n \
update add <em>test.example.com</em> 3600 IN A 192.168.25.20\n \
send\n" | nsupdate -k /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>On Satellite&#160;Server, test the DNS entry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># nslookup <em>test.example.com</em> 192.168.25.1
Server:		192.168.25.1
Address:	192.168.25.1#53

Name:	test.example.com
Address: 192.168.25.20</pre>
</div>
</div>
</li>
<li>
<p>To view the entry in the IdM web UI, navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.
Click the name of the zone and search for the host by name.</p>
</li>
<li>
<p>If resolved successfully, remove the test DNS entry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server 192.168.25.1\n \
update delete <em>test.example.com</em> 3600 IN A 192.168.25.20\n \
send\n" | nsupdate -k /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the DNS entry was removed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># nslookup <em>test.example.com</em> 192.168.25.1</pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>nslookup</code> command fails and returns the <code>SERVFAIL</code> error message if the record was successfully deleted.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="reverting-to-internal-dns-service_capsule"><a class="anchor" href="#reverting-to-internal-dns-service_capsule"></a>4.4.3. Reverting to internal DNS service</h4>
<div class="paragraph">
<p>You can revert to using Satellite&#160;Server and Capsule&#160;Server as your DNS providers.
You can use a backup of the answer file that was created before configuring external DNS, or you can create a backup of the answer file.
For more information about answer files, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_satellite_server_in_a_connected_network_environment/index#configuring-server_satellite">Configuring Satellite&#160;Server</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On the Satellite or Capsule&#160;Server that you want to configure to manage DNS service for the domain, complete the following steps:</p>
</div>
<div class="ulist">
<div class="title">Configuring Satellite or Capsule as a DNS server</div>
<ul>
<li>
<p>If you have created a backup of the answer file before configuring external DNS, restore the answer file and then enter the <code>satellite-installer</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer</pre>
</div>
</div>
</li>
<li>
<p>If you do not have a suitable backup of the answer file, create a backup of the answer file now.
To configure Satellite or Capsule as DNS server without using an answer file, enter the following <code>satellite-installer</code> command on Satellite or Capsule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer \
--foreman-proxy-dns-managed=true \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="127.0.0.1" \
--foreman-proxy-dns=true</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_capsule_server/index#configuring-dns-dhcp-and-tftp_capsule">Configuring DNS, DHCP, and TFTP on Capsule&#160;Server</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you run the <code>satellite-installer</code> command to make any changes to your Capsule configuration, you must update the configuration of each affected Capsule in the Satellite web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Updating the configuration in the Satellite web UI</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong>.</p>
</li>
<li>
<p>For each Capsule that you want to update, from the <strong>Actions</strong> list, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Configure the domain:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and click the domain name that you want to configure.</p>
</li>
<li>
<p>In the <strong>Domain</strong> tab, set <strong>DNS Capsule</strong> to the Capsule where the subnet is connected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the subnet:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> and select the subnet name.</p>
</li>
<li>
<p>In the <strong>Subnet</strong> tab, set <strong>IPAM</strong> to <strong>DHCP</strong> or <strong>Internal DB</strong>.</p>
</li>
<li>
<p>In the <strong>Domains</strong> tab, select the domain that you want to manage using Satellite or Capsule.</p>
</li>
<li>
<p>In the <strong>Capsules</strong> tab, set <strong>Reverse DNS Capsule</strong> to the Capsule where the subnet is connected.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Managing_DHCP_Using_Smart_Proxy_capsule"><a class="anchor" href="#Managing_DHCP_Using_Smart_Proxy_capsule"></a>5. Managing DHCP using Capsule</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Satellite can integrate with a DHCP service using your Capsule.
A Capsule has multiple DHCP providers that you can use to integrate Satellite with your existing DHCP infrastructure or deploy a new one.
You can use the DHCP module of Capsule to query for available IP addresses, add new, and delete existing reservations.
Note that your Capsule cannot manage subnet declarations.</p>
</div>
<div class="ulist">
<div class="title">Available DHCP providers</div>
<ul>
<li>
<p><code>dhcp_infoblox</code> &#8211; For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/provisioning_hosts/index#Using_Infoblox_as_DHCP_and_DNS_Providers_provisioning">Using Infoblox as DHCP and DNS Providers</a> in <em>Provisioning hosts</em>.</p>
</li>
<li>
<p><code>dhcp_isc</code> &#8211; ISC DHCP server over OMAPI.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_capsule_server/index#configuring-dns-dhcp-and-tftp_capsule">Configuring DNS, DHCP, and TFTP on Capsule&#160;Server</a> in <em>Installing Capsule Server</em>.</p>
</li>
<li>
<p><code>dhcp_remote_isc</code> &#8211; ISC DHCP server over OMAPI with leases mounted through networking.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/installing_capsule_server/index#configuring-external-dhcp_capsule">Configuring an External DHCP Server to Use with Capsule&#160;Server</a> in <em>Installing Capsule Server</em>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="Securing_the_dhcpd_API_capsule"><a class="anchor" href="#Securing_the_dhcpd_API_capsule"></a>5.1. Securing the dhcpd API</h3>
<div class="paragraph">
<p>Capsule interacts with DHCP daemon using the dhcpd API to manage DHCP.
By default, the dhcpd API listens to any host without access control.
You can add an <code>omapi_key</code> to provide basic security.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Capsule, install the required packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-maintain packages install bind-utils</pre>
</div>
</div>
</li>
<li>
<p>Generate a key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnssec-keygen -r /dev/urandom -a HMAC-MD5 -b 512 -n HOST omapi_key
# cat Komapi_key.+*.private | grep ^Key|cut -d ' ' -f2-</pre>
</div>
</div>
</li>
<li>
<p>Use <code>satellite-installer</code> to secure the dhcpd API:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer \
--foreman-proxy-dhcp-key-name "<em>My_Name</em>" \
--foreman-proxy-dhcp-key-secret "<em>My_Secret</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Managing_DNS_Using_Smart_Proxy_capsule"><a class="anchor" href="#Managing_DNS_Using_Smart_Proxy_capsule"></a>6. Managing DNS using Capsule</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Satellite can manage DNS records using your Capsule.
DNS management contains updating and removing DNS records from existing DNS zones.
A Capsule has multiple DNS providers that you can use to integrate Satellite with your existing DNS infrastructure or deploy a new one.</p>
</div>
<div class="paragraph">
<p>After you have enabled DNS, your Capsule can manipulate any DNS server that complies with RFC 2136 using the <code>dns_nsupdate</code> provider.
Other providers provide more direct integration, such as <code>dns_infoblox</code> for <a href="https://www.infoblox.com/">Infoblox</a>.</p>
</div>
<div class="ulist">
<div class="title">Available DNS providers</div>
<ul>
<li>
<p><code>dns_infoblox</code> &#8211; For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/provisioning_hosts/index#Using_Infoblox_as_DHCP_and_DNS_Providers_provisioning">Using Infoblox as DHCP and DNS Providers</a> in <em>Provisioning hosts</em>.</p>
</li>
<li>
<p><code>dns_nsupdate</code> &#8211; Dynamic DNS update using nsupdate.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_satellite/6.15/html-single/provisioning_hosts/index#Using_Infoblox_as_DHCP_and_DNS_Providers_provisioning">Using Infoblox as DHCP and DNS Providers</a> in <em>Provisioning hosts</em>.</p>
</li>
<li>
<p><code>dns_nsupdate_gss</code> &#8211; Dynamic DNS update with GSS-TSIG.
For more information, see <a href="#configuring-dynamic-dns-update-with-gss-tsig-authentication_capsule">Configuring dynamic DNS update with GSS-TSIG authentication</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="capsule-server-scalability-considerations_capsule"><a class="anchor" href="#capsule-server-scalability-considerations_capsule"></a>Appendix A: Capsule&#160;Server scalability considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The maximum number of Capsule&#160;Servers that Satellite&#160;Server can support has no fixed limit.
It was tested that a Satellite&#160;Server can support 17 Capsule&#160;Servers with 2 vCPUs.
However, scalability is highly variable, especially when managing Puppet clients.</p>
</div>
<div class="paragraph">
<p>Capsule&#160;Server scalability when managing Puppet clients depends on the number of CPUs, the run-interval distribution, and the number of Puppet managed resources.
Capsule&#160;Server has a limitation of 100 concurrent Puppet agents running at any single point in time.
Running more than 100 concurrent Puppet agents results in a 503 HTTP error.</p>
</div>
<div class="paragraph">
<p>For example, assuming that Puppet agent runs are evenly distributed with less than 100 concurrent Puppet agents running at any single point during a run-interval, a Capsule&#160;Server with 4 CPUs has a maximum of 1250&#8202;&#8211;&#8202;1600 Puppet clients with a moderate workload of 10 Puppet classes assigned to each Puppet client.
Depending on the number of Puppet clients required, the Satellite installation can scale out the number of Capsule&#160;Servers to support them.</p>
</div>
<div class="paragraph">
<p>If you want to scale your Capsule&#160;Server when managing Puppet clients, the following assumptions are made:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There are no external Puppet clients reporting directly to the Satellite integrated Capsule.</p>
</li>
<li>
<p>All other Puppet clients report directly to an external Capsule.</p>
</li>
<li>
<p>There is an evenly distributed run-interval of all Puppet agents.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Deviating from the even distribution increases the risk of overloading Satellite&#160;Server.
The limit of 100 concurrent requests applies.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table describes the scalability limits using the recommended 4 CPUs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Puppet scalability using 4 CPUs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Puppet Managed Resources per Host</th>
<th class="tableblock halign-left valign-top">Run-Interval Distribution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3000&#8202;&#8211;&#8202;2500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2400&#8202;&#8211;&#8202;2000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1700&#8202;&#8211;&#8202;1400</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table describes the scalability limits using the minimum 2 CPUs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Puppet scalability using 2 CPUs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Puppet Managed Resources per Host</th>
<th class="tableblock halign-left valign-top">Run-Interval Distribution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1700&#8202;&#8211;&#8202;1450</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1500&#8202;&#8211;&#8202;1250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">850&#8202;&#8211;&#8202;700</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting-dnf-modules_capsule"><a class="anchor" href="#troubleshooting-dnf-modules_capsule"></a>Appendix B: Troubleshooting DNF modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If DNF modules fails to enable, it can mean an incorrect module is enabled.
In that case, you have to resolve dependencies manually as follows.
List the enabled modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module list --enabled</pre>
</div>
</div>
<div class="sect2">
<h3 id="Troubleshooting_Ruby_capsule"><a class="anchor" href="#Troubleshooting_Ruby_capsule"></a>Ruby</h3>
<div class="paragraph">
<p>If Ruby module fails to enable, it can mean an incorrect module is enabled.
In that case, you have to resolve dependencies manually as follows:</p>
</div>
<div class="paragraph">
<p>List the enabled modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module list --enabled</pre>
</div>
</div>
<div class="paragraph">
<p>If the Ruby 2.5 module has already been enabled, perform a module reset:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module reset ruby</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Troubleshooting_Postgresql_capsule"><a class="anchor" href="#Troubleshooting_Postgresql_capsule"></a>PostgreSQL</h3>
<div class="paragraph">
<p>If PostgreSQL module fails to enable, it can mean an incorrect module is enabled.
In that case, you have to resolve dependencies manually as follows:</p>
</div>
<div class="paragraph">
<p>List the enabled modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module list --enabled</pre>
</div>
</div>
<div class="paragraph">
<p>If the PostgreSQL 10 module has already been enabled, perform a module reset:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module reset postgresql</pre>
</div>
</div>
<div class="paragraph">
<p>If a database was previously created using PostgreSQL 10, perform an upgrade:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the DNF modules:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module enable satellite-capsule:el8</pre>
</div>
</div>
</li>
<li>
<p>Install the PostgreSQL upgrade package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install postgresql-upgrade</pre>
</div>
</div>
</li>
<li>
<p>Perform the upgrade:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># postgresql-setup --upgrade</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated Oct 2025
</div>
</div>
</body>
</html>