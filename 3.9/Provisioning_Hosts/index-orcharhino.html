<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Provisioning hosts</title>
<style>
﻿*,::before,::after{box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:100%}body{background:#fff;color:rgba(0,0,0,0.8);padding:0;margin:0;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:inherit;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,p,blockquote,th,td{margin:0;padding:0}a{background:none;color:#2156a5;text-decoration:underline;line-height:inherit}a:active,a:hover{cursor:pointer;outline:0}a:focus{outline:thin dotted}a:hover,a:focus{color:#1d4b8f}abbr{font-size:0.9em}abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}b,strong{font-weight:bold;line-height:inherit}strong strong{font-weight:400}code,kbd,pre{font-family:"Droid Sans Mono", "DejaVu Sans Mono", monospace;font-size:1em}code{font-weight:400;color:rgba(0,0,0,0.9)}pre{color:rgba(0,0,0,0.9);line-height:1.45;text-rendering:optimizeSpeed;white-space:pre-wrap}dfn{font-style:italic}em,i{font-style:italic;line-height:inherit}em em{font-style:normal}hr{border:solid #dddddf;border-width:1px 0 0;clear:both;height:0;margin:1.25em 0 1.1875em}mark{background:#ff0;color:#000}p{line-height:1.6;margin-bottom:1.25rem;text-rendering:optimizeLegibility}q{quotes:"“" "”" "‘" "’"}small{font-size:60%;line-height:inherit}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img,object[type^="image/"],svg{display:inline-block;height:auto;max-width:100%;vertical-align:middle}img{border:0;-ms-interpolation-mode:bicubic}object{max-width:100%}svg:not(:root){overflow:hidden}figure{margin:0}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}.left{float:left !important}.right{float:right !important}.text-left{text-align:left !important}.text-right{text-align:right !important}.text-center{text-align:center !important}.text-justify{text-align:justify !important}.hide{display:none}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:0.25em}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.2;word-spacing:-0.05em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em;margin-left:1.125em}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,0.85)}@media screen and (min-width: 768px){h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;border:1px solid #dedede;border-collapse:collapse;border-spacing:0;margin-bottom:1.25em;word-wrap:normal}table thead,table tfoot{background:#f7f8f7}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,0.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,0.8)}table tr.even,table tr.alt{background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.center{margin-left:auto;margin-right:auto}.stretch{width:100%}.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:"";display:table}.clearfix::after,.float-group::after{clear:both}:not(pre).nobreak{word-wrap:normal}:not(pre).nowrap{white-space:nowrap}:not(pre).pre-wrap{white-space:pre-wrap}:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal !important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}pre>code{display:block}pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}.keyseq{color:rgba(51,51,51,0.8)}kbd{display:inline-block;color:rgba(0,0,0,0.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,0.2),inset 0 0 0 0.1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menuref{color:#000}.menuseq b:not(.caret),.menuref{font-weight:inherit}.menuseq{word-spacing:-0.02em}.menuseq b.caret{font-size:1.25em;line-height:0.8}.menuseq i.caret{font-weight:bold;text-align:center;width:0.45em}b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}b.button::before{content:"[";padding:0 3px 0 2px}b.button::after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,0.9)}body>div[id]{margin:0 auto;max-width:62.5em;position:relative;padding-left:.9375em;padding-right:0.9375em}body>div[id]::before,body>div[id]::after,#content #footnotes::before{content:"";display:table;clear:both}#content{margin-top:1.25em;margin-bottom:0.625em}#content::before{content:none}#header>h1:first-child{color:rgba(0,0,0,0.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,0.6);display:flex;flex-flow:row wrap}#header .details span:first-child{margin-left:-0.125em}#header .details span.email a{color:rgba(0,0,0,0.85)}#header .details br{display:none}#header .details br+span::before{content:" – "}#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,0.85)}#header .details br+span#revremark::before{content:" | "}#header #revnumber{text-transform:capitalize}#header #revnumber::after{content:" "}#content>h1:first-child:not([class]){color:rgba(0,0,0,0.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #e7e7e9;padding-bottom:0.5em}#toc>ul{margin-left:0.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:0.5em 0}#toc ul{font-family:"Open Sans", "DejaVu Sans", sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:0.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media screen and (min-width: 768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0 !important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0 !important;border-bottom-width:0 !important;z-index:1000;padding:1.25em 1em;height:calc(100% - (70px + 2.5em));overflow:auto}#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:0.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}@media screen and (min-width: 1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:0.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:none;background:#025d8c;padding:1.25em;margin-left:2em}#footer-text{color:rgba(255,255,255,0.8);line-height:1.44}.sect1{padding-bottom:0.625em}@media screen and (min-width: 768px){#content{margin-bottom:1.25em}.sect1{padding-bottom:1.25em}}.sect1:last-child{padding-bottom:0}.sect1+.sect1{border-top:1px solid #e7e7e9}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none !important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:0.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}details{margin-left:1.25rem}details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}details>summary::-webkit-details-marker{display:none}details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:1rem;font-style:italic}table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,0.85)}.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans", "DejaVu Sans", sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,0.6);word-wrap:anywhere}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#fffef7;border-radius:4px;box-shadow:0 1px 4px #e0e0dc}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:0.8125em}@media screen and (min-width: 768px){.literalblock pre,.listingblock>.content>pre{font-size:0.90625em}}@media screen and (min-width: 1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,0.9)}.listingblock>.content{position:relative}.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:0.5}.listingblock:hover code[data-lang]::before{display:block}.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:0.5}.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.prettyprint{background:#f7f7f8}pre.prettyprint .linenums{line-height:1.45;margin-left:2em}pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}pre.prettyprint li code[data-lang]::before{opacity:1}pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}table.linenotable td.code{padding-left:0.75em}table.linenotable td.linenos{width:0.01%}table.linenotable td.linenos,pre.pygments .linenos,pre.rouge .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}pre.pygments span.linenos,pre.rouge span.linenos{display:inline-block;margin-right:0.75em}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:0.75em}.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,0.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,0.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}.verseblock{margin:0 1em 1.25em}.verseblock pre{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-size:1.15rem;color:rgba(0,0,0,0.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:0.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,0.6)}.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}.quoteblock.abstract{margin:0 1em 1.25em;display:block}.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:0.25em solid #dddddf}.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}p.tableblock:last-child{margin-bottom:0}td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}td.tableblock>.content>:last-child{margin-bottom:-1.25em}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all>*>tr>*{border-width:1px}table.grid-cols>*>tr>*{border-width:0 1px}table.grid-rows>*>tr>*{border-width:1px 0}table.frame-all{border-width:1px}table.frame-ends{border-width:1px 0}table.frame-sides{border-width:0 1px}table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,0.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:0.625em}ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:0.625em}ul.unstyled,ol.unstyled{margin-left:0}li>p:empty:only-child::before{content:"";display:inline-block}ul.checklist>li>p:first-child{margin-left:-1em}ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:0.125em}ul.checklist>li>p:first-child>input[type=checkbox]:first-child{font:inherit;margin:0 .25em 0 0;padding:0}ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 0.625em -1.25em}ul.inline>li{margin-left:1.25em}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{vertical-align:top;padding:0 0.625em}td.hdlist1{font-weight:bold;padding-bottom:1.25em}td.hdlist2{word-wrap:anywhere}.literalblock+.colist,.listingblock+.colist{margin-top:-0.5em}.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}.colist td:not([class]):first-child img{max-width:none}.colist td:not([class]):last-child{padding:0.25em 0}.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}.imageblock.left{margin:0.25em 0.625em 1.25em 0}.imageblock.right{margin:0.25em 0 1.25em 0.625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 0.125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:0.625em}.image.right{margin-left:0.625em}a.image{text-decoration:none;display:inline-block}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:0.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:0.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:0.75em 0}div.page-break{display:none}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background:#00fafa}.black{color:#000}.black-background{background:#000}.blue{color:#0000bf}.blue-background{background:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background:#fa00fa}.gray{color:#606060}.gray-background{background:#7d7d7d}.green{color:#006000}.green-background{background:#007d00}.lime{color:#00bf00}.lime-background{background:#00fa00}.maroon{color:#600000}.maroon-background{background:#7d0000}.navy{color:#000060}.navy-background{background:#00007d}.olive{color:#606000}.olive-background{background:#7d7d00}.purple{color:#600060}.purple-background{background:#7d007d}.red{color:#bf0000}.red-background{background:#fa0000}.silver{color:#909090}.silver-background{background:#bcbcbc}.teal{color:#006060}.teal-background{background:#007d7d}.white{color:#bfbfbf}.white-background{background:#fafafa}.yellow{color:#bfbf00}.yellow-background{background:#fafa00}span.icon>.fa{cursor:default}a span.icon>.fa{cursor:inherit}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,0.5);cursor:default}.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,0.8);color:#111}.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff !important;background:rgba(0,0,0,0.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans", "DejaVu Sans", sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff !important}.conum[data-value]+b{display:none}.conum[data-value]::after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-0.125em}b.conum *{color:inherit !important}.conum:not([data-value]):empty{display:none}dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}h1,h2,p,td.content,span.alt,summary{letter-spacing:-0.01em}p strong,td.content strong,div.footnote strong{letter-spacing:-0.005em}p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.print-only{display:none !important}@page{margin:1.25cm 0.75cm}@media print{*{box-shadow:none !important;text-shadow:none !important}html{font-size:80%}a{color:inherit !important;text-decoration:underline !important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none !important}a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:0.25em}abbr[title]{border-bottom:1px dotted}abbr[title]::after{content:" (" attr(title) ")"}pre,blockquote,tr,img,object,svg{page-break-inside:avoid}thead{display:table-header-group}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}body>div[id]{max-width:none}#toc,.sidebarblock,.exampleblock>.content{background:none !important}#toc{border-bottom:1px solid #dddddf !important;padding-bottom:0 !important}body.book #header{text-align:center}body.book #header>h1:first-child{border:0 !important;margin:2.5em 0 1em}body.book #header .details{border:0 !important;display:block;padding:0 !important}body.book #header .details span:first-child{margin-left:0 !important}body.book #header .details br{display:block}body.book #header .details br+span::before{content:none !important}body.book #toc{border:0 !important;text-align:left !important;padding:0 !important;margin:0 !important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]::before{display:block}div.page-break{display:block;page-break-after:always}#footer{padding:0 0.9375em}.hide-on-print{display:none !important}.print-only{display:block !important}.hide-for-print{display:none !important}.show-for-print{display:inherit !important}}@media amzn-kf8, print{#header>h1:first-child{margin-top:1.25rem}.sect1{padding:0 !important}.sect1+.sect1{border:0}#footer{background:none}#footer-text{color:rgba(0,0,0,0.6);font-size:0.9em}}@media amzn-kf8{body>div[id]{padding:0}}body{padding:0;margin:0;margin-top:70px !important}.container{position:relative;z-index:1;padding-top:50px;min-height:100%}.container p{font-family:sans-serif;font-size:1.2em}nav{position:fixed;z-index:9999;left:0;right:0;top:0;height:70px;padding:0 1.5em;background-color:#025d8c;font-family:sans-serif;line-height:70px}nav .logo{width:50px;vertical-align:middle}nav .nav-menu{position:absolute;right:0.3em;top:0;padding:0;margin:0;list-style:none}nav .nav-item{display:inline-block}nav .nav-item>a{display:inline-block;padding:0 2.5em;line-height:70px;color:#fff;text-decoration:none}nav .dropdown{position:relative}nav .dropdown a::after{content:"";display:inline-block;margin-left:0.5em;vertical-align:middle;border-top:0.3em solid #fff;border-right:0.3em solid transparent;border-left:0.3em solid transparent}nav .dropdown.show a::after{transform:rotate(180deg)}nav .dropdown-menu{display:none;position:absolute;left:0;right:0;top:100%;padding:0.5em 0;margin-top:-0.5em;border:1px solid rgba(0,0,0,0.3);border-radius:0.5em;background-color:#fff;width:max-content}nav .dropdown-menu-left{left:auto;right:0}nav .dropdown.show .dropdown-menu{display:block}nav .dropdown-div{display:block;padding:0.4em 0;line-height:4em}nav .dropdown-div a::after{content:none;margin-left:0;border-top:0;border-right:0;border-left:0}nav .dropdown-item{display:block;padding:0 1.5em;font-size:0.875em;color:#000;line-height:1.6em;text-decoration:none}nav .btn-hamburger{display:none;position:absolute;right:1.5em;top:50%;background-color:transparent;border:0;cursor:pointer;outline:none;transform:translateY(-50%)}nav .btn-hamburger span{display:block;width:30px;height:4px;background-color:#fff;margin:6px;border-radius:2px;transition:0.3s ease-in-out}nav .btn-hamburger span:nth-child(4),nav .btn-hamburger span:nth-child(5){position:absolute;top:10px;opacity:0.5}nav .btn-hamburger span:nth-child(4){transform:rotate(45deg) scale(0)}nav .btn-hamburger span:nth-child(5){transform:rotate(-45deg) scale(0)}nav.opened .btn-hamburger span:nth-child(4){opacity:1;transform:rotate(45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(5){opacity:1;transform:rotate(-45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(1),nav.opened .btn-hamburger span:nth-child(2),nav.opened .btn-hamburger span:nth-child(3){opacity:0}@media screen and (max-width: 768px){nav .nav-menu{position:fixed;left:0;right:0;top:70px;bottom:100%;display:flex;flex-direction:column;justify-content:start;background-color:#363d4e;transition:bottom 0.5s ease-in-out;overflow:hidden}nav.opened .nav-menu{bottom:0}nav .nav-item>a{display:block}nav .dropdown-menu{position:relative;top:0;margin:0 1.5em}nav .btn-hamburger{display:block}}/*!
* "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License
* https://github.com/simonwhitaker/github-fork-ribbon-css

The MIT License (MIT)

Copyright (c) 2013 Simon Whitaker

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/.github-fork-ribbon,.release-ribbon,.issue-ribbon{width:12.1em;height:12.1em;position:absolute;overflow:hidden;top:70px;right:0;z-index:9998;pointer-events:none;font-size:13px;text-decoration:none;text-indent:-999999px}.github-fork-ribbon.fixed,.fixed.release-ribbon,.fixed.issue-ribbon{position:fixed}.github-fork-ribbon:hover,.release-ribbon:hover,.issue-ribbon:hover,.github-fork-ribbon:active,.release-ribbon:active,.issue-ribbon:active{background-color:transparent}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before,.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{position:absolute;display:block;width:15.38em;height:1.54em;top:3.23em;right:-3.23em;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before{content:"";padding:.38em 0;background-color:#a00;background-image:-webkit-gradient(linear, left top, left bottom, from(transparent), to(rgba(0,0,0,0.15)));background-image:-webkit-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-moz-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-ms-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-o-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:linear-gradient(to bottom, transparent, rgba(0,0,0,0.15));-webkit-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);-moz-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);pointer-events:auto}.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{content:attr(data-ribbon);color:#fff;font:700 1em "Helvetica Neue", Helvetica, Arial, sans-serif;line-height:1.54em;text-decoration:none;text-shadow:0 -0.08em rgba(0,0,0,0.5);text-align:center;text-indent:0;padding:.15em 0;margin:.15em 0;border-width:.08em 0;border-style:dotted;border-color:#fff;border-color:rgba(255,255,255,0.7)}.github-fork-ribbon.left-top,.left-top.release-ribbon,.left-top.issue-ribbon,.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon{right:auto;left:0}.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon,.github-fork-ribbon.right-bottom,.right-bottom.release-ribbon,.right-bottom.issue-ribbon{top:auto;bottom:0}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after{right:auto;left:-3.23em}.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{top:auto;bottom:3.23em}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}.release-ribbon:before{background-color:#a00}.issue-ribbon:before{background-color:#025d8c}@media screen{div.narrow{max-width:1080px;margin:0 auto !important;margin-top:70px auto !important;float:none !important}#toc.toc2{margin-top:70px !important}}

</style>
<!-- docinfo -->
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Provisioning hosts</h1>
<div class="details">
<span id="revnumber">version 6.6 (unsupported),</span>
<span id="revdate">published Oct 10 2025</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Introduction_to_Provisioning_provisioning">1. Introduction to provisioning</a>
<ul class="sectlevel2">
<li><a href="#Provisioning-Methods-in-orcharhino_provisioning">1.1. Provisioning methods in orcharhino</a></li>
<li><a href="#supported-cloud-providers_provisioning">1.2. Supported cloud providers</a></li>
<li><a href="#supported-virtualization-infrastructures_provisioning">1.3. Supported virtualization infrastructures</a></li>
<li><a href="#Network_Boot_Provisioning_Workflow_provisioning">1.4. Network boot provisioning workflow</a></li>
<li><a href="#required-boot-order-for-network-boot_provisioning">1.5. Required boot order for network boot</a></li>
</ul>
</li>
<li><a href="#Configuring_Provisioning_Resources_provisioning">2. Configuring provisioning resources</a>
<ul class="sectlevel2">
<li><a href="#provisioning-contexts_provisioning">2.1. Provisioning contexts</a></li>
<li><a href="#setting-the-provisioning-context_provisioning">2.2. Setting the provisioning context</a></li>
<li><a href="#creating-operating-systems_provisioning">2.3. Creating operating systems</a></li>
<li><a href="#Creating-an-operating-system-for-Debian-12_provisioning">2.4. Creating an operating system for Debian 12</a></li>
<li><a href="#Creating-an-operating-system-for-Debian-11_provisioning">2.5. Creating an operating system for Debian 11</a></li>
<li><a href="#Creating-an-operating-system-for-Ubuntu-24-04_provisioning">2.6. Creating an operating system for Ubuntu 24.04</a></li>
<li><a href="#Creating-an-operating-system-for-Ubuntu-22-04_provisioning">2.7. Creating an operating system for Ubuntu 22.04</a></li>
<li><a href="#updating-the-details-of-multiple-operating-systems_provisioning">2.8. Updating the details of multiple operating systems</a></li>
<li><a href="#creating-architectures_provisioning">2.9. Creating architectures</a></li>
<li><a href="#creating-hardware-models_provisioning">2.10. Creating hardware models</a></li>
<li><a href="#using-a-synchronized-kickstart-repository-for-a-hosts-operating-system_provisioning">2.11. Using a synchronized Kickstart repository for a host&#8217;s operating system</a></li>
<li><a href="#adding-installation-media_provisioning">2.12. Adding installation media to orcharhino</a></li>
<li><a href="#Creating_an_Installation_Medium_for_Debian-Ubuntu_provisioning">2.13. Creating an installation medium for Debian/Ubuntu</a></li>
<li><a href="#Creating_an_Installation_Medium_for_Ubuntu_22_04_provisioning">2.14. Creating an installation medium for Ubuntu 22.04</a></li>
<li><a href="#Provisioning_Ubuntu_Autoinstall_Through_Smart_Proxies_provisioning">2.15. Provisioning Ubuntu autoinstall through orcharhino&#160;Proxies</a></li>
<li><a href="#creating-partition-tables_provisioning">2.16. Creating partition tables</a></li>
<li><a href="#dynamic-partition-example_provisioning">2.17. Dynamic partition example</a></li>
<li><a href="#provisioning-templates_provisioning">2.18. Provisioning templates</a></li>
<li><a href="#kinds-of-provisioning-templates_provisioning">2.19. Kinds of provisioning templates</a></li>
<li><a href="#creating-provisioning-templates_provisioning">2.20. Creating provisioning templates</a></li>
<li><a href="#cloning-provisioning-templates_provisioning">2.21. Cloning provisioning templates</a></li>
<li><a href="#Creating_Custom_Provisioning_Snippets_provisioning">2.22. Creating custom provisioning snippets</a></li>
<li><a href="#Custom_Provisioning_Snippet_Example_for_Debian_provisioning">2.23. Custom provisioning snippet example for Debian</a></li>
<li><a href="#Custom_Provisioning_Snippet_Example_for_Enterprise_Linux_provisioning">2.24. Custom provisioning snippet example for Enterprise Linux</a></li>
<li><a href="#Associating_Templates_with_Operating_Systems_provisioning">2.25. Associating templates with operating systems</a></li>
<li><a href="#creating-compute-profiles_provisioning">2.26. Creating compute profiles</a></li>
<li><a href="#setting-a-default-encrypted-root-password_provisioning">2.27. Setting a default encrypted root password for hosts</a></li>
<li><a href="#using-novnc-to-access-virtual-machines_provisioning">2.28. Using noVNC to access virtual machines</a></li>
</ul>
</li>
<li><a href="#Configuring_Networking_provisioning">3. Configuring networking</a>
<ul class="sectlevel2">
<li><a href="#facts-and-nic-filtering_provisioning">3.1. Facts and NIC filtering</a></li>
<li><a href="#optimizing-performance-by-removing-nics-from-database_provisioning">3.2. Optimizing performance by removing NICs from database</a></li>
<li><a href="#Network_Resources_provisioning">3.3. Network resources</a></li>
<li><a href="#DHCP_Options_provisioning">3.4. orcharhino and DHCP options</a></li>
<li><a href="#Troubleshooting_DHCP_Problems_provisioning">3.5. Troubleshooting DHCP problems in orcharhino</a></li>
<li><a href="#Prerequisites_for_Image_Based_Provisioning_provisioning">3.6. Prerequisites for image-based provisioning</a></li>
<li><a href="#Configuring_Network_Services_provisioning">3.7. Configuring network services</a></li>
<li><a href="#Adding_a_Domain_to_Server_provisioning">3.8. Adding a domain to orcharhino&#160;Server</a></li>
<li><a href="#Adding_a_Subnet_to_Server_provisioning">3.9. Adding a subnet to orcharhino&#160;Server</a></li>
</ul>
</li>
<li><a href="#Using_Infoblox_as_DHCP_and_DNS_Providers_provisioning">4. Using Infoblox as DHCP and DNS providers</a>
<ul class="sectlevel2">
<li><a href="#Infoblox_Limitations_provisioning">4.1. Infoblox limitations</a></li>
<li><a href="#Infoblox_Prerequisites_provisioning">4.2. Infoblox prerequisites</a></li>
<li><a href="#Installing_the_Infoblox_CA_Certificate_on_Smart_Proxy_provisioning">4.3. Installing the Infoblox CA certificate on orcharhino&#160;Proxy</a></li>
<li><a href="#Installing_the_DHCP_Infoblox_Module_provisioning">4.4. Installing the DHCP Infoblox module</a></li>
<li><a href="#Installing_the_DNS_Infoblox_Module_provisioning">4.5. Installing the DNS Infoblox module</a></li>
</ul>
</li>
<li><a href="#Using_PXE_to_Provision_Hosts_provisioning">5. Using PXE to provision hosts</a>
<ul class="sectlevel2">
<li><a href="#Prerequisites_for_Bare_Metal_Provisioning_provisioning">5.1. Prerequisites for bare-metal provisioning</a></li>
<li><a href="#Configuring_the_Security_Token_Validity_Duration_provisioning">5.2. Configuring the security token validity duration</a></li>
<li><a href="#Creating_Hosts_with_Unattended_Provisioning_provisioning">5.3. Creating hosts with unattended provisioning</a></li>
<li><a href="#Creating_Hosts_with_PXE_less_Provisioning_provisioning">5.4. Creating hosts with PXE-less provisioning</a></li>
<li><a href="#Creating_Hosts_with_UEFI_HTTP_Boot_Provisioning_provisioning">5.5. Creating hosts with UEFI HTTP boot provisioning</a></li>
<li><a href="#Deploying_SSH_Keys_During_Provisioning_provisioning">5.6. Deploying SSH keys during provisioning</a></li>
</ul>
</li>
<li><a href="#using-ipxe-to-reduce-provisioning-times_provisioning">6. Using iPXE to reduce provisioning times</a>
<ul class="sectlevel2">
<li><a href="#prerequisites-for-using-ipxe_provisioning">6.1. Prerequisites for using iPXE</a></li>
<li><a href="#Configuring_iPXE_Environment_provisioning">6.2. Configuring iPXE environment</a></li>
<li><a href="#Booting_Virtual_Machines_provisioning">6.3. Booting virtual machines</a></li>
<li><a href="#Chainbooting_iPXE_from_PXELinux_provisioning">6.4. Chainbooting iPXE from PXELinux</a></li>
</ul>
</li>
<li><a href="#Configuring_the_Discovery_Service_provisioning">7. Configuring the Discovery service</a>
<ul class="sectlevel2">
<li><a href="#Installing_the_Discovery_Service_provisioning">7.1. Installing the Discovery service</a></li>
<li><a href="#Provisioning_Template_PXELinux_Discovery_Snippet_provisioning">7.2. Provisioning template PXELinux Discovery snippet</a></li>
<li><a href="#Automatic_Contexts_for_Discovered_Hosts_provisioning">7.3. Automatic contexts for discovered hosts</a></li>
<li><a href="#Discovery_Templates_and_Snippets_Settings_provisioning">7.4. Discovery template and snippet settings</a></li>
<li><a href="#Creating_Hosts_from_Discovered_Hosts_provisioning">7.5. Creating hosts from discovered hosts</a></li>
<li><a href="#Creating_Discovery_Rules_provisioning">7.6. Creating Discovery rules</a></li>
<li><a href="#Implementing_PXE_less_Discovery_provisioning">7.7. Implementing PXE-less Discovery</a></li>
<li><a href="#Building_a_Discovery_Image_provisioning">7.8. Building a Discovery image</a></li>
<li><a href="#Unattended_Use_Customization_and_Image_Remastering_provisioning">7.9. Unattended use, customization, and image remastering</a></li>
<li><a href="#Extending_the_Discovery_Image_provisioning">7.10. Extending the Discovery image</a></li>
<li><a href="#Troubleshooting_Discovery_provisioning">7.11. Troubleshooting Discovery</a></li>
</ul>
</li>
<li><a href="#configuring-orcharhino-to-provision-from-a-builder-image">8. Configuring orcharhino to provision from a Lorax Composer image</a>
<ul class="sectlevel2">
<li><a href="#provisioning-from-a-builder-image-on-orcharhino-proxy">8.1. Provisioning from a Lorax Composer image on orcharhino&#160;Proxy</a></li>
<li><a href="#provisioning-from-a-builder-image-on-an-http-server">8.2. Provisioning from a Lorax Composer image on an HTTP server</a></li>
<li><a href="#packages-required-in-a-builder-image">8.3. Packages required in a Lorax Composer image</a></li>
</ul>
</li>
<li><a href="#Provisioning_Virtual_Machines_on_KVM_kvm-provisioning">9. Provisioning virtual machines on KVM (libvirt)</a>
<ul class="sectlevel2">
<li><a href="#configuring-server-for-kvm-connections_kvm-provisioning">9.1. Configuring orcharhino&#160;Server for KVM connections</a></li>
<li><a href="#adding-kvm-connection_kvm-provisioning">9.2. Adding a KVM connection to orcharhino&#160;Server</a></li>
<li><a href="#adding-images-to-server_kvm-provisioning">9.3. Adding KVM images to orcharhino&#160;Server</a></li>
<li><a href="#adding-kvm-details-to-a-compute-profile_kvm-provisioning">9.4. Adding KVM details to a compute profile</a></li>
<li><a href="#creating-network-or-image-based-hosts_kvm-provisioning">9.5. Creating hosts on KVM</a></li>
</ul>
</li>
<li><a href="#Provisioning_Virtual_Machines_on_oVirt_rhv-provisioning">10. Provisioning virtual machines on oVirt</a>
<ul class="sectlevel2">
<li><a href="#installing-the-oVirt-plugin_rhv-provisioning">10.1. Installing the oVirt plugin</a></li>
<li><a href="#adding-rhv-connection_rhv-provisioning">10.2. Adding the oVirt connection to orcharhino&#160;Server</a></li>
<li><a href="#preparing-cloud-init-images-in-rhv_rhv-provisioning">10.3. Preparing cloud-init images in oVirt</a></li>
<li><a href="#adding-images-to-server_rhv-provisioning">10.4. Adding oVirt images to orcharhino&#160;Server</a></li>
<li><a href="#preparing-a-cloud-init-template_rhv-provisioning">10.5. Preparing a cloud-init template</a></li>
<li><a href="#adding-rhv-details-to-a-compute-profile_rhv-provisioning">10.6. Adding oVirt details to a compute profile</a></li>
<li><a href="#creating-network-or-image-based-hosts_rhv-provisioning">10.7. Creating hosts on oVirt</a></li>
</ul>
</li>
<li><a href="#Provisioning_Virtual_Machines_in_VMware_vmware-provisioning">11. Provisioning virtual machines in VMware vSphere</a>
<ul class="sectlevel2">
<li><a href="#Installing_VMware_plugin_vmware-provisioning">11.1. Installing VMware plugin</a></li>
<li><a href="#Prerequisites_for_VMware_Provisioning_vmware-provisioning">11.2. Prerequisites for VMware provisioning</a></li>
<li><a href="#Creating_a_VMware_User_vmware-provisioning">11.3. Creating a VMware user</a></li>
<li><a href="#Adding_a_VMware_Connection_to_Server_vmware-provisioning">11.4. Adding a VMware connection to orcharhino&#160;Server</a></li>
<li><a href="#Adding_VMware_Images_to_Server_vmware-provisioning">11.5. Adding VMware images to orcharhino&#160;Server</a></li>
<li><a href="#Adding_VMware_Details_to_a_Compute_Profile_vmware-provisioning">11.6. Adding VMware details to a compute profile</a></li>
<li><a href="#Creating_Hosts_on_VMware_vmware-provisioning">11.7. Creating hosts on VMware</a></li>
<li><a href="#Using_VMware_Cloud_Init_and_Userdata_Templates_for_Provisioning_vmware-provisioning">11.8. Using VMware cloud-init and userdata templates for provisioning</a></li>
<li><a href="#Deleting_a_VM_on_VMware_vmware-provisioning">11.9. Deleting a VM on VMware</a></li>
<li><a href="#Importing-a_virtual-machine-from-VMware-into-orcharhino_vmware-provisioning">11.10. Importing a virtual machine from VMware into orcharhino</a></li>
<li><a href="#Caching_of_Compute_Resources_vmware-provisioning">11.11. Caching of compute resources</a></li>
</ul>
</li>
<li><a href="#Provisioning_Virtual_Machines_in_Proxmox_proxmox-provisioning">12. Provisioning virtual machines in Proxmox</a>
<ul class="sectlevel2">
<li><a href="#Installing_the_Proxmox_plugin_proxmox-provisioning">12.1. Installing the Proxmox plugin</a></li>
<li><a href="#Adding_a_Proxmox_Connection_to_orcharhino_proxmox-provisioning">12.2. Adding a Proxmox connection to orcharhino&#160;Server</a></li>
<li><a href="#Adding_Proxmox_Images_to_orcharhino_proxmox-provisioning">12.3. Adding Proxmox images to orcharhino&#160;Server</a></li>
<li><a href="#Adding_Proxmox_Details_to_a_Compute_Profile_proxmox-provisioning">12.4. Adding Proxmox details to a compute profile</a></li>
<li><a href="#Creating_Hosts_on_Proxmox_proxmox-provisioning">12.5. Creating hosts on Proxmox</a></li>
<li><a href="#Deleting_a_Virtual_Machine_on_Proxmox_proxmox-provisioning">12.6. Deleting a virtual machine on Proxmox</a></li>
<li><a href="#Importing-a_virtual-machine-from-Proxmox-into-orcharhino_proxmox-provisioning">12.7. Importing a virtual machine from Proxmox into orcharhino</a></li>
<li><a href="#Adding_a_Remote_Console_Connection_for_a_Host_on_Proxmox_proxmox-provisioning">12.8. Adding a remote console connection for a host on Proxmox</a></li>
</ul>
</li>
<li><a href="#Provisioning_Virtual_Machines_Kubevirt_kubevirt-provisioning">13. Provisioning virtual machines on KubeVirt</a>
<ul class="sectlevel2">
<li><a href="#adding-kubevirt-connection_kubevirt-provisioning">13.1. Adding a KubeVirt connection to orcharhino&#160;Server</a></li>
</ul>
</li>
<li><a href="#Provisioning_Cloud_Instances_OpenStack_openstack-provisioning">14. Provisioning cloud instances on OpenStack</a>
<ul class="sectlevel2">
<li><a href="#adding-openstack-connection_openstack-provisioning">14.1. Adding a OpenStack connection to orcharhino&#160;Server</a></li>
<li><a href="#adding-images-to-server_openstack-provisioning">14.2. Adding OpenStack images to orcharhino&#160;Server</a></li>
<li><a href="#adding-openstack-details-to-a-compute-profile_openstack-provisioning">14.3. Adding OpenStack details to a compute profile</a></li>
<li><a href="#creating-image-only-hosts_openstack-provisioning">14.4. Creating image-based hosts on OpenStack</a></li>
</ul>
</li>
<li><a href="#Provisioning_Cloud_Instances_in_Amazon_EC2_ec2-provisioning">15. Provisioning cloud instances in Amazon EC2</a>
<ul class="sectlevel2">
<li><a href="#Prerequisites_for_Amazon_EC2_Provisioning_ec2-provisioning">15.1. Prerequisites for Amazon EC2 provisioning</a></li>
<li><a href="#Installing_Amazon_EC2_plugin_ec2-provisioning">15.2. Installing Amazon EC2 plugin</a></li>
<li><a href="#Adding_an_Amazon_EC2_Connection_to_Server_ec2-provisioning">15.3. Adding an Amazon EC2 connection to the orcharhino&#160;Server</a></li>
<li><a href="#Using_an_HTTP_Proxy_with_Compute_Resources_Amazon_EC2_ec2-provisioning">15.4. Using an HTTP proxy with compute resources</a></li>
<li><a href="#Creating_an_Image_for_Amazon_EC2_ec2-provisioning">15.5. Creating an image for Amazon EC2</a></li>
<li><a href="#Adding_Amazon_EC2_Images_to_Server_ec2-provisioning">15.6. Adding Amazon EC2 images to orcharhino&#160;Server</a></li>
<li><a href="#Adding_Amazon_EC2_Details_to_a_Compute_Profile_ec2-provisioning">15.7. Adding Amazon EC2 details to a compute profile</a></li>
<li><a href="#Creating_Image_Based_Hosts_on_Amazon_EC2_ec2-provisioning">15.8. Creating image-based hosts on Amazon EC2</a></li>
<li><a href="#Connecting_to_an_Amazon_EC2_Instance_Using_SSH_ec2-provisioning">15.9. Connecting to an Amazon EC2 instance using SSH</a></li>
<li><a href="#Configuring_a_Finish_Template_for_Amazon_EC2_ec2-provisioning">15.10. Configuring a finish template for an Amazon Web Service EC2 environment</a></li>
<li><a href="#Deleting_a_Virtual_Machine_on_Amazon_EC2_ec2-provisioning">15.11. Deleting a virtual machine on Amazon EC2</a></li>
<li><a href="#Uninstalling_Amazon_EC2_plugin_ec2-provisioning">15.12. Uninstalling Amazon EC2 plugin</a></li>
<li><a href="#More_Information_About_Amazon_Web_Services_ec2-provisioning">15.13. More information about Amazon Web Services and orcharhino</a></li>
</ul>
</li>
<li><a href="#Provisioning_Cloud_Instances_on_Google_Compute_Engine_gce-provisioning">16. Provisioning cloud instances on Google Compute Engine</a>
<ul class="sectlevel2">
<li><a href="#Installing_Google_GCE_plugin_gce-provisioning">16.1. Installing Google GCE plugin</a></li>
<li><a href="#Adding_a_Google_GCE_Connection_gce-provisioning">16.2. Adding a Google GCE connection to orcharhino&#160;Server</a></li>
<li><a href="#adding-images-to-server_gce-provisioning">16.3. Adding Google Compute Engine images to orcharhino&#160;Server</a></li>
<li><a href="#Adding_Google_GCE_Details_to_a_Compute_Profile_gce-provisioning">16.4. Adding Google GCE details to a compute profile</a></li>
<li><a href="#creating-image-only-hosts_gce-provisioning">16.5. Creating image-based hosts on Google Compute Engine</a></li>
<li><a href="#Deleting_a_VM_on_Google_GCE_gce-provisioning">16.6. Deleting a VM on Google GCE</a></li>
</ul>
</li>
<li><a href="#Provisioning_Cloud_Instances_on_Microsoft_Azure_Resource_Manager_azure-provisioning">17. Provisioning cloud instances on Microsoft Azure Resource Manager</a>
<ul class="sectlevel2">
<li><a href="#Installing_Microsoft_Azure_plugin_azure-provisioning">17.1. Installing Microsoft Azure plugin</a></li>
<li><a href="#Adding_a_Microsoft_Azure_Resource_Manager_Connection_azure-provisioning">17.2. Adding a Microsoft Azure Resource Manager connection to orcharhino&#160;Server</a></li>
<li><a href="#adding-images-to-server_azure-provisioning">17.3. Adding Microsoft Azure Resource Manager images to orcharhino&#160;Server</a></li>
<li><a href="#Adding_Microsoft_Azure_Resource_Manager_Details_to_a_Compute_Profile_azure-provisioning">17.4. Adding Microsoft Azure Resource Manager details to a compute profile</a></li>
<li><a href="#creating-image-only-hosts_azure-provisioning">17.5. Creating image-based hosts on Microsoft Azure Resource Manager</a></li>
<li><a href="#Deleting_a_VM_on_Microsoft_Azure_azure-provisioning">17.6. Deleting a VM on Microsoft Azure</a></li>
<li><a href="#Uninstalling_Microsoft_Azure_plugin_azure-provisioning">17.7. Uninstalling Microsoft Azure plugin</a></li>
</ul>
</li>
<li><a href="#Provisioning_FIPS_Compliant_Hosts_provisioning">Appendix A: Provisioning FIPS-compliant hosts</a>
<ul class="sectlevel2">
<li><a href="#Changing_the_Provisioning_Password_Hashing_Algorithm_provisioning">A.1. Changing the provisioning password hashing algorithm</a></li>
<li><a href="#Setting_the_FIPS_Enabled_Parameter_provisioning">A.2. Setting the FIPS-enabled parameter</a></li>
<li><a href="#Verifying_FIPS_Mode_Is_Enabled_provisioning">A.3. Verifying FIPS mode is enabled</a></li>
</ul>
</li>
<li><a href="#Host_Parameter_Hierarchy_provisioning">Appendix B: Host parameter hierarchy</a></li>
<li><a href="#permissions-required-to-provision-hosts_provisioning">Appendix C: Permissions required to provision hosts</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="Introduction_to_Provisioning_provisioning"><a class="anchor" href="#Introduction_to_Provisioning_provisioning"></a>1. Introduction to provisioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provisioning is a process that starts with a bare physical or virtual machine and ends with a fully configured, ready-to-use operating system.
Using orcharhino, you can define and automate fine-grained provisioning for a large number of hosts.</p>
</div>
<div class="sect2">
<h3 id="Provisioning-Methods-in-orcharhino_provisioning"><a class="anchor" href="#Provisioning-Methods-in-orcharhino_provisioning"></a>1.1. Provisioning methods in orcharhino</h3>
<div class="paragraph">
<p>With orcharhino, you can provision hosts by using the following methods.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Bare-metal hosts</dt>
<dd>
<p>orcharhino provisions bare-metal hosts primarily by using PXE boot and MAC address identification.
When provisioning bare-metal hosts with orcharhino, you can do the following:</p>
<div class="ulist">
<ul>
<li>
<p>Create host entries and specify the MAC address of the physical host to provision.</p>
</li>
<li>
<p>Boot blank hosts to use the orcharhino Discovery service, which creates a pool of hosts that are ready for provisioning.</p>
</li>
<li>
<p>Boot and provision hosts by using PXE-less methods.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Cloud providers</dt>
<dd>
<p>orcharhino connects to private and public cloud providers to provision instances of hosts from images stored in the cloud environment.
When provisioning from cloud with orcharhino, you can do the following:</p>
<div class="ulist">
<ul>
<li>
<p>Select which hardware profile to use.</p>
</li>
<li>
<p>Provision cloud instances from specific providers by using their APIs.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Virtualization infrastructure</dt>
<dd>
<p>orcharhino connects to virtualization infrastructure services, such as oVirt and VMware.
When provisioning virtual machines with orcharhino, you can do the following:</p>
<div class="ulist">
<ul>
<li>
<p>Provision virtual machines from virtual image templates.</p>
</li>
<li>
<p>Use the same PXE-based boot methods that you use to provision bare-metal hosts.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For more information, see <a href="sources/compute_resources.html">compute resources</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="supported-cloud-providers_provisioning"><a class="anchor" href="#supported-cloud-providers_provisioning"></a>1.2. Supported cloud providers</h3>
<div class="paragraph">
<p>You can connect the following cloud providers as compute resources to orcharhino:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Amazon EC2</p>
</li>
<li>
<p>Google Compute Engine</p>
</li>
<li>
<p>Microsoft Azure</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="supported-virtualization-infrastructures_provisioning"><a class="anchor" href="#supported-virtualization-infrastructures_provisioning"></a>1.3. Supported virtualization infrastructures</h3>
<div class="paragraph">
<p>You can connect the following virtualization infrastructures as compute resources to orcharhino:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KVM (libvirt)</p>
</li>
<li>
<p>oVirt</p>
</li>
<li>
<p>VMware</p>
</li>
<li>
<p>KubeVirt</p>
</li>
<li>
<p>Proxmox</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Network_Boot_Provisioning_Workflow_provisioning"><a class="anchor" href="#Network_Boot_Provisioning_Workflow_provisioning"></a>1.4. Network boot provisioning workflow</h3>
<div class="paragraph">
<p>The provisioning process follows a basic PXE workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You create a host and select a domain and subnet.
orcharhino requests an available IP address from the DHCP orcharhino&#160;Proxy that is associated with the subnet or from the PostgreSQL database in orcharhino.
orcharhino loads this IP address into the <strong>IP address</strong> field in the Create Host window.
When you complete all the options for the new host, submit the new host request.</p>
</li>
<li>
<p>Depending on the configuration specifications of the host and its domain and subnet, orcharhino creates the following settings:</p>
<div class="ulist">
<ul>
<li>
<p>A DHCP record on orcharhino&#160;Proxy that is associated with the subnet.</p>
</li>
<li>
<p>A forward DNS record on orcharhino&#160;Proxy that is associated with the domain.</p>
</li>
<li>
<p>A reverse DNS record on the DNS orcharhino&#160;Proxy that is associated with the subnet.</p>
</li>
<li>
<p>PXELinux, Grub, Grub2, and iPXE configuration files for the host in the TFTP orcharhino&#160;Proxy that is associated with the subnet.</p>
</li>
<li>
<p>A Puppet certificate on the associated Puppet server.</p>
</li>
<li>
<p>A realm on the associated identity server.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The host is configured to boot from the network as the first device and HDD as the second device.</p>
</li>
<li>
<p>The new host requests a DHCP reservation from the DHCP server.</p>
</li>
<li>
<p>The DHCP server responds to the reservation request and returns TFTP <code>next-server</code> and <code>filename</code> options.</p>
</li>
<li>
<p>The host requests the boot loader and menu from the TFTP server according to the PXELoader setting.</p>
</li>
<li>
<p>A boot loader is returned over TFTP.</p>
</li>
<li>
<p>The boot loader fetches configuration for the host through its provisioning interface MAC address.</p>
</li>
<li>
<p>The boot loader fetches the operating system installer kernel, init RAM disk, and boot parameters.</p>
</li>
<li>
<p>The installer requests the provisioning template from orcharhino.</p>
</li>
<li>
<p>orcharhino renders the provision template and returns the result to the host.</p>
</li>
<li>
<p>The installer performs installation of the operating system.</p>
<div class="ulist">
<ul>
<li>
<p>The installer registers the host to orcharhino using Subscription Manager.</p>
</li>
<li>
<p>The installer notifies orcharhino of a successful build in the <code>postinstall</code> script.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The PXE configuration files revert to a local boot template.</p>
</li>
<li>
<p>The host reboots.</p>
</li>
<li>
<p>The new host requests a DHCP reservation from the DHCP server.</p>
</li>
<li>
<p>The DHCP server responds to the reservation request and returns TFTP <code>next-server</code> and <code>filename</code> options.</p>
</li>
<li>
<p>The host requests the bootloader and menu from the TFTP server according to the PXELoader setting.</p>
</li>
<li>
<p>A boot loader is returned over TFTP.</p>
</li>
<li>
<p>The boot loader fetches the configuration for the host through its provision interface MAC address.</p>
</li>
<li>
<p>The boot loader initiates boot from the local drive.</p>
</li>
<li>
<p>If you configured the host to use any Puppet classes, the host configures itself using the modules.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The fully provisioned host performs the following workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The host is configured to boot from the network as the first device and HDD as the second device.</p>
</li>
<li>
<p>The new host requests a DHCP reservation from the DHCP server.</p>
</li>
<li>
<p>The DHCP server responds to the reservation request and returns TFTP <code>next-server</code> and <code>filename</code> options.</p>
</li>
<li>
<p>The host requests the boot loader and menu from the TFTP server according to the PXELoader setting.</p>
</li>
<li>
<p>A boot loader is returned over TFTP.</p>
</li>
<li>
<p>The boot loader fetches the configuration settings for the host through its provisioning interface MAC address.</p>
</li>
<li>
<p>For BIOS hosts:</p>
<div class="ulist">
<ul>
<li>
<p>The boot loader returns non-bootable device so BIOS skips to the next device (boot from HDD).</p>
</li>
</ul>
</div>
</li>
<li>
<p>For EFI hosts:</p>
<div class="ulist">
<ul>
<li>
<p>The boot loader finds Grub2 on a ESP partition and chainboots it.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the host is unknown to orcharhino, a default bootloader configuration is provided. When Discovery service is enabled, it boots into discovery, otherwise it boots from HDD.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This workflow differs depending on custom options.
For example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Discovery</dt>
<dd>
<p>If you use the discovery service, orcharhino automatically detects the MAC address of the new host and restarts the host after you submit a request.
Note that TCP port 8443 must be reachable by the orcharhino&#160;Proxy to which the host is attached for orcharhino to restart the host.</p>
</dd>
<dt class="hdlist1">PXE-less Provisioning</dt>
<dd>
<p>After you submit a new host request, you must boot the specific host with the boot disk that you download from orcharhino and transfer using a USB port of the host.</p>
</dd>
<dt class="hdlist1">Compute Resources</dt>
<dd>
<p>orcharhino creates the virtual machine and retrieves the MAC address and stores the MAC address in orcharhino.
If you use image-based provisioning, the host does not follow the standard PXE boot and operating system installation.
The compute resource creates a copy of the image for the host to use.
Depending on image settings in orcharhino, seed data can be passed in for initial configuration, for example using <code>cloud-init</code>.
orcharhino can connect using SSH to the host and execute a template to finish the customization.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting the provisioned profile host from orcharhino does not destroy the actual VM on the external compute resource.
To destroy the VM when deleting the host entry on orcharhino, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and configure this behavior using the <strong>destroy_vm_on_host_delete</strong> setting.
If you do not destroy the associated VM and attempt to create a new VM with the same resource name later, it will fail because that VM name already exists in the external compute resource.
You can still register the existing VM to orcharhino using the standard host registration workflow you would use for any already provisioned host.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="required-boot-order-for-network-boot_provisioning"><a class="anchor" href="#required-boot-order-for-network-boot_provisioning"></a>1.5. Required boot order for network boot</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">For physical or virtual BIOS hosts</dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the first booting device as boot configuration with network.</p>
</li>
<li>
<p>Set the second booting device as boot from hard drive.
orcharhino manages TFTP boot configuration files, so hosts can be easily provisioned just by rebooting.</p>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1">For physical or virtual EFI hosts</dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the first booting device as boot configuration with network.</p>
</li>
<li>
<p>Depending on the EFI firmware type and configuration, the OS installer typically configures the OS boot loader as the first entry.</p>
</li>
<li>
<p>To reboot into installer again, use the <code>efibootmgr</code> utility to switch back to boot from network.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_Provisioning_Resources_provisioning"><a class="anchor" href="#Configuring_Provisioning_Resources_provisioning"></a>2. Configuring provisioning resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="provisioning-contexts_provisioning"><a class="anchor" href="#provisioning-contexts_provisioning"></a>2.1. Provisioning contexts</h3>
<div class="paragraph">
<p>A provisioning context is the combination of an organization and location that you specify for orcharhino components.
The organization and location that a component belongs to sets the ownership and access for that component.</p>
</div>
<div class="paragraph">
<p>Organizations divide orcharhino components into logical groups based on ownership, purpose, content, security level, and other divisions.
You can create and manage multiple organizations through orcharhino and assign components to each individual organization.
This ensures orcharhino&#160;Server provisions hosts within a certain organization and only uses components that are assigned to that organization.
For more information about organizations, see <a href="https://docs.theforeman.org/3.9/Managing_Organizations_and_Locations/index-orcharhino.html#Managing_Organizations_managing-organizations-locations">Managing Organizations</a> in <em>Managing organizations and locations in orcharhino</em>.</p>
</div>
<div class="paragraph">
<p>Locations function similar to organizations.
The difference is that locations are based on physical or geographical setting.
Users can nest locations in a hierarchy.
For more information about locations, see <a href="https://docs.theforeman.org/3.9/Managing_Organizations_and_Locations/index-orcharhino.html#Managing_Locations_managing-organizations-locations">Managing Locations</a> in <em>Managing organizations and locations in orcharhino</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-the-provisioning-context_provisioning"><a class="anchor" href="#setting-the-provisioning-context_provisioning"></a>2.2. Setting the provisioning context</h3>
<div class="paragraph">
<p>When you set a provisioning context, you define which organization and location to use for provisioning hosts.</p>
</div>
<div class="paragraph">
<p>The organization and location menus are located in the menu bar, on the upper left of the orcharhino management UI.
If you have not selected an organization and location to use, the menu displays: <strong>Any Organization</strong> and <strong>Any Location</strong>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <strong>Any Organization</strong> and select the organization.</p>
</li>
<li>
<p>Click <strong>Any Location</strong> and select the location to use.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each user can set their default provisioning context in their account settings.
Click the user name in the upper right of the orcharhino management UI and select <strong>My account</strong> to edit your user account settings.</p>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>When using the CLI, include either <code>--organization</code> or <code>--organization-label</code> and <code>--location</code> or <code>--location-id</code> as an option.
For example:</p>
<div class="listingblock">
<div class="content">
<pre># hammer host list --organization "<em>My_Organization</em>" --location "<em>My_Location</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>This command outputs hosts allocated to <code>My_Organization</code> and <code>My_Location</code>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-operating-systems_provisioning"><a class="anchor" href="#creating-operating-systems_provisioning"></a>2.3. Creating operating systems</h3>
<div class="paragraph">
<p>An operating system is a collection of resources that define how orcharhino&#160;Server installs a base operating system on a host.
Operating system entries combine previously defined resources, such as installation media, partition tables, provisioning templates, and others.</p>
</div>
<div class="paragraph">
<p>You can add operating systems using the following procedure.
To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-operating-systems_provisioning">CLI procedure</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use a script to add operating system entries to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>On your orcharhino&#160;Server, uncomment the operating systems and orcharhino&#160;Client that you want to add in <code>/etc/orcharhino-ansible/or_operating_systems_vars.yaml</code>, replace the default organization and location names, and run <code>/opt/orcharhino/automation/play_operating_systems.sh</code>.
For more information, see <code>/usr/share/orcharhino-ansible/README.md</code> on your orcharhino&#160;Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and click <strong>New Operating</strong> system.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to represent the operating system entry.</p>
</li>
<li>
<p>In the <strong>Major</strong> field, enter the number that corresponds to the major version of the operating system.</p>
</li>
<li>
<p>In the <strong>Minor</strong> field, enter the number that corresponds to the minor version of the operating system.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description of the operating system.</p>
</li>
<li>
<p>From the <strong>Family</strong> list, select the operating system&#8217;s family.</p>
</li>
<li>
<p>From the <strong>Root Password Hash</strong> list, select the encoding method for the root password.</p>
</li>
<li>
<p>From the <strong>Architectures</strong> list, select the architectures that the operating system uses.</p>
</li>
<li>
<p>Click the <strong>Partition table</strong> tab and select the possible partition tables that apply to this operating system.</p>
</li>
<li>
<p>Click the Installation Media tab and enter the information for the installation media source.
For more information, see <a href="https://docs.theforeman.org/3.9/Provisioning_Hosts/index-orcharhino.html#adding-installation-media_provisioning">Adding Installation Media to orcharhino</a>.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab and select a <strong>PXELinux template</strong>, a <strong>Provisioning template</strong>, and a <strong>Finish template</strong> for your operating system to use.
You can select other templates, for example an <strong>iPXE template</strong>, if you plan to use iPXE for provisioning.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, add the <code>or_client_repo_url</code> parameter, select the <strong>string</strong> type, and enter the value <code><a href="http://_orcharhino.example.com_/pulp/content/_My_Organization_/Library/custom/Enterprise" class="bare">http://_orcharhino.example.com_/pulp/content/_My_Organization_/Library/custom/Enterprise</a> Linux_Client/Enterprise Linux_Client_8/</code>.</p>
<div class="paragraph">
<p>If you want to provision hosts through orcharhino&#160;Proxies, you have to use the <code>or_client_repo_path</code> parameter containing the <strong>Published At</strong> path of your content on orcharhino&#160;Server.
orcharhino&#160;Proxy will add the FQDN of your orcharhino&#160;Proxy to generate the URL based on the content source setting of your host.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save your provisioning template.</p>
</li>
</ol>
</div>
<div id="cli-creating-operating-systems_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the operating system using the <code>hammer os create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer os create \
--architectures "x86_64" \
--description "<em>My_Operating_System</em>" \
--family "Redhat" \
--major 8 \
--media "Red Hat" \
--minor 8 \
--name "Enterprise Linux" \
--partition-tables "<em>My_Partition_Table</em>" \
--provisioning-templates "<em>My_Provisioning_Template</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Creating-an-operating-system-for-Debian-12_provisioning"><a class="anchor" href="#Creating-an-operating-system-for-Debian-12_provisioning"></a>2.4. Creating an operating system for Debian 12</h3>
<div class="paragraph">
<p>Create an operating system in orcharhino to provision hosts running Debian 12.
This example creates an operating system entry for Debian 12.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use a script to add operating system entries to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>On your orcharhino&#160;Server, uncomment the operating systems and orcharhino&#160;Client that you want to add in <code>/etc/orcharhino-ansible/or_operating_systems_vars.yaml</code>, replace the default organization and location names, and run <code>/opt/orcharhino/automation/play_operating_systems.sh</code>.
For more information, see <code>/usr/share/orcharhino-ansible/README.md</code> on your orcharhino&#160;Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Create Operating System</strong> to create an operating system entry for Debian.</p>
</li>
<li>
<p>Enter <code>Debian 12</code> as <strong>Name</strong> for the operating system.
Choose a name as reported by Ansible, Puppet, or Salt as fact.</p>
</li>
<li>
<p>Set the <strong>Major Version</strong> to <code>12</code>.</p>
</li>
<li>
<p>Leave the <strong>Minor Version</strong> field empty.</p>
</li>
<li>
<p>Set the <strong>Release Name</strong> to <code>bookworm</code> for Debian 12.</p>
</li>
<li>
<p>On the <strong>Partition Table</strong> tab, select the <code>Preseed</code> partition table.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-partition-tables_provisioning">Creating partition tables</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Templates</strong> tab, select the <code>Preseed Finish</code> template as <strong>Finish template</strong>, the <code>Preseed</code> template as <strong>Provisioning Template</strong>, and the <code>Preseed PXELinux</code> template as <strong>PXELinux template</strong>.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, add the <code>or_client_repo_url</code> parameter, select the <strong>string</strong> type, and enter the value <code><a href="http://_orcharhino.example.com_/pulp/content/_My_Organization_/Library/custom/Enterprise" class="bare">http://_orcharhino.example.com_/pulp/content/_My_Organization_/Library/custom/Enterprise</a> Linux_Client/Enterprise Linux_Client_8/</code>.</p>
<div class="paragraph">
<p>If you want to provision hosts through orcharhino&#160;Proxies, you have to use the <code>or_client_repo_path</code> parameter containing the <strong>Published At</strong> path of your content on orcharhino&#160;Server.
orcharhino&#160;Proxy will add the FQDN of your orcharhino&#160;Proxy to generate the URL based on the content source setting of your host.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="#creating-provisioning-templates_provisioning">Creating provisioning templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the operating system entry for Debian.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating-an-operating-system-for-Debian-11_provisioning"><a class="anchor" href="#Creating-an-operating-system-for-Debian-11_provisioning"></a>2.5. Creating an operating system for Debian 11</h3>
<div class="paragraph">
<p>Create an operating system in orcharhino to provision hosts running Debian 11.
This example creates an operating system entry for Debian 11.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use a script to add operating system entries to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>On your orcharhino&#160;Server, uncomment the operating systems and orcharhino&#160;Client that you want to add in <code>/etc/orcharhino-ansible/or_operating_systems_vars.yaml</code>, replace the default organization and location names, and run <code>/opt/orcharhino/automation/play_operating_systems.sh</code>.
For more information, see <code>/usr/share/orcharhino-ansible/README.md</code> on your orcharhino&#160;Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Create Operating System</strong> to create an operating system entry for Debian.</p>
</li>
<li>
<p>Enter <code>Debian 11</code> as <strong>Name</strong> for the operating system.
Choose a name as reported by Ansible, Puppet, or Salt as fact.</p>
</li>
<li>
<p>Set the <strong>Major Version</strong> to <code>11</code>.</p>
</li>
<li>
<p>Leave the <strong>Minor Version</strong> field empty.</p>
</li>
<li>
<p>Set the <strong>Release Name</strong> to <code>bullseye</code> for Debian 11.</p>
</li>
<li>
<p>On the <strong>Partition Table</strong> tab, select the <code>Preseed</code> partition table.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-partition-tables_provisioning">Creating partition tables</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Templates</strong> tab, select the <code>Preseed Finish</code> template as <strong>Finish template</strong>, the <code>Preseed</code> template as <strong>Provisioning Template</strong>, and the <code>Preseed PXELinux</code> template as <strong>PXELinux template</strong>.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, add the <code>or_client_repo_url</code> parameter, select the <strong>string</strong> type, and enter the value <code><a href="http://_orcharhino.example.com_/pulp/content/_My_Organization_/Library/custom/Enterprise" class="bare">http://_orcharhino.example.com_/pulp/content/_My_Organization_/Library/custom/Enterprise</a> Linux_Client/Enterprise Linux_Client_8/</code>.</p>
<div class="paragraph">
<p>If you want to provision hosts through orcharhino&#160;Proxies, you have to use the <code>or_client_repo_path</code> parameter containing the <strong>Published At</strong> path of your content on orcharhino&#160;Server.
orcharhino&#160;Proxy will add the FQDN of your orcharhino&#160;Proxy to generate the URL based on the content source setting of your host.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="#creating-provisioning-templates_provisioning">Creating provisioning templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the operating system entry for Debian.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating-an-operating-system-for-Ubuntu-24-04_provisioning"><a class="anchor" href="#Creating-an-operating-system-for-Ubuntu-24-04_provisioning"></a>2.6. Creating an operating system for Ubuntu 24.04</h3>
<div class="paragraph">
<p>Create an operating system in orcharhino to provision hosts running Ubuntu 24.04.
This example creates an operating system entry for Ubuntu 24.04.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use a script to add operating system entries to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>On your orcharhino&#160;Server, uncomment the operating systems and orcharhino&#160;Client that you want to add in <code>/etc/orcharhino-ansible/or_operating_systems_vars.yaml</code>, replace the default organization and location names, and run <code>/opt/orcharhino/automation/play_operating_systems.sh</code>.
For more information, see <code>/usr/share/orcharhino-ansible/README.md</code> on your orcharhino&#160;Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Create Operating System</strong> to create an operating system entry for Ubuntu.</p>
</li>
<li>
<p>Enter <code>Ubuntu 24.04</code> as <strong>Name</strong> for the operating system.
Choose a name as reported by Ansible, Puppet, or Salt as fact.</p>
</li>
<li>
<p>Set the <strong>Major Version</strong> to <code>24.04</code>.</p>
</li>
<li>
<p>Leave the <strong>Minor Version</strong> field empty.</p>
</li>
<li>
<p>Set the <strong>Release Name</strong> to <code>noble</code> for Ubuntu 24.04.</p>
</li>
<li>
<p>On the <strong>Partition Table</strong> tab, select the <code>Preseed</code> partition table.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-partition-tables_provisioning">Creating partition tables</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Templates</strong> tab, select the <code>Preseed Finish</code> template as <strong>Finish template</strong>, the <code>Preseed</code> template as <strong>Provisioning Template</strong>, and the <code>Preseed PXELinux</code> template as <strong>PXELinux template</strong>.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, add the <code>or_client_repo_url</code> parameter, select the <strong>string</strong> type, and enter the value <code><a href="http://_orcharhino.example.com_/pulp/content/_My_Organization_/Library/custom/Enterprise" class="bare">http://_orcharhino.example.com_/pulp/content/_My_Organization_/Library/custom/Enterprise</a> Linux_Client/Enterprise Linux_Client_8/</code>.</p>
<div class="paragraph">
<p>If you want to provision hosts through orcharhino&#160;Proxies, you have to use the <code>or_client_repo_path</code> parameter containing the <strong>Published At</strong> path of your content on orcharhino&#160;Server.
orcharhino&#160;Proxy will add the FQDN of your orcharhino&#160;Proxy to generate the URL based on the content source setting of your host.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="#creating-provisioning-templates_provisioning">Creating provisioning templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the operating system entry for Ubuntu.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating-an-operating-system-for-Ubuntu-22-04_provisioning"><a class="anchor" href="#Creating-an-operating-system-for-Ubuntu-22-04_provisioning"></a>2.7. Creating an operating system for Ubuntu 22.04</h3>
<div class="paragraph">
<p>Create an operating system in orcharhino to provision hosts running Ubuntu 22.04.
This example creates an operating system entry for Ubuntu 22.04.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use a script to add operating system entries to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>On your orcharhino&#160;Server, uncomment the operating systems and orcharhino&#160;Client that you want to add in <code>/etc/orcharhino-ansible/or_operating_systems_vars.yaml</code>, replace the default organization and location names, and run <code>/opt/orcharhino/automation/play_operating_systems.sh</code>.
For more information, see <code>/usr/share/orcharhino-ansible/README.md</code> on your orcharhino&#160;Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Create Operating System</strong> to create an operating system entry for Ubuntu.</p>
</li>
<li>
<p>Enter <code>Ubuntu 22.04</code> as <strong>Name</strong> for the operating system.
Choose a name as reported by Ansible, Puppet, or Salt as fact.</p>
</li>
<li>
<p>Set the <strong>Major Version</strong> to <code>22.04</code>.</p>
</li>
<li>
<p>Leave the <strong>Minor Version</strong> field empty.</p>
</li>
<li>
<p>Set the <strong>Release Name</strong> to <code>jammy</code> for Ubuntu 22.04.</p>
</li>
<li>
<p>On the <strong>Partition Table</strong> tab, select the <code>Preseed</code> partition table.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-partition-tables_provisioning">Creating partition tables</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Templates</strong> tab, select the <code>Preseed Finish</code> template as <strong>Finish template</strong>, the <code>Preseed</code> template as <strong>Provisioning Template</strong>, and the <code>Preseed PXELinux</code> template as <strong>PXELinux template</strong>.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, add the <code>or_client_repo_url</code> parameter, select the <strong>string</strong> type, and enter the value <code><a href="http://_orcharhino.example.com_/pulp/content/_My_Organization_/Library/custom/Enterprise" class="bare">http://_orcharhino.example.com_/pulp/content/_My_Organization_/Library/custom/Enterprise</a> Linux_Client/Enterprise Linux_Client_8/</code>.</p>
<div class="paragraph">
<p>If you want to provision hosts through orcharhino&#160;Proxies, you have to use the <code>or_client_repo_path</code> parameter containing the <strong>Published At</strong> path of your content on orcharhino&#160;Server.
orcharhino&#160;Proxy will add the FQDN of your orcharhino&#160;Proxy to generate the URL based on the content source setting of your host.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="#creating-provisioning-templates_provisioning">Creating provisioning templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the operating system entry for Ubuntu.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="updating-the-details-of-multiple-operating-systems_provisioning"><a class="anchor" href="#updating-the-details-of-multiple-operating-systems_provisioning"></a>2.8. Updating the details of multiple operating systems</h3>
<div class="paragraph">
<p>Use this procedure to update the details of multiple operating systems.
This example shows you how to assign each operating system a partition table called <code>Kickstart default</code>, a configuration template called <code>Kickstart default PXELinux</code>, and a provisioning template called <code>Kickstart Default</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino&#160;Server, run the following Bash script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">PARTID=$(hammer --csv partition-table list | grep "Kickstart default," | cut -d, -f1)
PXEID=$(hammer --csv template list --per-page=1000 | grep "Kickstart default PXELinux" | cut -d, -f1)
SATID=$(hammer --csv template list --per-page=1000 | grep "provision" | grep ",Kickstart default" | cut -d, -f1)

for i in $(hammer --no-headers --csv os list | awk -F, {'print $1'})
do
   hammer partition-table add-operatingsystem --id="${PARTID}" --operatingsystem-id="${i}"
   hammer template add-operatingsystem --id="${PXEID}" --operatingsystem-id="${i}"
   hammer os set-default-template --id="${i}" --config-template-id=${PXEID}
   hammer os add-config-template --id="${i}" --config-template-id=${SATID}
   hammer os set-default-template --id="${i}" --config-template-id=${SATID}
done</code></pre>
</div>
</div>
</li>
<li>
<p>Display information about the updated operating system to verify that the operating system is updated correctly:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer os info --id <em>1</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-architectures_provisioning"><a class="anchor" href="#creating-architectures_provisioning"></a>2.9. Creating architectures</h3>
<div class="paragraph">
<p>An architecture in orcharhino represents a logical grouping of hosts and operating systems.
Architectures are created by orcharhino automatically when hosts check in with Puppet.
The x86_64 architecture is already preset in orcharhino.</p>
</div>
<div class="paragraph">
<p>Use this procedure to create an architecture in orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Architectures</strong>.</p>
</li>
<li>
<p>Click <strong>Create Architecture</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the architecture.</p>
</li>
<li>
<p>From the <strong>Operating Systems</strong> list, select an operating system.
If none are available, you can create and assign them under <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the <code>hammer architecture create</code> command to create an architecture.
Specify its name and operating systems that include this architecture:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer architecture create \
--name "<em>My_Architecture</em>" \
--operatingsystems "<em>My_Operating_System</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-hardware-models_provisioning"><a class="anchor" href="#creating-hardware-models_provisioning"></a>2.10. Creating hardware models</h3>
<div class="paragraph">
<p>Use this procedure to create a hardware model in orcharhino so that you can specify which hardware model a host uses.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Hardware Models</strong>.</p>
</li>
<li>
<p>Click <strong>Create Model</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the hardware model.</p>
</li>
<li>
<p>Optionally, in the <strong>Hardware Model</strong> and <strong>Vendor Class</strong> fields, you can enter corresponding information for your system.</p>
</li>
<li>
<p>In the <strong>Info</strong> field, enter a description of the hardware model.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your hardware model.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create a hardware model using the <code>hammer model create</code> command.
The only required parameter is <code>--name</code>.
Optionally, enter the hardware model with the <code>--hardware-model</code> option, a vendor class with the <code>--vendor-class</code> option, and a description with the <code>--info</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer model create \
--hardware-model "<em>My_Hardware_Model</em>" \
--info "<em>My_Description</em>" \
--name "<em>My_Hardware_Model_Name</em>" \
--vendor-class "<em>My_Vendor_Class</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-a-synchronized-kickstart-repository-for-a-hosts-operating-system_provisioning"><a class="anchor" href="#using-a-synchronized-kickstart-repository-for-a-hosts-operating-system_provisioning"></a>2.11. Using a synchronized Kickstart repository for a host&#8217;s operating system</h3>
<div class="paragraph">
<p>orcharhino contains a set of synchronized Kickstart repositories that you use to install the provisioned host&#8217;s operating system.
For more information about adding repositories, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</div>
<div class="paragraph">
<p>Use this procedure to set up a Kickstart repository.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>You must enable both <strong>BaseOS</strong> and <strong>Appstream Kickstart</strong> before provisioning.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the synchronized Kickstart repository that you want to use to the existing content view, or create a new content view and add the kickstart repository.</p>
<div class="paragraph">
<p>For Red&#160;Hat Enterprise Linux 8, ensure that you add both <strong>Red&#160;Hat Enterprise Linux 8 for x86_64 - AppStream Kickstart x86_64 8</strong> and <strong>Red&#160;Hat Enterprise Linux 8 for x86_64 - BaseOS Kickstart x86_64 8</strong> repositories.</p>
</div>
<div class="paragraph">
<p>If you use a disconnected environment, you must import the Kickstart repositories from a Red&#160;Hat Enterprise Linux binary DVD.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Importing_Kickstart_Repositories_content-management">Importing Kickstart Repositories</a> in <em>Managing content</em>.</p>
</div>
</li>
<li>
<p>Publish a new version of the content view where the Kickstart repository is added and promote it to a required lifecycle environment.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Managing_Content_Views_content-management">Managing content views</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>When you create a host, in the <strong>Operating System</strong> tab, for <strong>Media Selection</strong>, select the <strong>Synced Content</strong> checkbox.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To view the Kickstart tree, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer medium list --organization "<em>My_Organization</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-installation-media_provisioning"><a class="anchor" href="#adding-installation-media_provisioning"></a>2.12. Adding installation media to orcharhino</h3>
<div class="paragraph">
<p>Installation media are sources of packages that orcharhino&#160;Server uses to install a base operating system on a machine from an external repository.</p>
</div>
<div class="paragraph">
<p>You can view installation media by navigating to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Installation Media</strong>.</p>
</div>
<div class="paragraph">
<p>Installation media must be in the format of an operating system installation tree and must be accessible from the machine hosting the installer through an HTTP URL.</p>
</div>
<div class="paragraph">
<p>If you want to improve download performance when using installation media to install operating systems on multiple hosts, you must modify the <strong>Path</strong> of the installation medium to point to the closest mirror or a local copy.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-installation-media_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Installation Media</strong>.</p>
</li>
<li>
<p>Click <strong>Create Medium</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to represent the installation media entry.</p>
</li>
<li>
<p>In the <strong>Path</strong> enter the URL that contains the installation tree.
You can use following variables in the path to represent multiple different system architectures and versions:</p>
<div class="ulist">
<ul>
<li>
<p><code>$arch</code> &#8211; The system architecture.</p>
</li>
<li>
<p><code>$version</code> &#8211; The operating system version.</p>
</li>
<li>
<p><code>$major</code> &#8211; The operating system major version.</p>
</li>
<li>
<p><code>$minor</code> &#8211; The operating system minor version.</p>
<div class="paragraph">
<p>Example HTTP path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://download.example.com/centos/$version/Server/$arch/os/</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>From the <strong>Operating system family</strong> list, select the distribution or family of the installation medium.
Enterprise Linux belongs to the <code>Red Hat</code> family.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs, to change the provisioning context.
orcharhino&#160;Server adds the installation medium to the set provisioning context.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your installation medium.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>ATIX&#160;AG provides file repositories for installation media.
You can synchronize them to provision hosts in disconnected environments by using local installation media.
For a list of upstream URLs, see <a href="https://atixservice.zendesk.com/hc/de/articles/7044086506908">Using file repositories for installation media for Debian/Ubuntu</a> in the <em>ATIX Service Portal</em>.</p>
</div>
<div class="paragraph">
<p>ATIX&#160;AG provides the following installation media as file repository:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debian 9</p>
</li>
<li>
<p>Debian 10</p>
</li>
<li>
<p>Debian 11</p>
</li>
<li>
<p>Debian 12</p>
</li>
<li>
<p>Ubuntu 18.04</p>
</li>
<li>
<p>Ubuntu 20.04</p>
</li>
<li>
<p>Ubuntu 22.04</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div id="cli-adding-installation-media_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the installation medium using the <code>hammer medium create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer medium create \
--locations "<em>My_Location</em>" \
--name "<em>My_Operating_System</em>" \
--organizations "<em>My_Organization</em>" \
--os-family "Redhat" \
--path "http://download.example.com/centos/$version/Server/$arch/os/"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Creating_an_Installation_Medium_for_Debian-Ubuntu_provisioning"><a class="anchor" href="#Creating_an_Installation_Medium_for_Debian-Ubuntu_provisioning"></a>2.13. Creating an installation medium for Debian/Ubuntu</h3>
<div class="paragraph">
<p>Create an installation medium in orcharhino to provision hosts running Debian/Ubuntu.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use a script to add operating system entries to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>On your orcharhino&#160;Server, uncomment the operating systems and orcharhino&#160;Client that you want to add in <code>/etc/orcharhino-ansible/or_operating_systems_vars.yaml</code>, replace the default organization and location names, and run <code>/opt/orcharhino/automation/play_operating_systems.sh</code>.
For more information, see <code>/usr/share/orcharhino-ansible/README.md</code> on your orcharhino&#160;Server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Installation Media</strong>.</p>
</li>
<li>
<p>Click <strong>Create Medium</strong> to create an installation medium entry.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> for the installation medium.</p>
</li>
<li>
<p>Set the <strong>Path</strong> to the upstream URL <code><a href="http://deb.debian.org/debian/" class="bare">http://deb.debian.org/debian/</a></code>.</p>
<div class="paragraph">
<p>Alternatively, you can also use a Debian/Ubuntu Mirror.
Note that synchronized content from orcharhino does not work for two reasons: first, the <code>linux</code> and <code>initrd.gz</code> files are not synchronized; second, the <code>Release</code> file is not signed with the official Debian/Ubuntu GPG private key.</p>
</div>
</li>
<li>
<p>Set the <strong>Operating System Family</strong> to <code>Debian</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the installation medium to orcharhino.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_an_Installation_Medium_for_Ubuntu_22_04_provisioning"><a class="anchor" href="#Creating_an_Installation_Medium_for_Ubuntu_22_04_provisioning"></a>2.14. Creating an installation medium for Ubuntu 22.04</h3>
<div class="paragraph">
<p>To provision Ubuntu 22.04, you need to provide both the ISO image and the extracted ISO image on your orcharhino&#160;Server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to your orcharhino&#160;Server using SSH:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh root@orcharhino.example.com</pre>
</div>
</div>
</li>
<li>
<p>Download the ISO image:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cd /tmp/
# wget https://releases.ubuntu.com/22.04/ubuntu-22.04.3-live-server-amd64.iso</pre>
</div>
</div>
</li>
<li>
<p>Mount the ISO image:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount ubuntu-22.04.3-live-server-amd64.iso /mnt</pre>
</div>
</div>
</li>
<li>
<p>Provide the ISO image and the extracted directory under <em>orcharhino.example.com/pub</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /var/www/html/pub/installation_media/ubuntu/22.04-x86_64/
# cp ubuntu-22.04.3-live-server-amd64.iso /var/www/html/pub/installation_media/ubuntu/22.04-x86_64.iso
# cp -a /mnt/* /var/www/html/pub/installation_media/ubuntu/22.04-x86_64/</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure the path in <code>/pub/</code> matches the path in your <em>Preseed default PXELinux Autoinstall</em> template.</p>
</div>
</li>
<li>
<p>Unmount and delete the ISO image:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># umount /mnt/
# rm -f ubuntu-22.04.3-live-server-amd64.iso</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Use <code>http://orcharhino.example.com/pub/installation_media/ubuntu/22.04-x86_64/</code> to set up your installation media entry in orcharhino.
For more information, see <a href="#adding-installation-media_provisioning">Adding installation media to orcharhino</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Ubuntu_Autoinstall_Through_Smart_Proxies_provisioning"><a class="anchor" href="#Provisioning_Ubuntu_Autoinstall_Through_Smart_Proxies_provisioning"></a>2.15. Provisioning Ubuntu autoinstall through orcharhino&#160;Proxies</h3>
<div class="paragraph">
<p>Perform these steps to provision hosts running Ubuntu 20.04.3+ or Ubuntu 22.04.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure you have configured your orcharhino&#160;Proxies for provisioning.
For more information, see <a href="https://docs.theforeman.org/3.9/Installing_Proxy/index-orcharhino.html#configuring-orcharhino-proxy-for-host-registration-and-provisioning_orcharhino-proxy">Configuring orcharhino&#160;Proxy for Host Registration and Provisioning</a> in <em>Installing orcharhino&#160;Proxy</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Provide the extracted ISO and ISO image itself on each orcharhino&#160;Proxy.
For more information, see <a href="#Creating_an_Installation_Medium_for_Ubuntu_22_04_provisioning">Creating an installation medium for Ubuntu 22.04</a>.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Installation Media</strong>.</p>
</li>
<li>
<p>Create an installation medium.
Set the <strong>Path</strong> to the extracted ISO image on your orcharhino&#160;Proxy.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Assign the installation medium to your operating system entry for Ubuntu 22.04.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Configure &gt; Host Groups</strong>.</p>
</li>
<li>
<p>Select the host group that you use to deploy Ubuntu 22.04 through a orcharhino&#160;Proxy and set the installation medium entry accordingly.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-partition-tables_provisioning"><a class="anchor" href="#creating-partition-tables_provisioning"></a>2.16. Creating partition tables</h3>
<div class="paragraph">
<p>A partition table is a type of template that defines the way orcharhino&#160;Server configures the disks available on a new host.
A Partition table uses the same ERB syntax as provisioning templates.
orcharhino contains a set of default partition tables to use, including a <code>Kickstart default</code>.
You can also edit partition table entries to configure the preferred partitioning scheme, or create a partition table entry and add it to the operating system entry.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-partition-tables_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Partition Tables</strong>.</p>
</li>
<li>
<p>Click <strong>Create Partition Table</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the partition table.</p>
</li>
<li>
<p>Select the <strong>Default</strong> checkbox if you want to set the template to automatically associate with new organizations or locations.</p>
</li>
<li>
<p>Select the <strong>Snippet</strong> checkbox if you want to identify the template as a reusable snippet for other partition tables.</p>
</li>
<li>
<p>From the <strong>Operating System Family</strong> list, select the distribution or family of the partitioning layout.
Enterprise Linux belongs to the <code>Red Hat</code> family.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, enter the layout for the disk partition.</p>
<div class="paragraph">
<p>The format of the layout must match that for the intended operating system.
For example, Enterprise Linux requires a layout that matches a Kickstart file, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zerombr
clearpart --all --initlabel
autopart</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="#dynamic-partition-example_provisioning">Dynamic partition example</a>.</p>
</div>
<div class="paragraph">
<p>You can also use the file browser in the template editor to import the layout from a file.</p>
</div>
</li>
<li>
<p>In the <strong>Audit Comment</strong> field, add a summary of changes to the partition layout.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs to add any other provisioning contexts that you want to associate with the partition table.
orcharhino adds the partition table to the current provisioning context.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your partition table.</p>
</li>
</ol>
</div>
<div id="cli-creating-partition-tables_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a plain text file, such as <code><em>~/My_Partition_Table</em></code>, that contains the partition layout.</p>
<div class="paragraph">
<p>The format of the layout must match that for the intended operating system.
For example, Enterprise Linux requires a layout that matches a Kickstart file, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zerombr
clearpart --all --initlabel
autopart</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="#dynamic-partition-example_provisioning">Dynamic partition example</a>.</p>
</div>
</li>
<li>
<p>Create the installation medium using the <code>hammer partition-table create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer partition-table create \
--file "<em>~/My_Partition_Table</em>" \
--locations "<em>My_Location</em>" \
--name "<em>My_Partition_Table</em>" \
--organizations "<em>My_Organization</em>" \
--os-family "Redhat" \
--snippet false</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-partition-example_provisioning"><a class="anchor" href="#dynamic-partition-example_provisioning"></a>2.17. Dynamic partition example</h3>
<div class="paragraph">
<p>Using an Anaconda kickstart template, the following section instructs Anaconda to erase the whole disk, automatically partition, enlarge one partition to maximum size, and then proceed to the next sequence of events in the provisioning process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zerombr
clearpart --all --initlabel
autopart &lt;%= host_param('autopart_options') %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Dynamic partitioning is executed by the installation program.
Therefore, you can write your own rules to specify how you want to partition disks according to runtime information from the node, for example, disk sizes, number of drives, vendor, or manufacturer.</p>
</div>
<div class="paragraph">
<p>If you want to provision servers and use dynamic partitioning, add the following example as a template.
When the <code>#Dynamic</code> entry is included, the content of the template loads into a <code>%pre</code> shell scriplet and creates a <code>/tmp/diskpart.cfg</code> that is then included into the Kickstart partitioning section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#Dynamic (do not remove this line)

MEMORY=$((`grep MemTotal: /proc/meminfo | sed 's/^MemTotal: *//'|sed 's/ .*//'` / 1024))
if [ "$MEMORY" -lt 2048 ]; then
    SWAP_MEMORY=$(($MEMORY * 2))
elif [ "$MEMORY" -lt 8192 ]; then
    SWAP_MEMORY=$MEMORY
elif [ "$MEMORY" -lt 65536 ]; then
    SWAP_MEMORY=$(($MEMORY / 2))
else
    SWAP_MEMORY=32768
fi

cat &lt;&lt;EOF &gt; /tmp/diskpart.cfg
zerombr
clearpart --all --initlabel
part /boot --fstype ext4 --size 200 --asprimary
part swap --size "$SWAP_MEMORY"
part / --fstype ext4 --size 1024 --grow
EOF</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="provisioning-templates_provisioning"><a class="anchor" href="#provisioning-templates_provisioning"></a>2.18. Provisioning templates</h3>
<div class="paragraph">
<p>A provisioning template defines the way orcharhino&#160;Server installs an operating system on a host.</p>
</div>
<div class="paragraph">
<p>orcharhino includes many template examples.
In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> to view them.
You can create a template or clone a template and edit the clone.
For help with templates, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> &gt; <strong>Create Template</strong> &gt; <strong>Help</strong>.</p>
</div>
<div class="paragraph">
<p>Templates accept the Embedded Ruby (ERB) syntax.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Hosts/index-orcharhino.html#Template_Writing_Reference_managing-hosts">Template Writing Reference</a> in <em>Managing hosts</em>.</p>
</div>
<div class="paragraph">
<p>You can download provisioning templates.
Before you can download the template, you must create a debug certificate.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Organizations_and_Locations/index-orcharhino.html#Creating_an_Organization_Debug_Certificate_managing-organizations-locations">Creating an Organization Debug Certificate</a> in <em>Managing organizations and locations in orcharhino</em>.</p>
</div>
<div class="paragraph">
<p>You can synchronize templates between orcharhino&#160;Server and a Git repository or a local directory.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Hosts/index-orcharhino.html#Synchronizing_Templates_Repositories_managing-hosts">Synchronizing Templates Repositories</a> in <em>Managing hosts</em>.</p>
</div>
<div class="paragraph">
<p>To view the history of changes applied to a template, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>, select one of the templates, and click <strong>History</strong>.
Click <strong>Revert</strong> to override the content with the previous version.
You can also revert to an earlier change.
Click <strong>Show Diff</strong> to see information about a specific change:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Template Diff</strong> tab displays changes in the body of a provisioning template.</p>
</li>
<li>
<p>The <strong>Details</strong> tab displays changes in the template description.</p>
</li>
<li>
<p>The <strong>History</strong> tab displays the user who made a change to the template and date of the change.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="kinds-of-provisioning-templates_provisioning"><a class="anchor" href="#kinds-of-provisioning-templates_provisioning"></a>2.19. Kinds of provisioning templates</h3>
<div class="paragraph">
<p>There are various kinds of provisioning templates:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Provision</dt>
<dd>
<p>The main template for the provisioning process.
For example, a Kickstart template.</p>
</dd>
<dt class="hdlist1">PXELinux, PXEGrub, PXEGrub2</dt>
<dd>
<p>PXE-based templates that deploy to the template orcharhino&#160;Proxy associated with a subnet to ensure that the host uses the installer with the correct kernel options.
For BIOS provisioning, select <strong>PXELinux</strong> template.
For UEFI provisioning, select <strong>PXEGrub2</strong>.</p>
</dd>
<dt class="hdlist1">Finish</dt>
<dd>
<p>Post-configuration scripts to execute using an SSH connection when the main provisioning process completes.
You can use Finish templates only for image-based provisioning in virtual or cloud environments that do not support user_data.
Do not confuse an image with a foreman discovery ISO, which is sometimes called a Foreman discovery image.
An image in this context is an install image in a virtualized environment for easy deployment.</p>
<div class="paragraph">
<p>When a finish script successfully exits with the return code <code>0</code>, orcharhino treats the code as a success and the host exits the build mode.</p>
</div>
<div class="paragraph">
<p>Note that there are a few finish scripts with a build mode that uses a <em>call back</em> HTTP call.
These scripts are not used for image-based provisioning, but for post configuration of operating-system installations such as Debian, Ubuntu, and BSD.</p>
</div>
</dd>
<dt class="hdlist1">user_data</dt>
<dd>
<p>Post-configuration scripts for providers that accept custom data, also known as seed data.
You can use the user_data template to provision virtual machines in cloud or virtualised environments only.
This template does not require orcharhino to be able to reach the host; the cloud or virtualization platform is responsible for delivering the data to the image.</p>
<div class="paragraph">
<p>Ensure that the image that you want to provision has the software to read the data installed and set to start during boot.
For example, <code>cloud-init</code>, which expects YAML input, or <code>ignition</code>, which expects JSON input.</p>
</div>
</dd>
<dt class="hdlist1">cloud_init</dt>
<dd>
<p>Some environments, such as VMWare, either do not support custom data or have their own data format that limits what can be done during customization.
In this case, you can configure a cloud-init client with the <code>foreman</code> plugin, which attempts to download the template directly from orcharhino over HTTP or HTTPS.
This technique can be used in any environment, preferably virtualized.</p>
<div class="paragraph">
<p>Ensure that you meet the following requirements to use the <code>cloud_init</code> template:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that the image that you want to provision has the software to read the data installed and set to start during boot.</p>
</li>
<li>
<p>A provisioned host is able to reach orcharhino from the IP address that matches the host&#8217;s provisioning interface IP.</p>
<div class="paragraph">
<p>Note that cloud-init does not work behind NAT.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Bootdisk</dt>
<dd>
<p>Templates for PXE-less boot methods.</p>
</dd>
<dt class="hdlist1">Kernel Execution (kexec)</dt>
<dd>
<p>Kernel execution templates for PXE-less boot methods.</p>
</dd>
<dt class="hdlist1">Script</dt>
<dd>
<p>An arbitrary script not used by default but useful for custom tasks.</p>
</dd>
<dt class="hdlist1">ZTP</dt>
<dd>
<p>Zero Touch Provisioning templates.</p>
</dd>
<dt class="hdlist1">POAP</dt>
<dd>
<p>PowerOn Auto Provisioning templates.</p>
</dd>
<dt class="hdlist1">iPXE</dt>
<dd>
<p>Templates for <code>iPXE</code> or <code>gPXE</code> environments to use instead of PXELinux.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="creating-provisioning-templates_provisioning"><a class="anchor" href="#creating-provisioning-templates_provisioning"></a>2.20. Creating provisioning templates</h3>
<div class="paragraph">
<p>A provisioning template defines the way orcharhino&#160;Server installs an operating system on a host.
Use this procedure to create a new provisioning template.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> and click <strong>Create Template</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the provisioning template.</p>
</li>
<li>
<p>Fill in the rest of the fields as required.
The <strong>Help</strong> tab provides information about the template syntax and details the available functions, variables, and methods that can be called on different types of objects within the template.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Before you create a template with the CLI, create a plain text file that contains the template.
This example uses the <code>~/my-template</code> file.</p>
</li>
<li>
<p>Create the template using the <code>hammer template create</code> command and specify the type with the <code>--type</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer template create \
--file ~/my-template \
--locations "<em>My_Location</em>" \
--name "<em>My_Provisioning_Template</em>" \
--organizations "<em>My_Organization</em>" \
--type provision</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="cloning-provisioning-templates_provisioning"><a class="anchor" href="#cloning-provisioning-templates_provisioning"></a>2.21. Cloning provisioning templates</h3>
<div class="paragraph">
<p>A provisioning template defines the way orcharhino&#160;Server installs an operating system on a host.
Use this procedure to clone a template and add your updates to the clone.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Find the template that you want to use.</p>
</li>
<li>
<p>Click <strong>Clone</strong> to duplicate the template.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the provisioning template.</p>
</li>
<li>
<p>Select the <strong>Default</strong> checkbox to set the template to associate automatically with new organizations or locations.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, enter the body of the provisioning template.
You can also use the <strong>Template</strong> file browser to upload a template file.</p>
</li>
<li>
<p>In the <strong>Audit Comment</strong> field, enter a summary of changes to the provisioning template for auditing purposes.</p>
</li>
<li>
<p>Click the <strong>Type</strong> tab and if your template is a snippet, select the <strong>Snippet</strong> checkbox.
A snippet is not a standalone provisioning template, but a part of a provisioning template that can be inserted into other provisioning templates.</p>
</li>
<li>
<p>From the <strong>Type</strong> list, select the type of the template.
For example, <strong>Provisioning template</strong>.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab and from the <strong>Applicable Operating Systems</strong> list, select the names of the operating systems that you want to associate with the provisioning template.</p>
</li>
<li>
<p>Optionally, click <strong>Add combination</strong> and select a host group from the <strong>Host Group</strong> list or an environment from the <strong>Environment</strong> list to associate provisioning template with the host groups and environments.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs to add any additional contexts to the template.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your provisioning template.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Custom_Provisioning_Snippets_provisioning"><a class="anchor" href="#Creating_Custom_Provisioning_Snippets_provisioning"></a>2.22. Creating custom provisioning snippets</h3>
<div class="paragraph">
<p>Custom provisioning snippets allow you to execute custom code during host provisioning.
You can run code before and/or after the provisioning process.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Depending on your provisioning template, multiple custom snippet hooks exist which you can use to include custom provisioning snippets.
Ensure that you check your provisioning template first to verify which custom snippets you can use.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> and click <strong>Create Template</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for your custom provisioning snippet.
The name has to start with the name of a provisioning template that supports including custom provisioning snippets:</p>
<div class="ulist">
<ul>
<li>
<p>Append ` custom pre` to the name of a provisioning template to run code before provisioning a host.</p>
</li>
<li>
<p>Append ` custom post` to the name of a provisioning template to run code after provisioning a host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>On the <strong>Type</strong> tab, select <strong>Snippet</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to create your custom provisioning snippet.</p>
</li>
</ol>
</div>
<div id="cli-Creating_Custom_Provisioning_Snippets_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Before you create a template with the CLI, create a plain text file that contains your custom snippet.</p>
</li>
<li>
<p>Create the template using <code>hammer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer template create \
--file "<em>/path/to/My_Snippet</em>" \
--locations "<em>My_Location</em>" \
--name "<em>My_Template_Name_custom_pre" \
--organizations "_My_Organization</em>" \
--type snippet</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Custom_Provisioning_Snippet_Example_for_Debian_provisioning"><a class="anchor" href="#Custom_Provisioning_Snippet_Example_for_Debian_provisioning"></a>2.23. Custom provisioning snippet example for Debian</h3>
<div class="paragraph">
<p>You can use <code>Custom Post</code> snippets to call external APIs from within the provisioning template directly after provisioning a host.</p>
</div>
<div class="listingblock">
<div class="title"><code>Preseed default custom post</code> Example for Debian/Ubuntu</div>
<div class="content">
<pre class="nowrap">echo "Calling API to report successful host deployment"

apt install -y curl ca-certificates

curl -X POST \
-H "Content-Type: application/json" \
-d '{"name": "&lt;%= @host.name %&gt;", "operating_system": "&lt;%= @host.operatingsystem.name %&gt;", "status": "provisioned",}' \
"https://api.example.com/"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Custom_Provisioning_Snippet_Example_for_Enterprise_Linux_provisioning"><a class="anchor" href="#Custom_Provisioning_Snippet_Example_for_Enterprise_Linux_provisioning"></a>2.24. Custom provisioning snippet example for Enterprise Linux</h3>
<div class="paragraph">
<p>You can use <code>Custom Post</code> snippets to call external APIs from within the provisioning template directly after provisioning a host.</p>
</div>
<div class="listingblock">
<div class="title"><code>Kickstart default finish custom post</code> Example for Enterprise Linux</div>
<div class="content">
<pre class="nowrap">echo "Calling API to report successful host deployment"

yum install -y curl ca-certificates

curl -X POST \
-H "Content-Type: application/json" \
-d '{"name": "&lt;%= @host.name %&gt;", "operating_system": "&lt;%= @host.operatingsystem.name %&gt;", "status": "provisioned",}' \
"https://api.example.com/"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Associating_Templates_with_Operating_Systems_provisioning"><a class="anchor" href="#Associating_Templates_with_Operating_Systems_provisioning"></a>2.25. Associating templates with operating systems</h3>
<div class="paragraph">
<p>You can associate templates with operating systems in orcharhino.
The following example adds a provisioning template to an operating system entry.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Select a provisioning template.</p>
</li>
<li>
<p>On the <strong>Association</strong> tab, select all applicable operating systems.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Optional: View all templates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer template list</pre>
</div>
</div>
</li>
<li>
<p>Optional: View all operating systems:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer os list</pre>
</div>
</div>
</li>
<li>
<p>Associate a template with an operating system:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer template add-operatingsystem \
--id <em>My_Template_ID</em> \
--operatingsystem-id <em>My_Operating_System_ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-compute-profiles_provisioning"><a class="anchor" href="#creating-compute-profiles_provisioning"></a>2.26. Creating compute profiles</h3>
<div class="paragraph">
<p>You can use compute profiles to predefine virtual machine hardware details such as CPUs, memory, and storage.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-compute-profiles_provisioning">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<p>A default installation of orcharhino contains three predefined profiles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>1-Small</code></p>
</li>
<li>
<p><code>2-Medium</code></p>
</li>
<li>
<p><code>3-Large</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can apply compute profiles to all supported compute resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#supported-cloud-providers_provisioning">Supported cloud providers</a></p>
</li>
<li>
<p><a href="#supported-virtualization-infrastructures_provisioning">Supported virtualization infrastructures</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong> and click <strong>Create Compute Profile</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the profile.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.
A new window opens with the name of the compute profile.</p>
</li>
<li>
<p>In the new window, click the name of each compute resource and edit the attributes you want to set for this compute profile.</p>
</li>
</ol>
</div>
<div id="cli-creating-compute-profiles_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a new compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile create --name "<em>My_Compute_Profile</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set attributes for the compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile values create \
--compute-attributes "<em>flavor=m1.small,cpus=2,memory=4GB,cpu_mode=default</em> \
--compute-resource "<em>My_Compute_Resource</em>" \
--compute-profile "<em>My_Compute_Profile</em>" \
--volume size=<em>40GB</em></pre>
</div>
</div>
</li>
<li>
<p>Optional: To update the attributes of a compute profile, specify the attributes you want to change.
For example, to change the number of CPUs and memory size:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile values update \
--compute-resource "<em>My_Compute_Resource</em>" \
--compute-profile "<em>My_Compute_Profile</em>" \
--attributes "<em>cpus=2,memory=4GB</em>" \
--interface "<em>type=network,bridge=br1,index=1</em>" \
--volume "size=<em>40GB</em>"</pre>
</div>
</div>
</li>
<li>
<p>Optional: To change the name of the compute profile, use the <code>--new-name</code> attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile update \
--name "<em>My_Compute_Profile</em>" \
--new-name "<em>My_New_Compute_Profile</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about creating compute profiles by using Hammer, enter <code>hammer compute-profile --help</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="setting-a-default-encrypted-root-password_provisioning"><a class="anchor" href="#setting-a-default-encrypted-root-password_provisioning"></a>2.27. Setting a default encrypted root password for hosts</h3>
<div class="paragraph">
<p>If you do not want to set a plain text default root password for the hosts that you provision, you can use a default encrypted password.</p>
</div>
<div class="paragraph">
<p>The default root password can be inherited by a host group and consequentially by hosts in that group.</p>
</div>
<div class="paragraph">
<p>If you change the password and reprovision the hosts in the group that inherits the password, the password will be overwritten on the hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Generate an encrypted password:</p>
<div class="listingblock">
<div class="content">
<pre>$ python3 -c 'import crypt,getpass;pw=getpass.getpass(); print(crypt.crypt(pw)) if (pw==getpass.getpass("Confirm: ")) else exit()'</pre>
</div>
</div>
</li>
<li>
<p>Copy the password for later use.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Settings</strong> page, select the <strong>Provisioning</strong> tab.</p>
</li>
<li>
<p>In the <strong>Name</strong> column, navigate to <strong>Root password</strong>, and click <strong>Click to edit</strong>.</p>
</li>
<li>
<p>Paste the encrypted password, and click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="using-novnc-to-access-virtual-machines_provisioning"><a class="anchor" href="#using-novnc-to-access-virtual-machines_provisioning"></a>2.28. Using noVNC to access virtual machines</h3>
<div class="paragraph">
<p>You can use your browser to access the VNC console of VMs created by orcharhino.</p>
</div>
<div class="paragraph">
<p>orcharhino supports using noVNC on the following virtualization platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VMware</p>
</li>
<li>
<p>Libvirt</p>
</li>
<li>
<p>oVirt</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have a virtual machine created by orcharhino.</p>
</li>
<li>
<p>For existing virtual machines, ensure that the <strong>Display type</strong> in the <strong>Compute Resource</strong> settings is <strong>VNC</strong>.</p>
</li>
<li>
<p>You must import the Katello root CA certificate into your orcharhino&#160;Server.
Adding a security exception in the browser is not enough for using noVNC.
For more information, see <a href="https://docs.theforeman.org/3.9/Administering_Project/index-orcharhino.html#Importing_the_Katello_Root_CA_Certificate_admin">Installing the Katello Root CA Certificate</a> in <em>Administering orcharhino</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your orcharhino&#160;Server, configure the firewall to allow VNC service on ports 5900 to 5930.</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --add-port=5900-5930/tcp
# firewall-cmd --add-port=5900-5930/tcp --permanent</pre>
</div>
</div>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and select the name of a compute resource.</p>
</li>
<li>
<p>In the <strong>Virtual Machines</strong> tab, select the name of your virtual machine.
Ensure the machine is powered on and then select <strong>Console</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_Networking_provisioning"><a class="anchor" href="#Configuring_Networking_provisioning"></a>3. Configuring networking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each provisioning type requires some network configuration.
Use this chapter to configure network services in your integrated orcharhino&#160;Proxy on orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>New hosts must have access to your orcharhino&#160;Proxy.
orcharhino&#160;Proxy can be either your integrated orcharhino&#160;Proxy on orcharhino&#160;Server or an external orcharhino&#160;Proxy.
You might want to provision hosts from an external orcharhino&#160;Proxy when the hosts are on isolated networks and cannot connect to orcharhino&#160;Server directly, or when the content is synchronized with orcharhino&#160;Proxy.
Provisioning using the external orcharhino&#160;Proxy can save on network bandwidth.</p>
</div>
<div class="paragraph">
<p>Configuring orcharhino&#160;Proxy has two basic requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuring network services.
This includes:</p>
<div class="ulist">
<ul>
<li>
<p>Content delivery services</p>
</li>
<li>
<p>Network services (DHCP, DNS, and TFTP)</p>
</li>
<li>
<p>Puppet configuration</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defining network resource data in orcharhino&#160;Server to help configure network interfaces on new hosts.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following instructions have similar applications to configuring standalone orcharhino&#160;Proxies managing a specific network.</p>
</div>
<div class="sect2">
<h3 id="facts-and-nic-filtering_provisioning"><a class="anchor" href="#facts-and-nic-filtering_provisioning"></a>3.1. Facts and NIC filtering</h3>
<div class="paragraph">
<p>Facts describe aspects such as total memory, operating system version, or architecture as reported by the host.
You can find facts in <strong>Monitor</strong> &gt; <strong>Facts</strong> and search hosts through facts or use facts in templates.</p>
</div>
<div class="paragraph">
<p>orcharhino collects facts from multiple sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>subscription manager</code></p>
</li>
<li>
<p><code>ansible</code></p>
</li>
<li>
<p><code>puppet</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>orcharhino is an inventory system for hosts and network interfaces.
For hypervisors or container hosts, adding thousands of interfaces per host and updating the inventory every few minutes is inadequate.
For each individual NIC reported, orcharhino creates a NIC entry and those entries are never removed from the database.
Parsing all the facts and comparing all records in the database makes orcharhino extremely slow and unusable.
To optimize the performance of various actions, most importantly fact import, you can use the options available on the <strong>Facts</strong> tab under <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="optimizing-performance-by-removing-nics-from-database_provisioning"><a class="anchor" href="#optimizing-performance-by-removing-nics-from-database_provisioning"></a>3.2. Optimizing performance by removing NICs from database</h3>
<div class="paragraph">
<p>Filter and exclude the connections using the <code>Exclude pattern for facts stored in orcharhino</code> and <code>Ignore interfaces with matching identifier</code> option.
By default, these options are set to most common hypervisors.
If you name the virtual interfaces differently, you can update this filter to use it according to your requirements.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and select the <strong>Facts</strong> tab.</p>
</li>
<li>
<p>To filter out all interfaces starting with specific names, for example, <code>blu</code>, add <code>blu*</code> to the <code>Ignore interfaces with matching identifier</code> option.</p>
</li>
<li>
<p>To prevent databases from storing facts related to interfaces starting with specific names, for example, <code>blu</code>, add <code>blu*</code> to the <code>Exclude pattern for facts stored in orcharhino</code> option.</p>
<div class="paragraph">
<p>By default, it contains the same list as the <code>Ignore interfaces with matching identifier</code> option.
You can override it based on the your requirements.
This filters out facts completely without storing them.</p>
</div>
</li>
<li>
<p>To remove facts from the database, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake facts:clean</pre>
</div>
</div>
<div class="paragraph">
<p>This command removes all facts matching with the filter added in <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Facts</strong> &gt; the <code>Exclude pattern for facts stored in orcharhino</code> option.</p>
</div>
</li>
<li>
<p>To remove interfaces from the database, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake interfaces:clean</pre>
</div>
</div>
<div class="paragraph">
<p>This command removes all interfaces matching with the filter added in <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Facts</strong> &gt; the <code>Ignore interfaces with matching identifier</code> option.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Network_Resources_provisioning"><a class="anchor" href="#Network_Resources_provisioning"></a>3.3. Network resources</h3>
<div class="paragraph">
<p>orcharhino contains networking resources that you must set up and configure to create a host.
It includes the following networking resources:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Domain</dt>
<dd>
<p>You must assign every host that is managed by orcharhino to a domain.
Using the domain, orcharhino can manage A, AAAA, and PTR records.
Even if you do not want orcharhino to manage your DNS servers, you still must create and associate at least one domain.
Domains are included in the naming conventions orcharhino hosts, for example, a host with the name <code>test123</code> in the <code>example.com</code> domain has the fully qualified domain name <code>test123.example.com</code>.</p>
</dd>
<dt class="hdlist1">Subnet</dt>
<dd>
<p>You must assign every host managed by orcharhino to a subnet.
Using subnets, orcharhino can then manage IPv4 reservations.
If there are no reservation integrations, you still must create and associate at least one subnet.
When you manage a subnet in orcharhino, you cannot create DHCP records for that subnet outside of orcharhino.
In orcharhino, you can use IP Address Management (IPAM) to manage IP addresses with one of the following options:</p>
<div class="ulist">
<ul>
<li>
<p><strong>DHCP</strong>: DHCP orcharhino&#160;Proxy manages the assignment of IP addresses by finding the next available IP address starting from the first address of the range and skipping all addresses that are reserved.
Before assigning an IP address, orcharhino&#160;Proxy sends an ICMP and TCP pings to check whether the IP address is in use.
Note that if a host is powered off, or has a firewall configured to disable connections, orcharhino makes a false assumption that the IP address is available.
This check does not work for hosts that are turned off, therefore, the <strong>DHCP</strong> option can only be used with subnets that orcharhino controls and that do not have any hosts created externally.</p>
<div class="paragraph">
<p>The orcharhino&#160;Proxy DHCP module retains the offered IP addresses for a short period of time to prevent collisions during concurrent access, so some IP addresses in the IP range might remain temporarily unused.</p>
</div>
</li>
<li>
<p><strong>Internal DB</strong>: orcharhino finds the next available IP address from the Subnet range by excluding all IP addresses from the orcharhino database in sequence.
The primary source of data is the database, not DHCP reservations.
This IPAM is not safe when multiple hosts are being created in parallel; in that case, use <strong>DHCP</strong> or <strong>Random DB</strong> IPAM instead.</p>
</li>
<li>
<p><strong>Random DB</strong>: orcharhino finds the next available IP address from the Subnet range by excluding all IP addresses from the orcharhino database randomly.
The primary source of data is the database, not DHCP reservations.
This IPAM is safe to use with concurrent host creation as IP addresses are returned in random order, minimizing the chance of a conflict.</p>
</li>
<li>
<p><strong>EUI-64</strong>: Extended Unique Identifier (EUI) 64bit IPv6 address generation, as per RFC2373, is obtained through the 48-bit MAC address.</p>
</li>
<li>
<p><strong>External IPAM</strong>: Delegates IPAM to an external system through orcharhino&#160;Proxy feature.
orcharhino currently does not ship with any external IPAM implementations, but several plugins are in development.</p>
</li>
<li>
<p><strong>None</strong>: IP address for each host must be entered manually.</p>
<div class="paragraph">
<p>Options DHCP, Internal DB and Random DB can lead to DHCP conflicts on subnets with records created externally.
These subnets must be under exclusive orcharhino control.</p>
</div>
<div class="paragraph">
<p>For more information about adding a subnet, see <a href="#Adding_a_Subnet_to_Server_provisioning">Adding a subnet to orcharhino&#160;Server</a>.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">DHCP Ranges</dt>
<dd>
<p>You can define the same DHCP range in orcharhino&#160;Server for both discovered and provisioned systems, but use a separate range for each service within the same subnet.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="DHCP_Options_provisioning"><a class="anchor" href="#DHCP_Options_provisioning"></a>3.4. orcharhino and DHCP options</h3>
<div class="paragraph">
<p>orcharhino manages DHCP reservations through a DHCP orcharhino&#160;Proxy.
orcharhino also sets the <code>next-server</code> and <code>filename</code> DHCP options.</p>
</div>
<div class="paragraph">
<div class="title">The next-server option</div>
<p>The <code>next-server</code> option provides the IP address of the TFTP server to boot from.
This option is not set by default and must be set for each TFTP orcharhino&#160;Proxy.
You can use the <code>foreman-installer</code> command with the <code>--foreman-proxy-tftp-servername</code> option to set the TFTP server in the <code>/etc/foreman-proxy/settings.d/tftp.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-tftp-servername <em>1.2.3.4</em></pre>
</div>
</div>
<div class="paragraph">
<p>Each TFTP orcharhino&#160;Proxy then reports this setting through the API and orcharhino can retrieve the configuration information when it creates the DHCP record.</p>
</div>
<div class="paragraph">
<p>When the PXE loader is set to <code>none</code>, orcharhino does not populate the <code>next-server</code> option into the DHCP record.</p>
</div>
<div class="paragraph">
<p>If the <code>next-server</code> option remains undefined, orcharhino calls the orcharhino&#160;Proxy API to retrieve the server name as specified by the <code>--foreman-proxy-tftp-servername</code> argument in a <code>foreman-installer</code> run.
If the orcharhino&#160;Proxy API call does not return a server name, orcharhino uses the hostname of the orcharhino&#160;Proxy.</p>
</div>
<div class="paragraph">
<div class="title">The filename option</div>
<p>The <code>filename</code> option contains the full path to the file that downloads and executes during provisioning.
The PXE loader that you select for the host or host group defines which <code>filename</code> option to use.
When the PXE loader is set to <code>none</code>, orcharhino does not populate the <code>filename</code> option into the DHCP record.
Depending on the PXE loader option, the <code>filename</code> changes as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PXE loader option</th>
<th class="tableblock halign-left valign-top">filename entry</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXELinux BIOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pxelinux.0</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXELinux UEFI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pxelinux.efi</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPXE Chain BIOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>undionly.kpxe</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXEGrub2 UEFI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grub2/grubx64.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x64 can differ depending on architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPXE UEFI HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http://<em>orcharhino-proxy.example.com</em>:8000/httpboot/ipxe-x64.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires the <code>httpboot</code> feature and renders the <code>filename</code> as a full URL where <em>orcharhino-proxy.example.com</em> is a known host name of orcharhino&#160;Proxy in orcharhino.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grub2 UEFI HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http://<em>orcharhino-proxy.example.com</em>:8000/httpboot/grub2/grubx64.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires the <code>httpboot</code> feature and renders the <code>filename</code> as a full URL where <em>orcharhino-proxy.example.com</em> is a known host name of orcharhino&#160;Proxy in orcharhino.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Troubleshooting_DHCP_Problems_provisioning"><a class="anchor" href="#Troubleshooting_DHCP_Problems_provisioning"></a>3.5. Troubleshooting DHCP problems in orcharhino</h3>
<div class="paragraph">
<p>orcharhino can manage an ISC DHCP server on internal or external DHCP orcharhino&#160;Proxy.
orcharhino can list, create, and delete DHCP reservations and leases.
However, there are a number of problems that you might encounter on occasions.</p>
</div>
<div class="paragraph">
<div class="title">Out of sync DHCP records</div>
<p>When an error occurs during DHCP orchestration, DHCP records in the orcharhino database and the DHCP server might not match.
To fix this, you must add missing DHCP records from the orcharhino database to the DHCP server and then remove unwanted records from the DHCP server as per the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To preview the DHCP records that are going to be added to the DHCP server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake orchestration:dhcp:add_missing subnet_name=NAME</pre>
</div>
</div>
</li>
<li>
<p>If you are satisfied by the preview changes in the previous step, apply them by entering the above command with the <code>perform=1</code> argument:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake orchestration:dhcp:add_missing subnet_name=NAME perform=1</pre>
</div>
</div>
</li>
<li>
<p>To keep DHCP records in orcharhino and in the DHCP server synchronized, you can remove unwanted DHCP records from the DHCP server.
Note that orcharhino assumes that all managed DHCP servers do not contain third-party records, therefore, this step might delete those unexpected records.
To preview what records are going to be removed from the DHCP server, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake orchestration:dhcp:remove_offending subnet_name=NAME</pre>
</div>
</div>
</li>
<li>
<p>If you are satisfied by the preview changes in the previous step, apply them by entering the above command with the <code>perform=1</code> argument:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake orchestration:dhcp:remove_offending subnet_name=NAME perform=1</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">PXE loader option change</div>
<p>When the PXE loader option is changed for an existing host, this causes a DHCP conflict.
The only workaround is to overwrite the DHCP entry.</p>
</div>
<div class="paragraph">
<div class="title">Incorrect permissions on DHCP files</div>
<p>An operating system update can update the <code>dhcpd</code> package.
This causes the permissions of important directories and files to reset so that the DHCP orcharhino&#160;Proxy cannot read the required information.</p>
</div>
<div class="paragraph">
<div class="title">Changing the DHCP orcharhino&#160;Proxy entry</div>
<p>orcharhino manages DHCP records only for hosts that are assigned to subnets with a DHCP orcharhino&#160;Proxy set.
If you create a host and then clear or change the DHCP orcharhino&#160;Proxy, when you attempt to delete the host, the action fails.</p>
</div>
<div class="paragraph">
<p>If you create a host without setting the DHCP orcharhino&#160;Proxy and then try to set the DHCP orcharhino&#160;Proxy, this causes DHCP conflicts.</p>
</div>
<div class="paragraph">
<div class="title">Deleted hosts entries in the dhcpd.leases file</div>
<p>Any changes to a DHCP lease are appended to the end of the <code>dhcpd.leases</code> file.
Because entries are appended to the file, it is possible that two or more entries of the same lease can exist in the <code>dhcpd.leases</code> file at the same time.
When there are two or more entries of the same lease, the last entry in the file takes precedence.
Group, subgroup and host declarations in the lease file are processed in the same manner.
If a lease is deleted, <code>{ deleted; }</code> is appended to the declaration.</p>
</div>
</div>
<div class="sect2">
<h3 id="Prerequisites_for_Image_Based_Provisioning_provisioning"><a class="anchor" href="#Prerequisites_for_Image_Based_Provisioning_provisioning"></a>3.6. Prerequisites for image-based provisioning</h3>
<div class="paragraph">
<div class="title">Post-boot configuration method</div>
<p>Images that use the <code>finish</code> post-boot configuration scripts require a managed DHCP server, such as orcharhino&#8217;s integrated orcharhino&#160;Proxy or an external orcharhino&#160;Proxy.
The host must be created with a subnet associated with a DHCP orcharhino&#160;Proxy, and the IP address of the host must be a valid IP address from the DHCP range.</p>
</div>
<div class="paragraph">
<p>It is possible to use an external DHCP service, but IP addresses must be entered manually.
The SSH credentials corresponding to the configuration in the image must be configured in orcharhino to enable the post-boot configuration to be made.</p>
</div>
<div class="paragraph">
<p>Check the following items when troubleshooting a virtual machine booted from an image that depends on post-configuration scripts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The host has a subnet assigned in orcharhino&#160;Server.</p>
</li>
<li>
<p>The subnet has a DHCP orcharhino&#160;Proxy assigned in orcharhino&#160;Server.</p>
</li>
<li>
<p>The host has a valid IP address assigned in orcharhino&#160;Server.</p>
</li>
<li>
<p>The IP address acquired by the virtual machine using DHCP matches the address configured in orcharhino&#160;Server.</p>
</li>
<li>
<p>The virtual machine created from an image responds to SSH requests.</p>
</li>
<li>
<p>The virtual machine created from an image authorizes the user and password, over SSH, which is associated with the image being deployed.</p>
</li>
<li>
<p>orcharhino&#160;Server has access to the virtual machine via SSH keys.
This is required for the virtual machine to receive post-configuration scripts from orcharhino&#160;Server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Pre-boot initialization configuration method</div>
<p>Images that use the <code>cloud-init</code> scripts require a DHCP server to avoid having to include the IP address in the image.
A managed DHCP orcharhino&#160;Proxy is preferred.
The image must have the <code>cloud-init</code> service configured to start when the system boots and fetch a script or configuration data to use in completing the configuration.</p>
</div>
<div class="paragraph">
<p>Check the following items when troubleshooting a virtual machine booted from an image that depends on initialization scripts included in the image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a DHCP server on the subnet.</p>
</li>
<li>
<p>The virtual machine has the <code>cloud-init</code> service installed and enabled.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Network_Services_provisioning"><a class="anchor" href="#Configuring_Network_Services_provisioning"></a>3.7. Configuring network services</h3>
<div class="paragraph">
<p>Some provisioning methods use orcharhino&#160;Proxy services.
For example, a network might require orcharhino&#160;Proxy to act as a DHCP server.
A network can also use PXE boot services to install the operating system on new hosts.
This requires configuring orcharhino&#160;Proxy to use the main PXE boot services: DHCP, DNS, and TFTP.</p>
</div>
<div class="paragraph">
<p>Use the <code>foreman-installer</code> command with the options to configure these services on orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>To configure these services on an external orcharhino&#160;Proxy, run <code>foreman-installer</code>.
For more information, see <a href="sources/installation_and_maintenance/installing_orcharhino_proxy.html">Installing orcharhino Proxy Guide</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the <code>foreman-installer</code> command to configure the required network services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dhcp true \
--foreman-proxy-dhcp-gateway "<em>192.168.140.1</em>" \
--foreman-proxy-dhcp-managed true \
--foreman-proxy-dhcp-nameservers "<em>192.168.140.2</em>" \
--foreman-proxy-dhcp-range "<em>192.168.140.10</em> <em>192.168.140.110</em>" \
--foreman-proxy-dhcp-server "<em>192.168.140.2</em>" \
--foreman-proxy-dns true \
--foreman-proxy-dns-forwarders "<em>8.8.8.8</em>" \
--foreman-proxy-dns-forwarders "<em>8.8.4.4</em>" \
--foreman-proxy-dns-managed true \
--foreman-proxy-dns-reverse "<em>140.168.192.in-addr.arpa</em>" \
--foreman-proxy-dns-server "<em>127.0.0.1</em>" \
--foreman-proxy-dns-zone "<em>example.com</em>" \
--foreman-proxy-tftp true \
--foreman-proxy-tftp-managed true</pre>
</div>
</div>
</li>
<li>
<p>Find orcharhino&#160;Proxy that you configure:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer proxy list</pre>
</div>
</div>
</li>
<li>
<p>Refresh features of orcharhino&#160;Proxy to view the changes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer proxy refresh-features --name "<em>orcharhino.example.com</em>"</pre>
</div>
</div>
</li>
<li>
<p>Verify the services configured on orcharhino&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer proxy info --name "<em>orcharhino.example.com</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="Multiple_Subnets_or_Domains_Using_Installer_provisioning"><a class="anchor" href="#Multiple_Subnets_or_Domains_Using_Installer_provisioning"></a>3.7.1. Multiple subnets or domains using installer</h4>
<div class="paragraph">
<p>The <code>foreman-installer</code> options allow only for a single DHCP subnet or DNS domain.
One way to define more than one subnet is by using a custom configuration file.</p>
</div>
<div class="paragraph">
<p>For every additional subnet or domain, create an entry in <code>/etc/foreman-installer/custom-hiera.yaml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dhcp::pools:
 isolated.lan:
   network: 192.168.99.0
   mask: 255.255.255.0
   gateway: 192.168.99.1
   range: 192.168.99.5 192.168.99.49

dns::zones:
  # creates @ SOA $::fqdn root.example.com.
  # creates $::fqdn A $::ipaddress
  example.com: {}

  # creates @ SOA test.example.net. hostmaster.example.com.
  # creates test.example.net A 192.0.2.100
  example.net:
    soa: test.example.net
    soaip: 192.0.2.100
    contact: hostmaster.example.com.

  # creates @ SOA $::fqdn root.example.org.
  # does NOT create an A record
  example.org:
    reverse: true

  # creates @ SOA $::fqdn hostmaster.example.com.
  2.0.192.in-addr.arpa:
    reverse: true
    contact: hostmaster.example.com.</pre>
</div>
</div>
<div class="paragraph">
<p>Execute <code>foreman-installer</code> to perform the changes and verify that the <code>/etc/dhcp/dhcpd.conf</code> contains appropriate entries.
Subnets must be then defined in orcharhino database.</p>
</div>
</div>
<div class="sect3">
<h4 id="DHCP_Options_For_Network_Configuration_provisioning"><a class="anchor" href="#DHCP_Options_For_Network_Configuration_provisioning"></a>3.7.2. DHCP options for network configuration</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">--foreman-proxy-dhcp</dt>
<dd>
<p>  Enables the DHCP service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-managed</dt>
<dd>
<p>  Enables Foreman to manage the DHCP service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-gateway</dt>
<dd>
<p>  The DHCP pool gateway.
Set this to the address of the external gateway for hosts on your private network.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-interface</dt>
<dd>
<p>  Sets the interface for the DHCP service to listen for requests.
Set this to <code>eth1</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-nameservers</dt>
<dd>
<p>  Sets the addresses of the nameservers provided to clients through DHCP.
Set this to the address for orcharhino&#160;Server on <code>eth1</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-range</dt>
<dd>
<p>A space-separated DHCP pool range for Discovered and Unmanaged services.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-server</dt>
<dd>
<p>Sets the address of the DHCP server to manage.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-subnets</dt>
<dd>
<p>  Sets the subnets of the DHCP server to manage.
Example: <code>--foreman-proxy-dhcp-subnets 192.168.205.0/255.255.255.128</code> or <code>--foreman-proxy-dhcp-subnets 192.168.205.128/255.255.255.128</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Run <code>foreman-installer --help</code> to view more options related to DHCP and other orcharhino&#160;Proxy services.</p>
</div>
</div>
<div class="sect3">
<h4 id="DNS_Options_For_Network_Configuration_provisioning"><a class="anchor" href="#DNS_Options_For_Network_Configuration_provisioning"></a>3.7.3. DNS options for network configuration</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">--foreman-proxy-dns</dt>
<dd>
<p>  Enables the DNS feature.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-provider</dt>
<dd>
<p>Selects the provider to be used.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-managed</dt>
<dd>
<p>  Let the installer manage ISC BIND.
This is only relevant when using the <code>nsupdate</code> and <code>nsupdate_gss</code> providers.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-forwarders</dt>
<dd>
<p>  Sets the DNS forwarders.
Only used when ISC BIND is managed by the installer.
Set this to your DNS recursors.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-interface</dt>
<dd>
<p>  Sets the interface to listen for DNS requests.
Only used when ISC BIND is managed by the installer.
Set this to <code>eth1</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-reverse</dt>
<dd>
<p>  The DNS reverse zone name.
Only used when ISC BIND is managed by the installer.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-server</dt>
<dd>
<p>  Sets the address of the DNS server.
Only used by the <code>nsupdate</code>, <code>nsupdate_gss</code>, and <code>infoblox</code> providers.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-zone</dt>
<dd>
<p>  Sets the DNS zone name.
Only used when ISC BIND is managed by the installer.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Run <code>foreman-installer --help</code> to view more options related to DNS and other orcharhino&#160;Proxy services.</p>
</div>
</div>
<div class="sect3">
<h4 id="TFTP_Options_For_Network_Configuration_provisioning"><a class="anchor" href="#TFTP_Options_For_Network_Configuration_provisioning"></a>3.7.4. TFTP options for network configuration</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">--foreman-proxy-tftp</dt>
<dd>
<p>  Enables TFTP service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-tftp-managed</dt>
<dd>
<p>  Enables Foreman to manage the TFTP service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-tftp-servername</dt>
<dd>
<p>  Sets the TFTP server to use.
Ensure that you use orcharhino&#160;Proxy&#8217;s IP address.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Run <code>foreman-installer --help</code> to view more options related to TFTP and other orcharhino&#160;Proxy services.</p>
</div>
</div>
<div class="sect3">
<h4 id="Using_TFTP_Services_Through_NAT_provisioning"><a class="anchor" href="#Using_TFTP_Services_Through_NAT_provisioning"></a>3.7.5. Using TFTP services through NAT</h4>
<div class="paragraph">
<p>You can use orcharhino TFTP services through NAT.
To do this, on all NAT routers or firewalls, you must enable a TFTP service on UDP port 69 and enable the TFTP state tracking feature.
For more information, see the documentation for your NAT device.</p>
</div>
<div class="olist arabic">
<div class="title">Using NAT on Linux with <code>firewalld</code>:</div>
<ol class="arabic">
<li>
<p>Allow the TFTP service in the firewall configuration:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --add-service=tftp</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Using NAT on linux with <code>iptables</code>:</div>
<ol class="arabic">
<li>
<p>Configure the firewall to allow TFTP service UDP on port 69:</p>
<div class="listingblock">
<div class="content">
<pre># iptables \
--sport 69 \
--state ESTABLISHED \
-A OUTPUT \
-i eth0 \
-j ACCEPT \
-m state \
-p udp
# service iptables save</pre>
</div>
</div>
</li>
<li>
<p>Load the <code>ip_conntrack_tftp</code> kernel TFTP state module.
In the <code>/etc/sysconfig/iptables-config</code> file, locate <code>IPTABLES_MODULES</code> and add <code>ip_conntrack_tftp</code> as follows:</p>
<div class="listingblock">
<div class="content">
<pre>IPTABLES_MODULES="ip_conntrack_tftp"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Domain_to_Server_provisioning"><a class="anchor" href="#Adding_a_Domain_to_Server_provisioning"></a>3.8. Adding a domain to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>orcharhino&#160;Server defines domain names for each host on the network.
orcharhino&#160;Server must have information about the domain and orcharhino&#160;Proxy responsible for domain name assignment.</p>
</div>
<div class="paragraph">
<div class="title">Checking for existing domains</div>
<p>orcharhino&#160;Server might already have the relevant domain created as part of orcharhino&#160;Server installation.
Switch the context to <code>Any Organization</code> and <code>Any Location</code> then check the domain list to see if it exists.</p>
</div>
<div class="paragraph">
<div class="title">DNS server configuration considerations</div>
<p>During the DNS record creation, orcharhino performs conflict DNS lookups to verify that the host name is not in active use.
This check runs against one of the following DNS servers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The system-wide resolver if <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Query local nameservers</strong> is set to <strong>true</strong>.</p>
</li>
<li>
<p>The nameservers that are defined in the subnet associated with the host.</p>
</li>
<li>
<p>The authoritative NS-Records that are queried from the SOA from the domain name associated with the host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you experience timeouts during DNS conflict resolution, check the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The subnet nameservers must be reachable from orcharhino&#160;Server.</p>
</li>
<li>
<p>The domain name must have a Start of Authority (SOA) record available from orcharhino&#160;Server.</p>
</li>
<li>
<p>The system resolver in the <code>/etc/resolv.conf</code> file must have a valid and working configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-a-domain_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and click <strong>Create Domain</strong>.</p>
</li>
<li>
<p>In the <strong>DNS Domain</strong> field, enter the full DNS domain name.</p>
</li>
<li>
<p>In the <strong>Fullname</strong> field, enter the plain text name of the domain.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and configure any domain level parameters to apply to hosts attached to this domain.
For example, user defined Boolean or string parameters to use in templates.</p>
</li>
<li>
<p>Click <strong>Add Parameter</strong> and fill in the <strong>Name</strong> and <strong>Value</strong> fields.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and add the location where the domain resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and add the organization that the domain belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
<div id="cli-adding-a-domain_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Use the <code>hammer domain create</code> command to create a domain:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer domain create \
--description "<em>My_Domain</em>" \
--dns-id <em>My_DNS_orcharhino_Proxy_ID</em> \
--locations "<em>My_Location</em>" \
--name "<em>my-domain.tld</em>" \
--organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Subnet_to_Server_provisioning"><a class="anchor" href="#Adding_a_Subnet_to_Server_provisioning"></a>3.9. Adding a subnet to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>You must add information for each of your subnets to orcharhino&#160;Server because orcharhino configures interfaces for new hosts.
To configure interfaces, orcharhino&#160;Server must have all the information about the network that connects these interfaces.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-a-subnet_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>, and in the Subnets window, click <strong>Create Subnet</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the subnet.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the subnet.</p>
</li>
<li>
<p>In the <strong>Network address</strong> field, enter the network address for the subnet.</p>
</li>
<li>
<p>In the <strong>Network prefix</strong> field, enter the network prefix for the subnet.</p>
</li>
<li>
<p>In the <strong>Network mask</strong> field, enter the network mask for the subnet.</p>
</li>
<li>
<p>In the <strong>Gateway address</strong> field, enter the external gateway for the subnet.</p>
</li>
<li>
<p>In the <strong>Primary DNS server</strong> field, enter a primary DNS for the subnet.</p>
</li>
<li>
<p>In the <strong>Secondary DNS server</strong>, enter a secondary DNS for the subnet.</p>
</li>
<li>
<p>From the <strong>IPAM</strong> list, select the method that you want to use for IP address management (IPAM).
For more information about IPAM, see <a href="#Network_Resources_provisioning">Network resources</a>.</p>
</li>
<li>
<p>Enter the information for the IPAM method that you select.
Click the <strong>Remote Execution</strong> tab and select the orcharhino&#160;Proxy that controls the remote execution.</p>
</li>
<li>
<p>Click the <strong>Domains</strong> tab and select the domains that apply to this subnet.</p>
</li>
<li>
<p>Click the <strong>orcharhino&#160;Proxies</strong> tab and select the orcharhino&#160;Proxy that applies to each service in the subnet, including DHCP, TFTP, and reverse DNS services.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and configure any subnet level parameters to apply to hosts attached to this subnet.
For example, user defined Boolean or string parameters to use in templates.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and select the locations that use this orcharhino&#160;Proxy.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and select the organizations that use this orcharhino&#160;Proxy.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the subnet information.</p>
</li>
</ol>
</div>
<div id="cli-adding-a-subnet_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the subnet with the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer subnet create \
--boot-mode "DHCP" \
--description "<em>My_Description</em>" \
--dhcp-id <em>My_DHCP_orcharhino_Proxy_ID</em> \
--dns-id <em>My_DNS_orcharhino_Proxy_ID</em> \
--dns-primary "192.168.140.2" \
--dns-secondary "8.8.8.8" \
--domains "<em>my-domain.tld" \
--from "192.168.140.111" \
--gateway "192.168.140.1" \
--ipam "DHCP" \
--locations "_My_Location</em>" \
--mask "255.255.255.0" \
--name "<em>My_Network</em>" \
--network "192.168.140.0" \
--organizations "<em>My_Organization</em>" \
--tftp-id <em>My_TFTP_orcharhino_Proxy_ID</em> \
--to "192.168.140.250"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Using_Infoblox_as_DHCP_and_DNS_Providers_provisioning"><a class="anchor" href="#Using_Infoblox_as_DHCP_and_DNS_Providers_provisioning"></a>4. Using Infoblox as DHCP and DNS providers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use orcharhino&#160;Proxy to connect to your Infoblox application to create and manage DHCP and DNS records, and to reserve IP addresses.</p>
</div>
<div class="paragraph">
<p>The supported Infoblox version is NIOS 8.0 or higher.</p>
</div>
<div class="sect2">
<h3 id="Infoblox_Limitations_provisioning"><a class="anchor" href="#Infoblox_Limitations_provisioning"></a>4.1. Infoblox limitations</h3>
<div class="paragraph">
<p>All DHCP and DNS records can be managed only in a single Network or DNS view.
After you install the Infoblox modules on orcharhino&#160;Proxy and set up the view using the <code>foreman-installer</code> command, you cannot edit the view.</p>
</div>
<div class="paragraph">
<p>orcharhino&#160;Proxy communicates with a single Infoblox node using the standard HTTPS web API.
If you want to configure clustering and High Availability, make the configurations in Infoblox.</p>
</div>
<div class="paragraph">
<p>Hosting PXE-related files using Infoblox&#8217;s TFTP functionality is not supported.
You must use orcharhino&#160;Proxy as a TFTP server for PXE provisioning.
For more information, see <a href="#Configuring_Networking_provisioning">Configuring networking</a>.</p>
</div>
<div class="paragraph">
<p>orcharhino IPAM feature cannot be integrated with Infoblox.</p>
</div>
</div>
<div class="sect2">
<h3 id="Infoblox_Prerequisites_provisioning"><a class="anchor" href="#Infoblox_Prerequisites_provisioning"></a>4.2. Infoblox prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>You must have Infoblox account credentials to manage DHCP and DNS entries in orcharhino.</p>
</li>
<li>
<p>Ensure that you have Infoblox administration roles with the names: <code>DHCP Admin</code> and <code>DNS Admin</code>.</p>
</li>
<li>
<p>The administration roles must have permissions or belong to an admin group that permits the accounts to perform tasks through the Infoblox API.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Installing_the_Infoblox_CA_Certificate_on_Smart_Proxy_provisioning"><a class="anchor" href="#Installing_the_Infoblox_CA_Certificate_on_Smart_Proxy_provisioning"></a>4.3. Installing the Infoblox CA certificate on orcharhino&#160;Proxy</h3>
<div class="paragraph">
<p>You must install Infoblox HTTPS CA certificate on the base system for all orcharhino&#160;Proxies that you want to integrate with Infoblox applications.</p>
</div>
<div class="paragraph">
<p>You can download the certificate from the Infoblox web UI, or you can use the following OpenSSL commands to download the certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># update-ca-trust enable
# openssl s_client -showcerts -connect <em>infoblox.example.com</em>:443 &lt;/dev/null | \
openssl x509 -text &gt;/etc/pki/ca-trust/source/anchors/infoblox.crt
# update-ca-trust extract</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code><em>infoblox.example.com</em></code> entry must match the host name for the Infoblox application in the X509 certificate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To test the CA certificate, use a CURL query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -u admin:password https://<em>infoblox.example.com</em>/wapi/v2.0/network</pre>
</div>
</div>
<div class="paragraph">
<p>Example positive response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[
    {
        "_ref": "network/ZG5zLm5ldHdvcmskMTkyLjE2OC4yMDIuMC8yNC8w:<em>infoblox.example.com</em>/24/default",
        "network": "192.168.202.0/24",
        "network_view": "default"
    }
]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Installing_the_DHCP_Infoblox_Module_provisioning"><a class="anchor" href="#Installing_the_DHCP_Infoblox_Module_provisioning"></a>4.4. Installing the DHCP Infoblox module</h3>
<div class="paragraph">
<p>Use this procedure to install the DHCP Infoblox module on orcharhino&#160;Proxy.
Note that you cannot manage records in separate views.</p>
</div>
<div class="paragraph">
<p>You can also install DHCP and DNS Infoblox modules simultaneously by combining this procedure and <a href="#Installing_the_DNS_Infoblox_Module_provisioning">Installing the DNS Infoblox module</a>.</p>
</div>
<div class="paragraph">
<div class="title">DHCP Infoblox record type considerations</div>
<p>If you want to use the DHCP and DNS Infoblox modules together, configure the DHCP Infoblox module with the <code>fixedaddress</code> record type only.
The <code>host</code> record type causes DNS conflicts and is not supported.</p>
</div>
<div class="paragraph">
<p>If you configure the DHCP Infoblox module with the <code>host</code> record type, you have to unset both DNS orcharhino&#160;Proxy and Reverse DNS orcharhino&#160;Proxy options on your Infoblox-managed subnets, because Infoblox does DNS management by itself.
Using the <code>host</code> record type leads to creating conflicts and being unable to rename hosts in orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino&#160;Proxy, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-proxy-plugin-dhcp-infoblox \
--foreman-proxy-dhcp true \
--foreman-proxy-dhcp-provider infoblox \
--foreman-proxy-dhcp-server <em>infoblox.example.com</em> \
--foreman-proxy-plugin-dhcp-infoblox-username <em>admin</em> \
--foreman-proxy-plugin-dhcp-infoblox-password <em>infoblox</em> \
--foreman-proxy-plugin-dhcp-infoblox-record-type fixedaddress \
--foreman-proxy-plugin-dhcp-infoblox-dns-view default \
--foreman-proxy-plugin-dhcp-infoblox-network-view default</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>orcharhino&#160;Proxies</strong>, select the orcharhino&#160;Proxy with the DHCP Infoblox module, and ensure that the <strong>dhcp</strong> feature is listed.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>.</p>
</li>
<li>
<p>For all subnets managed through Infoblox, ensure that the IP address management (<strong>IPAM</strong>) method of the subnet is set to <code>DHCP</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Installing_the_DNS_Infoblox_Module_provisioning"><a class="anchor" href="#Installing_the_DNS_Infoblox_Module_provisioning"></a>4.5. Installing the DNS Infoblox module</h3>
<div class="paragraph">
<p>Use this procedure to install the DNS Infoblox module on orcharhino&#160;Proxy.
You can also install DHCP and DNS Infoblox modules simultaneously by combining this procedure and <a href="#Installing_the_DHCP_Infoblox_Module_provisioning">Installing the DHCP Infoblox module</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino&#160;Proxy, enter the following command to configure the Infoblox module:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-proxy-plugin-dns-infoblox \
--foreman-proxy-dns true \
--foreman-proxy-dns-provider infoblox \
--foreman-proxy-plugin-dns-infoblox-dns-server <em>infoblox.example.com</em> \
--foreman-proxy-plugin-dns-infoblox-username <em>admin</em> \
--foreman-proxy-plugin-dns-infoblox-password <em>infoblox</em> \
--foreman-proxy-plugin-dns-infoblox-dns-view <em>default</em></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, you can change the value of the <code>--foreman-proxy-plugin-dns-infoblox-dns-view</code> option to specify an Infoblox DNS view other than the default view.</p>
</div>
</li>
<li>
<p>Optional: In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>orcharhino&#160;Proxies</strong>, select the orcharhino&#160;Proxy with the Infoblox DNS module, and ensure that the <strong>dns</strong> feature is listed.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong>.</p>
</li>
<li>
<p>For all domains managed through Infoblox, ensure that the <strong>DNS Proxy</strong> is set for those domains.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>.</p>
</li>
<li>
<p>For all subnets managed through Infoblox, ensure that the <strong>DNS orcharhino&#160;Proxy</strong> and <strong>Reverse DNS orcharhino&#160;Proxy</strong> are set for those subnets.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Using_PXE_to_Provision_Hosts_provisioning"><a class="anchor" href="#Using_PXE_to_Provision_Hosts_provisioning"></a>5. Using PXE to provision hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can provision bare-metal instances with orcharhino using one of the following methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Unattended Provisioning</dt>
<dd>
<p>New hosts are identified by a MAC address and orcharhino&#160;Server provisions the host using a PXE boot process.</p>
</dd>
<dt class="hdlist1">Unattended Provisioning with Discovery</dt>
<dd>
<p>New hosts use PXE boot to load the orcharhino Discovery service.
This service identifies hardware information about the host and lists it as an available host to provision.
For more information, see <a href="#Configuring_the_Discovery_Service_provisioning">Configuring the Discovery service</a>.</p>
</dd>
<dt class="hdlist1">PXE-less Provisioning</dt>
<dd>
<p>New hosts are provisioned with a boot disk or PXE-less discovery image that orcharhino&#160;Server generates.</p>
</dd>
<dt class="hdlist1">PXE-less Provisioning with Discovery</dt>
<dd>
<p>New hosts use an ISO boot disk that loads the orcharhino Discovery service.
This service identifies hardware information about the host and lists it as an available host to provision.
For more information, see <a href="#Implementing_PXE_less_Discovery_provisioning">Implementing PXE-less Discovery</a>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Discovery workflows are only available when the Discovery plugin is installed.
For more information, see <a href="#Configuring_the_Discovery_Service_provisioning">Configuring the Discovery service</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">BIOS and UEFI support</div>
<p>With orcharhino, you can perform both BIOS and UEFI based PXE provisioning.
Both BIOS and UEFI interfaces work as interpreters between the operating system and firmware of a computer, initializing hardware components and starting the operating system at boot time.</p>
</div>
<div class="paragraph">
<div class="title">PXE loaders</div>
<p>In orcharhino provisioning, the PXE loader option defines the DHCP <code>filename</code> option to use during provisioning.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For BIOS systems, use the <strong>PXELinux BIOS</strong> option to enable a provisioned host to download the <code>pxelinux.0</code> file over TFTP.</p>
</li>
<li>
<p>For UEFI systems, use the <strong>PXEGrub2 UEFI</strong> option to enable a TFTP client to download <code>grub2/grubx64.efi</code> file, or use the <strong>PXEGrub2 UEFI HTTP</strong> option to enable an UEFI HTTP client to download <code>grubx64.efi</code> from orcharhino&#160;Proxy with the HTTP Boot feature.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>orcharhino supports UEFI Secure Boot.
SecureBoot PXE loaders enable a client to download the <code>shim.efi</code> bootstrap boot loader that then loads the signed <code>grubx64.efi</code>.
Use the <strong>Grub2 UEFI SecureBoot</strong> PXE loader for PXE-boot provisioning or <strong>Grub2 UEFI HTTPS SecureBoot</strong> for HTTP-boot provisioning.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can only use Secure Boot to provision hosts with the same operating system version, major and minor, that runs on your TFTP orcharhino&#160;Proxy.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Other PXE loaders, such as PXELinux UEFI, Grub2 ELF, or iPXE Chain, require additional configuration.
These workflows are not documented.</p>
</div>
<div class="paragraph">
<div class="title">Template association with operating systems</div>
<p>For BIOS provisioning, you must associate a PXELinux template with the operating system.
For UEFI provisioning, you must associate a PXEGrub2 template with the operating system.
If you associate both PXELinux and PXEGrub2 templates, orcharhino can deploy configuration files for both on a TFTP server, so that you can switch between PXE loaders easily.</p>
</div>
<div class="sect2">
<h3 id="Prerequisites_for_Bare_Metal_Provisioning_provisioning"><a class="anchor" href="#Prerequisites_for_Bare_Metal_Provisioning_provisioning"></a>5.1. Prerequisites for bare-metal provisioning</h3>
<div class="paragraph">
<p>The requirements for bare-metal provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A orcharhino&#160;Proxy managing the network for bare-metal hosts.
For unattended provisioning and discovery-based provisioning, orcharhino&#160;Server requires PXE server settings.</p>
<div class="paragraph">
<p>For more information about networking requirements, see <a href="#Configuring_Networking_provisioning">Configuring networking</a>.</p>
</div>
<div class="paragraph">
<p>For more information about the Discovery service, <a href="#Configuring_the_Discovery_Service_provisioning">Configuring the Discovery service</a>.</p>
</div>
</li>
<li>
<p>A bare-metal host or a blank VM.</p>
</li>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Provide an activation key for host registration.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Creating_an_Activation_Key_content-management">Creating An Activation Key</a> in <em>Managing content</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about the security token for unattended and PXE-less provisioning, see <a href="#Configuring_the_Security_Token_Validity_Duration_provisioning">Configuring the security token validity duration</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_the_Security_Token_Validity_Duration_provisioning"><a class="anchor" href="#Configuring_the_Security_Token_Validity_Duration_provisioning"></a>5.2. Configuring the security token validity duration</h3>
<div class="paragraph">
<p>When performing any kind of provisioning, as a security measure, orcharhino automatically generates a unique token and adds this token to the OS installer recipe URL in the PXE configuration file (PXELinux, Grub2).
By default, the token is valid for 360 minutes.
When you provision a host, ensure that you reboot the host within this time frame.
If the token expires, it is no longer valid and you receive a 404 error and the operating system installer download fails.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Provisioning</strong> tab.</p>
</li>
<li>
<p>Find the <strong>Token duration</strong> option and click the edit icon and edit the duration, or enter <code>0</code> to disable token generation.
If token generation is disabled, an attacker can spoof client IP address and download OS installer recipe from orcharhino&#160;Server, including the encrypted root password.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Hosts_with_Unattended_Provisioning_provisioning"><a class="anchor" href="#Creating_Hosts_with_Unattended_Provisioning_provisioning"></a>5.3. Creating hosts with unattended provisioning</h3>
<div class="paragraph">
<p>Unattended provisioning is the simplest form of host provisioning.
You enter the host details on orcharhino&#160;Server and boot your host.
orcharhino&#160;Server automatically manages the PXE configuration, organizes networking services, and provides the operating system and configuration for the host.</p>
</div>
<div class="paragraph">
<p>This method of provisioning hosts uses minimal interaction during the process.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-hosts-with-unattended-provisioning_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>In the <strong>MAC address</strong> field, enter a MAC address of the provisioning interface of the host.
This ensures the identification of the host during the PXE boot process.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and verify that all fields contain values.
Confirm each aspect of the operating system.</p>
</li>
<li>
<p>Optional: Click <strong>Resolve</strong> in <strong>Provisioning template</strong> to check the new host can identify the right provisioning templates to use.</p>
<div class="paragraph">
<p>For more information about associating provisioning templates, see <a href="#provisioning-templates_provisioning">Provisioning templates</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/3.9/Managing_Hosts/index-orcharhino.html#Adding_Network_Interfaces_managing-hosts">Adding network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This creates the host entry and the relevant provisioning settings.
This also includes creating the necessary directories and files for PXE booting the bare-metal host.
If you start the physical host and set its boot mode to PXE, the host detects the DHCP service of orcharhino&#160;Server&#8217;s integrated orcharhino&#160;Proxy, receives HTTP endpoint of the Kickstart tree and installs the operating system.</p>
</div>
<div class="paragraph">
<p>When the installation completes, the host also registers to orcharhino&#160;Server using the activation key and installs the necessary configuration and management tools from the orcharhino&#160;Client repository.</p>
</div>
<div id="cli-creating-hosts-with-unattended-provisioning_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create the host with the <code>hammer host create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--build true \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--location "<em>My_Location</em>" \
--mac "<em>My_MAC_Address</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
<li>
<p>Ensure the network interface options are set using the <code>hammer host interface update</code> command:</p>
<div class="listingblock">
<div class="content">
<pre># hammer host interface update \
--host "_My_Host_Name_" \
--managed true \
--primary true \
--provision true</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Hosts_with_PXE_less_Provisioning_provisioning"><a class="anchor" href="#Creating_Hosts_with_PXE_less_Provisioning_provisioning"></a>5.4. Creating hosts with PXE-less provisioning</h3>
<div class="paragraph">
<p>Some hardware does not provide a PXE boot interface.
In orcharhino, you can provision a host without PXE boot.
This is also known as PXE-less provisioning and involves generating a boot ISO that hosts can use.
Using this ISO, the host can connect to orcharhino&#160;Server, boot the installation media, and install the operating system.</p>
</div>
<div class="paragraph">
<p>orcharhino also provides a PXE-less discovery service that operates without PXE-based services, such as DHCP and TFTP.
For more information, see <a href="#Implementing_PXE_less_Discovery_provisioning">Implementing PXE-less Discovery</a>.</p>
</div>
<div class="paragraph">
<div class="title">Boot ISO types</div>
<p>There are the following types of boot ISOs:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Host image</dt>
<dd>
<p>A boot ISO for the specific host.
This image contains only the boot files that are necessary to access the installation media on orcharhino&#160;Server.
The user defines the subnet data in orcharhino and the image is created with static networking.
The image is based on iPXE boot firmware, only a limited number of network cards is supported.</p>
</dd>
<dt class="hdlist1">Full host image</dt>
<dd>
<p>A boot ISO that contains the kernel and initial RAM disk image for the specific host.
This image is useful if the host fails to chainload correctly.
The provisioning template still downloads from orcharhino&#160;Server.</p>
</dd>
<dt class="hdlist1">Generic image</dt>
<dd>
<p>A boot ISO that is not associated with a specific host.
The ISO sends the host&#8217;s MAC address to orcharhino&#160;Server, which matches it against the host entry.
The image does not store IP address details and requires access to a DHCP server on the network to bootstrap.
This image is also available from the <code>/disks/generic</code> URL on your orcharhino&#160;Server, for example, <code>https://orcharhino.example.com/disks/generic</code>.</p>
</dd>
<dt class="hdlist1">Subnet image</dt>
<dd>
<p>A boot ISO that is not associated with a specific host.
The ISO sends the host&#8217;s MAC address to orcharhino&#160;Proxy, which matches it against the host entry.
The image does not store IP address details and requires access to a DHCP server on the network to bootstrap.
This image is generic to all hosts with a provisioning NIC on the same subnet.
The image is based on iPXE boot firmware, only a limited number of network cards is supported.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>Full host image</strong> is based on SYSLINUX and Grub and works with most network cards.
When using a <strong>Host image</strong>, <strong>Generic image</strong>, or <strong>Subnet image</strong>,
see <a href="https://ipxe.org/appnote/hardware_drivers">supported hardware on ipxe.org</a> for a list of network card drivers expected to work with an iPXE-based boot disk.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Host image</strong> and <strong>Full host image</strong> contain provisioning tokens, therefore the generated image has limited lifespan.
For more information about configuring security tokens, read <a href="#Configuring_the_Security_Token_Validity_Duration_provisioning">Configuring the security token validity duration</a>.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-hosts-with-pxe-less-provisioning_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>In the <strong>MAC address</strong> field, enter a MAC address of the provisioning interface of the host.
This ensures the identification of the host during the PXE boot process.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and verify that all fields contain values.
Confirm each aspect of the operating system.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning Templates</strong> to check the new host can identify the right provisioning templates to use.</p>
<div class="paragraph">
<p>For more information about associating provisioning templates, see <a href="#provisioning-templates_provisioning">Provisioning templates</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.
This creates a host entry and the host details page appears.</p>
</li>
<li>
<p>Download the boot disk from orcharhino&#160;Server.</p>
<div class="ulist">
<ul>
<li>
<p>For <strong>Host image</strong>, on the host details page, click the vertical ellipsis and select <strong>Host '<em>My_Host_Name</em>' image</strong>.</p>
</li>
<li>
<p>For <strong>Full host image</strong>, on the host details page, click the vertical ellipsis and select <strong>Full host '<em>My_Host_Name</em>' image</strong>.</p>
</li>
<li>
<p>For <strong>Generic image</strong>, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>, click <strong>Boot disk</strong> and select <strong>Generic image</strong>.</p>
</li>
<li>
<p>For <strong>Subnet image</strong>, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>, click the dropdown menu in the <strong>Actions</strong> column of the required subnet and select <strong>Subnet generic image</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Write the ISO to a USB storage device using the <code>dd</code> utility or <code>livecd-tools</code> if required.</p>
</li>
<li>
<p>When you start the host and boot from the ISO or the USB storage device, the host connects to orcharhino&#160;Server and starts installing operating system from its kickstart tree.</p>
<div class="paragraph">
<p>When the installation completes, the host also registers to orcharhino&#160;Server using the activation key and installs the necessary configuration and management tools from the <strong>orcharhino&#160;Client</strong> repository.</p>
</div>
</li>
</ol>
</div>
<div id="cli-creating-hosts-with-pxe-less-provisioning_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create the host using the <code>hammer host create</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--build true \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--location "<em>My_Location</em>" \
--mac "<em>My_MAC_Address</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
<li>
<p>Ensure that your network interface options are set using the <code>hammer host interface update</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host interface update \
--host "<em>My_Host_Name</em>" \
--managed true \
--primary true \
--provision true</pre>
</div>
</div>
</li>
<li>
<p>Download the boot disk from orcharhino&#160;Server using the <code>hammer bootdisk</code> command:</p>
<div class="ulist">
<ul>
<li>
<p>For <strong>Host image</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer bootdisk host --host <em>My_Host_Name</em></pre>
</div>
</div>
</li>
<li>
<p>For <strong>Full host image</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer bootdisk host \
--full true \
--host <em>My_Host_Name</em></pre>
</div>
</div>
</li>
<li>
<p>For <strong>Generic image</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer bootdisk generic</pre>
</div>
</div>
</li>
<li>
<p>For <strong>Subnet image</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer bootdisk subnet --subnet <em>My_Subnet_Name</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This creates a boot ISO for your host to use.</p>
</div>
</li>
<li>
<p>Write the ISO to a USB storage device using the <code>dd</code> utility or <code>livecd-tools</code> if required.</p>
</li>
<li>
<p>When you start the physical host and boot from the ISO or the USB storage device, the host connects to orcharhino&#160;Server and starts installing operating system from its kickstart tree.</p>
<div class="paragraph">
<p>When the installation completes, the host also registers to orcharhino&#160;Server using the activation key and installs the necessary configuration and management tools from the <strong>orcharhino&#160;Client</strong> repository.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Hosts_with_UEFI_HTTP_Boot_Provisioning_provisioning"><a class="anchor" href="#Creating_Hosts_with_UEFI_HTTP_Boot_Provisioning_provisioning"></a>5.5. Creating hosts with UEFI HTTP boot provisioning</h3>
<div class="paragraph">
<p>You can provision hosts from orcharhino using the UEFI HTTP Boot.
This is the only method with which you can provision hosts in IPv6 network.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-hosts-with-uefi-http-boot-provisioning_provisioning">CLI procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you meet the requirements for HTTP booting.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino&#160;Proxy that you use for provisioning, update the <code>grub2-efi</code> package to the latest version:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf upgrade grub2-efi</pre>
</div>
</div>
</li>
<li>
<p>Enable <code>foreman-proxy-http</code>, <code>foreman-proxy-httpboot</code>, and <code>foreman-proxy-tftp</code> features.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-http true \
--foreman-proxy-httpboot true \
--foreman-proxy-tftp true</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the orcharhino&#160;Proxy has TFTP and HTTPBoot features recognized.
In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>orcharhino&#160;Proxies</strong> and click on orcharhino&#160;Proxy to see the list of recognized features.
Click <strong>Refresh Features</strong> if any of the features are missing.</p>
</li>
<li>
<p>Ensure that orcharhino&#160;Proxy is associated with the provisioning subnet.
In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> &gt; <strong>Edit Subnet</strong> &gt; <strong>orcharhino&#160;Proxies</strong> and select the orcharhino&#160;Proxy for both <strong>TFTP</strong> and <strong>HTTPBoot</strong> options.</p>
</li>
<li>
<p>Click <strong>OK</strong> to save.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>In the <strong>MAC address</strong> field, enter a MAC address of the provisioning interface of the host.
This ensures the identification of the host during the PXE boot process.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and verify that all fields contain values.
Confirm each aspect of the operating system.</p>
</li>
<li>
<p>From the <strong>PXE Loader</strong> list, select <strong>Grub2 UEFI HTTP</strong>.</p>
</li>
<li>
<p>Optional: Click <strong>Resolve</strong> in <strong>Provisioning template</strong> to check the new host can identify the right provisioning templates to use.</p>
<div class="paragraph">
<p>For more information about associating provisioning templates, see <a href="#creating-provisioning-templates_provisioning">Creating provisioning templates</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/3.9/Managing_Hosts/index-orcharhino.html#Adding_Network_Interfaces_managing-hosts">Adding network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Set the host to boot in UEFI mode from network.</p>
</li>
<li>
<p>Start the host.</p>
</li>
<li>
<p>From the boot menu, select <strong>Kickstart default PXEGrub2</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This creates the host entry and the relevant provisioning settings.
This also includes creating the necessary directories and files for UEFI booting the bare-metal host.
When you start the physical host and set its boot mode to UEFI HTTP, the host detects the defined DHCP service, receives HTTP endpoint of orcharhino&#160;Proxy with the Kickstart tree and installs the operating system.</p>
</div>
<div class="paragraph">
<p>When the installation completes, the host also registers to orcharhino&#160;Server using the activation key and installs the necessary configuration and management tools from the orcharhino&#160;Client repository.</p>
</div>
<div id="cli-creating-hosts-with-uefi-http-boot-provisioning_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino&#160;Proxy that you use for provisioning, update the <code>grub2-efi</code> package to the latest version:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf upgrade grub2-efi</pre>
</div>
</div>
</li>
<li>
<p>Enable <code>foreman-proxy-http</code>, <code>foreman-proxy-httpboot</code>, and <code>foreman-proxy-tftp true</code> features:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-http true \
--foreman-proxy-httpboot true \
--foreman-proxy-tftp true</pre>
</div>
</div>
</li>
<li>
<p>Create the host with the <code>hammer host create</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--build true \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--location "<em>My_Location</em>" \
--mac "<em>My_MAC_Address</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>" \
--pxe-loader "Grub2 UEFI HTTP"</pre>
</div>
</div>
</li>
<li>
<p>Ensure the network interface options are set using the <code>hammer host interface update</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host interface update \
--host "<em>My_Host_Name</em>" \
--managed true \
--primary true \
--provision true</pre>
</div>
</div>
</li>
<li>
<p>Set the host to boot in UEFI mode from network.</p>
</li>
<li>
<p>Start the host.</p>
</li>
<li>
<p>From the boot menu, select <strong>Kickstart default PXEGrub2</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This creates the host entry and the relevant provisioning settings.
This also includes creating the necessary directories and files for UEFI booting the bare-metal host.
When you start the physical host and set its boot mode to UEFI HTTP, the host detects the defined DHCP service, receives HTTP endpoint of orcharhino&#160;Proxy with the Kickstart tree and installs the operating system.</p>
</div>
<div class="paragraph">
<p>When the installation completes, the host also registers to orcharhino&#160;Server using the activation key and installs the necessary configuration and management tools from the orcharhino&#160;Client repository.</p>
</div>
</div>
<div class="sect2">
<h3 id="Deploying_SSH_Keys_During_Provisioning_provisioning"><a class="anchor" href="#Deploying_SSH_Keys_During_Provisioning_provisioning"></a>5.6. Deploying SSH keys during provisioning</h3>
<div class="paragraph">
<p>Use this procedure to deploy SSH keys added to a user during provisioning.
For information on adding SSH keys to a user, see <a href="https://docs.theforeman.org/3.9/Administering_Project/index-orcharhino.html#Managing_SSH_Keys_for_a_User_admin">Managing SSH Keys for a User</a> in <em>Administering orcharhino</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Create a provisioning template, or clone and edit an existing template.
For more information, see <a href="#creating-provisioning-templates_provisioning">Creating provisioning templates</a>.</p>
</li>
<li>
<p>In the template, click the <strong>Template</strong> tab.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, add the <code>create_users</code> snippet to the <code>%post</code> section:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%= snippet('create_users') %&gt;</pre>
</div>
</div>
</li>
<li>
<p>Select the <strong>Default</strong> checkbox.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab.</p>
</li>
<li>
<p>From the <strong>Application Operating Systems</strong> list, select an operating system.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the provisioning template.</p>
</li>
<li>
<p>Create a host that is associated with the provisioning template or rebuild a host using the OS associated with the modified template.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Hosts/index-orcharhino.html#Creating_a_Host_managing-hosts">Creating a Host</a> in <em>Managing hosts</em>.</p>
<div class="paragraph">
<p>The SSH keys of the <strong>Owned by</strong> user are added automatically when the <code>create_users</code> snippet is executed during the provisioning process.
You can set <strong>Owned by</strong> to an individual user or a user group.
If you set <strong>Owned by</strong> to a user group, the SSH keys of all users in the user group are added automatically.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-ipxe-to-reduce-provisioning-times_provisioning"><a class="anchor" href="#using-ipxe-to-reduce-provisioning-times_provisioning"></a>6. Using iPXE to reduce provisioning times</h2>
<div class="sectionbody">
<div class="paragraph">
<p>iPXE is an open-source network-boot firmware.
It provides a full PXE implementation enhanced with additional features, such as booting from an HTTP server.
For more information about iPXE, see <a href="https://ipxe.org">iPXE website</a>.</p>
</div>
<div class="paragraph">
<p>You can use iPXE if the following restrictions prevent you from using PXE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A network with unmanaged DHCP servers.</p>
</li>
<li>
<p>A PXE service that is unreachable because of, for example, a firewall restriction.</p>
</li>
<li>
<p>A TFTP UDP-based protocol that is unreliable because of, for example, a low-bandwidth network.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="prerequisites-for-using-ipxe_provisioning"><a class="anchor" href="#prerequisites-for-using-ipxe_provisioning"></a>6.1. Prerequisites for using iPXE</h3>
<div class="paragraph">
<p>You can use iPXE to boot virtual machines in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your virtual machines run on a hypervisor that uses iPXE as primary firmware.</p>
</li>
<li>
<p>Your virtual machines are in BIOS mode.
In this case, you can configure PXELinux to chainboot iPXE and boot by using the HTTP protocol.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For booting virtual machines in UEFI mode by using HTTP, you can follow <a href="#Creating_Hosts_with_UEFI_HTTP_Boot_Provisioning_provisioning">Creating hosts with UEFI HTTP boot provisioning</a> instead.</p>
</div>
<div class="paragraph">
<div class="title">Supportability</div>
<p>ATIX&#160;AG does not officially support iPXE in orcharhino.</p>
</div>
<div class="ulist">
<div class="title">Host requirements</div>
<ul>
<li>
<p>The MAC address of the provisioning interface matches the host configuration.</p>
</li>
<li>
<p>The provisioning interface of the host has a valid DHCP reservation.</p>
</li>
<li>
<p>The NIC is capable of PXE booting.
For more information, see <a href="https://ipxe.org/appnote/hardware_drivers">supported hardware on ipxe.org</a> for a list of hardware drivers expected to work with an iPXE-based boot disk.</p>
</li>
<li>
<p>The NIC is compatible with iPXE.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_iPXE_Environment_provisioning"><a class="anchor" href="#Configuring_iPXE_Environment_provisioning"></a>6.2. Configuring iPXE environment</h3>
<div class="paragraph">
<p>Configure an iPXE environment on all orcharhino&#160;Proxies that you want to use for iPXE provisioning.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>In Enterprise Linux, security-related features of iPXE are not supported and the iPXE binary is built without security features.
For this reason, you can only use HTTP but not HTTPS.
You can recompile iPXE from source to use security features such as HTTPS.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>If you want to use orcharhino&#160;Proxies instead of your orcharhino&#160;Server, ensure that you have configured your orcharhino&#160;Proxies accordingly.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>It is essential to add your orcharhino&#160;Proxy to the list of trusted proxies on orcharhino&#160;Server!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.theforeman.org/3.9/Installing_Proxy/index-orcharhino.html#configuring-orcharhino-proxy-for-host-registration-and-provisioning_orcharhino-proxy">Configuring orcharhino&#160;Proxy for Host Registration and Provisioning</a> in <em>Installing orcharhino&#160;Proxy</em>.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable the <strong>TFTP</strong> and <strong>HTTPboot</strong> services on your orcharhino&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-httpboot true \
--foreman-proxy-tftp true</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>ipxe-bootimgs</code> package on your orcharhino&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ipxe-bootimgs</pre>
</div>
</div>
</li>
<li>
<p>Copy iPXE firmware to the TFTP directory.</p>
<div class="ulist">
<ul>
<li>
<p>Copy the iPXE firmware with the Linux kernel header:</p>
<div class="listingblock">
<div class="content">
<pre># cp /usr/share/ipxe/ipxe.lkrn /var/lib/tftpboot/</pre>
</div>
</div>
</li>
<li>
<p>Copy the UNDI iPXE firmware:</p>
<div class="listingblock">
<div class="content">
<pre># cp /usr/share/ipxe/undionly.kpxe /var/lib/tftpboot/undionly-ipxe.0</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Correct the SELinux file contexts:</p>
<div class="listingblock">
<div class="content">
<pre># restorecon -RvF /var/lib/tftpboot/</pre>
</div>
</div>
</li>
<li>
<p>Set the HTTP URL.</p>
<div class="ulist">
<ul>
<li>
<p>If you want to use orcharhino&#160;Server for booting, run the following command on orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-dhcp-ipxefilename "http://<em>orcharhino.example.com</em>/unattended/iPXE?bootstrap=1"</pre>
</div>
</div>
</li>
<li>
<p>If you want to use orcharhino&#160;Proxy for booting, run the following command on orcharhino&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dhcp-ipxe-bootstrap true</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Booting_Virtual_Machines_provisioning"><a class="anchor" href="#Booting_Virtual_Machines_provisioning"></a>6.3. Booting virtual machines</h3>
<div class="paragraph">
<p>Some virtualization hypervisors use iPXE as primary firmware for PXE booting.
If you use such a hypervisor, you can boot virtual machines without TFTP and PXELinux.</p>
</div>
<div class="paragraph">
<p>Booting a virtual machine has the following workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Virtual machine starts.</p>
</li>
<li>
<p>iPXE retrieves the network credentials, including an HTTP URL, by using DHCP.</p>
</li>
<li>
<p>iPXE loads the iPXE bootstrap template from orcharhino&#160;Proxy.</p>
</li>
<li>
<p>iPXE loads the iPXE template with MAC as a URL parameter from orcharhino&#160;Proxy.</p>
</li>
<li>
<p>iPXE loads the kernel and initial RAM disk of the installer.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your hypervisor must support iPXE.
The following virtualization hypervisors support iPXE:</p>
<div class="ulist">
<ul>
<li>
<p>libvirt</p>
</li>
<li>
<p>oVirt (deprecated)</p>
</li>
<li>
<p>VMWare (<a href="https://ipxe.org/howto/vmware">via custom firmware</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>You have configured your iPXE environment.
For more information, see <a href="#Configuring_iPXE_Environment_provisioning">Configuring iPXE environment</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the original templates shipped in orcharhino as described below.
If you require modification to an original template, clone the template, edit the clone, and associate the clone instead of the original template.
For more information, see <a href="#cloning-provisioning-templates_provisioning">Cloning provisioning templates</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Search for the required template:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>AutoYaST default iPXE</code> template for SUSE Linux Enterprise Server hosts.</p>
</li>
<li>
<p>The <code>Kickstart default iPXE</code> template for Enterprise Linux hosts.</p>
</li>
<li>
<p>The <code>Preseed default iPXE</code> template for Debian/Ubuntu hosts.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click the name of the template.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab and select the operating systems that your host uses.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add the organization that the host belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and select the operating system of your host.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>From the <strong>iPXE template</strong> list, select the required template:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>AutoYaST default iPXE</code> template for SUSE Linux Enterprise Server hosts.</p>
</li>
<li>
<p>The <code>Kickstart default iPXE</code> template for Enterprise Linux hosts.</p>
</li>
<li>
<p>The <code>Preseed default iPXE</code> template for Debian/Ubuntu hosts.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</li>
<li>
<p>In the <strong>Hosts</strong> page, select the host that you want to use.</p>
</li>
<li>
<p>Select the <strong>Operating System</strong> tab.</p>
</li>
<li>
<p>Set <strong>PXE Loader</strong> to <code>iPXE Embedded</code>.</p>
</li>
<li>
<p>Select the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>In <strong>Provisioning Templates</strong>, click <strong>Resolve</strong> and verify that the <strong>iPXE template</strong> resolves to the required template.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save host settings.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Chainbooting_iPXE_from_PXELinux_provisioning"><a class="anchor" href="#Chainbooting_iPXE_from_PXELinux_provisioning"></a>6.4. Chainbooting iPXE from PXELinux</h3>
<div class="paragraph">
<p>You can set up iPXE to use a built-in driver for network communication (<code>ipxe.lkrn</code>) or Universal Network Device Interface (UNDI) (<code>undionly-ipxe.0</code>).
You can choose to load either file depending on the networking hardware capabilities and iPXE driver availability.</p>
</div>
<div class="paragraph">
<p>UNDI is a minimalistic UDP/IP stack that implements TFTP client.
However, UNDI cannot support other protocols like HTTP.
To use HTTP with iPXE, use the iPXE build with built-in drivers (<code>ipxe.lkrn</code>).</p>
</div>
<div class="paragraph">
<p>Chainbooting iPXE has the following workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Host powers on.</p>
</li>
<li>
<p>PXE driver retrieves the network credentials by using DHCP.</p>
</li>
<li>
<p>PXE driver retrieves the PXELinux firmware <code>pxelinux.0</code> by using TFTP.</p>
</li>
<li>
<p>PXELinux searches for the configuration file on the TFTP server.</p>
</li>
<li>
<p>PXELinux chainloads iPXE <code>ipxe.lkrn</code> or <code>undionly-ipxe.0</code>.</p>
</li>
<li>
<p>iPXE retrieves the network credentials, including an HTTP URL, by using DHCP again.</p>
</li>
<li>
<p>iPXE chainloads the iPXE template from your Templates orcharhino&#160;Proxy.</p>
</li>
<li>
<p>iPXE loads the kernel and initial RAM disk of the installer.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have configured your iPXE environment.
For more information, see <a href="#Configuring_iPXE_Environment_provisioning">Configuring iPXE environment</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the original templates shipped in orcharhino as described below.
If you require modification to an original template, clone the template, edit the clone, and associate the clone instead of the original template.
For more information, see <a href="#cloning-provisioning-templates_provisioning">Cloning provisioning templates</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Search for the required PXELinux template:</p>
<div class="ulist">
<ul>
<li>
<p><code>PXELinux chain iPXE</code> to use <code>ipxe.lkrn</code></p>
</li>
<li>
<p><code>PXELinux chain iPXE UNDI</code> to use <code>undionly-ipxe.0</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click the name of the template you want to use.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab and select the operating systems that your host uses.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add the organization that the host belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>On the <strong>Provisioning Templates</strong> page, search for the required template:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>AutoYaST default iPXE</code> template for SUSE Linux Enterprise Server hosts.</p>
</li>
<li>
<p>The <code>Kickstart default iPXE</code> template for Enterprise Linux hosts.</p>
</li>
<li>
<p>The <code>Preseed default iPXE</code> template for Debian/Ubuntu hosts.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click the name of the template.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab and associate the template with the operating system that your host uses.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add the organization that the host belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and select the operating system of your host.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>From the <strong>PXELinux template</strong> list, select the template you want to use.</p>
</li>
<li>
<p>From the <strong>iPXE template</strong> list, select the required template:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>AutoYaST default iPXE</code> template for SUSE Linux Enterprise Server hosts.</p>
</li>
<li>
<p>The <code>Kickstart default iPXE</code> template for Enterprise Linux hosts.</p>
</li>
<li>
<p>The <code>Preseed default iPXE</code> template for Debian/Ubuntu hosts.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>, and select the host group you want to configure.</p>
</li>
<li>
<p>Select the <strong>Operating System</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Architecture</strong> and <strong>Operating system</strong>.</p>
</li>
<li>
<p>Set the <strong>PXE Loader</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Select <code>PXELinux BIOS</code> to chainboot iPXE (<code>ipxe.lkrn</code>) from PXELinux.</p>
</li>
<li>
<p>Select <code>iPXE Chain BIOS</code> to load <code>undionly-ipxe.0</code> directly.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_the_Discovery_Service_provisioning"><a class="anchor" href="#Configuring_the_Discovery_Service_provisioning"></a>7. Configuring the Discovery service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>orcharhino can detect hosts on a network that are not in your orcharhino inventory.
These hosts boot the discovery image that performs hardware detection and relays this information back to orcharhino&#160;Server.
This method creates a list of ready-to-provision hosts in orcharhino&#160;Server without needing to enter the MAC address of each host.</p>
</div>
<div class="paragraph">
<p>When you boot a blank bare-metal host, the boot menu has two options: <code>local</code> and <code>discovery</code>.
If you select <code>discovery</code> to boot the Discovery image, after a few minutes, the Discovery image completes booting and a status screen is displayed.</p>
</div>
<div class="paragraph">
<p>The Discovery service is enabled by default on orcharhino&#160;Server.
However, the default setting of the global templates is to boot from the local hard drive.
To change the default setting, in the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Provisioning</strong> tab.
Locate the <strong>Default PXE global template entry</strong> row, and in the <strong>Value</strong> column, enter <strong>discovery</strong>.
Then build the PXE default configuration.
Navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> and click <strong>Build PXE Default</strong>.
orcharhino distributes the PXE configuration to any TFTP Proxies.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/common/pxe-mode-orcharhino.svg" alt="PXE mode">
</div>
</div>
<div class="paragraph">
<p>Ensure that the DHCP range of all subnets that you plan to use for discovery do not intersect with the DHCP lease pool configured for the managed DHCP service.
The DHCP range is set in the orcharhino management UI, while the lease pool range is set using the <code>foreman-installer</code> command.
For example, in a 10.1.0.0/16 network range 10.1.0.0 to 10.1.127.255 could be allocated for leases and 10.1.128.0 to 10.1.255.254 could be allocated for reservations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Foreman Discovery image provided with orcharhino is based on CentOS Stream 8.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install Discovery on orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-plugin-discovery \
--enable-foreman-proxy-plugin-discovery</pre>
</div>
</div>
</li>
<li>
<p>Install <code>orcharhino-fdi</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install orcharhino-fdi</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>orcharhino-fdi</code> package installs the Discovery ISO to the <code>/usr/share/foreman-discovery-image/</code> directory.
You can build a PXE boot image from this ISO by using the <code>livecd-iso-to-pxeboot</code> tool.
The tool saves this PXE boot image in the <code>/var/lib/tftpboot/boot</code> directory.
For more information, see <a href="#Building_a_Discovery_Image_provisioning">Building a Discovery image</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the installation completes, you can view the new menu option by navigating to <strong>Hosts</strong> &gt; <strong>Discovered Hosts</strong>.</p>
</div>
<div class="sect2">
<h3 id="Installing_the_Discovery_Service_provisioning"><a class="anchor" href="#Installing_the_Discovery_Service_provisioning"></a>7.1. Installing the Discovery service</h3>
<div class="paragraph">
<p>Complete the following procedure to enable the Discovery service on orcharhino&#160;Proxy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following commands on orcharhino&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-proxy-plugin-discovery</pre>
</div>
</div>
</li>
<li>
<p>Install <code>orcharhino-fdi</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install orcharhino-fdi</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Subnets</div>
<p>All subnets with discoverable hosts require an appropriate orcharhino&#160;Proxy selected to provide the Discovery service.</p>
</div>
<div class="paragraph">
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>, select a subnet, click the orcharhino&#160;Proxies tab, and select the <strong>Discovery Proxy</strong> that you want to use.
Perform this for each subnet that you want to use.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Template_PXELinux_Discovery_Snippet_provisioning"><a class="anchor" href="#Provisioning_Template_PXELinux_Discovery_Snippet_provisioning"></a>7.2. Provisioning template PXELinux Discovery snippet</h3>
<div class="paragraph">
<p>For BIOS provisioning, the <code>PXELinux global default</code> template in the <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> window contains the snippet <code>pxelinux_discovery</code>.
The snippet has the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">LABEL discovery
  MENU LABEL Foreman Discovery Image
  KERNEL boot/fdi-image/vmlinuz0
  APPEND initrd=boot/fdi-image/initrd0.img rootflags=loop root=live:/fdi.iso rootfstype=auto ro rd.live.image acpi=force rd.luks=0 rd.md=0 rd.dm=0 rd.lvm=0 rd.bootif=0 rd.neednet=0 nomodeset proxy.url=&lt;%= foreman_server_url %&gt; proxy.type=foreman
  IPAPPEND 2</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>KERNEL</code> and <code>APPEND</code> options boot the Discovery image and ramdisk.
The <code>APPEND</code> option contains a <code>proxy.url</code> parameter, with the <code>foreman_server_url</code> macro as its argument.
This macro resolves to the full URL of orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>For UEFI provisioning, the <code>PXEgrub2 global default</code> template in the <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> window contains the snippet <code>pxegrub2_discovery</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">menuentry 'Foreman Discovery Image' --id discovery {
  linuxefi boot/fdi-image/vmlinuz0 rootflags=loop root=live:/fdi.iso rootfstype=auto ro rd.live.image acpi=force rd.luks=0 rd.md=0 rd.dm=0 rd.lvm=0 rd.bootif=0 rd.neednet=0 nomodeset proxy.url=&lt;%= foreman_server_url %&gt; proxy.type=foreman BOOTIF=01-$mac
  initrdefi boot/fdi-image/initrd0.img
}</pre>
</div>
</div>
<div class="paragraph">
<p>To use orcharhino&#160;Proxy to proxy the discovery steps, edit <code>/var/lib/tftpboot/pxelinux.cfg/default</code> or <code>/var/lib/tftpboot/grub2/grub.cfg</code> and change the URL to orcharhino&#160;Proxy FQDN you want to use.</p>
</div>
<div class="paragraph">
<p>The global template is available on orcharhino&#160;Server and all orcharhino&#160;Proxies that have the TFTP feature enabled.</p>
</div>
</div>
<div class="sect2">
<h3 id="Automatic_Contexts_for_Discovered_Hosts_provisioning"><a class="anchor" href="#Automatic_Contexts_for_Discovered_Hosts_provisioning"></a>7.3. Automatic contexts for discovered hosts</h3>
<div class="paragraph">
<p>orcharhino&#160;Server assigns an organization and location to discovered hosts automatically according to the following sequence of rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If a discovered host uses a subnet defined in orcharhino, the host uses the first organization and location associated with the subnet.</p>
</li>
<li>
<p>If the default location and organization is configured in global settings, the discovered hosts are placed in this organization and location.
To configure these settings, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Discovery</strong> and select values for the <strong>Discovery organization</strong> and <strong>Discovery location</strong> settings.
Ensure that the subnet of discovered host also belongs to the selected organization and location, otherwise orcharhino refuses to set it for security reasons.</p>
</li>
<li>
<p>If none of the previous conditions is met, orcharhino assigns the first organization and location ordered by name.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can change the organization or location manually by using the bulk actions on the <strong>Discovered Hosts</strong> page.
Select the discovered hosts to modify and, from the <strong>Select Action</strong> menu, select <strong>Assign Organization</strong> or <strong>Assign Location</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Discovery_Templates_and_Snippets_Settings_provisioning"><a class="anchor" href="#Discovery_Templates_and_Snippets_Settings_provisioning"></a>7.4. Discovery template and snippet settings</h3>
<div class="paragraph">
<p>To use the Discovery service, you must configure provisioning settings to set Discovery as the default service and set the templates that you want to use.</p>
</div>
<div class="paragraph">
<div class="title">Setting Discovery service as default</div>
<p>For both BIOS and UEFI, to set the Discovery service as the default service that boots for hosts that are not present in your current orcharhino inventory, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and click the <strong>Provisioning</strong> tab.</p>
</li>
<li>
<p>For the <strong>Default PXE global template entry</strong>, in the <strong>Value</strong> column, enter <code>discovery</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To use a template, in the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and click the <strong>Provisioning</strong> tab and set the templates that you want to use.</p>
</div>
<div class="paragraph">
<div class="title">Customizing templates and snippets</div>
<p>Templates and snippets are locked to prevent changes.
If you want to edit a template or snippet, clone it, save it with a unique name, and then edit the clone.</p>
</div>
<div class="paragraph">
<p>When you change the template or a snippet it includes, the changes must be propagated to orcharhino&#160;Server&#8217;s default PXE template.</p>
</div>
<div class="paragraph">
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> and click <strong>Build PXE Default</strong>.</p>
</div>
<div class="paragraph">
<p>This refreshes the default PXE template on orcharhino&#160;Server.</p>
</div>
<div class="dlist">
<div class="title">Additional settings</div>
<dl>
<dt class="hdlist1">The proxy.url argument</dt>
<dd>
<p>During the orcharhino installation process, if you use the default option <code>--enable-foreman-plugin-discovery</code>, you can edit the <code>proxy.url</code> argument in the template to set the URL of orcharhino&#160;Proxy that provides the discovery service.
You can change the <code>proxy.url</code> argument to the IP address or FQDN of another provisioning orcharhino&#160;Proxy that you want to use, but ensure that you append the port number, for example, <code>9090</code>.
If you use an alternative port number with the <code>--foreman-proxy-ssl-port</code> option during orcharhino installation, you must add that port number.
You can also edit the <code>proxy.url</code> argument to use a orcharhino IP address or FQDN so that the discovered hosts communicate directly with orcharhino&#160;Server.</p>
</dd>
<dt class="hdlist1">The proxy.type argument</dt>
<dd>
<p>If you use a orcharhino&#160;Proxy FQDN for the <code>proxy.url</code> argument, ensure that you set the <code>proxy.type</code> argument to <code>proxy</code>.
If you use a orcharhino FQDN, update the <code>proxy.type</code> argument to <code>foreman</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">proxy.url=https://<em>orcharhino-proxy.example.com</em>:9090 proxy.type=proxy</pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Rendering the orcharhino&#160;Proxy&#8217;s host name</div>
<p>orcharhino deploys the same template to all TFTP orcharhino&#160;Proxies and there is no variable or macro available to render the orcharhino&#160;Proxy&#8217;s host name.
The hard-coded <code>proxy.url</code> does not not work with two or more TFTP orcharhino&#160;Proxies.
As a workaround, every time you click <strong>Build PXE Defaults</strong>, edit the configuration file in the TFTP directory using SSH, or use a common DNS alias for appropriate subnets.</p>
</div>
<div class="paragraph">
<div class="title">Tagged VLAN provisioning</div>
<p>If you want to use tagged VLAN provisioning, and you want the discovery service to send a discovery request, add the following information to the <code>KERNEL</code> option in the discovery template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">fdi.vlan.primary=<em>example_VLAN_ID</em></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Hosts_from_Discovered_Hosts_provisioning"><a class="anchor" href="#Creating_Hosts_from_Discovered_Hosts_provisioning"></a>7.5. Creating hosts from discovered hosts</h3>
<div class="paragraph">
<p>Provisioning discovered hosts follows a provisioning process that is similar to PXE provisioning.
The main difference is that instead of manually entering the host&#8217;s MAC address, you can select the host to provision from the list of discovered hosts.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-hosts-from-discovered-hosts_provisioning">CLI procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure a domain and subnet on orcharhino.
For more information about networking requirements, see <a href="#Configuring_Networking_provisioning">Configuring networking</a>.</p>
</li>
<li>
<p>Configure the discovery service on orcharhino.
For more information, see <a href="#Installing_the_Discovery_Service_provisioning">Installing the Discovery service</a>.</p>
</li>
<li>
<p>A bare-metal host or a blank VM.</p>
</li>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Provide an activation key for host registration.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Creating_an_Activation_Key_content-management">Creating An Activation Key</a> in <em>Managing content</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about the security tokens, see <a href="#Configuring_the_Security_Token_Validity_Duration_provisioning">Configuring the security token validity duration</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Discovered host</strong>.
Select the host you want to use and click <strong>Provision</strong> to the right of the list.</p>
</li>
<li>
<p>Select from one of the two following options:</p>
<div class="ulist">
<ul>
<li>
<p>To provision a host from a host group, select a host group, organization, and location, and then click <strong>Create Host</strong>.</p>
</li>
<li>
<p>To provision a host with further customization, click <strong>Customize Host</strong> and enter the additional details you want to specify for the new host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>orcharhino&#160;Server automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>orcharhino&#160;Server automatically populates the MAC address from the Discovery results.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ensure that orcharhino&#160;Server automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and verify that all fields contain values.
Confirm each aspect of the operating system.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning template</strong> to check the new host can identify the right provisioning templates to use.
The host must resolve to the following provisioning templates:</p>
<div class="ulist">
<ul>
<li>
<p><strong>kexec Template:</strong> <code>Discovery Red Hat kexec</code></p>
</li>
<li>
<p><strong>provision Template:</strong> <code>orcharhino Kickstart Default</code></p>
<div class="paragraph">
<p>For more information about associating provisioning templates, see <a href="#provisioning-templates_provisioning">Provisioning templates</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the host provisioning is complete, the discovered host becomes a content host.
To view the host, navigate to <strong>Hosts</strong> &gt; <strong>Content Hosts</strong>.</p>
</div>
<div id="cli-creating-hosts-from-discovered-hosts_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Identify the discovered host to use for provisioning:</p>
<div class="listingblock">
<div class="content">
<pre># hammer discovery list</pre>
</div>
</div>
</li>
<li>
<p>Select a host and provision it using a host group.
Set a new host name with the <code>--new-name</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer discovery provision \
--build true \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--new-name "<em>My_New_Host_Name</em>" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>This removes the host from the discovered host listing and creates a host entry with the provisioning settings.
The Discovery image automatically resets the host so that it can boot to PXE.
The host detects the DHCP service on orcharhino&#160;Server&#8217;s integrated orcharhino&#160;Proxy and starts installing the operating system.
The rest of the process is identical to normal PXE workflow described in <a href="#Creating_Hosts_with_Unattended_Provisioning_provisioning">Creating hosts with unattended provisioning</a>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Discovery_Rules_provisioning"><a class="anchor" href="#Creating_Discovery_Rules_provisioning"></a>7.6. Creating Discovery rules</h3>
<div class="paragraph">
<p>As a method of automating the provisioning process for discovered hosts, orcharhino provides a feature to create discovery rules.
These rules define how discovered hosts automatically provision themselves, based on the assigned host group.
For example, you can automatically provision hosts with a high CPU count as hypervisors.
Likewise, you can provision hosts with large hard disks as storage servers.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-discovery-rules_provisioning">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<div class="title">NIC considerations</div>
<p>Auto provisioning does not currently allow configuring NICs; all systems are being provisioned with the NIC configuration that was detected during discovery.
However, you can set the NIC in the <code>OS installer recipe</code> scriplet, using a script, or using configuration management at a later stage.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Configure</strong> &gt; <strong>Discovery rules</strong>, and select <strong>Create Rule</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the rule.</p>
</li>
<li>
<p>In the <strong>Search</strong> field, enter the rules to determine whether to provision a host.
This field provides suggestions for values you enter and allows operators for multiple rules.
For example: <code>cpu_count  &gt; 8</code>.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select the host group to use as a template for this host.</p>
</li>
<li>
<p>In the <strong>Hostname</strong> field, enter the pattern to determine host names for multiple hosts.
This uses the same ERB syntax that provisioning templates use.
The host name can use the <code>@host</code> attribute for host-specific values and the <code>rand</code> macro for a random number or the <code>sequence_hostgroup_param_next</code> macro for incrementing the value.
For more information about provisioning templates, see <a href="#provisioning-templates_provisioning">Provisioning templates</a> and the API documentation.</p>
<div class="ulist">
<ul>
<li>
<p><code>myhost-&lt;%= sequence_hostgroup_param_next("EL7/MyHostgroup", 10, "discovery_host") %&gt;</code></p>
</li>
<li>
<p><code>myhost-&lt;%= rand(99999) %&gt;</code></p>
</li>
<li>
<p><code>abc-&lt;%= @host.facts['bios_vendor'] %&gt;-&lt;%= rand(99999) %&gt;</code></p>
</li>
<li>
<p><code>xyz-&lt;%= @host.hostgroup.name %&gt;</code></p>
</li>
<li>
<p><code>srv-&lt;%= @host.discovery_rule.name %&gt;</code></p>
</li>
<li>
<p><code>server-&lt;%= @host.ip.gsub('.','-') +  '-' + @host.hostgroup.subnet.name %&gt;</code></p>
<div class="paragraph">
<p>When creating host name patterns, ensure that the resulting host names are unique, do not start with numbers, and do not contain underscores or dots.
A good approach is to use unique information provided by Facter, such as the MAC address, BIOS, or serial ID.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Hosts limit</strong> field, enter the maximum number of hosts that you can provision with the rule.
Enter <code>0</code> for unlimited.</p>
</li>
<li>
<p>In the <strong>Priority</strong> field, enter a number to set the precedence the rule has over other rules.
Rules with lower values have a higher priority.</p>
</li>
<li>
<p>From the <strong>Enabled</strong> list, select whether you want to enable the rule.</p>
</li>
<li>
<p>To set a different provisioning context for the rule, click the <strong>Organizations</strong> and <strong>Locations</strong> tabs and select the contexts you want to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your rule.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Discovered Host</strong> and select one of the following two options:</p>
<div class="ulist">
<ul>
<li>
<p>From the <strong>Discovered hosts</strong> list on the right, select <strong>Auto-Provision</strong> to automatically provisions a single host.</p>
</li>
<li>
<p>On the upper right of the window, click <strong>Auto-Provision All</strong> to automatically provisions all hosts.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="cli-creating-discovery-rules_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create the rule with the <code>hammer discovery-rule create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer discovery-rule create \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--hostname "hypervisor-&lt;%= rand(99999) %&gt;" \
--hosts-limit 5 \
--name "<em>My_Hypervisor</em>" \
--priority 5 \
--search "cpu_count  &gt; 8"</pre>
</div>
</div>
</li>
<li>
<p>Automatically provision a host with the <code>hammer discovery auto-provision</code> command:</p>
<div class="listingblock">
<div class="content">
<pre># hammer discovery auto-provision --name "macabcdef123456"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Implementing_PXE_less_Discovery_provisioning"><a class="anchor" href="#Implementing_PXE_less_Discovery_provisioning"></a>7.7. Implementing PXE-less Discovery</h3>
<div class="paragraph">
<p>orcharhino provides a PXE-less Discovery service that operates without the need for PXE-based services (DHCP and TFTP).
You accomplish this using orcharhino&#160;Server&#8217;s Discovery image.
Once a discovered node is scheduled for installation, it uses <code>kexec</code> command to reload Linux kernel with OS installer without rebooting the node.</p>
</div>
<div class="paragraph">
<div class="title">Known issues</div>
<p>The console might freeze during the process.
On some hardware, you might experience graphical hardware problems.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/common/pxeless-mode-orcharhino.svg" alt="PXE-less mode">
</div>
</div>
<div class="paragraph">
<p>If you have not yet installed the Discovery service or image, see <a href="#Building_a_Discovery_Image_provisioning">Building a Discovery image</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Attended use</div>
<ol class="arabic">
<li>
<p>Copy this media to either a CD, DVD, or a USB stick.
For example, to copy to a USB stick at <code>/dev/sdb</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dd bs=4M \
if=/usr/share/foreman-discovery-image/foreman-discovery-image-3.4.4-5.iso \
of=/dev/sdb</pre>
</div>
</div>
</li>
<li>
<p>Insert the Discovery boot media into a bare-metal host, start the host, and boot from the media.
The Discovery Image displays an option for either <strong>Manual network setup</strong> or <strong>Discovery with DHCP</strong>:</p>
<div class="paragraph">
<p>If you select <strong>Manual network setup</strong>, the Discovery image requests a set of network options.
This includes the primary network interface that connects to orcharhino&#160;Server.
This Discovery image also asks for network interface configuration options, such as an <strong>IPv4 Address</strong>, <strong>IPv4 Gateway</strong>, and an <strong>IPv4 DNS</strong> server.</p>
</div>
</li>
<li>
<p>After entering these details, select <strong>Next</strong>.</p>
</li>
<li>
<p>If you select <strong>Discovery with DHCP</strong>, the Discovery image requests only the primary network interface that connects to orcharhino&#160;Server.
It attempts to automatically configure the network interface using a DHCP server, such as one that a orcharhino&#160;Proxy provides.</p>
</li>
<li>
<p>After the primary interface configuration, the Discovery image requests the <strong>Server URL</strong>, which is the URL of orcharhino&#160;Server or orcharhino&#160;Proxy offering the Discovery service.
For example, to use the integrated orcharhino&#160;Proxy on orcharhino&#160;Server, use the following URL:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://orcharhino.example.com:9090</pre>
</div>
</div>
</li>
<li>
<p>Set the <strong>Connection type</strong> to <code>Proxy</code>, then select <strong>Next</strong>.</p>
</li>
<li>
<p>Optional: The Discovery image also provides a set of fields to input <strong>Custom facts</strong> for the Facter tool to relay back to orcharhino&#160;Server.
These are entered in a <strong>name</strong>-<strong>value</strong> format.
Provide any custom facts you require and select <strong>Confirm</strong> to continue.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>orcharhino reports a successful communication with orcharhino&#160;Server&#8217;s Discovery service.
In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Discovered Hosts</strong> and view the newly discovered host.</p>
</div>
<div class="paragraph">
<p>For more information about provisioning discovered hosts, see <a href="#Creating_Hosts_from_Discovered_Hosts_provisioning">Creating hosts from discovered hosts</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Building_a_Discovery_Image_provisioning"><a class="anchor" href="#Building_a_Discovery_Image_provisioning"></a>7.8. Building a Discovery image</h3>
<div class="paragraph">
<p>The Discovery image is a minimal operating system that is PXE-booted on hosts to acquire initial hardware information and to check in with orcharhino.
Discovered hosts keep running the Discovery image until they are rebooted into Anaconda, which then initiates the provisioning process.</p>
</div>
<div class="paragraph">
<p>Run the following procedure on Enterprise Linux 8.</p>
</div>
<div class="paragraph">
<p>The Discovery image is based on CentOS Stream 8.</p>
</div>
<div class="paragraph">
<p>Use this procedure to build a orcharhino discovery image or rebuild an image if you change configuration files.</p>
</div>
<div class="paragraph">
<p>Do not use this procedure on your production orcharhino or orcharhino&#160;Proxy.
Use either a dedicated environment or copy the synchronized repositories and a kickstart file to a separate server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that hardware virtualization is available on your host.</p>
</li>
<li>
<p>Install the following packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install git-core lorax anaconda pykickstart wget qemu-kvm</pre>
</div>
</div>
</li>
<li>
<p>Clone the <code>foreman-discovery-image</code> repository:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ git clone https://github.com/theforeman/foreman-discovery-image.git
$ cd foreman-discovery-image</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Replace the contents of the <code>00-repos-centos8.ks</code> file with the following:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">url --mirrorlist=http://mirrorlist.centos.org/?release=8&arch=$basearch&repo=baseos
repo --name="AppStream" --mirrorlist=http://mirrorlist.centos.org/?release=8&arch=$basearch&repo=appstream
repo --name="foreman-el8" --baseurl=http://yum.theforeman.org/releases/6.6/el8/$basearch/
repo --name="foreman-plugins-el8" --baseurl=http://yum.theforeman.org/plugins/6.6/el8/$basearch/
module --name=ruby --stream=2.7
module --name=postgresql --stream=12
module --name=foreman --stream=el8</pre>
</div>
</div>
</li>
<li>
<p>Prepare the kickstart file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ./build-livecd fdi-centos8.ks</pre>
</div>
</div>
</li>
<li>
<p>Build the ISO image:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo ./build-livecd-root <em>custom</em> ./result "nomodeset nokaslr"</pre>
</div>
</div>
<div class="paragraph">
<p>The options <code>nomodeset</code> and <code>nokaslr</code> instruct the Discovery image kernel to disable mode setting and to disable ASLR (Address Space Layout Randomization).</p>
</div>
</li>
<li>
<p>Verify that your <code>./result/fdi-custom-XXXXXXX.iso</code> file is created:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ls -h ./result/*.iso</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Use the following command to build a fully automated Discovery image with a static network configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo ./build-livecd-root <em>custom</em> ./result \
"nomodeset nokaslr \
fdi.pxip=192.168.140.20/24 fdi.pxgw=192.168.140.1 \
fdi.pxdns=192.168.140.2 proxy.url=https://orcharhino.example.com:8443 \
proxy.type=foreman fdi.pxmac=52:54:00:be:8e:8c fdi.pxauto=1"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about configuration options, see <a href="#Unattended_Use_Customization_and_Image_Remastering_provisioning">Unattended use, customization, and image remastering</a>.</p>
</div>
<div class="paragraph">
<p>When you create the <code>.iso</code> file, you can boot the <code>.iso</code> file over a network or locally.
Complete one of the following procedures.</p>
</div>
<div class="paragraph">
<p>If you want to boot the <code>.iso</code> file over a network, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a directory to store your boot files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /var/lib/tftpboot/boot/<em>myimage</em></pre>
</div>
</div>
</li>
<li>
<p>Copy the <code>./tftpboot/initrd0.img</code> and <code>./tftpboot/vmlinuz0</code> files to your new directory.</p>
</li>
<li>
<p>Edit the <code>KERNEL</code> and <code>APPEND</code> entries in the <code>/var/lib/tftpboot/pxelinux.cfg</code> file to add the information about your own initial ramdisk and kernel files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you want to create a hybrid <code>.iso</code> file for booting locally, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To convert the <code>.iso</code> file to an <code>.iso</code> hybrid file for PXE provisioning, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># isohybrid --partok fdi.iso</pre>
</div>
</div>
<div class="paragraph">
<p>If you have <code>grub2</code> packages installed, you can also use the following command to install a <code>grub2</code> bootloader:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># isohybrid --partok --uefi fdi.iso</pre>
</div>
</div>
</li>
<li>
<p>To add <code>md5</code> checksum to the <code>.iso</code> file so it can pass installation media validation tests in orcharhino, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># implantisomd5 fdi.iso</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Unattended_Use_Customization_and_Image_Remastering_provisioning"><a class="anchor" href="#Unattended_Use_Customization_and_Image_Remastering_provisioning"></a>7.9. Unattended use, customization, and image remastering</h3>
<div class="paragraph">
<p>You can create a customized Discovery ISO to automate the image configuration process after booting.
The Discovery image uses a Linux kernel for the operating system, which passes kernel parameters to configure the discovery service.
These kernel parameters include the following entries:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">fdi.cachefacts</dt>
<dd>
<p>Number of fact uploads without caching.
By default, orcharhino does not cache any uploaded facts.</p>
</dd>
<dt class="hdlist1">fdi.countdown</dt>
<dd>
<p>Number of seconds to wait until the text-user interface is refreshed after the initial discovery attempt.
This value defaults to 45 seconds.
Increase this value if the status page reports the IP address as <code>N/A</code>.</p>
</dd>
<dt class="hdlist1">fdi.dhcp_timeout</dt>
<dd>
<p>NetworkManager DHCP timeout.
The default value is 300 seconds.</p>
</dd>
<dt class="hdlist1">fdi.dns_nameserver</dt>
<dd>
<p>Nameserver to use for DNS SRV record.</p>
</dd>
<dt class="hdlist1">fdi.dns_ndots</dt>
<dd>
<p><code>ndots</code> option to use for DNS SRV record.</p>
</dd>
<dt class="hdlist1">fdi.dns_search</dt>
<dd>
<p>Search domain to use for DNS SRV record.</p>
</dd>
<dt class="hdlist1">fdi.initnet</dt>
<dd>
<p>By default, the image initializes all network interfaces (value <code>all</code>).
When this setting is set to <code>bootif</code>, only the network interface it was network-booted from will be initialized.</p>
</dd>
<dt class="hdlist1">fdi.ipv4.method</dt>
<dd>
<p>By default, NetworkManager IPv4 method setting is set to <code>auto</code>.
This option overrides it, set it to <code>ignore</code> to disable the IPv4 stack.
This option works only in DHCP mode.</p>
</dd>
<dt class="hdlist1">fdi.ipv6.method</dt>
<dd>
<p>By default, NetworkManager IPv6 method setting is set to <code>auto</code>.
This option overrides it, set it to <code>ignore</code> to disable the IPv6 stack.
This option only works in DHCP mode.</p>
</dd>
<dt class="hdlist1">fdi.ipwait</dt>
<dd>
<p>Duration in seconds to wait for IP to be available in HTTP proxy SSL cert start.
By default, orcharhino waits for 120 seconds.</p>
</dd>
<dt class="hdlist1">fdi.nmwait</dt>
<dd>
<p><code>nmcli -wait</code> option for NetworkManager.
By default, <code>nmcli</code> waits for 120 seconds.</p>
</dd>
<dt class="hdlist1">fdi.proxy_cert_days</dt>
<dd>
<p>Number of days the self-signed HTTPS cert is valid for.
By default, the certificate is valid for 999 days.</p>
</dd>
<dt class="hdlist1">fdi.pxauto</dt>
<dd>
<p>To set automatic or semi-automatic mode.
If set to 0, the image uses semi-automatic mode, which allows you to confirm your choices through a set of dialog options.
If set to 1, the image uses automatic mode and proceeds without any confirmation.</p>
</dd>
<dt class="hdlist1">fdi.pxfactname1, fdi.pxfactname2 &#8230;&#8203; fdi.pxfactnameN</dt>
<dd>
<p>Use to specify custom fact names.</p>
</dd>
<dt class="hdlist1">fdi.pxfactvalue1, fdi.pxfactvalue2 &#8230;&#8203; fdi.pxfactvalueN</dt>
<dd>
<p>The values for each custom fact.
Each value corresponds to a fact name.
For example, <code>fdi.pxfactvalue1</code> sets the value for the fact named with <code>fdi.pxfactname1</code>.</p>
</dd>
<dt class="hdlist1">fdi.pxip, fdi.pxgw, fdi.pxdns</dt>
<dd>
<p>Manually configures IP address (<code>fdi.pxip</code>), the gateway (<code>fdi.pxgw</code>), and the DNS (<code>fdi.pxdns</code>) for the primary network interface.
If you omit these parameters, the image uses DHCP to configure the network interface.
You can add multiple DNS entries in a comma-separated
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>
list, for example <code>fdi.pxdns=192.168.1.1,192.168.200.1</code>.</p>
</dd>
<dt class="hdlist1">fdi.pxmac</dt>
<dd>
<p>The MAC address of the primary interface in the format of <code>AA:BB:CC:DD:EE:FF</code>.
This is the interface you aim to use for communicating with orcharhino&#160;Proxy.
In automated mode, the first NIC (using network identifiers in alphabetical order) with a link is used.
In semi-automated mode, a screen appears and requests you to select the correct interface.</p>
</dd>
<dt class="hdlist1">fdi.rootpw</dt>
<dd>
<p>By default, the <code>root</code> account is locked.
Use this option to set a root password.
You can enter both clear and encrypted passwords.</p>
</dd>
<dt class="hdlist1">fdi.ssh</dt>
<dd>
<p>By default, the SSH service is disabled.
Set this to <code>1</code> or <code>true</code> to enable SSH access.</p>
</dd>
<dt class="hdlist1">fdi.uploadsleep</dt>
<dd>
<p>Duration in seconds between facter runs.
By default, facter runs every 30 seconds.</p>
</dd>
<dt class="hdlist1">fdi.vlan.primary</dt>
<dd>
<p>VLAN tagging ID to set for the primary interface.</p>
</dd>
<dt class="hdlist1">fdi.zips</dt>
<dd>
<p>Filenames with extensions to be downloaded and started during boot.
For more information, see see <a href="#Extending_the_Discovery_Image_provisioning">Extending the Discovery image</a>.</p>
</dd>
<dt class="hdlist1">fdi.zipserver</dt>
<dd>
<p>TFTP server to use to download extensions from.
For more information, see see <a href="#Extending_the_Discovery_Image_provisioning">Extending the Discovery image</a>.</p>
</dd>
<dt class="hdlist1">proxy.type</dt>
<dd>
<p>The proxy type.
This is usually set to <code>proxy</code> to connect to orcharhino&#160;Proxy.
This parameter also supports a legacy <code>foreman</code> option, where communication goes directly to orcharhino&#160;Server instead of a orcharhino&#160;Proxy.</p>
</dd>
<dt class="hdlist1">proxy.url</dt>
<dd>
<p>The URL of orcharhino&#160;Proxy or orcharhino&#160;Server providing the Discovery service.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Using the <code>discovery-remaster</code> tool to remaster an OS image</div>
<div class="content">
<pre class="nowrap"># discovery-remaster ~/iso/foreman-discovery-image-3.4.4-5.iso \
"fdi.pxip=192.168.140.20/24 fdi.pxgw=192.168.140.1 \
fdi.pxdns=192.168.140.2 proxy.url=https://<em>orcharhino.example.com</em>:9090 \
proxy.type=proxy fdi.pxfactname1=<em>customhostname</em> fdi.pxfactvalue1=<em>myhost</em> fdi.pxmac=52:54:00:be:8e:8c fdi.pxauto=1"</pre>
</div>
</div>
<div class="paragraph">
<p>Copy this media to either a CD, DVD, or a USB stick.
For example, to copy to a USB stick at <code>/dev/sdb</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dd bs=4M \
if=/usr/share/foreman-discovery-image/foreman-discovery-image-3.4.4-5.iso \
of=/dev/sdb</pre>
</div>
</div>
<div class="paragraph">
<p>Insert the Discovery boot media into a bare-metal host, start the host, and boot from the media.</p>
</div>
<div class="paragraph">
<p>For more information about provisioning discovered hosts, see <a href="#Creating_Hosts_from_Discovered_Hosts_provisioning">Creating hosts from discovered hosts</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Extending_the_Discovery_Image_provisioning"><a class="anchor" href="#Extending_the_Discovery_Image_provisioning"></a>7.10. Extending the Discovery image</h3>
<div class="paragraph">
<p>You can extend the orcharhino Discovery image with custom facts, software, or device drivers.
You can also provide a compressed archive file containing extra code for the image to use.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the following directory structure:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">.
├── autostart.d
│   └── 01_zip.sh
├── bin
│   └── ntpdate
├── facts
│   └── test.rb
└── lib
    ├── libcrypto.so.1.0.0
    └── ruby
        └── test.rb</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>autostart.d</code> directory contains scripts that are executed in POSIX order by the image when it starts, but before the host is registered to orcharhino.</p>
</li>
<li>
<p>The <code>bin</code> directory is added to the <code>$PATH</code> variable; you can place binary files in this directory and use them in the <code>autostart</code> scripts.</p>
</li>
<li>
<p>The <code>facts</code> directory is added to the <code>FACTERLIB</code> variable so that custom facts can be configured and sent to orcharhino.</p>
</li>
<li>
<p>The <code>lib</code> directory is added to the <code>LD_LIBRARY_PATH</code> variable and <code>lib/ruby</code> is added to the <code>RUBYLIB</code> variable, so that binary files in <code>/bin</code> can be executed correctly.</p>
</li>
</ul>
</div>
</li>
<li>
<p>After creating the directory structure, create a <code>.zip</code> file archive with the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># zip -r my_extension.zip .</pre>
</div>
</div>
</li>
<li>
<p>To inform the Discovery image of the extensions it must use, place your zip files on your TFTP server with the Discovery image, and then update the <code>APPEND</code> line of the PXELinux template with the <code>fdi.zips</code> option where the paths are relative to the TFTP root.
For example, if you have two archives at <code>$TFTP/zip1.zip</code> and <code>$TFTP/boot/zip2.zip</code>, use the following syntax:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">fdi.zips=zip1.zip,boot/zip2.zip</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can append new directives and options to the existing environment variables (<code>PATH</code>, <code>LD_LIBRARY_PATH</code>, <code>RUBYLIB</code> and <code>FACTERLIB</code>).
If you want to specify the path explicitly in your scripts, the <code>.zip</code> file contents are extracted to the <code>/opt/extension</code> directory on the image.</p>
</div>
<div class="paragraph">
<p>You can create multiple <code>.zip</code> files but be aware that they are extracted to the same location on the Discovery image.
Files extracted from in later <code>.zip</code> files overwrite earlier versions if they have the same file name.</p>
</div>
</div>
<div class="sect2">
<h3 id="Troubleshooting_Discovery_provisioning"><a class="anchor" href="#Troubleshooting_Discovery_provisioning"></a>7.11. Troubleshooting Discovery</h3>
<div class="paragraph">
<p>If a machine is not listed in the orcharhino management UI in <strong>Hosts</strong> &gt; <strong>Discovered Hosts</strong>, inspect the following configuration areas to help isolate the error:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Build PXE Default</strong> to redeploy the default PXELinux template.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Verify the <code>pxelinux.cfg/default</code> configuration file on the TFTP orcharhino&#160;Proxy.</p>
</li>
<li>
<p>Ensure adequate network connectivity between hosts, orcharhino&#160;Proxy, and orcharhino&#160;Server.</p>
</li>
<li>
<p>Check the PXELinux template in use and determine the PXE discovery snippet it includes.
Snippets are named as follows: <code>pxelinux_discovery</code>, <code>pxegrub_discovery</code>, or <code>pxegrub2_discovery</code>.
Verify the <code>proxy.url</code> and <code>proxy.type</code> options in the PXE discovery snippet.</p>
</li>
<li>
<p>Ensure that DNS is working correctly for the discovered nodes, or use an IP address in the <code>proxy.url</code> option in the PXE discovery snippet included in the PXELinux template you are using.</p>
</li>
<li>
<p>Ensure that the DHCP server is delivering IP addresses to the booted image correctly.</p>
</li>
<li>
<p>Ensure the discovered host or virtual machine has at least 1200 MB of memory.
Less memory can lead to various random kernel panic errors because the image is extracted in-memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For gathering important system facts, use the <code>discovery-debug</code> command.
It prints out system logs, network configuration, list of facts, and other information on the standard output.
The typical use case is to redirect this output and copy it with the <code>scp</code> command for further investigation.</p>
</div>
<div class="paragraph">
<p>The first virtual console on the discovered host is reserved for <strong>systemd</strong> logs.
Particularly useful system logs are tagged as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>discover-host</code> — initial facts upload</p>
</li>
<li>
<p><code>foreman-discovery</code> — facts refresh, reboot remote commands</p>
</li>
<li>
<p><code>nm-prepare</code> — boot script which pre-configures NetworkManager</p>
</li>
<li>
<p><code>NetworkManager</code> — networking information</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use TTY2 or higher to log in to a discovered host.
The root account and SSH access are disabled by default, but you can enable SSH and set the root password using the following kernel command-line options in the Default PXELinux template on the APPEND line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">fdi.ssh=1 fdi.rootpw=<em>My_Password</em></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-orcharhino-to-provision-from-a-builder-image"><a class="anchor" href="#configuring-orcharhino-to-provision-from-a-builder-image"></a>8. Configuring orcharhino to provision from a Lorax Composer image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In orcharhino, you can enable integration with Cockpit to perform actions and monitor your hosts.
Using Cockpit, you can access Lorax Composer and build images.
Afterwards, you can use these images to provision hosts.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/3.9/Managing_Hosts/index-orcharhino.html#host-management-and-monitoring-by-using-cockpit">Host management and monitoring by using Cockpit</a> in <em>Managing hosts</em></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="provisioning-from-a-builder-image-on-orcharhino-proxy"><a class="anchor" href="#provisioning-from-a-builder-image-on-orcharhino-proxy"></a>8.1. Provisioning from a Lorax Composer image on orcharhino&#160;Proxy</h3>
<div class="paragraph">
<p>You can upload a Lorax Composer image to orcharhino and use this image to provision hosts by using network boot.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is available for Enterprise Linux hosts only.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you provision from a Lorax Composer image, Anaconda installer partitions disks, downloads and mounts the image, and copies files over to a host.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing TAR image created by using Lorax Composer in Cockpit.
Ensure that your blueprint to build the image includes the <a href="#packages-required-in-a-builder-image">required packages</a>.</p>
</li>
<li>
<p>If you want to use orcharhino&#160;Proxy URL, then the referenced lifecycle environment, such as Library, must be synchronized to that orcharhino&#160;Proxy.
For more information, see <a href="https://docs.theforeman.org/3.9/Installing_Proxy/index-orcharhino.html#Adding_Lifecycle_Environments_orcharhino-proxy">Adding lifecycle environments to orcharhino&#160;Proxies</a> in <em>Installing orcharhino&#160;Proxy</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino, create a custom product, add a custom file type repository to this product, and upload the image to the repository.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Importing_Individual_ISO_Images_and_Files_content-management">Importing individual ISO images and files</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>.</p>
</li>
<li>
<p>Select the host group that you want to use.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab, and then click <strong>Add Parameter</strong>.</p>
</li>
<li>
<p>Create a parameter named <code>kickstart_liveimg</code> with type <strong>string</strong> and set the value to the full URL of the image location or the file name of the image inside a published content view, for example:</p>
<div class="ulist">
<ul>
<li>
<p>Full URL: <code>https://<em>orcharhino-proxy.example.com</em>/pulp/content/<em>My_Organization_Label</em>/Library/custom/<em>My_Product_Label</em>/<em>My_Repository_Label</em>/<em>My_Image_Name</em>.tar</code></p>
</li>
<li>
<p>Image file name: <code><em>My_Image_Name</em>.tar</code></p>
<div class="paragraph">
<p>You can use the image file name only if the host is subscribed to a single content view and lifecycle environment, and the <code>kt_activation_keys</code> parameter is defined for the host.
The content view must be published.</p>
</div>
<div class="paragraph">
<p>If a content source is assigned to the host, orcharhino will use the content source orcharhino&#160;Proxy of the host.
If a content source is not assigned, orcharhino will use orcharhino&#160;Server.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="provisioning-from-a-builder-image-on-an-http-server"><a class="anchor" href="#provisioning-from-a-builder-image-on-an-http-server"></a>8.2. Provisioning from a Lorax Composer image on an HTTP server</h3>
<div class="paragraph">
<p>You can upload a Lorax Composer image to an HTTP server and use this image to provision hosts by using network boot.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is available for Enterprise Linux hosts only.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you provision from a Lorax Composer image, Anaconda installer partitions disks, downloads and mounts the image, and copies files over to a host.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing TAR image created by using Lorax Composer in Cockpit.
Ensure that your blueprint to build the image includes the <a href="#packages-required-in-a-builder-image">required packages</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the image to an existing HTTP server that your hosts can reach.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>.</p>
</li>
<li>
<p>Select the host group that you want to use.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab, and then click <strong>Add Parameter</strong>.</p>
</li>
<li>
<p>Create a parameter named <code>kickstart_liveimg</code> with type <strong>string</strong> and set the value to the URL of the image location, such as <code>https://<em>webserver.example.com</em>/<em>path</em>/<em>My_Image_Name</em>.tar</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="packages-required-in-a-builder-image"><a class="anchor" href="#packages-required-in-a-builder-image"></a>8.3. Packages required in a Lorax Composer image</h3>
<div class="paragraph">
<p>For the use in orcharhino, the Lorax Composer image must contain the following minimum of packages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NetworkManager</code></p>
</li>
<li>
<p><code>authselect</code></p>
</li>
<li>
<p><code>chrony</code></p>
</li>
<li>
<p><code>dnf</code></p>
</li>
<li>
<p><code>dracut</code></p>
</li>
<li>
<p><code>efibootmgr</code></p>
</li>
<li>
<p><code>firewalld</code></p>
</li>
<li>
<p><code>grub2</code></p>
</li>
<li>
<p><code>grub2-efi</code></p>
</li>
<li>
<p><code>grub2-tools-extra</code></p>
</li>
<li>
<p><code>insights-client</code> &#8211; required only if you plan to use Insights reporting</p>
</li>
<li>
<p><code>iproute</code></p>
</li>
<li>
<p><code>iputils</code></p>
</li>
<li>
<p><code>kernel</code></p>
</li>
<li>
<p><code>kernel-core</code></p>
</li>
<li>
<p><code>lvm2</code></p>
</li>
<li>
<p><code>subscription-manager</code></p>
</li>
<li>
<p><code>wget</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_on_KVM_kvm-provisioning"><a class="anchor" href="#Provisioning_Virtual_Machines_on_KVM_kvm-provisioning"></a>9. Provisioning virtual machines on KVM (libvirt)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kernel-based Virtual Machines (KVMs) use an open source virtualization daemon and API called <code>libvirt</code> running on Red&#160;Hat Enterprise Linux.
orcharhino can connect to the <code>libvirt</code> API on a KVM server, provision hosts on the hypervisor, and control certain virtualization functions.</p>
</div>
<div class="paragraph">
<p>Only Virtual Machines created through orcharhino can be managed.
Virtual Machines with other than directory storage pool types are unsupported.</p>
</div>
<div class="paragraph">
<p>You can use KVM provisioning to create hosts over a network connection or from an existing image.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Provide an activation key for host registration.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Creating_an_Activation_Key_content-management">Creating An Activation Key</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>A orcharhino&#160;Proxy managing a network on the KVM server.
Ensure no other DHCP services run on this network to avoid conflicts with orcharhino&#160;Proxy.
For more information about network service configuration for orcharhino&#160;Proxies, see <a href="https://docs.theforeman.org/3.9/Provisioning_Hosts/index-orcharhino.html#Configuring_Networking_provisioning">Configuring Networking</a> in <em>Provisioning hosts</em>.</p>
</li>
<li>
<p>A server running KVM virtualization tools (libvirt daemon).</p>
</li>
<li>
<p>A virtual network running on the libvirt server.
Only NAT and isolated virtual networks can be managed through orcharhino.</p>
</li>
<li>
<p>An existing virtual machine image if you want to use image-based provisioning.
Ensure that this image exists in a storage pool on the KVM host.
The <code>default</code> storage pool is usually located in <code>/var/lib/libvirt/images</code>.
Only directory pool storage types can be managed through orcharhino.</p>
</li>
<li>
<p>Optional: The examples in these procedures use the root user for KVM.
If you want to use a non-root user on the KVM server, you must add the user to the <code>libvirt</code> group on the KVM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># usermod -a -G libvirt <em>non_root_user</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For a list of permissions a non-admin user requires to provision hosts, see <a href="#permissions-required-to-provision-hosts_provisioning">Permissions required to provision hosts</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="configuring-server-for-kvm-connections_kvm-provisioning"><a class="anchor" href="#configuring-server-for-kvm-connections_kvm-provisioning"></a>9.1. Configuring orcharhino&#160;Server for KVM connections</h3>
<div class="paragraph">
<p>Before adding the KVM connection, create an SSH key pair for the <code>foreman</code> user to ensure a secure connection between orcharhino&#160;Server and KVM.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino&#160;Server, switch to the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre># su foreman -s /bin/bash</pre>
</div>
</div>
</li>
<li>
<p>Generate the key pair:</p>
<div class="listingblock">
<div class="content">
<pre>$ ssh-keygen</pre>
</div>
</div>
</li>
<li>
<p>Copy the public key to the KVM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ssh-copy-id <em>root@kvm.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>Exit the bash shell for the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre>$ exit</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>libvirt-client</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install libvirt-client</pre>
</div>
</div>
</li>
<li>
<p>Use the following command to test the connection to the KVM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su foreman -s /bin/bash -c 'virsh -c qemu+ssh://root@kvm.example.com/system list'</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-kvm-connection_kvm-provisioning"><a class="anchor" href="#adding-kvm-connection_kvm-provisioning"></a>9.2. Adding a KVM connection to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>Use this procedure to add KVM as a compute resource in orcharhino.
To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-kvm-connection_kvm-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the new compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>Libvirt</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the connection URL to the KVM server.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> qemu+ssh://<em>root@kvm.example.com</em>/system</pre>
</div>
</div>
</li>
<li>
<p>From the <strong>Display type</strong> list, select either <strong>VNC</strong> or <strong>Spice</strong>.</p>
</li>
<li>
<p>Optional: To secure console access for new hosts with a randomly generated password, select the <strong>Set a randomly generated password on the display connection</strong> checkbox.
You can retrieve the password for the VNC console to access the guest virtual machine console from the output of the following command executed on the KVM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># virsh edit <em>your_VM_name</em>
&lt;graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0' passwd='<em>your_randomly_generated_password</em>'&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The password is randomly generated every time the console for the virtual machine is opened, for example, with virt-manager.</p>
</div>
</li>
<li>
<p>Click <strong>Test Connection</strong> to ensure that orcharhino&#160;Server connects to the KVM server without fault.</p>
</li>
<li>
<p>Verify that the <strong>Locations</strong> and <strong>Organizations</strong> tabs are automatically set to your current context.
If you want, add additional contexts to these tabs.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the KVM connection.</p>
</li>
</ol>
</div>
<div id="cli-adding-kvm-connection_kvm-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a compute resource, enter the <code>hammer compute-resource create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create --name "<em>My_KVM_Server</em>" \
--provider "Libvirt" --description "KVM server at <em>kvm.example.com</em>" \
--url "qemu+ssh://root@<em>kvm.example.com/system</em>" --locations "New York" \
--organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-images-to-server_kvm-provisioning"><a class="anchor" href="#adding-images-to-server_kvm-provisioning"></a>9.3. Adding KVM images to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>To create hosts using image-based provisioning, you must add information about the image, such as access details and the image location, to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>Note that you can manage only directory pool storage types through orcharhino.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-images-to-server_kvm-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click the name of the KVM connection.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>In the <strong>Image path</strong> field, enter the full path that points to the image on the KVM server.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> /var/lib/libvirt/images/TestImage.qcow2</pre>
</div>
</div>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the image supports user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-images-to-server_kvm-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Use the <code>--uuid</code> field to store the full path of the image location on the KVM server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create \
--name "<em>KVM Image</em>" \
--compute-resource "<em>My_KVM_Server</em>"
--operatingsystem "RedHat <em>version</em>" \
--architecture "x86_64" \
--username root \
--user-data false \
--uuid "/var/lib/libvirt/images/<em>KVMimage</em>.qcow2" \</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-kvm-details-to-a-compute-profile_kvm-provisioning"><a class="anchor" href="#adding-kvm-details-to-a-compute-profile_kvm-provisioning"></a>9.4. Adding KVM details to a compute profile</h3>
<div class="paragraph">
<p>Use this procedure to add KVM hardware settings to a compute profile.
When you create a host on KVM using this compute profile, these settings are automatically populated.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-kvm-details-to-a-compute-profile_kvm-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>In the Compute Profiles window, click the name of an existing compute profile, or click <strong>Create Compute Profile</strong>, enter a <strong>Name</strong>, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the KVM compute resource.</p>
</li>
<li>
<p>In the <strong>CPUs</strong> field, enter the number of CPUs to allocate to the new host.</p>
</li>
<li>
<p>In the <strong>Memory</strong> field, enter the amount of memory to allocate to the new host.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use if performing image-based provisioning.</p>
</li>
<li>
<p>From the <strong>Network Interfaces</strong> list, select the network parameters for the host&#8217;s network interface.
You can create multiple network interfaces.
However, at least one interface must point to a orcharhino&#160;Proxy-managed network.</p>
</li>
<li>
<p>In the <strong>Storage</strong> area, enter the storage parameters for the host.
You can create multiple volumes for the host.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the settings to the compute profile.</p>
</li>
</ol>
</div>
<div id="cli-adding-kvm-details-to-a-compute-profile_kvm-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>To create a compute profile, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile create --name "Libvirt CP"</pre>
</div>
</div>
</li>
<li>
<p>To add the values for the compute profile, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile values create --compute-profile "Libvirt CP" \
--compute-resource "<em>My_KVM_Server</em>" \
--interface "compute_type=network,compute_model=virtio,compute_network=<em>examplenetwork</em>" \
--volume "pool_name=default,capacity=20G,format_type=qcow2" \
--compute-attributes "cpus=1,memory=1073741824"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-network-or-image-based-hosts_kvm-provisioning"><a class="anchor" href="#creating-network-or-image-based-hosts_kvm-provisioning"></a>9.5. Creating hosts on KVM</h3>
<div class="paragraph">
<p>In orcharhino, you can use KVM provisioning to create hosts over a network connection or from an existing image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you want to create a host over a network connection, the new host must be able to access either orcharhino&#160;Server&#8217;s integrated orcharhino&#160;Proxy or an external orcharhino&#160;Proxy on a KVM virtual network, so that the host has access to PXE provisioning services.
This new host entry triggers the KVM server to create and start a virtual machine.
If the virtual machine detects the defined orcharhino&#160;Proxy through the virtual network, the virtual machine boots to PXE and begins to install the chosen operating system.</p>
</li>
<li>
<p>If you want to create a host with an existing image, the new host entry triggers the KVM server to create the virtual machine using a pre-existing image as a basis for the new volume.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-network-or-image-based-hosts_kvm-provisioning">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<div class="title">DHCP conflicts</div>
<p>For network-based provisioning, if you use a virtual network on the KVM server for provisioning, select a network that does not provide DHCP assignments.
This causes DHCP conflicts with orcharhino&#160;Server when booting new hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the KVM connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine settings.
The KVM-specific fields are populated with settings from your compute profile.
Modify these settings if required.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
KVM assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>Select the <strong>Provisioning Method</strong> that you want to use:</p>
<div class="ulist">
<ul>
<li>
<p>For network-based provisioning, click <strong>Network Based</strong>.</p>
</li>
<li>
<p>For image-based provisioning, click <strong>Image Based</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div id="cli-creating-network-or-image-based-hosts_kvm-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To use network-based provisioning, create the host with the <code>hammer host create</code> command and include <code>--provision-method build</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--build true \
--compute-attributes="cpus=1,memory=1073741824" \
--compute-resource "<em>My_KVM_Server</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--interface "managed=true,primary=true,provision=true,compute_type=network,compute_network=<em>examplenetwork</em>" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>" \
--provision-method "build" \
--root-password "<em>My_Password</em>" \
--volume="pool_name=default,capacity=20G,format_type=qcow2"</pre>
</div>
</div>
</li>
<li>
<p>To use image-based provisioning, create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--compute-attributes="cpus=1,memory=1073741824" \
--compute-resource "<em>My_KVM_Server</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--image "<em>My_KVM_Image</em>" \
--interface "managed=true,primary=true,provision=true,compute_type=network,compute_network=examplenetwork" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>" \
--provision-method "image" \
--volume="pool_name=default,capacity=20G,format_type=qcow2"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_on_oVirt_rhv-provisioning"><a class="anchor" href="#Provisioning_Virtual_Machines_on_oVirt_rhv-provisioning"></a>10. Provisioning virtual machines on oVirt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>oVirt is an enterprise-grade server and desktop virtualization platform.
In orcharhino, you can manage virtualization functions through oVirt&#8217;s REST API.
This includes creating virtual machines and controlling their power states.</p>
</div>
<div class="paragraph">
<p>You can use oVirt provisioning to create virtual machines over a network connection or from an existing image.</p>
</div>
<div class="paragraph">
<p>You can use <code>cloud-init</code> to configure the virtual machines that you provision.
Using <code>cloud-init</code> avoids any special configuration on the network, such as a managed DHCP and TFTP, to finish the installation of the virtual machine.
This method does not require orcharhino to connect to the provisioned virtual machine using SSH to run the finish script.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Provide an activation key for host registration.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Creating_an_Activation_Key_content-management">Creating An Activation Key</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>A orcharhino&#160;Proxy managing a logical network on the oVirt environment.
Ensure no other DHCP services run on this network to avoid conflicts with orcharhino&#160;Proxy.
For more information, see <a href="https://docs.theforeman.org/3.9/Provisioning_Hosts/index-orcharhino.html#Configuring_Networking_provisioning">Configuring Networking</a> in <em>Provisioning hosts</em>.</p>
</li>
<li>
<p>An existing template, other than the <code>blank</code> template, if you want to use image-based provisioning.
For more information about creating templates for virtual machines, see
<a href="https://www.ovirt.org/documentation/virtual_machine_management_guide/#chap-Templates">Templates</a> in the oVirt documentation.</p>
</li>
<li>
<p>An administration-like user on oVirt for communication with orcharhino&#160;Server.
Do not use the <code>admin@internal</code> user for this communication.
Instead, create a new oVirt user with the following permissions:</p>
<div class="ulist">
<ul>
<li>
<p><strong>System</strong> &gt; <strong>Configure System</strong> &gt; <strong>Login Permissions</strong></p>
</li>
<li>
<p><strong>Network</strong> &gt; <strong>Configure vNIC Profile</strong> &gt; <strong>Create</strong></p>
</li>
<li>
<p><strong>Network</strong> &gt; <strong>Configure vNIC Profile</strong> &gt; <strong>Edit Properties</strong></p>
</li>
<li>
<p><strong>Network</strong> &gt; <strong>Configure vNIC Profile</strong> &gt; <strong>Delete</strong></p>
</li>
<li>
<p><strong>Network</strong> &gt; <strong>Configure vNIC Profile</strong> &gt; <strong>Assign vNIC Profile to VM</strong></p>
</li>
<li>
<p><strong>Network</strong> &gt; <strong>Configure vNIC Profile</strong> &gt; <strong>Assign vNIC Profile to Template</strong></p>
</li>
<li>
<p><strong>Template</strong> &gt; <strong>Provisioning Operations</strong> &gt; <strong>Import/Export</strong></p>
</li>
<li>
<p><strong>VM</strong> &gt; <strong>Provisioning Operations</strong> &gt; <strong>Create</strong></p>
</li>
<li>
<p><strong>VM</strong> &gt; <strong>Provisioning Operations</strong> &gt; <strong>Delete</strong></p>
</li>
<li>
<p><strong>VM</strong> &gt; <strong>Provisioning Operations</strong> &gt; <strong>Import/Export</strong></p>
</li>
<li>
<p><strong>VM</strong> &gt; <strong>Provisioning Operations</strong> &gt; <strong>Edit Storage</strong></p>
</li>
<li>
<p><strong>Disk</strong> &gt; <strong>Provisioning Operations</strong> &gt; <strong>Create</strong></p>
</li>
<li>
<p><strong>Disk</strong> &gt; <strong>Disk Profile</strong> &gt; <strong>Attach Disk Profile</strong></p>
<div class="paragraph">
<p>For more information about how to create a user and add permissions in oVirt, see <a href="https://www.ovirt.org/documentation/administration_guide/#chap-Users_and_Roles">Users and Roles</a> in the oVirt documentation.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="installing-the-oVirt-plugin_rhv-provisioning"><a class="anchor" href="#installing-the-oVirt-plugin_rhv-provisioning"></a>10.1. Installing the oVirt plugin</h3>
<div class="paragraph">
<p>Install the oVirt plugin to attach an oVirt compute resource provider to orcharhino.
This allows you to manage and deploy hosts to oVirt.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Install the oVirt compute resource provider on your orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-compute-ovirt</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Optional: In the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong> and select the <strong>Compute resources</strong> tab to verify the installation of the oVirt plugin.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-rhv-connection_rhv-provisioning"><a class="anchor" href="#adding-rhv-connection_rhv-provisioning"></a>10.2. Adding the oVirt connection to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>Use this procedure to add oVirt as a compute resource in orcharhino.
To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-rhv-connection_rhv-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the new compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>oVirt</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the connection URL for the oVirt Engine&#8217;s API in the following form: <code>https://ovirt.example.com/ovirt-engine/api/v4</code>.</p>
</li>
<li>
<p>In the <strong>User</strong> field, enter the name of a user with permissions to access oVirt Engine&#8217;s resources.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the password of the user.</p>
</li>
<li>
<p>Click <strong>Load Datacenters</strong> to populate the <strong>Datacenter</strong> list with data centers from your oVirt environment.</p>
</li>
<li>
<p>From the <strong>Datacenter</strong> list, select a data center.</p>
</li>
<li>
<p>From the <strong>Quota ID</strong> list, select a quota to limit resources available to orcharhino.</p>
</li>
<li>
<p>In the <strong>X509 Certification Authorities</strong> field, enter the certificate authority for SSL/TLS access.
Alternatively, if you leave the field blank, a self-signed certificate is generated on the first API request by the server.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and select the location you want to use.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and select the organization you want to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute resource.</p>
</li>
</ol>
</div>
<div id="cli-adding-rhv-connection_rhv-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the <code>hammer compute-resource create</code> command with <code>Ovirt</code> for <code>--provider</code> and the name of the data center you want to use for <code>--datacenter</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create \
--name "<em>My_oVirt</em>" --provider "Ovirt" \
--description "oVirt server at <em>ovirt.example.com</em>" \
--url "<em>https://ovirt.example.com/ovirt-engine/api/v4</em>" \
--user "<em>orcharhino_User</em>" --password "<em>My_Password</em>" \
--locations "New York" --organizations "<em>My_Organization</em>" \
--datacenter "<em>My_Datacenter</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="preparing-cloud-init-images-in-rhv_rhv-provisioning"><a class="anchor" href="#preparing-cloud-init-images-in-rhv_rhv-provisioning"></a>10.3. Preparing cloud-init images in oVirt</h3>
<div class="paragraph">
<p>To use <code>cloud-init</code> during provisioning, you must prepare an image with <code>cloud-init</code> installed in oVirt, and then import the image to orcharhino to use for provisioning.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In oVirt, create a virtual machine to use for image-based provisioning in orcharhino.</p>
</li>
<li>
<p>On the virtual machine, install <code>cloud-init</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install cloud-init</pre>
</div>
</div>
</li>
<li>
<p>To the <code>/etc/cloud/cloud.cfg</code> file, add the following information:</p>
<div class="listingblock">
<div class="content">
<pre>datasource_list: ["NoCloud", "ConfigDrive"]</pre>
</div>
</div>
</li>
<li>
<p>In oVirt, create an image from this virtual machine.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you add this image to orcharhino, ensure that you select the <strong>User Data</strong> checkbox.</p>
</div>
</div>
<div class="sect2">
<h3 id="adding-images-to-server_rhv-provisioning"><a class="anchor" href="#adding-images-to-server_rhv-provisioning"></a>10.4. Adding oVirt images to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>To create hosts using image-based provisioning, you must add information about the image, such as access details and the image location, to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-images-to-server_rhv-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click the name of the oVirt connection.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select an image from the oVirt compute resource.</p>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the image supports user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-images-to-server_rhv-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Use the <code>--uuid</code> option to store the template UUID on the oVirt server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create \
--name "<em>oVirt_Image</em>" \
--compute-resource "<em>My_oVirt</em>"
--operatingsystem "RedHat <em>version</em>" \
--architecture "x86_64" \
--username root \
--uuid "9788910c-4030-4ae0-bad7-603375dd72b1" \</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="preparing-a-cloud-init-template_rhv-provisioning"><a class="anchor" href="#preparing-a-cloud-init-template_rhv-provisioning"></a>10.5. Preparing a cloud-init template</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>, and click <strong>Create Template</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the template.</p>
</li>
<li>
<p>In the <strong>Editor</strong> field, enter the following template details:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%#
kind: user_data
name: Cloud-init
-%&gt;
#cloud-config
hostname: &lt;%= @host.shortname %&gt;

&lt;%# Allow user to specify additional SSH key as host parameter -%&gt;
&lt;% if @host.params['sshkey'].present? || @host.params['remote_execution_ssh_keys'].present? -%&gt;
ssh_authorized_keys:
&lt;% if @host.params['sshkey'].present? -%&gt;
  - &lt;%= @host.params['sshkey'] %&gt;
&lt;% end -%&gt;
&lt;% if @host.params['remote_execution_ssh_keys'].present? -%&gt;
&lt;% @host.params['remote_execution_ssh_keys'].each do |key| -%&gt;
  - &lt;%= key %&gt;
&lt;% end -%&gt;
&lt;% end -%&gt;
&lt;% end -%&gt;
runcmd:
  - |
    #!/bin/bash
&lt;%= indent 4 do
    snippet 'subscription_manager_registration'
end %&gt;
&lt;% if @host.info['parameters']['realm'] &amp;&amp; @host.realm &amp;&amp; @host.realm.realm_type == 'Red Hat Identity Management' -%&gt;
  &lt;%= indent 4 do
    snippet 'freeipa_register'
  end %&gt;
&lt;% end -%&gt;
&lt;% unless @host.operatingsystem.atomic? -%&gt;
    # update all the base packages from the updates repository
    yum -t -y -e 0 update
&lt;% end -%&gt;
&lt;%
    # safemode renderer does not support unary negation
    non_atomic = @host.operatingsystem.atomic? ? false : true
    pm_set = @host.puppetmaster.empty? ? false : true
    puppet_enabled = non_atomic &amp;&amp; (pm_set || @host.params['force-puppet'])
%&gt;
&lt;% if puppet_enabled %&gt;
    yum install -y puppet
    cat &gt; /etc/puppet/puppet.conf &lt;&lt; EOF
  &lt;%= indent 4 do
    snippet 'puppet.conf'
  end %&gt;
    EOF
    # Setup puppet to run on system reboot
    /sbin/chkconfig --level 345 puppet on

    /usr/bin/puppet agent --config /etc/puppet/puppet.conf --onetime --tags no_such_tag &lt;%= @host.puppetmaster.blank? ? '' : "--server #{@host.puppetmaster}" %&gt; --no-daemonize
    /sbin/service puppet start
&lt;% end -%&gt;
phone_home:
 url: &lt;%= foreman_url('built') %&gt;
 post: []
 tries: 10pp</pre>
</div>
</div>
</li>
<li>
<p>Click the <strong>Type</strong> tab and from the <strong>Type</strong> list, select <strong>User data template</strong>.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab, and from the <strong>Applicable Operating Systems</strong> list, select the operating system that you want associate with the template.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and from the <strong>Locations</strong> list, select the location that you want to associate with the template.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and from the <strong>Organization</strong> list, select the organization that you want to associate with the template.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Select the operating system you want to associate with the template.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab, and from the <strong>User data template</strong> list, select the name of the new template.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-rhv-details-to-a-compute-profile_rhv-provisioning"><a class="anchor" href="#adding-rhv-details-to-a-compute-profile_rhv-provisioning"></a>10.6. Adding oVirt details to a compute profile</h3>
<div class="paragraph">
<p>Use this procedure to add oVirt hardware settings to a compute profile.
When you create a host on KVM using this compute profile, these settings are automatically populated.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-rhv-details-to-a-compute-profile_rhv-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>In the Compute Profiles window, click the name of an existing compute profile, or click <strong>Create Compute Profile</strong>, enter a <strong>Name</strong>, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the oVirt compute resource.</p>
</li>
<li>
<p>From the <strong>Cluster</strong> list, select the target host cluster in the oVirt environment.</p>
</li>
<li>
<p>From the <strong>Template</strong> list, select the oVirt template to use for the <strong>Cores</strong> and <strong>Memory</strong> settings.</p>
</li>
<li>
<p>In the <strong>Cores</strong> field, enter the number of CPU cores to allocate to the new host.</p>
</li>
<li>
<p>In the <strong>Memory</strong> field, enter the amount of memory to allocate to the new host.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select image to use for image-based provisioning.</p>
</li>
<li>
<p>In the <strong>Network Interfaces</strong> area, enter the network parameters for the host&#8217;s network interface.
You can create multiple network interfaces.
However, at least one interface must point to a orcharhino&#160;Proxy-managed network.
For each network interface, enter the following details:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter the name of the network interface.</p>
</li>
<li>
<p>From the <strong>Network</strong> list, select The logical network that you want to use.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the <strong>Storage</strong> area, enter the storage parameters for the host.
You can create multiple volumes for the host.
For each volume, enter the following details:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Size (GB)</strong> enter the size, in GB, for the new volume.</p>
</li>
<li>
<p>From the <strong>Storage domain</strong> list, select the storage domain for the volume.</p>
</li>
<li>
<p>From the <strong>Preallocate disk</strong>, select either thin provisioning or preallocation of the full disk.</p>
</li>
<li>
<p>From the <strong>Bootable</strong> list, select whether you want a bootable or non-bootable volume.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div id="cli-adding-rhv-details-to-a-compute-profile_rhv-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>To create a compute profile, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile create --name "oVirt CP"</pre>
</div>
</div>
</li>
<li>
<p>To set the values for the compute profile, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile values create --compute-profile "oVirt CP" \
--compute-resource "<em>My_oVirt</em>" \
--interface "compute_interface=<em>Interface_Type</em>,compute_name=eth0,compute_network=satnetwork" \
--volume "size_gb=20G,storage_domain=Data,bootable=true" \
--compute-attributes "cluster=Default,cores=1,memory=1073741824,start=true""</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-network-or-image-based-hosts_rhv-provisioning"><a class="anchor" href="#creating-network-or-image-based-hosts_rhv-provisioning"></a>10.7. Creating hosts on oVirt</h3>
<div class="paragraph">
<p>In orcharhino, you can use oVirt provisioning to create hosts over a network connection or from an existing image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you want to create a host over a network connection, the new host must be able to access either orcharhino&#160;Server&#8217;s integrated orcharhino&#160;Proxy or an external orcharhino&#160;Proxy on a oVirt virtual network, so that the host has access to PXE provisioning services.
This new host entry triggers the oVirt server to create and start a virtual machine.
If the virtual machine detects the defined orcharhino&#160;Proxy through the virtual network, the virtual machine boots to PXE and begins to install the chosen operating system.</p>
</li>
<li>
<p>If you want to create a host with an existing image, the new host entry triggers the oVirt server to create the virtual machine using a pre-existing image as a basis for the new volume.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-network-or-image-based-hosts_rhv-provisioning">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<div class="title">DHCP conflicts</div>
<p>For network-based provisioning, if you use a virtual network on the oVirt server for provisioning, select a network that does not provide DHCP assignments.
This causes DHCP conflicts with orcharhino&#160;Server when booting new hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the oVirt connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine settings.
The oVirt-specific fields are populated with settings from your compute profile.
Modify these settings if required.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
oVirt assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>Select the <strong>Provisioning Method</strong> that you want to use:</p>
<div class="ulist">
<ul>
<li>
<p>For network-based provisioning, click <strong>Network Based</strong>.</p>
</li>
<li>
<p>For image-based provisioning, click <strong>Image Based</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div id="cli-creating-network-or-image-based-hosts_rhv-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To use network-based provisioning, create the host with the <code>hammer host create</code> command and include <code>--provision-method build</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--build true \
--compute-attributes="cluster=Default,cores=1,memory=1073741824,start=true" \
--compute-resource "<em>My</em>oVirt_" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--interface "managed=true,primary=true,provision=true,compute_name=eth0,compute_network=satnetwork" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>" \
--provision-method build \
--volume="size_gb=20G,storage_domain=Data,bootable=true"</pre>
</div>
</div>
</li>
<li>
<p>To use image-based provisioning, create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--compute-attributes="cluster=Default,cores=1,memory=1073741824,start=true" \
--compute-resource "<em>My</em>oVirt_" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--image "<em>My</em>oVirt_Image_" \
--interface "managed=true,primary=true,provision=true,compute_name=eth0,compute_network=satnetwork" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>" \
--provision-method "image" \
--volume="size_gb=20G,storage_domain=Data,bootable=true"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_in_VMware_vmware-provisioning"><a class="anchor" href="#Provisioning_Virtual_Machines_in_VMware_vmware-provisioning"></a>11. Provisioning virtual machines in VMware vSphere</h2>
<div class="sectionbody">
<div class="paragraph">
<p>VMware vSphere is an enterprise-level virtualization platform from VMware.
orcharhino can interact with the vSphere platform, including creating new virtual machines and controlling their power management states.</p>
</div>
<div class="sect2">
<h3 id="Installing_VMware_plugin_vmware-provisioning"><a class="anchor" href="#Installing_VMware_plugin_vmware-provisioning"></a>11.1. Installing VMware plugin</h3>
<div class="paragraph">
<p>Install the VMware plugin to attach the VMware compute resource provider to orcharhino.
You can use the VMware provider to manage and deploy hosts to VMware.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the VMware compute resource provider on your orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-compute-vmware</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong>.</p>
</li>
<li>
<p>On the <strong>System Status</strong> card, select the <strong>Available Providers</strong> tab to verify that the VMware provider is installed.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Prerequisites_for_VMware_Provisioning_vmware-provisioning"><a class="anchor" href="#Prerequisites_for_VMware_Provisioning_vmware-provisioning"></a>11.2. Prerequisites for VMware provisioning</h3>
<div class="paragraph">
<p>The requirements for VMware vSphere provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A supported version of VMware vCenter Server.
The following versions have been fully tested with orcharhino:</p>
<div class="ulist">
<ul>
<li>
<p>vCenter Server 8.0</p>
</li>
<li>
<p>vCenter Server 7.0</p>
</li>
<li>
<p>vCenter Server 6.7 (EOL)</p>
</li>
<li>
<p>vCenter Server 6.5 (EOL)</p>
</li>
</ul>
</div>
</li>
<li>
<p>A orcharhino&#160;Proxy managing a network on the vSphere environment.
Ensure no other DHCP services run on this network to avoid conflicts with orcharhino&#160;Proxy.
For more information, see <a href="#Configuring_Networking_provisioning">Configuring networking</a>.</p>
</li>
<li>
<p>An existing VMware template if you want to use image-based provisioning.</p>
</li>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Provide an activation key for host registration.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Creating_an_Activation_Key_content-management">Creating An Activation Key</a> in <em>Managing content</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Creating_a_VMware_User_vmware-provisioning"><a class="anchor" href="#Creating_a_VMware_User_vmware-provisioning"></a>11.3. Creating a VMware user</h3>
<div class="paragraph">
<p>The VMware vSphere server requires an administration-like user for orcharhino&#160;Server communication.
For security reasons, do not use the <code>administrator</code> user for such communication.
Instead, create a user with the following permissions:</p>
</div>
<div class="paragraph">
<p>For VMware vCenter Server version 6.7, set the following permissions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All Privileges &#8594; Datastore &#8594; Allocate Space, Browse datastore, Update Virtual Machine files, Low level file operations</p>
</li>
<li>
<p>All Privileges &#8594; Network &#8594; Assign Network</p>
</li>
<li>
<p>All Privileges &#8594; Resource &#8594; Assign virtual machine to resource pool</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Change Config (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Interaction (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Edit Inventory (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Provisioning (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Guest Operations (All)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the same steps also apply to VMware vCenter Server version 7.0.</p>
</div>
<div class="paragraph">
<p>For VMware vCenter Server version 6.5, set the following permissions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All Privileges &#8594; Datastore &#8594; Allocate Space, Browse datastore, Update Virtual Machine files, Low level file operations</p>
</li>
<li>
<p>All Privileges &#8594; Network &#8594; Assign Network</p>
</li>
<li>
<p>All Privileges &#8594; Resource &#8594; Assign virtual machine to resource pool</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Configuration (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Interaction (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Inventory (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Provisioning (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Guest Operations (All)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_VMware_Connection_to_Server_vmware-provisioning"><a class="anchor" href="#Adding_a_VMware_Connection_to_Server_vmware-provisioning"></a>11.4. Adding a VMware connection to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>Use this procedure to add a VMware vSphere connection in orcharhino&#160;Server&#8217;s compute resources.
To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-vmware-vsphere-connection_vmware-provisioning">CLI procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the host and network-based firewalls are configured to allow communication from orcharhino&#160;Server to vCenter on TCP port 443.</p>
</li>
<li>
<p>Verify that orcharhino&#160;Server and vCenter can resolve each other&#8217;s host names.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>, and in the Compute Resources window, click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>VMware</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the resource.</p>
</li>
<li>
<p>In the <strong>VCenter/Server</strong> field, enter the IP address or host name of the vCenter server.</p>
</li>
<li>
<p>In the <strong>User</strong> field, enter the user name with permission to access the vCenter&#8217;s resources.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the password for the user.</p>
</li>
<li>
<p>Click <strong>Load Datacenters</strong> to populate the list of data centers from your VMware vSphere environment.</p>
</li>
<li>
<p>From the <strong>Datacenter</strong> list, select a specific data center to manage from this list.</p>
</li>
<li>
<p>In the <strong>Fingerprint</strong> field, ensure that this field is populated with the fingerprint from the data center.</p>
</li>
<li>
<p>From the <strong>Display Type</strong> list, select a console type, for example, <strong>VNC</strong> or <strong>VMRC</strong>.
Note that VNC consoles are unsupported on VMware ESXi 6.5 and later.</p>
</li>
<li>
<p>Optional: In the <strong>VNC Console Passwords</strong> field, select the <strong>Set a randomly generated password on the display connection</strong> checkbox to secure console access for new hosts with a randomly generated password.</p>
</li>
<li>
<p>From the <strong>Enable Caching</strong> list, you can select whether to enable caching of compute resources.
For more information, see <a href="#Caching_of_Compute_Resources_vmware-provisioning">Caching of compute resources</a>.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> and <strong>Organizations</strong> tabs and verify that the values are automatically set to your current context.
You can also add additional contexts.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the connection.</p>
</li>
</ol>
</div>
<div id="cli-adding-vmware-vsphere-connection_vmware-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the connection with the <code>hammer compute-resource create</code> command.
Select <code>Vmware</code> as the <code>--provider</code> and set the instance UUID of the data center as the <code>--uuid</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create \
--datacenter "<em>My_Datacenter</em>" \
--description "vSphere server at <em>vsphere.example.com</em>" \
--locations "<em>My_Location</em>" \
--name "My_vSphere" \
--organizations "<em>My_Organization</em>" \
--password "<em>My_Password</em>" \
--provider "Vmware" \
--server "<em>vsphere.example.com</em>" \
--user "<em>My_User</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_VMware_Images_to_Server_vmware-provisioning"><a class="anchor" href="#Adding_VMware_Images_to_Server_vmware-provisioning"></a>11.5. Adding VMware images to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>VMware vSphere uses templates as images for creating new virtual machines.
If using image-based provisioning to create new hosts, you need to add VMware template details to your orcharhino&#160;Server.
This includes access details and the template name.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-vmware-vsphere-images-to-server_vmware-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your VMware compute resource.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
By default, this is set to <code>root</code>.</p>
</li>
<li>
<p>If your image supports user data input such as <code>cloud-init</code> data, click the <strong>User data</strong> checkbox.</p>
</li>
<li>
<p>Optional: In the <strong>Password</strong> field, enter the SSH password to access the image.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select an image from VMware.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-vmware-vsphere-images-to-server_vmware-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Use the <code>--uuid</code> field to store the relative template path on the vSphere environment:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create \
--architecture "<em>My_Architecture</em>" \
--compute-resource "<em>My_VMware</em>"
--name "<em>My_Image</em>" \
--operatingsystem "<em>My_Operating_System</em>" \
--username root \
--uuid "<em>My_UUID</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_VMware_Details_to_a_Compute_Profile_vmware-provisioning"><a class="anchor" href="#Adding_VMware_Details_to_a_Compute_Profile_vmware-provisioning"></a>11.6. Adding VMware details to a compute profile</h3>
<div class="paragraph">
<p>You can predefine certain hardware settings for virtual machines on VMware vSphere.
You achieve this through adding these hardware settings to a compute profile.
To use the CLI instead of the orcharhino management UI, see the <a href="#cli-Adding_VMware_Details_to_a_Compute_Profile_vmware-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>Select a compute profile.</p>
</li>
<li>
<p>Select a VMware compute resource.</p>
</li>
<li>
<p>In the <strong>CPUs</strong> field, enter the number of CPUs to allocate to the host.</p>
</li>
<li>
<p>In the <strong>Cores per socket</strong> field, enter the number of cores to allocate to each CPU.</p>
</li>
<li>
<p>In the <strong>Memory</strong> field, enter the amount of memory in MiB to allocate to the host.</p>
</li>
<li>
<p>In the <strong>Firmware</strong> checkbox, select either <em>BIOS</em> or <em>UEFI</em> as firmware for the host.
By default, this is set to <em>automatic</em>.</p>
</li>
<li>
<p>In the <strong>Cluster</strong> list, select the name of the target host cluster on the VMware environment.</p>
</li>
<li>
<p>From the <strong>Resource pool</strong> list, select an available resource allocations for the host.</p>
</li>
<li>
<p>In the <strong>Folder</strong> list, select the folder to organize the host.</p>
</li>
<li>
<p>From the <strong>Guest OS</strong> list, select the operating system you want to use in VMware vSphere.</p>
</li>
<li>
<p>From the <strong>Virtual H/W version</strong> list, select the underlying VMware hardware abstraction to use for virtual machines.</p>
</li>
<li>
<p>If you want to add more memory while the virtual machine is powered on, select the <strong>Memory hot add</strong> checkbox.</p>
</li>
<li>
<p>If you want to add more CPUs while the virtual machine is powered on, select the <strong>CPU hot add</strong> checkbox.</p>
</li>
<li>
<p>If you want to add a CD-ROM drive, select the <strong>CD-ROM drive</strong> checkbox.</p>
</li>
<li>
<p>From the <strong>Boot order</strong> list, define the order in which the virtual machines tried to boot.</p>
</li>
<li>
<p>Optional: In the <strong>Annotation Notes</strong> field, enter an arbitrary description.</p>
</li>
<li>
<p>If you use image-based provisioning, select the image from the <strong>Image</strong> list.</p>
</li>
<li>
<p>From the <strong>SCSI controller</strong> list, select the disk access method for the host.</p>
</li>
<li>
<p>If you want to use eager zero thick provisioning, select the <strong>Eager zero</strong> checkbox.
By default, the disk uses lazy zero thick provisioning.</p>
</li>
<li>
<p>From the <strong>Network Interfaces</strong> list, select the network parameters for the host&#8217;s network interface.
At least one interface must point to a orcharhino&#160;Proxy-managed network.</p>
</li>
<li>
<p>Optional: Click <strong>Add Interface</strong> to create another network interfaces.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div id="cli-Adding_VMware_Details_to_a_Compute_Profile_vmware-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile create --name "<em>My_Compute_Profile</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set VMware details to a compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile values create \
--compute-attributes "cpus=1,corespersocket=2,memory_mb=1024,cluster=MyCluster,path=MyVMs,start=true" \
--compute-profile "<em>My_Compute_Profile</em>" \
--compute-resource "<em>My_VMware</em>" \
--interface "compute_type=VirtualE1000,compute_network=mynetwork \
--volume "size_gb=20G,datastore=Data,name=myharddisk,thin=true"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Hosts_on_VMware_vmware-provisioning"><a class="anchor" href="#Creating_Hosts_on_VMware_vmware-provisioning"></a>11.7. Creating hosts on VMware</h3>
<div class="paragraph">
<p>The VMware vSphere provisioning process provides the option to create hosts over a network connection or using an existing image.</p>
</div>
<div class="paragraph">
<p>For network-based provisioning, you must create a host to access either orcharhino&#160;Server&#8217;s integrated orcharhino&#160;Proxy or an external orcharhino&#160;Proxy on a VMware vSphere virtual network, so that the host has access to PXE provisioning services.
The new host entry triggers the VMware vSphere server to create the virtual machine.
If the virtual machine detects the defined orcharhino&#160;Proxy through the virtual network, the virtual machine boots to PXE and begins to install the chosen operating system.</p>
</div>
<div class="paragraph">
<div class="title">DHCP conflicts</div>
<p>If you use a virtual network on the VMware vSphere server for provisioning, ensure that you select a virtual network that does not provide DHCP assignments.
This causes DHCP conflicts with orcharhino&#160;Server when booting new hosts.</p>
</div>
<div class="paragraph">
<p>For image-based provisioning, use the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-hosts-on-vmware-vsphere_vmware-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the VMware vSphere connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine-based settings.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
VMware assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the interface window, review the VMware-specific fields that are populated with settings from our compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>Select the Provisioning Method that you want:</p>
<div class="ulist">
<ul>
<li>
<p>For network-based provisioning, click <strong>Network Based</strong>.</p>
</li>
<li>
<p>For image-based provisioning, click <strong>Image Based</strong>.</p>
</li>
<li>
<p>If the <code>foreman_bootdisk</code> plugin is installed, and you want to use boot-disk provisioning, click <strong>Boot disk based</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your requirements.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to provision your host on VMware.</p>
</li>
</ol>
</div>
<div id="cli-creating-hosts-on-vmware-vsphere_vmware-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host from a network with the <code>hammer host create</code> command and include <code>--provision-method build</code> to use network-based provisioning:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--build true \
--compute-attributes="cpus=1,corespersocket=2,memory_mb=1024,cluster=MyCluster,path=MyVMs,start=true" \
--compute-resource "<em>My_VMware</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--interface "managed=true,primary=true,provision=true,compute_type=VirtualE1000,compute_network=mynetwork" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host</em>" \
--organization "<em>My_Organization</em>" \
--provision-method build \
--volume="size_gb=20G,datastore=Data,name=myharddisk,thin=true"</pre>
</div>
</div>
</li>
<li>
<p>Create the host from an image with the <code>hammer host create</code> command and include <code>--provision-method image</code> to use image-based provisioning:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--compute-attributes="cpus=1,corespersocket=2,memory_mb=1024,cluster=MyCluster,path=MyVMs,start=true" \
--compute-resource "<em>My_VMware</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--image "<em>My_VMware_Image</em>" \
--interface "managed=true,primary=true,provision=true,compute_type=VirtualE1000,compute_network=mynetwork" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host</em>" \
--organization "<em>My_Organization</em>" \
--provision-method image \
--volume="size_gb=20G,datastore=Data,name=myharddisk,thin=true"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="Using_VMware_Cloud_Init_and_Userdata_Templates_for_Provisioning_vmware-provisioning"><a class="anchor" href="#Using_VMware_Cloud_Init_and_Userdata_Templates_for_Provisioning_vmware-provisioning"></a>11.8. Using VMware cloud-init and userdata templates for provisioning</h3>
<div class="paragraph">
<p>You can use VMware with the <code>Cloud-init</code> and <code>Userdata</code> templates to insert user data into the new virtual machine, to make further VMware customization, and to enable the VMware-hosted virtual machine to call back to orcharhino.</p>
</div>
<div class="paragraph">
<p>You can use the same procedures to set up a VMware compute resource within orcharhino, with a few modifications to the workflow.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/common/user-data-sequence-orcharhino.svg" alt="VMware cloud-init provisioning overview">
</div>
<div class="title">Figure 1. VMware cloud-init provisioning overview</div>
</div>
<div class="paragraph">
<p>When you set up the compute resource and images for VMware provisioning in orcharhino, the following sequence of provisioning events occurs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user provisions one or more virtual machines using the orcharhino management UI, API, or hammer</p>
</li>
<li>
<p>orcharhino calls the VMware vCenter to clone the virtual machine template</p>
</li>
<li>
<p>orcharhino <code>userdata</code> provisioning template adds customized identity information</p>
</li>
<li>
<p>When provisioning completes, the <code>Cloud-init</code> provisioning template instructs the virtual machine to call back to orcharhino&#160;Proxy when <code>cloud-init</code> runs</p>
</li>
<li>
<p>VMware vCenter clones the template to the virtual machine</p>
</li>
<li>
<p>VMware vCenter applies customization for the virtual machine&#8217;s identity, including the host name, IP, and DNS</p>
</li>
<li>
<p>The virtual machine builds, <code>cloud-init</code> is invoked and calls back orcharhino on port <code>80</code>, which then redirects to <code>443</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure port and firewall settings to open any necessary connections.
Because of the <code>cloud-init</code> service, the virtual machine always calls back to orcharhino even if you register the virtual machine to orcharhino&#160;Proxy.</p>
</li>
<li>
<p>If you want to use orcharhino&#160;Proxies instead of your orcharhino&#160;Server, ensure that you have configured your orcharhino&#160;Proxies accordingly.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>It is essential to add your orcharhino&#160;Proxy to the list of trusted proxies on orcharhino&#160;Server!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.theforeman.org/3.9/Installing_Proxy/index-orcharhino.html#configuring-orcharhino-proxy-for-host-registration-and-provisioning_orcharhino-proxy">Configuring orcharhino&#160;Proxy for Host Registration and Provisioning</a> in <em>Installing orcharhino&#160;Proxy</em>.</p>
</div>
</li>
<li>
<p>Back up the following configuration files:</p>
<div class="ulist">
<ul>
<li>
<p><code>/etc/cloud/cloud.cfg.d/01_network.cfg</code></p>
</li>
<li>
<p><code>/etc/cloud/cloud.cfg.d/10_datasource.cfg</code></p>
</li>
<li>
<p><code>/etc/cloud/cloud.cfg</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Associating the <code>Userdata</code> and <code>Cloud-init</code> templates with the operating system</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Search for the <strong>CloudInit default</strong> template and click its name.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab.</p>
</li>
<li>
<p>Select all operating systems to which the template applies and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Repeat the steps above for the <strong>UserData open-vm-tools</strong> template.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Select the operating system that you want to use for provisioning.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>From the <strong>Cloud-init template</strong> list, select <strong>CloudInit default</strong>.</p>
</li>
<li>
<p>From the <strong>User data template</strong> list, select <strong>UserData open-vm-tools</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Preparing an image to use the cloud-init template</div>
<p>To prepare an image, you must first configure the settings that you require on a virtual machine that you can then save as an image to use in orcharhino.</p>
</div>
<div class="paragraph">
<p>To use the <code>cloud-init</code> template for provisioning, you must configure a virtual machine so that <code>cloud-init</code> is installed, enabled, and configured to call back to orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>For security purposes, you must install a CA certificate to use HTTPS for all communication.
This procedure includes steps to clean the virtual machine so that no unwanted information transfers to the image you use for provisioning.</p>
</div>
<div class="paragraph">
<p>If you have an image with <code>cloud-init</code>, you must still follow this procedure to enable <code>cloud-init</code> to communicate with orcharhino because <code>cloud-init</code> is disabled by default.</p>
</div>
<div class="paragraph">
<p>These instructions are for Enterprise Linux or Fedora, follow similar steps for other Linux distributions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the virtual machine that you use to create the image, install the required packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install cloud-init open-vm-tools perl-interpreter perl-File-Temp</pre>
</div>
</div>
<div class="paragraph">
<p>On Enterprise Linux 9, you also require the <code>dbus-tools</code> package for network connectivity.</p>
</div>
</li>
<li>
<p>Disable network configuration by <code>cloud-init</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat &lt;&lt; EOM &gt; /etc/cloud/cloud.cfg.d/01_network.cfg
network:
  config: disabled
EOM</pre>
</div>
</div>
</li>
<li>
<p>Configure <code>cloud-init</code> to fetch data from orcharhino:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat &lt;&lt; EOM &gt; /etc/cloud/cloud.cfg.d/10_datasource.cfg
datasource_list: [NoCloud]
datasource:
  NoCloud:
    seedfrom: https://orcharhino.example.com/userdata/
EOM</pre>
</div>
</div>
<div class="paragraph">
<p>If you intend to provision through orcharhino&#160;Proxy, use the URL of your orcharhino&#160;Proxy in the <code>seedfrom</code> option, such as <code>https://<em>orcharhino-proxy.example.com</em>:9090/userdata/</code>.</p>
</div>
</li>
<li>
<p>Configure modules to use in <code>cloud-init</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat &lt;&lt; EOM &gt; /etc/cloud/cloud.cfg
cloud_init_modules:
 - bootcmd
 - ssh

cloud_config_modules:
 - runcmd

cloud_final_modules:
 - scripts-per-once
 - scripts-per-boot
 - scripts-per-instance
 - scripts-user
 - phone-home

system_info:
  distro: rhel
  paths:
    cloud_dir: /var/lib/cloud
    templates_dir: /etc/cloud/templates
  ssh_svcname: sshd
EOM</pre>
</div>
</div>
</li>
<li>
<p>Download the <code>katello-server-ca.crt</code> file from orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># wget -O /etc/pki/ca-trust/source/anchors/cloud-init-ca.crt https://<em>orcharhino.example.com</em>/pub/katello-server-ca.crt</pre>
</div>
</div>
<div class="paragraph">
<p>If you intend to provision through orcharhino&#160;Proxy, download the file from your orcharhino&#160;Proxy, such as <code>https://<em>orcharhino-proxy.example.com</em>/pub/katello-server-ca.crt</code>.</p>
</div>
</li>
<li>
<p>Update the record of certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># update-ca-trust extract</pre>
</div>
</div>
</li>
<li>
<p>Stop the <code>rsyslog</code> and <code>auditd</code> services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl stop rsyslog
# systemctl stop auditd</pre>
</div>
</div>
</li>
<li>
<p>Clean packages on the image:</p>
<div class="ulist">
<ul>
<li>
<p>On Enterprise Linux 8 and later:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf remove --oldinstallonly</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 7 and earlier:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># package-cleanup --oldkernels --count=1
# dnf clean all</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Reduce logspace, remove old logs, and truncate logs:</p>
<div class="listingblock">
<div class="content">
<pre># logrotate -f /etc/logrotate.conf
# rm -f /var/log/*-???????? /var/log/*.gz
# rm -f /var/log/dmesg.old
# rm -rf /var/log/anaconda
# cat /dev/null &gt; /var/log/audit/audit.log
# cat /dev/null &gt; /var/log/wtmp
# cat /dev/null &gt; /var/log/lastlog
# cat /dev/null &gt; /var/log/grubby</pre>
</div>
</div>
</li>
<li>
<p>Remove <code>udev</code> hardware rules:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -f /etc/udev/rules.d/70*</pre>
</div>
</div>
</li>
<li>
<p>Remove the <code>ifcfg</code> scripts related to existing network configurations:</p>
<div class="listingblock">
<div class="content">
<pre># rm -f /etc/sysconfig/network-scripts/ifcfg-ens*
# rm -f /etc/sysconfig/network-scripts/ifcfg-eth*</pre>
</div>
</div>
</li>
<li>
<p>Remove the SSH host keys:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -f /etc/ssh/ssh_host_*</pre>
</div>
</div>
</li>
<li>
<p>Remove root user&#8217;s SSH history:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -rf ~root/.ssh/known_hosts</pre>
</div>
</div>
</li>
<li>
<p>Remove root user&#8217;s shell history:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -f ~root/.bash_history
# unset HISTFILE</pre>
</div>
</div>
</li>
<li>
<p>Create an image from this virtual machine.</p>
</li>
<li>
<p><a href="#Adding_VMware_Images_to_Server_vmware-provisioning">Add your image to orcharhino</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_VM_on_VMware_vmware-provisioning"><a class="anchor" href="#Deleting_a_VM_on_VMware_vmware-provisioning"></a>11.9. Deleting a VM on VMware</h3>
<div class="paragraph">
<p>You can delete VMs running on VMware from within orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure &gt; Compute Resources</strong>.</p>
</li>
<li>
<p>Select your VMware provider.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Delete</strong> from the <strong>Actions</strong> menu.
This deletes the virtual machine from the VMware compute resource while retaining any associated hosts within orcharhino.
If you want to delete the orphaned host, navigate to <strong>Hosts &gt; All Hosts</strong> and delete the host manually.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Importing-a_virtual-machine-from-VMware-into-orcharhino_vmware-provisioning"><a class="anchor" href="#Importing-a_virtual-machine-from-VMware-into-orcharhino_vmware-provisioning"></a>11.10. Importing a virtual machine from VMware into orcharhino</h3>
<div class="paragraph">
<p>You can import existing virtual machines running on VMware into orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your VMware compute resource.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Import as managed Host</strong> or <strong>Import as unmanaged Host</strong> from the <strong>Actions</strong> menu.
The following page looks identical to creating a host with the compute resource being already selected.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Hosts/index-orcharhino.html#Creating_a_Host_managing-hosts">Creating a host in orcharhino</a> in <em>Managing hosts</em>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to import the virtual machine into orcharhino.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Caching_of_Compute_Resources_vmware-provisioning"><a class="anchor" href="#Caching_of_Compute_Resources_vmware-provisioning"></a>11.11. Caching of compute resources</h3>
<div class="paragraph">
<p>Caching of compute resources speeds up rendering of VMware information.</p>
</div>
<div class="sect3">
<h4 id="Enabling_Caching_of_Compute_Resources_vmware-provisioning"><a class="anchor" href="#Enabling_Caching_of_Compute_Resources_vmware-provisioning"></a>11.11.1. Enabling caching of compute resources</h4>
<div class="paragraph">
<p>To enable or disable caching of compute resources:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Click the <strong>Edit</strong> button to the right of the VMware server you want to update.</p>
</li>
<li>
<p>Select the <strong>Enable caching</strong> checkbox.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Refreshing_the_Compute_Resources_Cache_vmware-provisioning"><a class="anchor" href="#Refreshing_the_Compute_Resources_Cache_vmware-provisioning"></a>11.11.2. Refreshing the compute resources cache</h4>
<div class="paragraph">
<p>Refresh the cache of compute resources to update compute resources information.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select a VMware server you want to refresh the compute resources cache for and click <strong>Refresh Cache</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Use this API call to refresh the compute resources cache:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -H "Accept:application/json" \
-H "Content-Type:application/json" -X PUT \
-u <em>username</em>:<em>password</em> -k \
https://<em>orcharhino.example.com</em>/api/compute_resources/<em>compute_resource_id</em>/refresh_cache</pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>hammer compute-resource list</code> to determine the ID of the VMware server you want to refresh the compute resources cache for.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_in_Proxmox_proxmox-provisioning"><a class="anchor" href="#Provisioning_Virtual_Machines_in_Proxmox_proxmox-provisioning"></a>12. Provisioning virtual machines in Proxmox</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Proxmox is open source software made for virtualization using KVM hypervisor and LXC containers.
orcharhino can interact with Proxmox, including creating virtual machines and controlling their power management states.</p>
</div>
<div class="sect2">
<h3 id="Installing_the_Proxmox_plugin_proxmox-provisioning"><a class="anchor" href="#Installing_the_Proxmox_plugin_proxmox-provisioning"></a>12.1. Installing the Proxmox plugin</h3>
<div class="paragraph">
<p>Install the Proxmox plugin to attach a Proxmox compute resource provider to orcharhino.
This allows you to manage and deploy hosts to Proxmox.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the Proxmox plugin on your orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-proxmox</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong> and select the <strong>Compute Resources</strong> tab to verify the installation of the Proxmox plugin.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Proxmox_Connection_to_orcharhino_proxmox-provisioning"><a class="anchor" href="#Adding_a_Proxmox_Connection_to_orcharhino_proxmox-provisioning"></a>12.2. Adding a Proxmox connection to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>Use this procedure to add a Proxmox connection to orcharhino.
If your Proxmox instance consists of multiple nodes, you have to create a Proxmox connection to orcharhino for each node.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the host and network-based firewalls are configured to allow communication from orcharhino to Proxmox on TCP port 443.</p>
</li>
<li>
<p>Verify that orcharhino&#160;Server is able to resolve the host name of your Proxmox compute resource and Proxmox is able to resolve the host name of orcharhino&#160;Server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>Proxmox</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>Optional: In the <strong>Authentication method</strong> list, select <code>User token</code> if you do not want to use access tickets to authenticate on Proxmox.</p>
</li>
<li>
<p>In the <strong>Url</strong> field, enter the IP address or host name of your Proxmox node.
Ensure to specify its port and add <code>/api2/json</code> to its path.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the user name to access Proxmox.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the password for the user.</p>
</li>
<li>
<p>Optional: Select the <strong>SSL verify peer</strong> checkbox to verify the certificate used for the encrypted connection from orcharhino to Proxmox.</p>
</li>
<li>
<p>In the <strong>X509 Certificate Authorities</strong> field, enter a certificate authority or a correctly ordered chain of certificate authorities.</p>
</li>
<li>
<p>Optional: Click <strong>Test Connection</strong> to verify the URL and its corresponding credentials.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the connection.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Proxmox_Images_to_orcharhino_proxmox-provisioning"><a class="anchor" href="#Adding_Proxmox_Images_to_orcharhino_proxmox-provisioning"></a>12.3. Adding Proxmox images to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>Proxmox uses templates as images for creating new virtual machines.
When you use image-based provisioning to create new hosts, you need to add Proxmox template details to your orcharhino&#160;Server.
This includes access details and the template name.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Proxmox compute resource.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
By default, this is set to <code>root</code>.
This is only necessary if the image has an inbuilt user account.</p>
</li>
<li>
<p>From the <strong>User data</strong> list, select whether you want the images to support user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>In the <strong>Image</strong> field, enter the relative path and name of the template on the Proxmox environment.
Do not include the data center in the relative path.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Proxmox_Details_to_a_Compute_Profile_proxmox-provisioning"><a class="anchor" href="#Adding_Proxmox_Details_to_a_Compute_Profile_proxmox-provisioning"></a>12.4. Adding Proxmox details to a compute profile</h3>
<div class="paragraph">
<p>You can predefine certain hardware settings for virtual machines on Proxmox.
You achieve this through adding these hardware settings to a compute profile.</p>
</div>
<div class="paragraph">
<p>Note that this procedure assumes you are using KVM/qemu-based virtualization.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>Select a compute profile.</p>
</li>
<li>
<p>Select a Proxmox compute resource.</p>
</li>
<li>
<p>In the <strong>Type</strong> list, select the kind of virtualization solution hosts will run on when created using this compute profile.
In Proxmox, you may choose between <em>LXC</em> (Linux containers) and <em>KVM/QEMU</em> (kernel-based virtual machines).
LXC focuses more on isolating applications and reusing the host kernel.
KVM runs its own kernel and lets you boot various guest operating systems.</p>
</li>
<li>
<p>In the <strong>Node</strong> list, select the Proxmox node you want to deploy your hosts to.
This makes sense if you run a Proxmox cluster.</p>
</li>
<li>
<p>If you want to automatically start virtual machines after creation, select the <strong>Start after creation?</strong> checkbox.
You can overwrite this for individual hosts when you create them.</p>
</li>
<li>
<p>In the <strong>Image</strong> list, select an image that is available on your Proxmox compute resource.</p>
</li>
<li>
<p>In the <strong>Pool</strong> list, select a resource allocation pool.</p>
</li>
<li>
<p>Optional: You can select the <strong>Main options</strong>, <strong>CPU</strong>, <strong>Memory</strong>, and <strong>OS</strong> checkboxes to configure the compute profile in more detail.</p>
</li>
<li>
<p>In the <strong>Identifier</strong> field, enter the name of the network interface of your host.
The default value is <code>net0</code>.</p>
</li>
<li>
<p>From the <strong>Card</strong> list, select the type of network interface card of your host.</p>
</li>
<li>
<p>Optional: From the <strong>Bridge</strong> list, select a bridge to assign the host to it.</p>
</li>
<li>
<p>Optional: In the <strong>VLAN tag</strong> field, you can assign your host to a VLAN.
The <strong>VLAN tag</strong> field lets you input the corresponding VLAN tag which your Proxmox node is part of.</p>
</li>
<li>
<p>Optional: In the <strong>Rate limit</strong> field, you can limit the network traffic of hosts.</p>
</li>
<li>
<p>Optional: In the <strong>Multiqueue</strong> field, you can set multiple virtual CPUs to process network packets.</p>
</li>
<li>
<p>Optional: If you want to use the integrated firewall in Proxmox, select the <strong>Firewall</strong> checkbox.</p>
</li>
<li>
<p>Optional: If you want to disconnect your host from the network, select the <strong>Disconnect</strong> checkbox.</p>
</li>
<li>
<p>Optional: Click <strong>Add Interface</strong> to add another network interface.</p>
</li>
<li>
<p>From the <strong>Storage</strong> list, select the name of the storage pool within Proxmox.</p>
</li>
<li>
<p>In the <strong>Controller</strong> field, select the type of the disk controller of your host in Proxmox.
ATIX&#160;AG recommends to use either <em>SCSI</em> or <em>VirtIO Block</em>.</p>
</li>
<li>
<p>In the <strong>Device</strong> field, enter the number of the disk.</p>
</li>
<li>
<p>In the <strong>Cache</strong> list, select the type of disk cache you want to use on your host in Proxmox.
ATIX&#160;AG does not recommend using caching within Proxmox.</p>
</li>
<li>
<p>In the <strong>Size (GB)</strong> field, enter the size of the disk.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Hosts_on_Proxmox_proxmox-provisioning"><a class="anchor" href="#Creating_Hosts_on_Proxmox_proxmox-provisioning"></a>12.5. Creating hosts on Proxmox</h3>
<div class="paragraph">
<p>The Proxmox provisioning process provides the option to create hosts over a network connection or using an existing image.</p>
</div>
<div class="paragraph">
<p>For network-based provisioning, you must create a host to access either integrated orcharhino&#160;Proxy or an external orcharhino&#160;Proxy on a Proxmox virtual network, so that the host has access to PXE provisioning services.
The new host entry triggers the Proxmox node to create the virtual machine.
If the virtual machine detects the defined orcharhino&#160;Proxy through the virtual network, the virtual machine boots to PXE and begins to install the chosen operating system.</p>
</div>
<div class="paragraph">
<div class="title">DHCP conflicts</div>
<p>If you use a virtual network on the Proxmox node for provisioning, ensure that you select a virtual network that does not provide DHCP assignments.
This causes DHCP conflicts with orcharhino&#160;Server when booting new hosts.</p>
</div>
<div class="paragraph">
<p>For image-based provisioning, use the pre-existing image as a basis for the new volume.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select your Proxmox compute resource.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine-based settings.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
Proxmox assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>On the <strong>Operating System</strong> tab, confirm that all fields automatically contain values.</p>
</li>
<li>
<p>Select the Provisioning Method that you want:</p>
<div class="ulist">
<ul>
<li>
<p>For network-based provisioning, click <strong>Network Based</strong>.</p>
</li>
<li>
<p>For image-based provisioning, click <strong>Image Based</strong>.</p>
</li>
<li>
<p>If the <code>foreman_bootdisk</code> plugin is installed and you want to use boot-disk provisioning, click <strong>Boot disk based</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your requirements.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to provision your host on Proxmox.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_Virtual_Machine_on_Proxmox_proxmox-provisioning"><a class="anchor" href="#Deleting_a_Virtual_Machine_on_Proxmox_proxmox-provisioning"></a>12.6. Deleting a virtual machine on Proxmox</h3>
<div class="paragraph">
<p>You can delete virtual machines running on Proxmox from within orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Proxmox compute resource.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Delete</strong> from the <strong>Actions</strong> menu.
This deletes the virtual machine from your Proxmox compute resource while retaining any associated hosts within orcharhino.</p>
</li>
<li>
<p>Optional: If you want to delete the orphaned host, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and delete the host manually.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Importing-a_virtual-machine-from-Proxmox-into-orcharhino_proxmox-provisioning"><a class="anchor" href="#Importing-a_virtual-machine-from-Proxmox-into-orcharhino_proxmox-provisioning"></a>12.7. Importing a virtual machine from Proxmox into orcharhino</h3>
<div class="paragraph">
<p>You can import existing virtual machines running on Proxmox into orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Proxmox compute resource.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Import as managed Host</strong> or <strong>Import as unmanaged Host</strong> from the <strong>Actions</strong> menu.
The following page looks identical to creating a host with the compute resource being already selected.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Hosts/index-orcharhino.html#Creating_a_Host_managing-hosts">Creating a host in orcharhino</a> in <em>Managing hosts</em>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to import the virtual machine into orcharhino.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Remote_Console_Connection_for_a_Host_on_Proxmox_proxmox-provisioning"><a class="anchor" href="#Adding_a_Remote_Console_Connection_for_a_Host_on_Proxmox_proxmox-provisioning"></a>12.8. Adding a remote console connection for a host on Proxmox</h3>
<div class="paragraph">
<p>Use this procedure to add a remote console connection using VNC for a host on Proxmox.</p>
</div>
<div class="ulist">
<div class="title">Limitation</div>
<ul>
<li>
<p>This procedure only works for hosts based on <code>qemu</code>.
It does not work for LXC container on Proxmox.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your host has <code>Standard VGA</code> selected from the <strong>VGA</strong> list.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Proxmox, open the required port for VNC:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port=<em>My_Port</em>/tcp --permanent</pre>
</div>
</div>
<div class="paragraph">
<p>The port is the sum of <code>5900</code> and the VMID of your host.
You can view the VMID on the <strong>VM</strong> tab for your host in the orcharhino management UI.
For example, if your host has the VMID 142, open port <code>6042</code> on your Proxmox.</p>
</div>
<div class="paragraph">
<p>To enable a remote console connection for multiple hosts, open a range of ports using <code>firewall-cmd --add-port=5900-<em>My_Upper_Port_Range_Limit</em>/tcp --permanent</code>.</p>
</div>
</li>
<li>
<p>Reload the firewall configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --reload</pre>
</div>
</div>
</li>
<li>
<p>On your Proxmox, enable VNC for your host in <code>/etc/pve/nodes/<em>My_Proxmox_Instance</em>/qemu-server/<em>My_VMID</em>.conf</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">args: -vnc 0.0.0.0:_My_VMID_</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://pve.proxmox.com/wiki/VNC_Client_Access">VNC Client Access</a> in the Proxmox documentation.</p>
</div>
</li>
<li>
<p>Restart your host on Proxmox.</p>
</li>
<li>
<p>Optional: Verify that the required port for VNC is open:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># netstat -ltunp</pre>
</div>
</div>
</li>
<li>
<p>On your orcharhino&#160;Server, allow the <code>websockify</code> capability in SELinux:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># setsebool -P foreman_rails_can_connect_all on
# setsebool -P websockify_can_connect_all on</pre>
</div>
</div>
</li>
<li>
<p>If you use a custom SSL certificate, import the SSL certificate from orcharhino&#160;Server into your browser.
For more information, see <a href="https://docs.theforeman.org/3.9/Administering_Project/index-orcharhino.html#Importing_the_Katello_Root_CA_Certificate_admin">Importing the Katello Root CA Certificate</a> in <em>Administering orcharhino</em>.</p>
<div class="paragraph">
<p>The remote console connection to your host will fail if you choose to temporarily accept not checking the certificates in your browser.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_Kubevirt_kubevirt-provisioning"><a class="anchor" href="#Provisioning_Virtual_Machines_Kubevirt_kubevirt-provisioning"></a>13. Provisioning virtual machines on KubeVirt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>KubeVirt addresses the needs of development teams that have adopted or want to adopt Kubernetes but possess existing virtual machine (VM) workloads that cannot be easily containerized.
This technology provides a unified development platform where developers can build, modify, and deploy applications residing in application containers and VMs in a shared environment.
These capabilities support rapid application modernization across the open hybrid cloud.</p>
</div>
<div class="paragraph">
<p>With orcharhino, you can create a compute resource for KubeVirt so that you can provision and manage virtual machines in Kubernetes using orcharhino.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Provide an activation key for host registration.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Creating_an_Activation_Key_content-management">Creating An Activation Key</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>You must have <code>cluster-admin</code> permissions for the Kubernetes cluster.</p>
</li>
<li>
<p>A orcharhino&#160;Proxy managing a network on the Kubernetes cluster.
Ensure that no other DHCP services run on this network to avoid conflicts with orcharhino&#160;Proxy.
For more information about network service configuration for orcharhino&#160;Proxies, see <a href="https://docs.theforeman.org/3.9/Provisioning_Hosts/index-orcharhino.html#Configuring_Networking_provisioning">Configuring Networking</a> in <em>Provisioning hosts</em>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For a list of permissions a non-admin user requires to provision hosts, see <a href="#permissions-required-to-provision-hosts_provisioning">Permissions required to provision hosts</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="adding-kubevirt-connection_kubevirt-provisioning"><a class="anchor" href="#adding-kubevirt-connection_kubevirt-provisioning"></a>13.1. Adding a KubeVirt connection to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>Use this procedure to add KubeVirt as a compute resource in orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following <code>foreman-installer</code> command to enable the KubeVirt plugin for orcharhino:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-kubevirt</pre>
</div>
</div>
</li>
<li>
<p>Obtain a token to use for HTTP and HTTPs authentication:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Log in to the Kubernetes cluster and list the secrets that contain tokens:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kubectl get secrets</pre>
</div>
</div>
</li>
<li>
<p>Obtain the token for your secret:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kubectl get secrets <em>MY_SECRET</em> -o jsonpath='{.data.token}' | base64 -d | xargs</pre>
</div>
</div>
</li>
<li>
<p>Record the token to use later in this procedure.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>, and click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the new compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>KubeVirt</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>In the <strong>Hostname</strong> field, enter the FQDN, hostname, or IP address of the Kubernetes cluster.</p>
</li>
<li>
<p>In the <strong>API Port</strong> field, enter the port number that you want to use for provisioning requests from orcharhino to KubeVirt.</p>
</li>
<li>
<p>In the <strong>Namespace</strong> field, enter the user name of the Kubernetes cluster.</p>
</li>
<li>
<p>In the <strong>Token</strong> field, enter the bearer token for HTTP and HTTPs authentication.</p>
</li>
<li>
<p>Optional: In the <strong>X509 Certification Authorities</strong> field, enter a certificate to enable client certificate authentication for API server calls.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Cloud_Instances_OpenStack_openstack-provisioning"><a class="anchor" href="#Provisioning_Cloud_Instances_OpenStack_openstack-provisioning"></a>14. Provisioning cloud instances on OpenStack</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenStack provides the foundation to build a private or public Infrastructure-as-a-Service (IaaS) cloud.
It offers a massively scalable, fault-tolerant platform for the development of cloud-enabled workloads.
In orcharhino, you can interact with OpenStack REST API to create cloud instances and control their power management states.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Provide an activation key for host registration.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Creating_an_Activation_Key_content-management">Creating An Activation Key</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>A orcharhino&#160;Proxy managing a network in your OpenStack environment.
For more information, see <a href="https://docs.theforeman.org/3.9/Provisioning_Hosts/index-orcharhino.html#Configuring_Networking_provisioning">Configuring Networking</a> in <em>Provisioning hosts</em>.</p>
</li>
<li>
<p>An image added to OpenStack Image Storage (glance) service for image-based provisioning.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="adding-openstack-connection_openstack-provisioning"><a class="anchor" href="#adding-openstack-connection_openstack-provisioning"></a>14.1. Adding a OpenStack connection to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>You can add OpenStack as a compute resource in orcharhino.
To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-openstack-connection_openstack-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the new compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>RHEL OpenStack Platform</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the URL for the OpenStack Authentication keystone service&#8217;s API at the <code>tokens</code> resource, such as <code>http://openstack.example.com:5000/v2.0/tokens</code> or <code>http://openstack.example.com:5000/v3/auth/tokens</code>.</p>
</li>
<li>
<p>In the <strong>Username</strong> and <strong>Password</strong> fields, enter the user authentication for orcharhino to access the environment.</p>
</li>
<li>
<p>Optional: In the <strong>Project (Tenant) name</strong> field, enter the name of your tenant (v2) or project (v3) for orcharhino&#160;Server to manage.</p>
</li>
<li>
<p>In the <strong>User domain</strong> field, enter the user domain for v3 authentication.</p>
</li>
<li>
<p>In the <strong>Project domain name</strong> field, enter the project domain name for v3 authentication.</p>
</li>
<li>
<p>In the <strong>Project domain ID</strong> field, enter the project domain ID for v3 authentication.</p>
</li>
<li>
<p>Optional: Select <strong>Allow external network as main network</strong> to use external networks as primary networks for hosts.</p>
</li>
<li>
<p>Optional: Click <strong>Test Connection</strong> to verify that orcharhino can connect to your compute resource.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> and <strong>Organizations</strong> tabs and verify that the location and organization that you want to use are set to your current context.
Add any additional contexts that you want to these tabs.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the OpenStack connection.</p>
</li>
</ol>
</div>
<div id="cli-adding-openstack-connection_openstack-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a compute resource, enter the <code>hammer compute-resource create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create --name "<em>My_OpenStack</em>" \
--provider "OpenStack" \
--description "<em>My OpenStack environment at openstack.example.com</em>" \
--url "<em>http://openstack.example.com</em>:5000/v3/auth/tokens" \
--user "<em>My_Username</em>" --password "<em>My_Password</em>" \
--tenant "<em>My_Openstack</em>" --domain "<em>My_User_Domain</em>" \
--project-domain-id "<em>My_Project_Domain_ID</em>" \
--project-domain-name "<em>My_Project_Domain_Name</em>" \
--locations "New York" --organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-images-to-server_openstack-provisioning"><a class="anchor" href="#adding-images-to-server_openstack-provisioning"></a>14.2. Adding OpenStack images to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>To create hosts using image-based provisioning, you must add information about the image, such as access details and the image location, to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-images-to-server_openstack-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click the name of the OpenStack connection.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select an image from the OpenStack compute resource.</p>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the image supports user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-images-to-server_openstack-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Use the <code>--uuid</code> field to store the full path of the image location on the OpenStack server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create \
--name "OpenStack Image" \
--compute-resource "<em>My_OpenStack_Platform</em>"
--operatingsystem "RedHat <em>version</em>" \
--architecture "x86_64" \
--username root \
--user-data true \
--uuid "<em>/path/to/OpenstackImage.qcow2</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-openstack-details-to-a-compute-profile_openstack-provisioning"><a class="anchor" href="#adding-openstack-details-to-a-compute-profile_openstack-provisioning"></a>14.3. Adding OpenStack details to a compute profile</h3>
<div class="paragraph">
<p>Use this procedure to add OpenStack hardware settings to a compute profile.
When you create a host on OpenStack using this compute profile, these settings are automatically populated.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>In the Compute Profiles window, click the name of an existing compute profile, or click <strong>Create Compute Profile</strong>, enter a <strong>Name</strong>, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the OpenStack compute resource.</p>
</li>
<li>
<p>From the <strong>Flavor</strong> list, select the hardware profile on OpenStack to use for the host.</p>
</li>
<li>
<p>From the <strong>Availability zone</strong> list, select the target cluster to use within the OpenStack environment.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use for image-based provisioning.</p>
</li>
<li>
<p>From the <strong>Tenant</strong> list, select the tenant or project for the OpenStack instance.</p>
</li>
<li>
<p>From the <strong>Security Group</strong> list, select the cloud-based access rules for ports and IP addresses.</p>
</li>
<li>
<p>From the <strong>Internal network</strong>, select the private networks for the host to join.</p>
</li>
<li>
<p>From the <strong>Floating IP network</strong>, select the external networks for the host to join and assign a floating IP address.</p>
</li>
<li>
<p>From the <strong>Boot from volume</strong>, select whether a volume is created from the image.
If not selected, the instance boots the image directly.</p>
</li>
<li>
<p>In the <strong>New boot volume size (GB)</strong> field, enter the size, in GB, of the new boot volume.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Set OpenStack details to a compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile values create
--compute-resource "<em>My_Laptop</em>" \
--compute-profile "<em>My_Compute_Profile</em>" \
--compute-attributes "availability_zone=<em>My_Zone</em>,image_ref=<em>My_Image</em>,flavor_ref=m1.small,tenant_id=openstack,security_groups=default,network=<em>My_Network</em>,boot_from_volume=false"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-image-only-hosts_openstack-provisioning"><a class="anchor" href="#creating-image-only-hosts_openstack-provisioning"></a>14.4. Creating image-based hosts on OpenStack</h3>
<div class="paragraph">
<p>In orcharhino, you can use OpenStack provisioning to create hosts from an existing image.
The new host entry triggers the OpenStack server to create the instance using the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-image-only-hosts_openstack-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the OpenStack connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine settings.</p>
</li>
<li>
<p>From the <strong>Lifecycle Environment</strong> list, select the environment.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
OpenStack assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>If you want to change the image that populates automatically from your compute profile, from the <strong>Images</strong> list, select a different image to base the new host&#8217;s root volume on.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div id="cli-creating-image-only-hosts_openstack-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--compute-attributes="flavor_ref=m1.small,tenant_id=openstack,security_groups=default,network=mynetwork" \
--compute-resource "<em>My_OpenStack_Platform</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--image "<em>My_OpenStack_Image</em>" \
--interface "managed=true,primary=true,provision=true" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>" \
--provision-method image</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Cloud_Instances_in_Amazon_EC2_ec2-provisioning"><a class="anchor" href="#Provisioning_Cloud_Instances_in_Amazon_EC2_ec2-provisioning"></a>15. Provisioning cloud instances in Amazon EC2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Amazon Elastic Compute Cloud (Amazon EC2) is a web service that provides public cloud compute resources.
Using orcharhino, you can interact with Amazon EC2&#8217;s public API to create cloud instances and control their power management states.
Use the procedures in this chapter to add a connection to an Amazon EC2 account and provision a cloud instance.</p>
</div>
<div class="sect2">
<h3 id="Prerequisites_for_Amazon_EC2_Provisioning_ec2-provisioning"><a class="anchor" href="#Prerequisites_for_Amazon_EC2_Provisioning_ec2-provisioning"></a>15.1. Prerequisites for Amazon EC2 provisioning</h3>
<div class="paragraph">
<p>The requirements for Amazon EC2 provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A orcharhino&#160;Proxy managing a network in your EC2 environment.
Use a Virtual Private Cloud (VPC) to ensure a secure network between the hosts and orcharhino&#160;Proxy.</p>
</li>
<li>
<p>An Amazon Machine Image (AMI) for image-based provisioning.</p>
</li>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Provide an activation key for host registration.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Creating_an_Activation_Key_content-management">Creating An Activation Key</a> in <em>Managing content</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Installing_Amazon_EC2_plugin_ec2-provisioning"><a class="anchor" href="#Installing_Amazon_EC2_plugin_ec2-provisioning"></a>15.2. Installing Amazon EC2 plugin</h3>
<div class="paragraph">
<p>Install the Amazon EC2 plugin to attach an EC2 compute resource provider to orcharhino.
This allows you to manage and deploy hosts to EC2.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Install the EC2 compute resource provider on your orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-compute-ec2</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong>.</p>
</li>
<li>
<p>On the <strong>Available Providers</strong> tab, verify the installation of the Amazon EC2 plugin.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_an_Amazon_EC2_Connection_to_Server_ec2-provisioning"><a class="anchor" href="#Adding_an_Amazon_EC2_Connection_to_Server_ec2-provisioning"></a>15.3. Adding an Amazon EC2 connection to the orcharhino&#160;Server</h3>
<div class="paragraph">
<p>Use this procedure to add the Amazon EC2 connection in orcharhino&#160;Server&#8217;s compute resources.
To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-amazon-ec2-connection_ec2-provisioning">CLI procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An AWS EC2 user performing this procedure needs the <code>AmazonEC2FullAccess</code> permissions.
You can attach these permissions from AWS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Time settings and Amazon Web Services</div>
<p>Amazon Web Services uses time settings as part of the authentication process.
Ensure that orcharhino&#160;Server&#8217;s time is correctly synchronized.
Ensure that an NTP service, such as <code>ntpd</code> or <code>chronyd</code>, is running properly on orcharhino&#160;Server.
Failure to provide the correct time to Amazon Web Services can lead to authentication failures.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and in the Compute Resources window, click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to identify the Amazon EC2 compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>EC2</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter information that helps distinguish the resource for future use.</p>
</li>
<li>
<p>Optional: From the <strong>HTTP proxy</strong> list, select an HTTP proxy to connect to external API services.
You must add HTTP proxies to orcharhino before you can select a proxy from this list.
For more information, see <a href="#Using_an_HTTP_Proxy_with_Compute_Resources_Amazon_EC2_ec2-provisioning">Using an HTTP proxy with compute resources</a>.</p>
</li>
<li>
<p>In the <strong>Access Key</strong> and <strong>Secret Key</strong> fields, enter the access keys for your Amazon EC2 account.
For more information, see <a href="http://docs.aws.amazon.com/general/latest/gr/managing-aws-access-keys.html">Managing Access Keys for your AWS Account</a> on the Amazon documentation website.</p>
</li>
<li>
<p>Optional: Click <strong>Load Regions</strong> to populate the <strong>Regions</strong> list.</p>
</li>
<li>
<p>From the <strong>Region</strong> list, select the Amazon EC2 region or data center to use.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and ensure that the location you want to use is selected, or add a different location.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and ensure that the organization you want to use is selected, or add a different organization.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the Amazon EC2 connection.</p>
</li>
<li>
<p>Select the new compute resource and then click the <strong>SSH keys</strong> tab, and click <strong>Download</strong> to save a copy of the SSH keys to use for SSH authentication.
If you require SSH keys at a later stage, follow the procedure in <a href="#Connecting_to_an_Amazon_EC2_Instance_Using_SSH_ec2-provisioning">Connecting to an Amazon EC2 instance using SSH</a>.</p>
</li>
</ol>
</div>
<div id="cli-adding-amazon-ec2-connection_ec2-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the connection with the <code>hammer compute-resource create</code> command.
Use <code>--user</code> and <code>--password</code> options to add the access key and secret key respectively.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create \
--description "Amazon EC2 Public Cloud` \
--locations "<em>My_Location</em>" \
--name "<em>My_EC2_Compute_Resource</em>" \
--organizations "<em>My_Organization</em>" \
--password "<em>My_Secret_Key</em>" \
--provider "EC2" \
--region "<em>My_Region</em>" \
--user "<em>My_User_Name</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Using_an_HTTP_Proxy_with_Compute_Resources_Amazon_EC2_ec2-provisioning"><a class="anchor" href="#Using_an_HTTP_Proxy_with_Compute_Resources_Amazon_EC2_ec2-provisioning"></a>15.4. Using an HTTP proxy with compute resources</h3>
<div class="paragraph">
<p>In some cases, the EC2 compute resource that you use might require a specific HTTP proxy to communicate with orcharhino.
In orcharhino, you can create an HTTP proxy and then assign the HTTP proxy to your EC2 compute resource.</p>
</div>
<div class="paragraph">
<p>However, if you configure an HTTP proxy for orcharhino in <strong>Administer</strong> &gt; <strong>Settings</strong>, and then add another HTTP proxy for your compute resource, the HTTP proxy that you define in <strong>Administer</strong> &gt; <strong>Settings</strong> takes precedence.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>HTTP Proxies</strong>, and select <strong>New HTTP Proxy</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the HTTP proxy.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the URL for the HTTP proxy, including the port number.</p>
</li>
<li>
<p>Optional: Enter a username and password to authenticate to the HTTP proxy, if your HTTP proxy requires authentication.</p>
</li>
<li>
<p>Click <strong>Test Connection</strong> to ensure that you can connect to the HTTP proxy from orcharhino.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add a location.</p>
</li>
<li>
<p>Click the <strong>Organization</strong> tab and add an organization.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_an_Image_for_Amazon_EC2_ec2-provisioning"><a class="anchor" href="#Creating_an_Image_for_Amazon_EC2_ec2-provisioning"></a>15.5. Creating an image for Amazon EC2</h3>
<div class="paragraph">
<p>You can create images for Amazon EC2 from within orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Amazon EC2 provider.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Name</strong> field, enter a meaningful and unique name for your EC2 image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select an operating system to associate with the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select an architecture to associate with the image.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the username needed to SSH into the machine.</p>
</li>
<li>
<p>In the <strong>Image ID</strong> field, enter the image ID provided by Amazon or an operating system vendor.
This ID can be found within Amazon AWS or on operating system specific pages like <a href="https://wiki.debian.org/Cloud/AmazonEC2Image/Buster">debian.org</a> or <a href="https://cloud-images.ubuntu.com/locator/ec2/">ubuntu.com</a>.</p>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> check box to enable support for user data input.</p>
</li>
<li>
<p>Optional: Set an <strong>Iam Role</strong> for <em>Fog</em> to use when creating this image.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes to orcharhino.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Amazon_EC2_Images_to_Server_ec2-provisioning"><a class="anchor" href="#Adding_Amazon_EC2_Images_to_Server_ec2-provisioning"></a>15.6. Adding Amazon EC2 images to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>Amazon EC2 uses image-based provisioning to create hosts.
You must add image details to your orcharhino&#160;Server.
This includes access details and image location.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-amazon-ec2-images_ec2-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and select an Amazon EC2 connection.</p>
</li>
<li>
<p>Click the <strong>Images</strong> tab, and then click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to identify the image for future use.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the operating system that corresponds with the image you want to add.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system&#8217;s architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>In the <strong>Image ID</strong> field, enter the Amazon Machine Image (AMI) ID for the image.
This is usually in the following format: <code>ami-xxxxxxxx</code>.</p>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the images support user data input, such as <code>cloud-init</code> data.
If you enable user data, the Finish scripts are automatically disabled.
This also applies in reverse: if you enable the Finish scripts, this disables user data.</p>
</li>
<li>
<p>Optional: In the <strong>IAM role</strong> field, enter the Amazon security role used for creating the image.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-amazon-ec2-images_ec2-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Use the <code>--uuid</code> field to store the full path of the image location on the Amazon EC2 server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create \
--architecture "<em>My_Architecture</em>" \
--compute-resource "<em>My_EC2_Compute_Resource</em>" \
--name "<em>My_Amazon_EC2_Image</em>" \
--operatingsystem "<em>My_Operating_System</em>" \
--user-data true \
--username root \
--uuid "ami-<em>My_AMI_ID</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Amazon_EC2_Details_to_a_Compute_Profile_ec2-provisioning"><a class="anchor" href="#Adding_Amazon_EC2_Details_to_a_Compute_Profile_ec2-provisioning"></a>15.7. Adding Amazon EC2 details to a compute profile</h3>
<div class="paragraph">
<p>You can add hardware settings for instances on Amazon EC2 to a compute profile.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong> and click the name of your profile, then click an EC2 connection.</p>
</li>
<li>
<p>From the <strong>Flavor</strong> list, select the hardware profile on EC2 to use for the host.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use for image-based provisioning.</p>
</li>
<li>
<p>From the <strong>Availability zone</strong> list, select the target cluster to use within the chosen EC2 region.</p>
</li>
<li>
<p>From the <strong>Subnet</strong> list, add the subnet for the EC2 instance.
If you have a VPC for provisioning new hosts, use its subnet.</p>
</li>
<li>
<p>From the <strong>Security Groups</strong> list, select the cloud-based access rules for ports and IP addresses to apply to the host.</p>
</li>
<li>
<p>From the <strong>Managed IP</strong> list, select either a <code>Public</code> IP or a <code>Private</code> IP.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Set Amazon EC2 details to a compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile values create
--compute-resource "<em>My_Laptop</em>" \
--compute-profile "<em>My_Compute_Profile</em>" \
--compute-attributes "flavor_id=1,availability_zone= <em>My_Zone</em>,subnet_id=1,security_group_ids=1,managed_ip=public_ip"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Image_Based_Hosts_on_Amazon_EC2_ec2-provisioning"><a class="anchor" href="#Creating_Image_Based_Hosts_on_Amazon_EC2_ec2-provisioning"></a>15.8. Creating image-based hosts on Amazon EC2</h3>
<div class="paragraph">
<p>The Amazon EC2 provisioning process creates hosts from existing images on the Amazon EC2 server.
To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-hosts-on-amazon-ec2_ec2-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the EC2 connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine-based settings.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
EC2 assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab and confirm that all fields are populated with values.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that all fields are populated with values.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This new host entry triggers the Amazon EC2 server to create the instance, using the pre-existing image as a basis for the new volume.</p>
</div>
<div id="cli-creating-hosts-on-amazon-ec2_ec2-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code> to use image-based provisioning.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--compute-attributes="flavor_id=m1.small,image_id=TestImage,availability_zones=us-east-1a,security_group_ids=Default,managed_ip=Public" \
--compute-resource "<em>My_EC2_Compute_Resource</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--image "<em>My_Amazon_EC2_Image</em>" \
--interface "managed=true,primary=true,provision=true,subnet_id=EC2" \
--location "<em>My_Location</em>" \
--managed true \
--name "My_Host_Name_" \
--organization "<em>My_Organization</em>" \
--provision-method image</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="Connecting_to_an_Amazon_EC2_Instance_Using_SSH_ec2-provisioning"><a class="anchor" href="#Connecting_to_an_Amazon_EC2_Instance_Using_SSH_ec2-provisioning"></a>15.9. Connecting to an Amazon EC2 instance using SSH</h3>
<div class="paragraph">
<p>You can connect remotely to an Amazon EC2 instance from orcharhino&#160;Server using SSH.
However, to connect to any Amazon Web Services EC2 instance that you provision through orcharhino, you must first access the private key that is associated with the compute resource in the Foreman database, and use this key for authentication.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To locate the compute resource list, on your orcharhino&#160;Server base system, enter the following command, and note the ID of the compute resource that you want to use:</p>
<div class="listingblock">
<div class="content">
<pre># hammer compute-resource list</pre>
</div>
</div>
</li>
<li>
<p>Switch user to the <code>postgres</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su - postgres</pre>
</div>
</div>
</li>
<li>
<p>Initiate the <code>postgres</code> shell:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ psql</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Foreman database as the user <code>postgres</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># postgres=# \c foreman</pre>
</div>
</div>
</li>
<li>
<p>Select the secret from <code>key_pairs</code> where <code>compute_resource_id = 3</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># select secret from key_pairs where compute_resource_id = 3; secret</pre>
</div>
</div>
</li>
<li>
<p>Copy the key from after <code>-----BEGIN RSA PRIVATE KEY-----</code> until <code>-----END RSA PRIVATE KEY-----</code>.</p>
</li>
<li>
<p>Create a <code>.pem</code> file and paste your key into the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vim <em>Keyname</em>.pem</pre>
</div>
</div>
</li>
<li>
<p>Ensure that you restrict access to the <code>.pem</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 600 <em>Keyname</em>.pem</pre>
</div>
</div>
</li>
<li>
<p>To connect to the Amazon EC2 instance, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ssh -i <em>Keyname</em>.pem   ec2-user@<em>example.aws.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_a_Finish_Template_for_Amazon_EC2_ec2-provisioning"><a class="anchor" href="#Configuring_a_Finish_Template_for_Amazon_EC2_ec2-provisioning"></a>15.10. Configuring a finish template for an Amazon Web Service EC2 environment</h3>
<div class="paragraph">
<p>You can use orcharhino finish templates during the provisioning of Linux instances in an Amazon EC2 environment.</p>
</div>
<div class="paragraph">
<p>If you want to use a Finish template with SSH, orcharhino must reside within the EC2 environment and in the correct security group.
orcharhino currently performs SSH finish provisioning directly, not using orcharhino&#160;Proxy.
If orcharhino&#160;Server does not reside within EC2, the EC2 virtual machine reports an internal IP rather than the necessary external IP with which it can be reached.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>In the <strong>Provisioning Templates</strong> page, enter <code>Kickstart default finish</code> into the search field and click <strong>Search</strong>.</p>
</li>
<li>
<p>On the <strong>Kickstart default finish</strong> template, select <strong>Clone</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a unique name for the template.</p>
</li>
<li>
<p>In the template, prefix each command that requires root privileges with <code>sudo</code>, except for <code>yum</code> or equivalent commands, or add the following line to run the entire template as the <code>sudo</code> user:</p>
<div class="listingblock">
<div class="content">
<pre>sudo -s &lt;&lt; EOS
_Template_ _Body_
EOS</pre>
</div>
</div>
</li>
<li>
<p>Click the <strong>Association</strong> tab, and associate the template with a Red&#160;Hat Enterprise Linux operating system that you want to use.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and add the the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and add the organization that the host belongs to.</p>
</li>
<li>
<p>Make any additional customizations or changes that you require, then click <strong>Submit</strong> to save your template.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and select the operating system that you want for your host.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab, and from the <strong>Finish Template</strong> list, select your finish template.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and navigate to <strong>Host parameters</strong>.</p>
</li>
<li>
<p>In <strong>Host parameters</strong>, click <strong>Add Parameter</strong> two times to add two new parameter fields.
Add the following parameters:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter <code>activation_keys</code>.
In the corresponding <strong>Value</strong> field, enter your activation key.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter <code>remote_execution_ssh_user</code>.
In the corresponding <strong>Value</strong> field, enter <code>ec2-user</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_Virtual_Machine_on_Amazon_EC2_ec2-provisioning"><a class="anchor" href="#Deleting_a_Virtual_Machine_on_Amazon_EC2_ec2-provisioning"></a>15.11. Deleting a virtual machine on Amazon EC2</h3>
<div class="paragraph">
<p>You can delete virtual machines running on Amazon EC2 from within orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Amazon EC2 provider.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Delete</strong> from the <strong>Actions</strong> menu.
This deletes the virtual machine from the Amazon EC2 compute resource while retaining any associated hosts within orcharhino.
If you want to delete an orphaned host, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and delete the host manually.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Uninstalling_Amazon_EC2_plugin_ec2-provisioning"><a class="anchor" href="#Uninstalling_Amazon_EC2_plugin_ec2-provisioning"></a>15.12. Uninstalling Amazon EC2 plugin</h3>
<div class="paragraph">
<p>If you have previously installed the Amazon EC2 plugin but do not use it anymore to manage and deploy hosts to EC2, you can uninstall it from your orcharhino&#160;Server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Uninstall the EC2 compute resource provider from your orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf remove foreman-ec2
# foreman-installer --no-enable-foreman-compute-ec2</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the orcharhino management UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong> and select the <strong>Available Providers</strong> tab to verify the removal of the Amazon EC2 plugin.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="More_Information_About_Amazon_Web_Services_ec2-provisioning"><a class="anchor" href="#More_Information_About_Amazon_Web_Services_ec2-provisioning"></a>15.13. More information about Amazon Web Services and orcharhino</h3>
<div class="paragraph">
<p>For information about how to install and use the Amazon Web Service Client on Linux, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/awscli-install-linux.html">Install the AWS Command Line Interface on Linux</a> in the Amazon Web Services documentation.</p>
</div>
<div class="paragraph">
<p>For information about importing and exporting virtual machines in Amazon Web Services, see <a href="https://aws.amazon.com/ec2/vm-import/">VM Import/Export</a> in the Amazon Web Services documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Cloud_Instances_on_Google_Compute_Engine_gce-provisioning"><a class="anchor" href="#Provisioning_Cloud_Instances_on_Google_Compute_Engine_gce-provisioning"></a>16. Provisioning cloud instances on Google Compute Engine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>orcharhino can interact with Google Compute Engine (GCE), including creating new virtual machines and controlling their power management states.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure a domain and subnet on orcharhino.
For more information about networking requirements, see <a href="#Configuring_Networking_provisioning">Configuring networking</a>.</p>
</li>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Provide an activation key for host registration.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Creating_an_Activation_Key_content-management">Creating An Activation Key</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>In your GCE project, configure a service account with the necessary IAM Compute role.
For more information, see <a href="https://cloud.google.com/compute/docs/access/iam">Compute Engine IAM roles</a> in the GCE documentation.</p>
</li>
<li>
<p>In your GCE project-wise metadata, set the <code>enable-oslogin</code> to <code>FALSE</code>.
For more information, see <a href="https://cloud.google.com/compute/docs/instances/managing-instance-access#enable_oslogin">Enabling or disabling OS Login</a> in the GCE documentation.</p>
</li>
<li>
<p>Optional: If you want to use Puppet with GCE hosts, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Puppet</strong> and enable the <code>Use UUID for certificates</code> setting to configure Puppet to use consistent Puppet certificate IDs.</p>
</li>
<li>
<p>Based on your needs, associate a <code>finish</code> or <code>user_data</code> provisioning template with the operating system you want to use.
For more information, see <a href="https://docs.theforeman.org/3.9/Provisioning_Hosts/index-orcharhino.html#provisioning-templates_provisioning">Provisioning Templates</a> in <em>Provisioning hosts</em>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="Installing_Google_GCE_plugin_gce-provisioning"><a class="anchor" href="#Installing_Google_GCE_plugin_gce-provisioning"></a>16.1. Installing Google GCE plugin</h3>
<div class="paragraph">
<p>Install the Google GCE plugin to attach an GCE compute resource provider to orcharhino.
This allows you to manage and deploy hosts to GCE.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the Google GCE compute resource provider on your orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-cli-google \
--enable-foreman-plugin-google</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the orcharhino management UI, navigate to <strong>Administer &gt; About</strong> and select the <strong>Compute Resources</strong> tab to verify the installation of the Google GCE plugin.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Google_GCE_Connection_gce-provisioning"><a class="anchor" href="#Adding_a_Google_GCE_Connection_gce-provisioning"></a>16.2. Adding a Google GCE connection to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>Use this procedure to add Google Compute Engine (GCE) as a compute resource in orcharhino.
To use the CLI instead of the orcharhino management UI, see the <a href="#cli-Adding_a_Google_GCE_Connection_gce-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Google GCE, generate a service account key in JSON format.
For more information, see <a href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys">Create and manage service account keys</a> in the GCE documentation.</p>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>Google</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, enter a description for the resource.</p>
</li>
<li>
<p>In the <strong>JSON key</strong> field, click <strong>Choose File</strong> and locate your service account key for upload from your local machine.</p>
</li>
<li>
<p>Click <strong>Load Zones</strong> to populate the list of zones from your GCE environment.</p>
</li>
<li>
<p>From the <strong>Zone</strong> list, select the GCE zone to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div id="cli-Adding_a_Google_GCE_Connection_gce-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>In Google GCE, generate a service account key in JSON format.
For more information, see <a href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys">Create and manage service account keys</a> in the GCE documentation.</p>
</li>
<li>
<p>Copy the file from your local machine to orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp <em>My_GCE_Key</em>.json root@orcharhino.example.com:/etc/foreman/<em>My_GCE_Key</em>.json</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Server, change the owner for your service account key to the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown root:foreman /etc/foreman/<em>My_GCE_Key</em>.json</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Server, configure permissions for your service account key to ensure that the file is readable:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 0640 /etc/foreman/<em>My_GCE_Key</em>.json</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Server, restore SELinux context for your service account key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -vv /etc/foreman/<em>My_GCE_Key</em>.json</pre>
</div>
</div>
</li>
<li>
<p>Use the <code>hammer compute-resource create</code> command to add a GCE compute resource to orcharhino:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create \
--key-path "/etc/foreman/<em>My_GCE_Key</em>.json" \
--name "<em>My_GCE_Compute_Resource</em>" \
--provider "gce" \
--zone "<em>My_Zone</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-images-to-server_gce-provisioning"><a class="anchor" href="#adding-images-to-server_gce-provisioning"></a>16.3. Adding Google Compute Engine images to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>To create hosts using image-based provisioning, you must add information about the image, such as access details and the image location, to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-images-to-server_gce-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click the name of the Google Compute Engine connection.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
Specify a user other than <code>root</code>, because the <code>root</code> user cannot connect to a GCE instance using SSH keys. The username must begin with a letter and consist of lowercase letters and numbers.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select an image from the Google Compute Engine compute resource.</p>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the image supports user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-images-to-server_gce-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
With the <code>--username</code> option, specify a user other than <code>root</code>, because the <code>root</code> user cannot connect to a GCE instance using SSH keys.
The username must begin with a letter and consist of lowercase letters and numbers.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create \
--name '<em>gce_image_name</em>' \
--compute-resource '<em>gce_cr</em>' \
--operatingsystem-id 1 \
--architecture-id 1 \
--uuid '<em>3780108136525169178</em>' \
--username '<em>admin</em>'</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Google_GCE_Details_to_a_Compute_Profile_gce-provisioning"><a class="anchor" href="#Adding_Google_GCE_Details_to_a_Compute_Profile_gce-provisioning"></a>16.4. Adding Google GCE details to a compute profile</h3>
<div class="paragraph">
<p>Use this procedure to add Google GCE hardware settings to a compute profile.
When you create a host on Google GCE using this compute profile, these settings are automatically populated.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-Adding_Google_GCE_Details_to_a_Compute_Profile_gce-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>In the Compute Profiles window, click the name of an existing compute profile, or click <strong>Create Compute Profile</strong>, enter a <strong>Name</strong>, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the GCE compute resource.</p>
</li>
<li>
<p>From the <strong>Machine Type</strong> list, select the machine type to use for provisioning.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use for provisioning.</p>
</li>
<li>
<p>From the <strong>Network</strong> list, select the Google GCE network to use for provisioning.</p>
</li>
<li>
<p>Optional: Select the <strong>Associate Ephemeral External IP</strong> checkbox to assign a dynamic ephemeral IP address that orcharhino uses to communicate with the host.
This public IP address changes when you reboot the host.
If you need a permanent IP address, reserve a static public IP address on Google GCE and attach it to the host.</p>
</li>
<li>
<p>In the <strong>Size (GB)</strong> field, enter the size of the storage to create on the host.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div id="cli-Adding_Google_GCE_Details_to_a_Compute_Profile_gce-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a compute profile to use with the Google GCE compute resource:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile create --name <em>My_GCE_Compute_Profile</em></pre>
</div>
</div>
</li>
<li>
<p>Add GCE details to the compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile values create \
--compute-attributes "machine_type=f1-micro,associate_external_ip=true,network=default" \
--compute-profile "<em>My_GCE_Compute_Profile</em>" \
--compute-resource "<em>My_GCE_Compute_Resource</em>" \
--volume "<em>size_gb=20</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-image-only-hosts_gce-provisioning"><a class="anchor" href="#creating-image-only-hosts_gce-provisioning"></a>16.5. Creating image-based hosts on Google Compute Engine</h3>
<div class="paragraph">
<p>In orcharhino, you can use Google Compute Engine provisioning to create hosts from an existing image.
The new host entry triggers the Google Compute Engine server to create the instance using the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-image-only-hosts_gce-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the Google Compute Engine connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine settings.</p>
</li>
<li>
<p>From the <strong>Lifecycle Environment</strong> list, select the environment.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
Google Compute Engine assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>The <strong>Domain</strong> field is populated with the required domain.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div id="cli-creating-image-only-hosts_gce-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--architecture <em>x86_64</em> \
--compute-profile "<em>My_Compute_Profile</em>" \
--compute-resource "<em>My_Compute_Resource</em>" \
--image "<em>My_GCE_Image</em>" \
--interface "type=interface,domain_id=1,managed=true,primary=true,provision=true" \
--location "<em>My_Location</em>" \
--name "<em>My_Host_Name</em>" \
--operatingsystem "<em>My_Operating_System</em>" \
--organization "<em>My_Organization</em>" \
--provision-method "image" \
--puppet-ca-proxy-id <em>My_Puppet_CA_Proxy_ID</em> \
--puppet-environment-id <em>My_Puppet_Environment_ID</em> \
--puppet-proxy-id <em>My_Puppet_Proxy_ID</em> \
--root-password "<em>My_Root_Password</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_VM_on_Google_GCE_gce-provisioning"><a class="anchor" href="#Deleting_a_VM_on_Google_GCE_gce-provisioning"></a>16.6. Deleting a VM on Google GCE</h3>
<div class="paragraph">
<p>You can delete VMs running on Google GCE on your orcharhino&#160;Server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure &gt; Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Google GCE provider.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Delete</strong> from the <strong>Actions</strong> menu.
This deletes the virtual machine from the Google GCE compute resource while retaining any associated hosts within orcharhino.
If you want to delete the orphaned host, navigate to <strong>Hosts &gt; All Hosts</strong> and delete the host manually.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Cloud_Instances_on_Microsoft_Azure_Resource_Manager_azure-provisioning"><a class="anchor" href="#Provisioning_Cloud_Instances_on_Microsoft_Azure_Resource_Manager_azure-provisioning"></a>17. Provisioning cloud instances on Microsoft Azure Resource Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>orcharhino can interact with Microsoft Azure Resource Manager, including creating new virtual machines and controlling their power management states.
Only image-based provisioning is supported for creating Azure hosts.
This includes provisioning using Marketplace images, custom images, and shared image gallery.</p>
</div>
<div class="paragraph">
<p>For more information about Azure Resource Manager concepts, see <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/">Azure Resource Manager documentation</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Synchronizing_Repositories_content-management">Syncing Repositories</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Provide an activation key for host registration.
For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Content/index-orcharhino.html#Creating_an_Activation_Key_content-management">Creating An Activation Key</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>Ensure that you have the correct permissions to create an Azure Active Directory application.
For more information, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#required-permissions">Check Azure AD permissions</a> in the <em>Microsoft identity platform (Azure Active Directory for developers)</em> documentation.</p>
</li>
<li>
<p>You must create and configure an Azure Active Directory application and service principle to obtain Application or <em>client</em> ID, Directory or <em>tenant</em> ID, and Client Secret.
For more information, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal">Use the portal to create an Azure AD application and service principal that can access resources</a> in the <em>Microsoft identity platform (Azure Active Directory for developers)</em> documentation.</p>
</li>
<li>
<p>Optional: If you want to use Puppet with Azure hosts, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Puppet</strong> and enable the <code>Use UUID for certificates</code> setting to configure Puppet to use consistent Puppet certificate IDs.</p>
</li>
<li>
<p>Based on your needs, associate a <code>finish</code> or <code>user_data</code> provisioning template with the operating system you want to use.
For more information about provisioning templates, see <a href="https://docs.theforeman.org/3.9/Provisioning_Hosts/index-orcharhino.html#provisioning-templates_provisioning">Provisioning Templates</a>.</p>
</li>
<li>
<p>Optional: If you want the virtual machine to use a static private IP address, create a subnet in orcharhino with the <strong>Network Address</strong> field matching the Azure subnet address.</p>
</li>
<li>
<p>Before creating RHEL BYOS images, you must accept the image terms either in the Azure CLI or Portal so that the image can be used to create and manage virtual machines for your subscription.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="Installing_Microsoft_Azure_plugin_azure-provisioning"><a class="anchor" href="#Installing_Microsoft_Azure_plugin_azure-provisioning"></a>17.1. Installing Microsoft Azure plugin</h3>
<div class="paragraph">
<p>Install the Microsoft Azure plugin to attach an Azure compute resource provider to orcharhino.
This allows you to manage and deploy hosts to Azure.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the Azure compute resource provider on your orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-azure</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the orcharhino management UI, navigate to <strong>Administer &gt; About</strong> and select the <em>compute resources</em> tab to verify the installation of the Microsoft Azure plugin.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Microsoft_Azure_Resource_Manager_Connection_azure-provisioning"><a class="anchor" href="#Adding_a_Microsoft_Azure_Resource_Manager_Connection_azure-provisioning"></a>17.2. Adding a Microsoft Azure Resource Manager connection to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>Use this procedure to add Microsoft Azure as a compute resource in orcharhino.
Note that you must add a separate compute resource for each Microsoft Azure region that you want to use.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-Adding_a_Microsoft_Azure_Resource_Manager_Connection_azure-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>Azure Resource Manager</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, enter a description for the resource.</p>
</li>
<li>
<p>By default, the <strong>Cloud</strong> is set to Public/Standard.
Azure Government Cloud supports the following regions:</p>
<div class="ulist">
<ul>
<li>
<p>US Government</p>
</li>
<li>
<p>China</p>
</li>
<li>
<p>Germany</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Client ID</strong> field, enter your Application or <em>client</em> ID.</p>
</li>
<li>
<p>In the <strong>Client Secret</strong> field, enter your client secret.</p>
</li>
<li>
<p>In the <strong>Subscription ID</strong> field, enter your subscription ID.</p>
</li>
<li>
<p>In the <strong>Tenant ID</strong> field, enter your Directory or <em>tenant</em> ID.</p>
</li>
<li>
<p>Click <strong>Load Regions</strong>.
This tests if your connection to Azure Resource Manager is successful and loads the regions available in your subscription.</p>
</li>
<li>
<p>From the <strong>Azure Region</strong> list, select the Azure region to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div id="cli-Adding_a_Microsoft_Azure_Resource_Manager_Connection_azure-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Use <code>hammer compute-resource create</code> to add an Azure compute resource to orcharhino.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create \
--app-ident <em>My_Client_ID</em> \
--name <em>My_Compute_Resource_Name</em> \
--provider azurerm \
--region "<em>My_Region</em>" \
--secret-key <em>My_Client_Secret</em> \
--sub-id <em>My_Subscription_ID</em> \
--tenant <em>My_Tenant_ID</em></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the value for the <code>--region</code> option must be in lowercase and must not contain special characters.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If you are using Azure Government Cloud then you must pass in the <code>--cloud</code> parameter.
The values for the <code>cloud</code> parameter are:
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name of Azure Government Cloud</th>
<th class="tableblock halign-left valign-top">Value for hammer --cloud</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">US Government</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">azureusgovernment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">China</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">azurechina</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Germany</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">azuregermancloud</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="adding-images-to-server_azure-provisioning"><a class="anchor" href="#adding-images-to-server_azure-provisioning"></a>17.3. Adding Microsoft Azure Resource Manager images to orcharhino&#160;Server</h3>
<div class="paragraph">
<p>To create hosts using image-based provisioning, you must add information about the image, such as access details and the image location, to your orcharhino&#160;Server.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-adding-images-to-server_azure-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click the name of the Microsoft Azure Resource Manager connection.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
You cannot use the <code>root</code> user.</p>
</li>
<li>
<p>Optional: In the <strong>Password</strong> field, enter a password to authenticate with.</p>
</li>
<li>
<p>In the <strong>Azure Image Name</strong> field, enter an image name in the format <code><em>prefix://UUID</em></code>.</p>
<div class="ulist">
<ul>
<li>
<p>For a custom image, use the prefix <code>custom</code>.
For example, <strong>custom://image-name</strong>.</p>
</li>
<li>
<p>For a shared gallery image, use the prefix <code>gallery</code>.
For example, <strong>gallery://image-name</strong>.</p>
</li>
<li>
<p>For public and RHEL Bring Your Own Subscription (BYOS) images, use the prefix <code>marketplace</code>.
For example, <strong>marketplace://OpenLogicCentOS:7.5:latest</strong>.</p>
<div class="paragraph">
<p>For more information, see <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/cli-ps-findimage">Find Linux VM images in the Azure Marketplace with the Azure CLI</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the image supports user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-images-to-server_azure-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Note that the username that you enter for the image must be the same that you use when you create a host with this image.
The <code>--password</code> option is optional when creating an image.
You cannot use the <code>root</code> user.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create \
--name <em>Azure_image_name</em> \
--compute-resource <em>azure_cr_name</em> \
--uuid '<em>marketplace://RedHat:RHEL:7-RAW:latest</em>' \
--username '<em>azure_username</em>' \
--user-data <em>no</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Microsoft_Azure_Resource_Manager_Details_to_a_Compute_Profile_azure-provisioning"><a class="anchor" href="#Adding_Microsoft_Azure_Resource_Manager_Details_to_a_Compute_Profile_azure-provisioning"></a>17.4. Adding Microsoft Azure Resource Manager details to a compute profile</h3>
<div class="paragraph">
<p>Use this procedure to add Microsoft Azure hardware settings to a compute profile.
When you create a host on Microsoft Azure using this compute profile, these settings are automatically populated.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-Adding_Microsoft_Azure_Resource_Manager_Details_to_a_Compute_Profile_azure-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>In the Compute Profiles window, click the name of an existing compute profile, or click <strong>Create Compute Profile</strong>, enter a <strong>Name</strong>, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the Azure compute resource.</p>
</li>
<li>
<p>From the <strong>Resource group</strong> list, select the resource group to provision to.</p>
</li>
<li>
<p>From the <strong>VM Size</strong> list, select a size of a virtual machine to provision.</p>
</li>
<li>
<p>From the <strong>Platform</strong> list, select <strong>Linux</strong>.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter a user name to authenticate with.
Note that the username that you enter for compute profile must be the same that you use when creating an image.</p>
</li>
<li>
<p>To authenticate the user, use one of the following options:</p>
<div class="ulist">
<ul>
<li>
<p>To authenticate using a password, enter a password in the <strong>Password</strong> field.</p>
</li>
<li>
<p>To authenticate using an SSH key, enter an SSH key in the <strong>SSH Key</strong> field.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: If you want the virtual machine to use a premium virtual machine disk, select the <strong>Premium OS Disk</strong> checkbox.</p>
</li>
<li>
<p>From the <strong>OS Disk Caching</strong> list, select the disc caching setting.</p>
</li>
<li>
<p>Optional: In the <strong>Custom Script Command</strong> field, enter commands to perform on the virtual machine when the virtual machine is provisioned.</p>
</li>
<li>
<p>Optional: If you want to run custom scripts when provisioning finishes, in the <strong>Comma separated file URIs</strong> field, enter comma-separated file URIs of scripts to use.
The scripts must contain <code>sudo</code> at the beginning because orcharhino downloads files to the <code>/var/lib/waagent/custom-script/download/0/</code> directory on the host and scripts require sudo privileges to be executed.</p>
</li>
<li>
<p>Optional: You can add a <strong>NVIDIA Driver</strong> by selecting the <strong>NVIDIA driver / CUDA</strong> checkbox.
For more information, refer to the following Microsoft Azure documentation:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/hpccompute-gpu-linux">NVIDIA GPU Driver Extension for Linux</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/hpccompute-gpu-windows">NVIDIA GPU Driver Extension for Windows</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: If you want to create an additional volume on the VM, click the <strong>Add Volume</strong> button, enter the <strong>Size</strong> in GB and select the <strong>Data Disk Caching</strong> method.</p>
<div class="ulist">
<ul>
<li>
<p>Note that the maximum number of these disks depends on the VM Size selected.
For more information on Microsoft Azure VM storage requirements, see the <a href="https://docs.microsoft.com/en-us/azure/virtual-machines">Microsoft Azure documentation</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Add Interface</strong>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The maximum number of interfaces depends on the VM Size selected.
For more information, see the Microsoft Azure documentation link above.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>From the <strong>Azure Subnet</strong> list, select the Azure subnet to provision to.</p>
</li>
<li>
<p>From the <strong>Public IP</strong> list, select the public IP setting.</p>
</li>
<li>
<p>Optional: If you want the virtual machine to use a static private IP, select the <strong>Static Private IP</strong> checkbox.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div id="cli-Adding_Microsoft_Azure_Resource_Manager_Details_to_a_Compute_Profile_azure-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a compute profile to use with the Azure Resource Manager compute resource:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile create --name <em>compute_profile_name</em></pre>
</div>
</div>
</li>
<li>
<p>Add Azure details to the compute profile.
With the <code>username</code> setting, enter the SSH user name for image access.
Note that the username that you enter for compute profile must be the same that you use when creating an image.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-profile values create \
--compute-attributes="resource_group=<em>resource_group</em>,vm_size=<em>Standard_B1s</em>,username=<em>azure_user</em>,password=<em>azure_password</em>,platform=Linux,script_command=touch /var/tmp/text.txt" \
--compute-profile "<em>compute_profile_name</em>" \
--compute-resource <em>azure_cr_name</em> \
--interface="compute_public_ip=Dynamic,compute_network=mysubnetID,compute_private_ip=false" \
--volume="disk_size_gb=<em>5</em>,data_disk_caching=<em>None</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>Optional: If you want to run scripts on the virtual machine after provisioning, specify the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To enter the script directly, with the <code>script_command</code> setting, enter a command to be executed on the provisioned virtual machine.</p>
</li>
<li>
<p>To run a script from a URI, with the <code>script_uris</code> setting, enter comma-separated file URIs of scripts to use.
The scripts must contain <code>sudo</code> at the beginning because orcharhino downloads files to the <code>/var/lib/waagent/custom-script/download/0/</code> directory on the host and therefore scripts require sudo privileges to be executed.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-image-only-hosts_azure-provisioning"><a class="anchor" href="#creating-image-only-hosts_azure-provisioning"></a>17.5. Creating image-based hosts on Microsoft Azure Resource Manager</h3>
<div class="paragraph">
<p>In orcharhino, you can use Microsoft Azure Resource Manager provisioning to create hosts from an existing image.
The new host entry triggers the Microsoft Azure Resource Manager server to create the instance using the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the orcharhino management UI, see the <a href="#cli-creating-image-only-hosts_azure-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the Microsoft Azure Resource Manager connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine settings.</p>
</li>
<li>
<p>From the <strong>Lifecycle Environment</strong> list, select the environment.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>orcharhino automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
Microsoft Azure Resource Manager assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>The <strong>Azure Subnet</strong> field is populated with the required Azure subnet.</p>
</li>
<li>
<p>Optional: If you want to use a static private IP address, from the <strong>IPv4 Subnet</strong> list select the orcharhino subnet with the <strong>Network Address</strong> field matching the Azure subnet address.
In the <strong>IPv4 Address</strong> field, enter an IPv4 address within the range of your Azure subnet.</p>
</li>
<li>
<p>Ensure that orcharhino automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>For <strong>Provisioning Method</strong>, ensure <strong>Image Based</strong> is selected.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the Azure Resource Manager image that you want to use for provisioning.</p>
</li>
<li>
<p>In the <strong>Root Password</strong> field, enter the root password to authenticate with.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>On the <strong>Parameters</strong> tab, click <strong>Add parameter</strong>.
Add a parameter named <code>kt_activation_keys</code>, select the <strong>string</strong> type, and enter the name of the activation key as the value.
The activation key has to belong to the same organization as your host.
You can also enter a comma-separated list of multiple activation keys.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div id="cli-creating-image-only-hosts_azure-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create \
--architecture <em>x86_64</em> \
--compute-profile "<em>My_Compute_Profile</em>" \
--compute-resource "<em>My_Compute_Resource</em>" \
--domain "<em>My_Domain</em>" \
--image "<em>My_Azure_Image</em>" \
--location "<em>My_Location</em>" \
--name "<em>My_Host_Name</em>" \
--operatingsystem "<em>My_Operating_System</em>" \
--organization "<em>My_Organization</em>" \
--provision-method "image"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_VM_on_Microsoft_Azure_azure-provisioning"><a class="anchor" href="#Deleting_a_VM_on_Microsoft_Azure_azure-provisioning"></a>17.6. Deleting a VM on Microsoft Azure</h3>
<div class="paragraph">
<p>You can delete VMs running on Microsoft Azure from within orcharhino.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure &gt; Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Microsoft Azure provider.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Delete</strong> from the <strong>Actions</strong> menu.
This deletes the virtual machine from the Microsoft Azure compute resource while retaining any associated hosts within orcharhino.
If you want to delete the orphaned host, navigate to <strong>Hosts &gt; All Hosts</strong> and delete the host manually.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Uninstalling_Microsoft_Azure_plugin_azure-provisioning"><a class="anchor" href="#Uninstalling_Microsoft_Azure_plugin_azure-provisioning"></a>17.7. Uninstalling Microsoft Azure plugin</h3>
<div class="paragraph">
<p>If you have previously installed the Microsoft Azure plugin but don&#8217;t use it anymore to manage and deploy hosts to Azure, you can uninstall it from your orcharhino&#160;Server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Uninstall the Azure compute resource provider from your orcharhino&#160;Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf remove rubygem-foreman_azure_rm rubygem-ms_rest_azure
# foreman-installer --no-enable-foreman-plugin-azure</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the orcharhino management UI, navigate to <strong>Administer &gt; About</strong> and select the <strong>Available Providers</strong> tab to verify the removal of the Microsoft Azure plugin.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_FIPS_Compliant_Hosts_provisioning"><a class="anchor" href="#Provisioning_FIPS_Compliant_Hosts_provisioning"></a>Appendix A: Provisioning FIPS-compliant hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>orcharhino supports provisioning hosts that comply with the National Institute of Standards and Technology&#8217;s <a href="https://csrc.nist.gov/publications/detail/fips/140/2/final">Security Requirements for Cryptographic Modules</a> standard, reference number FIPS 140-2, referred to here as FIPS.</p>
</div>
<div class="paragraph">
<p>To enable the provisioning of hosts that are FIPS-compliant, complete the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change the provisioning password hashing algorithm for the operating system</p>
</li>
<li>
<p>Create a host group and set a host group parameter to enable FIPS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.theforeman.org/3.9/Managing_Hosts/index-orcharhino.html#Creating_a_Host_Group_managing-hosts">Creating a Host Group</a> in <em>Managing hosts</em>.</p>
</div>
<div class="paragraph">
<p>The provisioned hosts have the FIPS-compliant settings applied.
To confirm that these settings are enabled, complete the steps in <a href="#Verifying_FIPS_Mode_Is_Enabled_provisioning">Verifying FIPS mode is enabled</a>.</p>
</div>
<div class="sect2">
<h3 id="Changing_the_Provisioning_Password_Hashing_Algorithm_provisioning"><a class="anchor" href="#Changing_the_Provisioning_Password_Hashing_Algorithm_provisioning"></a>A.1. Changing the provisioning password hashing algorithm</h3>
<div class="paragraph">
<p>To provision FIPS-compliant hosts, you must first set the password hashing algorithm that you use in provisioning to SHA256.
This configuration setting must be applied for each operating system you want to deploy as FIPS-compliant.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify the Operating System IDs:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer os list</pre>
</div>
</div>
</li>
<li>
<p>Update each operating system&#8217;s password hash value.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer os update \
--password-hash SHA256
--title "<em>My_Operating_System</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>Note that you cannot use a comma-separated list of values.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Setting_the_FIPS_Enabled_Parameter_provisioning"><a class="anchor" href="#Setting_the_FIPS_Enabled_Parameter_provisioning"></a>A.2. Setting the FIPS-enabled parameter</h3>
<div class="paragraph">
<p>To provision a FIPS-compliant host, you must create a host group and set the host group parameter <code>fips_enabled</code> to <code>true</code>.
If this is not set to <code>true</code>, or is absent, the FIPS-specific changes do not apply to the system.
You can set this parameter when you provision a host or for a host group.</p>
</div>
<div class="paragraph">
<p>To set this parameter when provisioning a host, append <code>--parameters fips_enabled=true</code> to the Hammer command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer hostgroup set-parameter \
--hostgroup "<em>My_Host_Group</em>" \
--name fips_enabled \
--value "true"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the output of the command <code>hammer hostgroup set-parameter --help</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Verifying_FIPS_Mode_Is_Enabled_provisioning"><a class="anchor" href="#Verifying_FIPS_Mode_Is_Enabled_provisioning"></a>A.3. Verifying FIPS mode is enabled</h3>
<div class="paragraph">
<p>To verify these FIPS compliance changes have been successful, you must provision a host and check its configuration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the host as <code>root</code> or with an admin-level account.</p>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ cat /proc/sys/crypto/fips_enabled</pre>
</div>
</div>
<div class="paragraph">
<p>A value of <code>1</code> confirms that FIPS mode is enabled.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Host_Parameter_Hierarchy_provisioning"><a class="anchor" href="#Host_Parameter_Hierarchy_provisioning"></a>Appendix B: Host parameter hierarchy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can access host parameters when provisioning hosts.
Hosts inherit their parameters from the following locations, in order of increasing precedence:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter Level</th>
<th class="tableblock halign-left valign-top">Set in orcharhino management UI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Globally defined parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Configure</strong> &gt; <strong>Global parameters</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Administer</strong> &gt; <strong>Organizations</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Administer</strong> &gt; <strong>Locations</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Infrastructure</strong> &gt; <strong>Domains</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subnet-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Infrastructure</strong> &gt; <strong>Subnets</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating system-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host group-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Configure</strong> &gt; <strong>Host Groups</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts</strong> &gt; <strong>All Hosts</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="permissions-required-to-provision-hosts_provisioning"><a class="anchor" href="#permissions-required-to-provision-hosts_provisioning"></a>Appendix C: Permissions required to provision hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following list provides an overview of the permissions a non-admin user requires to provision hosts.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource name</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Additional details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activation Keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_activation_keys</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ansible role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_ansible_roles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if Ansible is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Architecture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_architectures</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_compute_profiles</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Compute resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_compute_resources, create_compute_resources, destroy_compute_resources, power_compute_resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required to provision bare-metal hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_compute_resources_vms, create_compute_resources_vms, destroy_compute_resources_vms, power_compute_resources_vms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required to provision virtual machines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Views</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_content_views</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_domains</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_environments</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_hosts, create_hosts, edit_hosts, destroy_hosts, build_hosts, power_hosts, play_roles_on_host</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_discovered_hosts, submit_discovered_hosts, auto_provision_discovered_hosts, provision_discovered_hosts, edit_discovered_hosts, destroy_discovered_hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if the Discovery service is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostgroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_hostgroups, create_hostgroups, edit_hostgroups, play_roles_on_hostgroup</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_images</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lifecycle environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_lifecycle_environments</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_locations</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medium</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_media</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operatingsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_operatingsystems</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_organizations</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_params, create_params, edit_params, destroy_params</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Product and Repositories</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_products</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provisioning template</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_provisioning_templates</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ptable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_ptables</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">orcharhino&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_smart_proxies, view_smart_proxies_puppetca</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_openscap_proxies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if the OpenSCAP plugin is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_subnets</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/3.9/Administering_Project/index-orcharhino.html#Creating_a_Role_admin">Creating a Role</a> in <em>Administering orcharhino</em></p>
</li>
<li>
<p><a href="https://docs.theforeman.org/3.9/Administering_Project/index-orcharhino.html#Adding_Permissions_to_a_Role_admin">Adding Permissions to a Role</a> in <em>Administering orcharhino</em></p>
</li>
<li>
<p><a href="https://docs.theforeman.org/3.9/Administering_Project/index-orcharhino.html#Assigning_Roles_to_a_User_admin">Assigning Roles to a User</a> in <em>Administering orcharhino</em></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. NetworkManager expects <code>;</code> as a list separator but currently also accepts <code>,</code>. For more information, see <code>man nm-settings-keyfile</code> and <a href="https://www.gnu.org/software/grub/manual/grub/grub.html#Shell_002dlike-scripting">Shell-like scripting in GRUB</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 6.6 (unsupported)<br>
Last updated Oct 2025
</div>
</div>
</body>
</html>