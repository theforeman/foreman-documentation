<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.25">
<title>Installing Foreman&#160;Server with Katello 4.13 plugin on Enterprise Linux</title>
<style>
﻿*,::before,::after{box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:100%}body{background:#fff;color:rgba(0,0,0,0.8);padding:0;margin:0;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:inherit;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,p,blockquote,th,td{margin:0;padding:0}a{background:none;color:#2156a5;text-decoration:underline;line-height:inherit}a:active,a:hover{cursor:pointer;outline:0}a:focus{outline:thin dotted}a:hover,a:focus{color:#1d4b8f}abbr{font-size:0.9em}abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}b,strong{font-weight:bold;line-height:inherit}strong strong{font-weight:400}code,kbd,pre{font-family:"Droid Sans Mono", "DejaVu Sans Mono", monospace;font-size:1em}code{font-weight:400;color:rgba(0,0,0,0.9)}pre{color:rgba(0,0,0,0.9);line-height:1.45;text-rendering:optimizeSpeed;white-space:pre-wrap}dfn{font-style:italic}em,i{font-style:italic;line-height:inherit}em em{font-style:normal}hr{border:solid #dddddf;border-width:1px 0 0;clear:both;height:0;margin:1.25em 0 1.1875em}mark{background:#ff0;color:#000}p{line-height:1.6;margin-bottom:1.25rem;text-rendering:optimizeLegibility}q{quotes:"“" "”" "‘" "’"}small{font-size:60%;line-height:inherit}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img,object[type^="image/"],svg{display:inline-block;height:auto;max-width:100%;vertical-align:middle}img{border:0;-ms-interpolation-mode:bicubic}object{max-width:100%}svg:not(:root){overflow:hidden}figure{margin:0}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}.left{float:left !important}.right{float:right !important}.text-left{text-align:left !important}.text-right{text-align:right !important}.text-center{text-align:center !important}.text-justify{text-align:justify !important}.hide{display:none}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:0.25em}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.2;word-spacing:-0.05em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em;margin-left:1.125em}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,0.85)}@media screen and (min-width: 768px){h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;border:1px solid #dedede;border-collapse:collapse;border-spacing:0;margin-bottom:1.25em;word-wrap:normal}table thead,table tfoot{background:#f7f8f7}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,0.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,0.8)}table tr.even,table tr.alt{background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.center{margin-left:auto;margin-right:auto}.stretch{width:100%}.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:"";display:table}.clearfix::after,.float-group::after{clear:both}:not(pre).nobreak{word-wrap:normal}:not(pre).nowrap{white-space:nowrap}:not(pre).pre-wrap{white-space:pre-wrap}:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal !important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}pre>code{display:block}pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}.keyseq{color:rgba(51,51,51,0.8)}kbd{display:inline-block;color:rgba(0,0,0,0.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,0.2),inset 0 0 0 0.1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menuref{color:#000}.menuseq b:not(.caret),.menuref{font-weight:inherit}.menuseq{word-spacing:-0.02em}.menuseq b.caret{font-size:1.25em;line-height:0.8}.menuseq i.caret{font-weight:bold;text-align:center;width:0.45em}b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}b.button::before{content:"[";padding:0 3px 0 2px}b.button::after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,0.9)}body>div[id]{margin:0 auto;max-width:62.5em;position:relative;padding-left:.9375em;padding-right:0.9375em}body>div[id]::before,body>div[id]::after,#content #footnotes::before{content:"";display:table;clear:both}#content{margin-top:1.25em;margin-bottom:0.625em}#content::before{content:none}#header>h1:first-child{color:rgba(0,0,0,0.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,0.6);display:flex;flex-flow:row wrap}#header .details span:first-child{margin-left:-0.125em}#header .details span.email a{color:rgba(0,0,0,0.85)}#header .details br{display:none}#header .details br+span::before{content:" – "}#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,0.85)}#header .details br+span#revremark::before{content:" | "}#header #revnumber{text-transform:capitalize}#header #revnumber::after{content:" "}#content>h1:first-child:not([class]){color:rgba(0,0,0,0.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #e7e7e9;padding-bottom:0.5em}#toc>ul{margin-left:0.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:0.5em 0}#toc ul{font-family:"Open Sans", "DejaVu Sans", sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:0.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media screen and (min-width: 768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0 !important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0 !important;border-bottom-width:0 !important;z-index:1000;padding:1.25em 1em;height:calc(100% - (70px + 2.5em));overflow:auto}#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:0.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}@media screen and (min-width: 1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:0.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:none;background:#025d8c;padding:1.25em;margin-left:2em}#footer-text{color:rgba(255,255,255,0.8);line-height:1.44}h1:before,h2:before,h3:before,h4:before,h5:before,h6:before,div.title:before{display:block;content:" ";height:90px;margin-top:-90px;visibility:hidden}.sect1{padding-bottom:0.625em}@media screen and (min-width: 768px){#content{margin-bottom:1.25em}.sect1{padding-bottom:1.25em}}.sect1:last-child{padding-bottom:0}.sect1+.sect1{border-top:1px solid #e7e7e9}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none !important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:0.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}details{margin-left:1.25rem}details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}details>summary::-webkit-details-marker{display:none}details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:1rem;font-style:italic}table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,0.85)}.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans", "DejaVu Sans", sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,0.6);word-wrap:anywhere}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#fffef7;border-radius:4px;box-shadow:0 1px 4px #e0e0dc}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:0.8125em}@media screen and (min-width: 768px){.literalblock pre,.listingblock>.content>pre{font-size:0.90625em}}@media screen and (min-width: 1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,0.9)}.listingblock>.content{position:relative}.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:0.5}.listingblock:hover code[data-lang]::before{display:block}.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:0.5}.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.prettyprint{background:#f7f7f8}pre.prettyprint .linenums{line-height:1.45;margin-left:2em}pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}pre.prettyprint li code[data-lang]::before{opacity:1}pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}table.linenotable td.code{padding-left:0.75em}table.linenotable td.linenos{width:0.01%}table.linenotable td.linenos,pre.pygments .linenos,pre.rouge .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}pre.pygments span.linenos,pre.rouge span.linenos{display:inline-block;margin-right:0.75em}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:0.75em}.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,0.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,0.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}.verseblock{margin:0 1em 1.25em}.verseblock pre{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-size:1.15rem;color:rgba(0,0,0,0.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:0.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,0.6)}.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}.quoteblock.abstract{margin:0 1em 1.25em;display:block}.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:0.25em solid #dddddf}.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}p.tableblock:last-child{margin-bottom:0}td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}td.tableblock>.content>:last-child{margin-bottom:-1.25em}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all>*>tr>*{border-width:1px}table.grid-cols>*>tr>*{border-width:0 1px}table.grid-rows>*>tr>*{border-width:1px 0}table.frame-all{border-width:1px}table.frame-ends{border-width:1px 0}table.frame-sides{border-width:0 1px}table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,0.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:0.625em}ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:0.625em}ul.unstyled,ol.unstyled{margin-left:0}li>p:empty:only-child::before{content:"";display:inline-block}ul.checklist>li>p:first-child{margin-left:-1em}ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:0.125em}ul.checklist>li>p:first-child>input[type=checkbox]:first-child{font:inherit;margin:0 .25em 0 0;padding:0}ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 0.625em -1.25em}ul.inline>li{margin-left:1.25em}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{vertical-align:top;padding:0 0.625em}td.hdlist1{font-weight:bold;padding-bottom:1.25em}td.hdlist2{word-wrap:anywhere}.literalblock+.colist,.listingblock+.colist{margin-top:-0.5em}.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}.colist td:not([class]):first-child img{max-width:none}.colist td:not([class]):last-child{padding:0.25em 0}.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}.imageblock.left{margin:0.25em 0.625em 1.25em 0}.imageblock.right{margin:0.25em 0 1.25em 0.625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 0.125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:0.625em}.image.right{margin-left:0.625em}a.image{text-decoration:none;display:inline-block}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:0.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:0.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:0.75em 0}div.page-break{display:none}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background:#00fafa}.black{color:#000}.black-background{background:#000}.blue{color:#0000bf}.blue-background{background:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background:#fa00fa}.gray{color:#606060}.gray-background{background:#7d7d7d}.green{color:#006000}.green-background{background:#007d00}.lime{color:#00bf00}.lime-background{background:#00fa00}.maroon{color:#600000}.maroon-background{background:#7d0000}.navy{color:#000060}.navy-background{background:#00007d}.olive{color:#606000}.olive-background{background:#7d7d00}.purple{color:#600060}.purple-background{background:#7d007d}.red{color:#bf0000}.red-background{background:#fa0000}.silver{color:#909090}.silver-background{background:#bcbcbc}.teal{color:#006060}.teal-background{background:#007d7d}.white{color:#bfbfbf}.white-background{background:#fafafa}.yellow{color:#bfbf00}.yellow-background{background:#fafa00}span.icon>.fa{cursor:default}a span.icon>.fa{cursor:inherit}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,0.5);cursor:default}.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,0.8);color:#111}.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff !important;background:rgba(0,0,0,0.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans", "DejaVu Sans", sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff !important}.conum[data-value]+b{display:none}.conum[data-value]::after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-0.125em}b.conum *{color:inherit !important}.conum:not([data-value]):empty{display:none}dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}h1,h2,p,td.content,span.alt,summary{letter-spacing:-0.01em}p strong,td.content strong,div.footnote strong{letter-spacing:-0.005em}p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.print-only{display:none !important}@page{margin:1.25cm 0.75cm}@media print{*{box-shadow:none !important;text-shadow:none !important}html{font-size:80%}a{color:inherit !important;text-decoration:underline !important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none !important}a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:0.25em}abbr[title]{border-bottom:1px dotted}abbr[title]::after{content:" (" attr(title) ")"}pre,blockquote,tr,img,object,svg{page-break-inside:avoid}thead{display:table-header-group}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}body>div[id]{max-width:none}#toc,.sidebarblock,.exampleblock>.content{background:none !important}#toc{border-bottom:1px solid #dddddf !important;padding-bottom:0 !important}body.book #header{text-align:center}body.book #header>h1:first-child{border:0 !important;margin:2.5em 0 1em}body.book #header .details{border:0 !important;display:block;padding:0 !important}body.book #header .details span:first-child{margin-left:0 !important}body.book #header .details br{display:block}body.book #header .details br+span::before{content:none !important}body.book #toc{border:0 !important;text-align:left !important;padding:0 !important;margin:0 !important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]::before{display:block}div.page-break{display:block;page-break-after:always}#footer{padding:0 0.9375em}.hide-on-print{display:none !important}.print-only{display:block !important}.hide-for-print{display:none !important}.show-for-print{display:inherit !important}}@media amzn-kf8, print{#header>h1:first-child{margin-top:1.25rem}.sect1{padding:0 !important}.sect1+.sect1{border:0}#footer{background:none}#footer-text{color:rgba(0,0,0,0.6);font-size:0.9em}}@media amzn-kf8{body>div[id]{padding:0}}body{padding:0;margin:0;margin-top:70px !important}.container{position:relative;z-index:1;padding-top:50px;min-height:100%}.container p{font-family:sans-serif;font-size:1.2em}nav{position:fixed;z-index:9999;left:0;right:0;top:0;height:70px;padding:0 1.5em;background-color:#025d8c;font-family:sans-serif;line-height:70px}nav .logo{width:50px;vertical-align:middle}nav .nav-menu{position:absolute;right:0.3em;top:0;padding:0;margin:0;list-style:none}nav .nav-item{display:inline-block}nav .nav-item>a{display:inline-block;padding:0 2.5em;line-height:70px;color:#fff;text-decoration:none}nav .dropdown{position:relative}nav .dropdown a::after{content:"";display:inline-block;margin-left:0.5em;vertical-align:middle;border-top:0.3em solid #fff;border-right:0.3em solid transparent;border-left:0.3em solid transparent}nav .dropdown.show a::after{transform:rotate(180deg)}nav .dropdown-menu{display:none;position:absolute;left:0;right:0;top:100%;padding:0.5em 0;margin-top:-0.5em;border:1px solid rgba(0,0,0,0.3);border-radius:0.5em;background-color:#fff;width:max-content}nav .dropdown-menu-left{left:auto;right:0}nav .dropdown.show .dropdown-menu{display:block}nav .dropdown-div{display:block;padding:0.4em 0;line-height:4em}nav .dropdown-div a::after{content:none;margin-left:0;border-top:0;border-right:0;border-left:0}nav .dropdown-item{display:block;padding:0 1.5em;font-size:0.875em;color:#000;line-height:1.6em;text-decoration:none}nav .btn-hamburger{display:none;position:absolute;right:1.5em;top:50%;background-color:transparent;border:0;cursor:pointer;outline:none;transform:translateY(-50%)}nav .btn-hamburger span{display:block;width:30px;height:4px;background-color:#fff;margin:6px;border-radius:2px;transition:0.3s ease-in-out}nav .btn-hamburger span:nth-child(4),nav .btn-hamburger span:nth-child(5){position:absolute;top:10px;opacity:0.5}nav .btn-hamburger span:nth-child(4){transform:rotate(45deg) scale(0)}nav .btn-hamburger span:nth-child(5){transform:rotate(-45deg) scale(0)}nav.opened .btn-hamburger span:nth-child(4){opacity:1;transform:rotate(45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(5){opacity:1;transform:rotate(-45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(1),nav.opened .btn-hamburger span:nth-child(2),nav.opened .btn-hamburger span:nth-child(3){opacity:0}@media screen and (max-width: 768px){nav .nav-menu{position:fixed;left:0;right:0;top:70px;bottom:100%;display:flex;flex-direction:column;justify-content:start;background-color:#363d4e;transition:bottom 0.5s ease-in-out;overflow:hidden}nav.opened .nav-menu{bottom:0}nav .nav-item>a{display:block}nav .dropdown-menu{position:relative;top:0;margin:0 1.5em}nav .btn-hamburger{display:block}}/*!
* "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License
* https://github.com/simonwhitaker/github-fork-ribbon-css

The MIT License (MIT)

Copyright (c) 2013 Simon Whitaker

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/.github-fork-ribbon,.release-ribbon,.issue-ribbon{width:12.1em;height:12.1em;position:absolute;overflow:hidden;top:70px;right:0;z-index:9998;pointer-events:none;font-size:13px;text-decoration:none;text-indent:-999999px}.github-fork-ribbon.fixed,.fixed.release-ribbon,.fixed.issue-ribbon{position:fixed}.github-fork-ribbon:hover,.release-ribbon:hover,.issue-ribbon:hover,.github-fork-ribbon:active,.release-ribbon:active,.issue-ribbon:active{background-color:transparent}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before,.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{position:absolute;display:block;width:15.38em;height:1.54em;top:3.23em;right:-3.23em;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before{content:"";padding:.38em 0;background-color:#a00;background-image:-webkit-gradient(linear, left top, left bottom, from(transparent), to(rgba(0,0,0,0.15)));background-image:-webkit-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-moz-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-ms-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-o-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:linear-gradient(to bottom, transparent, rgba(0,0,0,0.15));-webkit-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);-moz-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);pointer-events:auto}.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{content:attr(data-ribbon);color:#fff;font:700 1em "Helvetica Neue", Helvetica, Arial, sans-serif;line-height:1.54em;text-decoration:none;text-shadow:0 -0.08em rgba(0,0,0,0.5);text-align:center;text-indent:0;padding:.15em 0;margin:.15em 0;border-width:.08em 0;border-style:dotted;border-color:#fff;border-color:rgba(255,255,255,0.7)}.github-fork-ribbon.left-top,.left-top.release-ribbon,.left-top.issue-ribbon,.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon{right:auto;left:0}.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon,.github-fork-ribbon.right-bottom,.right-bottom.release-ribbon,.right-bottom.issue-ribbon{top:auto;bottom:0}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after{right:auto;left:-3.23em}.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{top:auto;bottom:3.23em}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}.release-ribbon:before{background-color:#a00}.issue-ribbon:before{background-color:#025d8c}@media screen{div.narrow{max-width:1080px;margin:0 auto !important;margin-top:70px auto !important;float:none !important}#toc.toc2{margin-top:70px !important}}

</style>
<!-- Generate a nice TOC -->
<script src="/js/jquery-1.11.3.min.js"></script>
<script src="/js/jquery-ui.min.js"></script>
<script src="/js/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
.tocify-header {
    /* font-style: italic; */
}

.tocify-subheader {
    font-style: normal;
    font-size: 95%;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    /* background-color: rgba(0, 0, 0, 0.05);*/
}

.tocify-focus > a {
    color: #ba3925;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>
<style>
/*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
.tabs {
  margin-bottom: 1.25em;
}

.tablist > ul {
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  margin: 0;
  padding: 0;
}

.tablist > ul li {
  align-items: center;
  background-color: #fff;
  cursor: pointer;
  display: flex;
  font-weight: bold;
  line-height: 1.5;
  padding: 0.25em 1em;
  position: relative;
}

.tablist > ul li:focus-visible {
  outline: none;
}

.tablist.ulist,
.tablist.ulist > ul li {
  margin: 0;
}

.tablist.ulist > ul li + li {
  margin-left: 0.25em;
}

.tabs .tablist li::after {
  content: "";
  display: block;
  height: 1px;
  position: absolute;
  bottom: -1px;
  left: 0;
  right: 0;
}

.tabs.is-loading .tablist li:not(:first-child),
.tabs:not(.is-loading) .tablist li:not(.is-selected) {
  background-color: #f5f5f5;
}

.tabs.is-loading .tablist li:first-child::after,
.tabs:not(.is-loading) .tablist li.is-selected::after {
  background-color: #fff;
}

/*
.tabs:not(.is-loading) .tablist li,
.tabs:not(.is-loading) .tablist li::after {
  transition: background-color 200ms ease-in-out;
}
*/

.tablist > ul p {
  line-height: inherit;
  margin: 0;
}

.tabpanel {
  background-color: #fff;
  padding: 1.25em;
}

.tablist > ul li,
.tabpanel {
  border: 1px solid #dcdcdc;
}

.tablist > ul li {
  border-bottom: 0;
}

.tabs.is-loading .tabpanel + .tabpanel,
.tabs:not(.is-loading) .tabpanel.is-hidden {
  display: none;
}

.tabpanel > :first-child {
  margin-top: 0;
}

/* #content is a signature of the Asciidoctor standalone HTML output */
#content .tabpanel > :last-child,
#content .tabpanel > :last-child > :last-child,
#content .tabpanel > :last-child > :last-child > li:last-child > :last-child {
  margin-bottom: 0;
}

.tablecontainer {
  overflow-x: auto;
}

#content .tablecontainer {
  margin-bottom: 1.25em;
}

#content .tablecontainer > table.tableblock {
  margin-bottom: 0;
}
</style>
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Installing Foreman&#160;Server with Katello 4.13 plugin on Enterprise Linux</h1>
<div class="details">
<span id="revnumber">version 3.11 (unsupported),</span>
<span id="revdate">published Oct 17 2025</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Preparing_your_Environment_for_Installation_foreman">1. Preparing your environment for installation</a>
<ul class="sectlevel2">
<li><a href="#system-requirements_foreman">1.1. System requirements</a></li>
<li><a href="#storage-requirements_foreman">1.2. Storage requirements</a></li>
<li><a href="#storage-guidelines_foreman">1.3. Storage guidelines</a></li>
<li><a href="#supported-operating-systems_foreman">1.4. Supported operating systems</a></li>
<li><a href="#supported-browsers_foreman">1.5. Supported browsers</a></li>
<li><a href="#Port_and_firewall_requirements_foreman">1.6. Port and firewall requirements</a></li>
<li><a href="#Enabling_Connections_from_a_Client_to_Server_foreman">1.7. Enabling connections from a client to Foreman&#160;server</a></li>
<li><a href="#verifying-dns-resolution_foreman">1.8. Verifying DNS resolution</a></li>
<li><a href="#tuning-with-predefined-profiles_foreman">1.9. Tuning Foreman&#160;server with predefined profiles</a></li>
<li><a href="#requirements-for-installation-in-an-ipv4-network">1.10. Requirements for installation in an IPv4 network</a></li>
</ul>
</li>
<li><a href="#preparing-environment-for-installation-in-ipv6-network_foreman">2. Preparing your environment for Foreman installation in an IPv6 network</a>
<ul class="sectlevel2">
<li><a href="#limitations-of-installation-in-an-ipv6-network_foreman">2.1. Limitations of Foreman installation in an IPv6 network</a></li>
<li><a href="#requirements-for-installation-in-an-ipv6-network_foreman">2.2. Requirements for Foreman installation in an IPv6 network</a></li>
</ul>
</li>
<li><a href="#Installing_Server_Connected_foreman">3. Installing Foreman&#160;server</a>
<ul class="sectlevel2">
<li><a href="#configuring-http-proxy-to-connect-to-cdn_foreman">3.1. Configuring the HTTP proxy to connect to Red Hat CDN</a></li>
<li><a href="#configuring-repositories_foreman">3.2. Configuring repositories</a></li>
<li><a href="#using-fapolicyd-on-server_foreman">3.3. Optional: Using fapolicyd on Foreman&#160;server</a>
<ul class="sectlevel3">
<li><a href="#installing-fapolicyd-on-server_foreman">3.3.1. Installing fapolicyd on Foreman&#160;server</a></li>
</ul>
</li>
<li><a href="#Installing_Server_Packages_foreman">3.4. Installing Foreman&#160;server packages</a></li>
<li><a href="#configuring-server_foreman">3.5. Configuring Foreman&#160;server</a>
<ul class="sectlevel3">
<li><a href="#Configuring_Installation_foreman">3.5.1. Configuring Foreman installation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#performing-additional-configuration-on-server_foreman">4. Performing additional configuration on Foreman&#160;server</a>
<ul class="sectlevel2">
<li><a href="#configuring-foreman-server-to-consume-content-from-a-custom-cdn_foreman">4.1. Configuring Foreman&#160;Server to consume content from a custom CDN</a></li>
<li><a href="#configuring-for-uefi-http-boot-provisioning-in-an-ipv6-network_foreman">4.2. Configuring Foreman for UEFI HTTP boot provisioning in an IPv6 network</a></li>
<li><a href="#Configuring_Server_with_an_HTTP_Proxy_foreman">4.3. Configuring Foreman&#160;server with an HTTP proxy</a>
<ul class="sectlevel3">
<li><a href="#adding-a-default-http-proxy_foreman">4.3.1. Adding a default HTTP proxy to Foreman</a></li>
<li><a href="#configuring-selinux-to-ensure-access-on-custom-ports_foreman">4.3.2. Configuring SELinux to ensure access to Foreman on custom ports</a></li>
<li><a href="#using-an-http-proxy-for-all-http-requests_foreman">4.3.3. Using an HTTP proxy for all Foreman HTTP requests</a></li>
<li><a href="#excluding-hosts-from-receiving-proxied-requests_foreman">4.3.4. Excluding hosts from receiving proxied requests</a></li>
<li><a href="#configuring-proxy-for-pxe-files_foreman">4.3.5. Configuring a proxy for PXE file downloads</a></li>
<li><a href="#resetting-the-http-proxy_foreman">4.3.6. Resetting the HTTP proxy</a></li>
</ul>
</li>
<li><a href="#enabling-power-management-on-hosts_foreman">4.4. Enabling power management on hosts</a></li>
<li><a href="#configuring-dns-dhcp-and-tftp_foreman">4.5. Configuring DNS, DHCP, and TFTP</a>
<ul class="sectlevel3">
<li><a href="#configuring-dns-dhcp-and-tftp-on-productname_foreman">4.5.1. Configuring DNS, DHCP, and TFTP on Foreman&#160;server</a></li>
<li><a href="#disabling-dns-dhcp-tftp-for-unmanaged-networks_foreman">4.5.2. Disabling DNS, DHCP, and TFTP for unmanaged networks</a></li>
<li><a href="#configuring-dns-dhcp-and-tftp-additional-resources_foreman">4.5.3. Additional resources</a></li>
</ul>
</li>
<li><a href="#Configuring_Server_for_Outgoing_Emails_foreman">4.6. Configuring Foreman&#160;server for outgoing emails</a></li>
<li><a href="#configuring-an-alternate-cname_foreman">4.7. Configuring an alternate CNAME for Foreman</a>
<ul class="sectlevel3">
<li><a href="#configuring-foreman-with-an-alternate-cname_foreman">4.7.1. Configuring Foreman with an alternate CNAME</a></li>
<li><a href="#configuring-hosts-to-use-an-alternate-cname-for-content-management_foreman">4.7.2. Configuring hosts to use an alternate Foreman CNAME for content management</a></li>
</ul>
</li>
<li><a href="#Configuring_Server_with_a_Custom_SSL_Certificate">4.8. Configuring Foreman&#160;server with a custom SSL certificate</a>
<ul class="sectlevel3">
<li><a href="#creating-a-custom-ssl-certificate_foreman">4.8.1. Creating a custom SSL certificate for Foreman&#160;server</a></li>
<li><a href="#Deploying_a_Custom_SSL_Certificate_to_Server_foreman">4.8.2. Deploying a custom SSL certificate to Foreman&#160;server</a></li>
<li><a href="#deploying-a-custom-ssl-certificate-to-hosts_foreman">4.8.3. Deploying a SSL certificate to hosts</a></li>
</ul>
</li>
<li><a href="#resetting-custom-ssl-certificate-to-default-self-signed-certificate-on-foreman_foreman">4.9. Resetting SSL certificate to default self-signed certificate on Foreman&#160;server</a></li>
<li><a href="#using-external-databases_foreman">4.10. Using external databases with Foreman</a>
<ul class="sectlevel3">
<li><a href="#postgresql-as-an-external-database-considerations_foreman">4.10.1. PostgreSQL as an external database considerations</a></li>
<li><a href="#preparing-a-host-for-external-databases_foreman">4.10.2. Preparing a host for external databases</a></li>
<li><a href="#installing-postgresql_foreman">4.10.3. Installing PostgreSQL</a></li>
<li><a href="#Configuring_Server_to_Use_External_Databases_foreman">4.10.4. Configuring Foreman&#160;server to use external databases</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuring-external-authentication-and-enabling-single-sign-on-and-two-factor-authentication_foreman">5. Configuring external authentication and enabling single sign-on and two-factor authentication</a>
<ul class="sectlevel2">
<li><a href="#configuring-an-ldap-server-as-an-external-identity-provider-for-project_foreman">5.1. Configuring an LDAP server as an external identity provider for Foreman</a>
<ul class="sectlevel3">
<li><a href="#Configuring_TLS_for_Secure_LDAP_foreman">5.1.1. Configuring TLS for secure LDAP</a></li>
<li><a href="#Configuring_Project_to_Use_LDAP_foreman">5.1.2. Configuring Foreman to use LDAP</a></li>
<li><a href="#Example_Settings_for_LDAP_Connections_foreman">5.1.3. Example settings for LDAP connections</a></li>
<li><a href="#Example_LDAP_Filters_foreman">5.1.4. Example LDAP filters</a></li>
</ul>
</li>
<li><a href="#configuring-kerberos-single-sign-on-with-FreeIPA-in-project_foreman">5.2. Configuring Kerberos single sign-on with FreeIPA in Foreman</a>
<ul class="sectlevel3">
<li><a href="#enrolling-projectserver-in-freeipa-domain_foreman">5.2.1. Enrolling Foreman&#160;server in a FreeIPA domain</a></li>
<li><a href="#configuring-the-freeipa-authentication-source-on-projectserver_foreman">5.2.2. Configuring the FreeIPA authentication source on Foreman&#160;server</a></li>
<li><a href="#configuring-host-based-access-control-for-FreeIPA-users-logging-in-to-project_foreman">5.2.3. Configuring host-based access control for FreeIPA users logging in to Foreman</a></li>
<li><a href="#configuring-hammer-cli-to-accept-FreeIPA-credentials_foreman">5.2.4. Configuring Hammer CLI to accept FreeIPA credentials</a></li>
<li><a href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_Hammer_CLI_foreman">5.2.5. Logging in to Hammer CLI with FreeIPA credentials</a></li>
<li><a href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-Mozilla-Firefox_foreman">5.2.6. Logging in to the Foreman web UI with FreeIPA credentials in Mozilla Firefox</a></li>
<li><a href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-a-Chrome-browser_foreman">5.2.7. Logging in to the Foreman web UI with FreeIPA credentials in Chrome</a></li>
<li><a href="#Configuring-a-cross-forest-trust-between-FreeIPA-and-Active-Directory-for-Foreman_foreman">5.2.8. Configuring a cross-forest trust between FreeIPA and Active Directory for Foreman</a></li>
</ul>
</li>
<li><a href="#configuring-keycloak-wildfly-authentication-for-project_keycloak-wildfly">5.3. Configuring Wildfly-based Keycloak authentication for Foreman</a>
<ul class="sectlevel3">
<li><a href="#prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-wildfly">5.3.1. Prerequisites for configuring Foreman with Wildfly-based Keycloak authentication</a></li>
<li><a href="#registering-foreman-as-a-client-of-keycloak_keycloak-wildfly">5.3.2. Registering Foreman as a client of Keycloak</a></li>
<li><a href="#configuring-the-foreman-client-in-keycloak_keycloak-wildfly">5.3.3. Configuring the Foreman client in Wildfly-based Keycloak</a></li>
<li><a href="#configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-wildfly">5.3.4. Configuring a Foreman client to provide Foreman web UI authentication with Keycloak</a></li>
<li><a href="#configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-wildfly">5.3.5. Configuring a Foreman client to provide Hammer CLI authentication with Keycloak</a></li>
<li><a href="#configuring-foreman-with-keycloak-for-totp-authentication_keycloak-wildfly">5.3.6. Configuring Foreman with Keycloak for TOTP authentication</a></li>
<li><a href="#configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-wildfly">5.3.7. Configuring Keycloak settings for authentication with PIV cards</a></li>
<li><a href="#configuring-group-mapping-for-keycloak-authentication_keycloak-wildfly">5.3.8. Optional: Configuring external group mapping for Keycloak authentication</a></li>
<li><a href="#logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-wildfly">5.3.9. Logging in to Foreman configured with Keycloak as an authentication source</a></li>
</ul>
</li>
<li><a href="#configuring-single-sign-on-and-two-factor-authentication-with-keycloak-in-project_keycloak-quarkus">5.4. Configuring single sign-on and two-factor authentication with Quarkus-based Keycloak in Foreman</a>
<ul class="sectlevel3">
<li><a href="#prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-quarkus">5.4.1. Prerequisites for configuring Foreman with Quarkus-based Keycloak authentication</a></li>
<li><a href="#registering-foreman-as-a-client-of-keycloak_keycloak-quarkus">5.4.2. Registering Foreman as a client of Keycloak</a></li>
<li><a href="#configuring-the-foreman-client-in-keycloak_keycloak-quarkus">5.4.3. Configuring the Foreman client in Quarkus-based Keycloak</a></li>
<li><a href="#configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-quarkus">5.4.4. Configuring a Foreman client to provide Foreman web UI authentication with Keycloak</a></li>
<li><a href="#configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-quarkus">5.4.5. Configuring a Foreman client to provide Hammer CLI authentication with Keycloak</a></li>
<li><a href="#configuring-foreman-with-keycloak-for-totp-authentication_keycloak-quarkus">5.4.6. Configuring Foreman with Keycloak for TOTP authentication</a></li>
<li><a href="#configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-quarkus">5.4.7. Configuring Keycloak settings for authentication with PIV cards</a></li>
<li><a href="#configuring-group-mapping-for-keycloak-authentication_keycloak-quarkus">5.4.8. Optional: Configuring external group mapping for Keycloak authentication</a></li>
<li><a href="#logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-quarkus">5.4.9. Logging in to Foreman configured with Keycloak as an authentication source</a></li>
</ul>
</li>
<li><a href="#configuring-active-directory-as-an-external-identity-provider-for-project_foreman">5.5. Configuring Active Directory as an external identity provider for Foreman</a>
<ul class="sectlevel3">
<li><a href="#configuring-the-active-directory-authentication-source-on-projectserver_foreman">5.5.1. Configuring the Active Directory authentication source on Foreman&#160;server</a></li>
</ul>
</li>
<li><a href="#configuring-project-to-manage-the-lifecycle-of-a-host-registered-to-a-freeipa-realm_foreman">5.6. Configuring Foreman to manage the lifecycle of a host registered to a FreeIPA realm</a></li>
<li><a href="#important-user-and-group-account-information-for-active-directory-accounts_foreman">5.7. Important user and group account information for Active Directory accounts</a></li>
<li><a href="#Configuring_External_User_Groups_foreman">5.8. Configuring external user groups</a></li>
<li><a href="#Refreshing_External_User_Groups_for_LDAP_foreman">5.9. Refreshing external user groups for LDAP</a></li>
<li><a href="#Refreshing_External_User_Groups_for_FreeIPA_or_AD_foreman">5.10. Refreshing external user groups for FreeIPA or AD</a></li>
</ul>
</li>
<li><a href="#configuring-external-services">6. Configuring Foreman&#160;server with external services</a>
<ul class="sectlevel2">
<li><a href="#configuring-external-dns_foreman">6.1. Configuring Foreman&#160;server with external DNS</a></li>
<li><a href="#configuring-external-dhcp_foreman">6.2. Configuring Foreman&#160;server with external DHCP</a>
<ul class="sectlevel3">
<li><a href="#configuring-an-external-dhcp-server_foreman">6.2.1. Configuring an external DHCP server to use with Foreman&#160;server</a></li>
<li><a href="#Configuring_Server_with_an_External_DHCP_Server_foreman">6.2.2. Configuring Foreman&#160;server with an external DHCP server</a></li>
</ul>
</li>
<li><a href="#configuring-external-tftp_foreman">6.3. Configuring Foreman&#160;server with external TFTP</a></li>
<li><a href="#configuring-external-idm-dns_foreman">6.4. Configuring Foreman&#160;server with external IdM DNS</a>
<ul class="sectlevel3">
<li><a href="#configuring-dynamic-dns-update-with-gss-tsig-authentication_foreman">6.4.1. Configuring dynamic DNS update with GSS-TSIG authentication</a></li>
<li><a href="#configuring-dynamic-dns-update-with-tsig-authentication_foreman">6.4.2. Configuring dynamic DNS update with TSIG authentication</a></li>
<li><a href="#reverting-to-internal-dns-service_foreman">6.4.3. Reverting to internal DNS service</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#troubleshooting-dnf-modules_foreman">Appendix A: Troubleshooting DNF modules</a>
<ul class="sectlevel2">
<li><a href="#Troubleshooting_Ruby_foreman">Ruby</a></li>
<li><a href="#Troubleshooting_Postgresql_foreman">PostgreSQL</a></li>
</ul>
</li>
<li><a href="#Troubleshooting_Sync_Errors_foreman">Appendix B: Troubleshooting sync errors</a></li>
<li><a href="#applying-custom-configuration_foreman">Appendix C: Applying custom configuration to Foreman</a></li>
<li><a href="#restoring-manual-changes-overwritten-by-a-puppet-run_foreman">Appendix D: Restoring manual changes overwritten by a Puppet run</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="Preparing_your_Environment_for_Installation_foreman"><a class="anchor" href="#Preparing_your_Environment_for_Installation_foreman"></a>1. Preparing your environment for installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you install Foreman, ensure that your environment meets the following requirements.</p>
</div>
<div class="sect2">
<h3 id="system-requirements_foreman"><a class="anchor" href="#system-requirements_foreman"></a>1.1. System requirements</h3>
<div class="paragraph">
<p>The following requirements apply to the networked base operating system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>x86_64 architecture</p>
</li>
<li>
<p>4-core 2.0 GHz CPU at a minimum</p>
</li>
<li>
<p>A minimum of 20 GB RAM is required for Foreman&#160;server to function.
In addition, a minimum of 4 GB RAM of swap space is also recommended.
Foreman running with less RAM than the minimum value might not operate correctly.</p>
</li>
<li>
<p>A unique host name, which can contain lower-case letters, numbers, dots (.) and hyphens (-)</p>
</li>
<li>
<p>Administrative user (root) access</p>
</li>
<li>
<p>Full forward and reverse DNS resolution using a fully-qualified domain name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Foreman only supports <code>UTF-8</code> encoding.
If your territory is USA and your language is English, set <code>en_US.utf-8</code> as the system-wide locale settings.
For more information about configuring system locale in Enterprise Linux, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/assembly_changing-basic-environment-settings_configuring-basic-system-settings#proc_configuring-the-system-locale_assembly_changing-basic-environment-settings">Configuring the system locale</a> in <em>Red&#160;Hat Enterprise Linux&#160;9 Configuring basic system settings</em>.</p>
</div>
<div class="paragraph">
<p>Foreman&#160;server and Smart&#160;Proxy&#160;server do not support shortnames in the hostnames.
When using custom certificates, the Common Name (CN) of the custom certificate must be a fully qualified domain name (FQDN) instead of a shortname.
This does not apply to the clients of a Foreman.</p>
</div>
<div class="paragraph">
<p>Before you install Foreman&#160;server, ensure that your environment meets the requirements for installation.</p>
</div>
<div class="paragraph">
<p>Foreman&#160;server must be installed on a freshly provisioned system that serves no other function except to run Foreman&#160;server.
The freshly provisioned system must not have the following users provided by external identity providers to avoid conflicts with the local users that Foreman&#160;server creates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>apache</p>
</li>
<li>
<p>foreman</p>
</li>
<li>
<p>foreman-proxy</p>
</li>
<li>
<p>postgres</p>
</li>
<li>
<p>pulp</p>
</li>
<li>
<p>puppet</p>
</li>
<li>
<p>redis</p>
</li>
<li>
<p>tomcat</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">SELinux mode</div>
<p>SELinux must be enabled, either in enforcing or permissive mode.
Installation with disabled SELinux is not supported.</p>
</div>
<div class="paragraph">
<div class="title">Synchronized system clock</div>
<p>The system clock on the base operating system where you are installing your Foreman&#160;server must be synchronized across the network.
If the system clock is not synchronized, SSL certificate verification might fail.</p>
</div>
<div class="paragraph">
<div class="title">FIPS mode</div>
<p>You can install Foreman on a Enterprise Linux system that is operating in FIPS mode.
You cannot enable FIPS mode after the installation of Foreman.
Red&#160;Hat Enterprise Linux clones are not being actively tested in FIPS mode.
If you require FIPS, consider using Red&#160;Hat Enterprise Linux.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/security_hardening/switching-rhel-to-fips-mode_security-hardening">Switching RHEL to FIPS mode</a> in <em>Red&#160;Hat Enterprise Linux&#160;9 Security hardening</em> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/security_hardening/switching-rhel-to-fips-mode_security-hardening">Switching RHEL to FIPS mode</a> in <em>Red&#160;Hat Enterprise Linux&#160;8 Security hardening</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Foreman supports DEFAULT and FIPS crypto-policies.
The FUTURE crypto-policy is not supported for Foreman and Smart&#160;Proxy installations.
The FUTURE policy is a stricter forward-looking security level intended for testing a possible future policy.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/security_hardening/using-the-system-wide-cryptographic-policies_security-hardening">Using system-wide cryptographic policies</a> in <em>Red&#160;Hat Enterprise Linux&#160;9 Security hardening</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="storage-requirements_foreman"><a class="anchor" href="#storage-requirements_foreman"></a>1.2. Storage requirements</h3>
<div class="paragraph">
<p>The following table details storage requirements for specific directories.
These values are based on expected use case scenarios and can vary according to individual environments.</p>
</div>
<div class="paragraph">
<p>The runtime size was measured with Red&#160;Hat Enterprise Linux 7, 8, and 9 repositories synchronized.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Storage requirements for a Foreman&#160;server installation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Installation Size</th>
<th class="tableblock halign-left valign-top">Runtime Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/pgsql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/puppetlabs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/pulp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300 GB</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For external database servers: <code>/var/lib/pgsql</code> with installation size of 100 MB and runtime size of 20 GB.</p>
</div>
<div class="paragraph">
<p>For detailed information on partitioning and size, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/managing_storage_devices/disk-partitions_managing-storage-devices">Disk partitions</a> in <em>Red&#160;Hat Enterprise Linux&#160;9 Managing storage devices</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="storage-guidelines_foreman"><a class="anchor" href="#storage-guidelines_foreman"></a>1.3. Storage guidelines</h3>
<div class="paragraph">
<p>Consider the following guidelines when installing Foreman&#160;server to increase efficiency.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you mount the <code>/tmp</code> directory as a separate file system, you must use the <code>exec</code> mount option in the <code>/etc/fstab</code> file.
If <code>/tmp</code> is already mounted with the <code>noexec</code> option, you must change the option to <code>exec</code> and re-mount the file system.
This is a requirement for the <code>puppetserver</code> service to work.</p>
</li>
<li>
<p>Because most Foreman&#160;server data is stored in the <code>/var</code> directory, mounting <code>/var</code> on LVM storage can help the system to scale.</p>
</li>
<li>
<p>Use high-bandwidth, low-latency storage for the <code>/var/lib/pulp/</code> directories.
As Foreman has many operations that are I/O intensive, using high latency, low-bandwidth storage causes performance degradation.
Ensure your installation has a speed in the range 60&#8202;&#8211;&#8202;80 Megabytes per second.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">File system guidelines</div>
<ul>
<li>
<p>Do not use the GFS2 file system as the input-output latency is too high.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Log file storage</div>
<p>Log files are written to <code>/var/log/messages/,</code> <code>/var/log/httpd/</code>, and <code>/var/lib/foreman-proxy/openscap/content/</code>.
You can manage the size of these files using <strong>logrotate</strong>.</p>
</div>
<div class="paragraph">
<p>The exact amount of storage you require for log messages depends on your installation and setup.</p>
</div>
<div class="paragraph">
<div class="title">SELinux considerations for NFS mount</div>
<p>When the <code>/var/lib/pulp</code> directory is mounted using an NFS share, SELinux blocks the synchronization process.
To avoid this, specify the SELinux context of the <code>/var/lib/pulp</code> directory in the file system table by adding the following lines to <code>/etc/fstab</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nfs.example.com:/nfsshare  /var/lib/pulp  nfs  context="system_u:object_r:var_lib_t:s0"  1 2</pre>
</div>
</div>
<div class="paragraph">
<p>If NFS share is already mounted, remount it using the above configuration and enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># restorecon -R /var/lib/pulp</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Duplicated packages</div>
<p>Packages that are duplicated in different repositories are only stored once on the disk.
Additional repositories containing duplicate packages require less additional storage.
The bulk of storage resides in the <code>/var/lib/pulp/</code> directory.
These end points are not manually configurable.
Ensure that storage is available on the <code>/var</code> file system to prevent storage problems.</p>
</div>
<div class="paragraph">
<div class="title">Symbolic links</div>
<p>You cannot use symbolic links for <code>/var/lib/pulp/</code>.</p>
</div>
<div class="paragraph">
<div class="title">Synchronized RHEL ISO</div>
<p>If you plan to synchronize RHEL content ISOs to Foreman, note that all minor versions of Red&#160;Hat Enterprise Linux also synchronize.
You must plan to have adequate storage on your Foreman to manage this.</p>
</div>
</div>
<div class="sect2">
<h3 id="supported-operating-systems_foreman"><a class="anchor" href="#supported-operating-systems_foreman"></a>1.4. Supported operating systems</h3>
<div class="paragraph">
<p>The following operating systems are supported by the installer, have packages, and are tested for deploying Foreman:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Operating systems supported by foreman-installer</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Architecture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.theforeman.org/3.11/Planning_for_Project/index-katello.html#Enterprise_Linux">Enterprise Linux</a> 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPEL is not supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.theforeman.org/3.11/Planning_for_Project/index-katello.html#Enterprise_Linux">Enterprise Linux</a> 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPEL is not supported.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Foreman community advises against using an existing system because the Foreman installer will affect the configuration of several components.</p>
</div>
</div>
<div class="sect2">
<h3 id="supported-browsers_foreman"><a class="anchor" href="#supported-browsers_foreman"></a>1.5. Supported browsers</h3>
<div class="paragraph">
<p>Using the most recent version of a major browser is highly recommended, as Foreman and the frameworks it uses offer limited support for older versions.</p>
</div>
<div class="paragraph">
<p>The recommended requirements are as follows for major browsers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Google Chrome &#8211; latest version</p>
</li>
<li>
<p>Microsoft Edge &#8211; latest version</p>
</li>
<li>
<p>Apple Safari &#8211; latest version</p>
</li>
<li>
<p>Mozilla Firefox &#8211; latest version</p>
</li>
<li>
<p>Mozilla Firefox Extended Support Release (ESR) &#8211; latest version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other browsers may work unpredictably.</p>
</div>
<div class="paragraph">
<p>The Foreman web UI and command-line interface is translated into various languages.</p>
</div>
</div>
<div class="sect2">
<h3 id="Port_and_firewall_requirements_foreman"><a class="anchor" href="#Port_and_firewall_requirements_foreman"></a>1.6. Port and firewall requirements</h3>
<div class="paragraph">
<p>For the components of Foreman architecture to communicate, ensure that the required network ports are open and free on the base operating system.
You must also ensure that the required network ports are open on any network-based firewalls.</p>
</div>
<div class="paragraph">
<p>Use this information to configure any network-based firewalls.
Note that some cloud solutions must be specifically configured to allow communications between machines because they isolate machines similarly to network-based firewalls.
If you use an application-based firewall, ensure that the application-based firewall permits all applications that are listed in the tables and known to your firewall.
If possible, disable the application checking and allow open port communication based on the protocol.</p>
</div>
<div class="paragraph">
<div class="title">Integrated Smart&#160;Proxy</div>
<p>Foreman&#160;server has an integrated Smart&#160;Proxy and any host that is directly connected to Foreman&#160;server is a Client of Foreman in the context of this section.
This includes the base operating system on which Smart&#160;Proxy&#160;server is running.</p>
</div>
<div class="paragraph">
<div class="title">Clients of Smart&#160;Proxy</div>
<p>Hosts which are clients of Smart&#160;Proxies, other than Foreman&#8217;s integrated Smart&#160;Proxy, do not need access to Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>Required ports can change based on your configuration.</p>
</div>
<div class="paragraph">
<p>The following tables indicate the destination port and the direction of network traffic:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Foreman&#160;server incoming traffic</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Required For</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Servers and clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name resolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP Server (optional)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Communication from Smart&#160;Proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443, 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global Registration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registering hosts to Foreman</p>
<p class="tableblock">Port 443 is required for registration initiation, uploading facts, and sending installed packages and traces</p>
<p class="tableblock">Port 80 notifies Foreman on the <code>/unattended/built</code> endpoint that registration has finished</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Mirroring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart Proxy functionality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443, 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Retrieval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443, 80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS, HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Retrieval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1883</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MQTT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull based REX (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content hosts for REX job notification (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5910&#8202;&#8211;&#8202;5930</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browsers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute Resource&#8217;s virtual console</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provisioning templates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template retrieval for client installers, iPXE or UEFI HTTP Boot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXE Boot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8140</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puppet agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client updates (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart Proxy functionality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenSCAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Client (if the OpenSCAP plugin is installed)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovered Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host discovery and provisioning (if the discovery plugin is installed)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull based REX (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content hosts for REX job notification (optional)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Any host that is directly connected to Foreman&#160;server is a client in this context because it is a client of the integrated Smart&#160;Proxy.
This includes the base operating system on which a Smart&#160;Proxy&#160;server is running.</p>
</div>
<div class="paragraph">
<p>A DHCP Smart&#160;Proxy performs ICMP ping or TCP echo connection attempts to hosts in subnets with DHCP IPAM set to find out if an IP address considered for use is free.
This behavior can be turned off using <code>foreman-installer --foreman-proxy-dhcp-ping-free-ip=false</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Some outgoing traffic returns to Foreman to enable internal communication and security operations.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Foreman&#160;server outgoing traffic</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Required For</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ICMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free IP checking (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">echo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free IP checking (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run jobs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22, 16514</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH SSH/TLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman originated communications, for compute resources in libvirt</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Servers on the Internet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolve DNS records (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validation of DNS conflicts (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Orchestration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validation of DNS conflicts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Sync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote repositories</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">389, 636</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP, LDAPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External LDAP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP authentication, necessary only if external authentication is enabled.
The port can be customized when <code>LDAPAuthSource</code> is defined</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p>
<p class="tableblock">Configuration management</p>
<p class="tableblock">Template retrieval</p>
<p class="tableblock">OpenSCAP</p>
<p class="tableblock">Remote Execution result upload</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amazon EC2, Azure, Google GCE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual machine interactions (query/create/destroy) (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content mirroring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infoblox DHCP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When using Infoblox for DHCP, management of the DHCP leases (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">623</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BMC On/Off/Cycle/Status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenStack Compute Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual machine interactions (query/create/destroy) (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5900&#8202;&#8211;&#8202;5930</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hypervisor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">noVNC console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Launch noVNC console</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5985</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WinRM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Client running Windows</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5986</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WinRM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure Client running Windows</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7911</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP, OMAPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The DHCP target is configured using <code>--foreman-proxy-dhcp-server</code> and defaults to localhost</p>
<p class="tableblock">ISC and <code>remote_isc</code> use a configurable port that defaults to 7911 and uses OMAPI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy sends reboot command to the discovered host (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management of Smart&#160;Proxies</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Enabling_Connections_from_a_Client_to_Server_foreman"><a class="anchor" href="#Enabling_Connections_from_a_Client_to_Server_foreman"></a>1.7. Enabling connections from a client to Foreman&#160;server</h3>
<div class="paragraph">
<p>Smart&#160;Proxies and Content Hosts that are clients of a Foreman&#160;server&#8217;s internal Smart&#160;Proxy require access through Foreman&#8217;s host-based firewall and any network-based firewalls.</p>
</div>
<div class="paragraph">
<p>Use this procedure to configure the host-based firewall on the system that Foreman is installed on, to enable incoming connections from Clients, and to make the configuration persistent across system reboots.
For more information on the ports used, see <a href="https://docs.theforeman.org/3.11/Installing_Server/index-katello.html#foreman-port-and-firewall-requirements_foreman">Port and firewall requirements</a> in <em>Installing Foreman&#160;Server with Katello 4.13 plugin on Enterprise Linux</em>.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the ports for clients on Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd \
--add-port="8000/tcp" \
--add-port="9090/tcp"</pre>
</div>
</div>
</li>
<li>
<p>Allow access to services on Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd \
--add-service=dns \
--add-service=dhcp \
--add-service=tftp \
--add-service=http \
--add-service=https \
--add-service=puppetmaster</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --list-all</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/configuring_firewalls_and_packet_filters/using-and-configuring-firewalld_firewall-packet-filters">Using and configuring firewalld</a> in <em>Red&#160;Hat Enterprise Linux&#160;9 Configuring firewalls and packet filters</em> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html-single/configuring_and_managing_networking/index#using-and-configuring-firewalld_configuring-and-managing-networking">Using and configuring firewalld</a> in <em>Red&#160;Hat Enterprise Linux&#160;8 Configuring and managing networking</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="verifying-dns-resolution_foreman"><a class="anchor" href="#verifying-dns-resolution_foreman"></a>1.8. Verifying DNS resolution</h3>
<div class="paragraph">
<p>Verify the full forward and reverse DNS resolution using a fully-qualified domain name to prevent issues while installing Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the host name and local host resolve correctly:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ping -c1 localhost
# ping -c1 `hostname -f` # my_system.domain.com</pre>
</div>
</div>
<div class="paragraph">
<p>Successful name resolution results in output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ping -c1 localhost
PING localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.043 ms

--- localhost ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.043/0.043/0.043/0.000 ms

# ping -c1 `hostname -f`
PING hostname.gateway (XX.XX.XX.XX) 56(84) bytes of data.
64 bytes from hostname.gateway (XX.XX.XX.XX): icmp_seq=1 ttl=64 time=0.019 ms

--- localhost.gateway ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.019/0.019/0.019/0.000 ms</pre>
</div>
</div>
</li>
<li>
<p>To avoid discrepancies with static and transient host names, set all the host names on the system by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hostnamectl set-hostname <em>name</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Name resolution is critical to the operation of Foreman.
If Foreman cannot properly resolve its fully qualified domain name, tasks such as content management, subscription management, and provisioning will fail.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="tuning-with-predefined-profiles_foreman"><a class="anchor" href="#tuning-with-predefined-profiles_foreman"></a>1.9. Tuning Foreman&#160;server with predefined profiles</h3>
<div class="paragraph">
<p>If your Foreman deployment includes more than 5000 hosts, you can use predefined tuning profiles to improve performance of Foreman.</p>
</div>
<div class="paragraph">
<p>Note that you cannot use tuning profiles on Smart&#160;Proxies.</p>
</div>
<div class="paragraph">
<p>You can choose one of the profiles depending on the number of hosts your Foreman manages and available hardware resources.</p>
</div>
<div class="paragraph">
<p>The tuning profiles are available in the <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/sizes</code> directory.</p>
</div>
<div class="paragraph">
<p>When you run the <code>foreman-installer</code> command with the <code>--tuning</code> option, deployment configuration settings are applied to Foreman in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The default tuning profile defined in the <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/common.yaml</code> file</p>
</li>
<li>
<p>The tuning profile that you want to apply to your deployment and is defined in the <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/sizes/</code> directory</p>
</li>
<li>
<p>Optional: If you have configured a <code>/etc/foreman-installer/custom-hiera.yaml</code> file, Foreman applies these configuration settings.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that the configuration settings that are defined in the <code>/etc/foreman-installer/custom-hiera.yaml</code> file override the configuration settings that are defined in the tuning profiles.</p>
</div>
<div class="paragraph">
<p>Therefore, before applying a tuning profile, you must compare the configuration settings that are defined in the default tuning profile in <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/common.yaml</code>, the tuning profile that you want to apply and your <code>/etc/foreman-installer/custom-hiera.yaml</code> file, and remove any duplicated configuration from the <code>/etc/foreman-installer/custom-hiera.yaml</code> file.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">default</dt>
<dd>
<p>Number of hosts: 0&#8202;&#8211;&#8202;5000</p>
<div class="paragraph">
<p>RAM: 20G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 4</p>
</div>
</dd>
<dt class="hdlist1">medium</dt>
<dd>
<p>Number of hosts: 5001&#8202;&#8211;&#8202;10000</p>
<div class="paragraph">
<p>RAM: 32G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 8</p>
</div>
</dd>
<dt class="hdlist1">large</dt>
<dd>
<p>Number of hosts: 10001&#8202;&#8211;&#8202;20000</p>
<div class="paragraph">
<p>RAM: 64G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 16</p>
</div>
</dd>
<dt class="hdlist1">extra-large</dt>
<dd>
<p>Number of hosts: 20001&#8202;&#8211;&#8202;60000</p>
<div class="paragraph">
<p>RAM: 128G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 32</p>
</div>
</dd>
<dt class="hdlist1">extra-extra-large</dt>
<dd>
<p>Number of hosts: 60000+</p>
<div class="paragraph">
<p>RAM: 256G</p>
</div>
<div class="paragraph">
<p>Number of CPU cores: 48+</p>
</div>
</dd>
</dl>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Optional: If you have configured the <code>custom-hiera.yaml</code> file on Foreman&#160;server, back up the <code>/etc/foreman-installer/custom-hiera.yaml</code> file to <code>custom-hiera.original</code>.
You can use the backup file to restore the <code>/etc/foreman-installer/custom-hiera.yaml</code> file to its original state if it becomes corrupted:</p>
<div class="listingblock">
<div class="content">
<pre># cp /etc/foreman-installer/custom-hiera.yaml \
/etc/foreman-installer/custom-hiera.original</pre>
</div>
</div>
</li>
<li>
<p>Optional: If you have configured the <code>custom-hiera.yaml</code> file on Foreman&#160;server, review the definitions of the default tuning profile in <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/common.yaml</code> and the tuning profile that you want to apply in <code>/usr/share/foreman-installer/config/foreman.hiera/tuning/sizes/</code>.
Compare the configuration entries against the entries in your <code>/etc/foreman-installer/custom-hiera.yaml</code> file and remove any duplicated configuration settings in your <code>/etc/foreman-installer/custom-hiera.yaml</code> file.</p>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command with the <code>--tuning</code> option for the profile that you want to apply.
For example, to apply the medium tuning profile settings, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --tuning medium</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="requirements-for-installation-in-an-ipv4-network"><a class="anchor" href="#requirements-for-installation-in-an-ipv4-network"></a>1.10. Requirements for installation in an IPv4 network</h3>
<div class="paragraph">
<p>The following requirements apply to installations in an IPv4 network:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An IPv6 loopback must be configured on the base system.
The loopback is typically configured by default.
Do not disable it.</p>
</li>
<li>
<p>Do not disable IPv6 in kernel by adding the <code>ipv6.disable=1</code> kernel parameter.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-environment-for-installation-in-ipv6-network_foreman"><a class="anchor" href="#preparing-environment-for-installation-in-ipv6-network_foreman"></a>2. Preparing your environment for Foreman installation in an IPv6 network</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can install and use Foreman in an IPv6 network.
Before installing Foreman in an IPv6 network, view the limitations and ensure that you meet the requirements.</p>
</div>
<div class="paragraph">
<p>To provision hosts in an IPv6 network, after installing Foreman, you must also configure Foreman for the UEFI HTTP boot provisioning.
For more information, see <a href="#configuring-for-uefi-http-boot-provisioning-in-an-ipv6-network_foreman">Configuring Foreman for UEFI HTTP boot provisioning in an IPv6 network</a>.</p>
</div>
<div class="sect2">
<h3 id="limitations-of-installation-in-an-ipv6-network_foreman"><a class="anchor" href="#limitations-of-installation-in-an-ipv6-network_foreman"></a>2.1. Limitations of Foreman installation in an IPv6 network</h3>
<div class="paragraph">
<p>Foreman installation in an IPv6 network has the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can install Foreman and Smart&#160;Proxies in IPv6-only systems, dual-stack installation is not supported.</p>
</li>
<li>
<p>Although Foreman provisioning templates include IPv6 support for PXE and HTTP (iPXE) provisioning, the only tested and certified provisioning workflow is the UEFI HTTP Boot provisioning.
This limitation only relates to users who plan to use Foreman to provision hosts.</p>
</li>
<li>
<p>Foreman does not support configuring an HTTP proxy using a direct IPv6 address.
Instead, configure the HTTP proxy with a FQDN that resolves to the IPv6 address.
Using an IPv6 address as the HTTP proxy URL causes it to fail.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="requirements-for-installation-in-an-ipv6-network_foreman"><a class="anchor" href="#requirements-for-installation-in-an-ipv6-network_foreman"></a>2.2. Requirements for Foreman installation in an IPv6 network</h3>
<div class="paragraph">
<p>Before installing Foreman in an IPv6 network, ensure that you meet the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must deploy an external DHCP IPv6 server as a separate unmanaged service to bootstrap clients into GRUB2, which then configures IPv6 networking either using DHCPv6 or assigning static IPv6 address.
This is required because the DHCP server in Red&#160;Hat Enterprise Linux (ISC DHCP) does not provide an integration API for managing IPv6 records, therefore the Smart&#160;Proxy DHCP plugin that provides DHCP management is limited to IPv4 subnets.</p>
</li>
<li>
<p>Optional: If you rely on content from IPv4 networks, you must deploy an external IPv4 HTTP proxy server.
This is required to access Content Delivery Networks that distribute content only over IPv4 networks, therefore you must use this proxy to pull content into Foreman on your IPv6 network.</p>
</li>
<li>
<p>You must configure Foreman to use this dual stack (supporting both IPv4 and IPv6) HTTP proxy server as the default proxy.
For more information, see <a href="https://docs.theforeman.org/3.11/Installing_Server/index-katello.html#adding-a-default-http-proxy_foreman">Adding a Default HTTP Proxy to Foreman</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Installing_Server_Connected_foreman"><a class="anchor" href="#Installing_Server_Connected_foreman"></a>3. Installing Foreman&#160;server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the following procedures to install Foreman&#160;server and perform the initial configuration.</p>
</div>
<div class="paragraph">
<p>Note that the Foreman installation script is based on Puppet, which means that if you run the installation script more than once, it might overwrite any manual configuration changes.
⁠
To avoid this and determine which future changes apply, use the <code>--noop</code> argument when you run the installation script.
This argument ensures that no actual changes are made.
Potential changes are written to <code>/var/log/foreman-installer/katello.log</code>.</p>
</div>
<div class="paragraph">
<p>Files are always backed up and so you can revert any unwanted changes.
For example, in the foreman-installer logs, you can see an entry similar to the following about Filebucket:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/Stage[main]/Dhcp/File[/etc/dhcp/dhcpd.conf]: Filebucketed /etc/dhcp/dhcpd.conf to puppet with sum 622d9820b8e764ab124367c68f5fa3a1</pre>
</div>
</div>
<div class="paragraph">
<p>You can restore the previous file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># puppet filebucket -l \
restore /etc/dhcp/dhcpd.conf 622d9820b8e764ab124367c68f5fa3a1</pre>
</div>
</div>
<div class="sect2">
<h3 id="configuring-http-proxy-to-connect-to-cdn_foreman"><a class="anchor" href="#configuring-http-proxy-to-connect-to-cdn_foreman"></a>3.1. Configuring the HTTP proxy to connect to Red Hat CDN</h3>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Your network gateway and the HTTP proxy must allow access to the following hosts:</p>
</div>
<table id="host-names-for-http-proxy_foreman" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Host name</th>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subscription.rhsm.redhat.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cdn.redhat.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Foreman&#160;server uses SSL to communicate with the Red&#160;Hat CDN securely.
An SSL interception proxy interferes with this communication.
These hosts must be allowlisted on your HTTP proxy.</p>
</div>
<div class="paragraph">
<p>For a list of IP addresses used by the Red&#160;Hat CDN (cdn.redhat.com), see the Knowledgebase article <a href="https://access.redhat.com/articles/1525183">Public CIDR Lists for Red&#160;Hat</a> on the Red&#160;Hat Customer Portal.</p>
</div>
<div class="paragraph">
<p>To configure the Subscription Manager with the HTTP proxy, follow the procedure below.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, complete the following details in the <code>/etc/rhsm/rhsm.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none"># an http proxy server to use (enter server FQDN)
proxy_hostname = <em>http-proxy.example.com</em>

# port for http proxy server
proxy_port = 8080

# user name for authenticating to an http proxy, if needed
proxy_user =

# password for basic http proxy auth, if needed
proxy_password =</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-repositories_foreman"><a class="anchor" href="#configuring-repositories_foreman"></a>3.2. Configuring repositories</h3>
<div id="_tabs_1" class="openblock tabs is-loading">
<div class="title">Procedure</div>
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_enterprise_linux_9" class="tab">
<p>Enterprise Linux 9</p>
</li>
<li id="_tabs_1_enterprise_linux_8" class="tab">
<p>Enterprise Linux 8</p>
</li>
</ul>
</div>
<div id="_tabs_1_enterprise_linux_9--panel" class="tabpanel" aria-labelledby="_tabs_1_enterprise_linux_9">
<div id="configuring-repositories-el-9-dnf" class="olist arabic">
<ol class="arabic">
<li>
<p>Clear any metadata:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf clean all</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>foreman-release.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install https://yum.theforeman.org/releases/3.11/el9/x86_64/foreman-release.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>katello-repos-latest.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install https://yum.theforeman.org/katello/4.13/katello/el9/x86_64/katello-repos-latest.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>puppet7-release-el-9.noarch.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install https://yum.puppet.com/puppet7-release-el-9.noarch.rpm</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="_tabs_1_enterprise_linux_8--panel" class="tabpanel" aria-labelledby="_tabs_1_enterprise_linux_8">
<div id="configuring-repositories-el-8-dnf" class="olist arabic">
<ol class="arabic">
<li>
<p>Clear any metadata:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf clean all</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>foreman-release.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install https://yum.theforeman.org/releases/3.11/el8/x86_64/foreman-release.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>katello-repos-latest.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install https://yum.theforeman.org/katello/4.13/katello/el8/x86_64/katello-repos-latest.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>puppet7-release-el-8.noarch.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install https://yum.puppet.com/puppet7-release-el-8.noarch.rpm</pre>
</div>
</div>
</li>
<li>
<p>Enable the DNF modules:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module enable katello:el8</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If there is any warning about conflicts with Ruby or PostgreSQL while enabling <code>katello:el8</code> module, see
<a href="#troubleshooting-dnf-modules_foreman">Troubleshooting DNF modules</a>.
For more information about modules and lifecycle streams on Red&#160;Hat Enterprise Linux 8, see <a href="https://access.redhat.com/support/policy/updates/rhel-app-streams-life-cycle">Red&#160;Hat Enterprise Linux Application Streams Lifecycle</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify that the required repositories are enabled:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf repolist enabled</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-fapolicyd-on-server_foreman"><a class="anchor" href="#using-fapolicyd-on-server_foreman"></a>3.3. Optional: Using fapolicyd on Foreman&#160;server</h3>
<div class="paragraph">
<p>By enabling <code>fapolicyd</code> on your Foreman&#160;server, you can provide an additional layer of security by monitoring and controlling access to files and directories.
The fapolicyd daemon uses the RPM database as a repository of trusted binaries and scripts.</p>
</div>
<div class="paragraph">
<p>You can turn on or off the fapolicyd on your Foreman&#160;server or Smart&#160;Proxy&#160;server at any point.</p>
</div>
<div class="sect3">
<h4 id="installing-fapolicyd-on-server_foreman"><a class="anchor" href="#installing-fapolicyd-on-server_foreman"></a>3.3.1. Installing fapolicyd on Foreman&#160;server</h4>
<div class="paragraph">
<p>You can install <code>fapolicyd</code> along with Foreman&#160;server or can be installed on an existing Foreman&#160;server.
If you are installing <code>fapolicyd</code> along with the new Foreman&#160;server, the installation process will detect the fapolicyd in your Enterprise Linux host and deploy the Foreman&#160;server rules automatically.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure your host has access to the BaseOS repositories of Enterprise Linux.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>For a new installation, install fapolicyd:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install fapolicyd</pre>
</div>
</div>
</li>
<li>
<p>For an existing installation, install fapolicyd using dnf install:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install fapolicyd</pre>
</div>
</div>
</li>
<li>
<p>Start the <code>fapolicyd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl enable --now fapolicyd</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify that the <code>fapolicyd</code> service is running correctly:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl status fapolicyd</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">New Foreman&#160;server or Smart&#160;Proxy&#160;server installations</div>
<p>In case of new Foreman&#160;server or Smart&#160;Proxy&#160;server installation, follow the standard installation procedures after installing and enabling fapolicyd on your Enterprise Linux host.</p>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information on fapolicyd, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/security_hardening/assembly_blocking-and-allowing-applications-using-fapolicyd_security-hardening">Blocking and allowing applications using fapolicyd</a> in <em>Red&#160;Hat Enterprise Linux&#160;9 Security hardening</em> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/security_hardening/assembly_blocking-and-allowing-applications-using-fapolicyd_security-hardening">Blocking and allowing applications using fapolicyd</a> in <em>Red&#160;Hat Enterprise Linux&#160;8 Security hardening</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Installing_Server_Packages_foreman"><a class="anchor" href="#Installing_Server_Packages_foreman"></a>3.4. Installing Foreman&#160;server packages</h3>
<div id="configuring-foreman-repositories-el-dnf_el8" class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update all packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf upgrade</pre>
</div>
</div>
</li>
<li>
<p>Install <code>foreman-installer-katello</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install foreman-installer-katello</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-server_foreman"><a class="anchor" href="#configuring-server_foreman"></a>3.5. Configuring Foreman&#160;server</h3>
<div class="paragraph">
<p>Install Foreman&#160;server using the <code>foreman-installer</code> installation script.</p>
</div>
<div class="paragraph">
<p>This method is performed by running the installation script with one or more command options.
The command options override the corresponding default initial configuration options and are recorded in the Foreman answer file.
You can run the script as often as needed to configure any necessary options.</p>
</div>
<div class="sect3">
<h4 id="Configuring_Installation_foreman"><a class="anchor" href="#Configuring_Installation_foreman"></a>3.5.1. Configuring Foreman installation</h4>
<div class="paragraph">
<p>This initial configuration procedure creates an organization, location, user name, and password.
After the initial configuration, you can create additional organizations and locations if required.
The initial configuration also installs PostgreSQL databases on the same server.</p>
</div>
<div class="paragraph">
<p>The installation process can take tens of minutes to complete.
If you are connecting remotely to the system, use a utility such as <code>tmux</code> that allows suspending and reattaching a communication session so that you can check the installation progress in case you become disconnected from the remote system.
If you lose connection to the shell where the installation command is running, see the log at <code>/var/log/foreman-installer/katello.log</code> to determine if the process completed successfully.</p>
</div>
<div class="ulist">
<div class="title">Considerations</div>
<ul>
<li>
<p>Use the <code>foreman-installer --scenario katello --help</code> command to display the most commonly used options and any default values.</p>
</li>
<li>
<p>Use the <code>foreman-installer --scenario katello --full-help</code> command to display advanced options.</p>
</li>
<li>
<p>Specify a meaningful value for the option: <code>--foreman-initial-organization</code>.
This can be your company name.
An internal label that matches the value is also created and cannot be changed afterwards.
If you do not specify a value, an organization called <strong>Default Organization</strong> with the label <strong>Default_Organization</strong> is created.
You can rename the organization name but not the label.</p>
</li>
<li>
<p>By default, all configuration files configured by the installer are managed.
When <code>foreman-installer</code> runs, it overwrites any manual changes to the managed files with the intended values.
This means that running the installer on a broken system should restore it to working order, regardless of changes made.
For more information on how to apply custom configuration on other services, see <a href="https://docs.theforeman.org/3.11/Installing_Server/index-katello.html#applying-custom-configuration_foreman">Applying Custom Configuration to Foreman</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command with any additional options that you want to use:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario katello \
--foreman-initial-organization "<em>My_Organization</em>" \
--foreman-initial-location "<em>My_Location</em>" \
--foreman-initial-admin-username <em>admin_user_name</em> \
--foreman-initial-admin-password <em>admin_password</em></pre>
</div>
</div>
<div class="paragraph">
<p>The script displays its progress and writes logs to <code>/var/log/foreman-installer/katello.log</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performing-additional-configuration-on-server_foreman"><a class="anchor" href="#performing-additional-configuration-on-server_foreman"></a>4. Performing additional configuration on Foreman&#160;server</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configuring-foreman-server-to-consume-content-from-a-custom-cdn_foreman"><a class="anchor" href="#configuring-foreman-server-to-consume-content-from-a-custom-cdn_foreman"></a>4.1. Configuring Foreman&#160;Server to consume content from a custom CDN</h3>
<div class="paragraph">
<p>If you have an internal Content Delivery Network (CDN) or serve content on an accessible web server, you can configure your Foreman&#160;server to consume Red&#160;Hat repositories from this CDN server instead of the Red&#160;Hat CDN.
A CDN server can be any web server that mirrors repositories in the same directory structure as the Red&#160;Hat CDN.</p>
</div>
<div class="paragraph">
<p>You can configure the source of content for each organization.
Foreman recognizes automatically which Red&#160;Hat repositories from the subscription manifest in your organization are available on your CDN server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have a CDN server that provides Red&#160;Hat content and is accessible by Foreman&#160;server.</p>
</li>
<li>
<p>If your CDN server uses HTTPS, ensure you have uploaded the SSL certificate into Foreman.
For more information, see <a href="https://docs.theforeman.org/3.11/Managing_Content/index-katello.html#Importing_Custom_SSL_Certificates_content-management">Importing Custom SSL Certificates</a> in <em>Managing content</em>.</p>
</li>
<li>
<p>You have uploaded a manifest to your organization.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Content</strong> &gt; <strong>Subscriptions</strong>.</p>
</li>
<li>
<p>Click <strong>Manage Manifest</strong>.</p>
</li>
<li>
<p>Select the <strong>CDN Configuration</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Custom CDN</strong> tab.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the URL of your CDN server from which you want Foreman&#160;server to consume Red&#160;Hat repositories.</p>
</li>
<li>
<p>Optional: In the <strong>SSL CA Content Credential</strong>, select the SSL certificate of the CDN server.</p>
</li>
<li>
<p>Click <strong>Update</strong>.</p>
</li>
<li>
<p>You can now enable Red&#160;Hat repositories consumed from your internal CDN server.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Connect to your Foreman&#160;server using SSH.</p>
</li>
<li>
<p>Set CDN configuration to your custom CDN server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer organization configure-cdn --name="<em>My_Organization</em>" \
--type=custom_cdn \
--url https://<em>my-cdn.example.com</em> \
--ssl-ca-credential-id "<em>My_CDN_CA_Cert_ID</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/3.11/Planning_for_Project/index-katello.html#chap-Architecture_Guide-Content_Delivery_Network_Structure">Content Delivery Network Structure</a> in <em>Planning for Foreman</em></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-for-uefi-http-boot-provisioning-in-an-ipv6-network_foreman"><a class="anchor" href="#configuring-for-uefi-http-boot-provisioning-in-an-ipv6-network_foreman"></a>4.2. Configuring Foreman for UEFI HTTP boot provisioning in an IPv6 network</h3>
<div class="paragraph">
<p>Use this procedure to configure Foreman to provision hosts in an IPv6 network with UEFI HTTP Boot provisioning.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your clients can access DHCP and HTTP servers.</p>
</li>
<li>
<p>Ensure that the UDP ports 67 and 68 are accessible by clients so clients can send DHCP requests and receive DHCP offers.</p>
</li>
<li>
<p>Ensure that the TCP port 8000 is open for clients to download files and Kickstart templates from Foreman and Smart&#160;Proxies.</p>
</li>
<li>
<p>Ensure that the host provisioning interface subnet has an HTTP Boot Smart&#160;Proxy, and Templates Smart&#160;Proxy set.
For more information, see <a href="https://docs.theforeman.org/3.11/Provisioning_Hosts/index-katello.html#Adding_a_Subnet_to_Server_provisioning">Adding a Subnet to Foreman&#160;server</a> in <em>Provisioning hosts</em>.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and ensure that the <strong>Token duration</strong> setting is not set to <strong>0</strong>.
Foreman cannot identify clients that are booting from the network by a remote IPv6 address because of unmanaged DHCPv6 service, therefore provisioning tokens must be enabled.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>You must disable DHCP management in the installer or not use it.</p>
</li>
<li>
<p>For all IPv6 subnets created in Foreman, set the <strong>DHCP Smart&#160;Proxy</strong> to blank.</p>
</li>
<li>
<p>Optional: If the host and the DHCP server are separated by a router, configure the DHCP relay agent and point to the DHCP server.</p>
</li>
<li>
<p>On Foreman or Smart&#160;Proxy from which you provision, update the <code>grub2-efi</code> package to the latest version:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf upgrade grub2-efi</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Server_with_an_HTTP_Proxy_foreman"><a class="anchor" href="#Configuring_Server_with_an_HTTP_Proxy_foreman"></a>4.3. Configuring Foreman&#160;server with an HTTP proxy</h3>
<div class="paragraph">
<p>Use the following procedures to configure Foreman with an HTTP proxy.</p>
</div>
<div class="sect3">
<h4 id="adding-a-default-http-proxy_foreman"><a class="anchor" href="#adding-a-default-http-proxy_foreman"></a>4.3.1. Adding a default HTTP proxy to Foreman</h4>
<div class="paragraph">
<p>If your network uses an HTTP Proxy, you can configure Foreman&#160;server to use an HTTP proxy for requests to the Red&#160;Hat Content Delivery Network (CDN) or another content source.
Use the FQDN instead of the IP address where possible to avoid losing connectivity because of network changes.</p>
</div>
<div class="paragraph">
<p>The following procedure configures a proxy only for downloading content for Foreman.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-a-default-http-proxy_foreman">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>HTTP Proxies</strong>.</p>
</li>
<li>
<p>Click <strong>New HTTP Proxy</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name for the HTTP proxy.</p>
</li>
<li>
<p>In the <strong>Url</strong> field, enter the URL of the HTTP proxy in the following format: <code>https://http-proxy.example.com:8080</code>.</p>
</li>
<li>
<p>Optional: If authentication is required, in the <strong>Username</strong> field, enter the username to authenticate with.</p>
</li>
<li>
<p>Optional: If authentication is required, in the <strong>Password</strong> field, enter the password to authenticate with.</p>
</li>
<li>
<p>To test connection to the proxy, click <strong>Test Connection</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Content</strong> tab.</p>
</li>
<li>
<p>Set the <strong>Default HTTP Proxy</strong> setting to the created HTTP proxy.</p>
</li>
</ol>
</div>
<div id="cli-adding-a-default-http-proxy_foreman" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Verify that the <code>http_proxy</code>, <code>https_proxy</code>, and <code>no_proxy</code> variables are not set:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># unset http_proxy https_proxy no_proxy</pre>
</div>
</div>
</li>
<li>
<p>Add an HTTP proxy entry to Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer http-proxy create \
--name=<em>My_HTTP_Proxy</em> \
--username=<em>My_HTTP_Proxy_User_Name</em> \
--password=<em>My_HTTP_Proxy_Password</em> \
--url http://<em>http-proxy.example.com</em>:8080</pre>
</div>
</div>
</li>
<li>
<p>Configure Foreman to use this HTTP proxy by default:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set \
--name=content_default_http_proxy \
--value=<em>My_HTTP_Proxy</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-selinux-to-ensure-access-on-custom-ports_foreman"><a class="anchor" href="#configuring-selinux-to-ensure-access-on-custom-ports_foreman"></a>4.3.2. Configuring SELinux to ensure access to Foreman on custom ports</h4>
<div class="paragraph">
<p>SELinux ensures access of Foreman only to specific ports.
In the case of the HTTP cache, the TCP ports are 8080, 8118, 8123, and 10001&#8202;&#8211;&#8202;10010.
If you use a port that does not have SELinux type <code>http_cache_port_t</code>, complete the following steps.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman, to verify the ports that are permitted by SELinux for the HTTP cache, enter a command as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># semanage port -l | grep http_cache
http_cache_port_t       tcp    8080, 8118, 8123, 10001-10010
<em>[output truncated]</em></pre>
</div>
</div>
</li>
<li>
<p>To configure SELinux to permit a port for the HTTP cache, for example 8088, enter a command as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># semanage port -a -t http_cache_port_t -p tcp 8088</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="using-an-http-proxy-for-all-http-requests_foreman"><a class="anchor" href="#using-an-http-proxy-for-all-http-requests_foreman"></a>4.3.3. Using an HTTP proxy for all Foreman HTTP requests</h4>
<div class="paragraph">
<p>If your Foreman&#160;server must remain behind a firewall that blocks HTTP and HTTPS, you can configure a proxy for communication with external systems, including compute resources.</p>
</div>
<div class="paragraph">
<p>Note that if you are using compute resources for provisioning, and you want to use a different HTTP proxy with the compute resources, the proxy that you set for all Foreman communication takes precedence over the proxies that you set for compute resources.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>In the <strong>HTTP(S) proxy</strong> row, select the adjacent <strong>Value</strong> column and enter the proxy URL.</p>
</li>
<li>
<p>Click the tick icon to save your changes.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name=http_proxy --value=<em>Proxy_URL</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="excluding-hosts-from-receiving-proxied-requests_foreman"><a class="anchor" href="#excluding-hosts-from-receiving-proxied-requests_foreman"></a>4.3.4. Excluding hosts from receiving proxied requests</h4>
<div class="paragraph">
<p>If you use an HTTP Proxy for all Foreman HTTP or HTTPS requests, you can prevent certain hosts from communicating through the proxy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>In the <strong>HTTP(S) proxy except hosts</strong> row, select the adjacent <strong>Value</strong> column and enter the names of one or more hosts that you want to exclude from proxy requests.</p>
</li>
<li>
<p>Click the tick icon to save your changes.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name=http_proxy_except_list --value=[<em>hostname1.hostname2...</em>]</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-proxy-for-pxe-files_foreman"><a class="anchor" href="#configuring-proxy-for-pxe-files_foreman"></a>4.3.5. Configuring a proxy for PXE file downloads</h4>
<div class="paragraph">
<p>For Red Hat content served through the Content Delivery Network, Smart&#160;Proxy downloads PXE files from synchronized repositories.
However, when configuring and installing an operating system using Installation Media, Smart&#160;Proxy connects directly using the <code>wget</code> utility.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your TFTP Smart&#160;Proxy, verify the ports that are permitted by SELinux for the HTTP cache by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl edit foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Configure the HTTP proxy in <code>/etc/systemd/system/foreman-proxy.service.d/overrides.conf</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none">[Service]
Environment="http_proxy=http://<em>http-proxy.example.com:8080</em>"
Environment="https_proxy=https://<em>http-proxy.example.com:8443</em>"</code></pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>foreman-proxy</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Create a host or enter build mode for an existing host to re-download PXE files to the TFTP Smart&#160;Proxy.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="resetting-the-http-proxy_foreman"><a class="anchor" href="#resetting-the-http-proxy_foreman"></a>4.3.6. Resetting the HTTP proxy</h4>
<div class="paragraph">
<p>If you want to reset the current HTTP proxy setting, unset the <strong>Default HTTP Proxy</strong> setting.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Content</strong> tab.</p>
</li>
<li>
<p>Set the <strong>Default HTTP Proxy</strong> setting to <strong>no global default</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Set the <code>content_default_http_proxy</code> setting to an empty string:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name=content_default_http_proxy --value=""</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-power-management-on-hosts_foreman"><a class="anchor" href="#enabling-power-management-on-hosts_foreman"></a>4.4. Enabling power management on hosts</h3>
<div class="paragraph">
<p>To perform power management tasks on hosts using the intelligent platform management interface (IPMI) or a similar protocol, you must enable the baseboard management controller (BMC) module on Foreman&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All hosts must have a network interface of BMC type.
Foreman&#160;server uses this NIC to pass the appropriate credentials to the host.
For more information, see <a href="https://docs.theforeman.org/3.11/Managing_Hosts/index-katello.html#Adding_a_Baseboard_Management_Controller_Interface_managing-hosts">Adding a Baseboard Management Controller (BMC) Interface</a> in <em>Managing hosts</em>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable BMC, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-bmc "true" \
--foreman-proxy-bmc-default-provider "freeipmi"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-dns-dhcp-and-tftp_foreman"><a class="anchor" href="#configuring-dns-dhcp-and-tftp_foreman"></a>4.5. Configuring DNS, DHCP, and TFTP</h3>
<div class="paragraph">
<p>You can manage DNS, DHCP, and TFTP centrally within the Foreman environment, or you can manage them independently after disabling their maintenance on Foreman.
You can also run DNS, DHCP, and TFTP externally, outside of the Foreman environment.</p>
</div>
<div class="sect3">
<h4 id="configuring-dns-dhcp-and-tftp-on-productname_foreman"><a class="anchor" href="#configuring-dns-dhcp-and-tftp-on-productname_foreman"></a>4.5.1. Configuring DNS, DHCP, and TFTP on Foreman&#160;server</h4>
<div class="paragraph">
<p>To configure the DNS, DHCP, and TFTP services on Foreman&#160;server, use the <code>foreman-installer</code> command with the options appropriate for your environment.</p>
</div>
<div class="paragraph">
<p>Any changes to the settings require entering the <code>foreman-installer</code> command again.
You can enter the command multiple times and each time it updates all configuration files with the changed values.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the following information is available to you:</p>
<div class="ulist">
<ul>
<li>
<p>DHCP IP address ranges</p>
</li>
<li>
<p>DHCP gateway IP address</p>
</li>
<li>
<p>DHCP nameserver IP address</p>
</li>
<li>
<p>DNS information</p>
</li>
<li>
<p>TFTP server name</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use the FQDN instead of the IP address where possible in case of network changes.</p>
</li>
<li>
<p>Contact your network administrator to ensure that you have the correct settings.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the <code>foreman-installer</code> command with the options appropriate for your environment.
The following example shows configuring full provisioning services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-dns true \
--foreman-proxy-dns-managed true \
--foreman-proxy-dns-zone <em>example.com</em> \
--foreman-proxy-dns-reverse <em>2.0.192.in-addr.arpa</em> \
--foreman-proxy-dhcp true \
--foreman-proxy-dhcp-managed true \
--foreman-proxy-dhcp-range "<em>192.0.2.100</em> <em>192.0.2.150</em>" \
--foreman-proxy-dhcp-gateway <em>192.0.2.1</em> \
--foreman-proxy-dhcp-nameservers <em>192.0.2.2</em> \
--foreman-proxy-tftp true \
--foreman-proxy-tftp-managed true \
--foreman-proxy-tftp-servername <em>192.0.2.3</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can monitor the progress of the <code>foreman-installer</code> command displayed in your prompt.
You can view the logs in <code>/var/log/foreman-installer/katello.log</code>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the <code>foreman-installer</code> command, enter <code>foreman-installer --help</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="disabling-dns-dhcp-tftp-for-unmanaged-networks_foreman"><a class="anchor" href="#disabling-dns-dhcp-tftp-for-unmanaged-networks_foreman"></a>4.5.2. Disabling DNS, DHCP, and TFTP for unmanaged networks</h4>
<div class="paragraph">
<p>If you want to manage TFTP, DHCP, and DNS services manually, you must prevent Foreman from maintaining these services on the operating system and disable orchestration to avoid DHCP and DNS validation errors.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Disabling these Smart&#160;Proxy features means Foreman will no longer orchestrate DNS, DHCP, and TFTP, but it does not stop or remove the corresponding services.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Disable DHCP, DNS, and TFTP integration on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dhcp false \
--foreman-proxy-dns false \
--foreman-proxy-tftp false</pre>
</div>
</div>
</li>
<li>
<p>Disable the Smart&#160;Proxy integration for every subnet:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>.</p>
</li>
<li>
<p>Select a subnet.</p>
</li>
<li>
<p>On the <strong>Smart&#160;Proxies</strong> tab, clear the <strong>DHCP Smart&#160;Proxy</strong>, <strong>TFTP Smart&#160;Proxy</strong>, and <strong>Reverse DNS Smart&#160;Proxy</strong> fields.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and select a domain.</p>
</li>
<li>
<p>Clear the <strong>DNS Smart&#160;Proxy</strong> field.</p>
</li>
<li>
<p>Optional: If you use a DHCP service supplied by a third party, configure your DHCP server to pass the following options:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Option 66: <em>IP address of Foreman or Smart&#160;Proxy</em>
Option 67: /pxelinux.0</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about DHCP options, see <a href="https://tools.ietf.org/html/rfc2132">RFC 2132</a>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Foreman does not perform orchestration when a Smart&#160;Proxy is not set for a given subnet and domain.
When enabling or disabling Smart&#160;Proxy associations, orchestration commands for existing hosts can fail if the expected records and configuration files are not present.
When associating a Smart&#160;Proxy to turn orchestration on, ensure the required DHCP and DNS records as well as the TFTP files are in place for the existing Foreman hosts in order to prevent host deletion failures in the future.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuring-dns-dhcp-and-tftp-additional-resources_foreman"><a class="anchor" href="#configuring-dns-dhcp-and-tftp-additional-resources_foreman"></a>4.5.3. Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p>For more information about configuring DNS, DHCP, and TFTP externally, see <a href="#configuring-external-services">Configuring Foreman&#160;server with external services</a>.</p>
</li>
<li>
<p>For more information about configuring DHCP, DNS, and TFTP services, see <a href="https://docs.theforeman.org/3.11/Provisioning_Hosts/index-katello.html#Configuring_Network_Services_provisioning">Configuring Network Services</a> in <em>Provisioning hosts</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Server_for_Outgoing_Emails_foreman"><a class="anchor" href="#Configuring_Server_for_Outgoing_Emails_foreman"></a>4.6. Configuring Foreman&#160;server for outgoing emails</h3>
<div class="paragraph">
<p>To send email messages from Foreman&#160;server, you can use either an SMTP server, or the <code>sendmail</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Some SMTP servers with anti-spam protection or grey-listing features are known to cause problems.
To setup outgoing email with such a service either install and configure a vanilla SMTP service on Foreman&#160;server for relay or use the <code>sendmail</code> command instead.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Click the <strong>Email</strong> tab and set the configuration options to match your preferred delivery method.
The changes have an immediate effect.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The following example shows the configuration options for using an SMTP server:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Using an SMTP server as a delivery method</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Example value</th>
<th class="tableblock halign-left valign-top">Additional information</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delivery method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>smtp.example.com</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP HELO/EHLO domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>example.com</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>password</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the login credentials for the SMTP server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user@example.com</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the login credentials for the SMTP server.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>The following example uses <strong>gmail.com</strong> as an SMTP server:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Using gmail.com as an SMTP server</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Example value</th>
<th class="tableblock halign-left valign-top">Additional information</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delivery method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">smtp.gmail.com</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">plain</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP HELO/EHLO domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">smtp.gmail.com</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP enable StartTLS auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>app password</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the Google app password.
For more information, see <a href="https://support.google.com/mail/answer/185833">Sign in with app passwords</a> in <em>Google Help Center</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">587</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user</em>@gmail.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the Google account name.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>The following example uses the <code>sendmail</code> command as a delivery method:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Using sendmail as a delivery method</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Example value</th>
<th class="tableblock halign-left valign-top">Additional information</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delivery method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sendmail</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sendmail location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/sbin/sendmail</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">For security reasons, both Sendmail location and Sendmail argument settings are read-only and can be only set in <code>/etc/foreman/settings.yaml</code>.
Both settings currently cannot be set via <code>foreman-installer</code>.
This is being tracked in <a href="https://projects.theforeman.org/issues/33543">issue #33543</a>.
For more information see the <strong>sendmail 1</strong> man page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sendmail arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-i</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</li>
<li>
<p>If you decide to send email using an SMTP server which uses TLS authentication, also perform one of the following steps:</p>
<div class="ulist">
<ul>
<li>
<p>Mark the CA certificate of the SMTP server as trusted.
To do so, execute the following commands on Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp mailca.crt /etc/pki/ca-trust/source/anchors/
# update-ca-trust extract</pre>
</div>
</div>
<div class="paragraph">
<p>Where <code><em>mailca.crt</em></code> is the CA certificate of the SMTP server.</p>
</div>
</li>
<li>
<p>Alternatively, in the Foreman web UI, set the <code>SMTP enable StartTLS auto</code> option to <code>No</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Test email</strong> to send a test message to the user&#8217;s email address to confirm the configuration is working.
If a message fails to send, the Foreman web UI displays an error.
See the log at <code>/var/log/foreman/production.log</code> for further details.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For information on configuring email notifications for individual users or user groups, see <a href="https://docs.theforeman.org/3.11/Administering_Project/index-katello.html#Configuring_Email_Notification_Preferences_admin">Configuring Email Notification Preferences</a> in <em>Administering Foreman</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-an-alternate-cname_foreman"><a class="anchor" href="#configuring-an-alternate-cname_foreman"></a>4.7. Configuring an alternate CNAME for Foreman</h3>
<div class="paragraph">
<p>You can configure an alternate CNAME for Foreman.
This might be useful if you want to deploy the Foreman web interface on a different domain name than the one that is used by client systems to connect to Foreman.
You must plan the alternate CNAME configuration in advance prior to installing Smart&#160;Proxies and registering hosts to Foreman to avoid redeploying new certificates to hosts.</p>
</div>
<div class="sect3">
<h4 id="configuring-foreman-with-an-alternate-cname_foreman"><a class="anchor" href="#configuring-foreman-with-an-alternate-cname_foreman"></a>4.7.1. Configuring Foreman with an alternate CNAME</h4>
<div class="paragraph">
<p>Use this procedure to configure Foreman with an alternate CNAME.
Note that the procedures for users of a default Foreman certificate and custom certificate differ.</p>
</div>
<div class="ulist">
<div class="title">For default Foreman certificate users</div>
<ul>
<li>
<p>If you have installed Foreman with a default Foreman certificate and want to configure Foreman with an alternate CNAME, enter the following command on Foreman to generate a new default Foreman SSL certificate with an additional CNAME.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --certs-cname <em>alternate_fqdn</em> --certs-update-server</pre>
</div>
</div>
</li>
<li>
<p>If you have not installed Foreman, you can add the <code>--certs-cname <em>alternate_fqdn</em></code> option to the <code>foreman-installer</code> command to install Foreman with an alternate CNAME.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">For custom certificate users</div>
<p>If you use Foreman with a custom certificate, when creating a custom certificate, include the alternate CNAME records to the custom certificate.
For more information, see <a href="https://docs.theforeman.org/3.11/Installing_Server/index-katello.html#creating-a-custom-ssl-certificate_foreman">Creating a Custom SSL Certificate for Foreman&#160;server</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-hosts-to-use-an-alternate-cname-for-content-management_foreman"><a class="anchor" href="#configuring-hosts-to-use-an-alternate-cname-for-content-management_foreman"></a>4.7.2. Configuring hosts to use an alternate Foreman CNAME for content management</h4>
<div class="paragraph">
<p>If Foreman is configured with an alternate CNAME, you can configure hosts to use the alternate Foreman CNAME for content management.
To do this, you must point hosts to the alternate Foreman CNAME prior to registering the hosts to Foreman.
You can do this using the bootstrap script or manually.</p>
</div>
<div class="paragraph">
<div class="title">Configuring hosts with the bootstrap script</div>
<p>On the host, run the bootstrap script with the <code>--server <em>alternate_fqdn.example.com</em></code> option to register the host to the alternate Foreman CNAME:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ./bootstrap.py --server <em>alternate_fqdn.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Configuring hosts manually</div>
<p>On the host, edit the <code>/etc/rhsm/rhsm.conf</code> file to update <code>hostname</code> and <code>baseurl</code> settings to point to the alternate host name, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none">[server]
# Server hostname:
hostname = <em>alternate_fqdn.example.com</em>

<em>content omitted</em>

[rhsm]
# Content base URL:
baseurl=https://<em>alternate_fqdn.example.com</em>/pulp/content/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can register the host with the <code>subscription-manager</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Server_with_a_Custom_SSL_Certificate"><a class="anchor" href="#Configuring_Server_with_a_Custom_SSL_Certificate"></a>4.8. Configuring Foreman&#160;server with a custom SSL certificate</h3>
<div class="paragraph">
<p>By default, Foreman uses a self-signed SSL certificate to enable encrypted communications between Foreman&#160;server, external Smart&#160;Proxy&#160;servers, and all hosts.
If you cannot use a Foreman self-signed certificate, you can configure Foreman&#160;server to use an SSL certificate signed by an external certificate authority (CA).</p>
</div>
<div class="paragraph">
<p>When you configure Foreman with custom SSL certificates, you must fulfill the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must use the privacy-enhanced mail (PEM) encoding for the SSL certificates.</p>
</li>
<li>
<p>You must not use the same SSL certificate for both Foreman&#160;server and Smart&#160;Proxy&#160;server.</p>
</li>
<li>
<p>The same CA must sign certificates for Foreman&#160;server and Smart&#160;Proxy&#160;server.</p>
</li>
<li>
<p>An SSL certificate must not also be a CA certificate.</p>
</li>
<li>
<p>An SSL certificate must include a subject alt name (SAN) entry that matches the common name (CN).</p>
</li>
<li>
<p>An SSL certificate must be allowed for Key Encipherment using a Key Usage extension.</p>
</li>
<li>
<p>An SSL certificate must not have a shortname as the CN.</p>
</li>
<li>
<p>You must not set a passphrase for the private key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure your Foreman&#160;server with a custom certificate, complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#creating-a-custom-ssl-certificate_foreman">Creating a custom SSL certificate for Foreman&#160;server</a></p>
</li>
<li>
<p><a href="#Deploying_a_Custom_SSL_Certificate_to_Server_foreman">Deploying a custom SSL certificate to Foreman&#160;server</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-hosts_foreman">Deploying a SSL certificate to hosts</a></p>
</li>
<li>
<p>If you have external Smart&#160;Proxy&#160;servers registered to Foreman&#160;server, configure them with custom SSL certificates.
For more information, see <a href="https://docs.theforeman.org/3.11/Installing_Proxy/index-katello.html#configuring-capsule-custom-server-certificate_smart-proxy">Configuring Smart&#160;Proxy&#160;server with a Custom SSL Certificate</a> in <em>Installing a Smart&#160;Proxy&#160;Server 3.11 on Enterprise Linux</em>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="creating-a-custom-ssl-certificate_foreman"><a class="anchor" href="#creating-a-custom-ssl-certificate_foreman"></a>4.8.1. Creating a custom SSL certificate for Foreman&#160;server</h4>
<div class="paragraph">
<p>Use this procedure to create a custom SSL certificate for Foreman&#160;server.
If you already have a custom SSL certificate for Foreman&#160;server, skip this procedure.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To store all the source certificate files, create a directory that is accessible only to the <code>root</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/foreman_cert</pre>
</div>
</div>
</li>
<li>
<p>Create a private key with which to sign the certificate signing request (CSR).</p>
<div class="paragraph">
<p>Note that the private key must be unencrypted.
If you use a password-protected private key, remove the private key password.</p>
</div>
<div class="paragraph">
<p>If you already have a private key for this Foreman&#160;server, skip this step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl genrsa -out <code>/root/foreman_cert/foreman_cert_key.pem</code> 4096</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/root/foreman_cert/openssl.cnf</code> configuration file for the CSR and include the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[ req ]
req_extensions = v3_req
distinguished_name = req_distinguished_name
prompt = no

[ req_distinguished_name ]
commonName = <em>foreman.example.com</em>

[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth, clientAuth
subjectAltName = @alt_names

[ alt_names ]
DNS.1 = <em>foreman.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>[ v3_req ]</code> parameters and their purpose, see <a href="https://www.rfc-editor.org/rfc/rfc5280">RFC 5280: Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>.</p>
</div>
</li>
<li>
<p>Optional: If you want to add Distinguished Name (DN) details to the CSR, add the following information to the <code>[ req_distinguished_name ]</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[req_distinguished_name]
CN = <em>foreman.example.com</em>
countryName =<em>My_Country_Name</em> <b class="conum">(1)</b>
stateOrProvinceName = <em>My_State_Or_Province_Name</em> <b class="conum">(2)</b>
localityName = <em>My_Locality_Name</em> <b class="conum">(3)</b>
organizationName = <em>My_Organization_Or_Company_Name</em>
organizationalUnitName = <em>My_Organizational_Unit_Name</em> <b class="conum">(4)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Two letter code</p>
</li>
<li>
<p>Full name</p>
</li>
<li>
<p>Full name (example: New York)</p>
</li>
<li>
<p>Division responsible for the certificate (example: IT department)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Generate CSR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl req -new \
-key <em>/root/foreman_cert/foreman_cert_key.pem</em> \ <b class="conum">(1)</b>
-config <em>/root/foreman_cert/openssl.cnf</em> \ <b class="conum">(2)</b>
-out <em>/root/foreman_cert/foreman_cert_csr.pem</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to the private key</p>
</li>
<li>
<p>Path to the configuration file</p>
</li>
<li>
<p>Path to the CSR to generate</p>
</li>
</ol>
</div>
</li>
<li>
<p>Send the certificate signing request to the certificate authority (CA).
The same CA must sign certificates for Foreman&#160;server and Smart&#160;Proxy&#160;server.</p>
<div class="paragraph">
<p>When you submit the request, specify the lifespan of the certificate.
The method for sending the certificate request varies, so consult the CA for the preferred method.
In response to the request, you can expect to receive a CA bundle and a signed certificate, in separate files.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Deploying_a_Custom_SSL_Certificate_to_Server_foreman"><a class="anchor" href="#Deploying_a_Custom_SSL_Certificate_to_Server_foreman"></a>4.8.2. Deploying a custom SSL certificate to Foreman&#160;server</h4>
<div class="paragraph">
<p>Use this procedure to configure your Foreman&#160;server to use a custom SSL certificate signed by a Certificate Authority.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Do not store the SSL certificates or .tar bundles in <code>/tmp</code> or <code>/var/tmp</code> directory.
The operating system removes files from these directories periodically.
As a result, <code>foreman-installer</code> fails to execute while enabling features or upgrading Foreman&#160;server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Update certificates on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--certs-server-cert "<em>/root/foreman_cert/foreman_cert.pem</em>" \ <b class="conum">(1)</b>
--certs-server-key "<em>/root/foreman_cert/foreman_cert_key.pem</em>" \ <b class="conum">(2)</b>
--certs-server-ca-cert "<em>/root/foreman_cert/ca_cert_bundle.pem</em>" \ <b class="conum">(3)</b>
--certs-update-server --certs-update-server-ca</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to Foreman&#160;server certificate file that is signed by a Certificate Authority.</p>
</li>
<li>
<p>Path to the private key that was used to sign Foreman&#160;server certificate.</p>
</li>
<li>
<p>Path to the Certificate Authority bundle.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>On a computer with network access to Foreman&#160;server, navigate to the following URL: <code>https://foreman.example.com</code>.</p>
</li>
<li>
<p>In your browser, view the certificate details to verify the deployed certificate.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deploying-a-custom-ssl-certificate-to-hosts_foreman"><a class="anchor" href="#deploying-a-custom-ssl-certificate-to-hosts_foreman"></a>4.8.3. Deploying a SSL certificate to hosts</h4>
<div class="paragraph">
<p>After you configure Foreman to use a SSL certificate, you must deploy the certificate to hosts registered to Foreman.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Update the SSL certificate on each host:</p>
<div class="ulist">
<ul>
<li>
<p>On Debian and Ubuntu:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># wget http://<em>foreman.example.com</em>/pub/katello-rhsm-consumer
# chmod +x katello-rhsm-consumer
# ./katello-rhsm-consumer</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 8+:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install http://<em>foreman.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 7:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install http://<em>foreman.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
<li>
<p>On OpenSUSE and SUSE Linux Enterprise Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># zypper install http://<em>foreman.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resetting-custom-ssl-certificate-to-default-self-signed-certificate-on-foreman_foreman"><a class="anchor" href="#resetting-custom-ssl-certificate-to-default-self-signed-certificate-on-foreman_foreman"></a>4.9. Resetting SSL certificate to default self-signed certificate on Foreman&#160;server</h3>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Reset the SSL certificate to default self-signed certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --certs-reset</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Verify that the following parameters in <code>/etc/foreman-installer/scenarios.d/foreman-answers.yaml</code> have no values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>server_cert:</p>
</li>
<li>
<p>server_key:</p>
</li>
<li>
<p>server_cert_req:</p>
</li>
<li>
<p>server_ca_cert:</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/3.11/Installing_Proxy/index-katello.html#reset-custom-ssl-certificate-to-default-self-signed-certificate-on-smart-proxy_smart-proxy">Reset SSL certificate to default self-signed certificate on Smart&#160;Proxy&#160;server</a> in <em>Installing a Smart&#160;Proxy&#160;Server 3.11 on Enterprise Linux</em>.</p>
</li>
<li>
<p><a href="https://docs.theforeman.org/3.11/Managing_Hosts/index-katello.html#reset-custom-ssl-certificate-to-default-self-signed-certificate-on-hosts_managing-hosts">Reset SSL certificate to default self-signed certificate on hosts</a> in <em>Managing hosts</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-external-databases_foreman"><a class="anchor" href="#using-external-databases_foreman"></a>4.10. Using external databases with Foreman</h3>
<div class="paragraph">
<p>As part of the installation process for Foreman, the <strong>foreman-installer</strong> command installs PostgreSQL databases on the same server as Foreman.
In certain Foreman deployments, using external databases instead of the default local databases can help with the server load.</p>
</div>
<div class="paragraph">
<p>To create and use external databases for Foreman, you must complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#preparing-a-host-for-external-databases_foreman">Preparing a host for external databases</a>.
Prepare a host for the external databases.</p>
</li>
<li>
<p><a href="#installing-postgresql_foreman">Installing PostgreSQL</a>.
Prepare PostgreSQL with databases for Foreman, Candlepin and Pulp with dedicated users owning them.</p>
</li>
<li>
<p><a href="#Configuring_Server_to_Use_External_Databases_foreman">Configuring Foreman&#160;server to use external databases</a>.
Edit the parameters of <code>foreman-installer</code> to point to the new databases, and run <code>foreman-installer</code>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="postgresql-as-an-external-database-considerations_foreman"><a class="anchor" href="#postgresql-as-an-external-database-considerations_foreman"></a>4.10.1. PostgreSQL as an external database considerations</h4>
<div class="paragraph">
<p>Foreman, Katello, and Candlepin use the PostgreSQL database.
If you want to use PostgreSQL as an external database, the following information can help you decide if this option is right for your Foreman configuration.
Foreman supports PostgreSQL version 12.</p>
</div>
<div class="ulist">
<div class="title">Advantages of external PostgreSQL</div>
<ul>
<li>
<p>Increase in free memory and free CPU on Foreman</p>
</li>
<li>
<p>Flexibility to set <code>shared_buffers</code> on the PostgreSQL database to a high number without the risk of interfering with other services on Foreman</p>
</li>
<li>
<p>Flexibility to tune the PostgreSQL server&#8217;s system without adversely affecting Foreman operations</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Disadvantages of external PostgreSQL</div>
<ul>
<li>
<p>Increase in deployment complexity that can make troubleshooting more difficult</p>
</li>
<li>
<p>The external PostgreSQL server is an additional system to patch and maintain</p>
</li>
<li>
<p>If either Foreman or the PostgreSQL database server suffers a hardware or storage failure, Foreman is not operational</p>
</li>
<li>
<p>If there is latency between the Foreman server and database server, performance can suffer</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="preparing-a-host-for-external-databases_foreman"><a class="anchor" href="#preparing-a-host-for-external-databases_foreman"></a>4.10.2. Preparing a host for external databases</h4>
<div class="paragraph">
<p>Install a freshly provisioned system with the latest Enterprise Linux 9 or Enterprise Linux 8 to host the external databases.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The prepared host must meet Foreman&#8217;s <a href="https://docs.theforeman.org/3.11/Installing_Server/index-katello.html#storage-requirements_foreman">Storage Requirements</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Select the operating system and version you are installing external database on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#repositories-externaldb-el-9">Enterprise Linux 9</a></p>
</li>
<li>
<p><a href="#repositories-externaldb-el-8">Enterprise Linux 8</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="repositories-externaldb-el-9"><a class="anchor" href="#repositories-externaldb-el-9"></a>Enterprise Linux 9</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>katello-repos-latest.rpm</code> package</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install https://yum.theforeman.org/releases/3.11/el9/x86_64/foreman-release.rpm \
https://yum.theforeman.org/katello/4.13/katello/el9/x86_64/katello-repos-latest.rpm</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify that the required repositories are enabled:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf repolist enabled</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="repositories-externaldb-el-8"><a class="anchor" href="#repositories-externaldb-el-8"></a>Enterprise Linux 8</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>katello-repos-latest.rpm</code> package</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install https://yum.theforeman.org/releases/3.11/el8/x86_64/foreman-release.rpm \
https://yum.theforeman.org/katello/4.13/katello/el8/x86_64/katello-repos-latest.rpm</pre>
</div>
</div>
</li>
<li>
<p>Enable the following module:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module enable katello:el8</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Enablement of the module <code>katello:el8</code> warns about a conflict with <code>postgresql:10</code> and <code>ruby:2.5</code> as these modules are set to the default module versions on Enterprise Linux 8.
The module <code>katello:el8</code> has a dependency for the modules <code>postgresql:12</code> and <code>ruby:2.7</code> that will be enabled with the <code>katello:el8</code> module.
These warnings do not cause installation process failure, hence can be ignored safely.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify that the required repositories are enabled:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf repolist enabled</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="installing-postgresql_foreman"><a class="anchor" href="#installing-postgresql_foreman"></a>4.10.3. Installing PostgreSQL</h4>
<div class="paragraph">
<p>You can install only the same version of PostgreSQL that is installed with the <code>foreman-installer</code> tool during an internal database installation.
Foreman supports PostgreSQL version 12.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To install PostgreSQL, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install postgresql-server postgresql-evr postgresql-contrib</pre>
</div>
</div>
</li>
<li>
<p>To initialize PostgreSQL, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># postgresql-setup initdb</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>/var/lib/pgsql/data/postgresql.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /var/lib/pgsql/data/postgresql.conf</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the default configuration of external PostgreSQL needs to be adjusted to work with Foreman.
The base recommended external database configuration adjustments are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>checkpoint_completion_target: 0.9</p>
</li>
<li>
<p>max_connections: 500</p>
</li>
<li>
<p>shared_buffers: 512MB</p>
</li>
<li>
<p>work_mem: 4MB</p>
</li>
</ul>
</div>
</li>
<li>
<p>Remove the <code>#</code> and edit to listen to inbound connections:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">listen_addresses = '*'</pre>
</div>
</div>
</li>
<li>
<p>Add the following line to the end of the file to use SCRAM for authentication:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">password_encryption=scram-sha-256</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>/var/lib/pgsql/data/pg_hba.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /var/lib/pgsql/data/pg_hba.conf</pre>
</div>
</div>
</li>
<li>
<p>Add the following line to the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">  host  all   all   <em>Foreman_ip</em>/32   scram-sha-256</pre>
</div>
</div>
</li>
<li>
<p>To start, and enable PostgreSQL service, enter the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl enable --now postgresql</pre>
</div>
</div>
</li>
<li>
<p>Open the <strong>postgresql</strong> port on the external PostgreSQL server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-service=postgresql</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>Switch to the <code>postgres</code> user and start the PostgreSQL client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ su - postgres -c psql</pre>
</div>
</div>
</li>
<li>
<p>Create three databases and dedicated roles: one for Foreman, one for Candlepin, and one for Pulp:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">CREATE USER "foreman" WITH PASSWORD '<em>Foreman_Password</em>';
CREATE USER "candlepin" WITH PASSWORD '<em>Candlepin_Password</em>';
CREATE USER "pulp" WITH PASSWORD '<em>Pulpcore_Password</em>';
CREATE DATABASE foreman OWNER foreman;
CREATE DATABASE candlepin OWNER candlepin;
CREATE DATABASE pulpcore OWNER pulp;</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Pulp database:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">postgres=# \c pulpcore
You are now connected to database "pulpcore" as user "postgres".</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>hstore</code> extension:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">pulpcore=# CREATE EXTENSION IF NOT EXISTS "hstore";
CREATE EXTENSION</pre>
</div>
</div>
</li>
<li>
<p>Exit the <code>postgres</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># \q</pre>
</div>
</div>
</li>
<li>
<p>From Foreman&#160;server, test that you can access the database.
If the connection succeeds, the commands return <code>1</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># PGPASSWORD='<em>Foreman_Password</em>' psql -h <em>postgres.example.com</em>  -p 5432 -U foreman -d foreman -c "SELECT 1 as ping"
# PGPASSWORD='<em>Candlepin_Password</em>' psql -h <em>postgres.example.com</em> -p 5432 -U candlepin -d candlepin -c "SELECT 1 as ping"
# PGPASSWORD='<em>Pulpcore_Password</em>' psql -h <em>postgres.example.com</em> -p 5432 -U pulp -d pulpcore -c "SELECT 1 as ping"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Server_to_Use_External_Databases_foreman"><a class="anchor" href="#Configuring_Server_to_Use_External_Databases_foreman"></a>4.10.4. Configuring Foreman&#160;server to use external databases</h4>
<div class="paragraph">
<p>Use the <code>foreman-installer</code> command to configure Foreman to connect to an external PostgreSQL database.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed and configured a PostgreSQL database on a Enterprise Linux server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To configure the external databases for Foreman, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--katello-candlepin-manage-db false \
--katello-candlepin-db-host <em>postgres.example.com</em> \
--katello-candlepin-db-name candlepin \
--katello-candlepin-db-user candlepin \
--katello-candlepin-db-password <em>Candlepin_Password</em> \
--foreman-proxy-content-pulpcore-manage-postgresql false \
--foreman-proxy-content-pulpcore-postgresql-host <em>postgres.example.com</em> \
--foreman-proxy-content-pulpcore-postgresql-db-name pulpcore \
--foreman-proxy-content-pulpcore-postgresql-user pulp \
--foreman-proxy-content-pulpcore-postgresql-password <em>Pulpcore_Password</em> \
--foreman-db-manage false \
--foreman-db-host <em>postgres.example.com</em> \
--foreman-db-database foreman \
--foreman-db-username foreman \
--foreman-db-password <em>Foreman_Password</em></pre>
</div>
</div>
<div class="paragraph">
<p>To enable the Secure Sockets Layer (SSL) protocol for these external databases, add the following options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--foreman-db-root-cert &lt;path_to_CA&gt;
--foreman-db-sslmode verify-full
--foreman-proxy-content-pulpcore-postgresql-ssl true
--foreman-proxy-content-pulpcore-postgresql-ssl-root-ca &lt;path_to_CA&gt;
--katello-candlepin-db-ssl true
--katello-candlepin-db-ssl-ca &lt;path_to_CA&gt;
--katello-candlepin-db-ssl-verify true</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-external-authentication-and-enabling-single-sign-on-and-two-factor-authentication_foreman"><a class="anchor" href="#configuring-external-authentication-and-enabling-single-sign-on-and-two-factor-authentication_foreman"></a>5. Configuring external authentication and enabling single sign-on and two-factor authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you store users in an external identity provider, you can connect the provider to your Foreman&#160;server to enable these users to log in to Foreman.
Some external identity providers also enable you to implement authentication features such as single sign-on or two-factor authentication in Foreman, providing an additional layer of security.</p>
</div>
<div class="paragraph">
<p>Foreman derives user and user group permissions based on user group membership defined in the external identity provider.</p>
</div>
<div class="sect2">
<h3 id="configuring-an-ldap-server-as-an-external-identity-provider-for-project_foreman"><a class="anchor" href="#configuring-an-ldap-server-as-an-external-identity-provider-for-project_foreman"></a>5.1. Configuring an LDAP server as an external identity provider for Foreman</h3>
<div id="Using_LDAP_satellite" class="paragraph">
<p>Lightweight Directory Access Protocol (LDAP) is a set of open protocols used to access centrally stored information over a network.
With Foreman, you can use one or multiple LDAP directories for external authentication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>While you can configure the LDAP server integrated with FreeIPA as an external authentication source, FreeIPA users will not be able to log in using single sign-on.
Instead, consider configuring FreeIPA as an external identity provider.
For more information, see <a href="#configuring-kerberos-single-sign-on-with-FreeIPA-in-project_foreman">Configuring Kerberos single sign-on with FreeIPA in Foreman</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Users cannot use both FreeIPA and LDAP as an authentication method.
After a user authenticates by using one of these methods, they cannot use the other method.</p>
</div>
<div class="paragraph">
<p>To change the authentication method for a user, remove the automatically created user from Foreman.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="Configuring_TLS_for_Secure_LDAP_foreman"><a class="anchor" href="#Configuring_TLS_for_Secure_LDAP_foreman"></a>5.1.1. Configuring TLS for secure LDAP</h4>
<div class="paragraph">
<p>If Foreman uses TLS to establish a secure LDAP connection (LDAPS), you must obtain the CA certificates  of your LDAP server and add them to the trusted CA list on the base operating system of your Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>If your LDAP server uses a certificate chain with intermediate certificate authorities,  you must obtain all root and intermediate certificates and add them to the trusted CA list.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Obtain the CA certificate from the LDAP Server:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If you use Active Directory Certificate Services, export the Enterprise PKI CA Certificate using the Base64 encoded X.509 format.
See <a href="https://access.redhat.com/solutions/1498773">How to configure Active Directory authentication with <code>TLS</code> on Foreman</a> for information on creating and exporting a CA certificate from an Active Directory server.</p>
</li>
<li>
<p>Download the LDAP server certificate to a temporary location on the Foreman&#160;server, such as <code>/tmp/<em>example.crt</em></code>.
You will remove the certificate when finished.</p>
<div class="paragraph">
<p>The filename extensions <code>.cer</code> and <code>.crt</code> are only conventions and can refer to DER binary or PEM ASCII format certificates.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Add the LDAP server certificate to the system truststore:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Import the certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/<em>example.crt</em> /etc/pki/tls/source/anchors</pre>
</div>
</div>
</li>
<li>
<p>Update the certificate authority truststore:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># update-ca-trust extract</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Delete the downloaded LDAP certificate from the temporary location on your Foreman&#160;server.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about adding certificates to the system truststore, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/securing_networks/using-shared-system-certificates_securing-networks">Using shared system certificates</a> in <em>Red&#160;Hat Enterprise Linux&#160;9 Securing networks</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Project_to_Use_LDAP_foreman"><a class="anchor" href="#Configuring_Project_to_Use_LDAP_foreman"></a>5.1.2. Configuring Foreman to use LDAP</h4>
<div class="paragraph">
<p>Configure an LDAP authentication source to enable users to log in to Foreman with their existing LDAP credentials.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your LDAP server complies with the <a href="https://datatracker.ietf.org/doc/html/rfc2307">RFC 2307</a> schema.</p>
</li>
<li>
<p>Your user account has the following permissions:</p>
<div class="ulist">
<ul>
<li>
<p><code>view_authenticators</code>, <code>create_authenticators</code>, <code>edit_authenticators</code></p>
</li>
<li>
<p><code>view_locations</code>, <code>assign_locations</code></p>
</li>
<li>
<p><code>view_organizations</code>, <code>assign_organizations</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Foreman&#160;server, enable the Network Information System (NIS) service so that SELinux does not block outgoing LDAP connections:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># setsebool -P nis_enabled on</pre>
</div>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Authentication Sources</strong>.</p>
</li>
<li>
<p>From the <strong>LDAP</strong> menu, select <strong>Create</strong>.</p>
</li>
<li>
<p>On the <strong>LDAP server</strong> tab, enter the details of your LDAP server.</p>
<div class="paragraph">
<p>For TLS encrypted connections, select <strong>LDAPS</strong> to enable encryption.</p>
</div>
</li>
<li>
<p>On the <strong>Account</strong> tab, enter the account information and domain name details.
For more information, see the following sections:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#Example_Settings_for_LDAP_Connections_foreman">Example settings for LDAP connections</a></p>
</li>
<li>
<p><a href="#Example_LDAP_Filters_foreman">Example LDAP filters</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>On the <strong>Attribute mappings</strong> tab, map LDAP attributes to Foreman attributes.</p>
</li>
<li>
<p>On the <strong>Locations</strong> tab, select the locations you want Foreman to assign to users created from the LDAP authentication source.
These locations are available to users after they log in for the first time.</p>
</li>
<li>
<p>On the <strong>Organizations</strong> tab, select the organizations you want Foreman to assign to users created from the LDAP authentication source.
These locations are available to users after they log in for the first time.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>If you did not select <strong>Automatically Create Accounts In Foreman</strong> on the <strong>Account</strong> tab, create user accounts manually.
For more information, see <a href="https://docs.theforeman.org/3.11/Administering_Project/index-katello.html#Creating_a_User_admin">Creating a User</a> in <em>Administering Foreman</em>.</p>
</li>
<li>
<p>If you selected <strong>Automatically Create Accounts In Foreman</strong>, LDAP users can now log in to Foreman using their LDAP accounts and passwords.</p>
</li>
<li>
<p>After users log in for the first time, the Foreman administrator must assign roles to them manually.
For more information about assigning appropriate roles to user accounts, see <a href="https://docs.theforeman.org/3.11/Administering_Project/index-katello.html#Assigning_Roles_to_a_User_admin">Assigning Roles to a User</a> in <em>Administering Foreman</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Example_Settings_for_LDAP_Connections_foreman"><a class="anchor" href="#Example_Settings_for_LDAP_Connections_foreman"></a>5.1.3. Example settings for LDAP connections</h4>
<div class="exampleblock">
<div class="title">Example 1. Example settings for Active Directory LDAP connections</div>
<div class="content">
<div class="paragraph">
<p>This example uses a dedicated service account called <em>redhat</em> that has bind, read, and search permissions on the user and group entries.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Account Username</strong>: DOMAIN\redhat</p>
</li>
<li>
<p><strong>Account password</strong>: P@ssword</p>
</li>
<li>
<p><strong>Base DN</strong>: DC=example,DC=COM</p>
</li>
<li>
<p><strong>Login name attribute</strong>: userPrincipalName</p>
</li>
<li>
<p><strong>First name attribute</strong>: givenName</p>
</li>
<li>
<p><strong>Last name attribute</strong>: sn</p>
</li>
<li>
<p><strong>Email address attribute</strong>: mail</p>
</li>
<li>
<p><strong>Photo attribute</strong>: thumbnailPhoto</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>userPrincipalName</code> attribute allows the use of whitespace in usernames. The <code>sAMAccountName</code> attribute, which provides backwards compatibility with legacy Microsoft systems, does not allow the use of whitespace in usernames.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 2. Example settings for FreeIPA LDAP connections</div>
<div class="content">
<div class="paragraph">
<p>This example uses a dedicated service account called <em>redhat</em> that has bind, read, and search permissions on the user and group entries.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Account Username</strong>: uid=redhat,cn=users,cn=accounts,dc=example,dc=com</p>
</li>
<li>
<p><strong>Base DN</strong>: dc=example,dc=com</p>
</li>
<li>
<p><strong>Groups Base DN</strong>: cn=groups,cn=accounts,dc=example,dc=com</p>
</li>
<li>
<p><strong>Login name attribute</strong>: uid</p>
</li>
<li>
<p><strong>First name attribute</strong>: givenName</p>
</li>
<li>
<p><strong>Last name attribute</strong>: sn</p>
</li>
<li>
<p><strong>Email address attribute</strong>: mail</p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 3. Example settings for POSIX LDAP connections</div>
<div class="content">
<div class="paragraph">
<p>This example uses a dedicated service account called <em>redhat</em> that has bind, read, and search permissions on the user and group entries.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Account Username</strong>: uid=redhat,ou=users,dc=example,dc=com</p>
</li>
<li>
<p><strong>Base DN</strong>: dc=example,dc=com</p>
</li>
<li>
<p><strong>Groups Base DN</strong>: cn=employee,ou=userclass,dc=example,dc=com</p>
</li>
<li>
<p><strong>Login name attribute</strong>: uid</p>
</li>
<li>
<p><strong>First name attribute</strong>: givenName</p>
</li>
<li>
<p><strong>Last name attribute</strong>: sn</p>
</li>
<li>
<p><strong>Email address attribute</strong>: mail</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Example_LDAP_Filters_foreman"><a class="anchor" href="#Example_LDAP_Filters_foreman"></a>5.1.4. Example LDAP filters</h4>
<div class="exampleblock">
<div class="title">Example 4. Example LDAP filters for allowing specific users to login</div>
<div class="content">
<div class="paragraph">
<p>You are using the following LDAP directory structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">DC=Domain,DC=Example
   |
   |----- CN=Users
         |
         |----- CN=Group1
         |----- CN=Group2
         |----- CN=User1
         |----- CN=User2
         |----- CN=User3</pre>
</div>
</div>
<div class="paragraph">
<p>Group membership is defined as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Group1</code> includes users <code>User1</code> and <code>User3</code></p>
</li>
<li>
<p><code>Group2</code> includes users <code>User2</code> and <code>User3</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, you can define the following search filters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Search result (users)</th>
<th class="tableblock halign-left valign-top">Filter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(distinguishedName=cn=User1,cn=Users,dc=domain,dc=example)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(memberOf=cn=Group1,cn=Users,dc=domain,dc=example)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User2, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(memberOf=cn=Group2,cn=Users,dc=domain,dc=example)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1, User2, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(|(memberOf=cn=Group1,cn=Users,dc=domain,dc=example)(memberOf=cn=Group2,cn=Users,dc=domain,dc=example))</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User1, User2, User3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(memberOf:1.2.840.113556.1.4.1941:=cn=Users,dc=domain,dc=example)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Because group <code>Users</code> is a nested group that contains groups <code>Group1</code> and <code>Group2</code>, the filter must include <code>memberOf:1.2.840.113556.1.4.1941:=</code> before the nested group name. This enables you to filter all users from the nested group.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-kerberos-single-sign-on-with-FreeIPA-in-project_foreman"><a class="anchor" href="#configuring-kerberos-single-sign-on-with-FreeIPA-in-project_foreman"></a>5.2. Configuring Kerberos single sign-on with FreeIPA in Foreman</h3>
<div class="paragraph">
<p>FreeIPA is an open-source identity management solution that provides centralized authentication, authorization, and account management services.
With Foreman, you can integrate Foreman&#160;server with your existing FreeIPA server to enable FreeIPA users to authenticate to Foreman.</p>
</div>
<div class="paragraph">
<p>With your FreeIPA server configured as an external identity provider, users defined in FreeIPA can log in to Foreman with their FreeIPA credentials.
If a cross-forest trust is configured between FreeIPA and Active&#160;Directory, Active&#160;Directory users can also log in to Foreman.</p>
</div>
<div class="paragraph">
<p>The following login methods are available for FreeIPA users:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Username and password</p>
</li>
<li>
<p>Kerberos single sign-on</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a cross-forest trust is configured between FreeIPA and Active&#160;Directory, Active&#160;Directory users can log in to Foreman with their user principal name (UPN) and password.</p>
</div>
<div class="paragraph">
<p>For information about FreeIPA, including its cross-forest trust functionality, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/planning_identity_management/index">Red&#160;Hat Enterprise Linux&#160;8 <em>Planning Identity Management</em></a> and <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/installing_identity_management/index">Red&#160;Hat Enterprise Linux&#160;8 <em>Installing Identity Management</em></a>.</p>
</div>
<div class="sect3">
<h4 id="enrolling-projectserver-in-freeipa-domain_foreman"><a class="anchor" href="#enrolling-projectserver-in-freeipa-domain_foreman"></a>5.2.1. Enrolling Foreman&#160;server in a FreeIPA domain</h4>
<div class="paragraph">
<p>Create a host entry for your Foreman&#160;server system in the FreeIPA LDAP and configure the system to be a client in your FreeIPA domain.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing FreeIPA server</p>
</li>
<li>
<p>FreeIPA user account with privileges to enroll new FreeIPA hosts</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the FreeIPA server:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a host entry for the Foreman&#160;server system.</p>
<div class="paragraph">
<p>For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/configuring_and_managing_identity_management/index">Red&#160;Hat Enterprise Linux&#160;8 Configuring and managing Identity Management</a> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/managing_idm_users_groups_hosts_and_access_control_rules">Red&#160;Hat Enterprise Linux&#160;9 Managing IdM users, groups, hosts, and access control rules</a>.</p>
</div>
</li>
<li>
<p>Create an entry for the HTTP service for Foreman&#160;server.
This enables access to the keytab file by creating a service principal for your Foreman&#160;server.</p>
<div class="paragraph">
<p>For more information on creating a service entry in FreeIPA, see
<a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html-single/managing_idm_users_groups_hosts_and_access_control_rules/index">Red&#160;Hat Enterprise Linux&#160;8 Managing IdM users, groups, hosts, and access control rules</a> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html-single/managing_idm_users_groups_hosts_and_access_control_rules/index#">Red&#160;Hat Enterprise Linux&#160;9 Managing IdM users, groups, hosts, and access control rules</a>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>On your Foreman&#160;server, configure the system as client in the FreeIPA domain.
This includes ensuring that the system meets the necessary prerequisites, installing the necessary packages, and running the <code>ipa-client-install</code> utility.</p>
<div class="paragraph">
<p>For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux//8/html-single/installing_identity_management/index#assembly_installing-an-idm-client_installing-identity-management">Red&#160;Hat Enterprise Linux&#160;8 Installing Identity Management</a> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux//9/html-single/installing_identity_management/index#assembly_installing-an-idm-client_installing-identity-management">Red&#160;Hat Enterprise Linux&#160;9 Installing Identity Management</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To install packages on your Foreman&#160;server, use the <code>foreman-installer</code> utility.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>On your Foreman&#160;server, check that you are able to resolve a user defined on the FreeIPA server.
For example, to check the <code>admin</code> user that FreeIPA creates by default:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ id admin</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 5. Enrolling a Foreman&#160;server system as a FreeIPA client from the command line by using a one-time password</div>
<div class="content">
<div class="paragraph">
<p>On the FreeIPA server, a user named <em>admin</em> who has administrative privileges on the FreeIPA server prepares a host entry for the Foreman&#160;server system:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Authenticate as the FreeIPA <em>admin</em> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit <em>admin</em></pre>
</div>
</div>
</li>
<li>
<p>Optional: Verify that you have authenticated successfully:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># klist</pre>
</div>
</div>
</li>
<li>
<p>Create a host entry from the command line.
Specify that you want to use a random password for the enrollment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa host-add --random <em>foreman-server.example.com</em>
--------------------------------------------------
 Added host "foreman-server.example.com"
 --------------------------------------------------
  Host name: foreman-server.example.com
  Random password: W5YpARl=7M.n
  Password: True
  Keytab: False
  Managed by: ipa-server.example.com</pre>
</div>
</div>
</li>
<li>
<p>Enable access to the keytab file by creating a service principal for your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa service-add HTTP/<em>foreman-server.example.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On the Foreman&#160;server system, a user with Foreman administrative privileges enrolls the system into the FreeIPA domain:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the FreeIPA client packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ipa-client</pre>
</div>
</div>
</li>
<li>
<p>Configure the Foreman&#160;server system a client in FreeIPA by using the random password produced by <code>ipa host-add</code> in a previous step:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install --password 'W5YpARl=7M.n'</pre>
</div>
</div>
</li>
<li>
<p>Verify that you are able to resolve the FreeIPA <code>admin</code> user from your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ id admin</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-freeipa-authentication-source-on-projectserver_foreman"><a class="anchor" href="#configuring-the-freeipa-authentication-source-on-projectserver_foreman"></a>5.2.2. Configuring the FreeIPA authentication source on Foreman&#160;server</h4>
<div class="paragraph">
<p>Enable FreeIPA users to access Foreman by configuring FreeIPA as an authentication provider on your Foreman&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Foreman&#160;server running on a system that is enrolled in the FreeIPA domain.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable access to the Foreman web UI only:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-ipa-authentication=true</pre>
</div>
</div>
</li>
<li>
<p>To enable access to the Foreman web UI and the Foreman API, including Hammer CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-ipa-authentication-api=true \
--foreman-ipa-authentication=true</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Enabling access to both the Foreman web UI and the Foreman API poses a security risk.
After the FreeIPA user enters <code>kinit</code> to receive a Kerberos ticket-granting ticket (TGT), an attacker might obtain an API session.
The attack is possible even if the user did not previously enter the Foreman login credentials anywhere, for example in the browser.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>To disable external authentication with FreeIPA, reset the options.
For example, to disable access to the Foreman API and Hammer CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --reset-foreman-ipa-authentication-api</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Log in to Foreman web UI by entering the credentials of a user defined in FreeIPA.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-host-based-access-control-for-FreeIPA-users-logging-in-to-project_foreman"><a class="anchor" href="#configuring-host-based-access-control-for-FreeIPA-users-logging-in-to-project_foreman"></a>5.2.3. Configuring host-based access control for FreeIPA users logging in to Foreman</h4>
<div class="paragraph">
<p>You can use host-based access control (HBAC) rules to manage access control within your FreeIPA domain.
In FreeIPA, HBAC rules define which users can access which hosts and which services can be used to gain access.</p>
</div>
<div class="paragraph">
<p>For example, you can configure HBAC on the FreeIPA server to limit access to Foreman&#160;server only to selected users or user groups.
By configuring a HBAC rule in the FreeIPA domain, you can ensure Foreman does not create database entries for users who should not have access.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>FreeIPA user account with privileges to configure HBAC rules</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the FreeIPA server, configure HBAC control.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/managing_idm_users_groups_hosts_and_access_control_rules/configuring-host-based-access-control-rules_managing-users-groups-hosts"><em>Red&#160;Hat Enterprise Linux&#160;9 Managing IdM users, groups, hosts, and access control rules</em></a> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/managing_idm_users_groups_hosts_and_access_control_rules/configuring-host-based-access-control-rules_managing-users-groups-hosts"><em>Red&#160;Hat Enterprise Linux&#160;8 Managing IdM users, groups, hosts, and access control rules</em></a>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a HBAC service for Foreman&#160;server.</p>
</li>
<li>
<p>Create a new HBAC rule to define the required access control.
Add the following FreeIPA entities to the HBAC rule:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>The HBAC service for Foreman&#160;server</p>
</li>
<li>
<p>The Foreman&#160;server host</p>
</li>
<li>
<p>The users or user groups to whom you want to grant access</p>
</li>
</ol>
</div>
</li>
<li>
<p>Make sure the default FreeIPA <code>allow_all</code> rule is disabled.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On your Foreman&#160;server, load the host-based access control rules from FreeIPA:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-pam-service=foreman-prod</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Log in to the Foreman web UI as a user defined in FreeIPA.</p>
<div class="ulist">
<ul>
<li>
<p>If the user is included in the HBAC rule, Foreman web UI will grant access.</p>
</li>
<li>
<p>If the user is not included in the HBAC rule, Foreman web UI will not grant access.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the <code>allow_all</code> rule and configuring HBAC in FreeIPA, see <a href="https://freeipa.readthedocs.io/en/latest/workshop/4-hbac.html">Host-based access control (HBAC)</a> in FreeIPA documentation.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 6. Configuring host-based access control to allow access to Foreman only for selected FreeIPA users by using the command line</div>
<div class="content">
<div class="paragraph">
<p>On the FreeIPA server, a user with administrative privileges configures a HBAC rule to allow selected users access to Foreman&#160;server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Authenticate as the user with privileges required to configure HBAC rules:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kinit <em>admin</em></pre>
</div>
</div>
</li>
<li>
<p>Optional: Verify that you have authenticated successfully:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ klist</pre>
</div>
</div>
</li>
<li>
<p>Create a new HBAC service named <code>foreman-prod</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacsvc-add foreman-prod</pre>
</div>
</div>
</li>
<li>
<p>Create a new HBAC rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacrule-add <em>allow-foreman-prod</em></pre>
</div>
</div>
</li>
<li>
<p>Add the following FreeIPA entities to the HBAC rule:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The <code>foreman-prod</code> HBAC service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacrule-add-service <em>allow-foreman-prod</em> --hbacsvcs=foreman-prod</pre>
</div>
</div>
</li>
<li>
<p>The Foreman&#160;server host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacrule-add-host <em>allow-foreman-prod</em> --hosts=<em>foreman.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>The users or user groups to whom you want to grant access:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacrule-add-user <em>allow-foreman-prod</em> --user=<em>ipa-user</em></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Optional: Verify the status of the rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ipa hbacrule-find <em>foreman-prod</em>
$ ipa hbactest --user=<em>ipa-user</em> --host=<em>foreman.example.com</em> --service=foreman-prod</pre>
</div>
</div>
</li>
<li>
<p>Disable the default <code>allow_all</code> rule:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ipa hbacrule-disable allow_all</pre>
</div>
</div>
<div class="paragraph">
<p>On Foreman&#160;server, a Foreman administrator re-runs foreman-installer to load the host-based access control rules from FreeIPA:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-pam-service=foreman-prod</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-hammer-cli-to-accept-FreeIPA-credentials_foreman"><a class="anchor" href="#configuring-hammer-cli-to-accept-FreeIPA-credentials_foreman"></a>5.2.4. Configuring Hammer CLI to accept FreeIPA credentials</h4>
<div class="paragraph">
<p>Configure the Foreman Hammer CLI tool to use FreeIPA to authenticate users.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have enabled FreeIPA access to the Foreman API.
For more information, see <a href="#configuring-the-freeipa-authentication-source-on-projectserver_foreman">Configuring the FreeIPA authentication source on Foreman&#160;server</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Open the <code>~/.hammer/cli.modules.d/foreman.yml</code> file on your Foreman&#160;server and update the list of <code>foreman</code> parameters:</p>
<div class="ulist">
<ul>
<li>
<p>To enforce session usage, enable <code>:use_sessions:</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :use_sessions: true</pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, you will need to initiate an authentication session manually with <code>hammer auth login negotiate</code>.</p>
</div>
</li>
<li>
<p>Alternatively, to enforce session usage and also negotiate authentication by default:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :default_auth_type: 'Negotiate_Auth'
  :use_sessions: true</pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, Hammer will negotiate authentication automatically when you enter the first <code>hammer</code> command.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Using_FreeIPA_credentials_to_log_in_to_the_foreman_Hammer_CLI_foreman"><a class="anchor" href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_Hammer_CLI_foreman"></a>5.2.5. Logging in to Hammer CLI with FreeIPA credentials</h4>
<div class="paragraph">
<p>Authenticate to the Foreman Hammer CLI with your FreeIPA username and password.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have configured Hammer CLI to accept FreeIPA credentials.
See <a href="#configuring-hammer-cli-to-accept-FreeIPA-credentials_foreman">Configuring Hammer CLI to accept FreeIPA credentials</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Authenticate as a user defined in FreeIPA to obtain a Kerberos ticket-granting ticket (TGT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kinit <em>FreeIPA_user</em></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you enabled access to the Foreman API and the Foreman web UI when you were configuring FreeIPA as the authentication provider for Foreman, an attacker might now obtain an API session after the user receives the Kerberos TGT.
The attack is possible even if the user did not previously enter the Foreman login credentials anywhere, for example in the browser.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If Hammer is not configured to negotiate authentication, initiate an authentication session manually:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer auth login negotiate</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you destroy the active Kerberos ticket, for example with <code>kdestroy</code>, you will still be logged in to Hammer.
To log out, enter <code>hammer auth logout</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Use any <code>hammer</code> command to check that the system does not ask you to authenticate.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host list</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about authenticating with Hammer, see
<code>hammer auth --help</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-Mozilla-Firefox_foreman"><a class="anchor" href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-Mozilla-Firefox_foreman"></a>5.2.6. Logging in to the Foreman web UI with FreeIPA credentials in Mozilla Firefox</h4>
<div class="paragraph">
<p>You can use Mozilla Firefox to log in to the Foreman web UI with your FreeIPA credentials.</p>
</div>
<div class="paragraph">
<p>Use the latest stable Mozilla Firefox browser.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have FreeIPA authentication configured in your Foreman environment.</p>
</li>
<li>
<p>The host on which you are using Mozilla Firefox is a client in the FreeIPA domain.</p>
</li>
<li>
<p>Your Mozilla Firefox is configured for Single Sign-On (SSO).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Obtain the Kerberos ticket granting ticket (TGT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kinit <em>user</em>
Password for user@EXAMPLE.COM:</pre>
</div>
</div>
</li>
<li>
<p>In Mozilla Firefox, go to the URL of your Foreman&#160;server.</p>
</li>
<li>
<p>You are logged in automatically.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Alternatively:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your browser address bar, enter the URL of your Foreman&#160;server.</p>
</li>
<li>
<p>Enter your username and password.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-a-Chrome-browser_foreman"><a class="anchor" href="#Using_FreeIPA_credentials_to_log_in_to_the_foreman_web_UI-with-a-Chrome-browser_foreman"></a>5.2.7. Logging in to the Foreman web UI with FreeIPA credentials in Chrome</h4>
<div class="paragraph">
<p>You can use Chrome to log in to the Foreman web UI with your FreeIPA credentials.</p>
</div>
<div class="paragraph">
<p>Use the latest stable Chrome browser.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have FreeIPA authentication configured in your Foreman environment.</p>
</li>
<li>
<p>The host on which you are using Chrome is a client in the FreeIPA domain.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable the Chrome browser to use Kerberos authentication:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ google-chrome --auth-server-whitelist="*.<em>example.com</em>" --auth-negotiate-delegate-whitelist="*.<em>example.com</em>"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Instead of allowlisting the whole domain, you can also allowlist a specific Foreman&#160;server.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Obtain the Kerberos ticket-granting ticket (TGT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kinit <em>user</em>
Password for user@EXAMPLE.COM:</pre>
</div>
</div>
</li>
<li>
<p>In Chrome, go to the URL of your Foreman&#160;server.</p>
</li>
<li>
<p>You are logged in automatically.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Alternatively:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your browser address bar, enter the URL of your Foreman&#160;server.</p>
</li>
<li>
<p>Enter your username and password.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Configuring-a-cross-forest-trust-between-FreeIPA-and-Active-Directory-for-Foreman_foreman"><a class="anchor" href="#Configuring-a-cross-forest-trust-between-FreeIPA-and-Active-Directory-for-Foreman_foreman"></a>5.2.8. Configuring a cross-forest trust between FreeIPA and Active Directory for Foreman</h4>
<div class="paragraph">
<p>When your FreeIPA deployment includes a cross-forest trust with Active Directory (AD), configure host-based access control (HBAC) and the System Security Services Daemon (SSSD) to enable AD users to log in to Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing FreeIPA server with a cross-forest trust with AD established.
For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html-single/installing_identity_management/index#installing-trust-between-idm-and-ad_installing-identity-management">Red&#160;Hat Enterprise Linux&#160;8 <em>Installing trust between IdM and AD</em></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On your FreeIPA server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable HBAC:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create an external group and add the AD group to it.</p>
</li>
<li>
<p>Add the new external group to a POSIX group.</p>
</li>
<li>
<p>Use the POSIX group in a HBAC rule.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On your FreeIPA server and all replicas in your FreeIPA topology, configure SSSD to transfer additional attributes of AD users:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the AD user attributes to the <em>nss</em> and <em>domain</em> sections in <code>/etc/sssd/sssd.conf</code>.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[domain/EXAMPLE.com]
...
krb5_store_password_if_offline = True
ldap_user_extra_attrs=email:mail, lastname:sn, firstname:givenname

[nss]
user_attributes=+email, +firstname, +lastname

[ifp]
allowed_uids = ipaapi, root
user_attributes=+email, +firstname, +lastname</pre>
</div>
</div>
</li>
<li>
<p>Clear the SSSD cache:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Stop SSSD:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl stop sssd</pre>
</div>
</div>
</li>
<li>
<p>Clear the cache:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sss_cache -E</pre>
</div>
</div>
</li>
<li>
<p>Start SSSD:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start sssd</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Verify the AD attributes value by using the <code>dbus-send</code> command on your Foreman&#160;server and on your FreeIPA server.
Make sure that both outputs match.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dbus-send --print-reply --system --dest=org.freedesktop.sssd.infopipe /org/freedesktop/sssd/infopipe org.freedesktop.sssd.infopipe.GetUserAttr string:ad-user@ad-domain array:string:email,firstname,lastname</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-keycloak-wildfly-authentication-for-project_keycloak-wildfly"><a class="anchor" href="#configuring-keycloak-wildfly-authentication-for-project_keycloak-wildfly"></a>5.3. Configuring Wildfly-based Keycloak authentication for Foreman</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The default Keycloak distribution is now based on Quarkus.</p>
</div>
<div class="paragraph">
<p>Quarkus-based Keycloak replaces Wildfly-based Keycloak in Foreman deployments.
For information about configuring Quarkus-based Keycloak authentication, see <a href="#configuring-single-sign-on-and-two-factor-authentication-with-keycloak-in-project_keycloak-quarkus">Configuring single sign-on and two-factor authentication with Quarkus-based Keycloak in Foreman</a>.</p>
</div>
<div class="paragraph">
<p>For information about migrating from Wildfly-based Keycloak to Quarkus-based Keycloak, see <a href="https://www.keycloak.org/migration/migrating-to-quarkus">Migrating to Quarkus distribution</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Keycloak is an open-source identity and access management solution that provides authentication features, such as single sign-on functionality, user federation, or centralized authentication management.
With Wildfly-based Keycloak, you can integrate Foreman&#160;server with your existing Keycloak server to delegate user authentication and authorization to Keycloak.
The following login methods are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User name and password in Foreman web UI</p>
</li>
<li>
<p>User name and password in Hammer CLI</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Keycloak users cannot use both Foreman web UI and Hammer CLI authentication in Foreman at the same time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Time-based one-time password (TOTP)</p>
</li>
<li>
<p>PIV cards</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-wildfly"><a class="anchor" href="#prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-wildfly"></a>5.3.1. Prerequisites for configuring Foreman with Wildfly-based Keycloak authentication</h4>
<div class="ulist">
<ul>
<li>
<p>A Keycloak account with administrative privileges.</p>
</li>
<li>
<p>A Keycloak server that uses HTTPS instead of HTTP.</p>
</li>
<li>
<p>If the certificates or the CA are self-signed, ensure that they are added to the end-user certificate truststore.</p>
</li>
<li>
<p>A Keycloak realm created for Foreman user accounts, for example <code><em>Foreman_Realm</em></code>.</p>
</li>
<li>
<p>Users imported or added to Keycloak.
For more information about importing or creating users, see the <a href="https://docs.redhat.com/en/documentation/red_hat_single_sign-on/7.6/html/server_administration_guide/assembly-managing-users_server_administration_guide#proc-creating-user_server_administration_guide"><em>Red&#160;Hat Single Sign-On Server Administration Guide</em></a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="registering-foreman-as-a-client-of-keycloak_keycloak-wildfly"><a class="anchor" href="#registering-foreman-as-a-client-of-keycloak_keycloak-wildfly"></a>5.3.2. Registering Foreman as a client of Keycloak</h4>
<div class="paragraph">
<p>Users defined in Keycloak can authenticate to Foreman by using one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Foreman web UI</p>
</li>
<li>
<p>Hammer CLI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Choose one of these methods to enable in your Foreman deployment.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On your Foreman&#160;server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the packages required for registering a Keycloak client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install mod_auth_openidc keycloak-httpd-client-install python3-lxml</pre>
</div>
</div>
</li>
<li>
<p>Choose the authentication method you want Keycloak users to use when authenticating to Foreman:</p>
<div class="ulist">
<ul>
<li>
<p>If you want users to authenticate by using the Foreman web UI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a client for Foreman.
Use <code>foreman-openidc</code> as the application name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name foreman-openidc \
--keycloak-server-url "https://<em>keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
</li>
<li>
<p>Configure Foreman to use Keycloak as an authentication source for Foreman web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "foreman-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you want users to authenticate by using the Hammer CLI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a client for Foreman.
Use <code>hammer-openidc</code> as the application name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name hammer-openidc \
--keycloak-server-url "https://<em>keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
</li>
<li>
<p>Configure Foreman to use Keycloak as an authentication source for Hammer CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "hammer-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
<li>
<p>Reset Keycloak support to the default value to ensure that users are not authenticated also in Foreman web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --reset-foreman-keycloak</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Restart the <code>httpd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-foreman-client-in-keycloak_keycloak-wildfly"><a class="anchor" href="#configuring-the-foreman-client-in-keycloak_keycloak-wildfly"></a>5.3.3. Configuring the Foreman client in Wildfly-based Keycloak</h4>
<div class="paragraph">
<p>Configure the Foreman client in Wildfly-based Keycloak with valid redirect URIs and mappers.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Keycloak web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the realm created for Foreman users.
Navigate to <strong>Clients</strong> and click the Foreman client.</p>
</li>
<li>
<p>Configure access type:</p>
<div class="ulist">
<ul>
<li>
<p>If you are configuring a client that will provide Foreman web UI authentication, select <strong>confidential</strong> from the <strong>Access Type</strong> list.</p>
</li>
<li>
<p>If you are configuring a client that will provide Hammer CLI authentication, select <strong>public</strong> from the <strong>Access Type</strong> list.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure <strong>Valid redirect URI</strong> addresses:</p>
<div class="ulist">
<ul>
<li>
<p>If you are configuring a client that will provide Foreman web UI authentication:</p>
<div class="ulist">
<ul>
<li>
<p>You will see a pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin/redirect_uri</code>.
Do not change or remove this URI.</p>
</li>
<li>
<p>Add another URI below the pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>If you are configuring a client that will provide Hammer CLI authentication:</p>
<div class="ulist">
<ul>
<li>
<p>You will see a pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin/redirect_uri</code>.
Do not change or remove this URI.</p>
</li>
<li>
<p>Add another URI below the pre-defined URI: <code>urn:ietf:wg:oauth:2.0:oob</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>On the <strong>Mappers</strong> tab, click <strong>Create</strong> to add an audience mapper.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the <strong>Mapper Type</strong> list, select <strong>Audience</strong>.</p>
</li>
<li>
<p>From the <strong>Included Client Audience</strong> list, select the Foreman client.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>On the <strong>Mappers</strong> tab, click <strong>Create</strong> to add a group mapper so that you can specify authorization in Foreman based on group membership.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the <strong>Mapper Type</strong> list, select <strong>Group Membership</strong>.</p>
</li>
<li>
<p>In the <strong>Token Claim Name</strong> field, enter <strong>groups</strong>.</p>
</li>
<li>
<p>Set the <strong>Full group path</strong> setting to <code>OFF</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about configuring Wildfly-based Keycloak clients, see <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.6/html-single/server_administration_guide/index">Red&#160;Hat Single Sign-On <em>Server Administration Guide</em></a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-wildfly"><a class="anchor" href="#configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-wildfly"></a>5.3.4. Configuring a Foreman client to provide Foreman web UI authentication with Keycloak</h4>
<div class="paragraph">
<p>If you are configuring a client that will provide Foreman web UI authentication to your Foreman deployment, delegate authentication to the Keycloak server and add Keycloak as an external authentication source in Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <strong>Access Type</strong> setting in the Foreman client in the Wildfly-based Keycloak web UI is set to <strong>confidential</strong>.
For more information, see <a href="#configuring-the-foreman-client-in-keycloak_keycloak-wildfly">Configuring the Foreman client in Wildfly-based Keycloak</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Foreman web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Authentication</strong> tab, configure the following settings:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Authorize login delegation</strong>: Set to <code>Yes</code>.</p>
</li>
<li>
<p><strong>Authorize login delegation auth source user autocreate</strong>: Set to <code>External</code>.</p>
</li>
<li>
<p><strong>Login delegation logout URL</strong>: Set to <code>https://<em>foreman.example.com</em>/users/extlogout</code>.</p>
</li>
<li>
<p><strong>OIDC Algorithm</strong>: For example, set to <code>RS256</code>.</p>
</li>
<li>
<p><strong>OIDC Audience</strong>: Set to the client ID for Keycloak.</p>
</li>
<li>
<p><strong>OIDC Issuer</strong>:
Set to <code>https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_Realm</em></code>.</p>
</li>
<li>
<p><strong>OIDC JWKs URL</strong>:
Set to <code>https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_Realm</em>/protocol/openid-connect/certs</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Authentication Sources</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the <strong>External</strong> menu, select <strong>Edit</strong>.</p>
</li>
<li>
<p>On the <strong>Locations</strong> tab, add the locations that you want to be able to use the Keycloak authentication source.</p>
</li>
<li>
<p>On the <strong>Organizations</strong> tab, add the organizations that you want to be able to use the Keycloak authentication source.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-wildfly"><a class="anchor" href="#configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-wildfly"></a>5.3.5. Configuring a Foreman client to provide Hammer CLI authentication with Keycloak</h4>
<div class="paragraph">
<p>If you are configuring a client that will provide Hammer CLI authentication to your Foreman deployment, delegate authentication to the Keycloak server and add Keycloak as an external authentication source in Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <strong>Access Type</strong> setting in the Foreman client in the Wildfly-based Keycloak web UI is set to <strong>public</strong>.
For more information, see <a href="#configuring-the-foreman-client-in-keycloak_keycloak-wildfly">Configuring the Foreman client in Wildfly-based Keycloak</a>.</p>
</li>
<li>
<p>Obtain the values to configure Foreman settings from the following URL: <code>https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_Realm</em>/.well-known/openid-configuration</code>.
Replace <em>Foreman_Realm</em> with the name of the Keycloak realm created for your Foreman server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On the Foreman client registered to Keycloak:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the login delegation to <code>true</code> so that users can authenticate using the Open IDC protocol:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name authorize_login_delegation --value true</pre>
</div>
</div>
</li>
<li>
<p>Set the login delegation logout URL:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name login_delegation_logout_url \
--value https://<em>foreman.example.com</em>/users/extlogout</pre>
</div>
</div>
</li>
<li>
<p>Set the algorithm for encoding:
For example, to use the <code>RS256</code> algorithm:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_algorithm --value 'RS256'</pre>
</div>
</div>
</li>
<li>
<p>Add the value for the Hammer client in the Open IDC audience:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
</li>
<li>
<p>Set the value for the Open IDC issuer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_issuer \
--value "https://<em>keycloak.example.com</em>/auth/realms/<em>KEYCLOAK_REALM</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set the value for Open IDC Java Web Token (JWT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_jwks_url \
--value "https://<em>keycloak.example.com</em>/auth/realms/<em>KEYCLOAK_REALM</em>/protocol/openid-connect/certs"</pre>
</div>
</div>
</li>
<li>
<p>Retrieve the ID of the Keycloak authentication source:</p>
<div class="listingblock">
<div class="content">
<pre># hammer auth-source external list</pre>
</div>
</div>
</li>
<li>
<p>Set the location and organization:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth-source external update \
--id <em>My_Authentication_Source_ID</em> \
--location-ids <em>My_Location_ID</em> \
--organization-ids <em>My_Organization_ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-foreman-with-keycloak-for-totp-authentication_keycloak-wildfly"><a class="anchor" href="#configuring-foreman-with-keycloak-for-totp-authentication_keycloak-wildfly"></a>5.3.6. Configuring Foreman with Keycloak for TOTP authentication</h4>
<div class="paragraph">
<p>If you want users to authenticate with time-based one-time passwords (TOTP), configure an OTP policy for the Foreman realm in Keycloak.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Keycloak web UI, navigate to the Foreman realm.</p>
</li>
<li>
<p>Navigate to <strong>Authentication</strong>.</p>
</li>
<li>
<p>On the <strong>Policies</strong> tab, click the <strong>OTP Policy</strong> tab.
Ensure that the <strong>Supported Applications</strong> field includes FreeOTP or Google Authenticator.</p>
</li>
<li>
<p>Configure the OTP settings to suit your requirements.</p>
</li>
<li>
<p>On <strong>Required Actions</strong> tab, enable the <strong>Set as default action</strong> setting for the <strong>Configure OTP</strong> action.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/24.0/html/server_administration_guide/configuring-authentication_server_administration_guide#configuring-authentication_server_administration_guide">Red&#160;Hat Single Sign-On Server Administration Guide</a> or <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.6/html-single/server_administration_guide/index#configuring-authentication_server_administration_guide">Red&#160;Hat build of Keycloak Server Administration Guide</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-wildfly"><a class="anchor" href="#configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-wildfly"></a>5.3.7. Configuring Keycloak settings for authentication with PIV cards</h4>
<div class="paragraph">
<p>If you want users to authenticate with PIV cards, configure Keycloak for authentication with PIV cards and configure the operating system for PIV cards on each user system.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Keycloak web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <strong>Authentication</strong> tab.</p>
</li>
<li>
<p>From the <strong>Flows</strong> list, select <strong>Browser</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Copy</strong> to copy this flow.</p>
</li>
<li>
<p>In the <strong>Copy Authentication Flow</strong> window, enter a new name for the flow and click <strong>OK</strong>.</p>
</li>
<li>
<p>In the copied flow, delete the <strong>Username Password Form</strong> and <strong>OTP Form</strong> entries.</p>
</li>
<li>
<p>Click <strong>Add execution</strong>.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>X509/Validate Username Form</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the <strong>X509/Validate Username Form</strong> row, select <strong>ALTERNATIVE</strong>.
Click <strong>Actions</strong> &gt; <strong>Config</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Alias</strong> field, enter a name for this configuration.</p>
</li>
<li>
<p>From the <strong>User Identity Source</strong> list, select <strong>Subject’s Common Name</strong>,</p>
</li>
<li>
<p>From the <strong>User mapping method</strong> list, select <strong>Username or Email</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to <strong>Authentication</strong> &gt; <strong>Bindings</strong>.</p>
</li>
<li>
<p>From the <strong>Browser Flow</strong> list, select the created flow.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On each system from which you want users to log in to with PIV cards:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>opensc</code> package:</p>
<div class="ulist">
<ul>
<li>
<p>On Debian or Ubuntu:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># apt install opensc</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 8+:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install opensc</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 7:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install opensc</pre>
</div>
</div>
</li>
<li>
<p>On OpenSUSE and SUSE Linux Enterprise Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># zypper install opensc</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Make sure Mozilla Firefox is installed.</p>
</li>
<li>
<p>In Mozilla Firefox main menu, click <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Privacy and Security</strong> tab, click <strong>Security Devices</strong>.</p>
</li>
<li>
<p>Click <strong>Load</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Load PKCS#11 Device Driver</strong> window, enter <strong>/usr/lib64/pkcs11/opensc-pkcs11.so</strong> in the <strong>Module filename</strong> field.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If the PIV card is connected to system, restart the <code>pcscd</code> service.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-group-mapping-for-keycloak-authentication_keycloak-wildfly"><a class="anchor" href="#configuring-group-mapping-for-keycloak-authentication_keycloak-wildfly"></a>5.3.8. Optional: Configuring external group mapping for Keycloak authentication</h4>
<div class="paragraph">
<p>To implement the role-based access control (RBAC), create a group in Foreman, assign a role to this group, and then map an Keycloak group to the Foreman group.
As a result, anyone in the given group in Keycloak will log in under the corresponding Foreman group.</p>
</div>
<div class="paragraph">
<p>For example, you can configure users of the Foreman-admin user group defined in Active Directory to authenticate as users with administrator privileges on Foreman.</p>
</div>
<div class="paragraph">
<p>If you do not configure group mapping, every user will receive the <em>Default role</em> permissions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>.</p>
</li>
<li>
<p>Click <strong>Create User Group</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter a name for the user group.
Enter a name that is different from the Active Directory user group name.</p>
</li>
<li>
<p>Do not add any users or user groups to the new group in Foreman web UI.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On the <strong>Roles</strong> tab, select <strong>Administer</strong>.</p>
</li>
<li>
<p>On the <strong>External Groups</strong> tab, click <strong>Add external user group</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter the name of the Active Directory group.</p>
</li>
<li>
<p>From the <strong>Auth Source</strong> drop-down menu, select <strong>EXTERNAL</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-wildfly"><a class="anchor" href="#logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-wildfly"></a>5.3.9. Logging in to Foreman configured with Keycloak as an authentication source</h4>
<div class="paragraph">
<p>With Keycloak configured as an external authentication source for Foreman, users defined in a Keycloak realm can log in to Foreman&#160;server.
The particular login methods available to users depend on how you configured integration between Keycloak and Foreman.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To authenticate to the Foreman web UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In your browser, go to <code>https://<em>foreman.example.com</em></code> and enter your credentials.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman web UI by using Keycloak TOTP:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your browser, log in to Foreman.
Foreman redirects you to the Keycloak login screen.</p>
</li>
<li>
<p>Enter your username and password, and click <strong>Log In</strong>.</p>
</li>
<li>
<p>On your first login attempt, Keycloak requests you to configure your client by scanning the bar code and entering your PIN.
Once authenticated, your browser redirects you back to Foreman and logs you in.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman CLI with Hammer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that Hammer is configured to enforce session usage in <code>~/.hammer/cli.modules.d/foreman.yml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :use_sessions: true</pre>
</div>
</div>
</li>
<li>
<p>Initiate an authentication session with <code>hammer auth login oauth</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--oidc-token-endpoint 'https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_realm</em>/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-hammer-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman CLI with Hammer by using Keycloak TOTP:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that Hammer is configured to enforce session usage in <code>~/.hammer/cli.modules.d/foreman.yml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :use_sessions: true</pre>
</div>
</div>
</li>
<li>
<p>Initiate an authentication session by using <code>--two-factor</code> with <code>hammer auth login oauth</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--two-factor \
--oidc-token-endpoint 'https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_realm</em>/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-hammer-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
<li>
<p>You will be prompted to enter a success code.
To retrieve the success code, navigate to the URL that the command returns.</p>
</li>
<li>
<p>Enter the success code in CLI.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To log in to the Foreman web UI using the Keycloak PIV cards:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Mozilla Firefox, log in to Foreman and enter your credentials.</p>
</li>
<li>
<p>When prompted, enter the PIN of the PIV card.</p>
</li>
<li>
<p>Choose the certificate for authentication.
Browser verifies this certificate with Keycloak.
Once authenticated, browser redirects you back to Foreman and logs you in.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-single-sign-on-and-two-factor-authentication-with-keycloak-in-project_keycloak-quarkus"><a class="anchor" href="#configuring-single-sign-on-and-two-factor-authentication-with-keycloak-in-project_keycloak-quarkus"></a>5.4. Configuring single sign-on and two-factor authentication with Quarkus-based Keycloak in Foreman</h3>
<div class="paragraph">
<p>Quarkus-based Keycloak is an open-source identity and access management solution that provides authentication features, such as single sign-on functionality, user federation, or centralized authentication management.
With Quarkus-based Keycloak, you can integrate Foreman&#160;server with your existing Quarkus-based Keycloak server to delegate user authentication and authorization to Quarkus-based Keycloak.
The following login methods are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User name and password in Foreman web UI</p>
</li>
<li>
<p>User name and password in Hammer CLI</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Keycloak users cannot use both Foreman web UI and Hammer CLI authentication in Foreman at the same time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Time-based one-time password (TOTP), an implementation of two-factor authentication (2FA)</p>
</li>
<li>
<p>PIV cards</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about Keycloak, see <a href="https://www.keycloak.org/documentation">Keycloak documentation</a>.</p>
</div>
<div class="sect3">
<h4 id="prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-quarkus"><a class="anchor" href="#prerequisites-for-configuring-foreman-with-keycloak-authentication_keycloak-quarkus"></a>5.4.1. Prerequisites for configuring Foreman with Quarkus-based Keycloak authentication</h4>
<div class="ulist">
<ul>
<li>
<p>A Keycloak account with administrative privileges.</p>
</li>
<li>
<p>A Keycloak server that uses HTTPS instead of HTTP and has been initialized with the <code>--http-relative-path=/auth</code> context path.
To access a Keycloak server initialized with <code>--http-relative-path=/auth</code> from its web UI, go to <code>https://<em>keycloak.example.com</em>:8443/auth</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To use a different context path, make manual adjustments after the initialisation with <code>/auth</code> or configure the <code><em>foreman-openidc_oidc_keycloak_Foreman_Realm</em>.conf</code> file of the HTTPd service manually.
For more information about configuring a different context path, see the <a href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/24.0/html-single/server_guide/index#reverseproxy-different-context-path-on-reverse-proxy"><em>Red&#160;Hat build of Keycloak Administration Guide</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If the certificates or the CA are self-signed, add them to the end-user certificate truststore.</p>
</li>
<li>
<p>A Keycloak realm created for Foreman user accounts, for example <code><em>Foreman_Realm</em></code>.</p>
</li>
<li>
<p>Users imported or added to Keycloak.
For more information on importing or creating users, see the <a href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/24.0/html/server_administration_guide/user-storage-federation"><em>Red&#160;Hat build of Keycloak Administration Guide</em></a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="registering-foreman-as-a-client-of-keycloak_keycloak-quarkus"><a class="anchor" href="#registering-foreman-as-a-client-of-keycloak_keycloak-quarkus"></a>5.4.2. Registering Foreman as a client of Keycloak</h4>
<div class="paragraph">
<p>Users defined in Keycloak can authenticate to Foreman by using one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Foreman web UI</p>
</li>
<li>
<p>Hammer CLI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Choose one of these methods to enable in your Foreman deployment.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On your Foreman&#160;server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the packages required for registering a Keycloak client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install mod_auth_openidc keycloak-httpd-client-install python3-lxml</pre>
</div>
</div>
</li>
<li>
<p>Choose the authentication method you want Keycloak users to use when authenticating to Foreman:</p>
<div class="ulist">
<ul>
<li>
<p>If you want users to authenticate by using the Foreman web UI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a client for Foreman.
Use <code>foreman-openidc</code> as the application name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name foreman-openidc \
--keycloak-server-url "https://<em>keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
</li>
<li>
<p>Configure Foreman to use Keycloak as an authentication source for Foreman web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "foreman-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you want users to authenticate by using the Hammer CLI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a client for Foreman.
Use <code>hammer-openidc</code> as the application name.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># keycloak-httpd-client-install --app-name hammer-openidc \
--keycloak-server-url "https://<em>keycloak.example.com</em>" \
--keycloak-admin-username "<em>admin</em>" \
--keycloak-realm "<em>Foreman_Realm</em>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</pre>
</div>
</div>
</li>
<li>
<p>Configure Foreman to use Keycloak as an authentication source for Hammer CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-keycloak true \
--foreman-keycloak-app-name "hammer-openidc" \
--foreman-keycloak-realm "<em>Foreman_Realm</em>"</pre>
</div>
</div>
</li>
<li>
<p>Reset Keycloak support to the default value to ensure that users are not authenticated also in Foreman web UI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --reset-foreman-keycloak</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Restart the <code>httpd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-foreman-client-in-keycloak_keycloak-quarkus"><a class="anchor" href="#configuring-the-foreman-client-in-keycloak_keycloak-quarkus"></a>5.4.3. Configuring the Foreman client in Quarkus-based Keycloak</h4>
<div class="paragraph">
<p>Configure the Foreman client in Quarkus-based Keycloak with valid redirect URIs and mappers.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Quarkus-based Keycloak web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the realm created for Foreman users.</p>
</li>
<li>
<p>Navigate to <strong>Clients</strong> and click the Foreman client.</p>
</li>
<li>
<p>On the <strong>Settings</strong> tab for the Foreman client, configure the access type and redirect addresses:</p>
<div class="ulist">
<ul>
<li>
<p>If you are configuring a client that will provide Foreman web UI authentication:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enable <strong>Client authentication</strong>.</p>
</li>
<li>
<p>You will see a pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin/redirect_uri</code>.
Do not change or remove this URI.</p>
</li>
<li>
<p>Add another URI below the pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>If you are configuring a client that will provide Hammer CLI authentication:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ensure <strong>Client authentication</strong> is disabled.</p>
</li>
<li>
<p>You will see a pre-defined URI: <code>https://<em>foreman.example.com</em>/users/extlogin/redirect_uri</code>.
Do not change or remove this URI.</p>
</li>
<li>
<p>Add another URI below the pre-defined URI: <code>urn:ietf:wg:oauth:2.0:oob</code></p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>On the <strong>Client Scopes</strong> tab for the Foreman client, locate the client scope dedicated to the Foreman client named <code><em>client-name</em>-dedicated</code>.
Start editing the client scope.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>On the <strong>Mappers</strong> tab for <code><em>client-name</em>-dedicated</code>, add a new mapper by configuration.
Select the <strong>Audience</strong> mapper type.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>From the <strong>Included Client Audience</strong> list, select the Foreman client.</p>
</li>
<li>
<p>Enable <strong>Add to ID token</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Add another mapper by configuration.
Select the <strong>Group Membership</strong> mapper type. This adds a group mapper so that you can specify authorization in Foreman based on group membership.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In the <strong>Token Claim Name</strong> field, enter <strong>groups</strong>.</p>
</li>
<li>
<p>Disable <strong>Full group path</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about configuring Quarkus-based Keycloak clients, see <a href="https://access.redhat.com/documentation/en-us/red_hat_build_of_keycloak/24.0/html-single/server_administration_guide/index#assembly-managing-clients_server_administration_guide">Red&#160;Hat build of Keycloak <em>Server Administration Guide</em></a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-quarkus"><a class="anchor" href="#configuring-a-foreman-client-to-provide-foreman_web_UI-authentication-with-keycloak_keycloak-quarkus"></a>5.4.4. Configuring a Foreman client to provide Foreman web UI authentication with Keycloak</h4>
<div class="paragraph">
<p>If you are configuring a client that will provide Foreman web UI authentication to your Foreman deployment, delegate authentication to the Keycloak server and add Keycloak as an external authentication source in Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <strong>Client authentication</strong> setting in the Foreman client in the Quarkus-based Keycloak web UI is enabled.
For more information, see <a href="#configuring-the-foreman-client-in-keycloak_keycloak-quarkus">Configuring the Foreman client in Quarkus-based Keycloak</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Foreman web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Authentication</strong> tab, configure the following settings:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Authorize login delegation</strong>: Set to <code>Yes</code>.</p>
</li>
<li>
<p><strong>Authorize login delegation auth source user autocreate</strong>: Set to <code>External</code>.</p>
</li>
<li>
<p><strong>Login delegation logout URL</strong>: Set to <code>https://<em>foreman.example.com</em>/users/extlogout</code>.</p>
</li>
<li>
<p><strong>OIDC Algorithm</strong>: For example, set to <code>RS256</code>.</p>
</li>
<li>
<p><strong>OIDC Audience</strong>: Set to the client ID for Keycloak.</p>
</li>
<li>
<p><strong>OIDC Issuer</strong>:
Set to <code>https://<em>keycloak.example.com</em>:8443/auth/realms/<em>Foreman_Realm</em></code>.</p>
</li>
<li>
<p><strong>OIDC JWKs URL</strong>:
Set to <code>https://<em>keycloak.example.com</em>:8443/auth/realms/<em>Foreman_Realm</em>/protocol/openid-connect/certs</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Authentication Sources</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the <strong>External</strong> menu, select <strong>Edit</strong>.</p>
</li>
<li>
<p>On the <strong>Locations</strong> tab, add the locations that you want to be able to use the Keycloak authentication source.</p>
</li>
<li>
<p>On the <strong>Organizations</strong> tab, add the organizations that you want to be able to use the Keycloak authentication source.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-quarkus"><a class="anchor" href="#configuring-a-foreman-client-to-provide-hammer-cli-authentication-with-keycloak_keycloak-quarkus"></a>5.4.5. Configuring a Foreman client to provide Hammer CLI authentication with Keycloak</h4>
<div class="paragraph">
<p>If you are configuring a client that will provide Hammer CLI authentication to your Foreman deployment, delegate authentication to the Keycloak server and add Keycloak as an external authentication source in Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <strong>Client authentication</strong> setting in the Foreman client in the Quarkus-based Keycloak web UI is disabled.
For more information, see <a href="#configuring-the-foreman-client-in-keycloak_keycloak-quarkus">Configuring the Foreman client in Quarkus-based Keycloak</a>.</p>
</li>
<li>
<p>Obtain the values to configure Foreman settings from the following URL: <code>https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_Realm</em>/.well-known/openid-configuration</code>.
Replace <em>Foreman_Realm</em> with the name of the Keycloak realm created for your Foreman server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On the Foreman client registered to Keycloak:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the login delegation to <code>true</code> so that users can authenticate using the Open IDC protocol:</p>
<div class="listingblock">
<div class="content">
<pre># hammer settings set --name authorize_login_delegation --value true</pre>
</div>
</div>
</li>
<li>
<p>Set the login delegation logout URL:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name login_delegation_logout_url \
--value https://<em>foreman.example.com</em>/users/extlogout</pre>
</div>
</div>
</li>
<li>
<p>Set the algorithm for encoding:
For example, to use the <code>RS256</code> algorithm:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_algorithm --value 'RS256'</pre>
</div>
</div>
</li>
<li>
<p>Add the value for the Hammer client in the Open IDC audience:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_audience \
--value "['<em>foreman.example.com</em>-hammer-openidc']"</pre>
</div>
</div>
</li>
<li>
<p>Set the value for the Open IDC issuer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_issuer \
--value "https://<em>keycloak.example.com</em>/auth/realms/<em>KEYCLOAK_REALM</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set the value for Open IDC Java Web Token (JWT):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer settings set --name oidc_jwks_url \
--value "https://<em>keycloak.example.com</em>/auth/realms/<em>KEYCLOAK_REALM</em>/protocol/openid-connect/certs"</pre>
</div>
</div>
</li>
<li>
<p>Retrieve the ID of the Keycloak authentication source:</p>
<div class="listingblock">
<div class="content">
<pre># hammer auth-source external list</pre>
</div>
</div>
</li>
<li>
<p>Set the location and organization:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth-source external update \
--id <em>My_Authentication_Source_ID</em> \
--location-ids <em>My_Location_ID</em> \
--organization-ids <em>My_Organization_ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-foreman-with-keycloak-for-totp-authentication_keycloak-quarkus"><a class="anchor" href="#configuring-foreman-with-keycloak-for-totp-authentication_keycloak-quarkus"></a>5.4.6. Configuring Foreman with Keycloak for TOTP authentication</h4>
<div class="paragraph">
<p>If you want users to authenticate with time-based one-time passwords (TOTP), configure an OTP policy for the Foreman realm in Keycloak.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Keycloak web UI, navigate to the Foreman realm.</p>
</li>
<li>
<p>Navigate to <strong>Authentication</strong>.</p>
</li>
<li>
<p>On the <strong>Policies</strong> tab, click the <strong>OTP Policy</strong> tab.
Ensure that the <strong>Supported Applications</strong> field includes FreeOTP or Google Authenticator.</p>
</li>
<li>
<p>Configure the OTP settings to suit your requirements.</p>
</li>
<li>
<p>On <strong>Required Actions</strong> tab, enable the <strong>Set as default action</strong> setting for the <strong>Configure OTP</strong> action.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information, see <a href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/24.0/html/server_administration_guide/configuring-authentication_server_administration_guide#configuring-authentication_server_administration_guide">Red&#160;Hat Single Sign-On Server Administration Guide</a> or <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.6/html-single/server_administration_guide/index#configuring-authentication_server_administration_guide">Red&#160;Hat build of Keycloak Server Administration Guide</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-quarkus"><a class="anchor" href="#configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-quarkus"></a>5.4.7. Configuring Keycloak settings for authentication with PIV cards</h4>
<div class="paragraph">
<p>If you want users to authenticate with PIV cards, configure Keycloak for authentication with PIV cards and configure the operating system for PIV cards on each user system.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the Keycloak web UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <strong>Authentication</strong> tab.</p>
</li>
<li>
<p>From the <strong>Flows</strong> list, select <strong>Browser</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Copy</strong> to copy this flow.</p>
</li>
<li>
<p>In the <strong>Copy Authentication Flow</strong> window, enter a new name for the flow and click <strong>OK</strong>.</p>
</li>
<li>
<p>In the copied flow, delete the <strong>Username Password Form</strong> and <strong>OTP Form</strong> entries.</p>
</li>
<li>
<p>Click <strong>Add execution</strong>.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>X509/Validate Username Form</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the <strong>X509/Validate Username Form</strong> row, select <strong>ALTERNATIVE</strong>.
Click <strong>Actions</strong> &gt; <strong>Config</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Alias</strong> field, enter a name for this configuration.</p>
</li>
<li>
<p>From the <strong>User Identity Source</strong> list, select <strong>Subject’s Common Name</strong>,</p>
</li>
<li>
<p>From the <strong>User mapping method</strong> list, select <strong>Username or Email</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to <strong>Authentication</strong> &gt; <strong>Bindings</strong>.</p>
</li>
<li>
<p>From the <strong>Browser Flow</strong> list, select the created flow.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On each system from which you want users to log in to with PIV cards:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>opensc</code> package:</p>
<div class="ulist">
<ul>
<li>
<p>On Debian or Ubuntu:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># apt install opensc</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 8+:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install opensc</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 7:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install opensc</pre>
</div>
</div>
</li>
<li>
<p>On OpenSUSE and SUSE Linux Enterprise Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># zypper install opensc</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Make sure Mozilla Firefox is installed.</p>
</li>
<li>
<p>In Mozilla Firefox main menu, click <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Privacy and Security</strong> tab, click <strong>Security Devices</strong>.</p>
</li>
<li>
<p>Click <strong>Load</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Load PKCS#11 Device Driver</strong> window, enter <strong>/usr/lib64/pkcs11/opensc-pkcs11.so</strong> in the <strong>Module filename</strong> field.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If the PIV card is connected to system, restart the <code>pcscd</code> service.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-group-mapping-for-keycloak-authentication_keycloak-quarkus"><a class="anchor" href="#configuring-group-mapping-for-keycloak-authentication_keycloak-quarkus"></a>5.4.8. Optional: Configuring external group mapping for Keycloak authentication</h4>
<div class="paragraph">
<p>To implement the role-based access control (RBAC), create a group in Foreman, assign a role to this group, and then map an Keycloak group to the Foreman group.
As a result, anyone in the given group in Keycloak will log in under the corresponding Foreman group.</p>
</div>
<div class="paragraph">
<p>For example, you can configure users of the Foreman-admin user group defined in Active Directory to authenticate as users with administrator privileges on Foreman.</p>
</div>
<div class="paragraph">
<p>If you do not configure group mapping, every user will receive the <em>Default role</em> permissions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>.</p>
</li>
<li>
<p>Click <strong>Create User Group</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter a name for the user group.
Enter a name that is different from the Active Directory user group name.</p>
</li>
<li>
<p>Do not add any users or user groups to the new group in Foreman web UI.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On the <strong>Roles</strong> tab, select <strong>Administer</strong>.</p>
</li>
<li>
<p>On the <strong>External Groups</strong> tab, click <strong>Add external user group</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter the name of the Active Directory group.</p>
</li>
<li>
<p>From the <strong>Auth Source</strong> drop-down menu, select <strong>EXTERNAL</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-quarkus"><a class="anchor" href="#logging-in-to-project-configured-with-keycloak-as-an-authentication-source_keycloak-quarkus"></a>5.4.9. Logging in to Foreman configured with Keycloak as an authentication source</h4>
<div class="paragraph">
<p>With Keycloak configured as an external authentication source for Foreman, users defined in a Keycloak realm can log in to Foreman&#160;server.
The particular login methods available to users depend on how you configured integration between Keycloak and Foreman.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To authenticate to the Foreman web UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In your browser, go to <code>https://<em>foreman.example.com</em></code> and enter your credentials.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman web UI by using Keycloak TOTP:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your browser, log in to Foreman.
Foreman redirects you to the Keycloak login screen.</p>
</li>
<li>
<p>Enter your username and password, and click <strong>Log In</strong>.</p>
</li>
<li>
<p>On your first login attempt, Keycloak requests you to configure your client by scanning the bar code and entering your PIN.
Once authenticated, your browser redirects you back to Foreman and logs you in.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman CLI with Hammer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that Hammer is configured to enforce session usage in <code>~/.hammer/cli.modules.d/foreman.yml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :use_sessions: true</pre>
</div>
</div>
</li>
<li>
<p>Initiate an authentication session with <code>hammer auth login oauth</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--oidc-token-endpoint 'https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_realm</em>/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-hammer-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To authenticate to the Foreman CLI with Hammer by using Keycloak TOTP:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that Hammer is configured to enforce session usage in <code>~/.hammer/cli.modules.d/foreman.yml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">:foreman:
  :use_sessions: true</pre>
</div>
</div>
</li>
<li>
<p>Initiate an authentication session by using <code>--two-factor</code> with <code>hammer auth login oauth</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer auth login oauth \
--two-factor \
--oidc-token-endpoint 'https://<em>keycloak.example.com</em>/auth/realms/<em>Foreman_realm</em>/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<em>keycloak.example.com</em>/auth' \
--oidc-client-id '<em>foreman.example.com</em>-hammer-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</pre>
</div>
</div>
</li>
<li>
<p>You will be prompted to enter a success code.
To retrieve the success code, navigate to the URL that the command returns.</p>
</li>
<li>
<p>Enter the success code in CLI.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To log in to the Foreman web UI using the Keycloak PIV cards:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Mozilla Firefox, log in to Foreman and enter your credentials.</p>
</li>
<li>
<p>When prompted, enter the PIN of the PIV card.</p>
</li>
<li>
<p>Choose the certificate for authentication.
Browser verifies this certificate with Keycloak.
Once authenticated, browser redirects you back to Foreman and logs you in.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-active-directory-as-an-external-identity-provider-for-project_foreman"><a class="anchor" href="#configuring-active-directory-as-an-external-identity-provider-for-project_foreman"></a>5.5. Configuring Active Directory as an external identity provider for Foreman</h3>
<div class="paragraph">
<p>If the base system of your Foreman&#160;server is connected directly to Active Directory (AD), you can configure AD as an external authentication source for Foreman.
Direct AD integration means that a Linux system is joined directly to the AD domain where the identity is stored.
The following login methods are available for AD users:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Username and password</p>
</li>
<li>
<p>Kerberos single sign-on</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can also connect your Foreman deployment to AD in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By using indirect AD integration.
With indirect integration, your Foreman&#160;server is connected to a FreeIPA server which is then connected to AD.
For more information, see <a href="#configuring-kerberos-single-sign-on-with-FreeIPA-in-project_foreman">Configuring Kerberos single sign-on with FreeIPA in Foreman</a>.</p>
</li>
<li>
<p>By attaching the LDAP server of the AD domain as an external authentication source with no single sign-on support.
For more information, see <a href="#configuring-an-ldap-server-as-an-external-identity-provider-for-project_foreman">Configuring an LDAP server as an external identity provider for Foreman</a>.
For an example configuration, see <a href="https://access.redhat.com/solutions/1498773">How to configure Active Directory authentication with TLS on Foreman</a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-the-active-directory-authentication-source-on-projectserver_foreman"><a class="anchor" href="#configuring-the-active-directory-authentication-source-on-projectserver_foreman"></a>5.5.1. Configuring the Active Directory authentication source on Foreman&#160;server</h4>
<div class="paragraph">
<p>Enable Active Directory (AD) users to access Foreman by configuring the corresponding authentication provider on your Foreman&#160;server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The base system of your Foreman&#160;server must be joined to an Active Directory (AD) domain.
To enable AD users to sign in with Kerberos single sign-on, use the System Security Services Daemon (SSSD) and Samba services to join the base system to the AD domain:</p>
<div class="paragraph">
<p>Install the following packages on Foreman&#160;server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install adcli krb5-workstation oddjob-mkhomedir oddjob realmd samba-winbind-clients samba-winbind samba-common-tools samba-winbind-krb5-locator sssd</pre>
</div>
</div>
<div class="paragraph">
<p>Specify the required software when joining the AD domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># realm join <em>AD.EXAMPLE.COM</em> --membership-software=samba --client-software=sssd</pre>
</div>
</div>
<div class="paragraph">
<p>For more information on direct AD integration, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html-single/integrating_rhel_systems_directly_with_windows_active_directory/index#connecting-rhel-systems-directly-to-ad-using-samba-winbind_integrating-rhel-systems-directly-with-active-directory">Connecting RHEL systems directly to AD using Samba Winbind</a>.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define AD realm configuration in a location where foreman-installer expects it:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a directory named <code>/etc/ipa/</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /etc/ipa/</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/etc/ipa/default.conf</code> file with the following contents to configure the Kerberos realm for the AD domain:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[global]
realm = <em>AD.EXAMPLE.COM</em></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the Apache keytab for Kerberos connections:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Update the <code>/etc/samba/smb.conf</code> file with the following settings to configure how Samba interacts with AD:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[global]
workgroup = <em>AD.EXAMPLE</em>
realm = <em>AD.EXAMPLE.COM</em>
kerberos method = system keytab
security = ads</pre>
</div>
</div>
</li>
<li>
<p>Add the Kerberos service principal to the keytab file at <code>/etc/httpd/conf/http.keytab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># KRB5_KTNAME=FILE:/etc/httpd/conf/http.keytab net ads keytab create HTTP -U Administrator -s /etc/samba/smb.conf</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>net ads keytab create</code> command was introduced in Samba version 4.21.1.
If your system uses an earlier version of Samba, use the <code>net ads keytab add</code> command.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the System Security Services Daemon (SSSD) to use the AD access control provider to evaluate and enforce Group Policy Object (GPO) access control rules for the <code>foreman</code> PAM service:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <code>[domain/<em>ad.example.com</em>]</code> section of your <code>/etc/sssd/sssd.conf</code> file, configure the <code>ad_gpo_access_control</code> and <code>ad_gpo_map_service</code> options as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[domain/<em>ad.example.com</em>]
ad_gpo_access_control = enforcing
ad_gpo_map_service = +foreman</pre>
</div>
</div>
<div class="paragraph">
<p>For more information on GPOs, see the following documents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/integrating_rhel_systems_directly_with_windows_active_directory/managing-direct-connections-to-ad_integrating-rhel-systems-directly-with-active-directory#how-sssd-interprets-gpo-access-control-rules_applying-group-policy-object-access-control-in-rhel">How SSSD interprets GPO access control rules</a> in <em>Integrating RHEL systems directly with Windows Active Directory (RHEL&#160;9)</em></p>
</li>
<li>
<p><a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/integrating_rhel_systems_directly_with_windows_active_directory/managing-direct-connections-to-ad_integrating-rhel-systems-directly-with-active-directory#applying-group-policy-object-access-control-in-rhel_managing-direct-connections-to-ad">How SSSD interprets GPO access control rules</a> in <em>Integrating RHEL systems directly with Windows Active Directory (RHEL&#160;8)</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Restart SSSD:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart sssd</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Enable the authentication source:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-ipa-authentication=true</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To verify that AD users can log in to Foreman by entering their credentials, log in to Foreman web UI at https://foreman.example.com.
Enter the user name in the user principal name (UPN) format, for example: <code><em>ad_user</em>@<em>AD.EXAMPLE.COM</em></code>.</p>
</li>
<li>
<p>To verify that AD users can authenticate by using Kerberos single sign-on:</p>
<div class="ulist">
<ul>
<li>
<p>Obtain a Kerberos ticket-granting ticket (TGT) on behalf of an AD user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kinit <em>ad_user</em>@<em>AD.EXAMPLE.COM</em></pre>
</div>
</div>
</li>
<li>
<p>Verify user authentication by using your TGT:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl -k -u : --negotiate https://foreman.example.com/users/extlogin

&lt;html&gt;&lt;body&gt;You are being &lt;a href="foreman.example.com/hosts"&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Troubleshooting</div>
<ul>
<li>
<p>Connecting to the AD LDAP can sometimes fail with an error such as the following appearing in the logs:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Authentication failed with status code: {
  "error": { "message": "ERF77-7629 [Foreman::LdapException]: Error while connecting to 'server.com' LDAP server at 'ldap.example.com' during authentication ([Net::LDAP::Error]: Connection reset by peer - SSL_connect)" } }</pre>
</div>
</div>
<div class="paragraph">
<p>If you see this error, verify which cipher is used for the connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl s_client -connect <em>ldap.example.com</em>:636</pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384</code> cipher is used, disable it on either the Foreman&#160;server side or on the AD side.
The <code>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384</code> cipher is known to cause incompatibilities.</p>
</div>
<div class="paragraph">
<p>For information on configuring system-wide cryptographic policies, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/security_hardening/using-the-system-wide-cryptographic-policies_security-hardening">Using system-wide cryptographic policies</a> in <em>Red&#160;Hat Enterprise Linux&#160;9 Security hardening</em>.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><code>sssd-ad(5)</code> man page on your system</p>
</li>
<li>
<p>For information about configuring Mozilla Firefox for Kerberos, see <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/configuring_authentication_and_authorization_in_rhel/configuring_applications_for_sso#Configuring_Firefox_to_use_Kerberos_for_SSO">Configuring Firefox to use Kerberos for single sign-on</a> in <em>Red&#160;Hat Enterprise Linux&#160;9 Configuring authentication and authorization in RHEL</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-project-to-manage-the-lifecycle-of-a-host-registered-to-a-freeipa-realm_foreman"><a class="anchor" href="#configuring-project-to-manage-the-lifecycle-of-a-host-registered-to-a-freeipa-realm_foreman"></a>5.6. Configuring Foreman to manage the lifecycle of a host registered to a FreeIPA realm</h3>
<div class="paragraph">
<p>As well as providing access to Foreman&#160;server, hosts provisioned with Foreman can also be integrated with FreeIPA realms.
Foreman has a realm feature that automatically manages the lifecycle of any system registered to a realm or domain provider.</p>
</div>
<div class="paragraph">
<p>Use this section to configure Foreman&#160;server or Smart&#160;Proxy&#160;server for FreeIPA realm support, then add hosts to the FreeIPA realm group.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Foreman&#160;server that is registered to the Content Delivery Network or an external Smart&#160;Proxy&#160;server that is registered to Foreman&#160;server.</p>
</li>
<li>
<p>A deployed realm or domain provider such as FreeIPA.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">To install and configure FreeIPA packages on Foreman&#160;server or Smart&#160;Proxy&#160;server:</div>
<p>To use FreeIPA for provisioned hosts, complete the following steps to install and configure FreeIPA packages on Foreman&#160;server or Smart&#160;Proxy&#160;server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>ipa-client</code> package on Foreman&#160;server or Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ipa-client</pre>
</div>
</div>
</li>
<li>
<p>Configure the server as a FreeIPA client:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install</pre>
</div>
</div>
</li>
<li>
<p>Create a realm proxy user, <code>realm-smart-proxy</code>, and the relevant roles in FreeIPA:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-prepare-realm admin realm-smart-proxy</pre>
</div>
</div>
<div class="paragraph">
<p>Note the principal name that returns and your FreeIPA server configuration details because you require them for the following procedure.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">To configure Foreman&#160;server or Smart&#160;Proxy&#160;server for FreeIPA realm support:</div>
<p>Complete the following procedure on Foreman and every Smart&#160;Proxy that you want to use:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy the <code>/root/freeipa.keytab</code> file to any Smart&#160;Proxy&#160;server that you want to include in the same principal and realm:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/freeipa.keytab root@<em>smartproxy.example.com</em>:/etc/foreman-proxy/freeipa.keytab</pre>
</div>
</div>
</li>
<li>
<p>On your Foreman&#160;server, move the <code>/root/freeipa.keytab</code> file to the <code>/etc/foreman-proxy</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /root/freeipa.keytab /etc/foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>On your Foreman&#160;server and Smart&#160;Proxy&#160;servers, set ownership to the <code>foreman-proxy</code> user and group:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown foreman-proxy:foreman-proxy /etc/foreman-proxy/freeipa.keytab</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command on all Smart&#160;Proxies that you want to include in the realm.
If you use the integrated Smart&#160;Proxy on Foreman, enter this command on Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-realm true \
--foreman-proxy-realm-keytab /etc/foreman-proxy/freeipa.keytab \
--foreman-proxy-realm-principal <em>realm-smart-proxy@EXAMPLE.COM</em> \
--foreman-proxy-realm-provider freeipa</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use these options when you first configure the Foreman&#160;server.</p>
</div>
</li>
<li>
<p>Ensure that the most updated versions of the ca-certificates package is installed and trust the FreeIPA Certificate Authority:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /etc/ipa/ca.crt /etc/pki/ca-trust/source/anchors/ipa.crt
# update-ca-trust extract</pre>
</div>
</div>
</li>
<li>
<p>Optional: If you configure FreeIPA on an existing Foreman&#160;server or Smart&#160;Proxy&#160;server, complete the following steps to ensure that the configuration changes take effect:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Restart the <strong>foreman-proxy</strong> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>.</p>
</li>
<li>
<p>Locate the Smart&#160;Proxy you have configured for FreeIPA and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">To create a realm for the FreeIPA-enabled Smart&#160;Proxy</div>
<p>After you configure your integrated or external Smart&#160;Proxy with FreeIPA, you must create a realm and add the FreeIPA-configured Smart&#160;Proxy to the realm.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Realms</strong> and click <strong>Create Realm</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the realm.</p>
</li>
<li>
<p>From the <strong>Realm Type</strong> list, select the type of realm.</p>
</li>
<li>
<p>From the <strong>Realm Smart&#160;Proxy</strong> list, select Smart&#160;Proxy&#160;server where you have configured FreeIPA.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and from the <strong>Locations</strong> list, select the location where you want to add the new realm.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and from the <strong>Organizations</strong> list, select the organization where you want to add the new realm.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Updating host groups with realm information</div>
<p>You must update any host groups that you want to use with the new realm information.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>, select the host group that you want to update, and click the <strong>Network</strong> tab.</p>
</li>
<li>
<p>From the <strong>Realm</strong> list, select the realm you create as part of this procedure, and then click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Adding hosts to a FreeIPA host group</div>
<p>FreeIPA supports the ability to set up automatic membership rules based on a system&#8217;s attributes.
Foreman&#8217;s realm feature provides administrators with the ability to map the Foreman host groups to the FreeIPA parameter <code>userclass</code> which allow administrators to configure automembership.</p>
</div>
<div class="paragraph">
<p>When nested host groups are used, they are sent to the FreeIPA server as they are displayed in the Foreman User Interface.
For example, "Parent/Child/Child".</p>
</div>
<div class="paragraph">
<p>Foreman&#160;server or Smart&#160;Proxy&#160;server sends updates to the FreeIPA server, however automembership rules are only applied at initial registration.</p>
</div>
<div class="olist arabic">
<div class="title">To add hosts to a FreeIPA host group:</div>
<ol class="arabic">
<li>
<p>On the FreeIPA server, create a host group:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa hostgroup-add <em>hostgroup_name</em> --desc=<em>hostgroup_description</em></pre>
</div>
</div>
</li>
<li>
<p>Create an <code>automembership</code> rule:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa automember-add --type=hostgroup <em>hostgroup_name</em> <em>automember_rule</em></pre>
</div>
</div>
<div class="paragraph">
<p>Where you can use the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>automember-add</code> flags the group as an automember group.</p>
</li>
<li>
<p><code>--type=hostgroup</code> identifies that the target group is a host group, not a user group.</p>
</li>
<li>
<p><code><em>automember_rule</em></code> adds the name you want to identify the automember rule by.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Define an automembership condition based on the <code>userclass</code> attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa automember-add-condition --key=userclass --type=hostgroup --inclusive-regex=<em>^webserver</em> <em>hostgroup_name</em>
----------------------------------
Added condition(s) to "<em>hostgroup_name</em>"
----------------------------------
Automember Rule: <em>automember_rule</em>
Inclusive Regex: userclass=<em>^webserver</em>
----------------------------
Number of conditions added 1
----------------------------</pre>
</div>
</div>
<div class="paragraph">
<p>Where you can use the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>automember-add-condition</code> adds regular expression conditions to identify group members.</p>
</li>
<li>
<p><code>--key=userclass</code> specifies the key attribute as <code>userclass</code>.</p>
</li>
<li>
<p><code>--type=hostgroup</code> identifies that the target group is a host group, not a user group.</p>
</li>
<li>
<p><code>--inclusive-regex=</code> <em>^webserver</em> identifies matching values with a regular expression pattern.</p>
</li>
<li>
<p><em>hostgroup_name</em> &#8211; identifies the target host group&#8217;s name.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When a system is added to Foreman&#160;server&#8217;s <em>hostgroup_name</em> host group, it is added automatically to the FreeIPA server&#8217;s "<em>hostgroup_name</em>" host group.
FreeIPA host groups allow for Host-Based Access Controls (HBAC), sudo policies and other FreeIPA functions.</p>
</div>
</div>
<div class="sect2">
<h3 id="important-user-and-group-account-information-for-active-directory-accounts_foreman"><a class="anchor" href="#important-user-and-group-account-information-for-active-directory-accounts_foreman"></a>5.7. Important user and group account information for Active Directory accounts</h3>
<div class="paragraph">
<p>All user and group accounts must be local accounts.
This is to ensure that there are no authentication conflicts between local accounts on your Foreman&#160;server and accounts in your Active Directory domain.</p>
</div>
<div class="paragraph">
<p>Your system is not affected by this conflict if your user and group accounts exist in both <code>/etc/passwd</code> and <code>/etc/group</code> files.
For example, to check if entries for <code>puppet</code>, <code>apache</code>, <code>foreman</code> and <code>foreman-proxy</code> groups exist in both <code>/etc/passwd</code> and <code>/etc/group</code> files, enter the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># grep 'puppet\|apache\|foreman\|foreman-proxy' /etc/passwd /etc/group</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_External_User_Groups_foreman"><a class="anchor" href="#Configuring_External_User_Groups_foreman"></a>5.8. Configuring external user groups</h3>
<div class="paragraph">
<p>Foreman does not associate external users with their user group automatically.
You must create a user group with the same name as in the external source on Foreman.
Members of the external user group then automatically become members of the Foreman user group and receive the associated permissions.</p>
</div>
<div class="paragraph">
<p>The configuration of external user groups depends on the type of external authentication.</p>
</div>
<div class="paragraph">
<p>To assign additional permissions to an external user, add this user to an internal user group that has no external mapping specified.
Then assign the required roles to this group.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>If you use an LDAP server, configure Foreman to use LDAP authentication.
For more information, see <a href="#configuring-an-ldap-server-as-an-external-identity-provider-for-project_foreman">Configuring an LDAP server as an external identity provider for Foreman</a>.</p>
<div class="paragraph">
<p>When using external user groups from an LDAP source, you cannot use the <code>$login</code> variable as a substitute for the account user name.
You must use either an anonymous or dedicated service user.</p>
</div>
</li>
<li>
<p>If you use a FreeIPA or AD server, configure Foreman to use FreeIPA or AD authentication.
For more information, see <a href="https://docs.theforeman.org/3.11/Installing_Server/index-katello.html#Configuring_External_Authentication_foreman">Configuring External Authentication</a> in <em>Installing Foreman&#160;Server with Katello 4.13 plugin on Enterprise Linux</em>.</p>
</li>
<li>
<p>Ensure that at least one external user authenticates for the first time.</p>
</li>
<li>
<p>Retain a copy of the external group names you want to use.
To find the group membership of external users, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id <em>username</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>User Groups</strong>, and click <strong>Create User Group</strong>.</p>
</li>
<li>
<p>Specify the name of the new user group.
Do not select any users to avoid adding users automatically when you refresh the external user group.</p>
</li>
<li>
<p>Click the <strong>Roles</strong> tab and select the roles you want to assign to the user group.
Alternatively, select the <strong>Administrator</strong> checkbox to assign all available permissions.</p>
</li>
<li>
<p>Click the <strong>External groups</strong> tab, then click <strong>Add external user group</strong>, and select an authentication source from the <strong>Auth source</strong> drop-down menu.</p>
<div class="paragraph">
<p>Specify the exact name of the external group in the <strong>Name</strong> field.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Refreshing_External_User_Groups_for_LDAP_foreman"><a class="anchor" href="#Refreshing_External_User_Groups_for_LDAP_foreman"></a>5.9. Refreshing external user groups for LDAP</h3>
<div class="paragraph">
<p>To set the LDAP source to synchronize user group membership automatically on user login, in the <strong>Auth Source</strong> page, select the <strong>Usergroup Sync</strong> option.
If this option is not selected, LDAP user groups are refreshed automatically through a scheduled cron job synchronizing the LDAP Authentication source every 30 minutes by default.</p>
</div>
<div class="paragraph">
<p>If the user groups in the LDAP Authentication source change in the lapse of time between scheduled tasks, the user can be assigned to incorrect external user groups.
This is corrected automatically when the scheduled task runs.</p>
</div>
<div class="paragraph">
<p>Use this procedure to refresh the LDAP source manually.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Usergroups</strong> and select a user group.</p>
</li>
<li>
<p>On the <strong>External Groups</strong> tab, click <strong>Refresh</strong> to the right of the required user group.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre># foreman-rake ldap:refresh_usergroups</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Refreshing_External_User_Groups_for_FreeIPA_or_AD_foreman"><a class="anchor" href="#Refreshing_External_User_Groups_for_FreeIPA_or_AD_foreman"></a>5.10. Refreshing external user groups for FreeIPA or AD</h3>
<div class="paragraph">
<p>External user groups based on FreeIPA or AD are refreshed only when a group member logs in to Foreman.
It is not possible to alter user membership of external user groups in the Foreman web UI, such changes are overwritten on the next group refresh.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-external-services"><a class="anchor" href="#configuring-external-services"></a>6. Configuring Foreman&#160;server with external services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you do not want to configure the DNS, DHCP, and TFTP services on Foreman&#160;server, use this section to configure your Foreman&#160;server to work with external DNS, DHCP, and TFTP services.</p>
</div>
<div class="sect2">
<h3 id="configuring-external-dns_foreman"><a class="anchor" href="#configuring-external-dns_foreman"></a>6.1. Configuring Foreman&#160;server with external DNS</h3>
<div class="paragraph">
<p>You can configure Foreman&#160;server with external DNS.
Foreman&#160;server uses the <code>nsupdate</code> utility to update DNS records on the remote server.</p>
</div>
<div class="paragraph">
<p>To make any changes persistent, you must enter the <code>foreman-installer</code> command with the options appropriate for your environment.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have a configured external DNS server.</p>
</li>
<li>
<p>This guide assumes you have an existing installation.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the <code>/etc/rndc.key</code> file from the external DNS server to Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp root@<em>dns.example.com</em>:/etc/rndc.key /etc/foreman-proxy/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Configure the ownership, permissions, and SELinux context:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -v /etc/foreman-proxy/rndc.key
# chown -v root:foreman-proxy /etc/foreman-proxy/rndc.key
# chmod -v 640 /etc/foreman-proxy/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>To test the <code>nsupdate</code> utility, add a host remotely:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server <em>DNS_IP_Address</em>\n \
update add aaa.example.com 3600 IN A <em>Host_IP_Address</em>\n \
send\n" | nsupdate -k /etc/foreman-proxy/rndc.key
# nslookup aaa.example.com <em>DNS_IP_Address</em>
# echo -e "server <em>DNS_IP_Address</em>\n \
update delete aaa.example.com 3600 IN A <em>Host_IP_Address</em>\n \
send\n" | nsupdate -k /etc/foreman-proxy/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/dns.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dns=true \
--foreman-proxy-dns-managed=false \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="<em>DNS_IP_Address</em>" \
--foreman-proxy-keyfile=/etc/foreman-proxy/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>.</p>
</li>
<li>
<p>Locate the Foreman&#160;server and select <strong>Refresh</strong> from the list in the <strong>Actions</strong> column.</p>
</li>
<li>
<p>Associate the DNS service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-dhcp_foreman"><a class="anchor" href="#configuring-external-dhcp_foreman"></a>6.2. Configuring Foreman&#160;server with external DHCP</h3>
<div class="paragraph">
<p>To configure Foreman&#160;server with external DHCP, you must complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#configuring-an-external-dhcp-server_foreman">Configuring an external DHCP server to use with Foreman&#160;server</a></p>
</li>
<li>
<p><a href="#Configuring_Server_with_an_External_DHCP_Server_foreman">Configuring Foreman&#160;server with an external DHCP server</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="configuring-an-external-dhcp-server_foreman"><a class="anchor" href="#configuring-an-external-dhcp-server_foreman"></a>6.2.1. Configuring an external DHCP server to use with Foreman&#160;server</h4>
<div class="paragraph">
<p>To configure an external DHCP server running Enterprise Linux to use with Foreman&#160;server, you must install the ISC DHCP Service and Berkeley Internet Name Domain (BIND) utilities packages.
You must also share the DHCP configuration and lease files with Foreman&#160;server.
The example in this procedure uses the distributed Network File System (NFS) protocol to share the DHCP configuration and lease files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you use dnsmasq as an external DHCP server, enable the <code>dhcp-no-override</code> setting.
This is required because Foreman creates configuration files on the TFTP server under the <code>grub2/</code> subdirectory.
If the <code>dhcp-no-override</code> setting is disabled, hosts fetch the bootloader and its configuration from the root directory, which might cause an error.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Enterprise Linux host, install the ISC DHCP Service and Berkeley Internet Name Domain (BIND) utilities packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install dhcp-server bind-utils</pre>
</div>
</div>
</li>
<li>
<p>Generate a security token:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># tsig-keygen -a hmac-md5 omapi_key</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>dhcpd</code> configuration file for all subnets and add the key generated by <code>tsig-keygen</code>.
The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/dhcp/dhcpd.conf
default-lease-time 604800;
max-lease-time 2592000;
log-facility local7;

subnet <em>192.168.38.0</em> netmask <em>255.255.255.0</em> {
	range <em>192.168.38.10 192.168.38.100</em>;
	option routers <em>192.168.38.1</em>;
	option subnet-mask <em>255.255.255.0</em>;
	option domain-search "<em>virtual.lan</em>";
	option domain-name "<em>virtual.lan</em>";
	option domain-name-servers <em>8.8.8.8</em>;
}

omapi-port 7911;
key omapi_key {
	algorithm hmac-md5;
	secret "<em>My_Secret</em>";
};
omapi-key omapi_key;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>option routers</code> value is the IP address of your Foreman&#160;server or Smart&#160;Proxy&#160;server that you want to use with an external DHCP service.</p>
</div>
</li>
<li>
<p>On Foreman&#160;server, define each subnet.
Do not set DHCP Smart&#160;Proxy for the defined Subnet yet.</p>
<div class="paragraph">
<p>To prevent conflicts, set up the lease and reservation ranges separately.
For example, if the lease range is 192.168.38.10 to 192.168.38.100, in the Foreman web UI define the reservation range as 192.168.38.101 to 192.168.38.250.</p>
</div>
</li>
<li>
<p>Configure the firewall for external access to the DHCP server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-service dhcp</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, determine the UID and GID of the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id -u foreman
<em>993</em>
# id -g foreman
<em>990</em></pre>
</div>
</div>
</li>
<li>
<p>On the DHCP server, create the <code>foreman</code> user and group with the same IDs as determined in a previous step:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># groupadd -g <em>990</em> foreman
# useradd -u <em>993</em> -g <em>990</em> -s /sbin/nologin foreman</pre>
</div>
</div>
</li>
<li>
<p>To ensure that the configuration files are accessible, restore the read and execute flags:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod o+rx /etc/dhcp/
# chmod o+r /etc/dhcp/dhcpd.conf
# chattr +i /etc/dhcp/ /etc/dhcp/dhcpd.conf</pre>
</div>
</div>
</li>
<li>
<p>Enable and start the DHCP service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl enable --now dhcpd</pre>
</div>
</div>
</li>
<li>
<p>Export the DHCP configuration and lease files using NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install nfs-utils
# systemctl enable --now nfs-server</pre>
</div>
</div>
</li>
<li>
<p>Create directories for the DHCP configuration and lease files that you want to export using NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /exports/var/lib/dhcpd /exports/etc/dhcp</pre>
</div>
</div>
</li>
<li>
<p>To create mount points for the created directories, add the following line to the <code>/etc/fstab</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/var/lib/dhcpd /exports/var/lib/dhcpd none bind,auto 0 0
/etc/dhcp /exports/etc/dhcp none bind,auto 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems in <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>Ensure the following lines are present in <code>/etc/exports</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/exports <em>192.168.38.1</em>(rw,async,no_root_squash,fsid=0,no_subtree_check)

/exports/etc/dhcp <em>192.168.38.1</em>(ro,async,no_root_squash,no_subtree_check,nohide)

/exports/var/lib/dhcpd <em>192.168.38.1</em>(ro,async,no_root_squash,no_subtree_check,nohide)</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the IP address that you enter is the Foreman or Smart&#160;Proxy IP address that you want to use with an external DHCP service.</p>
</div>
</li>
<li>
<p>Reload the NFS server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># exportfs -rva</pre>
</div>
</div>
</li>
<li>
<p>Configure the firewall for DHCP omapi port 7911:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port=7911/tcp</pre>
</div>
</div>
</li>
<li>
<p>Optional: Configure the firewall for external access to NFS.
Clients are configured using NFSv3.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd \
--add-service mountd \
--add-service nfs \
--add-service rpc-bind \
--zone public</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Server_with_an_External_DHCP_Server_foreman"><a class="anchor" href="#Configuring_Server_with_an_External_DHCP_Server_foreman"></a>6.2.2. Configuring Foreman&#160;server with an external DHCP server</h4>
<div class="paragraph">
<p>You can configure Foreman&#160;server with an external DHCP server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you have configured an external DHCP server and that you have shared the DHCP configuration and lease files with Foreman&#160;server.
For more information, see <a href="#configuring-an-external-dhcp-server_foreman">Configuring an external DHCP server to use with Foreman&#160;server</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the <code>nfs-utils</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install nfs-utils</pre>
</div>
</div>
</li>
<li>
<p>Create the DHCP directories for NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /mnt/nfs/etc/dhcp /mnt/nfs/var/lib/dhcpd</pre>
</div>
</div>
</li>
<li>
<p>Change the file owner:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R foreman-proxy /mnt/nfs</pre>
</div>
</div>
</li>
<li>
<p>Verify communication with the NFS server and the Remote Procedure Call (RPC) communication paths:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># showmount -e <em>DHCP_Server_FQDN</em>
# rpcinfo -p <em>DHCP_Server_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>Add the following lines to the <code>/etc/fstab</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>DHCP_Server_FQDN</em>:/exports/etc/dhcp /mnt/nfs/etc/dhcp nfs
ro,vers=3,auto,nosharecache,context="system_u:object_r:dhcp_etc_t:s0" 0 0

<em>DHCP_Server_FQDN</em>:/exports/var/lib/dhcpd /mnt/nfs/var/lib/dhcpd nfs
ro,vers=3,auto,nosharecache,context="system_u:object_r:dhcpd_state_t:s0" 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems on <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>To verify that the <code>foreman-proxy</code> user can access the files that are shared over the network, display the DHCP configuration and lease files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su foreman-proxy -s /bin/bash
$ cat /mnt/nfs/etc/dhcp/dhcpd.conf
$ cat /mnt/nfs/var/lib/dhcpd/dhcpd.leases
$ exit</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/dhcp.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-proxy-plugin-dhcp-remote-isc \
--foreman-proxy-dhcp-provider=remote_isc \
--foreman-proxy-dhcp-server=<em>My_DHCP_Server_FQDN</em> \
--foreman-proxy-dhcp=true \
--foreman-proxy-plugin-dhcp-remote-isc-dhcp-config /mnt/nfs/etc/dhcp/dhcpd.conf \
--foreman-proxy-plugin-dhcp-remote-isc-dhcp-leases /mnt/nfs/var/lib/dhcpd/dhcpd.leases \
--foreman-proxy-plugin-dhcp-remote-isc-key-name=omapi_key \
--foreman-proxy-plugin-dhcp-remote-isc-key-secret=<em>My_Secret</em> \
--foreman-proxy-plugin-dhcp-remote-isc-omapi-port=7911</pre>
</div>
</div>
</li>
<li>
<p>Associate the DHCP service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-tftp_foreman"><a class="anchor" href="#configuring-external-tftp_foreman"></a>6.3. Configuring Foreman&#160;server with external TFTP</h3>
<div class="paragraph">
<p>You can configure Foreman&#160;server with external TFTP services.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the TFTP directory for NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /mnt/nfs/var/lib/tftpboot</pre>
</div>
</div>
</li>
<li>
<p>In the <code>/etc/fstab</code> file, add the following line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>TFTP_Server_IP_Address</em>:/exports/var/lib/tftpboot /mnt/nfs/var/lib/tftpboot nfs rw,vers=3,auto,nosharecache,context="system_u:object_r:tftpdir_rw_t:s0" 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems in <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/tftp.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-tftp-root /mnt/nfs/var/lib/tftpboot \
--foreman-proxy-tftp=true</pre>
</div>
</div>
</li>
<li>
<p>If the TFTP service is running on a different server than the DHCP service, update the <code>tftp_servername</code> setting with the FQDN or IP address of the server that the TFTP service is running on:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-tftp-servername=<em>TFTP_Server_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>.</p>
</li>
<li>
<p>Locate the Foreman&#160;server and select <strong>Refresh</strong> from the list in the <strong>Actions</strong> column.</p>
</li>
<li>
<p>Associate the TFTP service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-idm-dns_foreman"><a class="anchor" href="#configuring-external-idm-dns_foreman"></a>6.4. Configuring Foreman&#160;server with external IdM DNS</h3>
<div class="paragraph">
<p>When Foreman&#160;server adds a DNS record for a host, it first determines which Smart&#160;Proxy is providing DNS for that domain.
It then communicates with the Smart&#160;Proxy that is configured to provide DNS service for your deployment and adds the record.
The hosts are not involved in this process.
Therefore, you must install and configure the IdM client on the Foreman or Smart&#160;Proxy that is currently configured to provide a DNS service for the domain you want to manage using the IdM server.</p>
</div>
<div class="paragraph">
<p>Foreman&#160;server can be configured to use a Red&#160;Hat Identity Management (IdM) server to provide DNS service.</p>
</div>
<div class="paragraph">
<p>To configure Foreman&#160;server to use a Red&#160;Hat Identity Management (IdM) server to provide DNS service, use one of the following procedures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuring-dynamic-dns-update-with-gss-tsig-authentication_foreman">Configuring dynamic DNS update with GSS-TSIG authentication</a></p>
</li>
<li>
<p><a href="#configuring-dynamic-dns-update-with-tsig-authentication_foreman">Configuring dynamic DNS update with TSIG authentication</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To revert to internal DNS service, use the following procedure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#reverting-to-internal-dns-service_foreman">Reverting to internal DNS service</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You are not required to use Foreman&#160;server to manage DNS.
When you are using the realm enrollment feature of Foreman, where provisioned hosts are enrolled automatically to IdM, the <code>ipa-client-install</code> script creates DNS records for the client.
Configuring Foreman&#160;server with external IdM DNS and realm enrollment are mutually exclusive.
For more information about configuring realm enrollment, see
<a href="#configuring-project-to-manage-the-lifecycle-of-a-host-registered-to-a-freeipa-realm_foreman">Configuring Foreman to manage the lifecycle of a host registered to a FreeIPA realm</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-dynamic-dns-update-with-gss-tsig-authentication_foreman"><a class="anchor" href="#configuring-dynamic-dns-update-with-gss-tsig-authentication_foreman"></a>6.4.1. Configuring dynamic DNS update with GSS-TSIG authentication</h4>
<div class="paragraph">
<p>You can configure the IdM server to use the generic security service algorithm for secret key transaction (GSS-TSIG) technology defined in <a href="https://tools.ietf.org/html/rfc3645">RFC3645</a>.
To configure the IdM server to use the GSS-TSIG technology, you must install the IdM client on the Foreman&#160;server base operating system.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must ensure the IdM server is deployed and the host-based firewall is configured correctly.</p>
</li>
<li>
<p>You must contact the IdM server administrator to ensure that you obtain an account on the IdM server with permissions to create zones on the IdM server.</p>
</li>
<li>
<p>You should create a backup of the answer file.
You can use the backup to restore the answer file to its original state if it becomes corrupted.
For more information, see <a href="https://docs.theforeman.org/3.11/Installing_Server/index-katello.html#configuring-server_foreman">Configuring Foreman&#160;server</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure dynamic DNS update with GSS-TSIG authentication, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Creating a Kerberos principal on the IdM server</div>
<ol class="arabic">
<li>
<p>Obtain a Kerberos ticket for the account obtained from the IdM administrator:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit <em>idm_user</em></pre>
</div>
</div>
</li>
<li>
<p>Create a new Kerberos principal for Foreman&#160;server to use to authenticate on the IdM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa service-add <em>smartproxy/foreman.example.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Installing and configuring the idM client</div>
<ol class="arabic">
<li>
<p>On the base operating system of either the Foreman or Smart&#160;Proxy that is managing the DNS service for your deployment, install the <code>ipa-client</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ipa-client</pre>
</div>
</div>
</li>
<li>
<p>Configure the IdM client by running the installation script and following the on-screen prompts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install</pre>
</div>
</div>
</li>
<li>
<p>Obtain a Kerberos ticket:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit admin</pre>
</div>
</div>
</li>
<li>
<p>Remove any preexisting <code>keytab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
</li>
<li>
<p>Obtain the <code>keytab</code> for this system:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-getkeytab -p smartproxy/<em>foreman.example.com@EXAMPLE.COM</em> \
-s <em>idm1.example.com</em> -k /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When adding a keytab to a standby system with the same host name as the original system in service, add the <code>r</code> option to prevent generating new credentials and rendering the credentials on the original system invalid.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For the <code>dns.keytab</code> file, set the group and owner to <code>foreman-proxy</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown foreman-proxy:foreman-proxy /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
</li>
<li>
<p>Optional: To verify that the <code>keytab</code> file is valid, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit -kt /etc/foreman-proxy/dns.keytab \
smartproxy/<em>foreman.example.com@EXAMPLE.COM</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Configuring DNS zones in the IdM web UI</div>
<ol class="arabic">
<li>
<p>Create and configure the zone that you want to manage:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.</p>
</li>
<li>
<p>Select <strong>Add</strong> and enter the zone name.
For example, <code>example.com</code>.</p>
</li>
<li>
<p>Click <strong>Add and Edit</strong>.</p>
</li>
<li>
<p>Click the Settings tab and in the <strong>BIND update policy</strong> box, add the following to the semi-colon separated list:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant smartproxy\047<em>foreman.example.com@EXAMPLE.COM</em> wildcard * ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Enable <strong>Allow PTR sync</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create and configure the reverse zone:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Select <strong>Reverse zone IP network</strong> and add the network address in CIDR format to enable reverse lookups.</p>
</li>
<li>
<p>Click <strong>Add and Edit</strong>.</p>
</li>
<li>
<p>Click the <strong>Settings</strong> tab and in the <strong>BIND update policy</strong> box, add the following to the semi-colon separated list:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant smartproxy\047<em>foreman.example.com@EXAMPLE.COM</em> wildcard * ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Configuring the Foreman or Smart&#160;Proxy&#160;server that manages the DNS service for the domain</div>
<ol class="arabic">
<li>
<p>Configure your Foreman&#160;server or Smart&#160;Proxy&#160;server to connect to your DNS service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-dns-managed=false \
--foreman-proxy-dns-provider=nsupdate_gss \
--foreman-proxy-dns-server="<em>idm1.example.com</em>" \
--foreman-proxy-dns-tsig-keytab=/etc/foreman-proxy/dns.keytab \
--foreman-proxy-dns-tsig-principal="smartproxy/<em>foreman.example.com@EXAMPLE.COM</em>" \
--foreman-proxy-dns=true</pre>
</div>
</div>
</li>
<li>
<p>For each affected Smart&#160;Proxy, update the configuration of that Smart&#160;Proxy in the Foreman web UI:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>, locate the Foreman&#160;server, and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Configure the domain:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and select the domain name.</p>
</li>
<li>
<p>In the <strong>Domain</strong> tab, ensure <strong>DNS Smart&#160;Proxy</strong> is set to the Smart&#160;Proxy where the subnet is connected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the subnet:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> and select the subnet name.</p>
</li>
<li>
<p>In the <strong>Subnet</strong> tab, set <strong>IPAM</strong> to <strong>None</strong>.</p>
</li>
<li>
<p>In the <strong>Domains</strong> tab, select the domain that you want to manage using the IdM server.</p>
</li>
<li>
<p>In the <strong>Smart&#160;Proxies</strong> tab, ensure <strong>Reverse DNS Smart&#160;Proxy</strong> is set to the Smart&#160;Proxy where the subnet is connected.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-dynamic-dns-update-with-tsig-authentication_foreman"><a class="anchor" href="#configuring-dynamic-dns-update-with-tsig-authentication_foreman"></a>6.4.2. Configuring dynamic DNS update with TSIG authentication</h4>
<div class="paragraph">
<p>You can configure an IdM server to use the secret key transaction authentication for DNS (TSIG) technology that uses the <code>rndc.key</code> key file for authentication.
The TSIG protocol is defined in <a href="https://tools.ietf.org/html/rfc2845">RFC2845</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must ensure the IdM server is deployed and the host-based firewall is configured correctly.</p>
</li>
<li>
<p>You must obtain <code>root</code> user access on the IdM server.</p>
</li>
<li>
<p>You must confirm whether Foreman&#160;server or Smart&#160;Proxy&#160;server is configured to provide DNS service for your deployment.</p>
</li>
<li>
<p>You must configure DNS, DHCP and TFTP services on the base operating system of either the Foreman or Smart&#160;Proxy that is managing the DNS service for your deployment.</p>
</li>
<li>
<p>You must create a backup of the answer file.
You can use the backup to restore the answer file to its original state if it becomes corrupted.
For more information, see <a href="https://docs.theforeman.org/3.11/Installing_Server/index-katello.html#configuring-server_foreman">Configuring Foreman&#160;server</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure dynamic DNS update with TSIG authentication, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Enabling external updates to the DNS zone in the IdM server</div>
<ol class="arabic">
<li>
<p>On the IdM Server, add the following to the top of the <code>/etc/named.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none">########################################################################

include "/etc/rndc.key";
controls  {
inet _IdM_Server_IP_Address_ port 953 allow { _Foreman_IP_Address_; } keys { "rndc-key"; };
};
########################################################################</code></pre>
</div>
</div>
</li>
<li>
<p>Reload the <code>named</code> service to make the changes take effect:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl reload named</pre>
</div>
</div>
</li>
<li>
<p>In the IdM web UI, navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong> and click the name of the zone.
In the <strong>Settings</strong> tab, apply the following changes:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add the following in the <code>BIND update policy</code> box:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none">grant "rndc-key" zonesub ANY;</code></pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Click <strong>Update</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Copy the <code>/etc/rndc.key</code> file from the IdM server to the base operating system of your Foreman&#160;server.
Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /etc/rndc.key root@<em>foreman.example.com</em>:/etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>To set the correct ownership, permissions, and SELinux context for the <code>rndc.key</code> file, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -v /etc/rndc.key
# chown -v root:named /etc/rndc.key
# chmod -v 640 /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.
Normally, foreman-installer ensures that the <code>foreman-proxy</code> user belongs to the <code>named</code> UNIX group, however, in this scenario Foreman does not manage users and groups, therefore you need to assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># usermod -a -G named foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, enter the following <code>foreman-installer</code> command to configure Foreman to use the external DNS server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-dns-managed=false \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="<em>IdM_Server_IP_Address</em>" \
--foreman-proxy-dns-ttl=86400 \
--foreman-proxy-dns=true \
--foreman-proxy-keyfile=/etc/rndc.key</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Testing external updates to the DNS zone in the IdM server</div>
<ol class="arabic">
<li>
<p>Ensure that the key in the <code>/etc/rndc.key</code> file on Foreman&#160;server is the same key file that is used on the IdM server:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none">key "rndc-key" {
        algorithm hmac-md5;
        secret "<em>secret-key</em>==";
};</code></pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, create a test DNS entry for a host.
For example, host <code><em>test.example.com</em></code> with an A record of <code>192.168.25.20</code> on the IdM server at <code>192.168.25.1</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server 192.168.25.1\n \
update add <em>test.example.com</em> 3600 IN A 192.168.25.20\n \
send\n" | nsupdate -k /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>On Foreman&#160;server, test the DNS entry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># nslookup <em>test.example.com</em> 192.168.25.1</pre>
</div>
</div>
<div class="paragraph">
<p>Example output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none">Server:		192.168.25.1
Address:	192.168.25.1#53

Name:	test.example.com
Address: 192.168.25.20</code></pre>
</div>
</div>
</li>
<li>
<p>To view the entry in the IdM web UI, navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.
Click the name of the zone and search for the host by name.</p>
</li>
<li>
<p>If resolved successfully, remove the test DNS entry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server 192.168.25.1\n \
update delete <em>test.example.com</em> 3600 IN A 192.168.25.20\n \
send\n" | nsupdate -k /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the DNS entry was removed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># nslookup <em>test.example.com</em> 192.168.25.1</pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>nslookup</code> command fails and returns the <code>SERVFAIL</code> error message if the record was successfully deleted.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="reverting-to-internal-dns-service_foreman"><a class="anchor" href="#reverting-to-internal-dns-service_foreman"></a>6.4.3. Reverting to internal DNS service</h4>
<div class="paragraph">
<p>You can revert to using Foreman&#160;server and Smart&#160;Proxy&#160;server as your DNS providers.
You can use a backup of the answer file that was created before configuring external DNS, or you can create a backup of the answer file.
For more information about answer files, see <a href="https://docs.theforeman.org/3.11/Installing_Server/index-katello.html#configuring-server_foreman">Configuring Foreman&#160;server</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On the Foreman or Smart&#160;Proxy&#160;server that you want to configure to manage DNS service for the domain, complete the following steps:</p>
</div>
<div class="ulist">
<div class="title">Configuring Foreman or Smart&#160;Proxy as a DNS server</div>
<ul>
<li>
<p>If you have created a backup of the answer file before configuring external DNS, restore the answer file and then enter the <code>foreman-installer</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer</pre>
</div>
</div>
</li>
<li>
<p>If you do not have a suitable backup of the answer file, create a backup of the answer file now.
To configure Foreman or Smart&#160;Proxy as DNS server without using an answer file, enter the following <code>foreman-installer</code> command on Foreman or Smart&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-dns-managed=true \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="127.0.0.1" \
--foreman-proxy-dns=true</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.theforeman.org/3.11/Installing_Proxy/index-katello.html#configuring-dns-dhcp-and-tftp_smart-proxy">Configuring DNS, DHCP, and TFTP on Smart&#160;Proxy&#160;server</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you run the <code>foreman-installer</code> command to make any changes to your Smart&#160;Proxy configuration, you must update the configuration of each affected Smart&#160;Proxy in the Foreman web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Updating the configuration in the Foreman web UI</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong>.</p>
</li>
<li>
<p>For each Smart&#160;Proxy that you want to update, from the <strong>Actions</strong> list, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Configure the domain:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and click the domain name that you want to configure.</p>
</li>
<li>
<p>In the <strong>Domain</strong> tab, set <strong>DNS Smart&#160;Proxy</strong> to the Smart&#160;Proxy where the subnet is connected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the subnet:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> and select the subnet name.</p>
</li>
<li>
<p>In the <strong>Subnet</strong> tab, set <strong>IPAM</strong> to <strong>DHCP</strong> or <strong>Internal DB</strong>.</p>
</li>
<li>
<p>In the <strong>Domains</strong> tab, select the domain that you want to manage using Foreman or Smart&#160;Proxy.</p>
</li>
<li>
<p>In the <strong>Smart&#160;Proxies</strong> tab, set <strong>Reverse DNS Smart&#160;Proxy</strong> to the Smart&#160;Proxy where the subnet is connected.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting-dnf-modules_foreman"><a class="anchor" href="#troubleshooting-dnf-modules_foreman"></a>Appendix A: Troubleshooting DNF modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If DNF modules fails to enable, it can mean an incorrect module is enabled.
In that case, you have to resolve dependencies manually as follows.
List the enabled modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module list --enabled</pre>
</div>
</div>
<div class="sect2">
<h3 id="Troubleshooting_Ruby_foreman"><a class="anchor" href="#Troubleshooting_Ruby_foreman"></a>Ruby</h3>
<div class="paragraph">
<p>If Ruby module fails to enable, it can mean an incorrect module is enabled.
In that case, you have to resolve dependencies manually as follows:</p>
</div>
<div class="paragraph">
<p>List the enabled modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module list --enabled</pre>
</div>
</div>
<div class="paragraph">
<p>If the Ruby 2.5 module has already been enabled, perform a module reset:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module reset ruby</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Troubleshooting_Postgresql_foreman"><a class="anchor" href="#Troubleshooting_Postgresql_foreman"></a>PostgreSQL</h3>
<div class="paragraph">
<p>If PostgreSQL module fails to enable, it can mean an incorrect module is enabled.
In that case, you have to resolve dependencies manually as follows:</p>
</div>
<div class="paragraph">
<p>List the enabled modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module list --enabled</pre>
</div>
</div>
<div class="paragraph">
<p>If the PostgreSQL 10 module has already been enabled, perform a module reset:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module reset postgresql</pre>
</div>
</div>
<div class="paragraph">
<p>If a database was previously created using PostgreSQL 10, perform an upgrade:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the DNF modules:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module enable katello:el8</pre>
</div>
</div>
</li>
<li>
<p>Install the PostgreSQL upgrade package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install postgresql-upgrade</pre>
</div>
</div>
</li>
<li>
<p>Perform the upgrade:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># postgresql-setup --upgrade</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Troubleshooting_Sync_Errors_foreman"><a class="anchor" href="#Troubleshooting_Sync_Errors_foreman"></a>Appendix B: Troubleshooting sync errors</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">"[Errno 1] Operation not permitted: &#8230;&#8203;" during repository syncing</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown --recursive pulp.pulp /var/lib/pulp/media/</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">"{"policy":[""" is not a valid choice."]}" during Debian repository syncing</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake katello:migrate_deb_content_attributes_to_pulp3</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">500 API error during syncing with "cryptography.fernet.InvalidToken" in /var/log/messages traceback</dt>
<dd>
<p>Run this on the Katello server and every smart proxy.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sudo -u pulp PULP_SETTINGS='/etc/pulp/settings.py' pulpcore-manager datarepair-2327 --dry-run</pre>
</div>
</div>
<div class="paragraph">
<p>If you see values greater than 0 returned from the dry-run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sudo -u pulp PULP_SETTINGS='/etc/pulp/settings.py' pulpcore-manager datarepair-2327</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="applying-custom-configuration_foreman"><a class="anchor" href="#applying-custom-configuration_foreman"></a>Appendix C: Applying custom configuration to Foreman</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you install and configure Foreman for the first time using <code>foreman-installer</code>, you can specify that the DNS and DHCP configuration files are not to be managed by Puppet using the installer flags <code>--foreman-proxy-dns-managed=false</code> and <code>--foreman-proxy-dhcp-managed=false</code>.
If these flags are not specified during the initial installer run, rerunning of the installer overwrites all manual changes, for example, rerun for upgrade purposes.
If changes are overwritten, you must run the restore procedure to restore the manual changes.
For more information, see <a href="https://docs.theforeman.org/3.11/Installing_Server/index-katello.html#restoring-manual-changes-overwritten-by-a-puppet-run_foreman">Restoring Manual Changes Overwritten by a Puppet Run</a>.</p>
</div>
<div class="paragraph">
<p>To view all installer flags available for custom configuration, run <code>foreman-installer --scenario katello --full-help</code>.
Some Puppet classes are not exposed to the Foreman installer.
To manage them manually and prevent the installer from overwriting their values, specify the configuration values by adding entries to configuration file <code>/etc/foreman-installer/custom-hiera.yaml</code>.
This configuration file is in YAML format, consisting of one entry per line in the format of <code>&lt;puppet class&gt;::&lt;parameter name&gt;: &lt;value&gt;</code>.
Configuration values specified in this file persist across installer reruns.</p>
</div>
<div class="paragraph">
<p>Common examples include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Apache, to set the ServerTokens directive to return only the product name:</p>
<div class="listingblock">
<div class="content">
<pre>apache::server_tokens: Prod</pre>
</div>
</div>
</li>
<li>
<p>To turn off the Apache server signature entirely:</p>
<div class="listingblock">
<div class="content">
<pre>apache::server_signature: Off</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Puppet modules for the Foreman installer are stored under <code>/usr/share/foreman-installer/modules</code>.
Check the <code>.pp</code> files (for example: <em>moduleName</em>/manifests/<em>example</em>.pp) to look up the classes, parameters, and values.
Alternatively, use the <code>grep</code> command to do keyword searches.</p>
</div>
<div class="paragraph">
<p>Setting some values may have unintended consequences that affect the performance or functionality of Foreman.
Consider the impact of the changes before you apply them, and test the changes in a non-production environment first.
If you do not have a non-production Foreman environment, run the Foreman installer with the <code>--noop</code> and <code>--verbose</code> options.
If your changes cause problems, remove the offending lines from <code>custom-hiera.yaml</code> and rerun the Foreman installer.
If you have any specific questions about whether a particular value is safe to alter, contact Red Hat support.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="restoring-manual-changes-overwritten-by-a-puppet-run_foreman"><a class="anchor" href="#restoring-manual-changes-overwritten-by-a-puppet-run_foreman"></a>Appendix D: Restoring manual changes overwritten by a Puppet run</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If your manual configuration has been overwritten by a Puppet run, you can restore the files to the previous state.
The following example shows you how to restore a DHCP configuration file overwritten by a Puppet run.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the file you intend to restore.
This allows you to compare the files to check for any mandatory changes required by the upgrade.
This is not common for DNS or DHCP services.</p>
<div class="listingblock">
<div class="content">
<pre># cp /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.backup</pre>
</div>
</div>
</li>
<li>
<p>Check the log files to note down the md5sum of the overwritten file.
For example:</p>
<div class="listingblock">
<div class="content">
<pre># journalctl -xe
...
/Stage[main]/Dhcp/File[/etc/dhcp/dhcpd.conf]: Filebucketed /etc/dhcp/dhcpd.conf to puppet with sum 622d9820b8e764ab124367c68f5fa3a1
...</pre>
</div>
</div>
</li>
<li>
<p>Restore the overwritten file:</p>
<div class="listingblock">
<div class="content">
<pre># puppet filebucket restore --local --bucket \
/var/lib/puppet/clientbucket /etc/dhcp/dhcpd.conf \ 622d9820b8e764ab124367c68f5fa3a1</pre>
</div>
</div>
</li>
<li>
<p>Compare the backup file and the restored file, and edit the restored file to include any mandatory changes required by the upgrade.</p>
</li>
</ol>
</div>
<!-- "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License -->
<!-- https://github.com/simonwhitaker/github-fork-ribbon-css -->
<a class="release-ribbon right-top fixed" href="https://docs.theforeman.org" data-ribbon="Unsupported version" title="Unsupported version">
Unsupported version
</a>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.11 (unsupported)<br>
Last updated Oct 2025
</div>
</div>
<script>
;(function () { /*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
  'use strict'

  var config = (document.currentScript || {}).dataset || {}
  var forEach = Array.prototype.forEach

  init(document.querySelectorAll('.tabs'))

  function init (tabsBlocks) {
    if (!tabsBlocks.length) return
    forEach.call(tabsBlocks, function (tabs) {
      var syncIds = tabs.classList.contains('is-sync') ? {} : undefined
      var tablist = tabs.querySelector('.tablist ul')
      tablist.setAttribute('role', 'tablist')
      var start
      forEach.call(tablist.querySelectorAll('li'), function (tab, idx) {
        tab.tabIndex = -1
        tab.setAttribute('role', tab.classList.add('tab') || 'tab')
        var id, anchor, syncId
        if (!(id = tab.id) && (anchor = tab.querySelector('a[id]'))) {
          id = tab.id = anchor.parentNode.removeChild(anchor).id
        }
        var panel = id && tabs.querySelector('.tabpanel[aria-labelledby~="' + id + '"]')
        if (!panel) return idx ? undefined : toggleSelected(tab, true) // invalid state
        syncIds && (((syncId = tab.textContent.trim()) in syncIds) ? (syncId = undefined) : true) &&
          (syncIds[(tab.dataset.syncId = syncId)] = tab)
        idx || (syncIds && (start = { tab: tab, panel: panel })) ? toggleHidden(panel, true) : toggleSelected(tab, true)
        tab.setAttribute('aria-controls', panel.id)
        panel.setAttribute('role', 'tabpanel')
        var onClick = syncId === undefined ? activateTab : activateTabSync
        tab.addEventListener('click', onClick.bind({ tabs: tabs, tab: tab, panel: panel }))
      })
      if (!tabs.closest('.tabpanel')) {
        forEach.call(tabs.querySelectorAll('.tabpanel table.tableblock'), function (table) {
          var container = Object.assign(document.createElement('div'), { className: 'tablecontainer' })
          table.parentNode.insertBefore(container, table).appendChild(table)
        })
      }
      if (start) {
        var syncGroupId
        for (var i = 0, lst = tabs.classList, len = lst.length, className; i !== len; i++) {
          if (!(className = lst.item(i)).startsWith('data-sync-group-id=')) continue
          tabs.dataset.syncGroupId = syncGroupId = lst.remove(className) || className.slice(19).replace(/\u00a0/g, ' ')
          break
        }
        if (syncGroupId === undefined) tabs.dataset.syncGroupId = syncGroupId = Object.keys(syncIds).sort().join('|')
        var preferredSyncId = 'syncStorageKey' in config &&
          window[(config.syncStorageScope || 'local') + 'Storage'].getItem(config.syncStorageKey + '-' + syncGroupId)
        var tab = preferredSyncId && syncIds[preferredSyncId]
        tab && Object.assign(start, { tab: tab, panel: document.getElementById(tab.getAttribute('aria-controls')) })
        toggleSelected(start.tab, true) || toggleHidden(start.panel, false)
      }
    })
    onHashChange()
    toggleClassOnEach(tabsBlocks, 'is-loading', 'remove')
    window.setTimeout(toggleClassOnEach.bind(null, tabsBlocks, 'is-loaded', 'add'), 0)
    window.addEventListener('hashchange', onHashChange)
  }

  function activateTab (e) {
    var tab = this.tab
    var tabs = this.tabs || (this.tabs = tab.closest('.tabs'))
    var panel = this.panel || (this.panel = document.getElementById(tab.getAttribute('aria-controls')))
    querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (el) {
      toggleSelected(el, el === tab)
    })
    querySelectorWithSiblings(tabs, '.tabpanel', 'tabpanel').forEach(function (el) {
      toggleHidden(el, el !== panel)
    })
    if (!this.isSync && 'syncStorageKey' in config && 'syncGroupId' in tabs.dataset) {
      var storageKey = config.syncStorageKey + '-' + tabs.dataset.syncGroupId
      window[(config.syncStorageScope || 'local') + 'Storage'].setItem(storageKey, tab.dataset.syncId)
    }
    if (!e) return
    var loc = window.location
    var hashIdx = loc.hash ? loc.href.indexOf('#') : -1
    if (~hashIdx) window.history.replaceState(null, '', loc.href.slice(0, hashIdx))
    e.preventDefault()
  }

  function activateTabSync (e) {
    activateTab.call(this, e)
    var thisTabs = this.tabs
    var thisTab = this.tab
    var initialY = thisTabs.getBoundingClientRect().y
    forEach.call(document.querySelectorAll('.tabs'), function (tabs) {
      if (tabs === thisTabs || tabs.dataset.syncGroupId !== thisTabs.dataset.syncGroupId) return
      querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (tab) {
        if (tab.dataset.syncId === thisTab.dataset.syncId) activateTab.call({ tabs: tabs, tab: tab, isSync: true })
      })
    })
    var shiftedBy = thisTabs.getBoundingClientRect().y - initialY
    if (shiftedBy && (shiftedBy = Math.round(shiftedBy))) window.scrollBy({ top: shiftedBy, behavior: 'instant' })
  }

  function querySelectorWithSiblings (scope, selector, siblingClass) {
    var el = scope.querySelector(selector)
    if (!el) return []
    var result = [el]
    while ((el = el.nextElementSibling) && el.classList.contains(siblingClass)) result.push(el)
    return result
  }

  function toggleClassOnEach (elements, className, method) {
    forEach.call(elements, function (el) {
      el.classList[method](className)
    })
  }

  function toggleHidden (el, state) {
    el.classList[(el.hidden = state) ? 'add' : 'remove']('is-hidden')
  }

  function toggleSelected (el, state) {
    el.setAttribute('aria-selected', '' + state)
    el.classList[state ? 'add' : 'remove']('is-selected')
    el.tabIndex = state ? 0 : -1
  }

  function onHashChange () {
    var id = window.location.hash.slice(1)
    if (!id) return
    var tab = document.getElementById(~id.indexOf('%') ? decodeURIComponent(id) : id)
    if (!(tab && tab.classList.contains('tab'))) return
    'syncId' in tab.dataset ? activateTabSync.call({ tab: tab }) : activateTab.call({ tab: tab })
  }
})()
</script>
</body>
</html>