<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.25">
<title>Configuring orcharhino&#160;Proxies with a load balancer</title>
<style>
﻿*,::before,::after{box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:100%}body{background:#fff;color:rgba(0,0,0,0.8);padding:0;margin:0;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:inherit;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,p,blockquote,th,td{margin:0;padding:0}a{background:none;color:#2156a5;text-decoration:underline;line-height:inherit}a:active,a:hover{cursor:pointer;outline:0}a:focus{outline:thin dotted}a:hover,a:focus{color:#1d4b8f}abbr{font-size:0.9em}abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}b,strong{font-weight:bold;line-height:inherit}strong strong{font-weight:400}code,kbd,pre{font-family:"Droid Sans Mono", "DejaVu Sans Mono", monospace;font-size:1em}code{font-weight:400;color:rgba(0,0,0,0.9)}pre{color:rgba(0,0,0,0.9);line-height:1.45;text-rendering:optimizeSpeed;white-space:pre-wrap}dfn{font-style:italic}em,i{font-style:italic;line-height:inherit}em em{font-style:normal}hr{border:solid #dddddf;border-width:1px 0 0;clear:both;height:0;margin:1.25em 0 1.1875em}mark{background:#ff0;color:#000}p{line-height:1.6;margin-bottom:1.25rem;text-rendering:optimizeLegibility}q{quotes:"“" "”" "‘" "’"}small{font-size:60%;line-height:inherit}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img,object[type^="image/"],svg{display:inline-block;height:auto;max-width:100%;vertical-align:middle}img{border:0;-ms-interpolation-mode:bicubic}object{max-width:100%}svg:not(:root){overflow:hidden}figure{margin:0}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}.left{float:left !important}.right{float:right !important}.text-left{text-align:left !important}.text-right{text-align:right !important}.text-center{text-align:center !important}.text-justify{text-align:justify !important}.hide{display:none}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:0.25em}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.2;word-spacing:-0.05em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em;margin-left:1.125em}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,0.85)}@media screen and (min-width: 768px){h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;border:1px solid #dedede;border-collapse:collapse;border-spacing:0;margin-bottom:1.25em;word-wrap:normal}table thead,table tfoot{background:#f7f8f7}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,0.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,0.8)}table tr.even,table tr.alt{background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.center{margin-left:auto;margin-right:auto}.stretch{width:100%}.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:"";display:table}.clearfix::after,.float-group::after{clear:both}:not(pre).nobreak{word-wrap:normal}:not(pre).nowrap{white-space:nowrap}:not(pre).pre-wrap{white-space:pre-wrap}:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal !important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}pre>code{display:block}pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}.keyseq{color:rgba(51,51,51,0.8)}kbd{display:inline-block;color:rgba(0,0,0,0.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,0.2),inset 0 0 0 0.1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menuref{color:#000}.menuseq b:not(.caret),.menuref{font-weight:inherit}.menuseq{word-spacing:-0.02em}.menuseq b.caret{font-size:1.25em;line-height:0.8}.menuseq i.caret{font-weight:bold;text-align:center;width:0.45em}b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}b.button::before{content:"[";padding:0 3px 0 2px}b.button::after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,0.9)}body>div[id]{margin:0 auto;max-width:62.5em;position:relative;padding-left:.9375em;padding-right:0.9375em}body>div[id]::before,body>div[id]::after,#content #footnotes::before{content:"";display:table;clear:both}#content{margin-top:1.25em;margin-bottom:0.625em}#content::before{content:none}#header>h1:first-child{color:rgba(0,0,0,0.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,0.6);display:flex;flex-flow:row wrap}#header .details span:first-child{margin-left:-0.125em}#header .details span.email a{color:rgba(0,0,0,0.85)}#header .details br{display:none}#header .details br+span::before{content:" – "}#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,0.85)}#header .details br+span#revremark::before{content:" | "}#header #revnumber{text-transform:capitalize}#header #revnumber::after{content:" "}#content>h1:first-child:not([class]){color:rgba(0,0,0,0.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #e7e7e9;padding-bottom:0.5em}#toc>ul{margin-left:0.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:0.5em 0}#toc ul{font-family:"Open Sans", "DejaVu Sans", sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:0.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media screen and (min-width: 768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0 !important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0 !important;border-bottom-width:0 !important;z-index:1000;padding:1.25em 1em;height:calc(100% - (70px + 2.5em));overflow:auto}#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:0.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}@media screen and (min-width: 1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:0.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:none;background:#025d8c;padding:1.25em;margin-left:2em}#footer-text{color:rgba(255,255,255,0.8);line-height:1.44}.sect1{padding-bottom:0.625em}@media screen and (min-width: 768px){#content{margin-bottom:1.25em}.sect1{padding-bottom:1.25em}}.sect1:last-child{padding-bottom:0}.sect1+.sect1{border-top:1px solid #e7e7e9}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none !important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:0.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}details{margin-left:1.25rem}details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}details>summary::-webkit-details-marker{display:none}details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:1rem;font-style:italic}table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,0.85)}.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans", "DejaVu Sans", sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,0.6);word-wrap:anywhere}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#fffef7;border-radius:4px;box-shadow:0 1px 4px #e0e0dc}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:0.8125em}@media screen and (min-width: 768px){.literalblock pre,.listingblock>.content>pre{font-size:0.90625em}}@media screen and (min-width: 1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,0.9)}.listingblock>.content{position:relative}.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:0.5}.listingblock:hover code[data-lang]::before{display:block}.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:0.5}.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.prettyprint{background:#f7f7f8}pre.prettyprint .linenums{line-height:1.45;margin-left:2em}pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}pre.prettyprint li code[data-lang]::before{opacity:1}pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}table.linenotable td.code{padding-left:0.75em}table.linenotable td.linenos{width:0.01%}table.linenotable td.linenos,pre.pygments .linenos,pre.rouge .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}pre.pygments span.linenos,pre.rouge span.linenos{display:inline-block;margin-right:0.75em}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:0.75em}.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,0.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,0.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}.verseblock{margin:0 1em 1.25em}.verseblock pre{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-size:1.15rem;color:rgba(0,0,0,0.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:0.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,0.6)}.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}.quoteblock.abstract{margin:0 1em 1.25em;display:block}.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:0.25em solid #dddddf}.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}p.tableblock:last-child{margin-bottom:0}td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}td.tableblock>.content>:last-child{margin-bottom:-1.25em}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all>*>tr>*{border-width:1px}table.grid-cols>*>tr>*{border-width:0 1px}table.grid-rows>*>tr>*{border-width:1px 0}table.frame-all{border-width:1px}table.frame-ends{border-width:1px 0}table.frame-sides{border-width:0 1px}table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,0.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:0.625em}ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:0.625em}ul.unstyled,ol.unstyled{margin-left:0}li>p:empty:only-child::before{content:"";display:inline-block}ul.checklist>li>p:first-child{margin-left:-1em}ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:0.125em}ul.checklist>li>p:first-child>input[type=checkbox]:first-child{font:inherit;margin:0 .25em 0 0;padding:0}ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 0.625em -1.25em}ul.inline>li{margin-left:1.25em}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{vertical-align:top;padding:0 0.625em}td.hdlist1{font-weight:bold;padding-bottom:1.25em}td.hdlist2{word-wrap:anywhere}.literalblock+.colist,.listingblock+.colist{margin-top:-0.5em}.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}.colist td:not([class]):first-child img{max-width:none}.colist td:not([class]):last-child{padding:0.25em 0}.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}.imageblock.left{margin:0.25em 0.625em 1.25em 0}.imageblock.right{margin:0.25em 0 1.25em 0.625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 0.125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:0.625em}.image.right{margin-left:0.625em}a.image{text-decoration:none;display:inline-block}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:0.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:0.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:0.75em 0}div.page-break{display:none}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background:#00fafa}.black{color:#000}.black-background{background:#000}.blue{color:#0000bf}.blue-background{background:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background:#fa00fa}.gray{color:#606060}.gray-background{background:#7d7d7d}.green{color:#006000}.green-background{background:#007d00}.lime{color:#00bf00}.lime-background{background:#00fa00}.maroon{color:#600000}.maroon-background{background:#7d0000}.navy{color:#000060}.navy-background{background:#00007d}.olive{color:#606000}.olive-background{background:#7d7d00}.purple{color:#600060}.purple-background{background:#7d007d}.red{color:#bf0000}.red-background{background:#fa0000}.silver{color:#909090}.silver-background{background:#bcbcbc}.teal{color:#006060}.teal-background{background:#007d7d}.white{color:#bfbfbf}.white-background{background:#fafafa}.yellow{color:#bfbf00}.yellow-background{background:#fafa00}span.icon>.fa{cursor:default}a span.icon>.fa{cursor:inherit}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,0.5);cursor:default}.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,0.8);color:#111}.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff !important;background:rgba(0,0,0,0.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans", "DejaVu Sans", sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff !important}.conum[data-value]+b{display:none}.conum[data-value]::after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-0.125em}b.conum *{color:inherit !important}.conum:not([data-value]):empty{display:none}dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}h1,h2,p,td.content,span.alt,summary{letter-spacing:-0.01em}p strong,td.content strong,div.footnote strong{letter-spacing:-0.005em}p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.print-only{display:none !important}@page{margin:1.25cm 0.75cm}@media print{*{box-shadow:none !important;text-shadow:none !important}html{font-size:80%}a{color:inherit !important;text-decoration:underline !important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none !important}a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:0.25em}abbr[title]{border-bottom:1px dotted}abbr[title]::after{content:" (" attr(title) ")"}pre,blockquote,tr,img,object,svg{page-break-inside:avoid}thead{display:table-header-group}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}body>div[id]{max-width:none}#toc,.sidebarblock,.exampleblock>.content{background:none !important}#toc{border-bottom:1px solid #dddddf !important;padding-bottom:0 !important}body.book #header{text-align:center}body.book #header>h1:first-child{border:0 !important;margin:2.5em 0 1em}body.book #header .details{border:0 !important;display:block;padding:0 !important}body.book #header .details span:first-child{margin-left:0 !important}body.book #header .details br{display:block}body.book #header .details br+span::before{content:none !important}body.book #toc{border:0 !important;text-align:left !important;padding:0 !important;margin:0 !important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]::before{display:block}div.page-break{display:block;page-break-after:always}#footer{padding:0 0.9375em}.hide-on-print{display:none !important}.print-only{display:block !important}.hide-for-print{display:none !important}.show-for-print{display:inherit !important}}@media amzn-kf8, print{#header>h1:first-child{margin-top:1.25rem}.sect1{padding:0 !important}.sect1+.sect1{border:0}#footer{background:none}#footer-text{color:rgba(0,0,0,0.6);font-size:0.9em}}@media amzn-kf8{body>div[id]{padding:0}}body{padding:0;margin:0;margin-top:70px !important}.container{position:relative;z-index:1;padding-top:50px;min-height:100%}.container p{font-family:sans-serif;font-size:1.2em}nav{position:fixed;z-index:9999;left:0;right:0;top:0;height:70px;padding:0 1.5em;background-color:#025d8c;font-family:sans-serif;line-height:70px}nav .logo{width:50px;vertical-align:middle}nav .nav-menu{position:absolute;right:0.3em;top:0;padding:0;margin:0;list-style:none}nav .nav-item{display:inline-block}nav .nav-item>a{display:inline-block;padding:0 2.5em;line-height:70px;color:#fff;text-decoration:none}nav .dropdown{position:relative}nav .dropdown a::after{content:"";display:inline-block;margin-left:0.5em;vertical-align:middle;border-top:0.3em solid #fff;border-right:0.3em solid transparent;border-left:0.3em solid transparent}nav .dropdown.show a::after{transform:rotate(180deg)}nav .dropdown-menu{display:none;position:absolute;left:0;right:0;top:100%;padding:0.5em 0;margin-top:-0.5em;border:1px solid rgba(0,0,0,0.3);border-radius:0.5em;background-color:#fff;width:max-content}nav .dropdown-menu-left{left:auto;right:0}nav .dropdown.show .dropdown-menu{display:block}nav .dropdown-div{display:block;padding:0.4em 0;line-height:4em}nav .dropdown-div a::after{content:none;margin-left:0;border-top:0;border-right:0;border-left:0}nav .dropdown-item{display:block;padding:0 1.5em;font-size:0.875em;color:#000;line-height:1.6em;text-decoration:none}nav .btn-hamburger{display:none;position:absolute;right:1.5em;top:50%;background-color:transparent;border:0;cursor:pointer;outline:none;transform:translateY(-50%)}nav .btn-hamburger span{display:block;width:30px;height:4px;background-color:#fff;margin:6px;border-radius:2px;transition:0.3s ease-in-out}nav .btn-hamburger span:nth-child(4),nav .btn-hamburger span:nth-child(5){position:absolute;top:10px;opacity:0.5}nav .btn-hamburger span:nth-child(4){transform:rotate(45deg) scale(0)}nav .btn-hamburger span:nth-child(5){transform:rotate(-45deg) scale(0)}nav.opened .btn-hamburger span:nth-child(4){opacity:1;transform:rotate(45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(5){opacity:1;transform:rotate(-45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(1),nav.opened .btn-hamburger span:nth-child(2),nav.opened .btn-hamburger span:nth-child(3){opacity:0}@media screen and (max-width: 768px){nav .nav-menu{position:fixed;left:0;right:0;top:70px;bottom:100%;display:flex;flex-direction:column;justify-content:start;background-color:#363d4e;transition:bottom 0.5s ease-in-out;overflow:hidden}nav.opened .nav-menu{bottom:0}nav .nav-item>a{display:block}nav .dropdown-menu{position:relative;top:0;margin:0 1.5em}nav .btn-hamburger{display:block}}/*!
* "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License
* https://github.com/simonwhitaker/github-fork-ribbon-css

The MIT License (MIT)

Copyright (c) 2013 Simon Whitaker

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/.github-fork-ribbon,.release-ribbon,.issue-ribbon{width:12.1em;height:12.1em;position:absolute;overflow:hidden;top:70px;right:0;z-index:9998;pointer-events:none;font-size:13px;text-decoration:none;text-indent:-999999px}.github-fork-ribbon.fixed,.fixed.release-ribbon,.fixed.issue-ribbon{position:fixed}.github-fork-ribbon:hover,.release-ribbon:hover,.issue-ribbon:hover,.github-fork-ribbon:active,.release-ribbon:active,.issue-ribbon:active{background-color:transparent}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before,.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{position:absolute;display:block;width:15.38em;height:1.54em;top:3.23em;right:-3.23em;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before{content:"";padding:.38em 0;background-color:#a00;background-image:-webkit-gradient(linear, left top, left bottom, from(transparent), to(rgba(0,0,0,0.15)));background-image:-webkit-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-moz-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-ms-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-o-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:linear-gradient(to bottom, transparent, rgba(0,0,0,0.15));-webkit-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);-moz-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);pointer-events:auto}.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{content:attr(data-ribbon);color:#fff;font:700 1em "Helvetica Neue", Helvetica, Arial, sans-serif;line-height:1.54em;text-decoration:none;text-shadow:0 -0.08em rgba(0,0,0,0.5);text-align:center;text-indent:0;padding:.15em 0;margin:.15em 0;border-width:.08em 0;border-style:dotted;border-color:#fff;border-color:rgba(255,255,255,0.7)}.github-fork-ribbon.left-top,.left-top.release-ribbon,.left-top.issue-ribbon,.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon{right:auto;left:0}.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon,.github-fork-ribbon.right-bottom,.right-bottom.release-ribbon,.right-bottom.issue-ribbon{top:auto;bottom:0}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after{right:auto;left:-3.23em}.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{top:auto;bottom:3.23em}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}.release-ribbon:before{background-color:#a00}.issue-ribbon:before{background-color:#025d8c}@media screen{div.narrow{max-width:1080px;margin:0 auto !important;margin-top:70px auto !important;float:none !important}#toc.toc2{margin-top:70px !important}}

</style>
<!-- docinfo -->
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Configuring orcharhino&#160;Proxies with a load balancer</h1>
<div class="details">
<span id="revnumber">version 6.7 (unsupported),</span>
<span id="revdate">published Oct 19 2025</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Load_Balancing_Solution_Architecture_load-balancing">1. Load balancing solution architecture</a></li>
<li><a href="#Load_Balancing_Considerations_load-balancing">2. Load balancing considerations</a></li>
<li><a href="#Prerequisites_for_Configuring_orcharhino-proxy_Servers_for_Load_Balancing_load-balancing">3. Prerequisites for configuring orcharhino&#160;Proxies for load balancing</a></li>
<li><a href="#Configuring_orcharhino-proxy_Servers_for_Load_Balancing_load-balancing">4. Configuring orcharhino&#160;Proxies for load balancing</a>
<ul class="sectlevel2">
<li><a href="#Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_for_Load_Balancing_without_Puppet_load-balancing">4.1. Configuring orcharhino&#160;Proxy with default SSL certificates for load balancing without Puppet</a></li>
<li><a href="#Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_for_Load_Balancing_with_Puppet_load-balancing">4.2. Configuring orcharhino&#160;Proxy with default SSL certificates for load balancing with Puppet</a></li>
<li><a href="#con_Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_for_Load_Balancing_without_Puppet_load-balancing">4.3. Configuring orcharhino&#160;Proxy with custom SSL certificates for load balancing without Puppet</a></li>
<li><a href="#Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_for_Load_Balancing_with_Puppet_load-balancing">4.4. Configuring orcharhino&#160;Proxy with custom SSL certificates for load balancing with Puppet</a></li>
</ul>
</li>
<li><a href="#Setting_the_Load_Balancer_for_Host_Registration_load-balancing">5. Setting the load balancer for host registration</a></li>
<li><a href="#Installing_the_Load_Balancer_load-balancing">6. Installing the load balancer</a></li>
<li><a href="#Verifying_the_Load_Balancing_Configuration_load-balancing">7. Verifying the load balancing configuration</a></li>
<li><a href="#Registering_Clients_to_the_Load_Balancer_load-balancing">8. Registering clients to the load balancer</a>
<ul class="sectlevel2">
<li><a href="#Registering_Clients_Using_Host_Registration_load-balancing">8.1. Registering clients using host registration</a></li>
<li><a href="#Registering_Clients_Using_the_Bootstrap_Script_load-balancing">8.2. <strong>(Deprecated)</strong> Registering clients using the bootstrap script</a></li>
</ul>
</li>
<li><a href="#propagating-scap-content-through-the-load-balancer_load-balancing">9. Propagating SCAP content through the load balancer</a>
<ul class="sectlevel2">
<li><a href="#Propagating_SCAP_Content_using_Ansible_Deployment_load-balancing">9.1. Propagating SCAP content using Ansible deployment</a></li>
<li><a href="#Propagating_SCAP_Content_using_Puppet_Deployment_load-balancing">9.2. Propagating SCAP content using Puppet deployment</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="Load_Balancing_Solution_Architecture_load-balancing"><a class="anchor" href="#Load_Balancing_Solution_Architecture_load-balancing"></a>1. Load balancing solution architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure orcharhino&#160;Server to use a load balancer to distribute client requests and network load across multiple orcharhino&#160;Proxies.
This results in an overall performance improvement on orcharhino&#160;Proxies.</p>
</div>
<div class="paragraph">
<p>This guide outlines how to prepare orcharhino&#160;Server and orcharhino&#160;Proxy for load balancing, and provides guidelines on how to configure a load balancer and register clients in a load-balanced setup.</p>
</div>
<div class="paragraph">
<p>A load-balanced setup consists of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>orcharhino&#160;Server</p>
</li>
<li>
<p>Two or more orcharhino&#160;Proxies</p>
</li>
<li>
<p>A load balancer</p>
</li>
<li>
<p>Multiple clients</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/common/load-balancing-architecture-orcharhino.svg" alt="Load balancing solution architecture">
</div>
<div class="title">Figure 1. orcharhino load balancing solution architecture</div>
</div>
<div class="paragraph">
<p>In a load-balanced setup, nearly all orcharhino&#160;Proxy functionality continues to work as expected when one orcharhino&#160;Proxy is down, for planned or unplanned maintenance.
A load balancer works with the following services and features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Registration using <code>subscription-manager</code></p>
</li>
<li>
<p>Content management with Yum repositories</p>
</li>
<li>
<p>Optional: Puppet</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In the load-balanced setup, a load balancer distributes load only for the services and features mentioned above.
If other services, such as provisioning or virt-who, are running on the individual orcharhino&#160;Proxies, you must access them directly through orcharhino&#160;Proxies and not through the load balancer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Managing Puppet limitations</div>
<p>Puppet Certificate Authority (CA) management does not support certificate signing in a load-balanced setup.
Puppet CA stores certificate information, such as the serial number counter and CRL, on the file system.
Multiple writer processes that attempt to use the same data can corrupt it.</p>
</div>
<div class="paragraph">
<p>To manage this Puppet limitation, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure Puppet certificate signing on one orcharhino&#160;Proxy, typically the first system where you configure orcharhino&#160;Proxy for load balancing.</p>
</li>
<li>
<p>Configure the clients to send CA requests to port 8141 on a load balancer.</p>
</li>
<li>
<p>Configure a load balancer to redirect CA requests from port 8141 to port 8140 on the system where you configure orcharhino&#160;Proxy to sign Puppet certificates.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Load_Balancing_Considerations_load-balancing"><a class="anchor" href="#Load_Balancing_Considerations_load-balancing"></a>2. Load balancing considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Distributing load between several orcharhino&#160;Proxies prevents any one orcharhino&#160;Proxy from becoming a single point of failure.
Configuring orcharhino&#160;Proxies to use a load balancer can provide resilience against planned and unplanned outages.
This improves availability and responsiveness.</p>
</div>
<div class="paragraph">
<p>Consider the following guidelines when configuring load balancing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use Puppet, Puppet certificate signing is assigned to the first orcharhino&#160;Proxy that you configure.
If the first orcharhino&#160;Proxy is down, clients cannot obtain Puppet content.</p>
</li>
<li>
<p>This solution does not use Pacemaker or other similar HA tools to maintain one state across all orcharhino&#160;Proxies.
To troubleshoot issues, reproduce the issue on each orcharhino&#160;Proxy, bypassing the load balancer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Additional maintenance required for load balancing</div>
<p>Configuring orcharhino&#160;Proxies to use a load balancer results in a more complex environment and requires additional maintenance.</p>
</div>
<div class="paragraph">
<p>The following additional steps are required for load balancing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must ensure that all orcharhino&#160;Proxies have the same content views and synchronize all orcharhino&#160;Proxies to the same content view versions</p>
</li>
<li>
<p>You must upgrade each orcharhino&#160;Proxy in sequence</p>
</li>
<li>
<p>You must backup each orcharhino&#160;Proxy that you configure regularly</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Upgrading orcharhino&#160;Proxies in a load balancing configuration</div>
<p>There are no additional steps required for orcharhino&#160;Proxies in a load balancing configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Prerequisites_for_Configuring_orcharhino-proxy_Servers_for_Load_Balancing_load-balancing"><a class="anchor" href="#Prerequisites_for_Configuring_orcharhino-proxy_Servers_for_Load_Balancing_load-balancing"></a>3. Prerequisites for configuring orcharhino&#160;Proxies for load balancing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can find a list of requirements for orcharhino&#160;Proxy in <a href="sources/installation_and_maintenance/installing_orcharhino_proxy.html"><em>Installing orcharhino&#160;Proxy</em></a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_orcharhino-proxy_Servers_for_Load_Balancing_load-balancing"><a class="anchor" href="#Configuring_orcharhino-proxy_Servers_for_Load_Balancing_load-balancing"></a>4. Configuring orcharhino&#160;Proxies for load balancing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter outlines how to configure orcharhino&#160;Proxies for load balancing.
Proceed to one of the following sections depending on your orcharhino&#160;Server configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_for_Load_Balancing_without_Puppet_load-balancing">Configuring orcharhino&#160;Proxy with default SSL certificates for load balancing without Puppet</a></p>
</li>
<li>
<p><a href="#Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_for_Load_Balancing_with_Puppet_load-balancing">Configuring orcharhino&#160;Proxy with default SSL certificates for load balancing with Puppet</a></p>
</li>
<li>
<p><a href="#Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_for_Load_Balancing_without_Puppet_load-balancing">Configuring orcharhino&#160;Proxy with custom SSL certificates for load balancing without Puppet</a></p>
</li>
<li>
<p><a href="#Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_for_Load_Balancing_with_Puppet_load-balancing">Configuring orcharhino&#160;Proxy with custom SSL certificates for load balancing with Puppet</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use different file names for the Katello certificates you create for each orcharhino&#160;Proxy.
For example, name the certificate archive file with orcharhino&#160;Proxy FQDN.</p>
</div>
<div class="sect2">
<h3 id="Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_for_Load_Balancing_without_Puppet_load-balancing"><a class="anchor" href="#Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_for_Load_Balancing_without_Puppet_load-balancing"></a>4.1. Configuring orcharhino&#160;Proxy with default SSL certificates for load balancing without Puppet</h3>
<div class="paragraph">
<p>The following section describes how to configure orcharhino&#160;Proxies that use default SSL certificates for load balancing without Puppet.
Complete this procedure on each orcharhino&#160;Proxy that you want to configure for load balancing.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino&#160;Server, generate Katello certificates for orcharhino&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-proxy-certs-generate \
--certs-tar "/root/<em>orcharhino-proxy.example.com</em>-certs.tar" \
--foreman-proxy-cname <em>loadbalancer.example.com</em> \
--foreman-proxy-fqdn <em>orcharhino-proxy.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>Retain a copy of the example <code>foreman-installer</code> command that is output by the <code>foreman-proxy-certs-generate</code> command for installing orcharhino&#160;Proxy certificate.</p>
</div>
</li>
<li>
<p>Copy the certificate archive file from orcharhino&#160;Server to orcharhino&#160;Proxy.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/<em>orcharhino-proxy.example.com</em>-certs.tar root@<em>orcharhino-proxy.example.com</em>:/root/<em>orcharhino-proxy.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>Append the following options to the <code>foreman-installer</code> command that you obtain from the output of the <code>foreman-proxy-certs-generate</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--certs-cname "<em>loadbalancer.example.com</em>" \
--enable-foreman-proxy-plugin-remote-execution-script</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, enter the <code>foreman-installer</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman-proxy-content \
--certs-cname "<em>loadbalancer.example.com</em>" \
--certs-tar-file "<em>orcharhino-proxy.example.com-certs.tar</em>" \
--enable-foreman-proxy-plugin-remote-execution-script \
--foreman-proxy-foreman-base-url "<em>https://orcharhino.example.com</em>" \
--foreman-proxy-oauth-consumer-key "<em>oauth key</em>" \
--foreman-proxy-oauth-consumer-secret "<em>oauth secret</em>" \
--foreman-proxy-register-in-foreman "true" \
--foreman-proxy-trusted-hosts "<em>orcharhino.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>orcharhino-proxy.example.com</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_for_Load_Balancing_with_Puppet_load-balancing"><a class="anchor" href="#Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_for_Load_Balancing_with_Puppet_load-balancing"></a>4.2. Configuring orcharhino&#160;Proxy with default SSL certificates for load balancing with Puppet</h3>
<div class="paragraph">
<p>The following section describes how to configure orcharhino&#160;Proxies that use default SSL certificates for load balancing with Puppet.</p>
</div>
<div class="paragraph">
<p>If you use Puppet in your orcharhino configuration, you must complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_to_Generate_and_Sign_Puppet_Certificates_load-balancing">Configuring orcharhino&#160;Proxy with default SSL certificates to generate and sign Puppet certificates</a></p>
</li>
<li>
<p><a href="#Configuring_Remaining_orcharhino-proxy_Servers_with_Default_SSL_Certificates_for_Load_Balancing_load-balancing">Configuring remaining orcharhino&#160;Proxies with default SSL certificates for load balancing</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_to_Generate_and_Sign_Puppet_Certificates_load-balancing"><a class="anchor" href="#Configuring_orcharhino-proxy_Server_with_Default_SSL_Certificates_to_Generate_and_Sign_Puppet_Certificates_load-balancing"></a>4.2.1. Configuring orcharhino&#160;Proxy with default SSL certificates to generate and sign Puppet certificates</h4>
<div class="paragraph">
<p>Complete this procedure only for the system where you want to configure orcharhino&#160;Proxy to generate and sign Puppet certificates for all other orcharhino&#160;Proxies that you configure for load balancing.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino&#160;Server, generate Katello certificates for the system where you configure orcharhino&#160;Proxy to generate and sign Puppet certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-proxy-certs-generate \
--certs-tar "/root/<em>orcharhino-proxy-ca.example.com</em>-certs.tar" \
--foreman-proxy-cname <em>loadbalancer.example.com</em> \
--foreman-proxy-fqdn <em>orcharhino-proxy-ca.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>Retain a copy of the example <code>foreman-installer</code> command that is output by the <code>foreman-proxy-certs-generate</code> command for installing orcharhino&#160;Proxy certificate.</p>
</div>
</li>
<li>
<p>Copy the certificate archive file from orcharhino&#160;Server to orcharhino&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/<em>orcharhino-proxy-ca.example.com</em>-certs.tar root@<em>orcharhino-proxy-ca.example.com</em>:<em>orcharhino-proxy-ca.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>Append the following options to the <code>foreman-installer</code> command that you obtain from the output of the <code>foreman-proxy-certs-generate</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--certs-cname "<em>loadbalancer.example.com</em>" \
--enable-foreman-proxy-plugin-remote-execution-script \
--foreman-proxy-puppetca "true" \
--puppet-ca-server "<em>orcharhino-proxy-ca.example.com</em>" \
--puppet-dns-alt-names "<em>loadbalancer.example.com</em>" \
--puppet-server-ca "true"</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, enter the <code>foreman-installer</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman-proxy-content \
--certs-cname "<em>loadbalancer.example.com</em>" \
--certs-tar-file "<em>orcharhino-proxy-ca.example.com-certs.tar</em>" \
--enable-foreman-proxy-plugin-remote-execution-script \
--enable-puppet \
--foreman-proxy-foreman-base-url "<em>https://orcharhino.example.com</em>" \
--foreman-proxy-oauth-consumer-key "<em>oauth key</em>" \
--foreman-proxy-oauth-consumer-secret "<em>oauth secret</em>" \
--foreman-proxy-puppetca "true" \
--foreman-proxy-register-in-foreman "true" \
--foreman-proxy-trusted-hosts "<em>orcharhino.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>orcharhino-proxy-ca.example.com</em>" \
--puppet-ca-server "<em>orcharhino-proxy-ca.example.com</em>" \
--puppet-dns-alt-names "<em>loadbalancer.example.com</em>" \
--puppet-server true \
--puppet-server-ca "true"</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy that is the Puppetserver Certificate Authority, stop the Puppet server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl stop puppetserver</pre>
</div>
</div>
</li>
<li>
<p>Generate Puppet certificates for all other orcharhino&#160;Proxies that you configure for load balancing, except the system where you first configured Puppet certificate signing:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># puppetserver ca generate \
--ca-client \
--certname <em>orcharhino-proxy.example.com</em> \
--subject-alt-names <em>loadbalancer.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>This command creates the following files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/etc/puppetlabs/puppet/ssl/certs/<em>orcharhino-proxy.example.com</em>.pem</code></p>
</li>
<li>
<p><code>/etc/puppetlabs/puppet/ssl/private_keys/<em>orcharhino-proxy.example.com</em>.pem</code></p>
</li>
<li>
<p><code>/etc/puppetlabs/puppet/ssl/public_keys/<em>orcharhino-proxy.example.com</em>.pem</code></p>
</li>
<li>
<p><code>/etc/puppetlabs/puppetserver/ca/signed/<em>orcharhino-proxy.example.com</em>.pem</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Start the Puppet server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start puppetserver</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Remaining_orcharhino-proxy_Servers_with_Default_SSL_Certificates_for_Load_Balancing_load-balancing"><a class="anchor" href="#Configuring_Remaining_orcharhino-proxy_Servers_with_Default_SSL_Certificates_for_Load_Balancing_load-balancing"></a>4.2.2. Configuring remaining orcharhino&#160;Proxies with default SSL certificates for load balancing</h4>
<div class="paragraph">
<p>Complete this procedure on each orcharhino&#160;Proxy excluding the system where you configure orcharhino&#160;Proxy to sign Puppet certificates.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino&#160;Server, generate Katello certificates for orcharhino&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-proxy-certs-generate \
--certs-tar "/root/<em>orcharhino-proxy.example.com</em>-certs.tar" \
--foreman-proxy-cname <em>loadbalancer.example.com</em> \
--foreman-proxy-fqdn <em>orcharhino-proxy.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>Retain a copy of the example <code>foreman-installer</code> command that is output by the <code>foreman-proxy-certs-generate</code> command for installing orcharhino&#160;Proxy certificate.</p>
</div>
</li>
<li>
<p>Copy the certificate archive file from orcharhino&#160;Server to orcharhino&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/<em>orcharhino-proxy.example.com</em>-certs.tar root@<em>orcharhino-proxy.example.com</em>:/root/<em>orcharhino-proxy.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, install the <code>puppetserver</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install puppetserver</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, create directories for puppet certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /etc/puppetlabs/puppet/ssl/certs/ \
/etc/puppetlabs/puppet/ssl/private_keys/ \
/etc/puppetlabs/puppet/ssl/public_keys/</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, copy the Puppet certificates for this orcharhino&#160;Proxy from the system where you configure orcharhino&#160;Proxy to sign Puppet certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp root@<em>orcharhino-proxy-ca.example.com</em>:/etc/puppetlabs/puppet/ssl/certs/<em>orcharhino-proxy.example.com</em>.pem /etc/puppetlabs/puppet/ssl/certs/<em>orcharhino-proxy.example.com</em>.pem
# scp root@<em>orcharhino-proxy-ca.example.com</em>:/etc/puppetlabs/puppet/ssl/certs/ca.pem /etc/puppetlabs/puppet/ssl/certs/ca.pem
# scp root@<em>orcharhino-proxy-ca.example.com</em>:/etc/puppetlabs/puppet/ssl/private_keys/<em>orcharhino-proxy.example.com</em>.pem /etc/puppetlabs/puppet/ssl/private_keys/<em>orcharhino-proxy.example.com</em>.pem
# scp root@<em>orcharhino-proxy-ca.example.com</em>:/etc/puppetlabs/puppet/ssl/public_keys/<em>orcharhino-proxy.example.com</em>.pem /etc/puppetlabs/puppet/ssl/public_keys/<em>orcharhino-proxy.example.com</em>.pem</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, change the <code>/etc/puppetlabs/puppet/ssl/</code> directory ownership to user <code>puppet</code> and group <code>puppet</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R puppet:puppet /etc/puppetlabs/puppet/ssl/</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, set the SELinux context for the <code>/etc/puppetlabs/puppet/ssl/</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -Rv /etc/puppetlabs/puppet/ssl/</pre>
</div>
</div>
</li>
<li>
<p>Append the following options to the <code>foreman-installer</code> command that you obtain from the output of the <code>foreman-proxy-certs-generate</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--certs-cname "<em>loadbalancer.example.com</em>" \
--enable-foreman-proxy-plugin-remote-execution-script \
--foreman-proxy-puppetca "false" \
--puppet-ca-server "<em>orcharhino-proxy-ca.example.com</em>" \
--puppet-dns-alt-names "<em>loadbalancer.example.com</em>" \
--puppet-server-ca "false"</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, enter the <code>foreman-installer</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman-proxy-content \
--certs-cname "<em>loadbalancer.example.com</em>" \
--certs-tar-file "<em>orcharhino-proxy.example.com-certs.tar</em>" \
--enable-foreman-proxy-plugin-remote-execution-script \
--foreman-proxy-foreman-base-url "<em>https://orcharhino.example.com</em>" \
--foreman-proxy-oauth-consumer-key "<em>oauth key</em>" \
--foreman-proxy-oauth-consumer-secret "<em>oauth secret</em>" \
--foreman-proxy-puppetca "false" \
--foreman-proxy-register-in-foreman "true" \
--foreman-proxy-trusted-hosts "<em>orcharhino.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>orcharhino-proxy.example.com</em>" \
--puppet-ca-server "<em>orcharhino-proxy-ca.example.com</em>" \
--puppet-dns-alt-names "<em>loadbalancer.example.com</em>" \
--puppet-server-ca "false"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con_Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_for_Load_Balancing_without_Puppet_load-balancing"><a class="anchor" href="#con_Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_for_Load_Balancing_without_Puppet_load-balancing"></a>4.3. Configuring orcharhino&#160;Proxy with custom SSL certificates for load balancing without Puppet</h3>
<div class="paragraph">
<p>The following section describes how to configure orcharhino&#160;Proxies that use custom SSL certificates for load balancing without Puppet.</p>
</div>
<div class="sect3">
<h4 id="creating-a-custom-ssl-certificate_load-balancing"><a class="anchor" href="#creating-a-custom-ssl-certificate_load-balancing"></a>4.3.1. Creating a custom SSL certificate for orcharhino&#160;Proxy</h4>
<div class="paragraph">
<p>This procedure outlines how to create a configuration file for the Certificate Signing Request and include the load balancer and orcharhino&#160;Proxy as Subject Alternative Names (SAN).
Complete this procedure on each orcharhino&#160;Proxy that you want to configure for load balancing.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To store all the source certificate files, create a directory that is accessible only to the <code>root</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/orcharhino-proxy_cert</pre>
</div>
</div>
</li>
<li>
<p>Create a private key with which to sign the certificate signing request (CSR).</p>
<div class="paragraph">
<p>Note that the private key must be unencrypted.
If you use a password-protected private key, remove the private key password.</p>
</div>
<div class="paragraph">
<p>If you already have a private key for this orcharhino&#160;Proxy, skip this step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl genrsa -out <code>/root/orcharhino-proxy_cert/orcharhino-proxy_cert_key.pem</code> 4096</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/root/orcharhino-proxy_cert/openssl.cnf</code> configuration file for the CSR and include the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[ req ]
req_extensions = v3_req
distinguished_name = req_distinguished_name
x509_extensions = usr_cert
prompt = no

[ req_distinguished_name ]
commonName = <em>orcharhino-proxy.example.com</em> <b class="conum">(1)</b>

[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth, clientAuth
subjectAltName = @alt_names

[alt_names] <b class="conum">(2)</b>
DNS.1 = <em>loadbalancer.example.com</em>
DNS.2 = <em>orcharhino-proxy.example.com</em></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The certificate&#8217;s common name must match the FQDN of orcharhino&#160;Proxy.
Ensure to change this when running the command on each orcharhino&#160;Proxy that you configure for load balancing.
You can also set a wildcard value <code>*</code>.
If you set a wildcard value, you must add the <code>-t orcharhino-proxy</code> option when you use the <code>katello-certs-check</code> command.</p>
</li>
<li>
<p>Under <code>[alt_names]</code>, include the FQDN of the load balancer as <code>DNS.1</code> and the FQDN of orcharhino&#160;Proxy as <code>DNS.2</code>.</p>
<div class="paragraph">
<p>For more information about the <code>[ v3_req ]</code> parameters and their purpose, see <a href="https://www.rfc-editor.org/rfc/rfc5280">RFC 5280: Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Optional: If you want to add Distinguished Name (DN) details to the CSR, add the following information to the <code>[ req_distinguished_name ]</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[req_distinguished_name]
CN = <em>orcharhino-proxy.example.com</em>
countryName =<em>My_Country_Name</em> <b class="conum">(1)</b>
stateOrProvinceName = <em>My_State_Or_Province_Name</em> <b class="conum">(2)</b>
localityName = <em>My_Locality_Name</em> <b class="conum">(3)</b>
organizationName = <em>My_Organization_Or_Company_Name</em>
organizationalUnitName = <em>My_Organizational_Unit_Name</em> <b class="conum">(4)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Two letter code</p>
</li>
<li>
<p>Full name</p>
</li>
<li>
<p>Full name (example: New York)</p>
</li>
<li>
<p>Division responsible for the certificate (example: IT department)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Generate CSR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl req -new \
-key <em>/root/orcharhino-proxy_cert/orcharhino-proxy_cert_key.pem</em> \ <b class="conum">(1)</b>
-config <em>/root/orcharhino-proxy_cert/openssl.cnf</em> \ <b class="conum">(2)</b>
-out <em>/root/orcharhino-proxy_cert/orcharhino-proxy_cert_csr.pem</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to the private key</p>
</li>
<li>
<p>Path to the configuration file</p>
</li>
<li>
<p>Path to the CSR to generate</p>
</li>
</ol>
</div>
</li>
<li>
<p>Send the certificate signing request to the certificate authority (CA).
The same CA must sign certificates for orcharhino&#160;Server and orcharhino&#160;Proxy.</p>
<div class="paragraph">
<p>When you submit the request, specify the lifespan of the certificate.
The method for sending the certificate request varies, so consult the CA for the preferred method.
In response to the request, you can expect to receive a CA bundle and a signed certificate, in separate files.</p>
</div>
</li>
<li>
<p>Copy the Certificate Authority bundle and orcharhino&#160;Proxy certificate file that you receive from the Certificate Authority, and orcharhino&#160;Proxy private key to your orcharhino&#160;Server.</p>
</li>
<li>
<p>On orcharhino&#160;Server, validate orcharhino&#160;Proxy certificate input files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># katello-certs-check \
-c /root/orcharhino-proxy_cert/orcharhino-proxy_cert.pem \ <b class="conum">(1)</b>
-k /root/orcharhino-proxy_cert/orcharhino-proxy_cert_key.pem \ <b class="conum">(2)</b>
-b /root/orcharhino-proxy_cert/ca_cert_bundle.pem <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>orcharhino&#160;Proxy certificate file, provided by your Certificate Authority</p>
</li>
<li>
<p>orcharhino&#160;Proxy’s private key that you used to sign the certificate</p>
</li>
<li>
<p>Certificate Authority bundle, provided by your Certificate Authority</p>
<div class="paragraph">
<p>If you set the <code>commonName=</code> to a wildcard value <code>*</code>, you must add the <code>-t orcharhino-proxy</code> option to the <code>katello-certs-check</code> command.</p>
</div>
<div class="paragraph">
<p>Retain a copy of the example <code>foreman-proxy-certs-generate</code> command that is output by the <code>katello-certs-check</code> command for creating the Certificate Archive File for this orcharhino&#160;Proxy.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_for_Load_Balancing_without_Puppet_load-balancing"><a class="anchor" href="#Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_for_Load_Balancing_without_Puppet_load-balancing"></a>4.3.2. Configuring orcharhino&#160;Proxy with custom SSL certificates for load balancing without Puppet</h4>
<div class="paragraph">
<p>The following section describes how to configure orcharhino&#160;Proxies that use custom SSL certificates for load balancing without Puppet.
Complete this procedure on each orcharhino&#160;Proxy that you want to configure for load balancing.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Append the following option to the <code>foreman-proxy-certs-generate</code> command that you obtain from the output of the <code>katello-certs-check</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--foreman-proxy-cname <em>loadbalancer.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Server, enter the <code>foreman-proxy-certs-generate</code> command to generate orcharhino&#160;Proxy certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-proxy-certs-generate \
--certs-tar /root/orcharhino-proxy_cert/orcharhino-proxy.tar \
--foreman-proxy-cname <em>loadbalancer.example.com</em> \
--foreman-proxy-fqdn <em>orcharhino-proxy.example.com</em> \
--server-ca-cert /root/orcharhino-proxy_cert/ca_cert_bundle.pem \
--server-cert /root/orcharhino-proxy_cert/orcharhino-proxy.pem \
--server-key /root/orcharhino-proxy_cert/orcharhino-proxy.pem</pre>
</div>
</div>
<div class="paragraph">
<p>Retain a copy of the example <code>foreman-installer</code> command from the output for installing orcharhino&#160;Proxy certificates.</p>
</div>
</li>
<li>
<p>Copy the certificate archive file from orcharhino&#160;Server to orcharhino&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/<em>orcharhino-proxy.example.com</em>-certs.tar root@<em>orcharhino-proxy.example.com</em>:<em>orcharhino-proxy.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>Append the following options to the <code>foreman-installer</code> command that you obtain from the output of the <code>foreman-proxy-certs-generate</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--certs-cname "<em>loadbalancer.example.com</em>" \
--enable-foreman-proxy-plugin-remote-execution-script</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, enter the <code>foreman-installer</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman-proxy-content \
--certs-cname "<em>loadbalancer.example.com</em>" \
--certs-tar-file "<em>orcharhino-proxy.example.com-certs.tar</em>" \
--enable-foreman-proxy-plugin-remote-execution-script \
--foreman-proxy-foreman-base-url "<em>https://orcharhino.example.com</em>" \
--foreman-proxy-oauth-consumer-key "<em>oauth key</em>" \
--foreman-proxy-oauth-consumer-secret "<em>oauth secret</em>" \
--foreman-proxy-register-in-foreman "true" \
--foreman-proxy-trusted-hosts "<em>orcharhino.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>orcharhino-proxy.example.com</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_for_Load_Balancing_with_Puppet_load-balancing"><a class="anchor" href="#Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_for_Load_Balancing_with_Puppet_load-balancing"></a>4.4. Configuring orcharhino&#160;Proxy with custom SSL certificates for load balancing with Puppet</h3>
<div class="paragraph">
<p>If you use Puppet in your orcharhino configuration, then you must complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_to_Generate_and_Sign_Puppet_Certificates_load-balancing">Configuring orcharhino&#160;Proxy with custom SSL certificates to generate and sign Puppet certificates</a></p>
</li>
<li>
<p><a href="#Configuring_Remaining_orcharhino-proxy_Servers_with_Custom_SSL_Certificates_for_Load_Balancing_load-balancing">Configuring remaining orcharhino&#160;Proxies with custom SSL certificates for load balancing</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="creating-a-custom-ssl-certificate_load-balancing-with-custom-ssl-certificates-with-puppet"><a class="anchor" href="#creating-a-custom-ssl-certificate_load-balancing-with-custom-ssl-certificates-with-puppet"></a>4.4.1. Creating a custom SSL certificate for orcharhino&#160;Proxy</h4>
<div class="paragraph">
<p>This procedure outlines how to create a configuration file for the Certificate Signing Request and include the load balancer and orcharhino&#160;Proxy as Subject Alternative Names (SAN).
Complete this procedure on each orcharhino&#160;Proxy that you want to configure for load balancing.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To store all the source certificate files, create a directory that is accessible only to the <code>root</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/orcharhino-proxy_cert</pre>
</div>
</div>
</li>
<li>
<p>Create a private key with which to sign the certificate signing request (CSR).</p>
<div class="paragraph">
<p>Note that the private key must be unencrypted.
If you use a password-protected private key, remove the private key password.</p>
</div>
<div class="paragraph">
<p>If you already have a private key for this orcharhino&#160;Proxy, skip this step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl genrsa -out <code>/root/orcharhino-proxy_cert/orcharhino-proxy_cert_key.pem</code> 4096</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/root/orcharhino-proxy_cert/openssl.cnf</code> configuration file for the CSR and include the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[ req ]
req_extensions = v3_req
distinguished_name = req_distinguished_name
x509_extensions = usr_cert
prompt = no

[ req_distinguished_name ]
commonName = <em>orcharhino-proxy.example.com</em> <b class="conum">(1)</b>

[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth, clientAuth
subjectAltName = @alt_names

[alt_names] <b class="conum">(2)</b>
DNS.1 = <em>loadbalancer.example.com</em>
DNS.2 = <em>orcharhino-proxy.example.com</em></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The certificate&#8217;s common name must match the FQDN of orcharhino&#160;Proxy.
Ensure to change this when running the command on each orcharhino&#160;Proxy that you configure for load balancing.
You can also set a wildcard value <code>*</code>.
If you set a wildcard value, you must add the <code>-t orcharhino-proxy</code> option when you use the <code>katello-certs-check</code> command.</p>
</li>
<li>
<p>Under <code>[alt_names]</code>, include the FQDN of the load balancer as <code>DNS.1</code> and the FQDN of orcharhino&#160;Proxy as <code>DNS.2</code>.</p>
<div class="paragraph">
<p>For more information about the <code>[ v3_req ]</code> parameters and their purpose, see <a href="https://www.rfc-editor.org/rfc/rfc5280">RFC 5280: Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Optional: If you want to add Distinguished Name (DN) details to the CSR, add the following information to the <code>[ req_distinguished_name ]</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[req_distinguished_name]
CN = <em>orcharhino-proxy.example.com</em>
countryName =<em>My_Country_Name</em> <b class="conum">(1)</b>
stateOrProvinceName = <em>My_State_Or_Province_Name</em> <b class="conum">(2)</b>
localityName = <em>My_Locality_Name</em> <b class="conum">(3)</b>
organizationName = <em>My_Organization_Or_Company_Name</em>
organizationalUnitName = <em>My_Organizational_Unit_Name</em> <b class="conum">(4)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Two letter code</p>
</li>
<li>
<p>Full name</p>
</li>
<li>
<p>Full name (example: New York)</p>
</li>
<li>
<p>Division responsible for the certificate (example: IT department)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Generate CSR:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl req -new \
-key <em>/root/orcharhino-proxy_cert/orcharhino-proxy_cert_key.pem</em> \ <b class="conum">(1)</b>
-config <em>/root/orcharhino-proxy_cert/openssl.cnf</em> \ <b class="conum">(2)</b>
-out <em>/root/orcharhino-proxy_cert/orcharhino-proxy_cert_csr.pem</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to the private key</p>
</li>
<li>
<p>Path to the configuration file</p>
</li>
<li>
<p>Path to the CSR to generate</p>
</li>
</ol>
</div>
</li>
<li>
<p>Send the certificate signing request to the certificate authority (CA).
The same CA must sign certificates for orcharhino&#160;Server and orcharhino&#160;Proxy.</p>
<div class="paragraph">
<p>When you submit the request, specify the lifespan of the certificate.
The method for sending the certificate request varies, so consult the CA for the preferred method.
In response to the request, you can expect to receive a CA bundle and a signed certificate, in separate files.</p>
</div>
</li>
<li>
<p>Copy the Certificate Authority bundle and orcharhino&#160;Proxy certificate file that you receive from the Certificate Authority, and orcharhino&#160;Proxy private key to your orcharhino&#160;Server.</p>
</li>
<li>
<p>On orcharhino&#160;Server, validate orcharhino&#160;Proxy certificate input files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># katello-certs-check \
-c /root/orcharhino-proxy_cert/orcharhino-proxy_cert.pem \ <b class="conum">(1)</b>
-k /root/orcharhino-proxy_cert/orcharhino-proxy_cert_key.pem \ <b class="conum">(2)</b>
-b /root/orcharhino-proxy_cert/ca_cert_bundle.pem <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>orcharhino&#160;Proxy certificate file, provided by your Certificate Authority</p>
</li>
<li>
<p>orcharhino&#160;Proxy’s private key that you used to sign the certificate</p>
</li>
<li>
<p>Certificate Authority bundle, provided by your Certificate Authority</p>
<div class="paragraph">
<p>If you set the <code>commonName=</code> to a wildcard value <code>*</code>, you must add the <code>-t orcharhino-proxy</code> option to the <code>katello-certs-check</code> command.</p>
</div>
<div class="paragraph">
<p>Retain a copy of the example <code>foreman-proxy-certs-generate</code> command that is output by the <code>katello-certs-check</code> command for creating the Certificate Archive File for this orcharhino&#160;Proxy.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_to_Generate_and_Sign_Puppet_Certificates_load-balancing"><a class="anchor" href="#Configuring_orcharhino-proxy_Server_with_Custom_SSL_Certificates_to_Generate_and_Sign_Puppet_Certificates_load-balancing"></a>4.4.2. Configuring orcharhino&#160;Proxy with custom SSL certificates to generate and sign Puppet certificates</h4>
<div class="paragraph">
<p>Complete this procedure only for the system where you want to configure orcharhino&#160;Proxy to generate Puppet certificates for all other orcharhino&#160;Proxies that you configure for load balancing.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Append the following option to the <code>foreman-proxy-certs-generate</code> command that you obtain from the output of the <code>katello-certs-check</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--foreman-proxy-cname <em>loadbalancer.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Server, enter the <code>foreman-proxy-certs-generate</code> command to generate orcharhino&#160;Proxy certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-proxy-certs-generate \
--certs-tar /root/orcharhino-proxy_cert/orcharhino-proxy-ca.tar \
--foreman-proxy-cname <em>loadbalancer.example.com</em> \
--foreman-proxy-fqdn <em>orcharhino-proxy-ca.example.com</em> \
--server-ca-cert /root/orcharhino-proxy_cert/ca_cert_bundle.pem \
--server-cert /root/orcharhino-proxy_cert/orcharhino-proxy-ca.pem \
--server-key /root/orcharhino-proxy_cert/orcharhino-proxy-ca.pem</pre>
</div>
</div>
<div class="paragraph">
<p>Retain a copy of the example <code>foreman-installer</code> command from the output for installing orcharhino&#160;Proxy certificates.</p>
</div>
</li>
<li>
<p>Copy the certificate archive file from orcharhino&#160;Server to orcharhino&#160;Proxy.</p>
</li>
<li>
<p>Append the following options to the <code>foreman-installer</code> command that you obtain from the output of the <code>foreman-proxy-certs-generate</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--enable-foreman-proxy-plugin-remote-execution-script \
--foreman-proxy-puppetca "true" \
--puppet-ca-server "<em>orcharhino-proxy-ca.example.com</em>" \
--puppet-dns-alt-names "<em>loadbalancer.example.com</em>" \
--puppet-server-ca "true"</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, enter the <code>foreman-installer</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman-proxy-content \
--certs-cname "<em>loadbalancer.example.com</em>" \
--certs-tar-file "<em>certs.tgz</em>" \
--enable-foreman-proxy-plugin-remote-execution-script \
--enable-puppet \
--foreman-proxy-foreman-base-url "<em>https://orcharhino.example.com</em>" \
--foreman-proxy-oauth-consumer-key "oauth key" \
--foreman-proxy-oauth-consumer-secret "oauth secret" \
--foreman-proxy-puppetca "true" \
--foreman-proxy-register-in-foreman "true" \
--foreman-proxy-trusted-hosts "<em>orcharhino.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>orcharhino-proxy-ca.example.com</em>" \
--puppet-ca-server "<em>orcharhino-proxy-ca.example.com</em>" \
--puppet-dns-alt-names "<em>loadbalancer.example.com</em>" \
--puppet-server true \
--puppet-server-ca "true"</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy that is the Puppetserver Certificate Authority, stop the Puppet server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl stop puppetserver</pre>
</div>
</div>
</li>
<li>
<p>Generate Puppet certificates for all other orcharhino&#160;Proxies that you configure for load balancing, except the system where you first configured Puppet certificate signing:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># puppetserver ca generate \
--ca-client \
--certname <em>orcharhino-proxy.example.com</em> \
--subject-alt-names <em>loadbalancer.example.com</em></pre>
</div>
</div>
<div class="paragraph">
<p>This command creates the following files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/etc/puppetlabs/puppet/ssl/certs/<em>orcharhino-proxy.example.com</em>.pem</code></p>
</li>
<li>
<p><code>/etc/puppetlabs/puppet/ssl/private_keys/<em>orcharhino-proxy.example.com</em>.pem</code></p>
</li>
<li>
<p><code>/etc/puppetlabs/puppet/ssl/public_keys/<em>orcharhino-proxy.example.com</em>.pem</code></p>
</li>
<li>
<p><code>/etc/puppetlabs/puppetserver/ca/signed/<em>orcharhino-proxy.example.com</em>.pem</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Start the Puppet server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start puppetserver</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Remaining_orcharhino-proxy_Servers_with_Custom_SSL_Certificates_for_Load_Balancing_load-balancing"><a class="anchor" href="#Configuring_Remaining_orcharhino-proxy_Servers_with_Custom_SSL_Certificates_for_Load_Balancing_load-balancing"></a>4.4.3. Configuring remaining orcharhino&#160;Proxies with custom SSL certificates for load balancing</h4>
<div class="paragraph">
<p>Complete this procedure for each orcharhino&#160;Proxy excluding the system where you configure orcharhino&#160;Proxy to sign Puppet certificates.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Append the following option to the <code>foreman-proxy-certs-generate</code> command that you obtain from the output of the <code>katello-certs-check</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--foreman-proxy-cname <em>loadbalancer.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Server, enter the <code>foreman-proxy-certs-generate</code> command to generate orcharhino&#160;Proxy certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-proxy-certs-generate \
--certs-tar /root/orcharhino-proxy_cert/orcharhino-proxy.tar \
--foreman-proxy-cname <em>loadbalancer.example.com</em> \
--foreman-proxy-fqdn <em>orcharhino-proxy.example.com</em> \
--server-ca-cert /root/orcharhino-proxy_cert/ca_cert_bundle.pem \
--server-cert /root/orcharhino-proxy_cert/orcharhino-proxy.pem \
--server-key /root/orcharhino-proxy_cert/orcharhino-proxy.pem</pre>
</div>
</div>
<div class="paragraph">
<p>Retain a copy of the example <code>foreman-installer</code> command from the output for installing orcharhino&#160;Proxy certificates.</p>
</div>
</li>
<li>
<p>Copy the certificate archive file from orcharhino&#160;Server to orcharhino&#160;Proxy.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/<em>orcharhino-proxy.example.com</em>-certs.tar root@<em>orcharhino-proxy.example.com</em>:<em>orcharhino-proxy.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, install the <code>puppetserver</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install puppetserver</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, create directories for puppet certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /etc/puppetlabs/puppet/ssl/certs/ \
/etc/puppetlabs/puppet/ssl/private_keys/ \
/etc/puppetlabs/puppet/ssl/public_keys/</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, copy the Puppet certificates for this orcharhino&#160;Proxy from the system where you configure orcharhino&#160;Proxy to sign Puppet certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp root@<em>orcharhino-proxy-ca.example.com</em>:/etc/puppetlabs/puppet/ssl/certs/<em>orcharhino-proxy.example.com</em>.pem /etc/puppetlabs/puppet/ssl/certs/<em>orcharhino-proxy.example.com</em>.pem
# scp root@<em>orcharhino-proxy-ca.example.com</em>:/etc/puppetlabs/puppet/ssl/certs/ca.pem /etc/puppetlabs/puppet/ssl/certs/ca.pem
# scp root@<em>orcharhino-proxy-ca.example.com</em>:/etc/puppetlabs/puppet/ssl/private_keys/<em>orcharhino-proxy.example.com</em>.pem /etc/puppetlabs/puppet/ssl/private_keys/<em>orcharhino-proxy.example.com</em>.pem
# scp root@<em>orcharhino-proxy-ca.example.com</em>:/etc/puppetlabs/puppet/ssl/public_keys/<em>orcharhino-proxy.example.com</em>.pem /etc/puppetlabs/puppet/ssl/public_keys/<em>orcharhino-proxy.example.com</em>.pem</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, change the <code>/etc/puppetlabs/puppet/ssl/</code> directory ownership to user <code>puppet</code> and group <code>puppet</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R puppet:puppet /etc/puppetlabs/puppet/ssl/</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, set the SELinux context for the <code>/etc/puppetlabs/puppet/ssl/</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -Rv /etc/puppetlabs/puppet/ssl/</pre>
</div>
</div>
</li>
<li>
<p>Append the following options to the <code>foreman-installer</code> command that you obtain from the output of the <code>foreman-proxy-certs-generate</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--certs-cname "<em>loadbalancer.example.com</em>" \
--enable-foreman-proxy-plugin-remote-execution-script \
--foreman-proxy-puppetca "false" \
--puppet-ca-server "<em>orcharhino-proxy-ca.example.com</em>" \
--puppet-dns-alt-names "<em>loadbalancer.example.com</em>" \
--puppet-server-ca "false"</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino&#160;Proxy, enter the <code>foreman-installer</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario foreman-proxy-content \
--certs-cname "<em>loadbalancer.example.com</em>" \
--certs-tar-file "<em>orcharhino-proxy.example.com-certs.tar</em>" \
--enable-foreman-proxy-plugin-remote-execution-script \
--foreman-proxy-foreman-base-url "<em>https://orcharhino.example.com</em>" \
--foreman-proxy-oauth-consumer-key "<em>oauth key</em>" \
--foreman-proxy-oauth-consumer-secret "<em>oauth secret</em>" \
--foreman-proxy-puppetca "false" \
--foreman-proxy-register-in-foreman "true" \
--foreman-proxy-trusted-hosts "<em>orcharhino.example.com</em>" \
--foreman-proxy-trusted-hosts "<em>orcharhino-proxy.example.com</em>" \
--puppet-ca-server "<em>orcharhino-proxy-ca.example.com</em>" \
--puppet-dns-alt-names "<em>loadbalancer.example.com</em>" \
--puppet-server-ca "false"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Setting_the_Load_Balancer_for_Host_Registration_load-balancing"><a class="anchor" href="#Setting_the_Load_Balancer_for_Host_Registration_load-balancing"></a>5. Setting the load balancer for host registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure orcharhino to register clients through a load balancer when using the host registration feature.</p>
</div>
<div class="paragraph">
<p>You will be able to register hosts to the load balancer instead of orcharhino&#160;Proxy.
The load balancer will decide through which orcharhino&#160;Proxy to register the host at the time of request.
Upon registration, the subscription manager on the host will be configured to manage content through the load balancer.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You configured SSL certificates on all orcharhino&#160;Proxies.
For more information, see <a href="#Configuring_orcharhino-proxy_Servers_for_Load_Balancing_load-balancing">Configuring orcharhino&#160;Proxies for load balancing</a>.</p>
</li>
<li>
<p>You enabled Registration and Templates plugins on all orcharhino&#160;Proxies:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-registration true \
--foreman-proxy-templates true</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On all orcharhino&#160;Proxies, set the registration and template URLs using <code>foreman-installer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-registration-url "https://<em>loadbalancer.example.com</em>:9090" \
--foreman-proxy-template-url "http://<em>loadbalancer.example.com</em>:8000"</pre>
</div>
</div>
</li>
<li>
<p>In the orcharhino management UI, navigate to <strong>Infrastructure</strong> &gt; <strong>orcharhino&#160;Proxies</strong>.</p>
</li>
<li>
<p>For each orcharhino&#160;Proxy, click the dropdown menu in the <strong>Actions</strong> column and select <strong>Refresh</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Installing_the_Load_Balancer_load-balancing"><a class="anchor" href="#Installing_the_Load_Balancer_load-balancing"></a>6. Installing the load balancer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following example provides general guidance for configuring an HAProxy load balancer using Enterprise Linux 9 or Enterprise Linux 8.
However, you can install any suitable load balancing software solution that supports TCP forwarding.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install HAProxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install haproxy</pre>
</div>
</div>
</li>
<li>
<p>Install the following package that includes the <code>semanage</code> tool:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install policycoreutils-python-utils</pre>
</div>
</div>
</li>
<li>
<p>Configure SELinux to allow HAProxy to bind any port:</p>
<div class="listingblock">
<div class="content">
<pre># semanage boolean --modify --on haproxy_connect_any</pre>
</div>
</div>
</li>
<li>
<p>Configure the load balancer to balance the network load for the ports as described in <a href="#ports-configuration-for-the-load-balancer">Ports configuration for the load balancer</a>.
For example, to configure ports for HAProxy, edit the <code>/etc/haproxy/haproxy.cfg</code> file to correspond with the table.</p>
<table id="ports-configuration-for-the-load-balancer" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Ports configuration for the load balancer</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">Balance Mode</th>
<th class="tableblock halign-left valign-top">Destination</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">roundrobin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">port 80 on all orcharhino&#160;Proxies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS and RHSM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">port 443 on all orcharhino&#160;Proxies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anaconda for template retrieval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">roundrobin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">port 8000 on all orcharhino&#160;Proxies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puppet (<em>Optional</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8140</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">roundrobin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">port 8140 on all orcharhino&#160;Proxies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PuppetCA (<em>Optional</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8141</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">roundrobin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">port 8140 only on the system where you configure orcharhino&#160;Proxy to sign Puppet certificates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">orcharhino&#160;Proxy HTTPS for Host Registration and optionally OpenSCAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">roundrobin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">port 9090 on all orcharhino&#160;Proxies</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Configure the load balancer to disable SSL offloading and allow client-side SSL certificates to pass through to back end servers.
This is required because communication from clients to orcharhino&#160;Proxies depends on client-side SSL certificates.</p>
</li>
<li>
<p>Start and enable the HAProxy service:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl enable --now haproxy</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Verifying_the_Load_Balancing_Configuration_load-balancing"><a class="anchor" href="#Verifying_the_Load_Balancing_Configuration_load-balancing"></a>7. Verifying the load balancing configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this procedure to verify the load balancing configuration for each orcharhino&#160;Proxy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Shut down the base operating system for your orcharhino&#160;Proxy.</p>
</li>
<li>
<p>Verify that content or subscription management features are available on clients registered to this orcharhino&#160;Proxy.
For example, enter the <code>subscription-manager refresh</code> command on a client.</p>
</li>
<li>
<p>Restart the base operating system for your orcharhino&#160;Proxy.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Registering_Clients_to_the_Load_Balancer_load-balancing"><a class="anchor" href="#Registering_Clients_to_the_Load_Balancer_load-balancing"></a>8. Registering clients to the load balancer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To balance the load of network traffic from clients, you must register the clients to the load balancer.</p>
</div>
<div class="paragraph">
<p>To register clients, proceed with one of the following procedures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Registering_Clients_Using_Host_Registration_load-balancing">Registering clients using host registration</a></p>
</li>
<li>
<p><a href="#Registering_Clients_Using_the_Bootstrap_Script_load-balancing"><strong>(Deprecated)</strong> Registering clients using the bootstrap script</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="Registering_Clients_Using_Host_Registration_load-balancing"><a class="anchor" href="#Registering_Clients_Using_Host_Registration_load-balancing"></a>8.1. Registering clients using host registration</h3>
<div class="paragraph">
<p>You can register hosts with orcharhino using the host registration feature in the orcharhino management UI, Hammer CLI, or the orcharhino API.
For more information, see <a href="https://docs.theforeman.org/3.10/Managing_Hosts/index-orcharhino.html#Registering_Hosts_managing-hosts">Registering Hosts</a> in <em>Managing hosts</em>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have set the load balancer for host registration.
For more information, see <a href="#Setting_the_Load_Balancer_for_Host_Registration_load-balancing">Setting the load balancer for host registration</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Hosts</strong> &gt; <strong>Register Host</strong>.</p>
</li>
<li>
<p>From the <strong>orcharhino&#160;Proxy</strong> dropdown list, select your orcharhino&#160;Proxy configured for load balancing.</p>
</li>
<li>
<p>Select <strong>Force</strong> to register a host that has been previously registered to a orcharhino&#160;Proxy.</p>
</li>
<li>
<p>From the <strong>Activation Keys</strong> list, select the activation keys to assign to your host.</p>
</li>
<li>
<p>Click <strong>Generate</strong> to create the registration command.</p>
</li>
<li>
<p>Click on the <em>files</em> icon to copy the command to your clipboard.</p>
</li>
<li>
<p>Connect to your host using SSH and run the registration command.</p>
</li>
<li>
<p>Ensure that the appropriate repositories have been enabled:</p>
<div class="ulist">
<ul>
<li>
<p>On Enterprise Linux: Check the <code>/etc/yum.repos.d/redhat.repo</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
<li>
<p>On Debian/Ubuntu: Check the <code>/etc/apt/sources.list</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
<li>
<p>On Enterprise Linux: Check the <code>/etc/yum.repos.d/redhat.repo</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
<li>
<p>On SUSE Linux Enterprise Server: Check the <code>/etc/zypp/repos.d/</code> directory and ensure that the appropriate repositories have been enabled.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Generate the host registration command using the Hammer CLI:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host-registration generate-command \
--activation-keys "<em>My_Activation_Key</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>If your hosts do not trust the SSL certificate of orcharhino&#160;Server, you can disable SSL validation by adding the <code>--insecure</code> flag to the registration command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host-registration generate-command \
--activation-keys "<em>My_Activation_Key</em>" \
--insecure true</pre>
</div>
</div>
<div class="paragraph">
<p>Include the <code>--smart-proxy-id <em>My_orcharhino_Proxy_ID</em></code> option.
You can use the ID of any orcharhino&#160;Proxy that you configured for host registration load balancing.
orcharhino will apply the load balancer to the registration command automatically.</p>
</div>
<div class="paragraph">
<p>Include the <code>--force</code> option to register a host that has been previously registered to a orcharhino&#160;Proxy.</p>
</div>
</li>
<li>
<p>Connect to your host using SSH and run the registration command.</p>
</li>
<li>
<p>Ensure that the appropriate repositories have been enabled:</p>
<div class="ulist">
<ul>
<li>
<p>On Enterprise Linux: Check the <code>/etc/yum.repos.d/redhat.repo</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
<li>
<p>On Debian/Ubuntu: Check the <code>/etc/apt/sources.list</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
<li>
<p>On Enterprise Linux: Check the <code>/etc/yum.repos.d/redhat.repo</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
<li>
<p>On SUSE Linux Enterprise Server: Check the <code>/etc/zypp/repos.d/</code> directory and ensure that the appropriate repositories have been enabled.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">API procedure</div>
<ol class="arabic">
<li>
<p>Generate the host registration command using the orcharhino API:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -X POST https://orcharhino.example.com/api/registration_commands \
--user "<em>My_User_Name</em>" \
-H 'Content-Type: application/json' \
-d '{ "registration_command": { "activation_keys": ["<em>My_Activation_Key_1</em>, <em>My_Activation_Key_2</em>"] }}'</pre>
</div>
</div>
<div class="paragraph">
<p>If your hosts do not trust the SSL certificate of orcharhino&#160;Server, you can disable SSL validation by adding the <code>--insecure</code> flag to the registration command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -X POST https://orcharhino.example.com/api/registration_commands \
--user "<em>My_User_Name</em>" \
-H 'Content-Type: application/json' \
-d '{ "registration_command": { "activation_keys": ["<em>My_Activation_Key_1</em>, <em>My_Activation_Key_2</em>"], "insecure": true }}'</pre>
</div>
</div>
<div class="paragraph">
<p>Use an activation key to simplify specifying the environments.
For more information, see <a href="https://docs.theforeman.org/3.10/Managing_Content/index-orcharhino.html#Managing_Activation_Keys_content-management">Managing Activation Keys</a> in <em>Managing content</em>.</p>
</div>
<div class="paragraph">
<p>Include <code>{ "smart_proxy_id": <em>My_orcharhino_Proxy_ID</em> }</code>.
You can use the ID of any orcharhino&#160;Proxy that you configured for host registration load balancing.
orcharhino will apply the load balancer to the registration command automatically.</p>
</div>
<div class="paragraph">
<p>Include <code>{ "force": true }</code> to register a host that has been previously registered to a orcharhino&#160;Proxy.</p>
</div>
<div class="paragraph">
<p>To enter a password as a command line argument, use <code>username:password</code> syntax.
Keep in mind this can save the password in the shell history.
Alternatively, you can use a temporary personal access token instead of a password.
To generate a token in the orcharhino management UI, navigate to <strong>My Account</strong> &gt; <strong>Personal Access Tokens</strong>.</p>
</div>
</li>
<li>
<p>Connect to your host using SSH and run the registration command.</p>
</li>
<li>
<p>Ensure that the appropriate repositories have been enabled:</p>
<div class="ulist">
<ul>
<li>
<p>On Enterprise Linux: Check the <code>/etc/yum.repos.d/redhat.repo</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
<li>
<p>On Debian/Ubuntu: Check the <code>/etc/apt/sources.list</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
<li>
<p>On Enterprise Linux: Check the <code>/etc/yum.repos.d/redhat.repo</code> file and ensure that the appropriate repositories have been enabled.</p>
</li>
<li>
<p>On SUSE Linux Enterprise Server: Check the <code>/etc/zypp/repos.d/</code> directory and ensure that the appropriate repositories have been enabled.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Registering_Clients_Using_the_Bootstrap_Script_load-balancing"><a class="anchor" href="#Registering_Clients_Using_the_Bootstrap_Script_load-balancing"></a>8.2. <strong>(Deprecated)</strong> Registering clients using the bootstrap script</h3>
<div class="paragraph">
<p>To register clients, enter the following command on the client.
You must complete the registration procedure for each client.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you install the bootstrap script on the client and change file permissions of the script to executable.
For more information, see <a href="https://docs.theforeman.org/3.10/Managing_Hosts/index-orcharhino.html#Registering_Hosts_by_Using_the_Bootstrap_Script_managing-hosts">Registering Hosts to orcharhino Using The Bootstrap Script</a> in <em>Managing hosts</em>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>On Enterprise Linux 8, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># /usr/libexec/platform-python bootstrap.py \
--activationkey="<em>My_Activation_Key</em>" \
--enablerepos=https://yum.theforeman.org/client/3.10/el8/x86_64/foreman-client-release.rpm \ <b class="conum">(1)</b>
--force \ <b class="conum">(2)</b>
--hostgroup="<em>My_Host_Group</em>" \
--location="<em>My_Location</em>" \
--login=<em>admin</em> \
--organization="<em>My_Organization</em>" \
--puppet-ca-port 8141 \ <b class="conum">(3)</b>
--server <em>loadbalancer.example.com</em></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Replace <code>&lt;arch&gt;</code> with the client architecture, for example <code>x86</code>.</p>
</li>
<li>
<p>Include the <code>--force</code> option to register the client that has been previously registered to a standalone orcharhino&#160;Proxy.</p>
</li>
<li>
<p>Include the <code>--puppet-ca-port 8141</code> option if you use Puppet.</p>
</li>
</ol>
</div>
</li>
<li>
<p>On Enterprise Linux 7 or 6, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># python bootstrap.py --login=<em>admin</em> \
--activationkey="<em>My_Activation_Key</em>" \
--enablerepos=https://yum.theforeman.org/client/3.10/el7/x86_64/foreman-client-release.rpm \
--force \ <b class="conum">(1)</b>
--hostgroup="<em>My_Host_Group</em>" \
--location="<em>My_Location</em>" \
--organization="<em>My_Organization</em>" \
--puppet-ca-port 8141 \ <b class="conum">(2)</b>
--server <em>loadbalancer.example.com</em></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Include the <code>--force</code> option to register the client that has been previously registered to a standalone orcharhino&#160;Proxy.</p>
</li>
<li>
<p>Include the <code>--puppet-ca-port 8141</code> option if you use Puppet.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The script prompts for the password corresponding to the orcharhino user name you entered with the <code>--login</code> option.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="propagating-scap-content-through-the-load-balancer_load-balancing"><a class="anchor" href="#propagating-scap-content-through-the-load-balancer_load-balancing"></a>9. Propagating SCAP content through the load balancer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you use OpenSCAP to manage security compliance on your clients, you must configure the SCAP client to send ARF reports to the load balancer instead of orcharhino&#160;Proxy.
The configuration procedure depends on the method you have selected to deploy compliance policies.</p>
</div>
<div class="sect2">
<h3 id="Propagating_SCAP_Content_using_Ansible_Deployment_load-balancing"><a class="anchor" href="#Propagating_SCAP_Content_using_Ansible_Deployment_load-balancing"></a>9.1. Propagating SCAP content using Ansible deployment</h3>
<div class="paragraph">
<p>Using this procedure, you can promote Security Content Automation Protocol (SCAP) content through the load balancer in the scope of the Ansible deployment method.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you have configured orcharhino for Ansible deployment of compliance policies.
For more information, see <a href="https://docs.theforeman.org/3.10/Managing_Security_Compliance/index-orcharhino.html#configuring-compliance-policy-deployment-methods_security-compliance">Configuring Compliance Policy Deployment Methods</a> in <em>Managing security compliance</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Configure</strong> &gt; <strong>Ansible</strong> &gt; <strong>Variables</strong>.</p>
</li>
<li>
<p>Search for the <code>foreman_scap_client_port</code> variable and click its name.</p>
</li>
<li>
<p>In the <strong>Default Behavior</strong> area, ensure that the <strong>Override</strong> checkbox is selected.</p>
</li>
<li>
<p>In the <strong>Parameter Type</strong> list, ensure that <code>integer</code> is selected.</p>
</li>
<li>
<p>In the <strong>Default Value</strong> field, enter <code>9090</code>.</p>
</li>
<li>
<p>In the <strong>Specify Matchers</strong> area, remove all matchers that override the default value.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Search for the <code>foreman_scap_client_server</code> variable and click its name.</p>
</li>
<li>
<p>In the <strong>Default Behavior</strong> area, ensure that the <strong>Override</strong> checkbox is selected.</p>
</li>
<li>
<p>In the <strong>Parameter Type</strong> list, ensure that <code>string</code> is selected.</p>
</li>
<li>
<p>In the <strong>Default Value</strong> field, enter the FQDN of your load balancer, such as <code><em>loadbalancer.example.com</em></code>.</p>
</li>
<li>
<p>In the <strong>Specify Matchers</strong> area, remove all matchers that override the default value.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Continue with deploying a compliance policy using Ansible.
For more information, see:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.theforeman.org/3.10/Managing_Security_Compliance/index-orcharhino.html#Deploying_a_Policy_in_a_Host_Group_Using_Ansible_security-compliance">Deploying a Policy in a Host Group Using Ansible</a> in <em>Managing security compliance</em></p>
</li>
<li>
<p><a href="https://docs.theforeman.org/3.10/Managing_Security_Compliance/index-orcharhino.html#Deploying_a_Policy_on_a_Host_Using_Ansible_security-compliance">Deploying a Policy on a Host Using Ansible</a> in <em>Managing security compliance</em></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>On the client, verify that the <code>/etc/foreman_scap_client/config.yaml</code> file contains the following lines:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># Foreman proxy to which reports should be uploaded
:server: '<em>loadbalancer.example.com</em>'
:port: 9090</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Propagating_SCAP_Content_using_Puppet_Deployment_load-balancing"><a class="anchor" href="#Propagating_SCAP_Content_using_Puppet_Deployment_load-balancing"></a>9.2. Propagating SCAP content using Puppet deployment</h3>
<div class="paragraph">
<p>Using this procedure, you can promote Security Content Automation Protocol (SCAP) content through the load balancer in the scope of the Puppet deployment method.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you have configured orcharhino for Puppet deployment of compliance policies.
For more information, see <a href="https://docs.theforeman.org/3.10/Managing_Security_Compliance/index-orcharhino.html#configuring-compliance-policy-deployment-methods_security-compliance">Configuring Compliance Policy Deployment Methods</a> in <em>Managing security compliance</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the orcharhino management UI, navigate to <strong>Configure</strong> &gt; <strong>Puppet ENC</strong> &gt; <strong>Classes</strong>.</p>
</li>
<li>
<p>Click <code>foreman_scap_client</code>.</p>
</li>
<li>
<p>Click the <strong>Smart Class Parameter</strong> tab.</p>
</li>
<li>
<p>In the pane to the left of the <strong>Smart Class Parameter</strong> window, click <code>port</code>.</p>
</li>
<li>
<p>In the <strong>Default Behavior</strong> area, select the <strong>Override</strong> checkbox.</p>
</li>
<li>
<p>From the <strong>Key Type</strong> list, select <code>integer</code>.</p>
</li>
<li>
<p>In the <strong>Default Value</strong> field, enter <code>9090</code>.</p>
</li>
<li>
<p>In the pane to the left of the <strong>Smart Class Parameter</strong> window, click <code>server</code>.</p>
</li>
<li>
<p>In the <strong>Default Behavior</strong> area, select the <strong>Override</strong> checkbox.</p>
</li>
<li>
<p>From the <strong>Key Type</strong> list, select <code>string</code>.</p>
</li>
<li>
<p>In the <strong>Default Value</strong> field, enter the FQDN of your load balancer, such as <code><em>loadbalancer.example.com</em></code>.</p>
</li>
<li>
<p>In the lower left of the <strong>Smart Class Parameter</strong> window, click <strong>Submit</strong>.</p>
</li>
<li>
<p>Continue with deploying a compliance policy using Puppet.
For more information, see:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.theforeman.org/3.10/Managing_Security_Compliance/index-orcharhino.html#Deploying_a_Policy_in_a_Host_Group_Using_Puppet_security-compliance">Deploying a Policy in a Host Group Using Puppet</a> in <em>Managing security compliance</em></p>
</li>
<li>
<p><a href="https://docs.theforeman.org/3.10/Managing_Security_Compliance/index-orcharhino.html#Deploying_a_Policy_on_a_Host_Using_Puppet_security-compliance">Deploying a Policy on a Host Using Puppet</a> in <em>Managing security compliance</em></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>On the client, verify that the <code>/etc/foreman_scap_client/config.yaml</code> file contains the following lines:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># Foreman proxy to which reports should be uploaded
:server: '<em>loadbalancer.example.com</em>'
:port: 9090</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 6.7 (unsupported)<br>
Last updated Oct 2025
</div>
</div>
</body>
</html>