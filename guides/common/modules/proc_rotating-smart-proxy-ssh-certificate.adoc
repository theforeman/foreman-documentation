:_mod-docs-content-type: PROCEDURE

[id="rotating-{smart-proxy-context}-ssh-certificate"]
= Rotating {SmartProxy} SSH certificate

[role="_abstract"]
You can rotate the SSH certificate used by {SmartProxy} for remote execution by generating a new SSH key pair and having it signed by your configured CA.

.Prerequisites
* You have SSH certificate authentication enabled on {SmartProxy}.
* You have a configured CA for signing SSH certificates.

.Procedure
. On the {SmartProxyServer}, locate the directory that {SmartProxy} uses for remote execution by checking where the configured {SmartProxy} SSH private key is stored.
You can find the location of the SSH private key in `/etc/foreman-proxy/settings.d/remote_execution_ssh.yml` under the `:ssh_identity_key_file:` setting.
By default, the directory is `/var/lib/foreman-proxy/ssh/`.
. On the {SmartProxyServer}, generate a new SSH key pair in the directory:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# ssh-keygen -f __My_{smart-proxy-context-titlecase}_SSH_Directory__/__My_New_SSH_Key__
----
. Set the correct ownership for the new key files:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# chown foreman-proxy:foreman-proxy __My_{smart-proxy-context-titlecase}_SSH_Directory__/__My_New_SSH_Key__*
----
. If the CA is on a different server than your {SmartProxyServer}, copy the new public key file to the CA server.
. Sign the new SSH public key with your CA.
. If the CA is on a different server than your {SmartProxyServer}, copy the created SSH certificate file back to the {SmartProxyServer} into the {SmartProxy} SSH directory.
. Set the correct ownership for the certificate file:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# chown foreman-proxy:foreman-proxy __My_{smart-proxy-context-titlecase}_SSH_Directory__/__My_New_SSH_Key__-cert.pub
----
. Configure {SmartProxy} to use the new SSH key:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# {foreman-installer} \
--foreman-proxy-plugin-remote-execution-script-ssh-identity-file __My_{smart-proxy-context-titlecase}_SSH_Directory__/__My_New_SSH_Key__
----
+
[NOTE]
====
If you created the new SSH key pair with the same name as the old one and thus replaced the old key pair, you do not need to update your {SmartProxy} configuration with {foreman-installer}.
====
. Optional: Remove the old SSH key files from the {SmartProxy} SSH directory.

.Verification
include::snip_verifying-smart-proxy-ssh-certificate-authentication.adoc[]
