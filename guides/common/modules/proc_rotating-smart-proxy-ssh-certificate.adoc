:_mod-docs-content-type: PROCEDURE

[id="rotating-{smart-proxy-context}-ssh-certificate"]
= Rotating {SmartProxy} SSH certificate

[role="_abstract"]
You can rotate the SSH certificate used by {SmartProxy} for remote execution by generating a new SSH key pair and having it signed by your configured CA.

.Prerequisites
* You have SSH certificate authentication enabled on {SmartProxy}.
* You have a configured CA for signing SSH certificates.

.Procedure
. On the {SmartProxyServer}, generate a new SSH key pair inside the `/var/lib/foreman-proxy/ssh/` directory:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# ssh-keygen -f /var/lib/foreman-proxy/ssh/_My_New_SSH_Key_
----
. Set the correct ownership for the new key files:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# chown foreman-proxy:foreman-proxy /var/lib/foreman-proxy/ssh/_My_New_SSH_Key_*
----
. If the CA is on a different server than your {SmartProxyServer}, export the new public key to the CA server.
. Sign the new SSH public key with your CA.
. If the CA is on a different server than your {SmartProxyServer}, import the created SSH certificate back to the {SmartProxyServer} into `/var/lib/foreman-proxy/ssh/`.
. Set the correct ownership for the certificate file:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# chown foreman-proxy:foreman-proxy /var/lib/foreman-proxy/ssh/_My_New_SSH_Key_-cert.pub
----
. Configure {SmartProxy} to use the new SSH key:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# {foreman-installer} \
--foreman-proxy-plugin-remote-execution-script-ssh-identity-file _My_New_SSH_Key_
----
. Optional: Remove the old SSH key files from `/var/lib/foreman-proxy/ssh/`.

.Verification
include::snip_verifying-smart-proxy-ssh-certificate-authentication.adoc[]
