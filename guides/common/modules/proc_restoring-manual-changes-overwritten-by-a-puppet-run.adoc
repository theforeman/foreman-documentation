:_mod-docs-content-type: PROCEDURE

[id="restoring-manual-changes-overwritten-by-a-puppet-run"]
= Restoring manual changes overwritten by a Puppet run

If your manual configuration has been overwritten by a Puppet run, you can restore the files to the previous state.

For example, when you install and configure {Project} for the first time by using `{foreman-installer}`, you can use the `--foreman-proxy-dns-managed false` and `--foreman-proxy-dhcp-managed false` options to specify that the DNS and DHCP configuration files are not to be managed by Puppet.
If you do not use these options during the initial `{foreman-installer}` run, rerunning `{foreman-installer}` overwrites all manual changes.
The following example shows you how to restore a DHCP configuration file overwritten by a Puppet run.

.Procedure
. Create a backup of the configuration file that you want to restore:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# cp /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.backup
----
+
You can compare the overwritten file with the backup to check for any mandatory changes required by the upgrade.
. Check the log files to note down the md5sum of the overwritten file:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# journalctl -xe
----
+
Search the output for the configuration file, for example, `/etc/dhcp/dhcpd.conf`:
+
[source, none, options="nowrap", subs="+quotes,verbatim,attributes"]
----
/Stage[main]/Dhcp/File[/etc/dhcp/dhcpd.conf]: Filebucketed /etc/dhcp/dhcpd.conf to puppet with sum 622d9820b8e764ab124367c68f5fa3a1
----
. Restore the overwritten file:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# puppet filebucket restore --local --bucket \
/var/lib/puppet/clientbucket /etc/dhcp/dhcpd.conf \ 622d9820b8e764ab124367c68f5fa3a1
----
. Compare the backup file and the restored file, and edit the restored file to include any mandatory changes required by the upgrade.
