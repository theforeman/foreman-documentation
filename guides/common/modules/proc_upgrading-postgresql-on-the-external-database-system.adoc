[id="Upgrading_PostgreSQL_on_the_External_Database_System_{context}"]
= Upgrading PostgreSQL on the external database system

ifdef::katello,satellite,orcharhino[]
Upgrade the external database to PostgreSQL 13 and rectify the permissions.
endif::[]

ifdef::foreman-el[]
Upgrade the external database to PostgreSQL 13
endif::[]

.Procedure
. Back up the `var/lib/pgsql/data/postgresql.conf` and `/var/lib/pgsql/data/pg_hba.conf` files.
. Follow the instructions in {RHELDocsBaseURL}8/html/deploying_different_types_of_servers/using-databases#fast-upgrade-using-the-pg_upgrade-tool_migrating-to-a-rhel-8-version-of-postgresql[Fast upgrade using the pg_upgrade utility] in _{RHEL}{nbsp}8 Deploying different types of servers_ to upgrade the external database.
+
Instead of enabling the `postgresql:13` module, switch to the module:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# yum module switch-to postgresql:13
----
. Restore the `var/lib/pgsql/data/postgresql.conf` and `/var/lib/pgsql/data/pg_hba.conf` files from the backup.
ifdef::katello,satellite,orcharhino[]
. Correct the permissions on the `evr` extension on the external database:
+
[options="nowrap", subs="+quotes,verbatim,attributes"]
----
# runuser -l postgres -c \
"psql -d foreman -c \"UPDATE pg_extension SET extowner = (SELECT oid FROM pg_authid WHERE rolname='foreman') WHERE extname='evr';\""
----
endif::[]
