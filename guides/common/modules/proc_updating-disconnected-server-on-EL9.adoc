[id="Updating-Disconnected-{project-context}-on-EL9_{context}"]
= Updating a disconnected {ProjectServer} on {EL} 9

You can update your disconnected {Project} on {EL} 9 by synchronizing the required repositories on the connected {Project} and syncing the content to the disconnected {Project} by using syncable exports.

.Procedure on the connected {ProjectServer}
. Synchronize the following repositories on your connected {ProjectServer}:
+
* `{RepoRHEL9BaseOS}`
* `{RepoRHEL9AppStream}`
* `{RepoRHEL9ServerSatelliteServerProjectVersion}`
* `{RepoRHEL9ServerSatelliteMaintenanceProjectVersion}`

+
Ensure that the download policy is set to *Immediate* for each repository.
. List the repositories to identify their IDs:
+
[options="nowrap" subs="+quotes,verbatim,attributes"]
----
$ hammer repository list \
--organization-label _My_Organization_Label_
----
. Export the repositories in the syncable format:
+
[options="nowrap" subs="+quotes,verbatim,attributes"]
----
$ hammer content-export complete repository \
--format syncable \
--id _My_Repository_ID_ 
----
. Copy the exported directories to the disconnected {ProjectServer}.

.Procedure on the disconnected {ProjectServer}
. Locate the copied exported directories.
. Create the `/etc/yum.repos.d/update.repo` file and update the `baseurl` values to point to the local file system:
+
[source, ini, options="nowrap" subs="+quotes,verbatim,attributes"]
----
[{RepoRHEL9BaseOS}]
name=Red Hat Enterprise Linux 9 for x86_64 - BaseOS (RPMs)
enabled=1
metadata_expire=-1
gpgcheck=0
baseurl=file:///_BaseOS_Export_Location_/content/dist/rhel9/9/x86_64/baseos/os

[{RepoRHEL9AppStream}]
name=Red Hat Enterprise Linux 9 for x86_64 - AppStream (RPMs)
enabled=1
metadata_expire=-1
gpgcheck=0
baseurl=file:///_AppStream_Export_Location_/content/dist/rhel9/9/x86_64/appstream/os

[{RepoRHEL9ServerSatelliteServerProjectVersion}]
name={ProjectName} {ProjectVersion} for RHEL 9 Server RPMs x86_64
enabled=1
metadata_expire=-1
gpgcheck=0
baseurl=file:///_{Project}_Export_Location_/content/dist/layered/rhel9/x86_64/{project-context}/{ProjectVersion}/os/

[{RepoRHEL9ServerSatelliteMaintenanceProjectVersion}]
name={ProjectName} Maintenance {ProjectVersion} for RHEL 9 Server RPMs x86_64
enabled=1
metadata_expire=-1
gpgcheck=0
baseurl=file:///_{Project}_Maintenance_Export_Location_/content/dist/layered/rhel9/x86_64/sat-maintenance/{ProjectVersion}/os/
----
. Upgrade `{foreman-maintain}` to the next version:
+
[options="nowrap" subs="attributes"]
----
# {foreman-maintain} self-upgrade --maintenance-repo-label={RepoRHEL9ServerSatelliteMaintenanceProjectVersion}
----
. Evaluate that the system is ready for update.
The first time you run this command, `{foreman-maintain}` prompts you to enter the Hammer admin user credentials and saves them to `/etc/foreman-maintain/foreman-maintain-hammer.yml`.
+
[options="nowrap" subs="+quotes,verbatim,attributes"]
----
# {foreman-maintain} update check --whitelist="repositories-validate,repositories-setup"
----
. Review the results and resolve any errors before proceeding with the update.
. Due to the lengthy update time, use a utility such as `tmux` to suspend and resume the session as needed.
By using such utility, you can monitor progress without maintaining a continuous connection to the command shell.
+
If you lose connection to the command shell where the update command is running, check the `{installer-log-file}` file to confirm whether the process completed successfully.
. Perform the update:
+
[options="nowrap" subs="+quotes,verbatim,attributes"]
----
# {foreman-maintain} update run --whitelist="repositories-validate,repositories-setup"
----

include::snip_steps-needs-reboot.adoc[]

.Additional resources
* {AdministeringDocURL}Restoring_from_a_Full_Backup_admin[Restoring {ProjectServer} or {SmartProxyServer} from a backup]