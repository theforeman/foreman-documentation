:_mod-docs-content-type: REFERENCE

[id="ref_grub2-uefi-bootloaders_{context}"]
= GRUB2 UEFI Bootloaders and the bootloader_universe Structure

This section describes GRUB-based PXE bootloaders, including *PXEGrub (Legacy)* and *PXEGrub2*,  
and explains how the *bootloader_universe* directory structure organizes GRUB2 binaries by OS and architecture.

== Overview

{Project} supports two generations of GRUB-based PXE bootloaders: *PXEGrub (GRUB Legacy)* and *PXEGrub2 (GRUB2-based)*.
PXEGrub is used for older BIOS or early UEFI systems, while PXEGrub2 supports *UEFI* and *Secure Boot* environments.

Both are managed by the {SmartProxy}’s TFTP service, which provides PXE clients with the appropriate bootloader binaries and configuration files.

By using the `bootloader_universe` directory structure, GRUB2-based UEFI bootloaders can be organized and managed by distribution, version, and architecture.
This feature does not require explicit configuration; it is automatically enabled when the {SmartProxy} uses the
`/var/lib/tftpboot/bootloader-universe/pxegrub2/` directory structure.

== Directory Structure: bootloader_universe

This section explains the purpose and layout of the `bootloader_universe` directory, which enables multiple OS versions and architectures to coexist cleanly.

=== Organized Hierarchy by OS and Architecture

When the {SmartProxy} recognizes the `/var/lib/tftpboot/bootloader-universe/pxegrub2/` structure,
bootloaders are stored in an organized hierarchy by OS, version, and architecture.
This allows multiple distributions and versions to coexist without conflicts.

Before placing bootloader binaries (`shim<__arch__>.efi`, `grub<__arch__>.efi`), you must manually create the corresponding directory hierarchy using the `mkdir` command.

Example:
----
mkdir -p /var/lib/tftpboot/bootloader-universe/pxegrub2/rocky/9.5/x86_64
----

=== File Locations and Roles

The following table summarizes the purpose of each directory in the `bootloader_universe` hierarchy.

. File Locations and Roles

[cols="1,2,1", options="header"]
|===
| Path
| Purpose / Usage
| User Action

| /var/lib/tftpboot/bootloader-universe/pxegrub2/<__distro__>/<__version__>/<__arch__>/
| Stores OS- and architecture-specific GRUB2 binaries (shim<__arch__>.efi, grub<__arch__>.efi) and symbolic links (boot.efi, boot-sb.efi).
Used for version-specific bootloader management within the bootloader_universe hierarchy.
| **Create manually**

| /var/lib/tftpboot/bootloader-universe/pxegrub2/<__distro__>/default/<__arch__>/
| Stores OS- and architecture-specific GRUB2 binaries (shim<__arch__>.efi, grub<__arch__>.efi) and symbolic links (boot.efi, boot-sb.efi).
Used as a fallback directory when a specific version is not available.
| **Create manually**

| /var/lib/tftpboot/host-config/<__My_MAC_Address__>/grub2/
| Host-specific directory automatically created when a host enters *Build mode*.
Contains symbolic links (boot.efi, boot-sb.efi) and a generated grub.cfg.
| *Auto-created by {SmartProxy}*
|===

Example structure:

----
# tree /var/lib/tftpboot/bootloader-universe/
/var/lib/tftpboot/bootloader-universe/
 ├── pxegrub2/
 │    ├── rocky/9.5/x86_64/
 │    │    ├── shimx64.efi
 │    │    ├── grubx64.efi
 │    │    ├── boot.efi -> grubx64.efi
 │    │    └── boot-sb.efi -> shimx64.efi
 │    └── ubuntu/22.04/x86_64/
 │         ├── shimx64.efi
 │         ├── grubx64.efi
 │         ├── boot.efi -> grubx64.efi
 │         └── boot-sb.efi -> shimx64.efi
 └── host-config/
      └── 52-54-00-ab-cd-ef/
           └── grub2/
                ├── boot.efi -> ../../../bootloader-universe/pxegrub2/rocky/9.5/x86_64/boot.efi
                ├── boot-sb.efi -> ../../../bootloader-universe/pxegrub2/rocky/9.5/x86_64/boot-sb.efi
                ├── grub.cfg
                ├── shimx64.efi -> ../../../bootloader-universe/pxegrub2/rocky/9.5/x86_64/shimx64.efi
                └── grubx64.efi -> ../../../bootloader-universe/pxegrub2/rocky/9.5/x86_64/grubx64.efi
----

[NOTE]
====
* In `bootloader-universe/pxegrub2/<__distro__>/<__version__>/<__arch__>/`,
`boot.efi` and `boot-sb.efi` are symbolic links to `grub<__arch__>.efi` and `shim<__arch__>.efi`, respectively.
The {SmartProxy} automatically creates host-specific links to these files under `host-config/<__My_MAC_Address__>/grub2/`.

* In the {ProjectWebUI}, OS and distribution identifiers (`<__distro__>`) must not contain spaces.
====

[IMPORTANT]
====
You must manually create `boot.efi` and `boot-sb.efi` symbolic links within each `<__arch__>` directory.

Example (x86_64):
[subs="+quotes"]
----
$ ln -s grubx64.efi boot.efi
$ ln -s shimx64.efi boot-sb.efi
$ chmod 644 grubx64.efi shimx64.efi
----

The `chmod` command ensures that TFTP and HTTPBoot clients can read these files.
====

== Legacy Layout (Non-bootloader_universe)

This section explains how bootloaders are handled when the `bootloader_universe` directory is not used.
This layout remains supported for backward compatibility.

If the `/var/lib/tftpboot/bootloader-universe/pxegrub2/` structure is not used,
{Project} falls back to the legacy `/var/lib/tftpboot/grub2/` directory.
Bootloaders are stored in a flat layout, but when a host enters *Build mode*, the {SmartProxy} creates a host-specific directory with the required configuration files and links.

=== File Locations and Roles

. File Locations and Roles

[cols="1,1,1", options="header"]
|===
| Path
| Purpose / Usage
| User Action

| /var/lib/tftpboot/grub2/
| Default directory used when bootloader_universe is not enabled.  
Contains GRUB2 UEFI bootloader binaries such as grubx64.efi, shimx64.efi, grubaa64.efi, and shimaa64.efi.
| Place the appropriate bootloader binaries (grub<__arch__>.efi, shim<__arch__>.efi) in this directory.
No subdirectory creation is required.

| /var/lib/tftpboot/host-config/<__My_MAC_Address__>/grub2/
| Host-specific directory automatically created when a host enters *Build mode*.
Contains symbolic links (boot.efi, boot-sb.efi) and a generated grub.cfg.
| *Auto-created by {SmartProxy}*
|===

Example (x86_64):

----
/var/lib/tftpboot/grub2/
 ├── grubx64.efi
 └── shimx64.efi
----

When a host enters *Build mode*, the {SmartProxy} creates the following directory structure:

----
# tree /var/lib/tftpboot/
/var/lib/tftpboot/
 └── host-config/
      └── 52-54-00-ab-cd-ef/
           └── grub2/
                ├── boot.efi -> ../../../grub2/grubx64.efi
                ├── boot-sb.efi -> ../../../grub2/shimx64.efi
                ├── grub.cfg
                ├── grub.cfg-01-52-54-00-ab-cd-ef
                └── grub.cfg-52:54:00:ab:cd:ef
----

