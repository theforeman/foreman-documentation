:_mod-docs-content-type: REFERENCE

[id="ref_grub2-uefi-bootloaders_{context}"]
= Grub2 UEFI boot loader and the `bootloader-universe` structure

*PXEGrub2* GRUB-based PXE boot loader supports BIOS and UEFI environments, as well as Secure Boot environments.
The `bootloader-universe` directory structure organizes Grub2 binaries by OS and architecture.

PXEGrub2 is managed by the {SmartProxy}’s TFTP service, which provides PXE clients with the appropriate boot loader binaries and configuration files.

By using the `bootloader-universe` directory structure, Grub2-based UEFI boot loaders can be organized and managed by distribution, version, and architecture.
This feature does not require explicit configuration.
It is automatically enabled when the {SmartProxy} uses the
`/var/lib/tftpboot/bootloader-universe/pxegrub2/` directory structure.

== Directory structure: `bootloader-universe`

The `bootloader-universe` directory enables multiple OS versions and architectures to coexist without conflicts.

When the {SmartProxy} recognizes the `/var/lib/tftpboot/bootloader-universe/pxegrub2/` structure,
boot loaders are stored in an organized hierarchy by OS, version, and architecture.

Before placing boot loader binaries (`shim__<My_Arch>__.efi`, `grub__<My_Arch>__.efi`), you must manually create the corresponding directory hierarchy by using the `mkdir` command, for example, `# mkdir -p /var/lib/tftpboot/bootloader-universe/pxegrub2/__<My_Distribution>__/__<My_Version>__/__<My_Arch>__`

.Default `bootloader universe` files
[cols="1,2,1", options="header"]
|===
| Path
| Purpose / Usage
| User Action

| `/var/lib/tftpboot/bootloader-universe/pxegrub2/__<My_Distribution>__/__<My_Version>__/__<My_Arch>__/`
| Stores OS- and architecture-specific Grub2 binaries (shim__<My_Arch>__.efi, grub__<My_Arch>__.efi) and symbolic links (boot.efi, boot-sb.efi).
Used for version-specific boot loader management within the `bootloader-universe` hierarchy.
| **Create manually**

| `/var/lib/tftpboot/bootloader-universe/pxegrub2/__<My_Distribution>__/default/__<My_Arch>__/`
| Stores OS- and architecture-specific Grub2 binaries (`shim__<My_Arch>__.efi`, `grub__<My_Arch>__.efi`) and symbolic links (`boot.efi`, `boot-sb.efi`).
Used as a fallback directory when a specific version is not available.
| **Create manually**

| `/var/lib/tftpboot/host-config/__<My_MAC_Address>__/grub2/`
| Host-specific directory automatically created when a host enters *Build mode*.
Contains symbolic links (`boot.efi`, `boot-sb.efi`) and a generated `grub.cfg`.
| *Auto-created by {SmartProxy}*
|===

.Model `bootloader-universe` directory layout
====
----
# tree /var/lib/tftpboot/bootloader-universe/
/var/lib/tftpboot/bootloader-universe/
 ├── pxegrub2/
 │    ├── __<My_Distribution>__/__<My_Version>__/__<My_Arch>__/
 │    │    ├── shimx64.efi
 │    │    ├── grubx64.efi
 │    │    ├── boot.efi -> grubx64.efi
 │    │    └── boot-sb.efi -> shimx64.efi
 │    └── ubuntu/22.04/__<My_Arch>__/
 │         ├── shimx64.efi
 │         ├── grubx64.efi
 │         ├── boot.efi -> grubx64.efi
 │         └── boot-sb.efi -> shimx64.efi
 └── host-config/
      └── 52-54-00-ab-cd-ef/
           └── grub2/
                ├── boot.efi -> ../../../bootloader-universe/pxegrub2/__<My_Distribution>__/__<My_Version>__/__<My_Arch>__/boot.efi
                ├── boot-sb.efi -> ../../../bootloader-universe/pxegrub2/__<My_Distribution>__/__<My_Version>__/__<My_Arch>__/boot-sb.efi
                ├── grub.cfg
                ├── shimx64.efi -> ../../../bootloader-universe/pxegrub2/__<My_Distribution>__/__<My_Version>__/__<My_Arch>__/shimx64.efi
                └── grubx64.efi -> ../../../bootloader-universe/pxegrub2/__<My_Distribution>__/__<My_Version>__/__<My_Arch>__/grubx64.efi
----

In this structure, the following principles apply:

* `boot.efi` and `boot-sb.efi` are symbolic links to `grub__<My_Arch>__.efi` and `shim__<My_Arch>__.efi`, respectively.
The {SmartProxy} automatically creates host-specific links to these files under `host-config/__<My_MAC_Address>__/grub2/`.

* In the {ProjectWebUI}, the `__<My_Distribution>__` OS and distribution identifiers  must not contain spaces.

* You must manually create `boot.efi` and `boot-sb.efi` symbolic links within each `__<My_Arch>__` directory, for example:
+
[subs="+quotes"]
----
$ ln -s grubx64.efi boot.efi
$ ln -s shimx64.efi boot-sb.efi
$ chmod 644 grubx64.efi shimx64.efi
----

The `chmod` command ensures that TFTP and HTTPBoot clients can read these files.
====

== Legacy layout

This layout remains supported for backward compatibility.

If the `/var/lib/tftpboot/bootloader-universe/pxegrub2/` structure is not used,
{Project} falls back to the legacy `/var/lib/tftpboot/grub2/` directory.
Boot loaders are stored in a flat layout, but when a host enters *Build mode*, the {SmartProxy} creates a host-specific directory with the required configuration files and links.

.Default legacy layout files
[cols="1,1,1", options="header"]
|===
| Path
| Purpose
| User action

| `/var/lib/tftpboot/grub2/`
| Default directory used when `bootloader-universe` is not enabled.
Contains Grub2 UEFI boot loader binaries such as `grubx64.efi`, `shimx64.efi`, `grubaa64.efi`, and `shimaa64.efi`.
| Place the appropriate boot loader binaries (`grub__<My_Arch>__.efi`, `shim__<My_Arch>__.efi`) in this directory.
No subdirectory creation is required.

| `/var/lib/tftpboot/host-config/__<My_MAC_Address>__/grub2/`
| Host-specific directory automatically created when a host enters *Build mode*.
Contains symbolic links (`boot.efi`, `boot-sb.efi`) and a generated `grub.cfg`.
| *Auto-created by {SmartProxy}*
|===

.Example `tftpboot/grub2/` structure:
====
----
/var/lib/tftpboot/grub2/
 ├── grubx64.efi
 └── shimx64.efi
----
====


When a host enters *Build mode*, the {SmartProxy} creates the following directory structure:
----
# tree /var/lib/tftpboot/
/var/lib/tftpboot/
 └── host-config/
      └── 52-54-00-ab-cd-ef/
           └── grub2/
                ├── boot.efi -> ../../../grub2/grubx64.efi
                ├── boot-sb.efi -> ../../../grub2/shimx64.efi
                ├── grub.cfg
                ├── grub.cfg-01-52-54-00-ab-cd-ef
                └── grub.cfg-52:54:00:ab:cd:ef
----
