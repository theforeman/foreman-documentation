[id="introduction-to-hammer"]
= Introduction to Hammer

Hammer is a powerful command-line tool provided with {ProjectNameX}.
You can use Hammer to configure and manage a {ProjectServer} either through CLI commands or automation in shell scripts.
Hammer also provides an interactive shell.

.Hammer compared to {ProjectWebUI}

Compared to navigating the {ProjectWebUI}, using Hammer can result in much faster interaction with the {ProjectServer}, as common shell features such as environment variables and aliases are at your disposal.
You can also incorporate Hammer commands into reusable scripts for automating tasks of various complexity.
Output from Hammer commands can be redirected to other tools, which allows for integration with your existing environment.
You can issue Hammer commands directly on the base operating system running {ProjectName}.

Access to base operating system on {ProjectServer} is required to issue Hammer commands, which can limit the number of potential users compared to the {ProjectWebUI}.
Although the parity between Hammer and the {ProjectWebUI} is almost complete, the {ProjectWebUI} has development priority and can be ahead especially for newly introduced features.

.Hammer compared to {Project} API

For many tasks, both Hammer and {Project} API are equally applicable.
Hammer can be used as a human friendly interface to {Project} API, for example to test responses to API calls before applying them in a script (use the `-d` option to inspect API calls issued by Hammer, for example `hammer -d organization list`).
Changes in the API are automatically reflected in Hammer, while scripts using the API directly have to be updated manually.

In the background, each Hammer command first establishes a binding to the API, then sends a request.
This can have performance implications when executing a large number of Hammer commands in sequence.
In contrast, a script communicating directly with the API establishes the binding only once.

ifdef::satellite[]
For more information, see the {APIDocURL}[_{APIDocTitle}_].
endif::[]

[[sect-CLI_Guide-Getting_Help]]
== Getting help

View the full list of `hammer` options and subcommands by executing:

[options="nowrap", subs="verbatim,quotes,attributes"]
----
$ hammer --help
----
Use `--help` to inspect any subcommand, for example:

[options="nowrap", subs="verbatim,quotes,attributes"]
----
$ hammer organization --help
----
You can search the help output using `grep`, or redirect it to a text viewer, for example:

[options="nowrap", subs="verbatim,quotes,attributes"]
----
$ hammer | less
----

[[sect-CLI_Guide-Authentication]]
== Authentication

A {Project} user must prove their identity to {ProjectName} when entering hammer commands.
Hammer commands can be run manually or automatically.
In either case, hammer requires {Project} credentials for authentication.
There are three methods of hammer authentication:

* Hammer authentication session
* Storing credentials in the hammer configuration file
* Providing credentials with each hammer command

The hammer configuration file method is recommended when running commands automatically.
For example, running {Project} maintenance commands from a cron job.
When running commands manually, {Team} recommends using the hammer authentication session and providing credentials with each command.

[[sect-CLI_Guide-Authentication-Hammer_Authentication_Session]]
=== Hammer authentication session

The hammer authentication session is a cache that stores your credentials, and you have to provide them only once, at the beginning of the session.
This method is suited to running several hammer commands in succession, for example a script containing hammer commands.
In this scenario, you enter your {Project} credentials once, and the script runs as expected.
By using the hammer authentication session, you avoid storing your credentials in the script itself and in the `~/.hammer/cli.modules.d/foreman.yml` hammer configuration file.

See the instructions on how to use the sessions:

* To enable sessions, add `:use_sessions: true` to the `~/.hammer/cli.modules.d/foreman.yml` file:
+
----
:foreman:
 :use_sessions: true
----
Note that if you enable sessions, credentials stored in the configuration file will be ignored.
+
* To start a session, enter the following command:
+
----
# hammer auth login
----
+
You are prompted for your {Project} credentials, and logged in.
You will not be prompted for the credentials again until your session expires.
+
* The default length of a session is 60 minutes.
You can change the time to suit your preference.
For example, to change it to 30 minutes, enter the following command:
+
----
# hammer settings set --name idle_timeout --value 30
Setting [idle_timeout] updated to [30]
----
+
* To see the current status of the session, enter the following command:
+
----
# hammer auth status
----
+
* To end the session, enter the following command:
+
----
# hammer auth logout
----

[[sect-CLI_Guide-Authentication-Hammer_Configuration_File]]
=== Hammer configuration file

If you ran the {Project} installation with `--foreman-initial-admin-username` and `--foreman-initial-admin-password` options, credentials you entered are stored in the `~/.hammer/cli.modules.d/foreman.yml` configuration file, and hammer does not prompt for your credentials.

You can also add your credentials to the `~/.hammer/cli.modules.d/foreman.yml` configuration file manually:

[options="nowrap", subs="+quotes,attributes"]
----
:foreman:
 :username: '_username_'
 :password: '_password_'
----

Use only spaces for indentation in hammer configuration files, do not use tabs.

[IMPORTANT]
====
If you change your credentials on {ProjectServer}, you must update the configuration file manually.
The installer does not overwrite the configuration file.
====

[[sect-CLI_Guide-Authentication-Command_Line]]
=== Command line

If you do not have your {Project} credentials saved in the `~/.hammer/cli.modules.d/foreman.yml` configuration file, hammer prompts you for them each time you enter a command.
You can specify your credentials when executing a command as follows:

[options="nowrap", subs="+quotes,attributes"]
----
$ hammer -u _username_ -p _password_ _subcommands_
----

[NOTE]
====
Examples in this guide assume that you have saved credentials in the configuration file, or are using a hammer authentication session.
====

[[sect-CLI_Guide-Standalone_Use_of_Hammer]]
== Using standalone Hammer

You can install Hammer on a host running {install-on-os} that has no {ProjectServer} installed, and use it to connect from the host to a remote {Project}.

.Prerequisites
ifdef::katello,orcharhino,satellite[]
* Ensure that you register the host to {ProjectServer} or {SmartProxyServer}.
For more information, see {ManagingHostsDocURL}Registering_Hosts_managing-hosts[Registering Hosts] in _{ManagingHostsDocTitle}_.
* Ensure that the following repositories are enabled and synchronized on {ProjectServer}:
ifdef::satellite[]
** {RepoRHEL8BaseOS}
** {RepoRHEL8AppStream}
** {RepoRHEL8ServerSatelliteUtils}
endif::[]
ifdef::katello,orcharhino[]
** {EL} 8 BaseOS
** {EL} 8 AppStream
endif::[]
ifdef::katello[]
** https://yum.theforeman.org/releases/{ProjectVersion}/el8/x86_64/foreman-release.rpm[{Project} release RPM]
endif::[]

+
For more information, see {ContentManagementDocURL}Synchronizing_Repositories_content-management[Synchronizing Repositories] in _{ContentManagementDocTitle}_.
endif::katello,orcharhino,satellite[]
ifndef::katello,orcharhino,satellite[]
* Ensure that the CA certificate of {ProjectServer} is deployed to the truststore on the host.
endif::[]

.Procedure
. Enable the required repositories on the host.
ifdef::katello,orcharhino,satellite[]
For more information, see {ManagingHostsDocURL}Enabling_Custom_Repositories_on_Content_Hosts_managing-hosts[Enabling repositories on hosts] in _{ManagingHostsDocTitle}_.
endif::[]
ifdef::foreman-el[]
+
[options="nowrap" subs="verbatim,quotes,attributes"]
----
# {client-package-install-el8} https://yum.theforeman.org/releases/{ProjectVersion}/el8/x86_64/foreman-release.rpm
----
endif::[]
ifdef::foreman-deb[]
+
:distribution-codename: My_Distribution_Codename
[options="nowrap" subs="verbatim,quotes,attributes"]
----
# wget https://deb.theforeman.org/foreman.asc -O /etc/apt/trusted.gpg.d/foreman.asc
# echo "deb http://deb.theforeman.org/ _{distribution-codename}_ {ProjectVersion}" | sudo tee /etc/apt/sources.list.d/foreman.list
# echo "deb http://deb.theforeman.org/ plugins {ProjectVersion}" | sudo tee -a /etc/apt/sources.list.d/foreman.list
----
endif::[]
ifndef::foreman-deb[]
. Enable the following module:
+
[options="nowrap" subs="verbatim,quotes,attributes"]
----
# dnf module enable {dnf-module-utils}
----
endif::[]
. Install Hammer CLI:
+
[options="nowrap" subs="verbatim,quotes,attributes"]
----
ifdef::foreman-deb[]
# {client-package-install-deb} {project-context}-cli
endif::[]
ifndef::foreman-deb[]
# {client-package-install-el8} {project-context}-cli
endif::[]
----
. Set the `:host:` entry in the `/etc/hammer/cli.modules.d/foreman.yml` file to the {Project} URL:
+
[options="nowrap", subs="+quotes,attributes"]
----
:host: 'https://_{foreman-example-com}_'
----

[[sect-CLI_Guide-Setting_a_Default_Organization]]
== Setting a default organization and location

Many `hammer` commands are organization specific.
You can set a default organization and location for `hammer` commands so that you do not have to specify them every time with the `--organization` and `--location` options.

Specifying a default organization is useful when you mostly manage a single organization, as it makes your commands shorter.
However, when you switch to a different organization, you must use `hammer` with the `--organization` option to specify it.

.Procedure
. Set a default organization:
+
[options="nowrap", subs="+quotes,attributes"]
----
# hammer defaults add --param-name organization \
--param-value _"Your_Organization"_
----
+
You can find the name of your organization with the `hammer organization list` command.
. Optional: Set a default location:
+
[options="nowrap", subs="+quotes,attributes"]
----
# hammer defaults add --param-name location \
--param-value _"Your_Location"_
----
+
You can find the name of your location with the `hammer location list` command.

.Verification
. Review the currently specified default settings:
+
[options="nowrap", subs="verbatim,quotes,attributes"]
----
# hammer defaults list
----

[[sect-CLI_Guide-Configuring_Hammer]]
== Configuring Hammer

The default location for global `hammer` configuration is:

* */etc/hammer/cli_config.yml* for general `hammer` settings

* */etc/hammer/cli.modules.d/* for CLI module configuration files

You can set user specific directives for `hammer` (in *~/.hammer/cli_config.yml*) as well as for CLI modules (in respective *.yml* files under *~/.hammer/cli.modules.d/*).

To see the order in which configuration files are loaded, as well as versions of loaded modules, use:

[options="nowrap", subs="verbatim,quotes,attributes"]
----
$ hammer -d --version
----

[NOTE]
====
Loading configuration for many CLI modules can slow down the execution of `hammer` commands.
In such a case, consider disabling CLI modules that are not regularly used.
====
Apart from saving credentials as described in xref:sect-CLI_Guide-Authentication[], you can set several other options in the *~/.hammer/* configuration directory.
For example, you can change the default log level and set log rotation with the following directives in *~/.hammer/cli_config.yml*.
These directives affect only the current user and are not applied globally.

[options="nowrap", subs="verbatim,quotes,attributes"]
----
:log_level: 'warning'
:log_size: 5 #in MB
----

Similarly, you can configure user interface settings.
For example, set the number of entries displayed per request in the Hammer output by changing the following line:

----
:per_page: 30
----

This setting is an equivalent of the `--per-page` Hammer option.

include::proc_increasing-the-logging-level-for-hammer.adoc[]


[[sect-CLI_Guide-Invoking_the_Hammer_Shell]]
== Using the Hammer shell

You can issue `hammer` commands through an interactive shell.
To start the shell, run the following command:

[options="nowrap", subs="verbatim,quotes,attributes"]
----
$ hammer shell
----
In the shell, you can enter sub-commands directly without typing "hammer", which can be useful for testing commands before using them in a script.
To exit the shell, type `exit` or press *Ctrl* + *D*.

[[sect-CLI_Guide-Generating_Formatted_Output]]
== Generating formatted output

You can modify the default formatting of the output of `hammer` commands to simplify the processing of this output by other command line tools and applications.
For example, to list organizations in a CSV format with a custom separator (in this case a semicolon), use the following command:

[options="nowrap", subs="verbatim,quotes,attributes"]
----
$ hammer --csv --csv-separator ";" organization list
----
Output in CSV format is useful for example when you need to parse IDs and use them in a *for* loop.

Several other formatting options are available with the `--output` option:

[options="nowrap", subs="+quotes,attributes"]
----
$ hammer --output _output_format_ organization list
----
Replace _output_format_ with one of:


* `table` {endash} generates output in the form of a human readable table (default).

* `base` {endash} generates output in the form of key-value pairs.

* `yaml` {endash} generates output in the YAML format.

* `csv` {endash} generates output in the Comma Separated Values format.
To define a custom separator, use the `--csv` and `--csv-separator` options instead.

* `json` {endash} generates output in the JavaScript Object Notation format.

* `silent` {endash} suppresses the output.

[[sect-CLI_Guide-Hiding_Header_Output]]
== Hiding header output from Hammer commands

When you use any hammer command, you have the option of hiding headers from the output.
If you want to pipe or use the output in custom scripts, hiding the output is useful.

* To hide the header output, add the `--no-headers` option to any hammer command.

[[sect-CLI_Guide-Using-JSON_Complex_Parameters]]
== Using JSON for complex parameters

JSON is the preferred way to describe complex parameters.

An example of JSON formatted content appears below:

[options="nowrap", subs="verbatim,quotes,attributes"]
----
# hammer compute-profile values create --compute-profile-id 22 --compute-resource-id 1 --compute-attributes=
'{
"cpus": 2,
"corespersocket": 2,
"memory_mb": 4096,
"firmware": "efi",
"resource_pool": "Resources",
"cluster": "Example_Cluster",
"guest_id": "rhel8",
"path": "/Datacenters/EXAMPLE/vm/",
"hardware_version": "Default",
"memoryHotAddEnabled": 0,
"cpuHotAddEnabled": 0,
"add_cdrom": 0,
"boot_order": [
               "disk",
               "network"
              ],
"scsi_controllers":[
      {
       "type":  "ParaVirtualSCSIController",
       "key":1000
       },
      {
        "type":  "ParaVirtualSCSIController",
        "key":1001
       }
                   ]
}'
----

[[sect-CLI_Guide-Troubleshooting_with_Hammer]]
== Troubleshooting with Hammer

You can use the `hammer ping` command to check the status of core {Project} services.
Together with the `{foreman-maintain} service status` command, this can help you to diagnose and troubleshoot {Project} issues.
If all services are running as expected, the output looks as follows:

[options="nowrap", subs="verbatim,quotes,attributes"]
----
$ hammer ping
candlepin:
    Status:          ok
    Server Response: Duration: 22ms
candlepin_auth:
    Status:          ok
    Server Response: Duration: 17ms
pulp:
    Status:          ok
    Server Response: Duration: 41ms
pulp_auth:
    Status:          ok
    Server Response: Duration: 23ms
foreman_tasks:
    Status:          ok
    Server Response: Duration: 33ms

----
