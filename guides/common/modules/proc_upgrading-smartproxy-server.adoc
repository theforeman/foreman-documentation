[id="upgrading_{smart-proxy-context}_server_{context}"]
= Upgrading {SmartProxyServers}

ifdef::satellite[]
After you have upgraded your {ProjectServer} and synchronized the required repositories, you can start upgrading your {SmartProxyServers}.
endif::[]
ifndef::satellite[]
After you have upgraded your {ProjectServer}, you can start upgrading your {SmartProxyServers}.
endif::[]

.Prerequisites
* The base system of the {SmartProxy} is registered to the newly upgraded {ProjectServer}.
ifdef::katello,orcharhino,satellite[]
ifndef::satellite[]
* If you use content views to control updates to the base operating system of {SmartProxyServer}, ensure these content views are up-to-date with the new repositories.
endif::[]
ifndef::katello,orcharhino[]
* If you use content views to control updates to the base operating system of {SmartProxyServer}, ensure these content views are up-to-date with the new repositories
synchronized in xref:synchronizing_the_new_repositories_{context}[].
endif::[]
This involves updating the content views and publishing and promoting the updated versions of the content views.
For more information, see {ContentManagementDocURL}Managing_Content_Views_content-management[Managing content views] in _{ContentManagementDocTitle}_.
endif::[]

.Procedure
. Create a backup of your {SmartProxyServer}.
* If your {SmartProxyServer} runs on a virtual machine:
.. Stop all {Project} services:
+
[options="nowrap" subs="+quotes,verbatim,attributes"]
----
# {foreman-maintain} service stop
----
.. Take a snapshot.
.. Start all {Project} services:
+
[options="nowrap" subs="+quotes,verbatim,attributes"]
----
# {foreman-maintain} service start
----
* If your {SmartProxyServer} runs on a physical machine, create a backup as described in {AdministeringDocURL}[Backing up {ProjectServer} and {SmartProxyServer}] in _{AdministeringDocTitle}_.
ifdef::foreman-el,katello[]
. Update repositories:
+
[options="nowrap" subs="attributes"]
----
ifdef::katello[]
# {project-package-update} https://yum.theforeman.org/releases/{ProjectVersion}/el9/x86_64/foreman-release.rpm \
https://yum.theforeman.org/katello/{KatelloVersion}/katello/el9/x86_64/katello-repos-latest.rpm
endif::[]
ifdef::foreman-el[]
# {project-package-update} https://yum.theforeman.org/releases/{ProjectVersion}/el9/x86_64/foreman-release.rpm
endif::[]
----
. Stop {Project} services:
+
[options="nowrap" subs="attributes"]
----
# {foreman-maintain} service stop
----
. Update the required packages:
+
[options="nowrap" subs="attributes"]
----
# {project-package-update}
----
. Run the {Project} installer:
+
[options="nowrap" subs="attributes"]
----
# {foreman-installer}
----
endif::[]
ifdef::satellite[]
. Delete cached repository metadata:
+
[options="nowrap" subs="attributes"]
----
# yum clean metadata
----
. Upgrade the `{foreman-maintain}` utility on the {SmartProxyServer} to its latest version:
+
[options="nowrap" subs="attributes"]
----
# {foreman-maintain} self-upgrade
----
. Verify that the `/etc/foreman-proxy/settings.yml` file on the {SmartProxyServer} points to the fully qualified domain name (FQDN) of your {ProjectServer}:
+
[options="nowrap" subs="attributes"]
----
# grep foreman_url /etc/foreman-proxy/settings.yml
----
. Determine whether {SmartProxyServer} is ready for the upgrade:
+
[options="nowrap" subs="attributes"]
----
# {foreman-maintain} upgrade check
----
+
Review the results and address any highlighted error conditions before performing the upgrade.
. Run the {Project} upgrade command.
Because of the lengthy upgrade time, consider using a utility such as `tmux`.
ifdef::upgrading-connected[]
For more information, see xref:following_the_progress_of_the_upgrade_upgrading-connected[].
endif::[]
ifdef::upgrading-disconnected[]
For more information, see xref:following_the_progress_of_the_upgrade_upgrading-disconnected[].
endif::[]
+
[options="nowrap" subs="attributes"]
----
# {foreman-maintain} upgrade run
----
endif::[]
include::snip_steps-needs-reboot.adoc[]

.Upgrading {SmartProxyServers} using remote execution
. Create a backup or take a snapshot.
+
For more information on backups, see {AdministeringDocURL}backing-up-satellite-server-and-capsule-server[Backing Up {ProjectServer} and {SmartProxyServer}] in _{AdministeringDocTitle}_.
. In the {ProjectWebUI}, navigate to *Monitor* > *Jobs*.
. Click *Run Job*.
. From the *Job category* list, select *Maintenance Operations*.
. From the *Job template* list, select *{SmartProxy} Upgrade Playbook*.
. In the *Search Query* field, enter the host name of the {SmartProxy}.
. Ensure that *Apply to 1 host* is displayed in the *Resolves to* field.
. In the *target_version* field, enter the target version of the {SmartProxy}.
. In the *whitelist_options* field, enter the options.
. Select the schedule for the job execution in *Schedule*.
. In the *Type of query* section, click *Static Query*.
