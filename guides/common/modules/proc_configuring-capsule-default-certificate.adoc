[id="configuring-capsule-default-certificate_{context}"]

= Configuring Capsule Server with a Default SSL Certificate

Use this section to configure Capsule Server with an SSL certificate that is signed by the Satellite Server default Certificate Authority (CA).

.Prerequisites

Before configuring Capsule Server with a default server certificate, ensure that your Capsule Server meets the following conditions:

* Capsule{nbsp}Server is registered to Satellite{nbsp}Server. For more information, see xref:registering-to-satellite-server_capsule[].
* The Capsule{nbsp}Server packages are installed. For more information, see xref:installing-capsule-server-packages_capsule[].

.Procedure

To configure Capsule Server with a default server certificate, complete the following steps:

. On Satellite{nbsp}Server, to store all the source certificate files for your Capsule Server, create a directory that is accessible only to the `root` user, for example `/root/capsule_cert`:
+
[options="nowrap", subs="+quotes"]
----
# mkdir /root/capsule_cert
----

. On Satellite Server, generate the `_/root/capsule_cert/capsule_certs.tar_` certificate archive for your Capsule{nbsp}Server:
+
[options="nowrap" subs="+quotes"]
----
# capsule-certs-generate \
--foreman-proxy-fqdn _capsule.example.com_ \
--certs-tar _/root/capsule_cert/capsule_certs.tar_
----
+
Retain a copy of the `satellite-installer` command that the `capsule-certs-generate` command returns for deploying the certificate to your Capsule{nbsp}Server.

. On Satellite{nbsp}Server, copy the certificate archive file to your Capsule{nbsp}Server:
+
[options="nowrap", subs="+quotes"]
----
# scp /root/_capsule.example.com_-certs.tar
root@_capsule.example.com_:/root/_capsule.example.com_-certs.tar
----

. On Capsule{nbsp}Server, to deploy the certificate, enter the `satellite-installer` command that the `capsule-certs-generate` command returns.
+
When network connections or ports to Satellite are not yet open, you can set the `--foreman-proxy-register-in-foreman` option to `false` to prevent Capsule from attempting to connect to Satellite and reporting errors. Run the installer again with this option set to `true` when the network and firewalls are correctly configured.
+
IMPORTANT: Do not delete the certificate archive file after you deploy the certificate. It is required, for example, when upgrading Capsule Server.
