:_mod-docs-content-type: PROCEDURE

[id="adding-kubevirt-connection_{context}"]
= Adding {a-KubeVirt} connection to {ProjectServer}

[role="_abstract"]
To provision and manage virtual machines on {Kubernetes}, add {KubeVirt} as a compute resource to {Project}.

.Prerequisites
* You have the `{kubevirt-command}` command-line utility installed.

.Procedure
. Enter the following `{foreman-installer}` command to enable the {KubeVirt} plugin for {Project}:
+
[options="nowrap" subs="+quotes,attributes"]
----
# {foreman-installer} --enable-foreman-plugin-kubevirt
----
. Obtain a token to use for HTTP and HTTPs authentication:
.. Create a service account:
+
[options="nowrap" subs="+quotes,attributes"]
----
$ {kubevirt-command} create serviceaccount __My_Service_Account__ --namespace __My_Namespace__
----
.. Add roles to the service account:
+
[options="nowrap" subs="+quotes,attributes"]
----
$ {kubevirt-command} policy add-role-to-user admin system:serviceaccount:__My_Namespace__:__My_Service_Account__
----
.. Create a persistent token for the account:
+
[options="nowrap" subs="+quotes,attributes"]
----
$ {kubevirt-command} create --filename= - <<EOF
apiVersion: v1
kind: Secret
metadata:
  name: __My_SA_Token__
  annotations:
    kubernetes.io/service-account.name: __My_Service_Account__
type: kubernetes.io/service-account-token
EOF
----
.. Record the token to use later in this procedure.
+
[options="nowrap" subs="+quotes,attributes"]
----
$ {kubevirt-command} get secrets __My_SA_Token__ --template='{{.data.token | base64decode}}'
----
. In the {ProjectWebUI}, navigate to *Infrastructure* > *Compute Resources*, and click *Create Compute Resource*.
. In the *Name* field, enter a name for the new compute resource.
. From the *Provider* list, select *{KubeVirt}*.
. In the *Description* field, enter a description for the compute resource.
. In the *Hostname* field, enter the FQDN, hostname, or IP address of the {Kubernetes} cluster.
. In the *API Port* field, enter the port number that you want to use for provisioning requests from {Project} to {KubeVirt}.
. In the *Namespace* field, enter the namespace of the {Kubernetes} cluster.
. In the *Token* field, enter the token you recorded.
. Optional: In the *X509 Certification Authorities* field, enter a certificate to enable client certificate authentication for API server calls.

.Additional resources
ifdef::satellite[]
* link:https://docs.redhat.com/en/documentation/openshift_container_platform/latest/html/cli_tools/openshift-cli-oc[OpenShift CLI (oc)]
endif::[]
ifndef::satellite[]
* link:https://kubernetes.io/docs/reference/kubectl/[Command line tool (kubectl) in _Kubernetes Documentation_]
endif::[]