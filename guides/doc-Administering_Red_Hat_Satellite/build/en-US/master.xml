<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE book [
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % DOCBOOK_ENTS PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/dbcentx.mod">
%DOCBOOK_ENTS;
]>
<?asciidoc-toc?><?asciidoc-numbered?><book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
<info>
<title>Administering {ProjectName}</title><subtitle>A guide to administering Red Hat Satellite.</subtitle>

<date>published {date_my}</date>
<productname>Red Hat Satellite</productname>
<productnumber>6.9 Beta</productnumber>
<abstract>

    <para>This guide provides instructions on how to configure and administer a Red Hat Satellite 6 Server. Before continuing with this workflow you must have successfully installed a Red Hat Satellite 6 Server and any required Capsule Servers.</para>

</abstract>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="Author_Group.xml"/>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="Common_Content/Legal_Notice.xml"/>
</info>
<chapter xml:id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Accessing_Red_Hat_Satellite">
<title>Accessing {ProjectName}</title>
<simpara>After {ProjectName} has been installed and configured, use the web user interface to log in to {Project} for further configuration.</simpara>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Installing_the_Katello_Root_CA_Certificate">
<title>Installing the Katello Root CA Certificate</title>
<simpara>The first time you log on to {Project}, you might see a warning informing you that you are using the default self-signed certificate and you might not be able to connect this browser to {Project} until the root CA certificate is installed in the browser.
Use the following procedure to locate the root CA certificate on {Project} and to install it in your browser.</simpara>
<formalpara>
<title>Prerequisites</title>
<para>Your {ProjectName} is installed and configured.</para>
</formalpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Identify the fully qualified domain name of your {ProjectServer}:</simpara>
<screen># hostname -f</screen>
</listitem>
<listitem>
<simpara>Access the <literal>pub</literal> directory on your {ProjectServer} using a web browser pointed to the fully qualified domain name:</simpara>
<screen>https://<emphasis>{foreman-example-com}</emphasis>/pub</screen>
</listitem>
<listitem>
<simpara>When you access {Project} for the first time, an untrusted connection warning displays in your web browser.
Accept the self-signed certificate and add the {Project} URL as a security exception to override the settings.
This procedure might differ depending on the browser being used.
Ensure that the {Project} URL is valid before you accept the security exception.</simpara>
</listitem>
<listitem>
<simpara>Select <literal>katello-server-ca.crt</literal>.</simpara>
</listitem>
<listitem>
<simpara>Import the certificate into your browser as a certificate authority and trust it to identify websites.</simpara>
</listitem>
</orderedlist>
<formalpara>
<title>Importing the Katello Root CA Certificate Manually</title>
<para>If you cannot add a security exception in your browser, import the Katello root CA certificate manually.</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>From the {Project} CLI, copy the <literal>katello-server-ca.crt</literal> file to the machine you use to access the web UI:</simpara>
<screen># scp /var/www/html/pub/katello-server-ca.crt \
<emphasis>username@hostname:remotefile</emphasis></screen>
</listitem>
<listitem>
<simpara>In the browser, import the <literal>katello-server-ca.crt</literal> certificate as a certificate authority and trust it to identify websites.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Logging_on_to_Satellite">
<title>Logging on to {Project}</title>
<simpara>Use the web user interface to log on to {Project} for further configuration.</simpara>
<formalpara>
<title>Prerequisites</title>
<para>Ensure that the Katello root CA certificate is installed in your browser.
For more information, see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Installing_the_Katello_Root_CA_Certificate"/>.</para>
</formalpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Access the {ProjectServer} using a web browser pointed to the fully qualified domain name:</simpara>
<screen>https://<emphasis>{foreman-example-com}</emphasis>/</screen>
</listitem>
<listitem>
<simpara>Enter the user name and password created during the configuration process.
If a user was not created during the configuration process, the default user name is <emphasis>admin</emphasis>.
If you have problems logging on, you can reset the password.
For more information, see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Resetting_the_Administrative_User_Password"/>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="form-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Navigation_Tabs_in_the_Satellite_Web_UI">
<title>Navigation Tabs in the {Project} Web UI</title>
<simpara>Use the navigation tabs to browse the {Project} web UI.</simpara>
<table xml:id="tabl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Logging_in_to_Red_Hat_Satellite-Navigation_Tabs" frame="all" rowsep="1" colsep="1">
<title>Navigation Tabs</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="22*"/>
<colspec colname="col_2" colwidth="78*"/>
<thead>
<row>
<entry align="left" valign="top">Navigation Tabs</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Any Context</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Clicking this tab changes the organization and location.
If no organization or location is selected, the default organization is <emphasis>Any Organization</emphasis> and the default location is <emphasis>Any Location</emphasis>.
Use this tab to change to different values.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Monitor</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Provides summary dashboards and reports.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Content</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Provides content management tools.
This includes Content Views, Activation Keys, and Life Cycle Environments.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Provides host inventory and provisioning configuration tools.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Configure</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Provides general configuration tools and data including Host Groups and Puppet data.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Infrastructure</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Provides tools on configuring how {ProjectX} interacts with the environment.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Insights</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Provides Red Hat Insights management tools.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong"><emphasis>User Name</emphasis></emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Provides user administration where users can edit their personal information.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/notfications1.png"/>
</imageobject>
<textobject><phrase>notfications1</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara>Provides event notifications to keep administrators informed of important environment changes.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Administer</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Provides advanced configuration for settings such as Users and RBAC, as well as general settings.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Changing_the_Password">
<title>Changing the Password</title>
<simpara>These steps show how to change your password.</simpara>
<orderedlist xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Changing_the_Password-To_Change_your_Red_Hat_Satellite_Password" numeration="arabic">
<title>To Change your {ProjectName} Password:</title>
<listitem>
<simpara>Click your user name at the top right corner.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">My Account</emphasis> from the menu.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Current Password</emphasis> field, enter the current password.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Password</emphasis> field, enter a new password.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Verify</emphasis> field, enter the new password again.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Submit</emphasis> button to save your new password.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Resetting_the_Administrative_User_Password">
<title>Resetting the Administrative User Password</title>
<simpara>Use the following procedures to reset the administrative password to randomly generated characters or to set a new administrative password.</simpara>
<formalpara xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Resetting_the_Administrative_User_Password-To_Reset_the_Administrative_User_Password">
<title>To Reset the Administrative User Password:</title>
<para>To reset the password to randomly generated characters, complete the following procedure:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log on to the base operating system where {ProjectServer} is installed.</simpara>
</listitem>
<listitem>
<simpara>Enter the following command to reset the password:</simpara>
<screen># foreman-rake permissions:reset
Reset to user: admin, password: qwJxBptxb7Gfcjj5</screen>
</listitem>
<listitem>
<simpara>Use this password to reset the password in the {Project} web UI.</simpara>
</listitem>
<listitem>
<simpara>Edit the <literal>~/.hammer/cli.modules.d/foreman.yml</literal> file on {ProjectServer} to add the new password:</simpara>
<screen>#  vi ~/.hammer/cli.modules.d/foreman.yml</screen>
</listitem>
</orderedlist>
<simpara>Unless you update the <literal>~/.hammer/cli.modules.d/foreman.yml</literal> file, you cannot use the new password with Hammer CLI.</simpara>
<formalpara xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Resetting_the_Administrative_User_Password-To_Set_a_New_Administrative_User_Password">
<title>To Set a New Administrative User Password:</title>
<para>To change the administrative user password to a new password, complete the following steps:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log on to the base operating system where {ProjectServer} is installed.</simpara>
</listitem>
<listitem>
<simpara>To set the password, enter the following command:</simpara>
<screen># foreman-rake permissions:reset password=<emphasis>new_password</emphasis></screen>
</listitem>
<listitem>
<simpara>Edit the <literal>~/.hammer/cli.modules.d/foreman.yml</literal> file on {ProjectServer} to add the new password:</simpara>
<screen>#  vi ~/.hammer/cli.modules.d/foreman.yml</screen>
</listitem>
</orderedlist>
<simpara>Unless you update the <literal>~/.hammer/cli.modules.d/foreman.yml</literal> file, you cannot use the new password with Hammer CLI.</simpara>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Setting_a_Custom_Login_Message">
<title>Setting a Custom Message on the Login Page</title>
<orderedlist xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Setting_a_Custom_Login_Message-To_Set_a_Custom_Login_Message" numeration="arabic">
<title>To Set a Custom Message on the Login Page:</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Settings</emphasis>, and click the <emphasis role="strong">General</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click the edit button next to <emphasis role="strong">Login page footer text</emphasis>, and enter the desired text to be displayed on the login page.
For example, this text may be a warning message required by your company.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Log out of the {Project}'s web UI and verify that the custom text is now displayed on the login page below the {Project} version number.</simpara>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Starting_and_Stopping_Red_Hat_Satellite">
<title>Starting and Stopping {ProjectName}</title>
<simpara>{Project} provides the <literal>{foreman-maintain} service</literal> command to manage {Project} services from the command line.
This is useful when creating a backup of {Project}.
For more information on creating backups, see <xref linkend="backing-up-satellite-server-and-capsule-server"/>.</simpara>
<simpara>After installing {Project} with the <literal>{foreman-installer}</literal> command, all {Project} services are started and enabled automatically.
View the list of these services by executing:</simpara>
<screen># {foreman-maintain} service list</screen>
<simpara>To see the status of running services, execute:</simpara>
<screen># {foreman-maintain} service status</screen>
<simpara>To stop the <literal>{foreman-maintain}</literal> services, execute:</simpara>
<screen># {foreman-maintain} service stop</screen>
<simpara>To start the <literal>{foreman-maintain}</literal> services, execute:</simpara>
<screen># {foreman-maintain} service start</screen>
<simpara>To restart the <literal>{foreman-maintain}</literal> services, execute:</simpara>
<screen># {foreman-maintain} service restart</screen>
</chapter>
<chapter xml:id="migrating-from-internal-databases-to-external-databases_admin">
<title>Migrating from Internal {Project} Databases to External Databases</title>
<simpara>When you install {ProjectName}, the <emphasis role="strong">{foreman-installer}</emphasis> command installs PostgreSQL databases on the same server as {Project}.
If you are using the default internal databases but want to start using external databases to help with the server load, you can migrate your internal databases to external databases.</simpara>
<simpara>To confirm whether your {ProjectServer} has internal or external databases, you can query the status of your databases:</simpara>
<simpara>For PostgreSQL, enter the following command:</simpara>
<screen># {foreman-maintain} service status --only postgresql</screen>
<simpara>To migrate from the default internal databases to external databases, you must complete the following procedures:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><xref linkend="preparing-a-host-for-external-databases_admin"/>.
Prepare a {RHEL} 7 server to host the external databases.</simpara>
</listitem>
<listitem>
<simpara><xref linkend="installing-postgresql_admin"/>.
Prepare PostgreSQL with databases for {Project}, Pulp and Candlepin with dedicated users owning them.</simpara>
</listitem>
<listitem>
<simpara><xref linkend="migrating-to-external-databases_admin"/>.
Edit the parameters of <literal>{foreman-installer}</literal> to point to the new databases, and run <literal>{foreman-installer}</literal>.</simpara>
</listitem>
</orderedlist>
<section xml:id="postgresql-as-an-external-database-considerations_admin">
<title>PostgreSQL as an External Database Considerations</title>
<simpara>Foreman, Katello, and Candlepin use the PostgreSQL database.
If you want to use PostgreSQL as an external database, the following information can help you decide if this option is right for your {Project} configuration.
{Project} supports PostgreSQL version 12.1.</simpara>
<itemizedlist>
<title>Advantages of External PostgreSQL:</title>
<listitem>
<simpara>Increase in free memory and free CPU on {Project}</simpara>
</listitem>
<listitem>
<simpara>Flexibility to set <literal>shared_buffers</literal> on the PostgreSQL database to a high number without the risk of interfering with other services on {Project}</simpara>
</listitem>
<listitem>
<simpara>Flexibility to tune the PostgreSQL server’s system without adversely affecting {Project} operations</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Disadvantages of External PostgreSQL</title>
<listitem>
<simpara>Increase in deployment complexity that can make troubleshooting more difficult</simpara>
</listitem>
<listitem>
<simpara>The external PostgreSQL server is an additional system to patch and maintain</simpara>
</listitem>
<listitem>
<simpara>If either {Project} or the PostgreSQL database server suffers a hardware or storage failure, {Project} is not operational</simpara>
</listitem>
<listitem>
<simpara>If there is latency between the {Project} server and database server, performance can suffer</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="preparing-a-host-for-external-databases_admin">
<title>Preparing a Host for External Databases</title>
<simpara>Install a freshly provisioned system with the latest {RHEL} 7 server to host the external databases.</simpara>
<simpara>Subscriptions for Red Hat Software Collections and {RHEL} do not provide the correct service level agreement for using {Project} with external databases.
You must also attach a {Project} subscription to the base operating system that you want to use for the external databases.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>The {RHEL} 7 server must meet {Project}'s {InstallingProjectDocURL}storage-requirements_{project-context}[Storage Requirements].</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Use the instructions in {InstallingProjectDocURL}attaching-satellite-infrastructure-subscription_{project-context}[Attaching the {Project} Infrastructure Subscription] to attach a {Project} subscription to your server.</simpara>
</listitem>
<listitem>
<simpara>Disable all repositories and enable only the following repositories:</simpara>
<screen># subscription-manager repos --disable '*'
# subscription-manager repos --enable=rhel-server-rhscl-7-rpms \
--enable=rhel-7-server-rpms</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="installing-postgresql_admin">
<title>Installing PostgreSQL</title>
<simpara>You can install only the same version of PostgreSQL that is installed with the <literal>{foreman-installer}</literal> tool during an internal database installation.
You can install PostgreSQL using Red Hat Enterprise Linux Server 7 repositories or from an external source, as long as the version is supported.
{Project} supports PostgreSQL version 12.1.</simpara>
<simpara>If you do not use <literal>firewall-cmd</literal> to configure the Linux firewall, implement using the command of your choice.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>To install PostgreSQL, enter the following command:</simpara>
<screen># yum install rh-postgresql12-postgresql-server \
rh-postgresql12-syspaths \
rh-postgresql12-postgresql-evr</screen>
</listitem>
<listitem>
<simpara>To initialize PostgreSQL, enter the following command:</simpara>
<screen># postgresql-setup initdb</screen>
</listitem>
<listitem>
<simpara>Edit the <literal>/var/opt/rh/rh-postgresql12/lib/pgsql/data/postgresql.conf</literal> file:</simpara>
<screen># vi /var/opt/rh/rh-postgresql12/lib/pgsql/data/postgresql.conf</screen>
</listitem>
<listitem>
<simpara>Remove the <literal>#</literal> and edit to listen to inbound connections:</simpara>
<screen>listen_addresses = '*'</screen>
</listitem>
<listitem>
<simpara>Edit the <literal>/var/opt/rh/rh-postgresql12/lib/pgsql/data/pg_hba.conf</literal> file:</simpara>
<screen># vi /var/opt/rh/rh-postgresql12/lib/pgsql/data/pg_hba.conf</screen>
</listitem>
<listitem>
<simpara>Add the following line to the file:</simpara>
<screen>  host  all   all   <emphasis>{Project}_ip</emphasis>/24   md5</screen>
</listitem>
<listitem>
<simpara>To start, and enable PostgreSQL service, enter the following commands:</simpara>
<screen># systemctl start postgresql
# systemctl enable postgresql</screen>
</listitem>
<listitem>
<simpara>Open the <emphasis role="strong">postgresql</emphasis> port on the external PostgreSQL server:</simpara>
<screen># firewall-cmd --add-service=postgresql
# firewall-cmd --runtime-to-permanent</screen>
</listitem>
<listitem>
<simpara>Switch to the <literal>postgres</literal> user and start the PostgreSQL client:</simpara>
<screen>$ su - postgres -c psql</screen>
</listitem>
<listitem>
<simpara>Create two databases and dedicated roles, one for {Project} and one for Candlepin:</simpara>
<screen>CREATE USER "foreman" WITH PASSWORD '<emphasis>Foreman_Password</emphasis>';
CREATE USER "candlepin" WITH PASSWORD '<emphasis>Candlepin_Password</emphasis>';
CREATE DATABASE foreman OWNER foreman;
CREATE DATABASE candlepin OWNER candlepin;</screen>
</listitem>
<listitem>
<simpara>Exit the <literal>postgres</literal> user:</simpara>
<screen># \q</screen>
</listitem>
<listitem>
<simpara>From {ProjectServer}, test that you can access the database.
If the connection succeeds, the commands return <literal>1</literal>.</simpara>
<screen># PGPASSWORD='<emphasis>Foreman_Password</emphasis>' psql -h <emphasis>postgres.example.com</emphasis>  -p 5432 -U foreman -d foreman -c "SELECT 1 as ping"
# PGPASSWORD='<emphasis>Candlepin_Password</emphasis>' psql -h <emphasis>postgres.example.com</emphasis> -p 5432 -U candlepin -d candlepin -c "SELECT 1 as ping"</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="migrating-to-external-databases_admin">
<title>Migrating to External Databases</title>
<simpara>Back up and transfer existing data, then use the <literal>{foreman-installer}</literal> command to configure {Project} to connect to an external PostgreSQL database server.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You have installed and configured a PostgreSQL server on a {RHEL} server.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On {ProjectServer}, stop the <literal>{foreman-maintain}</literal> services:</simpara>
<screen># {foreman-maintain} service stop</screen>
</listitem>
<listitem>
<simpara>Start the <emphasis role="strong">PostgreSQL</emphasis> services:</simpara>
<screen># systemctl start postgresql</screen>
</listitem>
<listitem>
<simpara>Back up the internal databases:</simpara>
<screen># {foreman-maintain} backup online --skip-pulp-content --preserve-directory -y <emphasis>/var/migration_backup</emphasis></screen>
</listitem>
<listitem>
<simpara>Transfer the data to the new external databases:</simpara>
<screen>PGPASSWORD='<emphasis>Foreman_Password</emphasis>' pg_restore -h <emphasis>postgres.example.com</emphasis> -U foreman -d foreman &lt; <emphasis>/var/migration_backup/foreman.dump</emphasis>
PGPASSWORD='<emphasis>Candlepin_Password</emphasis>' pg_restore -h <emphasis>postgres.example.com</emphasis> -U candlepin -d candlepin &lt; <emphasis>/var/migration_backup/candlepin.dump</emphasis>
PGPASSWORD='<emphasis>Pulpcore_Password</emphasis>' pg_restore -h <emphasis>postgres.example.com</emphasis> -U pulpcore -d pulpcore &lt; <emphasis>/var/migration_backup/pulpcore.dump</emphasis></screen>
</listitem>
<listitem>
<simpara>Use the <literal>{foreman-installer}</literal> command to update {Project} to point to the new databases:</simpara>
<screen>{installer-scenario} \
    --foreman-db-host <emphasis>postgres.example.com</emphasis> \
    --foreman-db-password <emphasis>Foreman_Password</emphasis> \
    --foreman-db-database foreman \
    --foreman-db-manage false \
    --katello-candlepin-db-host <emphasis>postgres.example.com</emphasis> \
    --katello-candlepin-db-name candlepin \
    --katello-candlepin-db-password <emphasis>Candlepin_Password</emphasis> \
    --katello-candlepin-manage-db false \
    --foreman-proxy-content-pulpcore-manage-postgresql false \
    --foreman-proxy-content-pulpcore-postgresql-host <emphasis>postgres.example.com</emphasis> \
    --foreman-proxy-content-pulpcore-postgresql-db-name pulpcore \
    --foreman-proxy-content-pulpcore-postgresql-password <emphasis>Pulpcore_Password</emphasis></screen>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="using-satellite-ansible-content-collections_admin">
<title>Managing {Project} with Ansible Collections</title>
<simpara>{Project} Ansible Collections is a set of Ansible modules that interact with the {Project} API.
You can use {Project} Ansible Collections to manage and automate many aspects of {Project}.</simpara>
<section xml:id="installing-satellite-ansible-modules-via-rpm_admin">
<title>Installing the {Project} Ansible Modules from RPM</title>
<simpara>Use this procedure to install the {Project} Ansible modules.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Install the RPM from the client repository on yum.theforeman.org using the following command:</simpara>
<screen># {package-install-project} ansible-collection-theforeman-foreman</screen>
</listitem>
</itemizedlist>
</section>
<section xml:id="listing-using-satellite-ansible-modules_admin">
<title>Viewing the {Project} Ansible Modules</title>
<simpara>Starting with Ansible 2.10, you can view the installed {Project} Ansible modules by running:</simpara>
<screen># ansible-doc -l {ansible-namespace}</screen>
<simpara>When using Ansible before 2.10, you can view the installed {Project} Ansible modules by listing the content of the following directory:</simpara>
<screen># ls {ansiblefilepath}</screen>
<simpara>Alternatively, you can also see the complete list of {Project} Ansible modules and other related information at {ansible-galaxy}.</simpara>
<simpara>All modules are in the {ansible-namespace} namespace and can be referred to in the format {ansible-namespace-example}.
For example, to display information about the <literal>activation_key</literal> module, enter the following command:</simpara>
<screen>$ {ansible-doc-activation_key}</screen>
</section>
</chapter>
<chapter xml:id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles">
<title>Managing Users and Roles</title>
<simpara>A User defines a set of details for individuals using the system.
Users can be associated with organizations and environments, so that when they create new entities, the default settings are automatically used.
Users can also have one or more <emphasis>roles</emphasis> attached, which grants them rights to view and manage organizations and environments.
See <xref linkend="user-management_admin"/> for more information on working with users.</simpara>
<simpara>You can manage permissions of several users at once by organizing them into user groups.
User groups themselves can be further grouped to create a hierarchy of permissions.
See <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Users_and_Roles-Creating_and_Managing_User_Groups"/> for more information on creating user groups.</simpara>
<simpara>Roles define a set of permissions and access levels.
Each role contains one on more <emphasis>permission filters</emphasis> that specify the actions allowed for the role.
Actions are grouped according to the <emphasis>Resource type</emphasis>.
Once a role has been created, users and user groups can be associated with that role.
This way, you can assign the same set of permissions to large groups of users.
{ProjectName} provides a set of predefined roles and also enables creating custom roles and permission filters as described in <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Users_and_Roles-Creating_and_Managing_Roles"/>.</simpara>
<section xml:id="user-management_admin">
<title>User Management</title>
<simpara>As an administrator, you can create, modify and remove {Project} users.
You can also configure access permissions for a user or a group of users by assigning them different <emphasis>roles</emphasis>.</simpara>
<section xml:id="creating-a-user_admin">
<title>Creating a User</title>
<simpara>Use this procedure to create a user.</simpara>
<formalpara>
<title>Procedure</title>
<para>To create a user, complete the following steps:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Users</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create User</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Login</emphasis> field, enter a username for the user.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Firstname</emphasis> and <emphasis role="strong">Lastname</emphasis> fields, enter the real first name and last name of the user.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Mail</emphasis> field, enter the user’s email address.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Description</emphasis> field, add a description of the new user.</simpara>
</listitem>
<listitem>
<simpara>Select a specific language for the user from the <emphasis role="strong">Language</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Select a timezone for the user from the <emphasis role="strong">Timezone</emphasis> list.</simpara>
<simpara>By default, {ProjectServer} uses the language and timezone settings of the user’s browser.</simpara>
</listitem>
<listitem>
<simpara>Set a password for the user:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>From the <emphasis role="strong">Authorized by</emphasis> list, select the source by which the user is authenticated.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">INTERNAL</emphasis>: to enable the user to be managed inside {ProjectServer}.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">EXTERNAL</emphasis>: to configure external authentication as described in <xref linkend="chap-{Project_Link}-Administering_{Project_Link}-Configuring_External_Authentication"/>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Enter an initial password for the user in the <emphasis role="strong">Password</emphasis> field and the <emphasis role="strong">Verify</emphasis> field.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis> to create the user.</simpara>
</listitem>
</orderedlist>
<formalpara>
<title>For CLI Users</title>
<para>To create a user, enter the following command:</para>
</formalpara>
<screen># hammer user create \
--login <emphasis>user_name</emphasis> \
--password <emphasis>user_password</emphasis> \
--mail <emphasis>user_mail</emphasis> \
--auth-source-id 1 \
--organization-ids <emphasis>org_ID1</emphasis>,<emphasis>org_ID2</emphasis>...</screen>
<simpara>The <literal>--auth-source-id 1</literal> setting means that the user is authenticated internally, you can specify an external authentication source as an alternative.
Add the <literal>--admin</literal> option to grant administrator privileges to the user.
Specifying organization IDs is not required, you can modify the user details later using the <literal>update</literal> subcommand.</simpara>
<simpara>For more information about user related subcommands, enter <literal>hammer user --help</literal>.</simpara>
</section>
<section xml:id="assigning-roles-to-a-user_admin">
<title>Assigning Roles to a User</title>
<simpara>Use this procedure to assign roles to a user.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Users</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">username</emphasis> of the user to be assigned one or more roles.</simpara>
<note>
<simpara>If a user account is not listed, check that you are currently viewing the correct organization.
To list all the users in {Project}, click <emphasis role="strong">Default Organization</emphasis> and then <emphasis role="strong">Any Organization</emphasis>.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Locations</emphasis> tab, and select a location if none is assigned.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Organizations</emphasis> tab, and check that an organization is assigned.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Roles</emphasis> tab to display the list of available roles.</simpara>
</listitem>
<listitem>
<simpara>Select the roles to assign from the <emphasis role="strong">Roles</emphasis> list.</simpara>
<simpara>To grant all the available permissions, select the <emphasis role="strong">Admin</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>To view the roles assigned to a user, click the <emphasis role="strong">Roles</emphasis> tab; the assigned roles are listed under <emphasis role="strong">Selected items</emphasis>.
To remove an assigned role, click the role name in <emphasis role="strong">Selected items</emphasis>.</simpara>
<formalpara>
<title>For CLI Users</title>
<para>To assign roles to a user, enter the following command:</para>
</formalpara>
<screen># hammer user add-role --id <emphasis>user_id</emphasis> --role <emphasis>role_name</emphasis></screen>
</section>
<section xml:id="impersonating-a-different-user-account_admin">
<title>Impersonating a Different User Account</title>
<simpara>Administrators can impersonate other authenticated users for testing and troubleshooting purposes by temporarily logging on to the {Project} web UI as a different user.
When impersonating another user, the administrator has permissions to access exactly what the impersonated user can access in the system, including the same menus.</simpara>
<simpara>Audits are created to record the actions that the administrator performs while impersonating another user.
However, all actions that an administrator performs while impersonating another user are recorded as having been performed by the impersonated user.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Ensure that you are logged on to the {Project} web UI as a user with administrator privileges for {Project}.</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>Procedure</title>
<para>To impersonate a different user account, complete the following steps:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Users</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>To the right of the user that you want to impersonate, from the list in the <emphasis role="strong">Actions</emphasis> column, select <emphasis role="strong">Impersonate</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>When you want to stop the impersonation session, in the upper right of the main menu, click the impersonation icon.</simpara>
</section>
<section xml:id="ssh-keys_admin">
<title>SSH Keys</title>
<simpara>Adding SSH keys to a user allows deployment of SSH keys during provisioning.</simpara>
<simpara>For information on deploying SSH keys during provisioning, see {ProvisioningDocURL}Configuring_Provisioning_Resources-Creating_Provisioning_Templates-Deploying_SSH_Keys_during_Provisioning[Deploying SSH Keys during Provisioning] in the <emphasis>Provisioning Guide</emphasis>.</simpara>
<simpara>For information on SSH keys and SSH key creation, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-getting_started#sec-SSH">Using SSH-based Authentication</link> in the <emphasis>Red Hat Enterprise Linux 7 System Administrator’s Guide</emphasis>.</simpara>
</section>
<section xml:id="managing-ssh-keys-for-a-user_admin">
<title>Managing SSH Keys for a User</title>
<simpara>Use this procedure to add or remove SSH keys for a user.</simpara>
<formalpara>
<title>Prerequisites</title>
<para>Make sure that you are logged in to the web UI as an Admin user of {ProjectName} or a user with the <emphasis>create_ssh_key</emphasis> permission enabled for adding SSH key and <emphasis>destroy_ssh_key</emphasis> permission for removing a key.</para>
</formalpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Users</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Username</emphasis> column, click on the username of the required user.</simpara>
</listitem>
<listitem>
<simpara>Click on the <emphasis role="strong">SSH Keys</emphasis> tab.</simpara>
<itemizedlist>
<listitem>
<simpara>To Add SSH key</simpara>
<orderedlist numeration="lowerroman">
<listitem>
<simpara>Prepare the content of the public SSH key in a clipboard.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add SSH Key</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Key</emphasis> field, paste the public SSH key content from the clipboard.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the SSH key.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>To Remove SSH key</simpara>
<orderedlist numeration="lowerroman">
<listitem>
<simpara>Click <emphasis role="strong">Delete</emphasis> on the row of the SSH key to be deleted.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">OK</emphasis> in the confirmation prompt.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<formalpara>
<title>For CLI Users</title>
<para>To add an SSH key to a user, you must specify either the path to the public SSH key file, or the content of the public SSH key copied to the clipboard.</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>If you have the public SSH key file, enter the following command:</simpara>
<screen># hammer user ssh-keys add \
--user-id <emphasis>user_id</emphasis> \
--name <emphasis>key_name</emphasis> \
--key-file <emphasis>~/.ssh/id_rsa.pub</emphasis></screen>
</listitem>
<listitem>
<simpara>If you have the content of the public SSH key, enter the following command:</simpara>
<screen># hammer user ssh-keys add \
--user-id <emphasis>user_id</emphasis> \
--name <emphasis>key_name</emphasis> \
--key <emphasis>ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNtYAAABBBHHS2KmNyIYa27Qaa7EHp+2l99ucGStx4P77e03ZvE3yVRJEFikpoP3MJtYYfIe8k 1/46MTIZo9CPTX4CYUHeN8= host@user</emphasis></screen>
</listitem>
</itemizedlist>
<simpara>To delete an SSH key from a user, enter the following command:</simpara>
<screen># hammer user ssh-keys delete --id <emphasis>key_id</emphasis> --user-id <emphasis>user_id</emphasis></screen>
<simpara>To view an SSH key attached to a user, enter the following command:</simpara>
<screen># hammer user ssh-keys info --id <emphasis>key_id</emphasis> --user-id <emphasis>user_id</emphasis></screen>
<simpara>To list SSH keys attached to a user, enter the following command:</simpara>
<screen># hammer user ssh-keys list --user-id <emphasis>user_id</emphasis></screen>
</section>
<section xml:id="email-notifications_admin">
<title>Email Notifications</title>
<simpara>Email notifications are created by {ProjectServer} periodically or after completion of certain events.
The periodic notifications can be sent daily, weekly or monthly.</simpara>
<simpara>The events that trigger a notification are the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Host build</simpara>
</listitem>
<listitem>
<simpara>Content View promotion</simpara>
</listitem>
<listitem>
<simpara>Error reported by host</simpara>
</listitem>
<listitem>
<simpara>Repository sync</simpara>
</listitem>
</itemizedlist>
<simpara>Users do not receive any email notifications by default.
An administrator can configure users to receive notifications based on criteria such as the type of notification, and frequency.</simpara>
<note>
<simpara>If you want email notifications sent to a group’s email address, instead of an individual’s email address, create a user account with the group’s email address and minimal {Project} permissions, then subscribe the user account to the desired notification types.</simpara>
</note>
<important>
<simpara>{ProjectServer} does not enable outgoing emails by default, therefore you must review your email configuration.
For more information, see {InstallingProjectDocURL}configuring-satellite-for-outgoing-emails_{project-context}[Configuring {ProjectServer} for Outgoing Emails] in <emphasis>Installing {ProjectServer} from a Connected Network</emphasis>.</simpara>
</important>
</section>
<section xml:id="configuring-email-notifications_admin">
<title>Configuring Email Notifications</title>
<simpara>Configure email notifications for a user from the {Project} web UI.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Users</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Username</emphasis> of the user you want to edit.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">User</emphasis> tab, verify the value of the <emphasis role="strong">Mail</emphasis> field.
Email notifications will be sent to the address in this field.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Email Preferences</emphasis> tab, select <emphasis role="strong">Mail Enabled</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the notifications you want the user to receive using the drop-down menus next to the notification types.</simpara>
<note>
<simpara>The <emphasis role="strong">Audit Summary</emphasis> notification can be filtered by entering the required query in the <emphasis role="strong">Mail Query</emphasis> text box.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
<simpara>The user will start receiving the notification emails.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="testing-email-delivery_admin">
<title>Testing Email Delivery</title>
<simpara>To verify the delivery of emails, send a test email to a user.
If the email gets delivered, the settings are correct.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Users</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click on the username.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Email Preferences</emphasis> tab, click <emphasis role="strong">Test email</emphasis>.</simpara>
<simpara>A test email message is sent immediately to the user’s email address.</simpara>
</listitem>
</orderedlist>
<simpara>If the email is delivered, the verification is complete.
Otherwise, you must perform the following diagnostic steps:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Verify the user’s email address.</simpara>
</listitem>
<listitem>
<simpara>Verify {ProjectServer}'s email configuration.</simpara>
</listitem>
<listitem>
<simpara>Examine firewall and mail server logs.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="testing-email-notifications_admin">
<title>Testing Email Notifications</title>
<simpara>To verify that users are correctly subscribed to notifications, trigger the notifications manually.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>To trigger the notifications, execute the following command:</simpara>
<screen># foreman-rake reports:&lt;<emphasis>frequency</emphasis>&gt;</screen>
<simpara>Replace <emphasis>frequency</emphasis> with one of the following:</simpara>
</listitem>
<listitem>
<simpara>daily</simpara>
</listitem>
<listitem>
<simpara>weekly</simpara>
</listitem>
<listitem>
<simpara>monthly</simpara>
</listitem>
</itemizedlist>
<simpara>This triggers all notifications scheduled for the specified frequency for all the subscribed users.
If every subscribed user receives the notifications, the verification succeeds.</simpara>
<note>
<simpara>Sending manually triggered notifications to individual users is currently not supported.</simpara>
</note>
</section>
<section xml:id="notification-types_admin">
<title>Notification Types</title>
<simpara>The following are the notifications created by {Project}:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Audit summary</emphasis>: A summary of all activity audited by the {ProjectServer}.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Host built</emphasis>: A notification sent when a host is built.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Host errata advisory</emphasis>: A summary of applicable and installable errata for hosts managed by the user.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">OpenSCAP policy summary</emphasis>: A summary of OpenSCAP policy reports and their results.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Promote errata</emphasis>: A notification sent only after a Content View promotion.
It contains a summary of errata applicable and installable to hosts registered to the promoted Content View.
This allows a user to monitor what updates have been applied to which hosts.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Puppet error state</emphasis>: A notification sent after a host reports an error related to Puppet.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Puppet summary</emphasis>: A summary of Puppet reports.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Sync errata</emphasis>: A notification sent only after synchronizing a repository.
It contains a summary of new errata introduced by the synchronization.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Creating_and_Managing_User_Groups">
<title>Creating and Managing User Groups</title>
<section xml:id="user-groups_admin">
<title>User Groups</title>
<simpara>With {ProjectName}, you can assign permissions to groups of users.
You can also create user groups as collections of other user groups.
If using an external authentication source, you can map {Project} user groups to external user groups as described in <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Creating_User_Groups-Configuring_External_User_Groups"/>.</simpara>
<simpara>User groups are defined in an organizational context, meaning that you must select an organization before you can access user groups.</simpara>
</section>
<section xml:id="creating-a-user-group_admin">
<title>Creating a User Group</title>
<simpara>Use this procedure to create a user group.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">User Groups</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create User group</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">User Group</emphasis> tab, specify the name of the new user group and select group members:</simpara>
<itemizedlist>
<listitem>
<simpara>Select the previously created user  groups from the <emphasis role="strong">User Groups</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Select users from the <emphasis role="strong">Users</emphasis> list.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Roles</emphasis> tab, select the roles you want to assign to the user group.
Alternatively, select the <emphasis role="strong">Admin</emphasis> check box to assign all available permissions.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
<formalpara>
<title>For CLI Users</title>
<para>To create a user group, enter the following command:</para>
</formalpara>
<screen># hammer user-group create \
--name <emphasis>usergroup_name</emphasis> \
--user-ids <emphasis>user_ID1,user_ID2</emphasis>... \
--role-ids <emphasis>role_ID1,role_ID2</emphasis>...</screen>
</section>
<section xml:id="removing-a-user-group_admin">
<title>Removing a User Group</title>
<simpara>Use the {Project} web UI to remove a user group.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">User Groups</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Delete</emphasis> to the right of the user group you want to delete.</simpara>
</listitem>
<listitem>
<simpara>In the alert box that appears, click <emphasis role="strong">OK</emphasis> to delete a user group.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Creating_and_Managing_Roles">
<title>Creating and Managing Roles</title>
<simpara>{ProjectName} provides a set of predefined roles with permissions sufficient for standard tasks, as listed in <xref linkend="predefined-roles-available-in-satellite_admin"/>.
It is also possible to configure custom roles, and assign one or more permission filters to them.
Permission filters define the actions allowed for a certain resource type.
Certain {Project} plug-ins create roles automatically.</simpara>
<section xml:id="creating-a-role_admin">
<title>Creating a Role</title>
<simpara>Use this procedure to create a role.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Roles</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create Role</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Provide a <emphasis role="strong">Name</emphasis> for the role.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis> to save your new role.</simpara>
</listitem>
</orderedlist>
<formalpara>
<title>For CLI Users</title>
<para>To create a role, enter the following command:</para>
</formalpara>
<screen># hammer role create --name <emphasis>role_name</emphasis></screen>
<simpara>To serve its purpose, a role must contain permissions.
After creating a role, proceed to <xref linkend="adding-permissions-to-a-role_admin"/>.</simpara>
</section>
<section xml:id="cloning-a-role_admin">
<title>Cloning a Role</title>
<simpara>Use the {Project} web UI to clone a role.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Roles</emphasis> and select <emphasis role="strong">Clone</emphasis> from the drop-down menu to the right of the required role.</simpara>
</listitem>
<listitem>
<simpara>Provide a <emphasis role="strong">Name</emphasis> for the role.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis> to clone the role.</simpara>
</listitem>
<listitem>
<simpara>Click the name of the cloned role and navigate to <emphasis role="strong">Filters</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Edit the permissions as required.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis> to save your new role.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="adding-permissions-to-a-role_admin">
<title>Adding Permissions to a Role</title>
<simpara>Use this procedure to add permissions to a role.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Roles</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Add Filter</emphasis> from the drop-down list to the right of the required role.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Resource type</emphasis> from the drop-down list.
The <emphasis>(Miscellaneous)</emphasis> group gathers permissions that are not associated with any resource group.</simpara>
</listitem>
<listitem>
<simpara>Click the permissions you want to select from the <emphasis role="strong">Permission</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Depending on the <emphasis role="strong">Resource type</emphasis> selected, you can select or deselect the <emphasis role="strong">Unlimited</emphasis> and <emphasis role="strong">Override</emphasis> check box.
The <emphasis role="strong">Unlimited</emphasis> checkbox is selected by default, which means that the permission is applied on all resources of the selected type.
When you disable the <emphasis role="strong">Unlimited</emphasis> check box, the <emphasis role="strong">Search</emphasis> field activates.
In this field you can specify further filtering with use of the {ProjectNameX} search syntax.
See <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Users_and_Roles-Granular_Permission_Filtering"/> for details.
When you enable the <emphasis role="strong">Override</emphasis> check box, you can add additional locations and organizations to allow the role to access the resource type in the additional locations and organizations; you can also remove an already associated location and organization from the resource type to restrict access.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis> to save changes.</simpara>
</listitem>
</orderedlist>
<formalpara>
<title>For CLI Users</title>
<para>To add permissions to a role, complete the following steps:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>List all available permissions:</simpara>
<screen># hammer filter available-permissions</screen>
</listitem>
<listitem>
<simpara>Add permissions to a role:</simpara>
<screen># hammer filter create \
--role <emphasis>role_name</emphasis> \
--permission-ids <emphasis>perm_ID1</emphasis>,<emphasis>perm_ID2</emphasis>...</screen>
</listitem>
</orderedlist>
<simpara>For more information about roles and permissions parameters, enter the <literal>hammer role --help</literal> and <literal>hammer filter --help</literal> commands.</simpara>
</section>
<section xml:id="viewing-permissions-of-a-role_admin">
<title>Viewing Permissions of a Role</title>
<simpara>Use the {Project} web UI to view the permissions of a role.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Roles</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Filters</emphasis> to the right of the required role to get to the <emphasis role="strong">Filters</emphasis> page.</simpara>
</listitem>
</orderedlist>
<simpara>The <emphasis role="strong">Filters</emphasis> page contains a table of permissions assigned to a role grouped by the resource type.
It is also possible to generate a complete table of permissions and actions that you can use on your {Project} system.
See <xref linkend="creating-a-complete-permission-table_admin"/> for instructions.</simpara>
</section>
<section xml:id="creating-a-complete-permission-table_admin">
<title>Creating a Complete Permission Table</title>
<simpara>Use the {Project} CLI to create a permission table.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Ensure that the required packages are installed.
Execute the following command on the {ProjectServer}:</simpara>
<screen># {package-install-project} tfm-rubygem-foreman*</screen>
</listitem>
<listitem>
<simpara>Start the {Project} console with the following command:</simpara>
<screen># foreman-rake console</screen>
<simpara>Insert the following code into the console:</simpara>
<screen>f = File.open('/tmp/table.html', 'w')

result = Foreman::AccessControl.permissions {|a,b| a.security_block &lt;=&gt; b.security_block}.collect do |p|
      actions = p.actions.collect { |a| "&lt;li&gt;#{a}&lt;/li&gt;" }
      "&lt;tr&gt;&lt;td&gt;#{p.name}&lt;/td&gt;&lt;td&gt;&lt;ul&gt;#{actions.join('')}&lt;/ul&gt;&lt;/td&gt;&lt;td&gt;#{p.resource_type}&lt;/td&gt;&lt;/tr&gt;"
end.join("\n")

f.write(result)</screen>
<simpara>The above syntax creates a table of permissions and saves it to the <literal>/tmp/table.html</literal> file.</simpara>
</listitem>
<listitem>
<simpara>Press <literal><emphasis role="strong">Ctrl</emphasis></literal> + <literal><emphasis role="strong">D</emphasis></literal> to exit the {Project} console.
Insert the following text at the first line of <literal>/tmp/table.html</literal>:</simpara>
<screen>&lt;table border="1"&gt;&lt;tr&gt;&lt;td&gt;Permission name&lt;/td&gt;&lt;td&gt;Actions&lt;/td&gt;&lt;td&gt;Resource type&lt;/td&gt;&lt;/tr&gt;</screen>
<simpara>Append the following text at the end of <literal>/tmp/table.html</literal>:</simpara>
<screen>&lt;/table&gt;</screen>
</listitem>
<listitem>
<simpara>Open <literal>/tmp/table.html</literal> in a web browser to view the table.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="removing-a-role_admin">
<title>Removing a Role</title>
<simpara>Use the {Project} web UI to remove a role.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Roles</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Delete</emphasis> from the drop-down list to the right of the role to be deleted.</simpara>
</listitem>
<listitem>
<simpara>In an alert box that appears, click <emphasis role="strong">OK</emphasis> to delete the role.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="predefined-roles-available-in-satellite_admin">
<title>Predefined Roles Available in {Project}</title>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="22*"/>
<colspec colname="col_2" colwidth="78*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Permissions Provided by Role <footnote><simpara>The exact set of allowed actions associated with predefined roles can be viewed by the privileged user as described in <xref linkend="viewing-permissions-of-a-role_admin"/></simpara></footnote></entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Access Insights Admin</simpara></entry>
<entry align="left" valign="top"><simpara>Add and edit Insights rules.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Access Insights Viewer</simpara></entry>
<entry align="left" valign="top"><simpara>View Insight reports.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Ansible Roles Manager</simpara></entry>
<entry align="left" valign="top"><simpara>Play roles on hosts and host groups.
View, destroy, and import Ansible roles.
View, edit, create, destroy, and import Ansible variables.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Ansible Tower Inventory Reader</simpara></entry>
<entry align="left" valign="top"><simpara>View facts, hosts, and host groups.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Bookmarks manager</simpara></entry>
<entry align="left" valign="top"><simpara>Create, edit, and delete bookmarks.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Boot disk access</simpara></entry>
<entry align="left" valign="top"><simpara>Download the boot disk.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Compliance manager</simpara></entry>
<entry align="left" valign="top"><simpara>View, create, edit, and destroy SCAP content files, compliance policies, and tailoring files.
View compliance reports.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Compliance viewer</simpara></entry>
<entry align="left" valign="top"><simpara>View compliance reports.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Create ARF report</simpara></entry>
<entry align="left" valign="top"><simpara>Create compliance reports.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Default role</simpara></entry>
<entry align="left" valign="top"><simpara>The set of permissions that every user is granted, irrespective of any other roles.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Discovery Manager</simpara></entry>
<entry align="left" valign="top"><simpara>View, provision, edit, and destroy discovered hosts and manage discovery rules.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Discovery Reader</simpara></entry>
<entry align="left" valign="top"><simpara>View hosts and discovery rules.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Edit hosts</simpara></entry>
<entry align="left" valign="top"><simpara>View, create, edit, destroy, and build hosts.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Edit partition tables</simpara></entry>
<entry align="left" valign="top"><simpara>View, create, edit and destroy partition tables.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Manager</simpara></entry>
<entry align="left" valign="top"><simpara>A role similar to administrator, but does not have permissions to edit global settings.
In the {Project} web UI, global settings can be found under <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Settings</emphasis>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Organization admin</simpara></entry>
<entry align="left" valign="top"><simpara>An administrator role defined per organization.
The role has no visibility into resources in other organizations.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Red Hat Access Logs</simpara></entry>
<entry align="left" valign="top"><simpara>View the log viewer and the logs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Remote Execution Manager</simpara></entry>
<entry align="left" valign="top"><simpara>A role with full remote execution permissions, including modifying job templates.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Remote Execution User</simpara></entry>
<entry align="left" valign="top"><simpara>Run remote execution jobs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Site manager</simpara></entry>
<entry align="left" valign="top"><simpara>A restrained version of the Manager role.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>System admin</simpara></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara>Edit global settings in <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Settings</emphasis></simpara>
</listitem>
<listitem>
<simpara>View, create, edit and destroy users, user groups, and roles.</simpara>
</listitem>
<listitem>
<simpara>View, create, edit, destroy, and assign organizations and locations but not view resources within them.</simpara>
</listitem>
</itemizedlist>
<simpara>Users with this role can create users and assign all roles to them.
Therefore, ensure to give this role only to trusted users.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Tasks manager</simpara></entry>
<entry align="left" valign="top"><simpara>View and edit {Project} tasks.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Tasks reader</simpara></entry>
<entry align="left" valign="top"><simpara>A role that can only view {Project} tasks.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Viewer</simpara></entry>
<entry align="left" valign="top"><simpara>A passive role that provides the ability to view the configuration of every element of the {Project} structure, logs, reports, and statistics.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>View hosts</simpara></entry>
<entry align="left" valign="top"><simpara>A role that can only view hosts.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Virt-who Manager</simpara></entry>
<entry align="left" valign="top"><simpara>A role with full virt-who permissions.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Virt-who Reporter</simpara></entry>
<entry align="left" valign="top"><simpara>Upload reports generated by virt-who to {Project}.
It can be used if you configure virt-who manually and require a user role that has limited virt-who permissions.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Virt-who Viewer</simpara></entry>
<entry align="left" valign="top"><simpara>View virt-who configurations.
Users with this role can deploy virt-who instances using existing virt-who configurations.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles-Granular_Permission_Filtering">
<title>Granular Permission Filtering</title>
<section xml:id="granular-permission-filter_admin">
<title>Granular Permission Filter</title>
<simpara>As mentioned in <xref linkend="adding-permissions-to-a-role_admin"/>, {ProjectName} provides the ability to limit the configured user permissions to selected instances of a resource type.
These granular filters are queries to the {Project} database and are supported by the majority of resource types.</simpara>
</section>
<section xml:id="creating-a-granular-permission-filter_admin">
<title>Creating a Granular Permission Filter</title>
<simpara>Use this procedure to create a granular filter.</simpara>
<simpara>{Project} does not apply search conditions to create actions.
For example, limiting the <emphasis>create_locations</emphasis> action with <emphasis>name = "Default Location"</emphasis> expression in the search field does not prevent the user from assigning a custom name to the newly created location.</simpara>
<formalpara>
<title>Procedure</title>
<para>Specify a query in the <emphasis role="strong">Search</emphasis> field on the <emphasis role="strong">Edit Filter</emphasis> page.
Deselect the <emphasis role="strong">Unlimited</emphasis> check box for the field to be active.
Queries have the following form:</para>
</formalpara>
<screen><emphasis>field_name</emphasis> <emphasis>operator</emphasis> <emphasis>value</emphasis></screen>
<itemizedlist>
<listitem>
<simpara><emphasis>field_name</emphasis> marks the field to be queried.
The range of available field names depends on the resource type.
For example, the <emphasis>Partition Table</emphasis> resource type offers <emphasis>family</emphasis>, <emphasis>layout</emphasis>, and <emphasis>name</emphasis> as query parameters.</simpara>
</listitem>
<listitem>
<simpara><emphasis>operator</emphasis> specifies the type of comparison between <emphasis>field_name</emphasis> and <emphasis>value</emphasis>.
See <xref linkend="supported-operators-for-granular-search_admin"/> for an overview of applicable operators.</simpara>
</listitem>
<listitem>
<simpara><emphasis>value</emphasis> is the value used for filtering.
This can be for example a name of an organization.
Two types of wildcard characters are supported: underscore (_) provides single character replacement, while percent sign (%) replaces zero or more characters.</simpara>
</listitem>
</itemizedlist>
<simpara>For most resource types, the <emphasis role="strong">Search</emphasis> field provides a drop-down list suggesting the available parameters.
This list appears after placing the cursor in the search field.
For many resource types, you can combine queries using logical operators such as <emphasis>and</emphasis>, <emphasis>not</emphasis> and <emphasis>has</emphasis> operators.</simpara>
<formalpara>
<title>For CLI Users</title>
<para>To create a granular filter, enter the <literal>hammer filter create</literal> command with the <literal>--search</literal> option to limit permission filters, for example:</para>
</formalpara>
<screen># hammer filter create \
--permission-ids 91 \
--search "name ~ ccv*" \
--role qa-user</screen>
<simpara>This command adds to the <emphasis role="strong">qa-user</emphasis> role a permission to view, create, edit, and destroy Content Views that only applies to Content Views with name starting with <literal>ccv</literal>.</simpara>
</section>
<section xml:id="examples_of_using_granular_permission_filters" remap="_examples_of_using_granular_permission_filters">
<title>Examples of Using Granular Permission Filters</title>
<simpara>As an administrator, you can allow selected users to make changes in a certain part of the environment path.
The following filter allows you to work with content while it is in the development stage of the application life cycle, but the content becomes inaccessible once is pushed to production.</simpara>
<section xml:id="applying-permissions-for-the-host-resource-type_admin">
<title>Applying Permissions for the Host Resource Type</title>
<simpara>The following query applies any permissions specified for the Host resource type only to hosts in the group named host-editors.</simpara>
<screen>hostgroup = host-editors</screen>
<simpara>The following query returns records where the name matches <emphasis>XXXX</emphasis>, <emphasis>Yyyy</emphasis>, or <emphasis>zzzz</emphasis> example strings:</simpara>
<screen>name ^ (XXXX, Yyyy, zzzz)</screen>
<simpara>You can also limit permissions to a selected environment.
To do so, specify the environment name in the <emphasis role="strong">Search</emphasis> field, for example:</simpara>
<screen>Dev</screen>
<simpara>You can limit user permissions to a certain organization or location with the use of the granular permission filter in the <emphasis role="strong">Search</emphasis> field.
However, some resource types provide a GUI alternative, an <emphasis role="strong">Override</emphasis> check box that provides the <emphasis role="strong">Locations</emphasis> and <emphasis role="strong">Organizations</emphasis> tabs.
On these tabs, you can select from the list of available organizations and locations.
See <xref linkend="creating-an-organization-specific-manager-role_admin"/>.</simpara>
</section>
<section xml:id="creating-an-organization-specific-manager-role_admin">
<title>Creating an Organization Specific Manager Role</title>
<simpara>Use the {Project} UI to create an administrative role restricted to a single organization named <emphasis>org-1</emphasis>.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Roles</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Clone the existing <emphasis role="strong">Organization admin</emphasis> role.
Select <emphasis role="strong">Clone</emphasis> from the drop-down list next to the <emphasis role="strong">Filters</emphasis> button.
You are then prompted to insert a name for the cloned role, for example <emphasis>org-1 admin</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the desired locations and organizations to associate them with the role.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis> to create the role.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis>org-1 admin</emphasis>, and click <emphasis role="strong">Filters</emphasis> to view all associated filters.
The default filters work for most use cases.
However, you can optionally click <emphasis role="strong">Edit</emphasis> to change the properties for each filter.
For some filters, you can enable the <emphasis role="strong">Override</emphasis> option if you want the role to be able to access resources in additional locations and organizations.
For example, by selecting the <emphasis role="strong">Domain</emphasis> resource type, the <emphasis role="strong">Override</emphasis> option, and then additional locations and organizations using the <emphasis role="strong">Locations</emphasis> and <emphasis role="strong">Organizations</emphasis> tabs, you allow this role to access domains in the additional locations and organizations that is not associated with this role.
You can also click <emphasis role="strong">New filter</emphasis> to associate new filters with this role.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="supported-operators-for-granular-search_admin">
<title>Supported Operators for Granular Search</title>
<table frame="all" rowsep="1" colsep="1">
<title>Logical Operators</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="22*"/>
<colspec colname="col_2" colwidth="78*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Operator</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>and</simpara></entry>
<entry align="left" valign="top"><simpara>Combines search criteria.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>not</simpara></entry>
<entry align="left" valign="top"><simpara>Negates an expression.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>has</simpara></entry>
<entry align="left" valign="top"><simpara>Object must have a specified property.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<table frame="all" rowsep="1" colsep="1">
<title>Symbolic Operators</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="22*"/>
<colspec colname="col_2" colwidth="78*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Operator</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>=</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis>Is equal to</emphasis>.
An equality comparison that is case-sensitive for text fields.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>!=</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis>Is not equal to</emphasis>.
An inversion of the = operator.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>~</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis>Like</emphasis>.
A case-insensitive occurrence search for text fields.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>!~</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis>Not like</emphasis>.
An inversion of the ~ operator.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>^</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis>In</emphasis>.
An equality comparison that is case-sensitive search for text fields.
This generates a different SQL query to the <emphasis>Is equal to</emphasis> comparison, and is more efficient for multiple value comparison.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>!^</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis>Not in</emphasis>.
An inversion of the ^ operator.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>&gt;, &gt;=</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis>Greater than</emphasis>, <emphasis>greater than or equal to</emphasis>.
Supported for numerical fields only.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>&lt;, ⇐</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis>Less than</emphasis>, <emphasis>less than or equal to</emphasis>.
Supported for numerical fields only.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</section>
</chapter>
<chapter xml:id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Security_Compliance_Management">
<title>Managing Security Compliance</title>
<simpara>Security compliance management is the ongoing process of defining security policies, auditing for compliance with those policies and resolving instances of non-compliance.
Any non-compliance is managed according to the organization’s configuration management policies.
Security policies range in scope from host-specific to industry-wide, therefore, flexibility in their definition is required.</simpara>
<section xml:id="security-content-automation-protocol_admin">
<title>Security Content Automation Protocol</title>
<simpara>{ProjectX} uses the Security Content Automation Protocol (SCAP) to define security configuration policies.
For example, a security policy might specify that for hosts running Red Hat Enterprise Linux, login via SSH is not permitted for the <literal>root</literal> account.
With {ProjectX} you can schedule compliance auditing and reporting on all hosts under management.
For more information about SCAP, see the <link xlink:href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/">Red Hat Enterprise Linux 7 Security Guide</link>.</simpara>
<section xml:id="scap-content_admin">
<title>SCAP Content</title>
<simpara>SCAP content is a datastream format containing the configuration and security baseline against which hosts are checked.
Checklists are described in the extensible checklist configuration description format (XCCDF) and vulnerabilities in the open vulnerability and assessment language (OVAL).
Checklist items, also known as rules express the desired configuration of a system item.
For example, you may specify that no one can log in to a host over SSH using the <literal>root</literal> user account.
Rules can be grouped into one or more profiles, allowing multiple profiles to share a rule.
SCAP content consists of both rules and profiles.</simpara>
<simpara>You can either create SCAP content or obtain it from a vendor.
Supported profiles are provided for Red Hat Enterprise Linux in the scap-security-guide package.
The creation of SCAP content is outside the scope of this guide, but see the <link xlink:href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/">Red Hat Enterprise Linux 7 Security Guide</link> for information on how to download, deploy, modify, and create your own content.</simpara>
<simpara>The default SCAP content provided with the OpenSCAP components of {ProjectX} depends on the version of Red Hat Enterprise Linux.
On Red Hat Enterprise Linux 7, content for both Red Hat Enterprise Linux 6 and Red Hat Enterprise Linux 7 is installed.</simpara>
</section>
<section xml:id="xccdf-profile_admin">
<title>XCCDF Profile</title>
<simpara>An XCCDF profile is a checklist against which a host or host group is evaluated.
Profiles are created to verify compliance with an industry standard or custom standard.</simpara>
<simpara>The profiles provided with {ProjectX} are obtained from the <link xlink:href="https://www.open-scap.org/">OpenSCAP project</link>.</simpara>
<section xml:id="listing-available-xccdf-profiles_admin">
<title>Listing Available XCCDF Profiles</title>
<simpara>In the {Project} UI, list the available XCCD profiles.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">SCAP contents</emphasis>.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Security_Compliance_Management_with_OpenSCAP-Configuring_SCAP_Content">
<title>Configuring SCAP Content</title>
<section xml:id="importing-openscap-puppet-modules_admin">
<title>Importing OpenSCAP Puppet Modules</title>
<note>
<simpara>If you do not use Puppet to configure OpenSCAP auditing on hosts, you can skip this procedure.</simpara>
</note>
<simpara>To audit hosts with OpenSCAP, you must first import a Puppet environment.
The Puppet environment contains the Puppet classes you must assign to each host to deploy the OpenSCAP configuration.</simpara>
<simpara>You must associate each host that you want to audit with the Puppet environment in the {Project} web UI.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Configure</emphasis> &gt; <emphasis role="strong">Environments</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Import environments from <emphasis>{foreman-example-com}</emphasis></emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the Puppet environment check box associated with the host you want to audit.</simpara>
<simpara>If no Puppet environment exists, select the <emphasis role="strong">production</emphasis> environment check box.
The Puppet classes that you require for OpenSCAP are in the <emphasis role="strong">production</emphasis> environment by default.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Update</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="loading-the-default-openscap-content">
<title>Loading the Default OpenSCAP Content</title>
<simpara>In the CLI, load the default OpenScap content.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Use the <literal>foreman-rake</literal> command:</simpara>
<screen># foreman-rake foreman_openscap:bulk_upload:default</screen>
</listitem>
</itemizedlist>
</section>
<section xml:id="extra-scap-content_admin">
<title>Extra SCAP Content</title>
<simpara>You can upload extra SCAP content into the {ProjectServer}, either content created by yourself or obtained elsewhere.
SCAP content must be imported into the {ProjectServer} before being applied in a policy.
For example, the <literal>scap-security-guide</literal> RPM package available in the Red Hat Enterprise Linux 7.2 repositories includes a profile for the Payment Card Industry Data Security Standard (PCI-DSS) version 3.
You can upload this content into a {ProjectServer} even if it is not running Red Hat Enterprise Linux 7.2 as the content is not specific to an operating system version.</simpara>
<section xml:id="uploading-extra-scap-content_admin">
<title>Uploading Extra SCAP Content</title>
<simpara>In the {Project} web UI, upload the extra SCAP content.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">SCAP contents</emphasis> and click <emphasis role="strong">New SCAP Content</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a title in the <emphasis role="strong">Title</emphasis> text box.</simpara>
<simpara>Example: <literal><emphasis role="strong">RHEL 7.2 SCAP Content</emphasis></literal>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Choose file</emphasis>, navigate to the location containing the SCAP content file and select <emphasis role="strong">Open</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>If the SCAP content file is loaded successfully, a message similar to <literal>Successfully created RHEL 7.2 SCAP Content</literal> is shown and the list of <emphasis role="strong">SCAP Contents</emphasis> includes the new title.</simpara>
</section>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Security_Compliance_Management_with_OpenSCAP-Managing_Compliance_Policies">
<title>Managing Compliance Policies</title>
<section xml:id="compliance-policy_admin">
<title>Compliance Policy</title>
<simpara>A scheduled audit, also known as a <emphasis>compliance policy</emphasis>, is a scheduled task that checks the specified hosts for compliance against an XCCDF profile.
The schedule for scans is specified by the {ProjectServer} and the scans are performed on the host.
When a scan completes, an <emphasis>Asset Reporting File</emphasis> (ARF) is generated in XML format and uploaded to the {ProjectServer}.
You can see the results of the scan in the compliance policy dashboard.
No changes are made to the scanned host by the compliance policy.
The SCAP content includes several profiles with associated rules but policies are not included by default.</simpara>
</section>
<section xml:id="creating-a-complicance-policy_admin">
<title>Creating a Compliance Policy</title>
<simpara>With {ProjectX}, you can create a compliance policy to scan your content hosts to ensure that the hosts remain compliant to your security requirements.</simpara>
<simpara>You can use either Puppet or Ansible to deploy the compliance policy to your hosts.
Note that Puppet runs by default every 30 minutes.
If you assign a new policy, the next Puppet run synchronizes the policy to the host.
However Ansible does not perform scheduled runs.
To add a new policy, you must run Ansible role manually or using remote execution.
For more information about remote execution, see {ManagingHostsDocURL}configuring-and-setting-up-remote-jobs_managing-hosts[Configuring and Setting up Remote Jobs] in the <emphasis>Managing Hosts</emphasis> guide.</simpara>
<formalpara xml:id="form-Red_Hat_Satellite-Host_Configuration_Guide-Compliance_Policy-Creating_a_Policy-Prerequisites">
<title>Prerequisites</title>
<para>Before you begin, you must decide whether you want to use a Puppet or Ansible deployment.</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>For Puppet deployment, ensure that each host that you want to audit is associated with a Puppet environment.
For more information, see <xref linkend="importing-openscap-puppet-modules_admin"/>.</simpara>
</listitem>
<listitem>
<simpara>For Ansible deployment, ensure that you import the <literal>theforeman.foreman_scap_client</literal> Ansible role.
For more information about importing Ansible roles, see {ConfiguringAnsibleDocURL}getting-started-with-ansible_ansible[Getting Started with Ansible in Satellite] in <emphasis>Configuring Satellite to use Ansible</emphasis>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Policies</emphasis>, and select whether you want a manual, Ansible, or Puppet deployment.</simpara>
</listitem>
<listitem>
<simpara>Enter a name for this policy, a description (optional), then click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the SCAP Content and XCCDF Profile to be applied, then click <emphasis role="strong">Next</emphasis>.</simpara>
<simpara>Until <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1704582">BZ#1704582</link> is resolved, note that the <literal>Default XCCDF Profile</literal> might return an empty report.</simpara>
</listitem>
<listitem>
<simpara>Specify the scheduled time when the policy is to be applied, then click <emphasis role="strong">Next</emphasis>.</simpara>
<simpara>Select <emphasis role="strong">Weekly</emphasis>, <emphasis role="strong">Monthly</emphasis>, or <emphasis role="strong">Custom</emphasis> from the <emphasis role="strong">Period</emphasis> list.</simpara>
<itemizedlist>
<listitem>
<simpara>If you select <emphasis role="strong">Weekly</emphasis>, also select the desired day of the week from the <emphasis role="strong">Weekday</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>If you select <emphasis role="strong">Monthly</emphasis>, also specify the desired day of the month in the <emphasis role="strong">Day of month</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>If you select <emphasis role="strong">Custom</emphasis>, enter a valid Cron expression in the <emphasis role="strong">Cron line</emphasis> field.</simpara>
<simpara>The <emphasis role="strong">Custom</emphasis> option allows for greater flexibility in the policy’s schedule than either the <emphasis role="strong">Weekly</emphasis> or <emphasis role="strong">Monthly</emphasis> options.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Select the locations to which the policy is to be applied, then click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the organizations to which the policy is to be applied, then click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the host groups to which the policy is to be applied, then click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>When the Puppet agent runs on the hosts which belong to the selected host group, or hosts to which the policy has been applied, the OpenSCAP client will be installed and a Cron job added with the policy’s specified schedule.
The <literal>SCAP Content</literal> tab provides the name of the SCAP content file which will be distributed to the directory <literal>/var/lib/openscap/content/</literal> on all target hosts.</simpara>
</section>
<section xml:id="viewing-a-compliance-policy_admin">
<title>Viewing a Compliance Policy</title>
<simpara>You can preview the rules which will be applied by specific OpenSCAP content and profile combination.
This is useful when planning policies.</simpara>
<simpara>In the {Project} web UI, view the compliance policy.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Policies</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Show Guide</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="editing-a-compliance-policy_admin">
<title>Editing a Compliance Policy</title>
<simpara>In the {Project} web UI, edit the compliance policy.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Policies</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the drop-down list to the right of the policy’s name, select <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Edit the necessary attributes.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>An edited policy is applied to the host when its Puppet agent next checks with the {ProjectServer} for updates.
By default this occurs every 30 minutes.</simpara>
</section>
<section xml:id="deleting-a-compliance-policy_admin">
<title>Deleting a Compliance Policy</title>
<simpara>In the {Project} web UI, delete an existing policy.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Policies</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the drop-down list to the right of the policy’s name, select <emphasis role="strong">Delete</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">OK</emphasis> in the confirmation message.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="tailoring-files_admin">
<title>Tailoring Files</title>
<simpara>Tailoring Files allow existing OpenSCAP policies to be customized without forking or rewriting the policy.
You can assign a Tailoring File to a policy when creating or updating a policy.</simpara>
<simpara>You can create a Tailoring File using the <link xlink:href="https://www.open-scap.org/tools/scap-workbench/">SCAP Workbench</link>.
For more information on using the SCAP Workbench tool, see <link xlink:href="https://www.open-scap.org/resources/documentation/customizing-scap-security-guide-for-your-use-case/">Customizing SCAP Security Guide for your use-case</link>.</simpara>
<section xml:id="uplodaing-a-tailoring-file_admin">
<title>Uploading a Tailoring File</title>
<simpara>In the {Project} web UI, upload a Tailoring file.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Compliance - Tailoring Files</emphasis> and click <emphasis role="strong">New Tailoring File</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a name in the <emphasis role="strong">Name</emphasis> text box.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Choose File</emphasis>, navigate to the location containing the SCAP DataStream Tailoring File and select <emphasis role="strong">Open</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis> to upload the chosen Tailoring File.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="assigning-a-tailoring-file-to-a-policy_admin">
<title>Assigning a Tailoring File to a Policy</title>
<simpara>In the {Project} web UI, assign a Tailoring file to a policy.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Compliance - Policies</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New Policy</emphasis>, or <emphasis role="strong">New Compliance Policy</emphasis> if there are existing Compliance Policies.</simpara>
</listitem>
<listitem>
<simpara>Enter a name in the <emphasis role="strong">Name</emphasis> text box, and click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Scap content</emphasis> from the dropdown menu.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">XCCDF Profile</emphasis> from the dropdown menu.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Tailoring File</emphasis> from the dropdown menu.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">XCCDF Profile in Tailoring File</emphasis> from the dropdown menu.</simpara>
<simpara>It is important to select the XCCDF Profile because Tailoring Files are able to contain multiple XCCDF Profiles.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Period</emphasis> from the dropdown menu.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Weekday</emphasis> from the dropdown menu, and click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Location</emphasis> to move it to the <emphasis role="strong">Selected Items</emphasis> window, and click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select an <emphasis role="strong">Organization</emphasis> to move it to the <emphasis role="strong">Selected Items</emphasis> window, and click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Hostgroup</emphasis> to move it to the <emphasis role="strong">Selected Items</emphasis> window, and click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="configuring-a-host-group-for-openscap_admin">
<title>Configuring a host group for OpenSCAP</title>
<simpara>Use this procedure to configure all the OpenSCAP requirements for a host group.</simpara>
<formalpara>
<title>OpenSCAP Setup Overview</title>
<para>You must complete the following tasks on {ProjectServer} to assign the necessary components for a host group:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Enable OpenSCAP on {SmartProxy}.
For more information, see {InstallingSmartProxyDocURL}enabling-openscap_{smart-proxy-context}[Enabling OpenSCAP on External {SmartProxies}] in the <emphasis>Installing {SmartProxyServer}</emphasis> guide.</simpara>
</listitem>
<listitem>
<simpara>Assign an OpenSCAP {SmartProxy}.</simpara>
</listitem>
<listitem>
<simpara>Assign a Puppet environment that contains the Puppet classes to deploy the OpenSCAP policies.</simpara>
</listitem>
<listitem>
<simpara>Assign the <literal>foreman_scap_client</literal> and <literal>foreman_scap_client::params</literal> Puppet classes.</simpara>
</listitem>
<listitem>
<simpara>Assign any compliance policies that you want to add.</simpara>
</listitem>
</itemizedlist>
<simpara>For information about creating and administering hosts, see the {ManagingHostsDocURL}[Managing Hosts] guide.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Configure</emphasis> &gt; <emphasis role="strong">Host Groups</emphasis>, and either create a host group or click the host group that you want to configure for OpenSCAP reporting.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Puppet Environment</emphasis> list, select the Puppet environment that contains the <literal>foreman_scap_client</literal> and <literal>foreman_scap_client::params</literal> Puppet classes.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">OpenSCAP {SmartProxy}</emphasis> list, select the {SmartProxy} with OpenSCAP enabled that you want to use.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Puppet Classes</emphasis> tab, and add the <literal>foreman_scap_client</literal> and <literal>foreman_scap_client::params</literal> Puppet classes.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis> to save your changes.</simpara>
</listitem>
<listitem>
<simpara>Navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Policies</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the policy that you want to assign to the host group.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Host Groups</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Host Groups</emphasis> list, select as many host groups as you want to assign to this policy.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis> to save your changes.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-a-host-for-openscap_admin">
<title>Configuring a host for OpenSCAP</title>
<simpara>Use this procedure to configure all the OpenSCAP requirements for a host.</simpara>
<formalpara>
<title>OpenSCAP Setup Overview</title>
<para>You must complete the following tasks on {ProjectServer} to assign the necessary components for a host:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Enable OpenSCAP on {SmartProxy}.
For more information, see {InstallingSmartProxyDocURL}enabling-openscap_{smart-proxy-context}[Enabling OpenSCAP on External {SmartProxies}] in the <emphasis>Installing {SmartProxyServer}</emphasis> guide.</simpara>
</listitem>
<listitem>
<simpara>Assign an OpenSCAP {SmartProxy}.</simpara>
</listitem>
<listitem>
<simpara>Assign a Puppet environment that contains the Puppet classes to deploy the OpenSCAP policies.</simpara>
</listitem>
<listitem>
<simpara>Assign the <literal>foreman_scap_client</literal> and <literal>foreman_scap_client::params</literal> Puppet classes.</simpara>
</listitem>
<listitem>
<simpara>Assign any compliance policies that you want to add.</simpara>
</listitem>
</itemizedlist>
<simpara>For information about creating and administering hosts, see the {ManagingHostsDocURL}[Managing Hosts] guide.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">All Hosts</emphasis>, and select <emphasis role="strong">Edit</emphasis> on the host you want to configure for OpenSCAP reporting.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Puppet Environment</emphasis> list, select the Puppet environment that contains the <literal>foreman_scap_client</literal> and <literal>foreman_scap_client::params</literal> Puppet classes.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">OpenSCAP {SmartProxy}</emphasis> list, select the {SmartProxy} with OpenSCAP enabled that you want to use.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Puppet Classes</emphasis> tab, and add the <literal>foreman_scap_client</literal> and <literal>foreman_scap_client::params</literal> Puppet classes.</simpara>
</listitem>
<listitem>
<simpara>To add a compliance policy, navigate to one of the following locations:</simpara>
</listitem>
<listitem>
<simpara>Navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">All Hosts</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the host or hosts to which you want to add the policy.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Select Action</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Assign Compliance Policy</emphasis> from the list.</simpara>
</listitem>
<listitem>
<simpara>In the Policy window, select the policy that you want from the list of available policies and click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="monitoring-compliance_admin">
<title>Monitoring Compliance</title>
<simpara>{ProjectNameX} enables centralized compliance monitoring and management.
A compliance dashboard provides an overview of compliance of hosts and the ability to view details for each host within the scope of that policy.
Compliance reports provide a detailed analysis of compliance of each host with the applicable policy.
With this information, you can evaluate the risks presented by each host and manage the resources required to bring hosts into compliance.</simpara>
<simpara>Common objectives when monitoring compliance using SCAP include the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Verifying policy compliance.</simpara>
</listitem>
<listitem>
<simpara>Detecting changes in compliance.</simpara>
</listitem>
</itemizedlist>
<section xml:id="compliance-policy-dashboard_admin">
<title>Compliance Policy Dashboard</title>
<simpara>The compliance policy dashboard provides a statistical summary of compliance of hosts and the ability to view details for each host within the scope of that policy.
For all hosts which were evaluated as non-compliant, the <literal>Failed</literal> statistic provides a useful metric for prioritizing compliance effort.
The hosts detected as <literal>Never audited</literal> should also be a priority, since their status is unknown.</simpara>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="images/compliance_policy_dashboard.png"/>
</imageobject>
<textobject><phrase>Compliance Policy Dashboard</phrase></textobject>
</mediaobject>
</informalfigure>
</section>
<section xml:id="viewing-the-complience-policy-dashboard_admin">
<title>Viewing the Compliance Policy Dashboard</title>
<simpara>Use the {Project} web UI to verify policy compliance with the compliance policy dashboard.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Policies</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the required policy name.
The dashboard provides the following information:</simpara>
<itemizedlist>
<listitem>
<simpara>A ring chart illustrating a high-level view of compliance of hosts with the policy.</simpara>
</listitem>
<listitem>
<simpara>A statistical breakdown of compliance of hosts with the policy, in a tabular format.</simpara>
</listitem>
<listitem>
<simpara>Links to the latest policy report for each host.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="compliance-email-notifications_admin">
<title>Compliance Email Notifications</title>
<simpara>The {ProjectServer} sends an OpenSCAP Summary email to all users who subscribe to the <emphasis role="strong">Openscap policy summary</emphasis> email notifications.
For more information on subscribing to email notifications, see <xref linkend="configuring-email-notifications_admin"/>.
Each time a policy is run, {Project} checks the results against the previous run, noting any changes between them.
The email is sent according to the frequency requested by each subscriber, providing a summary of each policy and its most recent result.</simpara>
<simpara>An <emphasis role="strong">OpenSCAP Summary</emphasis> email message contains the following information:</simpara>
<itemizedlist>
<listitem>
<simpara>Details of the time period it covers.</simpara>
</listitem>
<listitem>
<simpara>Totals for all hosts by status: changed, compliant, and noncompliant.</simpara>
</listitem>
<listitem>
<simpara>A tabular breakdown of each host and the result of its latest policy, including totals of the rules that passed, failed, changed, or where results were unknown.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="compliance-report_admin">
<title>Compliance Report</title>
<simpara>A compliance report is the output of a policy run against a host.
Each report includes the total number of rules passed or failed per policy.
By default, reports are listed in descending date order.</simpara>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Reports</emphasis> to list all compliance reports.</simpara>
<simpara>A compliance report consists of the following areas:</simpara>
<itemizedlist>
<listitem>
<simpara>Introduction</simpara>
</listitem>
<listitem>
<simpara>Evaluation Characteristics</simpara>
</listitem>
<listitem>
<simpara>Compliance and Scoring</simpara>
</listitem>
<listitem>
<simpara>Rule Overview</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>Evaluation Characteristics</title>
<para>The Evaluation Characteristics area provides details about an evaluation against a specific profile, including the host that was evaluated, the profile used in the evaluation, and when the evaluation started and finished.
For reference, the IPv4, IPv6, and MAC addresses of the host are also listed.</para>
</formalpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="3">
<colspec colname="col_1" colwidth="19*"/>
<colspec colname="col_2" colwidth="38*"/>
<colspec colname="col_3" colwidth="44*"/>
<thead>
<row>
<entry align="left" valign="top">Name</entry>
<entry align="left" valign="top">Description</entry>
<entry align="left" valign="top">Example</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Target machine</simpara></entry>
<entry align="left" valign="top"><simpara>The fully-qualified domain name (FQDN) of the evaluated host.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>test-system.example.com</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Benchmark URL</simpara></entry>
<entry align="left" valign="top"><simpara>The URL of the SCAP content against which the host was evaluated.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/var/lib/openscap/content/1fbdc87d24db51ca184419a2b6f</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Benchmark ID</simpara></entry>
<entry align="left" valign="top"><simpara>The identifier of the benchmark against which the host was evaluated.
A benchmark is a set of profiles</simpara></entry>
<entry align="left" valign="top"><simpara><literal>xccdf_org.ssgproject.content_benchmark_RHEL_7</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Profile ID</simpara></entry>
<entry align="left" valign="top"><simpara>The identifier of the profile against which the host was evaluated.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>xccdf_org.ssgproject_content_profile_rht-ccp</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Started at</simpara></entry>
<entry align="left" valign="top"><simpara>The date and time at which the evaluation started, in ISO 8601 format.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>2015-09-12T14:40:02</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Finished at</simpara></entry>
<entry align="left" valign="top"><simpara>The date and time at which the evaluation finished, in ISO 8601 format.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>2015-09-12T14:40:05</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Performed by</simpara></entry>
<entry align="left" valign="top"><simpara>The local account name under which the evaluation was performed on the host.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>root</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<formalpara>
<title>Compliance and Scoring</title>
<para>The Compliance and Scoring area provides an overview of whether or not the host is in compliance with the profile rules, a breakdown of compliance failures by severity, and an overall compliance score as a percentage.
If compliance with a rule was not checked, this is categorized in the <emphasis role="strong">Rule results</emphasis> field as <emphasis role="strong">Other</emphasis>.</para>
</formalpara>
<formalpara>
<title>Rule Overview</title>
<para>The Rule Overview area provides details about every rule and the compliance result, with the rules presented in a hierarchical layout.</para>
</formalpara>
<simpara>Select or clear the check boxes to narrow the list of rules included in the compliance report.
For example, if the focus of your review is any non-compliance, clear the <emphasis role="strong">pass</emphasis> and <emphasis role="strong">informational</emphasis> check boxes.</simpara>
<simpara>To search all rules, enter a criterion in the <emphasis role="strong">Search</emphasis> field.
The search is dynamically applied as you type.
The <emphasis role="strong">Search</emphasis> field only accepts a single plain-text search term and it is applied as a case-insensitive search.
When you perform a search, only those rules whose descriptions match the search criterion will be listed.
To remove the search filter, delete the search criterion.</simpara>
<simpara>For an explanation of each result, hover the cursor over the status shown in the <emphasis role="strong">Result</emphasis> column.</simpara>
</section>
<section xml:id="examining-rule-results_admin">
<title>Examining Compliance Failure of Hosts</title>
<simpara>Use the {Project} web UI to determine why a host failed compliance on a rule.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Reports</emphasis> to list all compliance reports.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">View Report</emphasis> in the row of the specific host to view the details of an individual report.</simpara>
</listitem>
<listitem>
<simpara>Click on the rule’s title to see further details:</simpara>
<itemizedlist>
<listitem>
<simpara>A description of the rule with instructions for bringing the host into compliance if available.</simpara>
</listitem>
<listitem>
<simpara>The rationale for the rule.</simpara>
</listitem>
<listitem>
<simpara>In some cases, a remediation script.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<warning>
<simpara>Do not implement any of the recommended remedial actions or scripts without first testing them in a non-production environment.</simpara>
</warning>
</section>
<section xml:id="searching-compliance-reports_admin">
<title>Searching Compliance Reports</title>
<simpara>Use the Compliance Reports search field to filter the list of available reports on any given subset of hosts.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>To apply a filter, enter the search query in the <emphasis role="strong">Search</emphasis> field and click <emphasis role="strong">Search</emphasis>.
The search query is case insensitive.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Search Use Cases</title>
<listitem>
<simpara>The following search query finds all compliance reports for which more than five rules failed:</simpara>
<screen>failed &gt; 5</screen>
</listitem>
<listitem>
<simpara>The following search query finds all compliance reports created after January 1, <emphasis>YYYY</emphasis>, for hosts with host names that contain the <literal>prod-</literal> group of characters:</simpara>
<screen>host ~ prod- AND date &gt; "Jan 1, <emphasis>YYYY</emphasis>"</screen>
</listitem>
<listitem>
<simpara>The following search query finds all reports generated by the <literal>rhel7_audit</literal> compliance policy from an hour ago:</simpara>
<screen>"1 hour ago" AND compliance_policy = date = "1 hour ago" AND compliance_policy = rhel7_audit</screen>
</listitem>
<listitem>
<simpara>The following search query finds reports that pass an XCCDF rule:</simpara>
<screen>xccdf_rule_passed = xccdf_org.ssgproject.content_rule_firefox_preferences-auto-download_actions</screen>
</listitem>
<listitem>
<simpara>The following search query finds reports that fail an XCCDF rule:</simpara>
<screen>xccdf_rule_failed = xccdf_org.ssgproject.content_rule_firefox_preferences-auto-download_actions</screen>
</listitem>
<listitem>
<simpara>The following search query finds reports that have a result different than fail or pass for an XCCDF rule:</simpara>
<screen>xccdf_rule_othered = xccdf_org.ssgproject.content_rule_firefox_preferences-auto-download_actions</screen>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Additional Information</title>
<listitem>
<simpara>To see a list of available search parameters, click the empty <emphasis role="strong">Search</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>You can create complex queries with the following logical operators: <literal>and</literal>, <literal>not</literal> and <literal>has</literal>.
For more information about logical operators, see <xref linkend="supported-operators-for-granular-search_admin"/>.</simpara>
</listitem>
<listitem>
<simpara>You cannot use regular expressions in a search query.
However, you can use multiple fields in a single search expression.
For more information about all available search operators, see <xref linkend="supported-operators-for-granular-search_admin"/>.</simpara>
</listitem>
<listitem>
<simpara>You can bookmark a search to reuse the same search query.
For more information, see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Searching_and_Bookmarking-Creating_Bookmarks"/>.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="deleting-a-compliance-reportadmin">
<title>Deleting a Compliance Report</title>
<simpara>To delete a compliance report, complete the following steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Reports</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the Compliance Reports window, identify the policy that you want to delete and, on the right of the policy’s name, select <emphasis role="strong">Delete</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">OK</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="deleting-multiple-compliance-reportsadmin">
<title>Deleting Multiple Compliance Reports</title>
<simpara>You can delete multiple compliance policies simultaneously.
However, in the {Project} web UI, compliance policies are paginated, so you must delete one page of reports at a time.
If you want to delete all OpenSCAP reports, use the script in the <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9-beta/html/api_guide/chap-red_hat_satellite-api_guide-using_the_red_hat_satellite_api#sect-API_Guide-Deleting-OpenSCAP-Reports">Deleting OpenSCAP Reports</link> section of the <emphasis>{ProjectName} API Guide</emphasis>.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Hosts</emphasis> &gt; <emphasis role="strong">Reports</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the Compliance Reports window, select the compliance reports that you want to delete.</simpara>
</listitem>
<listitem>
<simpara>In the upper right of the list, select <emphasis role="strong">Delete reports</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Repeat these steps for as many pages as you want to delete.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Specifications_Supported_OpenSCAP">
<title>Specifications Supported by OpenSCAP</title>
<simpara>The following specifications are supported by OpenSCAP:</simpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="3">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="60*"/>
<colspec colname="col_3" colwidth="20*"/>
<thead>
<row>
<entry align="left" valign="top">Title</entry>
<entry align="left" valign="top">Description</entry>
<entry align="left" valign="top">Version</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>XCCDF</simpara></entry>
<entry align="left" valign="top"><simpara>The Extensible Configuration Checklist Description Format</simpara></entry>
<entry align="left" valign="top"><simpara>1.2</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>OVAL</simpara></entry>
<entry align="left" valign="top"><simpara>Open Vulnerability and Assessment Language</simpara></entry>
<entry align="left" valign="top"><simpara>5.11</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>-</simpara></entry>
<entry align="left" valign="top"><simpara>Asset Identification</simpara></entry>
<entry align="left" valign="top"><simpara>1.1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ARF</simpara></entry>
<entry align="left" valign="top"><simpara>Asset Reporting Format</simpara></entry>
<entry align="left" valign="top"><simpara>1.1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>CCE</simpara></entry>
<entry align="left" valign="top"><simpara>Common Configuration Enumeration</simpara></entry>
<entry align="left" valign="top"><simpara>5.0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>CPE</simpara></entry>
<entry align="left" valign="top"><simpara>Common Platform Enumeration</simpara></entry>
<entry align="left" valign="top"><simpara>2.3</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>CVE</simpara></entry>
<entry align="left" valign="top"><simpara>Common Vulnerabilities and Exposures</simpara></entry>
<entry align="left" valign="top"><simpara>-</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>CVSS</simpara></entry>
<entry align="left" valign="top"><simpara>Common Vulnerability Scoring System</simpara></entry>
<entry align="left" valign="top"><simpara>2.0</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
</chapter>
<chapter xml:id="Disabling_Weak_SSL_2-0_and_3-0_Encryption">
<title>Disabling TLS 1.0 and TLS 1.1 Encryption</title>
<simpara>You might want to change the encryption settings for {Project} depending on the security requirements of your infrastructure or to fix vulnerabilities quickly.</simpara>
<simpara>Apache and Qpid services in {Project} have TLS 1.0 and 1.1 encryption enabled by default.
Use this procedure on {Project} and {SmartProxy} to configure {Project} and {SmartProxy} to only allow TLS 1.2, as required, for example, by PCI-DSS regulations.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Open the <literal>/etc/foreman-installer/custom-hiera.yaml</literal> file for editing:</simpara>
<screen># vi /etc/foreman-installer/custom-hiera.yaml</screen>
</listitem>
<listitem>
<simpara>Add the following entries:</simpara>
<screen># Apache
apache::mod::ssl::ssl_protocol: [ 'ALL' , '-SSLv3' , '-TLSv1' , '-TLSv1.1' , '+TLSv1.2' ]

# QPID Dispatch
foreman_proxy_content::qpid_router_ssl_ciphers: 'ALL:!aNULL:+HIGH:-SSLv3:!IDEA-CBC-SHA'</screen>
</listitem>
<listitem>
<simpara>Enter the <literal>{foreman-installer}</literal> command to apply the above configuration and configure Qpid to use TLS 1.2 only:</simpara>
<screen># {foreman-installer} \
--foreman-proxy-content-qpid-router-ssl-protocols=TLSv1.2</screen>
</listitem>
</orderedlist>
</chapter>
<chapter xml:id="backing-up-satellite-server-and-capsule-server">
<title>Backing Up {ProjectServer} and {SmartProxyServer}</title>
<simpara>You can back up your {Project} deployment to ensure the continuity of your {ProjectName} deployment and associated data in the event of a disaster.
If your deployment uses custom configurations, you must consider how to handle these custom configurations when you plan your backup and disaster recovery policy.</simpara>
<simpara>To create a backup of your {ProjectServer} or {SmartProxyServer} and all associated data, use the <literal>{foreman-maintain} backup</literal> command.
Backing up to a separate storage device on a separate system is highly recommended.</simpara>
<simpara>{Project} services are unavailable during the backup.
Therefore, you must ensure that no other tasks are scheduled by other administrators.
You can schedule a backup using <literal>cron</literal>.
For more information, see the <xref linkend="example-of-a-weekly-full-backup-followed-by-daily-incremental-backups_admin"/>.</simpara>
<simpara>During offline or snapshot backups, the services are inactive and {Project} is in a maintenance mode.
All the traffic from outside on port 443 is rejected by a firewall to ensure there are no modifications triggered.</simpara>
<simpara>A backup contains sensitive information from the <literal>/root/ssl-build</literal> directory.
For example, it can contain hostnames, ssh keys, request files and SSL certificates.
You must encrypt or move the backup to a secure location to minimize the risk of damage or unauthorized access to the hosts.</simpara>
<formalpara>
<title>Conventional Backup Methods</title>
<para>You can also use conventional backup methods.
For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/part-system_backup_and_recovery">System Backup and Recovery</link> in the <emphasis>Red Hat Enterprise Linux 7 System Administrator’s Guide</emphasis>.</para>
</formalpara>
<note>
<simpara>If you plan to use the <literal>{foreman-maintain} backup</literal> command to create a backup, do not stop the <literal>{foreman-maintain}</literal> services.</simpara>
</note>
<itemizedlist>
<listitem>
<simpara>When creating a snapshot or conventional backup, you must stop all services as follows:</simpara>
<screen># {foreman-maintain} service stop</screen>
</listitem>
<listitem>
<simpara>Start the services after creating a snapshot or conventional backup:</simpara>
<screen># {foreman-maintain} service start</screen>
</listitem>
</itemizedlist>
<section xml:id="estimating-the-size-of-a-backup_admin">
<title>Estimating the Size of a Backup</title>
<simpara>Note that estimations in this section are for the installations that use the Katello plug-in.</simpara>
<simpara>The full backup creates uncompressed archives of PostgreSQL and Pulp database files, and {Project} configuration files.
Compression occurs after the archives are created to decrease the time when {Project} services are unavailable.</simpara>
<simpara>A full backup requires space to store the following data:</simpara>
<itemizedlist>
<listitem>
<simpara>Uncompressed {Project} database and configuration files</simpara>
</listitem>
<listitem>
<simpara>Compressed {Project} database and configuration files</simpara>
</listitem>
<listitem>
<simpara>An extra 20% of the total estimated space to ensure a reliable backup</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Enter the <literal>du</literal> command to estimate the size of uncompressed directories containing {Project} database and configuration files:</simpara>
<screen># du -sh /var/opt/rh/rh-postgresql12/lib/pgsql/data /var/lib/pulp
100G  /var/opt/rh/rh-postgresql12/lib/pgsql/data
100G	/var/lib/pulp
# du -csh /var/lib/qpidd /var/lib/tftpboot /etc /root/ssl-build \
/var/www/html/pub /opt/puppetlabs
886M  /var/lib/qpidd
16M   /var/lib/tftpboot
37M   /etc
900K	/root/ssl-build
100K	/var/www/html/pub
2M	  /opt/puppetlabs
942M  total</screen>
</listitem>
<listitem>
<simpara>Calculate how much space is required to store the compressed data.</simpara>
<simpara>The following table describes the compression ratio of all data items included in the backup:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Backup Data Compression Ratio</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="22*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="17*"/>
<colspec colname="col_4" colwidth="28*"/>
<thead>
<row>
<entry align="left" valign="top">Data type</entry>
<entry align="left" valign="top">Directory</entry>
<entry align="left" valign="top">Ratio</entry>
<entry align="left" valign="top">Example results</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>PostgreSQL database files</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/var/opt/rh/rh-postgresql12/lib/pgsql/data</literal></simpara></entry>
<entry align="left" valign="top"><simpara>80 - 85%</simpara></entry>
<entry align="left" valign="top"><simpara>100 GB → 20 GB</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Pulp RPM files</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/var/lib/pulp</literal></simpara></entry>
<entry align="left" valign="top"><simpara>(not compressed)</simpara></entry>
<entry align="left" valign="top"><simpara>100 GB</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Configuration files</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/var/lib/qpidd</literal><?asciidoc-br?>
<literal>/var/lib/tftpboot</literal><?asciidoc-br?>
<literal>/etc</literal><?asciidoc-br?>
<literal>/root-ssl/build</literal><?asciidoc-br?>
<literal>/var/www/html/pub</literal><?asciidoc-br?>
<literal>/opt/puppetlabs</literal></simpara></entry>
<entry align="left" valign="top"><simpara>85%</simpara></entry>
<entry align="left" valign="top"><simpara>942 MB → 141 MB</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>In this example, the compressed backup data occupies 180 GB in total.</simpara>
</listitem>
<listitem>
<simpara>To calculate the amount of available space you require to store a backup, calculate the sum of the estimated values of compressed and uncompressed backup data, and add an extra 20% to ensure a reliable backup.</simpara>
<simpara>This example requires 681 GB plus 180 GB for the uncompressed and compressed backup data, 861 GB in total.
With 172 GB of extra space, 1033 GB must be allocated for the backup location.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="performing-a-full-backup-of-satellite-or-capsule_admin">
<title>Performing a Full Backup of {ProjectServer} or {SmartProxyServer}</title>
<simpara>{ProjectName} 6.9-beta uses the <literal>{foreman-maintain} backup</literal> command to make backups.</simpara>
<simpara>There are three main methods of backing up {ProjectServer}:</simpara>
<itemizedlist>
<listitem>
<simpara>Offline backup</simpara>
</listitem>
<listitem>
<simpara>Online backup</simpara>
</listitem>
<listitem>
<simpara>Snapshot backups</simpara>
<simpara>For more information about each of these methods, you can view the usage statements for each backup method.</simpara>
</listitem>
</itemizedlist>
<simpara>For offline backups:</simpara>
<screen># {foreman-maintain} backup offline --help</screen>
<simpara>For online backups:</simpara>
<screen># {foreman-maintain} backup online --help</screen>
<simpara>For snapshots backups:</simpara>
<screen># {foreman-maintain} backup snapshot --help</screen>
<formalpara>
<title>Directory creation</title>
<para>The <literal>{foreman-maintain} backup</literal> command creates a time-stamped subdirectory in the backup directory that you specify.
The <literal>{foreman-maintain} backup</literal> command does not overwrite backups, therefore you must select the correct directory or subdirectory when restoring from a backup or an incremental backup.
The <literal>{foreman-maintain} backup</literal> command stops and restarts services as required.</para>
</formalpara>
<simpara>When you run the <literal>{foreman-maintain} backup offline</literal> command, the following default backup directories are created:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>{project-context}-backup</literal> on {Project}</simpara>
</listitem>
<listitem>
<simpara><literal>foreman-proxy-backup</literal> on {SmartProxy}</simpara>
</listitem>
</itemizedlist>
<simpara>If you want to set a custom directory name, add the  <literal>--preserve-directory</literal> option and add a directory name.
The backup is then stored in the directory you provide in the command line.
If you use the <literal>--preserve-directory</literal> option, no data is removed if the backup fails.</simpara>
<simpara>Note that if you use a local PgSQL database, the <literal>postgres</literal> user requires write access to the backup directory.</simpara>
<formalpara>
<title>Remote databases</title>
<para>You can use the <literal>{foreman-maintain} backup</literal> command to back up remote databases.</para>
</formalpara>
<simpara>You can use both online and offline methods to back up remote databases, but if you use offline methods, such as snapshot, the <literal>{foreman-maintain} backup</literal> command performs a database dump.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Ensure that your backup location has sufficient available disk space to store the backup.
For more information, see <xref linkend="estimating-the-size-of-a-backup_admin"/>.</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>Procedure</title>
<para>To perform a full offline backup of {ProjectServer} or {SmartProxyServer}, complete one of the following steps:</para>
</formalpara>
<warning>
<simpara>Request other users of {ProjectServer} or {SmartProxyServer} to save any changes and warn them that {Project} services are unavailable for the duration of the backup.
Ensure no other tasks are scheduled for the same time as the backup.</simpara>
</warning>
<itemizedlist>
<listitem>
<simpara>On {ProjectServer}, enter the following command:</simpara>
<screen># {foreman-maintain} backup offline <emphasis>/var/{project-context}-backup</emphasis></screen>
</listitem>
<listitem>
<simpara>On {SmartProxyServer}, enter the following command:</simpara>
<screen># {foreman-maintain} backup offline <emphasis>/var/foreman-proxy-backup</emphasis></screen>
</listitem>
</itemizedlist>
</section>
<section xml:id="performing-a-backup-without-pulp-content_admin">
<title>Performing a Backup without Pulp Content</title>
<simpara>You can perform an offline backup that excludes the contents of the Pulp directory.
The backup without Pulp content is useful for debugging purposes and is only intended to provide access to configuration files without backing up the Pulp database.
You cannot restore from a directory that does not contain Pulp content.</simpara>
<warning>
<simpara>Request other users of {ProjectServer} or {SmartProxyServer} to save any changes and warn them that {Project} services are unavailable for the duration of the backup.
Ensure no other tasks are scheduled for the same time as the backup.</simpara>
</warning>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Ensure that your backup location has sufficient available disk space to store the backup.
For more information, see <xref linkend="estimating-the-size-of-a-backup_admin"/>.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>To perform an offline backup without Pulp content, enter the following command:</simpara>
<screen># {foreman-maintain} backup offline --skip-pulp-content <emphasis>/var/backup_directory</emphasis></screen>
</listitem>
</itemizedlist>
</section>
<section xml:id="performing-an-incremental-backup_admin">
<title>Performing an Incremental Backup</title>
<simpara>Use this procedure to perform an offline backup of any changes since a previous backup.</simpara>
<simpara>To perform incremental backups, you must perform a full backup as a reference to create the first incremental backup of a sequence.
Keep the most recent full backup and a complete sequence of incremental backups to restore from.</simpara>
<warning>
<simpara>Request other users of {ProjectServer} or {SmartProxyServer} to save any changes and warn them that {Project} services are unavailable for the duration of the backup.
Ensure no other tasks are scheduled for the same time as the backup.</simpara>
</warning>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Ensure that your backup location has sufficient available disk space to store the backup.
For more information, see <xref linkend="estimating-the-size-of-a-backup_admin"/>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>To perform a full offline backup, enter the following command:</simpara>
<screen># {foreman-maintain} backup offline  <emphasis>/var/backup_directory</emphasis></screen>
</listitem>
<listitem>
<simpara>To create a directory within your backup directory to store the first incremental back up, enter the <literal>{foreman-maintain} backup</literal> command with the <literal>--incremental</literal> option:</simpara>
<screen># {foreman-maintain} backup offline --incremental <emphasis>/var/backup_directory/full_backup</emphasis>  <emphasis>/var/backup_directory</emphasis></screen>
</listitem>
<listitem>
<simpara>To create the second incremental backup, enter the <literal>{foreman-maintain} backup</literal> command with the <literal>--incremental</literal> option and include the path to the first incremental backup to indicate the starting point for the next increment.
This creates a directory for the second incremental backup in your backup directory:</simpara>
<screen># {foreman-maintain} backup offline --incremental <emphasis>/var/backup_directory/first_incremental_backup</emphasis>  <emphasis>/var/backup_directory</emphasis></screen>
</listitem>
<listitem>
<simpara>Optional: If you want to point to a different version of the backup, and make a series of increments with that version of the backup as the starting point, you can do this at any time.
For example, if you want to make a new incremental backup from the full backup rather than the first or second incremental backup, point to the full backup directory:</simpara>
<screen># {foreman-maintain} backup offline --incremental <emphasis>/var/backup_directory/full_backup</emphasis>  <emphasis>/var/backup_directory</emphasis></screen>
</listitem>
</orderedlist>
</section>
<section xml:id="example-of-a-weekly-full-backup-followed-by-daily-incremental-backups_admin">
<title>Example of a Weekly Full Backup Followed by Daily Incremental Backups</title>
<simpara>The following script performs a full backup on a Sunday followed by incremental backups for each of the following days.
A new subdirectory is created for each day that an incremental backup is performed.
The script requires a daily cron job.</simpara>
<screen>#!/bin/bash -e
PATH=/sbin:/bin:/usr/sbin:/usr/bin
DESTINATION=/var/backup_directory
if [[ $(date +%w) == 0 ]]; then
  {foreman-maintain} backup offline --assumeyes $DESTINATION
else
  LAST=$(ls -td -- $DESTINATION/*/ | head -n 1)
  {foreman-maintain} backup offline --assumeyes --incremental "$LAST" $DESTINATION
fi
exit 0</screen>
<simpara>Note that the <literal>{foreman-maintain} backup</literal> command requires <literal>/sbin</literal> and <literal>/usr/sbin</literal> directories to be in <literal>PATH</literal> and the <literal>--assumeyes</literal> option is used to skip the confirmation prompt.</simpara>
</section>
<section xml:id="performing-an-online-backup_admin">
<title>Performing an Online Backup</title>
<simpara>Perform an online backup only for debugging purposes.</simpara>
<formalpara>
<title>Risks Associated with Online Backups</title>
<para>When performing an online backup, if there are procedures affecting the Pulp database, the Pulp part of the backup procedure repeats until it is no longer being altered.
Because the backup of the Pulp database is the most time consuming part of backing up {Project}, if you make a change that alters the Pulp database during this time, the backup procedure keeps restarting.</para>
</formalpara>
<simpara>For production environments, use the snapshot method.
For more information, see <xref linkend="performing-a-snapshot-backup_admin"/>.
If you want to use the online backup method in production, proceed with caution and ensure that no modifications occur during the backup.</simpara>
<warning>
<simpara>Request other users of {ProjectServer} or {SmartProxyServer} to save any changes and warn them that {Project} services are unavailable for the duration of the backup.
Ensure no other tasks are scheduled for the same time as the backup.</simpara>
</warning>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Ensure that your backup location has sufficient available disk space to store the backup.
For more information, see <xref linkend="estimating-the-size-of-a-backup_admin"/>.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>To perform an online backup, enter the following command:</simpara>
<screen># {foreman-maintain} backup online <emphasis>/var/backup_directory</emphasis></screen>
</listitem>
</itemizedlist>
</section>
<section xml:id="performing-a-snapshot-backup_admin">
<title>Performing a Snapshot Backup</title>
<simpara>You can perform a snapshot backup that uses Logical Volume Manager (LVM) snapshots of the Pulp, and PostgreSQL directories.
Creating a backup from LVM snapshots mitigates the risk of an inconsistent backup.</simpara>
<simpara>The snapshot backup method is faster than a full offline backup and therefore reduces {Project} downtime.</simpara>
<simpara>To view the usage statement, enter the following command:</simpara>
<screen>{foreman-maintain} backup snapshot -h</screen>
<warning>
<simpara>Request other {ProjectServer} or {SmartProxyServer} users to save any changes and warn them that {Project} services are unavailable for the duration of the backup.
Ensure no other tasks are scheduled for the same time as the backup.</simpara>
</warning>
<formalpara>
<title>Prerequisites</title>
<para>Before you perform the snapshot backup, ensure that the following conditions are met:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>The system uses LVM for the directories that you snapshot: <literal>/var/lib/pulp/</literal>, and <literal>/var/opt/rh/rh-postgresql12/lib/pgsql</literal>.</simpara>
</listitem>
<listitem>
<simpara>The free disk space in the relevant volume group (VG) is three times the size of the snapshot.
More precisely, the VG must have enough space unreserved by the member logical volumes (LVs) to accommodate new snapshots.
In addition, one of the LVs must have enough free space for the backup directory.</simpara>
</listitem>
<listitem>
<simpara>The target backup directory is on a different LV than the directories that you snapshot.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>To perform a snapshot backup, enter the <literal>{foreman-maintain} backup snapshot</literal> command:</simpara>
<screen># {foreman-maintain} backup snapshot <emphasis>/var/backup_directory</emphasis></screen>
</listitem>
</itemizedlist>
<simpara>The <literal>{foreman-maintain} backup snapshot</literal> command creates snapshots when the services are active, and stops all services which can impact the backup.
This makes the maintenance window shorter.
After the successful snapshot, all services are restarted and LVM snapshots are removed.</simpara>
</section>
<section xml:id="white-listing-and-skipping-steps-when-performing-backups_admin">
<title>White-listing and Skipping Steps When Performing Backups</title>
<simpara>A backup using the <literal>{foreman-maintain} backup</literal> command proceeds in a sequence of steps.
To skip part of the backup add the <literal>--whitelist</literal> option to the command and add the step label that you want to omit.</simpara>
<itemizedlist>
<listitem>
<simpara>To display a list of available step labels, enter the following command:</simpara>
<screen># {foreman-maintain} advanced procedure run -h</screen>
</listitem>
<listitem>
<simpara>To skip a step of the backup, enter the <literal>{foreman-maintain} backup</literal> command with the <literal>--whitelist</literal> option.
For example:</simpara>
<screen># {foreman-maintain} backup online --whitelist backup-metadata  -y <emphasis>/var/backup_directory</emphasis></screen>
</listitem>
</itemizedlist>
</section>
</chapter>
<chapter xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Backup_and_Disaster_Recovery-Restoring_Satellite_Server_or_Capsule_Server_from_a_Backup">
<title>Restoring {ProjectServer} or {SmartProxyServer} from a Backup</title>
<simpara>You can restore {ProjectName} Server or Red Hat {SmartProxyServer} from the backup data that you create as part of <xref linkend="backing-up-satellite-server-and-capsule-server"/>.
This process outlines how to restore the backup on the same server that generated the backup, and all data covered by the backup is deleted on the target system.
If the original system is unavailable, provision a system with the same configuration settings and host name.</simpara>
<section xml:id="restoring-from-a-full-backup_admin">
<title>Restoring from a Full Backup</title>
<simpara>Use this procedure to restore {ProjectName} or {SmartProxyServer} from a full backup.
When the restore process completes, all processes are online, and all databases and system configuration revert to the state at the time of the backup.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Ensure that you are restoring to the correct instance.
The {ProjectName} instance must have the same host name, configuration, and be the same major version as the original system.</simpara>
</listitem>
<listitem>
<simpara>Ensure that you have an existing target directory.
The target directory is read from the configuration files contained within the archive.</simpara>
</listitem>
<listitem>
<simpara>Ensure that you have enough space to store this data on the base system of {ProjectServer} or {SmartProxyServer} as well as enough space after the restoration to contain all the data in the <literal>/etc/</literal> and <literal>/var/</literal> directories contained within the backup.</simpara>
<simpara>To check the space used by a directory, enter the following command:</simpara>
<screen># du -sh <emphasis>/var/backup_directory</emphasis></screen>
<simpara>To check for free space, enter the following command:</simpara>
<screen># df -h <emphasis>/var/backup_directory</emphasis></screen>
<simpara>Add the <literal>--total</literal> option to get a total of the results from more than one directory.</simpara>
</listitem>
<listitem>
<simpara>Ensure that all SELinux contexts are correct.
Enter the following command to restore the correct SELinux contexts:</simpara>
<screen># restorecon -Rnv /</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Choose the appropriate method to install {Project} or {SmartProxy}:</simpara>
<itemizedlist>
<listitem>
<simpara>To install {ProjectServer} from a connected network, follow the procedures in {InstallingProjectDocURL}[Installing {ProjectServer} from a Connected Network].</simpara>
</listitem>
<listitem>
<simpara>To install a {SmartProxyServer}, follow the procedures in the {InstallingSmartProxyDocURL}[Installing {SmartProxyServer}].</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Copy the backup data to {ProjectServer}’s local file system.
Use <literal>/var/</literal> or <literal>/var/tmp/</literal>.</simpara>
</listitem>
<listitem>
<simpara>Run the restoration script.</simpara>
<screen># {foreman-maintain} restore <emphasis>/var/backup_directory</emphasis></screen>
<simpara>Where <emphasis>backup_directory</emphasis> is the time-stamped directory or subdirectory containing the backed-up data.</simpara>
<simpara>The restore process can take a long time to complete, because of the amount of data to copy.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Additional Resources</title>
<listitem>
<simpara>For troubleshooting, you can check <literal>/var/log/foreman/production.log</literal> and <literal>/var/log/messages</literal>.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="restoring-from-incremental-backups_admin">
<title>Restoring from Incremental Backups</title>
<simpara>Use this procedure to restore {Project} or {SmartProxyServer} from incremental backups.
If you have multiple branches of incremental backups, select your full backup and each incremental backup for the “branch” you want to restore, in chronological order.</simpara>
<simpara>When the restore process completes, all processes are online, and all databases and system configuration revert to the state at the time of the backup.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Restore the last full backup using the instructions in <xref linkend="restoring-from-a-full-backup_admin"/>.</simpara>
</listitem>
<listitem>
<simpara>Remove the full backup data from {ProjectServer}’s local file system, for example, <literal>/var/</literal> or <literal>/var/tmp/</literal>.</simpara>
</listitem>
<listitem>
<simpara>Copy the incremental backup data to {ProjectServer}’s local file system, for example, <literal>/var/</literal> or <literal>/var/tmp/</literal>.</simpara>
</listitem>
<listitem>
<simpara>Restore the incremental backups in the same sequence that they are made:</simpara>
<screen># {foreman-maintain} restore -i <emphasis>/var/backup_directory</emphasis>/FIRST_INCREMENTAL
# {foreman-maintain} restore -i <emphasis>/var/backup_directory</emphasis>/SECOND_INCREMENTAL</screen>
<simpara>If you created the backup using the <literal>{foreman-maintain} backup</literal> command, you do not need to use <literal>-i</literal> option in the command.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Additional Resources</title>
<listitem>
<simpara>For troubleshooting, you can check <literal>/var/log/foreman/production.log</literal> and <literal>/var/log/messages</literal>.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="backup-and-restore-capsule-server-using-a-virtual-machine-snapshot_admin">
<title>Backup and Restore {SmartProxyServer} Using a Virtual Machine Snapshot</title>
<simpara>If your {SmartProxyServer} is a virtual machine, you can restore it from a snapshot.
Creating weekly snapshots to restore from is recommended.
In the event of failure, you can install, or configure a new {SmartProxyServer}, and then synchronize the database content from {ProjectServer}.</simpara>
<simpara>If required, deploy a new {SmartProxyServer}, ensuring the host name is the same as before, and then install the {SmartProxy} certificates.
You may still have them on {ProjectServer}, the package name ends in -certs.tar, alternately create new ones.
Follow the procedures in {InstallingSmartProxyDocURL}[Installing {SmartProxyServer}] until you can confirm, in the web UI, that {SmartProxyServer} is connected to {ProjectServer}.
Then use the procedure <xref linkend="synchronizing-an-external-capsule_admin"/> to synchronize from {Project}.</simpara>
<section xml:id="synchronizing-an-external-capsule_admin">
<title>Synchronizing an External {SmartProxy}</title>
<simpara>Synchronize an external {SmartProxy} with {Project}.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>To synchronize an external {SmartProxy}, select the relevant organization and location in the web UI, or choose <emphasis role="strong">Any Organization</emphasis> and <emphasis role="strong">Any Location</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Navigate to <emphasis role="strong">Infrastructure</emphasis> &gt; <emphasis role="strong">{SmartProxies}</emphasis> and click the name of the {SmartProxy} to synchronize.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Overview</emphasis> tab, select <emphasis role="strong">Synchronize</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
</chapter>
<chapter xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Renaming_a_Server">
<title>Renaming {ProjectServer} or {SmartProxyServer}</title>
<simpara>To rename {ProjectServer} or {SmartProxyServer}, you must use the <literal>{project-change-hostname}</literal> script.</simpara>
<simpara>If you rename {ProjectServer}, you must reregister all {Project} clients and configure each {SmartProxyServer} to point them to the new {Project} host name.
If you use custom SSL certificates, you must regenerate them with the new host name.
If you use virt-who, you must update the virt-who configuration files with the new host name.</simpara>
<simpara>If you rename {SmartProxyServer}, you must reregister all {SmartProxy} clients and update the {SmartProxy} host name in the {Project} web UI.
If you use custom SSL certificates, you must regenerate them with the new host name.</simpara>
<warning>
<simpara>The renaming process shuts down all {ProjectServer} services on the host being renamed.
When the renaming is complete, all services are restarted.</simpara>
</warning>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Renaming_a_Satellite_Server">
<title>Renaming {ProjectServer}</title>
<simpara>The host name of {ProjectServer} is used by {ProjectServer} components, all {SmartProxyServer}s, and hosts registered to it for communication.
This procedure ensures that you update all references to the new host name.</simpara>
<simpara>If you use external authentication, you must reconfigure {ProjectServer} for external authentication after you run the <literal>{project-change-hostname}</literal> script.
The <literal>{project-change-hostname}</literal> script breaks external authentication for {ProjectServer}.
For more information about configuring external authentication, see <xref linkend="chap-{Project_Link}-Administering_{Project_Link}-Configuring_External_Authentication"/>.</simpara>
<simpara>If you use virt-who, you must update the virt-who configuration files with the new host name after you run the <literal>{project-change-hostname}</literal> script.
For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.9-beta/html/configuring_virtual_machine_subscriptions_in_red_hat_satellite/troubleshooting-virt-who#modifying-virt-who-configuration_vm-subs-satellite">Modifying a virt-who Configuration</link> in <emphasis>Configuring Virtual Machine Subscriptions in {ProjectName}</emphasis>.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Backup {ProjectServer}.
The <literal>{project-change-hostname}</literal> script makes irreversible changes to {ProjectServer}.
If the renaming process is not successful, you must restore it from a backup.
For more information, see <xref linkend="backing-up-satellite-server-and-capsule-server"/>.</simpara>
</listitem>
<listitem>
<simpara>Optional: If {ProjectServer} has a custom SSL certificate installed, a new certificate must be obtained for the host’s new name.
For more information, see {InstallingProjectDocURL}configuring-satellite-custom-server-certificate_{project-context}[Configuring {ProjectServer} with a Custom SSL Certificate] in <emphasis>Installing {ProjectServer} from a Connected Network</emphasis>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On {ProjectServer}, choose the appropriate method to run the <literal>{project-change-hostname}</literal> script, providing the new host name and {Project} credentials:</simpara>
<itemizedlist>
<listitem>
<simpara>If your {ProjectServer} is installed with default self-signed SSL certificates, enter the following command:</simpara>
<screen># {project-change-hostname} <emphasis>new-{project-context}</emphasis> \
--username <emphasis>admin</emphasis> \
--password <emphasis>password</emphasis></screen>
</listitem>
<listitem>
<simpara>If your {ProjectServer} is installed with custom SSL certificates:</simpara>
<screen># {project-change-hostname} <emphasis>new-{project-context}</emphasis> \
--username <emphasis>admin</emphasis> \
--password <emphasis>password</emphasis> \
--custom-cert "/root/ownca/test.com/test.com.crt" \
--custom-key "/root/ownca/test.com/test.com.key"</screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Optional: If you have created a custom SSL certificate for the new {ProjectServer} host name, run the {Project} installation script to install the certificate.
For more information about installing a custom SSL certificate, see {InstallingProjectDocURL}deploying-a-custom-ssl-certificate-to-satellite-server_{project-context}[Deploying a Custom SSL Certificate to {ProjectServer}] in <emphasis>Installing {ProjectServer} from a Connected Network</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On all {Project} clients, enter the following commands to reinstall the bootstrap RPM, reregister clients, and refresh their subscriptions.</simpara>
<simpara>You can use remote execution feature to perform this step.
For more information, see {ManagingHostsDocURL}configuring-and-setting-up-remote-jobs_managing-hosts[Configuring and Setting up Remote Jobs] in <emphasis>Managing Hosts</emphasis>.</simpara>
<screen># yum remove -y katello-ca-consumer*

# rpm -Uvh http://<emphasis>new-{foreman-example-com}</emphasis>/pub/katello-ca-consumer-latest.noarch.rpm

# subscription-manager register \
--org="<emphasis>Default_Organization</emphasis>" \
--environment="<emphasis>Library</emphasis>" \
--force

# subscription-manager refresh</screen>
</listitem>
<listitem>
<simpara>On all {SmartProxyServer}s, run the {Project} installation script to update references to the new host name:</simpara>
<screen># {foreman-installer} \
--foreman-proxy-content-parent-fqdn <emphasis>new-{foreman-example-com}</emphasis> \
--foreman-proxy-foreman-base-url https://<emphasis>new-{foreman-example-com}</emphasis> \
--foreman-proxy-trusted-hosts <emphasis>new-{foreman-example-com}</emphasis></screen>
</listitem>
<listitem>
<simpara>On {ProjectServer}, list all {SmartProxyServer}s:</simpara>
<screen># hammer proxy list</screen>
</listitem>
<listitem>
<simpara>On {ProjectServer}, synchronize content for each {SmartProxyServer}:</simpara>
<screen># hammer proxy_content synchronize \
--id <emphasis>proxy_id_number</emphasis></screen>
</listitem>
</orderedlist>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Renaming_a_Capsule_Server">
<title>Renaming {SmartProxyServer}</title>
<simpara>The host name of {SmartProxyServer} is referenced by {ProjectServer} components, and all hosts registered to it.
This procedure ensures that you update all references to the new host name.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Backup {SmartProxyServer}.
The <literal>{project-change-hostname}</literal> script makes irreversible changes to {SmartProxyServer}.
If the renaming process is not successful, you must restore it from a backup.</simpara>
<simpara>{ProjectName} does not provide a native backup method for {SmartProxyServer}.
For more information, see <xref linkend="backing-up-satellite-server-and-capsule-server"/>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On {ProjectServer}, generate a new certificates archive file for {SmartProxyServer}.</simpara>
<itemizedlist>
<listitem>
<simpara>If you are using the default SSL certificate, enter the following command:</simpara>
<screen># {certs-generate} \
--foreman-proxy-fqdn <emphasis>new-{smartproxy-example-com}</emphasis> \
--certs-tar /root/<emphasis>new-{smartproxy-example-com}-certs.tar</emphasis></screen>
<simpara>Ensure that you enter the full path to the <literal>.tar</literal> file.</simpara>
</listitem>
<listitem>
<simpara>If you are using a custom SSL certificate, create a new SSL certificate for {SmartProxyServer}.
For more information, see {InstallingSmartProxyDocURL}configuring-capsule-custom-server-certificate_{smart-proxy-context}[Configuring {SmartProxyServer} with a Custom SSL Certificate] in <emphasis>Installing {SmartProxyServer}</emphasis>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>On {ProjectServer}, copy the certificates archive file to {SmartProxyServer}, providing the <literal>root</literal> user’s password when prompted.
In this example the archive file is copied to the <literal>root</literal> user’s home directory, but you may prefer to copy it elsewhere.</simpara>
<screen># scp /root/<emphasis>new-{smartproxy-example-com}-certs.tar</emphasis> root@<emphasis>{smartproxy-example-com}</emphasis>:</screen>
</listitem>
<listitem>
<simpara>On {SmartProxyServer}, run the <literal>{project-change-hostname}</literal> script and provide the host’s new name, {Project} credentials, and certificates archive filename.</simpara>
<screen># {project-change-hostname} <emphasis>new-{smart-proxy-context}</emphasis> --username <emphasis>admin</emphasis> \
--password <emphasis>password</emphasis> \
--certs-tar /root/<emphasis>new-{smartproxy-example-com}-certs.tar</emphasis></screen>
<simpara>Ensure that you enter the full path to the <literal>.tar</literal> file.</simpara>
</listitem>
<listitem>
<simpara>Optional: If you have created a custom certificate for {SmartProxyServer}, on {SmartProxyServer}, to deploy the certificate, enter the <literal>{foreman-installer}</literal> command that the <literal>{certs-generate}</literal> command returns.
For more information, see {InstallingSmartProxyDocURL}deploying-a-custom-ssl-certificate-to-capsule-server_{smart-proxy-context}[Deploying a Custom SSL Certificate to {SmartProxyServer}] in <emphasis>Installing {SmartProxyServer}</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On all {SmartProxy} clients, enter the following commands to reinstall the bootstrap RPM, reregister clients, and refresh their subscriptions.</simpara>
<simpara>You can use remote execution feature to perform this step.
For more information, see {ManagingHostsDocURL}configuring-and-setting-up-remote-jobs_managing-hosts[Configuring and Setting up Remote Jobs] in <emphasis>Managing Hosts</emphasis>.</simpara>
<screen># yum remove -y katello-ca-consumer*

# rpm -Uvh http://<emphasis>new-{smartproxy-example-com}</emphasis>/pub/katello-ca-consumer-latest.noarch.rpm

# subscription-manager register --org="<emphasis>Default_Organization</emphasis>" \
--environment="<emphasis>Library</emphasis>" \
--force

# subscription-manager refresh</screen>
</listitem>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Infrastructure</emphasis> &gt; <emphasis role="strong">{SmartProxies}</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate {SmartProxyServer} in the list, and click <emphasis role="strong">Edit</emphasis> to the right of it.</simpara>
</listitem>
<listitem>
<simpara>Edit the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">URL</emphasis> fields to match the {SmartProxyServer}'s new host name, then click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On your DNS server, add a record for the {SmartProxyServer}'s new host name, and delete the record for the previous host name.</simpara>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Maintaining_a_Red_Hat_Satellite_Server">
<title>Maintaining {ProjectServer}</title>
<simpara>This chapter provides information on how to maintain a {ProjectName} Server, including information on how to work with audit records, how to clean unused tasks, and how to recover Pulp from a full disk.</simpara>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Deleting_Audit_Records">
<title>Deleting Audit Records</title>
<simpara>Audit records are created automatically in {Project}.
You can use the <literal>foreman-rake audits:expire</literal> command to remove audits at any time.
You can also use a cron job to schedule audit record deletions at the set interval that you want.</simpara>
<simpara>By default, using the <literal>foreman-rake audits:expire</literal> command removes audit records that are older than 90 days.
You can specify the number of days to keep the audit records by adding the <emphasis role="strong">days</emphasis> option and add the number of days.</simpara>
<simpara>For example, if you want to delete audit records that are older than seven days, enter the following command:</simpara>
<screen># foreman-rake audits:expire days=7</screen>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Anonymizing_Audit_Records">
<title>Anonymizing Audit Records</title>
<simpara>You can use the <literal>foreman-rake audits:anonymize</literal> command to remove any user account or IP information while maintaining the audit records in the database.
You can also use a cron job to schedule anonymizing the audit records at the set interval that you want.</simpara>
<simpara>By default, using the <literal>foreman-rake audits:anonymize</literal> command anonymizes audit records that are older than 90 days.
You can specify the number of days to keep the audit records by adding the <emphasis role="strong">days</emphasis> option and add the number of days.</simpara>
<simpara>For example, if you want to anonymize audit records that are older than seven days, enter the following command:</simpara>
<screen># foreman-rake audits:anonymize days=7</screen>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_the_Cleaning_Unused_Tasks_Feature">
<title>Configuring the Cleaning Unused Tasks Feature</title>
<simpara>{Project} performs regular cleaning to reduce disc space in the database and limit the rate of disk growth.
As a result, {Project} backup completes faster and overall performance is higher.</simpara>
<simpara>By default, {Project} executes a cron job that cleans tasks every day at 19:45.
{Project} removes the following tasks during the cleaning:</simpara>
<itemizedlist>
<listitem>
<simpara>Tasks that have run successfully and are older than thirty days</simpara>
</listitem>
<listitem>
<simpara>All tasks that are older than a year</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>For {Project}s Upgraded from Previous Versions</title>
<para>Until <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1788615">BZ#1788615</link> is resolved, this functionality works only on fresh installations of {ProjectXY} and later.
If you upgrade {Project} from previous versions, this functionality is disabled by default.
To enable {Project} to perform regular cleaning, enter the following command:</para>
</formalpara>
<screen># {foreman-installer} --foreman-plugin-tasks-automatic-cleanup true</screen>
<simpara>Optionally use this procedure to adjust the configuration to serve your needs.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Optional: To configure the time at which {Project} runs the cron job, set the <literal>--foreman-plugin-tasks-cron-line</literal> parameter to the time you want in cron format.
For example, to schedule the cron job to run every day at 15:00, enter the following command:</simpara>
<screen># {foreman-installer} --foreman-plugin-tasks-cron-line "00 15 * * *"</screen>
</listitem>
<listitem>
<simpara>Optional: To configure the period after which {Project} deletes the tasks, edit the <literal>:rules:</literal> section in the <literal>/etc/foreman/plugins/foreman-tasks.yaml</literal> file.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Recovering_from_a_Full_Disk">
<title>Recovering from a Full Disk</title>
<simpara>The following procedure describes how to resolve the situation when a logical volume (LV) with the Pulp database on it has no free space.</simpara>
<orderedlist xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-to_Recover_from_a_Full_Disk" numeration="arabic">
<title>To recover from a full disk</title>
<listitem>
<simpara>Let running Pulp tasks finish but do not trigger any new ones as they can fail due to the full disk.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the LV with the <literal>/var/lib/pulp</literal> directory on it has sufficient free space.
Here are some ways to achieve that:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Remove orphaned content:</simpara>
<screen># foreman-rake katello:delete_orphaned_content RAILS_ENV=production</screen>
<simpara>This is run weekly so it will not free much space.</simpara>
</listitem>
<listitem>
<simpara>Change the download policy from <emphasis role="strong">Immediate</emphasis> to <emphasis role="strong">On Demand</emphasis> for as many repositories as possible and remove already downloaded packages.
See the Red Hat Knowledgebase solution <link xlink:href="https://access.redhat.com/solutions/2785021">How to change syncing policy for Repositories on Satellite from "Immediate" to "On-Demand"</link> on the Red Hat Customer Portal for instructions.</simpara>
</listitem>
<listitem>
<simpara>Grow the file system on the LV with the <literal>/var/lib/pulp</literal> directory on it.
For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/logical_volume_manager_administration/fsgrow_overview">Growing a File System on a Logical Volume</link> in the <emphasis>Red Hat Enterprise Linux 7 Logical Volume Manager Administration Guide</emphasis>.</simpara>
<note>
<simpara>If you use an untypical file system (other than for example ext3, ext4, or xfs), you might need to unmount the file system so that it is not in use.
In that case, complete the following steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Stop the <literal>{foreman-maintain}</literal> services:</simpara>
<screen># {foreman-maintain} service stop</screen>
</listitem>
<listitem>
<simpara>Grow the file system on the LV.</simpara>
</listitem>
<listitem>
<simpara>Start the <literal>{foreman-maintain}</literal> services:</simpara>
<screen># {foreman-maintain} service start</screen>
</listitem>
</orderedlist>
</note>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>If some Pulp tasks failed due to the full disk, run them again.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="reclaiming-postgresql-space-after-an-upgrade_admin">
<title>Reclaiming PostgreSQL Space</title>
<simpara>The PostgreSQL database can use a large amount of disk space especially in heavily loaded deployments.
Use this procedure to reclaim some of this disk space on {Project}.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Stop all services, except for the <literal>postgresql</literal> service:</simpara>
<screen># {foreman-maintain} service stop --exclude postgresql</screen>
</listitem>
<listitem>
<simpara>Switch to the <literal>postgres</literal> user and reclaim space on the database:</simpara>
<screen># su - postgres -c 'vacuumdb --full --dbname=foreman'</screen>
</listitem>
<listitem>
<simpara>Start the other services when the vacuum completes:</simpara>
<screen># {foreman-maintain} service start</screen>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Logging_and_Reporting_Problems">
<title>Logging and Reporting Problems</title>
<simpara>This chapter provides information on how to log and report problems in {ProjectName} Server, including information on relevant log files, how to enable debug logging, how to open a support case and attach the relevant log tar files, and how to access support cases within the {Project} web UI.</simpara>
<simpara>You can use the log files and other information described in this chapter to do your own troubleshooting, or you can capture these and many more files, as well as diagnostic and configuration information, to send to Red Hat Support if you need further assistance.</simpara>
<simpara>For more information about {Project} logging settings, use <literal>{foreman-installer}</literal> with the <literal>--full-help</literal> option:</simpara>
<screen># {foreman-installer} --full-help | grep logging</screen>
<section xml:id="enabling-debug-logging_admin">
<title>Enabling Debug Logging</title>
<simpara>Debug logging provides the most detailed log information and can help with troubleshooting issues that can arise with {Project} 6.9-beta and its components.</simpara>
<simpara>In the {Project} CLI, enable debug logging to log detailed debugging information for {Project} 6.9-beta.</simpara>
<formalpara>
<title>Procedure</title>
<para>To enable debug logging, complete the following steps on your {ProjectServer}.</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>To enable debug logging, enter the following command :</simpara>
<screen># {foreman-installer} --foreman-logging-level debug</screen>
</listitem>
<listitem>
<simpara>After you complete debugging, reset the logging level to the default value:</simpara>
<screen># {foreman-installer} --reset-foreman-logging-level</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="enabling_individual_loggers" remap="_enabling_individual_loggers">
<title>Enabling Individual Loggers</title>
<simpara>You can enable individual loggers for selective logging.
{Project} uses the following loggers:</simpara>
<variablelist>
<varlistentry>
<term><literal>app</literal></term>
<listitem>
<simpara>Logs web requests and all general application messages.
Default value: true.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>audit</literal></term>
<listitem>
<simpara>Logs additional fact statistics, numbers of added, updated, and removed facts.
Default value: true.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>ldap</literal></term>
<listitem>
<simpara>Logs high level LDAP queries and LDAP operations.
Default value: false.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>permissions</literal></term>
<listitem>
<simpara>Logs queries to user roles, filters, and permissions when loading pages.
Default value: false.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>sql</literal></term>
<listitem>
<simpara>Logs SQL queries made through Rails ActiveRecord.
Default value: false.</simpara>
</listitem>
</varlistentry>
</variablelist>
<formalpara>
<title>Procedure</title>
<para>To enable individual loggers, complete the following steps.</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enable the individual loggers that you want.
For example, to enable <literal>sql</literal> and <literal>ldap</literal> loggers, enter the following command:</simpara>
<screen># {foreman-installer} --foreman-loggers sql:true --foreman-loggers ldap:true</screen>
</listitem>
<listitem>
<simpara>Optional: To reset loggers to their default values, enter the following command:</simpara>
<screen># {foreman-installer} --reset-foreman-loggers</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-logging-to-journal">
<title>Configuring Logging to Journal</title>
<simpara>You can configure {Project} to manage logging with Journal.
Journal then forwards log messages to <literal>rsyslog</literal> and <literal>rsyslog</literal> writes the log messages to <literal>/var/log/messages</literal>.
Note that after this change the log messages do not appear in <literal>/var/log/foreman/production.log</literal> or <literal>/var/log/foreman-proxy.log</literal> any more.</simpara>
<simpara>For more information about Journal, see <link xlink:href="https://github.com/lzap/foreman-elasticsearch">https://github.com/lzap/foreman-elasticsearch</link>.</simpara>
<formalpara>
<title>Procedure</title>
<para>To configure {ProjectServer} logging with Journal, complete the following steps:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enter the following <literal>{foreman-installer}</literal> command to configure logging to <literal>journald</literal>:</simpara>
<screen># {foreman-installer} --foreman-logging-level info \
--foreman-logging-type journald \
--foreman-logging-layout pattern --foreman-proxy-log JOURNAL</screen>
</listitem>
<listitem>
<simpara>Restart the Apache daemon:</simpara>
<screen># {foreman-maintain} service restart --only httpd</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="log-file-directories-provided-by-satellite_admin">
<title>Log File Directories Provided by {Project}</title>
<simpara>{ProjectName} provides system information in the form of notifications and log files.</simpara>
<table xml:id="tabl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Logging_and_Reporting-Log_Files_for_Reporting_and_Troubleshooting" frame="all" rowsep="1" colsep="1">
<title>Log File Directories for Reporting and Troubleshooting</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Log File Directories</entry>
<entry align="left" valign="top">Description of Log File Content</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>/var/log/candlepin</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Subscription management</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>/var/log/foreman</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Foreman</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>/var/log/foreman-proxy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Foreman proxy</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>/var/log/httpd</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Apache HTTP server</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>/var/log/foreman-installer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Installer</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>/var/log/puppet</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Configuration management</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>/var/log/rhsm</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Subscription management</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>/var/log/tomcat</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Candlepin webservice logs</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>/var/log/messages</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Various other log messages</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>You can also use the <literal>foreman-tail</literal> command to follow many of the log files related to {Project}.
You can run <literal>foreman-tail -l</literal> to list the processes and services that it follows.</simpara>
</section>
<section xml:id="utilities-for-collecting-log-information_admin">
<title>Utilities for Collecting Log Information</title>
<simpara>There are two utilities available to collect information from log files.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Log Collecting Utilities</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="22*"/>
<colspec colname="col_2" colwidth="78*"/>
<thead>
<row>
<entry align="left" valign="top">Command</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>foreman-debug</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>foreman-debug</literal> command collects configuration and log file data for {ProjectName}, its back-end services, and system information.
This information is collected and written to a tar file.
By default, the output tar file is located at <literal>/tmp/<emphasis>foreman-debug-xxx.tar.xz</emphasis></literal>.</simpara><simpara>Additionally, the <literal>foreman-debug</literal> command exports tasks run during the last 60 days.
By default, the output tar file is located at <literal>/tmp/<emphasis>task-export-xxx.tar.xz</emphasis></literal>.
If the file is missing, see the file <literal>/tmp/task-export.log</literal> to learn why task export was unsuccessful.</simpara><simpara>For more information, run <literal>foreman-debug --help</literal>.</simpara><simpara>There is no timeout when running this command.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sosreport</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>sosreport</literal> command is a tool that collects configuration and diagnostic information from a Red Hat Enterprise Linux system, such as the running kernel version, loaded modules, and system and service configuration files.
The command also runs external programs (for example: <literal>foreman-debug -g</literal>) to collect {Project}-specific information, and stores this output in a tar file.</simpara><simpara>By default, the output tar file is located at <literal>/var/tmp/<emphasis>sosreport-XXX-20171002230919.tar.xz</emphasis></literal>.
For more information, run <literal>sosreport --help</literal> or see <link xlink:href="https://access.redhat.com/solutions/3592"><emphasis>What is a sosreport and how can I create one?</emphasis></link>.</simpara><simpara>The <literal>sosreport</literal> command calls the <literal>foreman-debug -g</literal> and times out after 500 seconds.
If your {ProjectServer} has large log files or many {Project} tasks, support engineers may require the output of <literal>sosreport</literal> and <literal>foreman-debug</literal> when you open a support case.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<important>
<simpara>Both <literal>foreman-debug</literal> and <literal>sosreport</literal> remove security information such as passwords, tokens, and keys while collecting information.
However, the tar files can still contain sensitive information about the {ProjectName} Server.
Red Hat recommends that you send this information directly to the intended recipient and not to a public target.</simpara>
</important>
</section>
</chapter>
<chapter xml:id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_External_Authentication">
<title>Configuring External Authentication</title>
<simpara>By using external authentication you can derive user and user group permissions from user group membership in an external identity provider.
When you use external authentication, you do not have to create these users and maintain their group membership manually on {ProjectServer}.</simpara>
<formalpara>
<title>Important User and Group Account Information</title>
<para>All user and group accounts must be local accounts.
This is to ensure that there are no authentication conflicts between local accounts on your {ProjectServer} and accounts in your Active Directory domain.</para>
</formalpara>
<simpara>Your system is not affected by this conflict if your user and group accounts exist in both <literal>/etc/passwd</literal> and <literal>/etc/group</literal> files.
For example, to check if entries for <literal>puppet</literal>, <literal>apache</literal>, <literal>foreman</literal> and <literal>foreman-proxy</literal> groups exist in both <literal>/etc/passwd</literal> and <literal>/etc/group</literal> files, enter the following commands:</simpara>
<screen># cat /etc/passwd | grep 'puppet\|apache\|foreman\|foreman-proxy'
# cat /etc/group | grep 'puppet\|apache\|foreman\|foreman-proxy'</screen>
<formalpara>
<title>Scenarios for Configuring External Authentication</title>
<para>{ProjectName} supports the following general scenarios for configuring external authentication:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Using <emphasis>Lightweight Directory Access Protocol</emphasis> (LDAP) server as an external identity provider.
LDAP is a set of open protocols used to access centrally stored information over a network.
With {Project}, you can manage LDAP entirely through the {Project} web UI.
For more information, see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Using_LDAP"/>.
Though you can use LDAP to connect to a {FreeIPA} or AD server, the setup does not support server discovery, cross-forest trusts, or single sign-on with Kerberos in {Project}'s web UI.</simpara>
</listitem>
<listitem>
<simpara>Using a {FreeIPA} server as an external identity provider.
{FreeIPA} deals with the management of individual identities, their credentials and privileges used in a networking environment.
Configuration using {FreeIPA} cannot be completed using only the {Project} web UI and requires some interaction with the CLI.
For more information see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Configuring_External_Authentication-Using_Identity_Management"/>.</simpara>
</listitem>
<listitem>
<simpara>Using <emphasis>Active Directory</emphasis> (AD) integrated with {FreeIPA} through cross-forest Kerberos trust as an external identity provider.
For more information see <xref linkend="active-directory-with-cross-forest-trust_admin"/>.</simpara>
</listitem>
<listitem>
<simpara>Using {Keycloak} as an OpenID provider for external authentication to {Project}.
For more information, see <xref linkend="configuring-project-with-keycloak-authentication_admin"/>.</simpara>
</listitem>
<listitem>
<simpara>Using {Keycloak} as an OpenID provider for external authentication to {Project} with TOTP.
For more information, see <xref linkend="configuring-keycloak-authentication-with-totp_admin"/>.</simpara>
</listitem>
<listitem>
<simpara>Using {Keycloak} as an OpenID provider for external authentication to {Project} with {PIV} cards.
For more information, see <xref linkend="configuring-keycloak-authentication-with-cac-cards_admin"/>.</simpara>
</listitem>
</itemizedlist>
<simpara>As well as providing access to {ProjectServer}, hosts provisioned with {Project} can also be integrated with {FreeIPA} realms.
{ProjectName} has a realm feature that automatically manages the life cycle of any system registered to a realm or domain provider.
For more information, see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Configuring_External_Authentication-External_Authentication_for_Provisioned_Hosts"/>.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Authentication Overview</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Authentication</entry>
<entry align="left" valign="top">User Groups</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>{FreeIPA}</simpara></entry>
<entry align="left" valign="top"><simpara>Kerberos or LDAP</simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Active Directory</simpara></entry>
<entry align="left" valign="top"><simpara>Kerberos or LDAP</simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>POSIX</simpara></entry>
<entry align="left" valign="top"><simpara>LDAP</simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Using_LDAP">
<title>Using LDAP</title>
<simpara xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Using_Configuring_TLS_for_Secure-LDAP">If you require {ProjectName} to use <literal>TLS</literal> to establish a secure LDAP connection (LDAPS), first obtain certificates used by the LDAP server you are connecting to and mark them as trusted on the base operating system of your {ProjectServer} as described below.
If your LDAP server uses a certificate chain with intermediate certificate authorities, all of the root and intermediate certificates in the chain must be trusted, so ensure all certificates are obtained.
If you do not require secure LDAP at this time, proceed to <xref linkend="configuring-red-hat-satellite-to-use-ldap_admin"/>.</simpara>
<formalpara>
<title>Using SSSD Configuration</title>
<para>Though direct LDAP integration is covered in this section, Red Hat recommends that you use SSSD and configure it against {FreeIPA}, AD, or an LDAP server.
SSSD improves the consistency of the authentication process.
For more information about the preferred configurations, see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Configuring_External_Authentication-Using_Active_Directory"/>.
You can also cache the SSSD credentials and use them for LDAP authentication.
For more information on SSSD, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system-level_authentication_guide/sssd">Configuring SSSD</link> in the <emphasis>Red Hat Enterprise Linux 7 System-Level Authentication Guide</emphasis>.</para>
</formalpara>
<section xml:id="configuring-tls-for-secure-ldap_admin">
<title>Configuring TLS for Secure LDAP</title>
<simpara>Use the {Project} CLI to configure TLS for secure LDAP (LDAPS).</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Obtain the Certificate from the LDAP Server.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>If you use Active Directory Certificate Services, export the Enterprise PKI CA Certificate using the Base-64 encoded X.509 format.
See <link xlink:href="https://access.redhat.com/solutions/1498773">How to configure Active Directory authentication with <literal>TLS</literal> on {ProjectX}</link> for information on creating and exporting a CA certificate from an Active Directory server.</simpara>
</listitem>
<listitem>
<simpara>Download the LDAP server certificate to a temporary location on the Red Hat Enterprise Linux system where the {ProjectServer} is installed and remove it when finished.</simpara>
<simpara>For example, <literal>/tmp/example.crt</literal>.
The filename extensions <literal>.cer</literal> and <literal>.crt</literal> are only conventions and can refer to DER binary or PEM ASCII format certificates.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Trust the Certificate from the LDAP Server.</simpara>
<simpara>{ProjectName} Server requires the CA certificates for LDAP authentication to be individual files in <literal>/etc/pki/tls/certs/</literal> directory.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Use the <literal>install</literal> command to install the imported certificate into the <literal>/etc/pki/tls/certs/</literal> directory with the correct permissions:</simpara>
<screen># install /tmp/<emphasis>example.crt</emphasis> /etc/pki/tls/certs/</screen>
</listitem>
<listitem>
<simpara>Enter the following command as <literal>root</literal> to trust the <emphasis>example.crt</emphasis> certificate obtained from the LDAP server:</simpara>
<screen># ln -s <emphasis>example.crt</emphasis> /etc/pki/tls/certs/$(openssl \
x509 -noout -hash -in \
/etc/pki/tls/certs/<emphasis>example.crt</emphasis>).0</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>httpd</literal> service:</simpara>
<screen># systemctl restart httpd</screen>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-red-hat-satellite-to-use-ldap_admin">
<title>Configuring {ProjectName} to use LDAP</title>
<simpara>In the {Project} web UI, configure {Project} to use LDAP.</simpara>
<simpara>Note that if you need single sign-on functionality with Kerberos on {Project}'s web UI, you should use {FreeIPA} and AD external authentication instead.
See <link linkend="sect-{Project_Link}-Administering_{Project_Link}-Configuring_External_Authentication-Using_Identity_Management">Using {FreeIPA}</link> or <link linkend="sect-{Project_Link}-Administering_{Project_Link}-Configuring_External_Authentication-Using_Active_Directory">Using Active Directory
</link> for more information on those options.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Set the Network Information System (NIS) service boolean to true to prevent SELinux from stopping outgoing LDAP connections:</simpara>
<screen># setsebool -P nis_enabled on</screen>
</listitem>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">LDAP Authentication</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create Authentication Source</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">LDAP server</emphasis> tab, enter the LDAP server’s name, host name, port, and server type.
The default port is 389, the default server type is POSIX (alternatively you can select FreeIPA or Active Directory depending on the type of authentication server).
For <literal>TLS</literal> encrypted connections, select the <emphasis role="strong">LDAPS</emphasis> check box to enable encryption.
The port should change to 636, which is the default for LDAPS.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Account</emphasis> tab, enter the account information and domain name details.
See <xref linkend="description-of-ldap-settings_admin"/> for descriptions and examples.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Attribute mappings</emphasis> tab, map LDAP attributes to {Project} attributes.
You can map login name, first name, last name, email address, and photo attributes.
See <xref linkend="example-settings-for-ldap-connections_admin"/> for examples.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Locations</emphasis> tab, select locations from the left table.
Selected locations are assigned to users created from the LDAP authentication source, and available after their first login.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">Organizations</emphasis> tab, select organizations from the left table.
Selected organizations are assigned to users created from the LDAP authentication source, and available after their first login.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Configure new accounts for LDAP users:</simpara>
<itemizedlist>
<listitem>
<simpara>If you did not select <emphasis role="strong">Automatically Create Accounts In {Project}</emphasis> check box, see <xref linkend="creating-a-user_admin"/> to create user accounts manually.</simpara>
</listitem>
<listitem>
<simpara>If you selected the <emphasis role="strong">Automatically Create Accounts In {Project}</emphasis> check box, LDAP users can now log in to {Project} using their LDAP accounts and passwords.
After they log in for the first time, the {Project} administrator has to assign roles to them manually.
See <xref linkend="assigning-roles-to-a-user_admin"/> to assign user accounts appropriate roles in {Project}.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="description-of-ldap-settings_admin">
<title>Description of LDAP Settings</title>
<simpara>The following table provides a description for each setting in the <emphasis role="strong">Account</emphasis> tab.</simpara>
<table xml:id="tabl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Description_of_Account_Tab_Settings_for_Active_Directory_LDAP_Connection" frame="all" rowsep="1" colsep="1">
<title>Account Tab Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="22*"/>
<colspec colname="col_2" colwidth="78*"/>
<thead>
<row>
<entry align="left" valign="top">Setting</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Account</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The user name of the LDAP account that has read access to the LDAP server.
User name is not required if the server allows anonymous reading, otherwise use the full path to the user’s object.
For example:</simpara>
<screen>uid=$login,cn=users,cn=accounts,dc=example,dc=com</screen>
<simpara>The <literal>$login</literal> variable stores the username entered on the login page as a literal string.
The value is accessed when the variable is expanded.</simpara>
<simpara>The variable cannot be used with external user groups from an LDAP source because {Project} needs to retrieve the group list without the user logging in.
Use either an anonymous, or dedicated service user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Account password</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The LDAP password for the user defined in the <emphasis role="strong">Account username</emphasis> field.
This field can remain blank if the <emphasis role="strong">Account username</emphasis> is using the <literal>$login</literal> variable.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Base DN</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The top level domain name of the LDAP directory.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Groups base DN</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The top level domain name of the LDAP directory tree that contains groups.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">LDAP filter</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A filter to restrict LDAP queries.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Automatically Create Accounts In {Project}</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If this check box is selected, {Project} creates user accounts for LDAP users when they log in to {Project} for the first time.
After they log in for the first time, the {Project} administrator has to assign roles to them manually.
See <xref linkend="assigning-roles-to-a-user_admin"/> to assign user accounts appropriate roles in {Project}.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Usergroup Sync</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If this option is selected, the user group membership of a user is automatically synchronized when the user logs in, which ensures the membership is always up to date.
If this option is cleared, {Project} relies on a cron job to regularly synchronize group membership (every 30 minutes by default).
See <xref linkend="proc-{Project_Link}-Administering_{Project_Link}-Configuring_External_User_Groups-To_Configure_an_External_User_Group"/> for further context.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="example-settings-for-ldap-connections_admin">
<title>Example Settings for LDAP Connections</title>
<simpara>The following table shows example settings for different types of LDAP connections.
The example below uses a dedicated service account called <emphasis>redhat</emphasis> that has bind, read, and search permissions on the user and group entries.
Note that LDAP attribute names are case sensitive.</simpara>
<table xml:id="tabl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Using_LDAP-Example_Settings_for_Active_Directory_LDAP_Connection" frame="all" rowsep="1" colsep="1">
<title>Example Settings for Active Directory, Free IPA or Red Hat Identity Management and POSIX LDAP Connections</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="14*"/>
<colspec colname="col_2" colwidth="29*"/>
<colspec colname="col_3" colwidth="29*"/>
<colspec colname="col_4" colwidth="29*"/>
<thead>
<row>
<entry align="left" valign="top">Setting</entry>
<entry align="left" valign="top">Active Directory</entry>
<entry align="left" valign="top">FreeIPA or Red Hat Identity Management</entry>
<entry align="left" valign="top">POSIX (OpenLDAP)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Account</simpara></entry>
<entry align="left" valign="top"><simpara>DOMAIN\redhat</simpara></entry>
<entry align="left" valign="top"><simpara>uid=redhat,cn=users,
cn=accounts,dc=example,
dc=com</simpara></entry>
<entry align="left" valign="top"><simpara>uid=redhat,ou=users,
dc=example,dc=com</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Account password</simpara></entry>
<entry align="left" valign="top"><simpara>P@ssword</simpara></entry>
<entry align="left" valign="top"><simpara>-</simpara></entry>
<entry align="left" valign="top"><simpara>-</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Base DN</simpara></entry>
<entry align="left" valign="top"><simpara>DC=example,DC=COM</simpara></entry>
<entry align="left" valign="top"><simpara>dc=example,dc=com</simpara></entry>
<entry align="left" valign="top"><simpara>dc=example,dc=com</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Groups Base DN</simpara></entry>
<entry align="left" valign="top"><simpara>CN=Users,DC=example,DC=com</simpara></entry>
<entry align="left" valign="top"><simpara>cn=groups,cn=accounts,
dc=example,dc=com</simpara></entry>
<entry align="left" valign="top"><simpara>cn=employee,ou=userclass,
dc=example,dc=com</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Login name attribute</simpara></entry>
<entry align="left" valign="top"><simpara>userPrincipalName</simpara></entry>
<entry align="left" valign="top"><simpara>uid</simpara></entry>
<entry align="left" valign="top"><simpara>uid</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>First name attribute</simpara></entry>
<entry align="left" valign="top"><simpara>givenName</simpara></entry>
<entry align="left" valign="top"><simpara>givenName</simpara></entry>
<entry align="left" valign="top"><simpara>givenName</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Last name attribute</simpara></entry>
<entry align="left" valign="top"><simpara>sn</simpara></entry>
<entry align="left" valign="top"><simpara>sn</simpara></entry>
<entry align="left" valign="top"><simpara>sn</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Email address attribute</simpara></entry>
<entry align="left" valign="top"><simpara>mail</simpara></entry>
<entry align="left" valign="top"><simpara>mail</simpara></entry>
<entry align="left" valign="top"><simpara>mail</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<note>
<simpara><literal>userPrincipalName</literal> allows the use of whitespace in usernames.
The login name attribute <literal>sAMAccountName</literal> (which is not listed in the table above) provides backwards compatibility with legacy Microsoft systems.
<literal>sAMAccountName</literal> does not allow the use of whitespace in usernames.</simpara>
</note>
</section>
<section xml:id="example-ldap-filters_admin">
<title>Example LDAP Filters</title>
<simpara>As an administrator, you can create LDAP filters to restrict the access of specific users to {Project}.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Example filters for allowing specific users to login</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="75*"/>
<thead>
<row>
<entry align="left" valign="top">User</entry>
<entry align="left" valign="top">Filter</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>User1, User3</simpara></entry>
<entry align="left" valign="top"><simpara>(memberOf=cn=Group1,cn=Users,dc=domain,dc=example)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>User2, User3</simpara></entry>
<entry align="left" valign="top"><simpara>(memberOf=cn=Group2,cn=Users,dc=domain,dc=example)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>User1, User2, User3</simpara></entry>
<entry align="left" valign="top"><simpara>(|(memberOf=cn=Group1,cn=Users,dc=domain,dc=example)(memberOf=cn=Group2,cn=Users,dc=domain,dc=example))</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<formalpara>
<title>LDAP directory structure</title>
<para>The LDAP directory structure that the filters in the example use:</para>
</formalpara>
<screen>DC=Domain,DC=Example
   |
   |----- CN=Users
         |
         |----- CN=Group1
         |----- CN=Group2
         |----- CN=User1
         |----- CN=User2
         |----- CN=User3</screen>
<formalpara>
<title>LDAP group membership</title>
<para>The group membership that the filters in the example use:</para>
</formalpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="67*"/>
<thead>
<row>
<entry align="left" valign="top">Group</entry>
<entry align="left" valign="top">Members</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Group1</simpara></entry>
<entry align="left" valign="top"><simpara>User1,
User3</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Group2</simpara></entry>
<entry align="left" valign="top"><simpara>User2,
User3</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_External_Authentication-Using_Identity_Management">
<title>Using {FreeIPA}</title>
<simpara>This section shows how to integrate {ProjectName} Server with a {FreeIPA} server and how to enable host-based access control.</simpara>
<note>
<simpara>You can attach {FreeIPA} as an external authentication source with no single sign-on support.
For more information, see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Using_LDAP"/>.</simpara>
</note>
<itemizedlist xml:id="br-Using-IdM-for-Authentication-prereq">
<title>Prerequisites</title>
<listitem>
<simpara>The {ProjectServer} has to run on Red Hat Enterprise Linux 7.1 or Red Hat Enterprise Linux 6.6 or later.</simpara>
</listitem>
<listitem>
<simpara>The base operating system of the {ProjectServer} must be enrolled in the {FreeIPA} domain by the {FreeIPA} administrator of your organization.</simpara>
</listitem>
</itemizedlist>
<simpara>The examples in this chapter assume separation between {FreeIPA} and {Project} configuration.
However, if you have administrator privileges for both servers, you can configure {FreeIPA} as described in <link xlink:href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/index.html#ldi-install">Red Hat Enterprise Linux 7 Linux Domain Identity, Authentication, and Policy Guide</link>.</simpara>
<section xml:id="configuring-idm-authentication-on-satellite-server_admin">
<title>Configuring {FreeIPA} Authentication on {ProjectServer}</title>
<simpara>In the {Project} CLI, configure {FreeIPA} authentication by first creating a host entry on the {FreeIPA} server.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On the {FreeIPA} server, to authenticate, enter the following command and enter your password when prompted:</simpara>
<screen># kinit <emphasis>admin</emphasis></screen>
</listitem>
<listitem>
<simpara>To verify that you have authenticated, enter the following command:</simpara>
<screen># klist</screen>
</listitem>
<listitem>
<simpara>On the {FreeIPA} server, create a host entry for the {ProjectServer} and generate a one-time password, for example:</simpara>
<screen># ipa host-add --random <emphasis>hostname</emphasis></screen>
<note>
<simpara>The generated one-time password must be used on the client to complete {FreeIPA}-enrollment.</simpara>
</note>
<simpara>For more information on host configuration properties, see <link xlink:href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/host-attr.html">About Host Entry Configuration Properties</link> in the <emphasis>Red Hat Enterprise Linux 7 Linux Domain Identity, Authentication, and Policy</emphasis> guide.</simpara>
</listitem>
<listitem>
<simpara>Create an HTTP service for {ProjectServer}, for example:</simpara>
<screen># ipa service-add <emphasis>servicename</emphasis>/<emphasis>hostname</emphasis></screen>
<simpara>For more information on managing services, see <link xlink:href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/services.html">Managing Services</link> in the <emphasis>Red Hat Enterprise Linux 7 Linux Domain Identity, Authentication, and Policy</emphasis> guide.</simpara>
</listitem>
<listitem>
<simpara>On {ProjectServer}, install the IPA client:</simpara>
<screen># {package-install-project} ipa-client</screen>
</listitem>
<listitem>
<simpara>On {ProjectServer}, enter the following command as root to configure {FreeIPA}-enrollment:</simpara>
<screen># ipa-client-install --password <emphasis>OTP</emphasis></screen>
<simpara>Replace <emphasis>OTP</emphasis> with the one-time password provided by the {FreeIPA} administrator.</simpara>
</listitem>
<listitem>
<simpara>If {ProjectServer} is running on Red Hat Enterprise Linux 7, execute the following command:</simpara>
<screen># subscription-manager repos --enable rhel-7-server-optional-rpms</screen>
<simpara>The installer is dependent on packages which, on Red Hat Enterprise Linux 7, are in the optional repository <literal>rhel-7-server-optional-rpms</literal>.
On Red Hat Enterprise Linux 6 all necessary packages are in the <literal>base</literal> repository.</simpara>
</listitem>
<listitem>
<simpara>Set <literal>foreman-ipa-authentication</literal> to true, using the following command:</simpara>
<screen># {foreman-installer} --foreman-ipa-authentication=true</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>{foreman-maintain}</literal> services:</simpara>
<screen># {foreman-maintain} service restart</screen>
</listitem>
</orderedlist>
<simpara>External users can now log in to {Project} using their {FreeIPA} credentials.
They can now choose to either log in to {ProjectServer} directly using their username and password or take advantage of the configured Kerberos single sign-on and obtain a ticket on their client machine and be logged in automatically.
The two-factor authentication with one-time password (2FA OTP) is also supported.
If the user in {FreeIPA} is configured for 2FA, and {ProjectServer} is running on Red Hat Enterprise Linux 7, this user can also authenticate to {Project} with an OTP.</simpara>
</section>
<section xml:id="configuring-host-based-authentication-control_admin">
<title>Configuring Host-Based Authentication Control</title>
<simpara>HBAC rules define which machine within the domain a {FreeIPA} user is allowed to access.
You can configure HBAC on the {FreeIPA} server to prevent selected users from accessing the {ProjectServer}.
With this approach, you can prevent {Project} from creating database entries for users that are not allowed to log in.
For more information on HBAC, see <link xlink:href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/configuring-host-access.html">Configuring Host-Based Access Control</link> in the <emphasis>Red Hat Enterprise Linux 7 Linux Domain Identity, Authentication, and Policy</emphasis> guide.</simpara>
<simpara>On the {FreeIPA} server, configure Host-Based Authentication Control (HBAC).</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On the {FreeIPA} server, to authenticate, enter the following command and enter your password when prompted:</simpara>
<screen># kinit <emphasis>admin</emphasis></screen>
</listitem>
<listitem>
<simpara>To verify that you have authenticated, enter the following command:</simpara>
<screen># klist</screen>
</listitem>
<listitem>
<simpara>Create HBAC service and rule on the {FreeIPA} server and link them together.
The following examples use the PAM service name <emphasis>{project-context}-prod</emphasis>.
Execute the following commands on the {FreeIPA} server:</simpara>
<screen># ipa hbacsvc-add {project-context}-prod
# ipa hbacrule-add allow_{project-context}_prod
# ipa hbacrule-add-service allow_{project-context}_prod --hbacsvcs={project-context}-prod</screen>
</listitem>
<listitem>
<simpara>Add the user who is to have access to the service {project-context}-prod, and the hostname of the {ProjectServer}:</simpara>
<screen># ipa hbacrule-add-user allow_{project-context}_prod --user=<emphasis>username</emphasis>
# ipa hbacrule-add-host allow_{project-context}_prod --hosts=<emphasis>{foreman-example-com}</emphasis></screen>
<simpara>Alternatively, host groups and user groups can be added to the <emphasis>allow</emphasis>{project-context}_prod_ rule.</simpara>
</listitem>
<listitem>
<simpara>To check the status of the rule, execute:</simpara>
<screen># ipa hbacrule-find {project-context}-prod
# ipa hbactest --user=<emphasis>username</emphasis> --host=<emphasis>{foreman-example-com}</emphasis> --service={project-context}-prod</screen>
</listitem>
<listitem>
<simpara>Ensure the allow_all rule is disabled on the {FreeIPA} server.
For instructions on how to do so without disrupting other services see the <link xlink:href="https://access.redhat.com/solutions/67895">How to configure HBAC rules in IdM</link> article on the Red Hat Customer Portal.</simpara>
</listitem>
<listitem>
<simpara>Configure the {FreeIPA} integration with the {ProjectServer} as described in <xref linkend="configuring-idm-authentication-on-satellite-server_admin"/>.
On the {ProjectServer}, define the PAM service as root:</simpara>
<screen># {foreman-installer} --foreman-pam-service={project-context}-prod</screen>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_External_Authentication-Using_Active_Directory">
<title>Using Active Directory</title>
<simpara>This section shows how to use direct Active Directory (AD) as an external authentication source for {ProjectServer}.</simpara>
<note>
<simpara>You can attach Active Directory as an external authentication source with no single sign-on support.
For more information, see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Using_LDAP"/>.
For an example configuration, see <link xlink:href="https://access.redhat.com/solutions/1498773">How to configure Active Directory authentication with TLS on {ProjectX}</link>.</simpara>
</note>
<simpara>Direct AD integration means that {ProjectServer} is joined directly to the AD domain where the identity is stored.
The recommended setup consists of two steps:</simpara>
<itemizedlist>
<listitem>
<simpara>Enrolling {ProjectServer} with the Active Directory server as described in <xref linkend="enrolling-satellite-server-with-the-ad-server_admin"/>.</simpara>
</listitem>
<listitem>
<simpara>Configuring direct Active Directory integration with GSS-proxy as described in <xref linkend="configuring-direct-ad-integration-with-gss-proxy_admin"/>.</simpara>
</listitem>
</itemizedlist>
<section xml:id="gss-proxy_admin">
<title>GSS-Proxy</title>
<simpara>The traditional process of Kerberos authentication in Apache requires the Apache process to have read access to the keytab file.
GSS-Proxy allows you to implement stricter privilege separation for the Apache server by removing access to the keytab file while preserving Kerberos authentication functionality.
When using AD as an external authentication source for {Project}, it is recommended to implement GSS-proxy, because the keys in the keytab file are the same as the host keys.</simpara>
<note>
<simpara>The AD integration requires {ProjectName} Server to be deployed on Red Hat Enterprise Linux 7.1 or later.</simpara>
</note>
<simpara>Perform the following procedures on Red Hat Enterprise Linux that acts as a base operating system for your {ProjectServer}.
For the examples in this section <emphasis>EXAMPLE.ORG</emphasis> is the Kerberos realm for the AD domain.
By completing the procedures, users that belong to the EXAMPLE.ORG realm can log in to the {ProjectServer}.</simpara>
</section>
<section xml:id="enrolling-satellite-server-with-the-ad-server_admin">
<title>Enrolling {ProjectServer} with the AD Server</title>
<simpara>In the {Project} CLI, enroll {ProjectServer} with the Active Directory server.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>GSS-proxy and nfs-utils are installed.</simpara>
<simpara>Installing GSS-proxy and nfs-utils:</simpara>
<screen># {package-install-project} gssproxy nfs-utils</screen>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Install the required packages:</simpara>
<screen># {package-install-project} sssd adcli realmd ipa-python-compat krb5-workstation samba-common-tools</screen>
</listitem>
<listitem>
<simpara>Enroll {ProjectServer} with the AD server.
You may need to have administrator permissions to perform the following command:</simpara>
<screen># realm join -v <emphasis>EXAMPLE.ORG</emphasis></screen>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-direct-ad-integration-with-gss-proxy_admin">
<title>Configuring Direct AD Integration with GSS-proxy</title>
<simpara>In the {Project} CLI, configure the direct Active Directory integration with GSS-proxy.</simpara>
<itemizedlist>
<title>Prerequisite</title>
<listitem>
<simpara>{Project} is enrolled with the Active Directory server.</simpara>
<simpara>For more information, see <xref linkend="enrolling-satellite-server-with-the-ad-server_admin"/>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Create the <literal>/etc/ipa/</literal> directory and the <literal>default.conf</literal> file:</simpara>
<screen># mkdir /etc/ipa
# touch /etc/ipa/default.conf</screen>
</listitem>
<listitem>
<simpara>To the <literal>default.conf</literal> file, add the following content:</simpara>
<screen>[global]
server = unused
realm = <emphasis>EXAMPLE.ORG</emphasis></screen>
</listitem>
<listitem>
<simpara>Create the <literal>/etc/net-keytab.conf</literal> file with the following content:</simpara>
<screen>[global]
workgroup = EXAMPLE
realm = EXAMPLE.ORG
kerberos method = system keytab
security = ads</screen>
</listitem>
<listitem>
<simpara>Determine the effective user ID of the Apache user:</simpara>
<screen># id apache</screen>
<simpara>Apache user must not have access to the keytab file.</simpara>
</listitem>
<listitem>
<simpara>Create the <literal>/etc/gssproxy/00-http.conf</literal> file with the following content:</simpara>
<screen>[service/HTTP]
mechs = krb5
cred_store = keytab:/etc/krb5.keytab
cred_store = ccache:/var/lib/gssproxy/clients/krb5cc_%U
euid = <emphasis>ID_of_Apache_User</emphasis></screen>
</listitem>
<listitem>
<simpara>Create a keytab entry:</simpara>
<screen># KRB5_KTNAME=FILE:/etc/httpd/conf/http.keytab net ads keytab add HTTP -U administrator -d3 -s /etc/net-keytab.conf
# chown root.apache /etc/httpd/conf/http.keytab
# chmod 640 /etc/httpd/conf/http.keytab</screen>
</listitem>
<listitem>
<simpara>Enable IPA authenication in {Project}:</simpara>
<screen># {foreman-installer} --foreman-ipa-authentication=true</screen>
</listitem>
<listitem>
<simpara>Start and enable the <literal>gssproxy</literal> service:</simpara>
<screen># systemctl restart gssproxy.service
# systemctl enable gssproxy.service</screen>
</listitem>
<listitem>
<simpara>Configure the Apache server to use the gssproxy service:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Create the <literal>/etc/systemd/system/httpd.service</literal> file with the following content:</simpara>
<screen>.include /lib/systemd/system/httpd.service
[Service]
Environment=GSS_USE_PROXY=1</screen>
</listitem>
<listitem>
<simpara>Apply changes to the service:</simpara>
<screen># systemctl daemon-reload</screen>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Start and enable the <literal>httpd</literal> service:</simpara>
<screen># systemctl restart httpd.service</screen>
</listitem>
<listitem>
<simpara>Verify that SSO is working as expected.</simpara>
<simpara>With a running Apache server, users making HTTP requests against the server are authenticated if the client has a valid Kerberos ticket.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Retrieve the Kerberos ticket of the LDAP user, using the following command:</simpara>
<screen># kinit ldapuser</screen>
</listitem>
<listitem>
<simpara>View the Kerberos ticket, using the following command:</simpara>
<screen># klist</screen>
</listitem>
<listitem>
<simpara>View output from successful SSO-based authentication, using the following command:</simpara>
<screen># curl -k -u : --negotiate https://<emphasis>{foreman-example-com}/</emphasis>users/extlogin</screen>
<simpara>This returns the following response:</simpara>
<screen>&lt;html&gt;&lt;body&gt;You are being &lt;a href="https://<emphasis>{foreman-example-com}/</emphasis>users/4-ldapuserexample-com/edit"&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</screen>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="kerberos-configuration-in-web-browsers_admin">
<title>Kerberos Configuration in Web Browsers</title>
<simpara>For information on configuring the Firefox browser see <link xlink:href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System-Level_Authentication_Guide/Configuring_Applications_for_SSO.html#Configuring_Firefox_to_use_Kerberos_for_SSO">Configuring Firefox to Use Kerberos for Single Sign-On</link> in the <emphasis>Red Hat Enterprise Linux System-Level Authentication</emphasis> guide.</simpara>
<simpara>If you use the Internet Explorer browser, add {ProjectServer} to the list of Local Intranet or Trusted sites, and turn on the <emphasis>Enable Integrated Windows Authentication</emphasis> setting.
See the Internet Explorer documentation for details.</simpara>
<note>
<simpara>With direct AD integration, HBAC through {FreeIPA} is not available.
As an alternative, you can use Group Policy Objects (GPO) that enable administrators to centrally manage policies in AD environments.
To ensure correct GPO to PAM service mapping, use the following sssd configuration:</simpara>
<screen>access_provider = ad
ad_gpo_access_control = enforcing
ad_gpo_map_service = +foreman</screen>
<simpara>Here, <emphasis>foreman</emphasis> is the PAM service name.
For more information on GPOs, please refer to the <link xlink:href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Windows_Integration_Guide/sssd-gpo.html">Red Hat Enterprise Linux Windows Integration Guide</link>.</simpara>
</note>
</section>
<section xml:id="active-directory-with-cross-forest-trust_admin">
<title>Active Directory with Cross-Forest Trust</title>
<simpara>Kerberos can create <literal>cross-forest trust</literal> that defines a relationship between two otherwise separate domain forests.
A domain forest is a hierarchical structure of domains; both AD and {FreeIPA} constitute a forest.
With a trust relationship enabled between AD and {FreeIPA}, users of AD can access Linux hosts and services using a single set of credentials.
For more information on cross-forest trusts, see <link xlink:href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Windows_Integration_Guide/active-directory-trust.html">Creating Cross-forest Trusts with Active Directory and Identity Management</link> in the <emphasis>Red Hat Enterprise Linux Windows Integration</emphasis> guide.</simpara>
<simpara>From the {Project} point of view, the configuration process is the same as integration with {FreeIPA} server without cross-forest trust configured.
The {ProjectServer} has to be enrolled in the IPM domain and integrated as described in <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Configuring_External_Authentication-Using_Identity_Management"/>.</simpara>
</section>
<section xml:id="configuring-the-idm-server-to-use-cross-forest-trust_admin">
<title>Configuring the {FreeIPA} Server to Use Cross-Forest Trust</title>
<simpara>On the {FreeIPA} server, configure the server to use <literal>cross-forest trust</literal>.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Enable HBAC:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Create an external group and add the AD group to it.</simpara>
</listitem>
<listitem>
<simpara>Add the new external group to a POSIX group.</simpara>
</listitem>
<listitem>
<simpara>Use the POSIX group in a HBAC rule.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Configure sssd to transfer additional attributes of AD users.</simpara>
<itemizedlist>
<listitem>
<simpara>Add the AD user attributes to the <emphasis>nss</emphasis> and <emphasis>domain</emphasis> sections in <literal>/etc/sssd/sssd.conf</literal>.</simpara>
<simpara>For example:</simpara>
<screen>[nss]
user_attributes=+mail, +sn, +givenname

[domain/EXAMPLE]
ldap_user_extra_attrs=mail, sn, givenname</screen>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Creating_User_Groups-Configuring_External_User_Groups">
<title>Configuring External User Groups</title>
<simpara>{Project} does not associate external users with their user group automatically.
You must create a user group with the same name as in the external source on {Project}.
Members of the external user group then automatically become members of the {Project} user group and receive the associated permissions.</simpara>
<simpara>The configuration of external user groups depends on the type of external authentication.</simpara>
<simpara>To assign additional permissions to an external user, add this user to an internal user group that has no external mapping specified.
Then assign the required roles to this group.</simpara>
<itemizedlist xml:id="br-external_user_groups_prerequisites">
<title>Prerequisites</title>
<listitem>
<simpara>If you use an LDAP server, configure {Project} to use LDAP authentication.
For more information see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Using_LDAP"/>.</simpara>
<simpara>When using external user groups from an LDAP source, you cannot use the <literal>$login</literal> variable as a substitute for the account user name.
You must use either an anonymous or dedicated service user.</simpara>
</listitem>
<listitem>
<simpara>If you use a {FreeIPA} or AD server, configure {Project} to use {FreeIPA} or AD authentication.
For more information, see <xref linkend="chap-{Project_Link}-Administering_{Project_Link}-Configuring_External_Authentication"/>.</simpara>
</listitem>
<listitem>
<simpara>Ensure that at least one external user authenticates for the first time.</simpara>
</listitem>
<listitem>
<simpara>Retain a copy of the external group names you want to use.
To find the group membership of external users, enter the following command:</simpara>
<screen># id <emphasis>username</emphasis></screen>
</listitem>
</itemizedlist>
<orderedlist xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_External_User_Groups-To_Configure_an_External_User_Group" numeration="arabic">
<title>To Configure an External User Group:</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">User Groups</emphasis>, and click <emphasis role="strong">Create User Group</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Specify the name of the new user group.
Do not select any users to avoid adding users automatically when you refresh the external user group.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Roles</emphasis> tab and select the roles you want to assign to the user group.
Alternatively, select the <emphasis role="strong">Administrator</emphasis> check box to assign all available permissions.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">External groups</emphasis> tab, then click <emphasis role="strong">Add external user group</emphasis>, and select an authentication source from the <emphasis role="strong">Auth source</emphasis> drop-down menu.</simpara>
<simpara>Specify the exact name of the external group in the <emphasis role="strong">Name</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="refreshing_external_user_groups_for_ldap" remap="_refreshing_external_user_groups_for_ldap">
<title>Refreshing External User Groups for LDAP</title>
<simpara>To set the LDAP source to synchronize user group membership automatically on user login, in the <emphasis role="strong">Auth Source</emphasis> page, select the <emphasis role="strong">Usergroup Sync</emphasis> option.
If this option is not selected, LDAP user groups are refreshed automatically through a scheduled cron job synchronizing the LDAP Authentication source every 30 minutes by default.</simpara>
<simpara>If the user groups in the LDAP Authentication source change in the lapse of time between scheduled tasks, the user can be assigned to incorrect external user groups.
This is corrected automatically when the scheduled task runs.</simpara>
<simpara>Use this procedure to refresh the LDAP source manually.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Usergroups</emphasis> and select a user group.</simpara>
</listitem>
<listitem>
<simpara>Navigate to the <emphasis role="strong">External Groups</emphasis> tab and click <emphasis role="strong">Refresh</emphasis> to the right of the required user group.</simpara>
</listitem>
</orderedlist>
<formalpara>
<title>For CLI Users</title>
<para>Enter the following command:</para>
</formalpara>
<screen># foreman-rake ldap:refresh_usergroups</screen>
</section>
<section xml:id="refreshing_external_user_groups_for_freeipa_or_ad" remap="_refreshing_external_user_groups_for_freeipa_or_ad">
<title>Refreshing External User Groups for {FreeIPA} or AD</title>
<simpara>External user groups based on {FreeIPA} or AD are refreshed only when a group member logs in to {Project}.
It is not possible to alter user membership of external user groups in the {Project} web UI, such changes are overwritten on the next group refresh.</simpara>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_External_Authentication-External_Authentication_for_Provisioned_Hosts">
<title>External Authentication for Provisioned Hosts</title>
<simpara>Use this section to configure {ProjectServer} or {SmartProxyServer} for {FreeIPA} realm support, then add hosts to the {FreeIPA} realm group.</simpara>
<simpara><emphasis role="strong">Prerequisites</emphasis></simpara>
<simpara>You require the following setup to configure external authentication for provisioned hosts:</simpara>
<itemizedlist>
<listitem>
<simpara>{ProjectServer} that is registered to the Content Delivery Network or an external {SmartProxyServer} that is registered to {ProjectServer}.</simpara>
</listitem>
<listitem>
<simpara>A deployed realm or domain provider such as {FreeIPA}.</simpara>
</listitem>
</itemizedlist>
<formalpara xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_a_Red_Hat_Satellite_Server_or_Capsule_Server_for_IdM_Realm_Support-To_configure_the_Satellite_Server_or_Capsule_Server_for_IdM_Realm_Support">
<title>To install and configure {FreeIPA} packages on {ProjectName} Server or {ProjectName} {SmartProxyServer}:</title>
<para>To use {FreeIPA} for provisioned hosts, complete the following steps to install and configure {FreeIPA} packages on {ProjectName} Server or {ProjectName} {SmartProxyServer}:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Install the <literal>ipa-client</literal> package on {ProjectServer} or {SmartProxyServer}:</simpara>
<screen># {package-install-project} ipa-client</screen>
</listitem>
<listitem>
<simpara>Configure the server as a {FreeIPA} client:</simpara>
<screen># ipa-client-install</screen>
</listitem>
<listitem>
<simpara>Create a realm proxy user, <literal>realm-{smart-proxy-context}</literal>, and the relevant roles in {FreeIPA}:</simpara>
<screen># foreman-prepare-realm admin realm-{smart-proxy-context}</screen>
<simpara>Note the principal name that returns and your {FreeIPA} server configuration details because you require them for the following procedure.</simpara>
</listitem>
</orderedlist>
<formalpara xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_IdM">
<title>To configure {ProjectServer} or {SmartProxyServer} for {FreeIPA} Realm Support:</title>
<para>Complete the following procedure on {Project} and every {SmartProxy} that you want to use:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Copy the <literal>/root/freeipa.keytab</literal> file to any {SmartProxyServer} that you want to include in the same principal and realm:</simpara>
<screen># scp /root/freeipa.keytab root@<emphasis>{smartproxy-example-com}</emphasis>:/etc/foreman-proxy/freeipa.keytab</screen>
</listitem>
<listitem>
<simpara>Move the <literal>/root/freeipa.keytab</literal> file to the <literal>/etc/foreman-proxy</literal> directory and set the ownership settings to the <literal>foreman-proxy</literal> user:</simpara>
<screen># mv /root/freeipa.keytab /etc/foreman-proxy
# chown foreman-proxy:foreman-proxy /etc/foreman-proxy/freeipa.keytab</screen>
</listitem>
<listitem>
<simpara>Enter the following command on all {SmartProxies} that you want to include in the realm.
If you use the integrated {SmartProxy} on {Project}, enter this command on {ProjectServer}:</simpara>
<screen># {foreman-installer} --foreman-proxy-realm true \
--foreman-proxy-realm-keytab /etc/foreman-proxy/freeipa.keytab \
--foreman-proxy-realm-principal <emphasis>realm-{smart-proxy-context}@EXAMPLE.COM</emphasis> \
--foreman-proxy-realm-provider freeipa</screen>
<simpara>You can also use these options when you first configure the {ProjectName} Server.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the most updated versions of the ca-certificates package is installed and trust the {FreeIPA} Certificate Authority:</simpara>
<screen># cp /etc/ipa/ca.crt /etc/pki/ca-trust/source/anchors/ipa.crt
# update-ca-trust enable
# update-ca-trust</screen>
</listitem>
<listitem>
<simpara>Optional: If you configure {FreeIPA} on an existing {ProjectServer} or {SmartProxyServer}, complete the following steps to ensure that the configuration changes take effect:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Restart the <emphasis role="strong">foreman-proxy</emphasis> service:</simpara>
<screen># systemctl restart foreman-proxy</screen>
</listitem>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Infrastructure</emphasis> &gt; <emphasis role="strong">{SmartProxies}</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the {SmartProxy} you have configured for {FreeIPA} and from the list in the <emphasis role="strong">Actions</emphasis> column, select <emphasis role="strong">Refresh</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
<formalpara xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Creating_a_Realm_for_the_IdM_enabled_Capsule">
<title>To create a realm for the {FreeIPA}-enabled {SmartProxy}</title>
<para>After you configure your integrated or external {SmartProxy} with {FreeIPA}, you must create a realm and add the {FreeIPA}-configured {SmartProxy} to the realm.</para>
</formalpara>
<simpara>To create a realm, complete the following steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Infrastructure</emphasis> &gt; <emphasis role="strong">Realms</emphasis> and click <emphasis role="strong">Create Realm</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the realm.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Realm Type</emphasis> list, select the type of realm.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Realm {SmartProxy}</emphasis> list, select the {SmartProxyServer} where you have configured {FreeIPA}.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Locations</emphasis> tab and from the <emphasis role="strong">Locations</emphasis> list, select the location where you want to add the new realm.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Organizations</emphasis> tab and from the <emphasis role="strong">Organizations</emphasis> list, select the organization where you want to add the new realm.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
<formalpara>
<title>Updating Host Groups with Realm Information</title>
<para>You must update any host groups that you want to use with the new realm information.</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Navigate to <emphasis role="strong">Configure</emphasis> &gt; <emphasis role="strong">Host Groups</emphasis>, select the host group that you want to update, and click the <emphasis role="strong">Network</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Realm</emphasis> list, select the realm you create as part of this procedure, and then click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
<formalpara xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-External_Authentication_for_Provisioned_Hosts-Adding_Hosts_to_an_IdM_Host_Group">
<title>Adding Hosts to a {FreeIPA} Host Group</title>
<para>{FreeIPA} supports the ability to set up automatic membership rules based on a system’s attributes.
{ProjectName}'s realm feature provides administrators with the ability to map the {ProjectName} host groups to the {FreeIPA} parameter <literal>userclass</literal> which allow administrators to configure automembership.</para>
</formalpara>
<simpara>When nested host groups are used, they are sent to the {FreeIPA} server as they are displayed in the {ProjectName} User Interface.
For example, "Parent/Child/Child".</simpara>
<simpara>{ProjectServer} or {SmartProxyServer} sends updates to the {FreeIPA} server, however automembership rules are only applied at initial registration.</simpara>
<orderedlist xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Adding_Hosts_to_an_IdM_Host_Group-To_Add_Hosts_to_an_IdM_Host_Group" numeration="arabic">
<title>To Add Hosts to a {FreeIPA} Host Group:</title>
<listitem>
<simpara>On the {FreeIPA} server, create a host group:</simpara>
<screen># ipa hostgroup-add <emphasis>hostgroup_name</emphasis> --desc=<emphasis>hostgroup_description</emphasis></screen>
</listitem>
<listitem>
<simpara>Create an <literal>automembership</literal> rule:</simpara>
<screen># ipa automember-add --type=hostgroup <emphasis>hostgroup_name</emphasis> <emphasis>automember_rule</emphasis></screen>
<simpara>Where you can use the following options:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>automember-add</literal> flags the group as an automember group.</simpara>
</listitem>
<listitem>
<simpara><literal>--type=hostgroup</literal> identifies that the target group is a host group, not a user group.</simpara>
</listitem>
<listitem>
<simpara><literal><emphasis>automember_rule</emphasis></literal> adds the name you want to identify the automember rule by.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Define an automembership condition based on the <literal>userclass</literal> attribute:</simpara>
<screen># ipa automember-add-condition --key=userclass --type=hostgroup --inclusive-regex=<emphasis>^webserver</emphasis> <emphasis>hostgroup_name</emphasis>
----------------------------------
Added condition(s) to "<emphasis>hostgroup_name</emphasis>"
----------------------------------
Automember Rule: <emphasis>automember_rule</emphasis>
Inclusive Regex: userclass=<emphasis>^webserver</emphasis>
----------------------------
Number of conditions added 1
----------------------------</screen>
<simpara>Where you can use the following options:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>automember-add-condition</literal> adds regular expression conditions to identify group members.</simpara>
</listitem>
<listitem>
<simpara><literal>--key=userclass</literal> specifies the key attribute as <literal>userclass</literal>.</simpara>
</listitem>
<listitem>
<simpara><literal>--type=hostgroup</literal> identifies that the target group is a host group, not a user group.</simpara>
</listitem>
<listitem>
<simpara><literal>--inclusive-regex=</literal> <emphasis>^webserver</emphasis> identifies matching values with a regular expression pattern.</simpara>
</listitem>
<listitem>
<simpara><emphasis>hostgroup_name</emphasis> - identifies the target host group’s name.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<simpara>When a system is added to {ProjectServer}'s <emphasis>hostgroup_name</emphasis> host group, it is added automatically to the {FreeIPA} server’s "<emphasis>hostgroup_name</emphasis>" host group.
{FreeIPA} host groups allow for Host-Based Access Controls (HBAC), sudo policies and other {FreeIPA} functions.</simpara>
</section>
<section xml:id="configuring-project-with-keycloak-authentication_admin">
<title>Configuring {Project} with {Keycloak} Authentication</title>
<simpara>Use this section to configure {Project} to use {Keycloak} as an OpenID provider for external authentication.</simpara>
<section xml:id="prerequisites-for-integrating-project-with-keycloak_keycloak-general">
<title>Prerequisites for Configuring {Project} with {Keycloak} Authentication</title>
<simpara>Before configuring {Project} with {Keycloak} external authentication, ensure that you meet the following requirements:</simpara>
<itemizedlist>
<listitem>
<simpara>A working installation of {Keycloak} server that uses HTTPS instead of HTTP.</simpara>
</listitem>
<listitem>
<simpara>A {Keycloak} account with admin privileges.</simpara>
</listitem>
<listitem>
<simpara>A realm for {Project} user accounts created in {Keycloak}.</simpara>
</listitem>
<listitem>
<simpara>If the certificates or the CA are self-signed, ensure that they are added to the end-user certificate trust store.</simpara>
</listitem>
<listitem>
<simpara>Users imported or added to {Keycloak}.</simpara>
<simpara>If you have an existing user database configured such as LDAP or Kerberos, you can import users from it by configuring user federation.
For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user-storage-federation">User Storage Federation</link> in the <emphasis>Red Hat Single Sign-On Server Administration Guide</emphasis>.</simpara>
<simpara>If you do not have an existing user database configured, you can manually create users in {Keycloak}.
For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user_management#create-new-user">Creating New Users</link> in the <emphasis>Red Hat Single Sign-On Server Administration Guide</emphasis>.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="registering-project-as-a-keycloak-client_keycloak-general">
<title>Registering {Project} as a {Keycloak} Client</title>
<simpara>Use this procedure to register {Project} to {Keycloak} as a client and configure {Project} to use {Keycloak} as an authentication source.</simpara>
<simpara>You can configure {Project} and {Keycloak} with two different authentication methods:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Users authenticate to {Project} using the {Project} web UI.</simpara>
</listitem>
<listitem>
<simpara>Users authenticate to {Project} using the {Project} CLI.</simpara>
</listitem>
</orderedlist>
<simpara>You must decide on how you want your users to authenticate in advance because both methods require different {Project} clients to be registered to {Keycloak} and configured.
The steps to register and configure {Project} client in {Keycloak} are distinguished within the procedure.</simpara>
<simpara>You can also register two different {Project} clients to {Keycloak} if you want to use both authentication methods and configure both clients accordingly.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On the {Project} server, install the following packages:</simpara>
<screen># {package-install-project} mod_auth_openidc keycloak-httpd-client-install</screen>
</listitem>
<listitem>
<simpara>Register {Project} to {Keycloak} as a client.
Note that you the registration process for logging in using the web UI and the CLI are different.
You can register two clients {Project} clients to {Keycloak} to be able to log in to {Project} from the web UI and the CLI.</simpara>
<itemizedlist>
<listitem>
<simpara>If you want you users to authenticate to {Project} using the web UI, create a client as follows:</simpara>
<screen># keycloak-httpd-client-install --app-name foreman-openidc \
--keycloak-server-url "<emphasis>https://{Keycloak-short}.com</emphasis>" \
--keycloak-admin-username "<emphasis>admin</emphasis>" \
--keycloak-realm "<emphasis>{Project}_Realm</emphasis>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</screen>
<simpara>Enter the password for the administer account when prompted.
This command creates a client for {Project} in {Keycloak}.</simpara>
<simpara>Then, configure {Project} to use {Keycloak} as an authentication source:</simpara>
<screen># satellite-installer --foreman-keycloak true \
--foreman-keycloak-app-name "foreman-openidc" \
--foreman-keycloak-realm "<emphasis>{Project}_Realm</emphasis>"</screen>
</listitem>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the CLI, create a client as follows:</simpara>
<screen># keycloak-httpd-client-install --app-name hammer-openidc \
--keycloak-server-url "<emphasis>https://{Keycloak-short}.com</emphasis>" \
--keycloak-admin-username "<emphasis>admin</emphasis>" \
--keycloak-realm "<emphasis>{Project}_Realm</emphasis>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</screen>
<simpara>Enter the password for the administer account when prompted.
This command creates a client for {Project} in {Keycloak}.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Restart the <literal>httpd</literal> service:</simpara>
<screen># systemctl restart httpd</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-the-project-client-in-keycloak_keycloak-general">
<title>Configuring the {Project} Client in {Keycloak}</title>
<simpara>Use this procedure to configure the {Project} client in the {Keycloak} web UI and create group and audience mappers for the {Project} client.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Keycloak} web UI, navigate to <emphasis role="strong">Clients</emphasis> and click the {Project} client.</simpara>
</listitem>
<listitem>
<simpara>Configure access type:</simpara>
<itemizedlist>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the web UI, from the <emphasis role="strong">Access Type</emphasis> list, select <emphasis role="strong">confidential</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the CLI, from the <emphasis role="strong">Access Type</emphasis> list, select <emphasis role="strong">public</emphasis>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Valid redirect URI</emphasis> fields, add a valid redirect URI.</simpara>
<itemizedlist>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the web UI, in the blank field below the existing URI, enter a URI in the form <literal><link xlink:href="https://{foreman-example-com}/users/extlogin">https://{foreman-example-com}/users/extlogin</link></literal>. Note that you must add the string <literal>/users/extlogin</literal> after the {Project} FQDN.</simpara>
<simpara>After completing this step, the {Project} client for logging in using the web UI must have the following <emphasis role="strong">Valid Redirect URIs</emphasis>:</simpara>
<screen>https://{foreman-example-com}/users/extlogin/redirect_uri
https://{foreman-example-com}/users/extlogin</screen>
</listitem>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the CLI, in the blank field below the existing URI, enter <emphasis role="strong">urn:ietf:wg:oauth:2.0:oob</emphasis>.</simpara>
<simpara>After completing this step, the {Project} client for logging in using the CLI must have the following <emphasis role="strong">Valid Redirect URIs</emphasis>:</simpara>
<screen>https://{foreman-example-com}/users/extlogin/redirect_uri
urn:ietf:wg:oauth:2.0:oob</screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Mappers</emphasis> tab and click <emphasis role="strong">Create</emphasis> to add an audience mapper.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the audience mapper.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Mapper Type</emphasis> list, select <emphasis role="strong">Audience</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Included Client Audience</emphasis> list, select the {Project} client.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis> to add a group mapper so that you can specify authorization in {Project} based on group membership.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the group mapper.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Mapper Type</emphasis> list, select <emphasis role="strong">Group Membership</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Token Claim Name</emphasis> field, enter <emphasis role="strong">groups</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Set the <emphasis role="strong">Full group path</emphasis> setting to OFF.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-project-settings-for-keycloak-authentication_keycloak-general">
<title>Configuring {Project} Settings for {Keycloak} Authentication</title>
<simpara>Use this section to configure {Project} for {Keycloak} authentication using the {Project} web UI or the CLI.</simpara>
<section xml:id="configuring-project-settings-for-keycloak-authentication-using-the-web-ui_keycloak-general">
<title>Configuring {Project} Settings for {Keycloak} Authentication Using the Web UI</title>
<simpara>Use this procedure to configure {Project} settings for {Keycloak} authentication using the {Project} web UI.</simpara>
<simpara>Note that you can navigate to the following URL within your realm to obtain values to configure {Project} settings: <literal><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration">https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration</link></literal></simpara>
<itemizedlist>
<title>Prerequisite</title>
<listitem>
<simpara>Ensure that the <emphasis role="strong">Access Type</emphasis> setting in the {Project} client in the {Keycloak} web UI is set to <emphasis role="strong">confidential</emphasis></simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Settings</emphasis>, and click the <emphasis role="strong">Authentication</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">Authorize login delegation</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to <emphasis role="strong">Yes</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">Authorize login delegation auth source user autocreate</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column,
set the value to <emphasis role="strong">External</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">Login delegation logout URL</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to
<emphasis role="strong"><link xlink:href="https://{foreman-example-com}/users/extlogout">https://{foreman-example-com}/users/extlogout</link></emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC Algorithm</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the algorithm for encoding on {Keycloak} to <emphasis role="strong">RS256</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC Audience</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to the client ID for {Keycloak}.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC Issuer</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to <emphasis role="strong"><emphasis><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm">https://{Keycloak-short}.com/auth/realms/{Project}_Realm</link></emphasis></emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC JWKs URL</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to <emphasis role="strong"><emphasis><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm/protocol/openid-connect/certs">https://{Keycloak-short}.com/auth/realms/{Project}_Realm/protocol/openid-connect/certs</link></emphasis></emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Authentication Sources</emphasis> and click <emphasis role="strong">External</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create LDAP Authentication Source</emphasis> and select the {Keycloak} server.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Locations</emphasis> tab and add locations that can use the {Keycloak} authentication source.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Organizations</emphasis> tab and add organizations that can use the {Keycloak} authentication source.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-project-settings-for-keycloak-authentication-using-the-cli_keycloak-general">
<title>Configuring {Project} Settings for {Keycloak} Authentication Using the CLI</title>
<simpara>Use this procedure to configure {Project} settings for {Keycloak} authentication using the {Project} CLI.</simpara>
<simpara>Note that you can navigate to the following URL within your realm to obtain values to configure {Project} settings: <literal><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration">https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration</link></literal></simpara>
<itemizedlist>
<title>Prerequisite</title>
<listitem>
<simpara>Ensure that the <emphasis role="strong">Access Type</emphasis> setting in the {Project} client in the {Keycloak} web UI is set to <emphasis role="strong">public</emphasis></simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On {Project}, set the login delegation to <literal>true</literal> so that users can authenticate using the Open IDC protocol:</simpara>
<screen># hammer settings set --name authorize_login_delegation --value true</screen>
</listitem>
<listitem>
<simpara>Set the login delegation logout URL:</simpara>
<screen># hammer settings set --name login_delegation_logout_url \
--value https://{foreman-example-com}/users/extlogout</screen>
</listitem>
<listitem>
<simpara>Set the algorithm for encoding on {Keycloak}, for example, <literal>RS256</literal>:</simpara>
<screen># hammer settings set --name oidc_algorithm --value 'RS256'</screen>
</listitem>
<listitem>
<simpara>Open the <literal><emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/<emphasis>{Keycloak-short}_REALM</emphasis>/.well-known/openid-configuration</literal> URL and note the values to populate the options in the following steps.</simpara>
</listitem>
<listitem>
<simpara>Add the value for the Hammer client in the Open IDC audience:</simpara>
<screen># hammer settings set --name oidc_audience \
--value "['<emphasis>{foreman-example-com}</emphasis>-hammer-openidc']"</screen>
<note>
<simpara>If you register several {Keycloak} clients to {Project}, ensure that you append all audiences in the array.
For example:</simpara>
<screen># hammer settings set --name oidc_audience \
--value "['<emphasis>{foreman-example-com}</emphasis>-foreman-openidc', '<emphasis>{foreman-example-com}</emphasis>-hammer-openidc']"</screen>
</note>
</listitem>
<listitem>
<simpara>Set the value for the Open IDC issuer:</simpara>
<screen># hammer settings set --name oidc_issuer \
--value "<emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/<emphasis>{Keycloak-short}_Realm</emphasis>"</screen>
</listitem>
<listitem>
<simpara>Set the value for Open IDC Java Web Token (JWT):</simpara>
<screen># hammer settings set --name oidc_jwks_url \
--value "<emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/<emphasis>{Keycloak-short}_Realm</emphasis>/protocol/openid-connect/certs"</screen>
</listitem>
<listitem>
<simpara>Retrieve the ID of the {Keycloak} authentication source:</simpara>
<screen># hammer auth-source external list</screen>
</listitem>
<listitem>
<simpara>Set the location and organization:</simpara>
<screen># hammer auth-source external update --id <emphasis>Authentication Source ID</emphasis> \
--location-ids <emphasis>Location ID</emphasis> --organization-ids <emphasis>Organization ID</emphasis></screen>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="logging-in-to-the-project-web-ui-using-keycloak_keycloak-general">
<title>Logging in to the {Project} Web UI Using {Keycloak}</title>
<simpara>Use this procedure to log in to the {Project} web UI using {Keycloak}.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>In your browser, log in to {Project} and enter your credentials.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="logging-in-to-the-project-cli-using-keycloak_keycloak-general">
<title>Logging in to the {Project} CLI Using {Keycloak}</title>
<simpara>Use this procedure to authenticate to the {Project} CLI using the code grant type.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>To authenticate to the {Project} CLI using the code grant type, enter the following command:</simpara>
<screen># hammer auth login oauth \
--two-factor \
--oidc-token-endpoint 'https://<emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/ssl-realm/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<emphasis>{Keycloak-short}.example.com</emphasis>/auth' \
--oidc-client-id '<emphasis>{foreman-example-com}</emphasis>-foreman-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</screen>
<simpara>The command prompts you to enter a success code.</simpara>
</listitem>
<listitem>
<simpara>To retrieve the success code, navigate to the URL that the command returns and provide the required information.</simpara>
</listitem>
<listitem>
<simpara>Copy the success code that the web UI returns.</simpara>
</listitem>
<listitem>
<simpara>In the command prompt of <literal>hammer auth login oauth</literal>, enter the success code to authenticate to the {Project} CLI.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-group-mapping-for-keycloak-authentication_keycloak-general">
<title>Configuring Group Mapping for {Keycloak} Authentication</title>
<simpara>Optionally, to implement the Role Based Access Control (RBAC), create a group in {Project}, assign a role to this group, and then map an Active Directory group to the {Project} group.
As a result, anyone in the given group in {Keycloak} are logged in under the corresponding {Project} group.
This example configures users of the {Project}-admin user group in the Active Directory to authenticate as users with administrator privileges on {Project}.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">User Groups</emphasis>, and click the <emphasis role="strong">Create User Group</emphasis> button.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the user group.
The name should not be the same as in the Active Directory.</simpara>
</listitem>
<listitem>
<simpara>Do not add users and user groups to the right-hand columns.
Click the <emphasis role="strong">Roles</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Administer</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">External Groups</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add external user group</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter the name of the Active Directory group.</simpara>
</listitem>
<listitem>
<simpara>From the list, select <emphasis role="strong">EXTERNAL</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="configuring-keycloak-authentication-with-totp_admin">
<title>Configuring {Keycloak} Authentication with TOTP</title>
<simpara>Use this section to configure {Project} to use {Keycloak} as an OpenID provider for external authentication with TOTP cards.</simpara>
<section xml:id="prerequisites-for-integrating-project-with-keycloak_keycloak-totp">
<title>Prerequisites for Configuring {Project} with {Keycloak} Authentication</title>
<simpara>Before configuring {Project} with {Keycloak} external authentication, ensure that you meet the following requirements:</simpara>
<itemizedlist>
<listitem>
<simpara>A working installation of {Keycloak} server that uses HTTPS instead of HTTP.</simpara>
</listitem>
<listitem>
<simpara>A {Keycloak} account with admin privileges.</simpara>
</listitem>
<listitem>
<simpara>A realm for {Project} user accounts created in {Keycloak}.</simpara>
</listitem>
<listitem>
<simpara>If the certificates or the CA are self-signed, ensure that they are added to the end-user certificate trust store.</simpara>
</listitem>
<listitem>
<simpara>Users imported or added to {Keycloak}.</simpara>
<simpara>If you have an existing user database configured such as LDAP or Kerberos, you can import users from it by configuring user federation.
For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user-storage-federation">User Storage Federation</link> in the <emphasis>Red Hat Single Sign-On Server Administration Guide</emphasis>.</simpara>
<simpara>If you do not have an existing user database configured, you can manually create users in {Keycloak}.
For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user_management#create-new-user">Creating New Users</link> in the <emphasis>Red Hat Single Sign-On Server Administration Guide</emphasis>.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="registering-project-as-a-keycloak-client_keycloak-totp">
<title>Registering {Project} as a {Keycloak} Client</title>
<simpara>Use this procedure to register {Project} to {Keycloak} as a client and configure {Project} to use {Keycloak} as an authentication source.</simpara>
<simpara>You can configure {Project} and {Keycloak} with two different authentication methods:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Users authenticate to {Project} using the {Project} web UI.</simpara>
</listitem>
<listitem>
<simpara>Users authenticate to {Project} using the {Project} CLI.</simpara>
</listitem>
</orderedlist>
<simpara>You must decide on how you want your users to authenticate in advance because both methods require different {Project} clients to be registered to {Keycloak} and configured.
The steps to register and configure {Project} client in {Keycloak} are distinguished within the procedure.</simpara>
<simpara>You can also register two different {Project} clients to {Keycloak} if you want to use both authentication methods and configure both clients accordingly.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On the {Project} server, install the following packages:</simpara>
<screen># {package-install-project} mod_auth_openidc keycloak-httpd-client-install</screen>
</listitem>
<listitem>
<simpara>Register {Project} to {Keycloak} as a client.
Note that you the registration process for logging in using the web UI and the CLI are different.
You can register two clients {Project} clients to {Keycloak} to be able to log in to {Project} from the web UI and the CLI.</simpara>
<itemizedlist>
<listitem>
<simpara>If you want you users to authenticate to {Project} using the web UI, create a client as follows:</simpara>
<screen># keycloak-httpd-client-install --app-name foreman-openidc \
--keycloak-server-url "<emphasis>https://{Keycloak-short}.com</emphasis>" \
--keycloak-admin-username "<emphasis>admin</emphasis>" \
--keycloak-realm "<emphasis>{Project}_Realm</emphasis>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</screen>
<simpara>Enter the password for the administer account when prompted.
This command creates a client for {Project} in {Keycloak}.</simpara>
<simpara>Then, configure {Project} to use {Keycloak} as an authentication source:</simpara>
<screen># satellite-installer --foreman-keycloak true \
--foreman-keycloak-app-name "foreman-openidc" \
--foreman-keycloak-realm "<emphasis>{Project}_Realm</emphasis>"</screen>
</listitem>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the CLI, create a client as follows:</simpara>
<screen># keycloak-httpd-client-install --app-name hammer-openidc \
--keycloak-server-url "<emphasis>https://{Keycloak-short}.com</emphasis>" \
--keycloak-admin-username "<emphasis>admin</emphasis>" \
--keycloak-realm "<emphasis>{Project}_Realm</emphasis>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</screen>
<simpara>Enter the password for the administer account when prompted.
This command creates a client for {Project} in {Keycloak}.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Restart the <literal>httpd</literal> service:</simpara>
<screen># systemctl restart httpd</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-the-project-client-in-keycloak_keycloak-totp">
<title>Configuring the {Project} Client in {Keycloak}</title>
<simpara>Use this procedure to configure the {Project} client in the {Keycloak} web UI and create group and audience mappers for the {Project} client.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Keycloak} web UI, navigate to <emphasis role="strong">Clients</emphasis> and click the {Project} client.</simpara>
</listitem>
<listitem>
<simpara>Configure access type:</simpara>
<itemizedlist>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the web UI, from the <emphasis role="strong">Access Type</emphasis> list, select <emphasis role="strong">confidential</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the CLI, from the <emphasis role="strong">Access Type</emphasis> list, select <emphasis role="strong">public</emphasis>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Valid redirect URI</emphasis> fields, add a valid redirect URI.</simpara>
<itemizedlist>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the web UI, in the blank field below the existing URI, enter a URI in the form <literal><link xlink:href="https://{foreman-example-com}/users/extlogin">https://{foreman-example-com}/users/extlogin</link></literal>. Note that you must add the string <literal>/users/extlogin</literal> after the {Project} FQDN.</simpara>
<simpara>After completing this step, the {Project} client for logging in using the web UI must have the following <emphasis role="strong">Valid Redirect URIs</emphasis>:</simpara>
<screen>https://{foreman-example-com}/users/extlogin/redirect_uri
https://{foreman-example-com}/users/extlogin</screen>
</listitem>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the CLI, in the blank field below the existing URI, enter <emphasis role="strong">urn:ietf:wg:oauth:2.0:oob</emphasis>.</simpara>
<simpara>After completing this step, the {Project} client for logging in using the CLI must have the following <emphasis role="strong">Valid Redirect URIs</emphasis>:</simpara>
<screen>https://{foreman-example-com}/users/extlogin/redirect_uri
urn:ietf:wg:oauth:2.0:oob</screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Mappers</emphasis> tab and click <emphasis role="strong">Create</emphasis> to add an audience mapper.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the audience mapper.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Mapper Type</emphasis> list, select <emphasis role="strong">Audience</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Included Client Audience</emphasis> list, select the {Project} client.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis> to add a group mapper so that you can specify authorization in {Project} based on group membership.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the group mapper.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Mapper Type</emphasis> list, select <emphasis role="strong">Group Membership</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Token Claim Name</emphasis> field, enter <emphasis role="strong">groups</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Set the <emphasis role="strong">Full group path</emphasis> setting to OFF.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-project-settings-for-keycloak-authentication_keycloak-totp">
<title>Configuring {Project} Settings for {Keycloak} Authentication</title>
<simpara>Use this section to configure {Project} for {Keycloak} authentication using the {Project} web UI or the CLI.</simpara>
<section xml:id="configuring-project-settings-for-keycloak-authentication-using-the-web-ui_keycloak-totp">
<title>Configuring {Project} Settings for {Keycloak} Authentication Using the Web UI</title>
<simpara>Use this procedure to configure {Project} settings for {Keycloak} authentication using the {Project} web UI.</simpara>
<simpara>Note that you can navigate to the following URL within your realm to obtain values to configure {Project} settings: <literal><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration">https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration</link></literal></simpara>
<itemizedlist>
<title>Prerequisite</title>
<listitem>
<simpara>Ensure that the <emphasis role="strong">Access Type</emphasis> setting in the {Project} client in the {Keycloak} web UI is set to <emphasis role="strong">confidential</emphasis></simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Settings</emphasis>, and click the <emphasis role="strong">Authentication</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">Authorize login delegation</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to <emphasis role="strong">Yes</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">Authorize login delegation auth source user autocreate</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column,
set the value to <emphasis role="strong">External</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">Login delegation logout URL</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to
<emphasis role="strong"><link xlink:href="https://{foreman-example-com}/users/extlogout">https://{foreman-example-com}/users/extlogout</link></emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC Algorithm</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the algorithm for encoding on {Keycloak} to <emphasis role="strong">RS256</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC Audience</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to the client ID for {Keycloak}.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC Issuer</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to <emphasis role="strong"><emphasis><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm">https://{Keycloak-short}.com/auth/realms/{Project}_Realm</link></emphasis></emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC JWKs URL</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to <emphasis role="strong"><emphasis><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm/protocol/openid-connect/certs">https://{Keycloak-short}.com/auth/realms/{Project}_Realm/protocol/openid-connect/certs</link></emphasis></emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Authentication Sources</emphasis> and click <emphasis role="strong">External</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create LDAP Authentication Source</emphasis> and select the {Keycloak} server.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Locations</emphasis> tab and add locations that can use the {Keycloak} authentication source.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Organizations</emphasis> tab and add organizations that can use the {Keycloak} authentication source.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-project-settings-for-keycloak-authentication-using-the-cli_keycloak-totp">
<title>Configuring {Project} Settings for {Keycloak} Authentication Using the CLI</title>
<simpara>Use this procedure to configure {Project} settings for {Keycloak} authentication using the {Project} CLI.</simpara>
<simpara>Note that you can navigate to the following URL within your realm to obtain values to configure {Project} settings: <literal><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration">https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration</link></literal></simpara>
<itemizedlist>
<title>Prerequisite</title>
<listitem>
<simpara>Ensure that the <emphasis role="strong">Access Type</emphasis> setting in the {Project} client in the {Keycloak} web UI is set to <emphasis role="strong">public</emphasis></simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On {Project}, set the login delegation to <literal>true</literal> so that users can authenticate using the Open IDC protocol:</simpara>
<screen># hammer settings set --name authorize_login_delegation --value true</screen>
</listitem>
<listitem>
<simpara>Set the login delegation logout URL:</simpara>
<screen># hammer settings set --name login_delegation_logout_url \
--value https://{foreman-example-com}/users/extlogout</screen>
</listitem>
<listitem>
<simpara>Set the algorithm for encoding on {Keycloak}, for example, <literal>RS256</literal>:</simpara>
<screen># hammer settings set --name oidc_algorithm --value 'RS256'</screen>
</listitem>
<listitem>
<simpara>Open the <literal><emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/<emphasis>{Keycloak-short}_REALM</emphasis>/.well-known/openid-configuration</literal> URL and note the values to populate the options in the following steps.</simpara>
</listitem>
<listitem>
<simpara>Add the value for the Hammer client in the Open IDC audience:</simpara>
<screen># hammer settings set --name oidc_audience \
--value "['<emphasis>{foreman-example-com}</emphasis>-hammer-openidc']"</screen>
<note>
<simpara>If you register several {Keycloak} clients to {Project}, ensure that you append all audiences in the array.
For example:</simpara>
<screen># hammer settings set --name oidc_audience \
--value "['<emphasis>{foreman-example-com}</emphasis>-foreman-openidc', '<emphasis>{foreman-example-com}</emphasis>-hammer-openidc']"</screen>
</note>
</listitem>
<listitem>
<simpara>Set the value for the Open IDC issuer:</simpara>
<screen># hammer settings set --name oidc_issuer \
--value "<emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/<emphasis>{Keycloak-short}_Realm</emphasis>"</screen>
</listitem>
<listitem>
<simpara>Set the value for Open IDC Java Web Token (JWT):</simpara>
<screen># hammer settings set --name oidc_jwks_url \
--value "<emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/<emphasis>{Keycloak-short}_Realm</emphasis>/protocol/openid-connect/certs"</screen>
</listitem>
<listitem>
<simpara>Retrieve the ID of the {Keycloak} authentication source:</simpara>
<screen># hammer auth-source external list</screen>
</listitem>
<listitem>
<simpara>Set the location and organization:</simpara>
<screen># hammer auth-source external update --id <emphasis>Authentication Source ID</emphasis> \
--location-ids <emphasis>Location ID</emphasis> --organization-ids <emphasis>Organization ID</emphasis></screen>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="configuring-project-with-keycloak-for-totp-authentication_keycloak-totp">
<title>Configuring {Project} with {Keycloak} for TOTP Authentication</title>
<simpara>Use this procedure to configure {Project} to use {Keycloak} as an OpenID provider for external authentication with Time-based One-time Password (TOTP).</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Keycloak} web UI, navigate to the {Project} realm.</simpara>
</listitem>
<listitem>
<simpara>Navigate to <emphasis role="strong">Authentication</emphasis>, and click the <emphasis role="strong">OTP Policy</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the <emphasis role="strong">Supported Applications</emphasis> field includes FreeOTP or Google Authenticator.</simpara>
</listitem>
<listitem>
<simpara>Configure the OTP settings to suit your requirements.</simpara>
</listitem>
<listitem>
<simpara>Optional: If you want to use TOTP authentication as a default authentication method for all users, click the <emphasis role="strong">Flows</emphasis> tab, and to the right of the <emphasis role="strong">OTP Form</emphasis> setting, select <emphasis role="strong">REQUIRED</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Required Actions</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>To the right of the <emphasis role="strong">Configure OTP</emphasis> row, select the <emphasis role="strong">Default Action</emphasis> check box.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="logging-in-to-the-project-web-ui-using-keycloak-totp-authentication_keycloak-totp">
<title>Logging in to the {Project} Web UI Using {Keycloak} TOTP Authentication</title>
<simpara>Use this procedure to log in to the {Project} web UI using {Keycloak} TOTP authentication.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to {Project}, {Project} redirects you to the {Keycloak} login screen.</simpara>
</listitem>
<listitem>
<simpara>Enter your username and password, and click <emphasis role="strong">Log In</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>The first attempt to log in, {Keycloak} requests you to configure your client by scanning the barcode and entering the pin displayed.</simpara>
</listitem>
<listitem>
<simpara>After you configure your client and enter a valid PIN, {Keycloak} redirects you to {Project} and
logs you in.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="logging-in-to-the-project-cli-using-keycloak_keycloak-totp">
<title>Logging in to the {Project} CLI Using {Keycloak}</title>
<simpara>Use this procedure to authenticate to the {Project} CLI using the code grant type.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>To authenticate to the {Project} CLI using the code grant type, enter the following command:</simpara>
<screen># hammer auth login oauth \
--two-factor \
--oidc-token-endpoint 'https://<emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/ssl-realm/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<emphasis>{Keycloak-short}.example.com</emphasis>/auth' \
--oidc-client-id '<emphasis>{foreman-example-com}</emphasis>-foreman-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</screen>
<simpara>The command prompts you to enter a success code.</simpara>
</listitem>
<listitem>
<simpara>To retrieve the success code, navigate to the URL that the command returns and provide the required information.</simpara>
</listitem>
<listitem>
<simpara>Copy the success code that the web UI returns.</simpara>
</listitem>
<listitem>
<simpara>In the command prompt of <literal>hammer auth login oauth</literal>, enter the success code to authenticate to the {Project} CLI.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-group-mapping-for-keycloak-authentication_keycloak-totp">
<title>Configuring Group Mapping for {Keycloak} Authentication</title>
<simpara>Optionally, to implement the Role Based Access Control (RBAC), create a group in {Project}, assign a role to this group, and then map an Active Directory group to the {Project} group.
As a result, anyone in the given group in {Keycloak} are logged in under the corresponding {Project} group.
This example configures users of the {Project}-admin user group in the Active Directory to authenticate as users with administrator privileges on {Project}.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">User Groups</emphasis>, and click the <emphasis role="strong">Create User Group</emphasis> button.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the user group.
The name should not be the same as in the Active Directory.</simpara>
</listitem>
<listitem>
<simpara>Do not add users and user groups to the right-hand columns.
Click the <emphasis role="strong">Roles</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Administer</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">External Groups</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add external user group</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter the name of the Active Directory group.</simpara>
</listitem>
<listitem>
<simpara>From the list, select <emphasis role="strong">EXTERNAL</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="configuring-keycloak-authentication-with-cac-cards_admin">
<title>Configuring {Keycloak} Authentication with {PIV} Cards</title>
<simpara>Use this section to configure {Project} to use {Keycloak} as an OpenID provider for external authentication with {PIV} cards.</simpara>
<section xml:id="prerequisites-for-integrating-project-with-keycloak_keycloak-cac-cards">
<title>Prerequisites for Configuring {Project} with {Keycloak} Authentication</title>
<simpara>Before configuring {Project} with {Keycloak} external authentication, ensure that you meet the following requirements:</simpara>
<itemizedlist>
<listitem>
<simpara>A working installation of {Keycloak} server that uses HTTPS instead of HTTP.</simpara>
</listitem>
<listitem>
<simpara>A {Keycloak} account with admin privileges.</simpara>
</listitem>
<listitem>
<simpara>A realm for {Project} user accounts created in {Keycloak}.</simpara>
</listitem>
<listitem>
<simpara>If the certificates or the CA are self-signed, ensure that they are added to the end-user certificate trust store.</simpara>
</listitem>
<listitem>
<simpara>Users imported or added to {Keycloak}.</simpara>
<simpara>If you have an existing user database configured such as LDAP or Kerberos, you can import users from it by configuring user federation.
For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user-storage-federation">User Storage Federation</link> in the <emphasis>Red Hat Single Sign-On Server Administration Guide</emphasis>.</simpara>
<simpara>If you do not have an existing user database configured, you can manually create users in {Keycloak}.
For more information, see <link xlink:href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html/server_administration_guide/user_management#create-new-user">Creating New Users</link> in the <emphasis>Red Hat Single Sign-On Server Administration Guide</emphasis>.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="registering-project-as-a-keycloak-client_keycloak-cac-cards">
<title>Registering {Project} as a {Keycloak} Client</title>
<simpara>Use this procedure to register {Project} to {Keycloak} as a client and configure {Project} to use {Keycloak} as an authentication source.</simpara>
<simpara>You can configure {Project} and {Keycloak} with two different authentication methods:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Users authenticate to {Project} using the {Project} web UI.</simpara>
</listitem>
<listitem>
<simpara>Users authenticate to {Project} using the {Project} CLI.</simpara>
</listitem>
</orderedlist>
<simpara>You must decide on how you want your users to authenticate in advance because both methods require different {Project} clients to be registered to {Keycloak} and configured.
The steps to register and configure {Project} client in {Keycloak} are distinguished within the procedure.</simpara>
<simpara>You can also register two different {Project} clients to {Keycloak} if you want to use both authentication methods and configure both clients accordingly.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On the {Project} server, install the following packages:</simpara>
<screen># {package-install-project} mod_auth_openidc keycloak-httpd-client-install</screen>
</listitem>
<listitem>
<simpara>Register {Project} to {Keycloak} as a client.
Note that you the registration process for logging in using the web UI and the CLI are different.
You can register two clients {Project} clients to {Keycloak} to be able to log in to {Project} from the web UI and the CLI.</simpara>
<itemizedlist>
<listitem>
<simpara>If you want you users to authenticate to {Project} using the web UI, create a client as follows:</simpara>
<screen># keycloak-httpd-client-install --app-name foreman-openidc \
--keycloak-server-url "<emphasis>https://{Keycloak-short}.com</emphasis>" \
--keycloak-admin-username "<emphasis>admin</emphasis>" \
--keycloak-realm "<emphasis>{Project}_Realm</emphasis>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</screen>
<simpara>Enter the password for the administer account when prompted.
This command creates a client for {Project} in {Keycloak}.</simpara>
<simpara>Then, configure {Project} to use {Keycloak} as an authentication source:</simpara>
<screen># satellite-installer --foreman-keycloak true \
--foreman-keycloak-app-name "foreman-openidc" \
--foreman-keycloak-realm "<emphasis>{Project}_Realm</emphasis>"</screen>
</listitem>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the CLI, create a client as follows:</simpara>
<screen># keycloak-httpd-client-install --app-name hammer-openidc \
--keycloak-server-url "<emphasis>https://{Keycloak-short}.com</emphasis>" \
--keycloak-admin-username "<emphasis>admin</emphasis>" \
--keycloak-realm "<emphasis>{Project}_Realm</emphasis>" \
--keycloak-admin-realm master \
--keycloak-auth-role root-admin \
-t openidc -l /users/extlogin --force</screen>
<simpara>Enter the password for the administer account when prompted.
This command creates a client for {Project} in {Keycloak}.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Restart the <literal>httpd</literal> service:</simpara>
<screen># systemctl restart httpd</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-the-project-client-in-keycloak_keycloak-cac-cards">
<title>Configuring the {Project} Client in {Keycloak}</title>
<simpara>Use this procedure to configure the {Project} client in the {Keycloak} web UI and create group and audience mappers for the {Project} client.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Keycloak} web UI, navigate to <emphasis role="strong">Clients</emphasis> and click the {Project} client.</simpara>
</listitem>
<listitem>
<simpara>Configure access type:</simpara>
<itemizedlist>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the web UI, from the <emphasis role="strong">Access Type</emphasis> list, select <emphasis role="strong">confidential</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the CLI, from the <emphasis role="strong">Access Type</emphasis> list, select <emphasis role="strong">public</emphasis>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Valid redirect URI</emphasis> fields, add a valid redirect URI.</simpara>
<itemizedlist>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the web UI, in the blank field below the existing URI, enter a URI in the form <literal><link xlink:href="https://{foreman-example-com}/users/extlogin">https://{foreman-example-com}/users/extlogin</link></literal>. Note that you must add the string <literal>/users/extlogin</literal> after the {Project} FQDN.</simpara>
<simpara>After completing this step, the {Project} client for logging in using the web UI must have the following <emphasis role="strong">Valid Redirect URIs</emphasis>:</simpara>
<screen>https://{foreman-example-com}/users/extlogin/redirect_uri
https://{foreman-example-com}/users/extlogin</screen>
</listitem>
<listitem>
<simpara>If you want your users to authenticate to {Project} using the CLI, in the blank field below the existing URI, enter <emphasis role="strong">urn:ietf:wg:oauth:2.0:oob</emphasis>.</simpara>
<simpara>After completing this step, the {Project} client for logging in using the CLI must have the following <emphasis role="strong">Valid Redirect URIs</emphasis>:</simpara>
<screen>https://{foreman-example-com}/users/extlogin/redirect_uri
urn:ietf:wg:oauth:2.0:oob</screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Mappers</emphasis> tab and click <emphasis role="strong">Create</emphasis> to add an audience mapper.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the audience mapper.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Mapper Type</emphasis> list, select <emphasis role="strong">Audience</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Included Client Audience</emphasis> list, select the {Project} client.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create</emphasis> to add a group mapper so that you can specify authorization in {Project} based on group membership.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the group mapper.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Mapper Type</emphasis> list, select <emphasis role="strong">Group Membership</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Token Claim Name</emphasis> field, enter <emphasis role="strong">groups</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Set the <emphasis role="strong">Full group path</emphasis> setting to OFF.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-project-settings-for-keycloak-authentication_keycloak-cac-cards">
<title>Configuring {Project} Settings for {Keycloak} Authentication</title>
<simpara>Use this section to configure {Project} for {Keycloak} authentication using the {Project} web UI or the CLI.</simpara>
<section xml:id="configuring-project-settings-for-keycloak-authentication-using-the-web-ui_keycloak-cac-cards">
<title>Configuring {Project} Settings for {Keycloak} Authentication Using the Web UI</title>
<simpara>Use this procedure to configure {Project} settings for {Keycloak} authentication using the {Project} web UI.</simpara>
<simpara>Note that you can navigate to the following URL within your realm to obtain values to configure {Project} settings: <literal><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration">https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration</link></literal></simpara>
<itemizedlist>
<title>Prerequisite</title>
<listitem>
<simpara>Ensure that the <emphasis role="strong">Access Type</emphasis> setting in the {Project} client in the {Keycloak} web UI is set to <emphasis role="strong">confidential</emphasis></simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Settings</emphasis>, and click the <emphasis role="strong">Authentication</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">Authorize login delegation</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to <emphasis role="strong">Yes</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">Authorize login delegation auth source user autocreate</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column,
set the value to <emphasis role="strong">External</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">Login delegation logout URL</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to
<emphasis role="strong"><link xlink:href="https://{foreman-example-com}/users/extlogout">https://{foreman-example-com}/users/extlogout</link></emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC Algorithm</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the algorithm for encoding on {Keycloak} to <emphasis role="strong">RS256</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC Audience</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to the client ID for {Keycloak}.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC Issuer</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to <emphasis role="strong"><emphasis><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm">https://{Keycloak-short}.com/auth/realms/{Project}_Realm</link></emphasis></emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Locate the <emphasis role="strong">OIDC JWKs URL</emphasis> row, and in the <emphasis role="strong">Value</emphasis> column, set the value to <emphasis role="strong"><emphasis><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm/protocol/openid-connect/certs">https://{Keycloak-short}.com/auth/realms/{Project}_Realm/protocol/openid-connect/certs</link></emphasis></emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Authentication Sources</emphasis> and click <emphasis role="strong">External</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Create LDAP Authentication Source</emphasis> and select the {Keycloak} server.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Locations</emphasis> tab and add locations that can use the {Keycloak} authentication source.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Organizations</emphasis> tab and add organizations that can use the {Keycloak} authentication source.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-project-settings-for-keycloak-authentication-using-the-cli_keycloak-cac-cards">
<title>Configuring {Project} Settings for {Keycloak} Authentication Using the CLI</title>
<simpara>Use this procedure to configure {Project} settings for {Keycloak} authentication using the {Project} CLI.</simpara>
<simpara>Note that you can navigate to the following URL within your realm to obtain values to configure {Project} settings: <literal><link xlink:href="https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration">https://{Keycloak-short}.com/auth/realms/{Project}_Realm/.well-known/openid-configuration</link></literal></simpara>
<itemizedlist>
<title>Prerequisite</title>
<listitem>
<simpara>Ensure that the <emphasis role="strong">Access Type</emphasis> setting in the {Project} client in the {Keycloak} web UI is set to <emphasis role="strong">public</emphasis></simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On {Project}, set the login delegation to <literal>true</literal> so that users can authenticate using the Open IDC protocol:</simpara>
<screen># hammer settings set --name authorize_login_delegation --value true</screen>
</listitem>
<listitem>
<simpara>Set the login delegation logout URL:</simpara>
<screen># hammer settings set --name login_delegation_logout_url \
--value https://{foreman-example-com}/users/extlogout</screen>
</listitem>
<listitem>
<simpara>Set the algorithm for encoding on {Keycloak}, for example, <literal>RS256</literal>:</simpara>
<screen># hammer settings set --name oidc_algorithm --value 'RS256'</screen>
</listitem>
<listitem>
<simpara>Open the <literal><emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/<emphasis>{Keycloak-short}_REALM</emphasis>/.well-known/openid-configuration</literal> URL and note the values to populate the options in the following steps.</simpara>
</listitem>
<listitem>
<simpara>Add the value for the Hammer client in the Open IDC audience:</simpara>
<screen># hammer settings set --name oidc_audience \
--value "['<emphasis>{foreman-example-com}</emphasis>-hammer-openidc']"</screen>
<note>
<simpara>If you register several {Keycloak} clients to {Project}, ensure that you append all audiences in the array.
For example:</simpara>
<screen># hammer settings set --name oidc_audience \
--value "['<emphasis>{foreman-example-com}</emphasis>-foreman-openidc', '<emphasis>{foreman-example-com}</emphasis>-hammer-openidc']"</screen>
</note>
</listitem>
<listitem>
<simpara>Set the value for the Open IDC issuer:</simpara>
<screen># hammer settings set --name oidc_issuer \
--value "<emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/<emphasis>{Keycloak-short}_Realm</emphasis>"</screen>
</listitem>
<listitem>
<simpara>Set the value for Open IDC Java Web Token (JWT):</simpara>
<screen># hammer settings set --name oidc_jwks_url \
--value "<emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/<emphasis>{Keycloak-short}_Realm</emphasis>/protocol/openid-connect/certs"</screen>
</listitem>
<listitem>
<simpara>Retrieve the ID of the {Keycloak} authentication source:</simpara>
<screen># hammer auth-source external list</screen>
</listitem>
<listitem>
<simpara>Set the location and organization:</simpara>
<screen># hammer auth-source external update --id <emphasis>Authentication Source ID</emphasis> \
--location-ids <emphasis>Location ID</emphasis> --organization-ids <emphasis>Organization ID</emphasis></screen>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="configuring-keycloak-settings-for-authentication-with-cac-cards_keycloak-cac-cards">
<title>Configuring {Keycloak} Settings for Authentication With {PIV} Cards</title>
<simpara>You must configure {Keycloak} settings for authentication with {PIV} cards.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Keycloak} web UI, navigate to the <emphasis role="strong">Authentication</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Flows</emphasis> list, select <emphasis role="strong">Browser</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Copy</emphasis> to copy this flow.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Copy Authentication Flow</emphasis> window, enter a new name for the flow and click <emphasis role="strong">OK</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the copied flow, delete <emphasis role="strong">Username Password Form</emphasis> and <emphasis role="strong">OTP Form</emphasis> entries.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add execution</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Provider</emphasis> list, select <emphasis role="strong">X509/Validate Username Form</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">X509/Validate Username Form</emphasis> raw, select <emphasis role="strong">ALTERNATIVE</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">X509/Validate Username Form</emphasis> raw, click <emphasis role="strong">Actions</emphasis> &gt; <emphasis role="strong">Config</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Alias</emphasis> field, enter a name for this configuration.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">User Identity Source</emphasis> list, select <emphasis role="strong">Subject’s Common Name</emphasis>,</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">User mapping method</emphasis> list, select <emphasis role="strong">Username or Email</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Navigate to <emphasis role="strong">Authentication</emphasis> &gt; <emphasis role="strong">Bindings</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Browser Flow</emphasis> list, select the created flow.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-users-os-for-keycloak-authentication-with-cac-cards_keycloak-cac-cards">
<title>Configuring Users' OS for {Keycloak} Authentication with {PIV} Cards</title>
<simpara>Complete this procedure on each system from which you want to be able to log in to {Project} using {Keycloak} {PIV} cards.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Install required packages:</simpara>
<screen>{package-install-project} opensc -y</screen>
</listitem>
<listitem>
<simpara>Install the Firefox browser if not installed.</simpara>
</listitem>
<listitem>
<simpara>Launch Firefox and navigate to <emphasis role="strong">Preferences</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Privacy and Security</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Security Devices</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Load</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the Load PKCS#11 Device Driver window, in the <emphasis role="strong">Module Name</emphasis> field, enter a name for this device.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Module filename</emphasis> field, enter <emphasis role="strong">/usr/lib64/pkcs11/opensc-pkcs11.so</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">OK</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>If the {PIV} card is connected to system, restart the <literal>pcscd</literal> service.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="logging-in-to-the-project-web-ui-using-keycloak-cac-cards_keycloak-cac-cards">
<title>Logging in to the {Project} Web UI Using {Keycloak} {PIV} Cards</title>
<simpara>Use this procedure to log in to the {Project} web UI using the {Keycloak} {PIV} cards.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In Firefox, log in to {Project} and enter your credentials.</simpara>
</listitem>
<listitem>
<simpara>When prompted, enter the PIN of the {PIV} card.</simpara>
</listitem>
<listitem>
<simpara>Choose the certificate for authentication.
Browser verifies this certificate with {Keycloak}.
Once authenticated, browser redirects you back to {Project} and logs you in.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="logging-in-to-the-project-cli-using-keycloak_keycloak-cac-cards">
<title>Logging in to the {Project} CLI Using {Keycloak}</title>
<simpara>Use this procedure to authenticate to the {Project} CLI using the code grant type.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>To authenticate to the {Project} CLI using the code grant type, enter the following command:</simpara>
<screen># hammer auth login oauth \
--two-factor \
--oidc-token-endpoint 'https://<emphasis>{Keycloak-short}.example.com</emphasis>/auth/realms/ssl-realm/protocol/openid-connect/token' \
--oidc-authorization-endpoint 'https://<emphasis>{Keycloak-short}.example.com</emphasis>/auth' \
--oidc-client-id '<emphasis>{foreman-example-com}</emphasis>-foreman-openidc' \
--oidc-redirect-uri urn:ietf:wg:oauth:2.0:oob</screen>
<simpara>The command prompts you to enter a success code.</simpara>
</listitem>
<listitem>
<simpara>To retrieve the success code, navigate to the URL that the command returns and provide the required information.</simpara>
</listitem>
<listitem>
<simpara>Copy the success code that the web UI returns.</simpara>
</listitem>
<listitem>
<simpara>In the command prompt of <literal>hammer auth login oauth</literal>, enter the success code to authenticate to the {Project} CLI.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring-group-mapping-for-keycloak-authentication_keycloak-cac-cards">
<title>Configuring Group Mapping for {Keycloak} Authentication</title>
<simpara>Optionally, to implement the Role Based Access Control (RBAC), create a group in {Project}, assign a role to this group, and then map an Active Directory group to the {Project} group.
As a result, anyone in the given group in {Keycloak} are logged in under the corresponding {Project} group.
This example configures users of the {Project}-admin user group in the Active Directory to authenticate as users with administrator privileges on {Project}.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the {Project} web UI, navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">User Groups</emphasis>, and click the <emphasis role="strong">Create User Group</emphasis> button.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the user group.
The name should not be the same as in the Active Directory.</simpara>
</listitem>
<listitem>
<simpara>Do not add users and user groups to the right-hand columns.
Click the <emphasis role="strong">Roles</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Administer</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">External Groups</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add external user group</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter the name of the Active Directory group.</simpara>
</listitem>
<listitem>
<simpara>From the list, select <emphasis role="strong">EXTERNAL</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="disabling-keycloak-authentication_admin">
<title>Disabling {Keycloak} Authentication</title>
<simpara>If you want to disable {Keycloak} authentication in {Project}, complete this procedure.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Enter the following command to disable {Keycloak} Authentication:</simpara>
<screen># {foreman-installer} --reset-foreman-keycloak</screen>
</listitem>
</itemizedlist>
</section>
</chapter>
<chapter xml:id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Monitoring_Resources">
<title>Monitoring Resources</title>
<simpara>The following chapter details how to configure monitoring and reporting for managed systems.
This includes host configuration, content views, compliance, subscriptions, registered hosts, promotions and synchronization.</simpara>
<section xml:id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Using_the_Red_Hat_Satellite_Content_Dashboard">
<title>Using the {ProjectName} Content Dashboard</title>
<simpara>The {ProjectName} content dashboard contains various widgets which provide an overview of the host configuration, Content Views, compliance reports, subscriptions and hosts currently registered, promotions and synchronization, and a list of the latest notifications.</simpara>
<simpara>Navigate to <emphasis role="strong">Monitor</emphasis> &gt; <emphasis role="strong">Dashboard</emphasis> to access the content dashboard.
The dashboard can be rearranged by clicking on a widget and dragging it to a different position.
The following widgets are available:</simpara>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Host_Configuration_Status">
<varlistentry>
<term><emphasis role="strong">Host Configuration Status</emphasis></term>
<listitem>
<simpara>An overview of the configuration states and the number of hosts associated with it during the last reporting interval.
The following table shows the descriptions of the possible configuration states.</simpara>
<table xml:id="tabl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Host_Configuration_Status-Host_Configuration_Status" frame="all" rowsep="1" colsep="1">
<title>Host Configuration States</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="11*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="56*"/>
<thead>
<row>
<entry align="left" valign="top">Icon</entry>
<entry align="left" valign="top">State</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/1.png"/>
</imageobject>
<textobject><phrase>1</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts that had performed modifications without error</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Host that successfully performed modifications during the last reporting interval.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/2.png"/>
</imageobject>
<textobject><phrase>2</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts in error state</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Hosts on which an error was detected during the last reporting interval.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/3.png"/>
</imageobject>
<textobject><phrase>3</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Good host reports in the last 35 minutes</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Hosts without error that did not perform any modifications in the last 35 minutes.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/4.png"/>
</imageobject>
<textobject><phrase>4</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts that had pending changes</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Hosts on which some resources would be applied but Puppet was configured to run in the <literal>noop</literal> mode.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/5.png"/>
</imageobject>
<textobject><phrase>5</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Out of sync hosts</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Hosts that were not synchronized and the report was not received during the last reporting interval.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/6.png"/>
</imageobject>
<textobject><phrase>6</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts with no reports</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Hosts for which no reports were collected during the last reporting interval.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/7.png"/>
</imageobject>
<textobject><phrase>7</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts with alerts disabled</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Hosts which are not being monitored.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>Click the particular configuration status to view hosts associated with it.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Host_Configuration_Chart">
<varlistentry>
<term><emphasis role="strong">Host Configuration Chart</emphasis></term>
<listitem>
<simpara>A pie chart shows the proportion of the configuration status and the percentage of all hosts associated with it.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Latest_Notifications">
<varlistentry>
<term><emphasis role="strong">Latest Events</emphasis></term>
<listitem>
<simpara>A list of messages produced by hosts including administration information, product and subscription changes, and any errors.</simpara>
<simpara>Monitor this section for global notifications sent to all users and to detect any unusual activity or errors.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Run_Distribution">
<varlistentry>
<term><emphasis role="strong">Run Distribution (last 30 minutes)</emphasis></term>
<listitem>
<simpara>A graph shows the distribution of the running Puppet agents during the last puppet interval which is 30 minutes by default.
In this case, each column represents a number of reports received from clients during 3 minutes.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-New_Hosts">
<varlistentry>
<term><emphasis role="strong">New Hosts</emphasis></term>
<listitem>
<simpara>A list of the recently created hosts.
Click the host for more details.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Task_Status">
<varlistentry>
<term><emphasis role="strong">Task Status</emphasis></term>
<listitem>
<simpara>A summary of all current tasks, grouped by their state and result.
Click the number to see the list of corresponding tasks.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Latest_Warning-Error_Tasks">
<varlistentry>
<term><emphasis role="strong">Latest Warning/Error Tasks</emphasis></term>
<listitem>
<simpara>A list of the latest tasks that have been stopped due to a warning or error.
Click a task to see more details.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Discovered_Hosts">
<varlistentry>
<term><emphasis role="strong">Discovered Hosts</emphasis></term>
<listitem>
<simpara>A list of all bare-metal hosts detected on the provisioning network by the Discovery plug-in.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Latest_Errata">
<varlistentry>
<term><emphasis role="strong">Latest Errata</emphasis></term>
<listitem>
<simpara>A list of all errata available for hosts registered to {Project}.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Content_Views">
<varlistentry>
<term><emphasis role="strong">Content Views</emphasis></term>
<listitem>
<simpara>A list of all Content Views in {Project} and their publish status.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Sync_Overview">
<varlistentry>
<term><emphasis role="strong">Sync Overview</emphasis></term>
<listitem>
<simpara>An overview of all products or repositories enabled in {Project} and their synchronization status.
All products that are in the queue for synchronization, are unsynchronized or have been previously synchronized are listed in this section.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Host_Subscription_Status">
<varlistentry>
<term><emphasis role="strong">Host Subscription Status</emphasis></term>
<listitem>
<simpara>An overview of the subscriptions currently consumed by the hosts registered to {Project}.
A subscription is a purchased certificate that unlocks access to software, upgrades, and security fixes for hosts.
The following table shows the possible states of subscriptions.</simpara>
<table xml:id="tabl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Host_Subscription_Status-Host_Subscription_States" frame="all" rowsep="1" colsep="1">
<title>Host Subscription States</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="11*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="56*"/>
<thead>
<row>
<entry align="left" valign="top">Icon</entry>
<entry align="left" valign="top">State</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/1229.png"/>
</imageobject>
<textobject><phrase>1229</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Invalid</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Hosts that have products installed, but are not correctly subscribed.
These hosts need attention immediately.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/1230.png"/>
</imageobject>
<textobject><phrase>1230</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Partial</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Hosts that have a subscription and a valid entitlement, but are not using their full entitlements.
These hosts should be monitored to ensure they are configured as expected.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/1228.png"/>
</imageobject>
<textobject><phrase>1228</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Valid</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Hosts that have a valid entitlement and are using their full entitlements.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>Click the subscription type to view hosts associated with subscriptions of the selected type.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Subscription_Status">
<varlistentry>
<term><emphasis role="strong">Subscription Status</emphasis></term>
<listitem>
<simpara>An overview of the current subscription totals that shows the number of active subscriptions, the number of subscriptions that expire in the next 120 days, and the number of subscriptions that have recently expired.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Host_Collections">
<varlistentry>
<term><emphasis role="strong">Host Collections</emphasis></term>
<listitem>
<simpara>A list of all host collections in {Project} and their status, including the number of content hosts in each host collection.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Virt-who_Configuration_Status">
<varlistentry>
<term><emphasis role="strong">Virt-who Configuration Status</emphasis></term>
<listitem>
<simpara>An overview of the status of reports received from the <literal>virt-who</literal> daemon running on hosts in the environment.
The following table shows the possible states.</simpara>
<table xml:id="tabl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Virt-who_Configuration_Status-Virt-who_Configuration_States" frame="all" rowsep="1" colsep="1">
<title>Virt-who Configuration States</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="22*"/>
<colspec colname="col_2" colwidth="78*"/>
<thead>
<row>
<entry align="left" valign="top">State</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">No Reports</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>No report has been received because either an error occurred during the virt-who configuration deployment, or the configuration has not been deployed yet, or virt-who cannot connect to Foreman during the scheduled interval.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">No Change</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>No report has been received because hypervisor did not detect any changes on the virtual machines, or virt-who failed to upload the reports during the scheduled interval.
If you added a virtual machine but the configuration is in the <emphasis role="strong">No Change</emphasis> state, check that virt-who is running.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">OK</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The report has been received without any errors during the scheduled interval.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Total Configurations</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A total number of virt-who configurations.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>Click the configuration status to see all configurations in this state.</simpara>
<simpara>The widget also lists the three latest configurations in the <emphasis role="strong">No Change</emphasis> state under <emphasis role="strong">Latest Configurations Without Change</emphasis>.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Latest_Compliance_Reports">
<varlistentry>
<term><emphasis role="strong">Latest Compliance Reports</emphasis></term>
<listitem>
<simpara>A list of the latest compliance reports.
Each compliance report shows a number of rules passed (P), failed (F), or othered (O).
Click the host for the detailed compliance report.
Click the policy for more details on that policy.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Compliance_Reports_Breakdown">
<varlistentry>
<term><emphasis role="strong">Compliance Reports Breakdown</emphasis></term>
<listitem>
<simpara>A pie chart shows the distribution of compliance reports according to their status.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Red_Hat_Insights_Actions">
<varlistentry>
<term><emphasis role="strong">Red Hat Insights Actions</emphasis></term>
<listitem>
<simpara>Red Hat Insights is a tool embedded in {Project} that checks the environment and suggests actions you can take.
The actions are divided into 4 categories: Availability, Stability, Performance, and Security.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Concepts_Cloud_CFSE_Dashboard_Concepts_Cloud_CFSE_Dashboard_Concepts_CFSEDashboard-Red_Hat_Insights_Risk_Summary">
<varlistentry>
<term><emphasis role="strong">Red Hat Insights Risk Summary</emphasis></term>
<listitem>
<simpara>A table shows the distribution of the actions according to the risk levels.
Risk level represents how critical the action is and how likely it is to cause an actual issue.
The possible risk levels are: Low, Medium, High, and Critical.</simpara>
<note>
<simpara>It is not possible to change the date format displayed in the {Project} web UI.</simpara>
</note>
</listitem>
</varlistentry>
</variablelist>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Using_the_Red_Hat_Satellite_Content_Dashboard-Managing_Tasks">
<title>Managing Tasks</title>
<simpara>{ProjectName} keeps a complete log of all planned or performed tasks, such as repositories synchronised, errata applied, and Content Views published.
To review the log, navigate to <emphasis role="strong">Monitor</emphasis> &gt; <emphasis role="strong">Tasks</emphasis>.</simpara>
<simpara>In the Task window, you can search for specific tasks, view their status, details, and elapsed time since they started.
You can also cancel and resume one or more tasks.</simpara>
<simpara>The tasks are managed using the Dynflow engine.
Remote tasks have a timeout which can be adjusted as needed.</simpara>
<orderedlist xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Using_the_Red_Hat_Satellite_Content_Dashboard-Managing_Tasks-To_Adjust_Timeout_Settings" numeration="arabic">
<title>To Adjust Timeout Settings:</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Settings</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter <emphasis>%_timeout</emphasis> in the search box and click <emphasis role="strong">Search</emphasis>.
The search should return four settings, including a description.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Value</emphasis> column, click the icon next to a number to edit it.</simpara>
</listitem>
<listitem>
<simpara>Enter the desired value in seconds, and click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>Adjusting the <emphasis>%_finish_timeout</emphasis> values might help in case of low bandwidth.
Adjusting the <emphasis>%_accept_timeout</emphasis> values might help in case of high latency.</simpara>
</note>
<simpara>When a task is initialized, any back-end service that will be used in the task, such as Candlepin or Pulp, will be checked for correct functioning.
If the check fails, you will receive an error similar to the following one:</simpara>
<screen>There was an issue with the backend service candlepin: Connection refused – connect(2).</screen>
<simpara>If the back-end service checking feature turns out to be causing any trouble, it can be disabled as follows.</simpara>
<orderedlist xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Using_the_Red_Hat_Satellite_Content_Dashboard-Managing_Tasks-To_Disable_Checking_For_Services" numeration="arabic">
<title>To Disable Checking for Services:</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Settings</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter <emphasis>check_services_before_actions</emphasis> in the search box and click <emphasis role="strong">Search</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Value</emphasis> column, click the icon to edit the value.</simpara>
</listitem>
<listitem>
<simpara>From the drop-down menu, select <emphasis role="strong">false</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Save</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_RSS_Notifications">
<title>Configuring RSS Notifications</title>
<simpara>To view {Project} event notification alerts, click the <emphasis role="strong">Notifications</emphasis> icon in the upper right of the screen.</simpara>
<simpara>By default, the Notifications area displays RSS feed events published in the <link xlink:href="https://theforeman.org/blog/">Foreman Blog</link>.</simpara>
<simpara>The feed is refreshed every 12 hours and the Notifications area is updated whenever new events become available.</simpara>
<simpara>You can configure the RSS feed notifications by changing the URL feed.
The supported feed format is RSS 2.0 and Atom.
For an example of the RSS 2.0 feed structure, see the <link xlink:href="https://access.redhat.com/blogs/1169563/feed">{ProjectName} Blog feed</link>.
For an example of the Atom feed structure, see the <link xlink:href="https://theforeman.org/feed.xml">Foreman blog feed</link>.</simpara>
<orderedlist xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_the_Notifications_Drawer-To_Configure_an_RSS_Feed_to_Notifications" numeration="arabic">
<title>To Configure RSS Feed Notifications:</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Settings</emphasis> and select the <emphasis role="strong">Notifications</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>In the RSS URL row, click the edit icon in the <emphasis role="strong">Value</emphasis> column and type the required URL.</simpara>
</listitem>
<listitem>
<simpara>In the RSS enable row, click the edit icon in the <emphasis role="strong">Value</emphasis> column to enable or disable this feature.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Monitoring_Satellite_Server">
<title>Monitoring {ProjectServer}</title>
<simpara>From the <emphasis role="strong">About</emphasis> page in the {ProjectServer} web UI, you can find an overview of the following:</simpara>
<itemizedlist>
<listitem>
<simpara>System Status, including {SmartProxies}, Available Providers, Compute Resources, and Plug-ins</simpara>
</listitem>
<listitem>
<simpara>Support information</simpara>
</listitem>
<listitem>
<simpara>System Information</simpara>
</listitem>
<listitem>
<simpara>Backend System Status</simpara>
</listitem>
<listitem>
<simpara>Installed packages</simpara>
</listitem>
</itemizedlist>
<simpara>To navigate to the <emphasis role="strong">About</emphasis> page:</simpara>
<itemizedlist>
<listitem>
<simpara>In the upper right corner of the {ProjectServer} web UI, click <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">About</emphasis>.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>After Pulp failure, the status of Pulp might show <emphasis role="strong">OK</emphasis> instead of <emphasis role="strong">Error</emphasis> for up to 10 minutes due to synchronization delay.</simpara>
</note>
</section>
<section xml:id="chap-Documentation-Administering_Red_Hat_Satellite-Monitoring_Capsule_Servers">
<title>Monitoring {SmartProxyServer}</title>
<simpara>The following section shows how to use the {Project} web UI to find {SmartProxy} information valuable for maintenance and troubleshooting.</simpara>
<section xml:id="sect-Documentation-Administering_Red_Hat_Satellite-Viewing_Capsule_Details">
<title>Viewing General {SmartProxy} Information</title>
<simpara>Navigate to <emphasis role="strong">Infrastructure</emphasis> &gt; <emphasis role="strong">{SmartProxies}</emphasis> to view a table of {SmartProxyServer}s registered to the {ProjectServer}.
The information contained in the table answers the following questions:</simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong">Is the {SmartProxyServer} running?</emphasis></term>
<listitem>
<simpara>This is indicated by a green icon in the <emphasis role="strong">Status</emphasis> column.
A red icon indicates an inactive {SmartProxy}, use the <literal>service foreman-proxy restart</literal> command on the {SmartProxyServer} to activate it.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">What services are enabled on the {SmartProxyServer}?</emphasis></term>
<listitem>
<simpara>In the <emphasis role="strong">Features</emphasis> column you can verify if the {SmartProxy} for example provides a DHCP service or acts as a Pulp mirror.
{SmartProxy} features can be enabled during installation or configured in addition.
For more information, see {InstallingSmartProxyDocURL}[Installing {SmartProxyServer}].</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">What organizations and locations is the {SmartProxyServer} assigned to?</emphasis></term>
<listitem>
<simpara>A {SmartProxyServer} can be assigned to multiple organizations and locations, but only {SmartProxies} belonging to the currently selected organization are displayed.
To list all {SmartProxies}, select <emphasis role="strong">Any Organization</emphasis> from the context menu in the top left corner.</simpara>
<simpara>After changing the {SmartProxy} configuration, select <emphasis role="strong">Refresh</emphasis> from the drop-down menu in the <emphasis role="strong">Actions</emphasis> column to make sure the {SmartProxy} table is up to date.</simpara>
<simpara>Click the {SmartProxy} name to view further details.
At the <emphasis role="strong">Overview</emphasis> tab, you can find the same information as in the {SmartProxy} table.
In addition, you can answer to the following questions:</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">Which hosts are managed by the {SmartProxyServer}?</emphasis></term>
<listitem>
<simpara>The number of associated hosts is displayed next to the <emphasis role="strong">Hosts managed</emphasis> label.
Click the number to view the details of associated hosts.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">How much storage space is available on the {SmartProxyServer}?</emphasis></term>
<listitem>
<simpara>The amount of storage space occupied by the Pulp content in <literal>/var/lib/pulp</literal> is displayed.
Also the remaining storage space available on the {SmartProxy} can be ascertained.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="sect-Documentation-Administering_Red_Hat_Satellite-Monitoring_Services">
<title>Monitoring Services</title>
<simpara>Navigate to <emphasis role="strong">Infrastructure</emphasis> &gt; <emphasis role="strong">{SmartProxies}</emphasis> and click the name of the selected {SmartProxy}.
At the <emphasis role="strong">Services</emphasis> tab, you can find basic information on {SmartProxy} services, such as the list of DNS domains, or the number of Pulp workers.
The appearance of the page depends on what services are enabled on the {SmartProxyServer}.
Services providing more detailed status information can have dedicated tabs at the {SmartProxy} page (see <xref linkend="sect-Documentation-Administering_{Project_Link}-Monitoring_Puppet"/>).</simpara>
</section>
<section xml:id="sect-Documentation-Administering_Red_Hat_Satellite-Monitoring_Puppet">
<title>Monitoring Puppet</title>
<simpara>Navigate to <emphasis role="strong">Infrastructure</emphasis> &gt; <emphasis role="strong">{SmartProxies}</emphasis> and click the name of the selected {SmartProxy}.
At the <emphasis role="strong">Puppet</emphasis> tab you can find the following:</simpara>
<itemizedlist>
<listitem>
<simpara>A summary of Puppet events, an overview of latest Puppet runs, and the synchronization status of associated hosts at the <emphasis role="strong">General</emphasis> sub-tab.</simpara>
</listitem>
<listitem>
<simpara>A list of Puppet environments at the <emphasis role="strong">Environments</emphasis> sub-tab.</simpara>
</listitem>
</itemizedlist>
<simpara>At the <emphasis role="strong">Puppet CA</emphasis> tab you can find the following:</simpara>
<itemizedlist>
<listitem>
<simpara>A certificate status overview and the number of autosign entries at the <emphasis role="strong">General</emphasis> sub-tab.</simpara>
</listitem>
<listitem>
<simpara>A table of CA certificates associated with the {SmartProxy} at the <emphasis role="strong">Certificates</emphasis> sub-tab.
Here you can inspect the certificate expiry data, or cancel the certificate by clicking <emphasis role="strong">Revoke</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>A list of autosign entries at the  <emphasis role="strong">Autosign entries</emphasis> sub-tab.
Here you can create an entry by clicking <emphasis role="strong">New</emphasis> or delete one by clicking <emphasis role="strong">Delete</emphasis>.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="monitoring_trends" remap="_monitoring_trends">
<title>Monitoring Trends</title>
<simpara xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Monitoring_Trends">You can use trends to track changes in your infrastructure over time, such as Puppet reports or Facts, and then plan accordingly.</simpara>
<orderedlist xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Monitoring_Trends-To_View_a_Trend" numeration="arabic">
<title>To View a Trend:</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Monitor</emphasis> &gt; <emphasis role="strong">Trends</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the Trends page, select the trend you want to view from the <emphasis role="strong">Trends</emphasis> list.</simpara>
</listitem>
</orderedlist>
<orderedlist xml:id="proc-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Monitoring_Trends-To_Create_a_Trend" numeration="arabic">
<title>To Create a Trend:</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Monitor</emphasis> &gt; <emphasis role="strong">Trends</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the Trends page, click the <emphasis role="strong">Add Trend Counter</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Trend type</emphasis> list, select the category for the new trend.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Trendable</emphasis> list, select the subject for the new trend (if applicable).</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the new trend.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>If this is the first trend, create a <literal>cron</literal> job to collect trend data:</simpara>
<screen># foreman-rake trends:counter</screen>
<simpara>You can set the interval for trend data collection.
For example, to collect data once an hour, on the hour:</simpara>
<screen>0 * * * * /usr/sbin/foreman-rake trends:counter</screen>
</note>
</section>
</chapter>
<chapter xml:id="chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Searching_and_Bookmarking">
<title>Searching and Bookmarking</title>
<simpara>The {Project} web UI features powerful search functionality which is available on most pages of the web UI.
It enables you to search all kinds of resources that {ProjectServer} manages.
Searches accept both free text and syntax-based queries, which can be built using extensive input prediction.
Search queries can be saved as bookmarks for future reuse.</simpara>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Searching_and_Bookmarking-Building_Search_Queries">
<title>Building Search Queries</title>
<simpara>As you start typing a search query, a list of valid options to complete the current part of the query appears.
You can either select an option from the list and keep building the query using the prediction, or continue typing.
To learn how free text is interpreted by the search engine, see <xref linkend="sect-{Project_Link}-Administering_{Project_Link}-Searching_and_Bookmarking-Using_Free_Text_Search"/>.</simpara>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Query_Syntax">
<title>Query Syntax</title>
<screen><emphasis>parameter</emphasis> <emphasis>operator</emphasis> <emphasis>value</emphasis></screen>
<simpara>Available fields, resources to search, and the way the query is interpreted all depend on context, that is, the page where you perform the search.
For example, the field "hostgroup" on the Hosts page is equivalent to the field "name" on the Host Groups page.
The field type also determines available operators and accepted values.
For a list of all operators, see <link linkend="sect-{Project_Link}-Administering_{Project_Link}-Operators">Operators</link>.
For descriptions of value formats, see <link linkend="sect-{Project_Link}-Administering_{Project_Link}-Values">Values</link>.</simpara>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Operators">
<title>Operators</title>
<simpara>All operators that can be used between <emphasis>parameter</emphasis> and <emphasis>value</emphasis> are listed in the following table.
Other symbols and special characters that might appear in a prediction-built query, such as colons, do not have special meaning and are treated as free text.</simpara>
<table xml:id="tabl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Operators-Comparison_Operators" frame="all" rowsep="1" colsep="1">
<title>Comparison Operators Accepted by Search</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="17*"/>
<colspec colname="col_2" colwidth="17*"/>
<colspec colname="col_3" colwidth="33*"/>
<colspec colname="col_4" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">Operator</entry>
<entry align="left" valign="top">Short Name</entry>
<entry align="left" valign="top">Description</entry>
<entry align="left" valign="top">Example</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>=</simpara></entry>
<entry align="left" valign="top"><simpara>EQUALS</simpara></entry>
<entry align="left" valign="top" morerows="1"><simpara>Accepts numerical, temporal, or text values.
For text, exact case sensitive matches are returned.</simpara></entry>
<entry align="left" valign="top" morerows="1"><simpara><literal>hostgroup = RHEL7</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>!=</simpara></entry>
<entry align="left" valign="top"><simpara>NOT EQUALS</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>~</simpara></entry>
<entry align="left" valign="top"><simpara>LIKE</simpara></entry>
<entry align="left" valign="top" morerows="1"><simpara>Accepts text or temporal values.
Returns case insensitive matches.
Accepts the following wildcards: _ for a single character, % or * for any number of characters including zero.
If no wildcard is specified, the string is treated as if surrounded by wildcards: %rhel7%</simpara></entry>
<entry align="left" valign="top" morerows="1"><simpara><literal>hostgroup ~ rhel%</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>!~</simpara></entry>
<entry align="left" valign="top"><simpara>NOT LIKE</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>&gt;</simpara></entry>
<entry align="left" valign="top"><simpara>GREATER THAN</simpara></entry>
<entry align="left" valign="top" morerows="1"><simpara>Accepts numerical or temporal values.
For temporal values, the operator &gt; is interpreted as "later than", and &lt; as "earlier than".
Both operators can be combined with EQUALS: &gt;= &lt;=</simpara></entry>
<entry align="left" valign="top" morerows="1"><simpara><literal>registered_at &gt; 10-January-2017</literal>
<?asciidoc-br?>
The search will return hosts that have been registered after the given date, that is, between 10th January 2017 and now.</simpara>
<simpara><literal>registered_at &lt;= Yesterday</literal>
<?asciidoc-br?>
The search will return hosts that have been registered yesterday or earlier.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>&lt;</simpara></entry>
<entry align="left" valign="top"><simpara>LESS THAN</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>^</simpara></entry>
<entry align="left" valign="top"><simpara>IN</simpara></entry>
<entry align="left" valign="top" morerows="1"><simpara>Compares an expression against a list of values, as in SQL.
Returns matches that contain or not contain the values, respectively.</simpara></entry>
<entry align="left" valign="top" morerows="1"><simpara><literal>release_version !^ 7</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>!^</simpara></entry>
<entry align="left" valign="top"><simpara>NOT IN</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>HAS or set?</simpara></entry>
<entry align="left" valign="top"><simpara> </simpara></entry>
<entry align="left" valign="top" morerows="1"><simpara>Returns values that are present or not present, respectively.</simpara></entry>
<entry align="left" valign="top" morerows="1"><simpara><literal>has hostgroup</literal> or <literal>set? hostgroup</literal>
<?asciidoc-br?>
On the Puppet Classes page, the search will return classes that are assigned to at least one host group.</simpara>
<simpara><literal>not has hostgroup</literal> or <literal>null? hostgroup</literal>
<?asciidoc-br?>
On the Dashboard with an overview of hosts, the search will return all hosts that have no assigned host group.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NOT HAS or null?</simpara></entry>
<entry align="left" valign="top"><simpara> </simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>Simple queries that follow the described syntax can be combined into more complex ones using logical operators AND, OR, and NOT.
Alternative notations of the operators are also accepted:</simpara>
<table xml:id="tabl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Query_Syntax-Logical_Operators" frame="all" rowsep="1" colsep="1">
<title>Logical Operators Accepted by Search</title>
<tgroup cols="5">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="10*"/>
<colspec colname="col_3" colwidth="10*"/>
<colspec colname="col_4" colwidth="10*"/>
<colspec colname="col_5" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Operator</entry>
<entry align="left" valign="top" namest="col_2" nameend="col_4">Alternative Notations</entry>
<entry align="left" valign="top">Example</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>and</simpara></entry>
<entry align="left" valign="top"><simpara>&amp;</simpara></entry>
<entry align="left" valign="top"><simpara>&amp;&amp;</simpara></entry>
<entry align="left" valign="top"><simpara>&lt;whitespace&gt;</simpara></entry>
<entry align="left" valign="top"><simpara><literal>class = motd AND environment ~ production</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>or</simpara></entry>
<entry align="left" valign="top"><simpara>|</simpara></entry>
<entry align="left" valign="top"><simpara>||</simpara></entry>
<entry align="left" valign="top"><simpara> </simpara></entry>
<entry align="left" valign="top"><simpara><literal>errata_status = errata_needed || errata_status = security_needed</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>not</simpara></entry>
<entry align="left" valign="top"><simpara>–</simpara></entry>
<entry align="left" valign="top"><simpara>!</simpara></entry>
<entry align="left" valign="top"><simpara> </simpara></entry>
<entry align="left" valign="top"><simpara><literal>hostgroup ~ rhel7 not status.failed</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Values">
<title>Values</title>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Values-Text_Values">
<varlistentry>
<term><emphasis role="strong">Text Values</emphasis></term>
<listitem>
<simpara>Text containing whitespaces must be enclosed in quotes.
A whitespace is otherwise interpreted as the AND operator.</simpara>
<simpara><emphasis role="strong">Examples:</emphasis></simpara>
<simpara><literal>hostgroup = "Web servers"</literal></simpara>
<simpara>The search will return hosts with assigned host group named "Web servers".</simpara>
<simpara><literal>hostgroup = Web servers</literal></simpara>
<simpara>The search will return hosts in the host group Web with any field matching %servers%.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="varl-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Values-Temporal_Values">
<varlistentry>
<term><emphasis role="strong">Temporal Values</emphasis></term>
<listitem>
<simpara>Many date and time formats are accepted, including the following:</simpara>
<itemizedlist>
<listitem>
<simpara>"10 January 2017"</simpara>
</listitem>
<listitem>
<simpara>"10 Jan 2017"</simpara>
</listitem>
<listitem>
<simpara>10-January-2017</simpara>
</listitem>
<listitem>
<simpara>10/January/2017</simpara>
</listitem>
<listitem>
<simpara>"January 10, 2017"</simpara>
</listitem>
<listitem>
<simpara>Today, Yesterday, and the like.</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<warning>
<simpara>Avoid ambiguous date formats, such as 02/10/2017 or 10-02-2017.</simpara>
</warning>
</section>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Searching_and_Bookmarking-Using_Free_Text_Search">
<title>Using Free Text Search</title>
<simpara>When you enter free text, it will be searched for across multiple fields.
For example, if you type "64", the search will return all hosts that have that number in their name, IP address, MAC address, and architecture.</simpara>
<note>
<simpara>Multi-word queries must be enclosed in quotes, otherwise the whitespace is interpreted as the AND operator.</simpara>
</note>
<simpara>Because of searching across all fields, free text search results are not very accurate and searching can be slow, especially on a large number of hosts.
For this reason, we recommend that you avoid free text and use more specific, syntax-based queries whenever possible.</simpara>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Searching_and_Bookmarking-Bookmarking">
<title>Managing Bookmarks</title>
<simpara>You can save search queries as bookmarks for reuse.
You can also delete or modify a bookmark.</simpara>
<simpara>Bookmarks appear only on the page on which they were created.
On some pages, there are default bookmarks available for the common searches, for example, all <literal>active</literal> or <literal>disabled</literal> hosts.</simpara>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Searching_and_Bookmarking-Creating_Bookmarks">
<title>Creating Bookmarks</title>
<simpara>This section details how to save a search query as a bookmark.
You must save the search query on the relevant page to create a bookmark for that page, for example, saving a host related search query on the Hosts page.</simpara>
<orderedlist xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Searching_and_Bookmarking-To_Create_a_Bookmark" numeration="arabic">
<title>To Create a Bookmark:</title>
<listitem>
<simpara>Navigate to the page where you want to create a bookmark.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Search</emphasis> field, enter the search query you want to save.</simpara>
</listitem>
<listitem>
<simpara>Select the arrow to the right of the <emphasis role="strong">Search</emphasis> button and then select <emphasis role="strong">Bookmark this search</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Name</emphasis> field, enter a name for the new bookmark.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Search query</emphasis> field, ensure your search query is correct.</simpara>
</listitem>
<listitem>
<simpara>Ensure the <emphasis role="strong">Public</emphasis> check box is set correctly:</simpara>
<itemizedlist>
<listitem>
<simpara>Select the <emphasis role="strong">Public</emphasis> check box to set the bookmark as public and visible to all users.</simpara>
</listitem>
<listitem>
<simpara>Clear the <emphasis role="strong">Public</emphasis> check box to set the bookmark as private and only visible to the user who created it.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Submit</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>To confirm the creation, either select the arrow to the right of the <emphasis role="strong">Search</emphasis> button to display the list of bookmarks, or navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Bookmarks</emphasis> and then check the <emphasis role="strong">Bookmarks</emphasis> list for the name of the bookmark.</simpara>
</section>
<section xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Searching_and_Bookmarking-Deleting_Bookmarks">
<title>Deleting Bookmarks</title>
<simpara>You can delete bookmarks on the Bookmarks page.</simpara>
<orderedlist xml:id="sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Searching_and_Bookmarking-To_Delete_a_Bookmark" numeration="arabic">
<title>To Delete a Bookmark:</title>
<listitem>
<simpara>Navigate to <emphasis role="strong">Administer</emphasis> &gt; <emphasis role="strong">Bookmarks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the Bookmarks page, click <emphasis role="strong">Delete</emphasis> for the Bookmark you want to delete.</simpara>
</listitem>
<listitem>
<simpara>When the confirmation window opens, click <emphasis role="strong">OK</emphasis> to confirm the deletion.</simpara>
</listitem>
</orderedlist>
<simpara>To confirm the deletion, check the <emphasis role="strong">Bookmarks</emphasis> list for the name of the bookmark.</simpara>
</section>
</section>
</chapter>
<appendix xml:id="satellite-settings_admin">
<title>{Project} Settings</title>
<simpara>This section contains noteworthy information or known issues about settings that you can edit in the {Project} web UI by navigating to <literal>Administer</literal> &gt; <literal>Settings</literal>.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>General Settings Information</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top"><emphasis role="strong">Setting</emphasis></entry>
<entry align="left" valign="top"><emphasis role="strong">Description</emphasis></entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Fix DB cache</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>{Project} maintains a cache of permissions and roles.
When set to <literal>Yes</literal>, {Project} recreates this cache on the next restart.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<table frame="all" rowsep="1" colsep="1">
<title>Provisioning Settings Information</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top"><emphasis role="strong">Setting</emphasis></entry>
<entry align="left" valign="top"><emphasis role="strong">Description</emphasis></entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Type of name generator</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Specifies the method used to generate a host name when creating a new host.</simpara><simpara>The default <literal>Random-based</literal> option generates a unique random host name which you can but do not have to use.
This is useful for users who create many hosts and do not know how to name them.</simpara><simpara>The <literal>MAC-based</literal> option is for bare-metal hosts only.
If you delete a host and create it later on, it receives the same host name based on the MAC address.
This can be useful for users who recycle servers and want them to always get the same host name.</simpara><simpara>The <literal>Off</literal> option disables the name generator function and leaves the host name field blank.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Safemode rendering</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Enables safe mode rendering of provisioning templates.
The default and recommended option <literal>Yes</literal> denies the access to variables and any object that is not whitelisted within {Project}.</simpara><simpara>When set to <literal>No</literal>, any object may be accessed by a user with permission to use templating features, either via editing of templates, parameters or smart variables.
This permits users full remote code execution on {ProjectServer}, effectively disabling all authorization.
This is not a safe option, especially in bigger companies.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Exclude pattern for facts stored in {Project}</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Until <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1759111">BZ#1759111</link> is resolved, note that if you use the wildcard value, for example <literal>docker*</literal>, to exclude all facts beginning with <literal>docker</literal>, this also excludes facts that contain the excluded term in any part of the name.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Ignore interfaces with matching identifier</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Until <link xlink:href="https://bugzilla.redhat.com/show_bug.cgi?id=1759111">BZ#1759111</link> is resolved, note that if you use the wildcard value, for example <literal>docker*</literal>, to ignore all facts beginning with <literal>docker</literal>, this also excludes facts that contain the ignored term in any part of the name.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</appendix><xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="Revision_History.xml"/>

</book>