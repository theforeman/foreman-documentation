= Katello 4.2.0

A full list of changes is available via https://projects.theforeman.org/issues?set_filter=1&sort=id%3Adesc&status_id=closed&f%5B%5D=cf_12&op%5Bcf_12%5D=%3D&v%5Bcf_12%5D%5B%5D=1383[Redmine]

== Katello

* Change ImportersCoreImportsApi to ImportersPulpImportsApi - https://projects.theforeman.org/issues/33006[#33006]
* Crane support is no longer needed by the RegistryResource - https://projects.theforeman.org/issues/32972[#32972]
* Parse Amazon distribution properly - https://projects.theforeman.org/issues/32807[#32807]
* Deb repo calls pulp2 when checking published during matching content check - https://projects.theforeman.org/issues/32761[#32761]
* Katello:delete_orphaned_content still checking for pulp2 services and failing with 404s. - https://projects.theforeman.org/issues/32740[#32740]
* Pin qpid_proton to "&lt; 0.34" - https://projects.theforeman.org/issues/32619[#32619]
* Fix pulpcore smart proxy error message - https://projects.theforeman.org/issues/32613[#32613]
* Remove content view publishing/promoting/removal support for pulp2 repos in actions - https://projects.theforeman.org/issues/32580[#32580]
* Changing the HTTP proxy for a repository that doesn't have an upstream URL causes an error (nightly) - https://projects.theforeman.org/issues/32578[#32578]
* Remove rhsm parser and importer - https://projects.theforeman.org/issues/32524[#32524]
* Make helper methods public for webhooks context - https://projects.theforeman.org/issues/32523[#32523]
* Add support for AlmaLinux OS - https://projects.theforeman.org/issues/32510[#32510]
* Use Foreman client certificates to communicate with Pulp 3 API - https://projects.theforeman.org/issues/32487[#32487]
* katello:clean_backend_objects still attempts to connect to Pulp 2 - https://projects.theforeman.org/issues/32475[#32475]
* CV UI - Add Publish workflow to new CV UI (Component CVs) - https://projects.theforeman.org/issues/32441[#32441]
*  Errata installation via Host Collection Remote Execution Only Sends First Page of Errata Ids - https://projects.theforeman.org/issues/32436[#32436]
* Permit use of version 2.11 of the pulp_deb_client - https://projects.theforeman.org/issues/32429[#32429]
* [BUG] Non-Admin users cannot generate the command for registration while having "Register hosts" role associated in Satellite 6.9 - https://projects.theforeman.org/issues/32425[#32425]
* Package dependency is wrong on Katello UI - https://projects.theforeman.org/issues/32358[#32358]
* Possible file descriptor leaks - https://projects.theforeman.org/issues/32262[#32262]
* Modify 'Media Selection' string of Operating System's hostgroup page - https://projects.theforeman.org/issues/32237[#32237]
* Hanging task when restarting services during pulp2 to pulp3 migration - https://projects.theforeman.org/issues/32119[#32119]
* Unable to set HostGroup content source to capsule that isn't synced - https://projects.theforeman.org/issues/32100[#32100]
* Pulpcore integration test CI reports - https://projects.theforeman.org/issues/32079[#32079]
* Add auditing for pulp3 import/export - https://projects.theforeman.org/issues/32039[#32039]
* "Failed to discover docker repositories because  'Content Default HTTP Proxy' is not used to connect to the registry." - https://projects.theforeman.org/issues/32036[#32036]
* Katello 4.0 - decide the fate of un-versioned deprecations - https://projects.theforeman.org/issues/31760[#31760]

=== Client/Agent

* via Katello-agent option is not clickable on content host errata page - https://projects.theforeman.org/issues/33036[#33036]
* katello-agent uses incorrect ping mechanism - https://projects.theforeman.org/issues/32591[#32591]
* katello-agent actions can prematurely time out - https://projects.theforeman.org/issues/32569[#32569]
* Katello agent tasks that error prevent re-running due to locked tasks - https://projects.theforeman.org/issues/32447[#32447]
* Potential race condition in katello-agent dynflow actions - https://projects.theforeman.org/issues/32351[#32351]
* Dynflow error output when performing katello-agent action - https://projects.theforeman.org/issues/31853[#31853]

=== Subscriptions

* Not possible to remove subscriptions from 'WebUI --&gt; Content --&gt; Subscriptions' page if the user doesn't have 'Setting' permissions." - https://projects.theforeman.org/issues/33000[#33000]
* Disconnected satellite's subscription page missing the checkbox/select column - https://projects.theforeman.org/issues/32815[#32815]
* Shorten or handle "410 Gone" errors rather than printing a page-long trace for each - https://projects.theforeman.org/issues/32726[#32726]
* Prevent re-register unless host is in build mode - https://projects.theforeman.org/issues/32406[#32406]
* Permit DMI change when host is in build mode - https://projects.theforeman.org/issues/32405[#32405]
* Subscriptions and Pools can be associated across organizations - https://projects.theforeman.org/issues/32334[#32334]
* "Current organization has no manifest imported" error when trying to import a manifest - https://projects.theforeman.org/issues/32320[#32320]
* Auto-attaching subscriptions on a host triggers pool import for all organizations - https://projects.theforeman.org/issues/32267[#32267]
* Manifest deletion indexes subscriptions for all organizations - https://projects.theforeman.org/issues/32261[#32261]
* Syspurpose role is showing empty in the subscription page and rest api even it has a role - https://projects.theforeman.org/issues/30708[#30708]

=== Tooling

* Http Proxy passwords are not making it to candlepin properly - https://projects.theforeman.org/issues/32998[#32998]
* Make with_ansible? check more precise - https://projects.theforeman.org/issues/32839[#32839]
* Drop Passenger specific code - https://projects.theforeman.org/issues/32318[#32318]
* upgrade to pulpcore 3.11 - https://projects.theforeman.org/issues/32234[#32234]
* Support correlation id with pulp3 - https://projects.theforeman.org/issues/29912[#29912]

=== Repositories

* Enabling a RH repo is not reflected in the list of enabled repos - https://projects.theforeman.org/issues/32997[#32997]
* pulp_rpm_client 3.13 throws uninitialized constant PulpRpmClient::OneOfMetadataChecksumTypeEnumNullEnum - https://projects.theforeman.org/issues/32974[#32974]
* Deleting repository shows success toast notification but repositories remain on the page - https://projects.theforeman.org/issues/32965[#32965]
* Upgrade Pulpcore and plugins to 3.14 for Katello master - https://projects.theforeman.org/issues/32933[#32933]
* Creating ansible collection repo fails with: "Invalid URL Ensure the URL ends '/'" but repo gets created - https://projects.theforeman.org/issues/32867[#32867]
* support deleting RH repos from the repositories details - https://projects.theforeman.org/issues/32800[#32800]
* [pulp3] aborting pulp3 content-migration step fails with "NoMethodError: undefined method fetch_from_list" - https://projects.theforeman.org/issues/32786[#32786]
* Create/Read/Update/Destroy Python repository with generic content type registration - https://projects.theforeman.org/issues/32712[#32712]
* Katello 3.18 changed the way RH operating systems are named after sync - https://projects.theforeman.org/issues/32699[#32699]
* Remove references to Pulp 2 from new/update repository UI - https://projects.theforeman.org/issues/32658[#32658]
* Problems when creating a new repository with Chrome - https://projects.theforeman.org/issues/32626[#32626]
* Client receives 403 forbidden when fetching RHEL content when using custom certificates - https://projects.theforeman.org/issues/32624[#32624]
* katello:delete_orphaned_content fails on Katello 3.18 with "backend service pulp3: 503 Service Unavailable" - https://projects.theforeman.org/issues/32623[#32623]
* Unable to delete Red Hat repository due to "bad" root repo data from older Katello - https://projects.theforeman.org/issues/32582[#32582]
* Katello 3.16 to 3.17 upgrade fails at the db:migrate stage with error "ERROR:  insert or update on table "katello_hostgroup_content_facets" violates foreign key constraint" - https://projects.theforeman.org/issues/32498[#32498]
* cannot create a repository with an http proxy set with auth credentials - https://projects.theforeman.org/issues/32422[#32422]
* Need to remove background download policy message from the repo creation page - https://projects.theforeman.org/issues/32402[#32402]
* Deb-content should also publish original structure - https://projects.theforeman.org/issues/32393[#32393]
* katello pulp url setting in katello.yaml is no longer set by the installer and the default uses localhost rather than FQDN - https://projects.theforeman.org/issues/32362[#32362]
* Package matching query does not exist when syncing TimeScaleDB repo after migration - https://projects.theforeman.org/issues/32232[#32232]
* Pulp 3 migration abort fails with 409 - https://projects.theforeman.org/issues/32226[#32226]
* "podman search returns 'archived/versioned' repos, but ISE is returned when pulling them" - https://projects.theforeman.org/issues/32159[#32159]
* deb repo - Verify Content Checksum - undefined method `repair' - https://projects.theforeman.org/issues/32144[#32144]
* Provide repository architecture via medium provider - https://projects.theforeman.org/issues/32077[#32077]
* Unsetting repository architecture restriction doesn't reach clients - https://projects.theforeman.org/issues/32008[#32008]
* remove old pulp2-based upgrade tasks (warnings on 4.0 install) - https://projects.theforeman.org/issues/32007[#32007]
* separator for releases in deb repository is whitespace, not comma - https://projects.theforeman.org/issues/31999[#31999]
* Remove Puppet content support - https://projects.theforeman.org/issues/31997[#31997]
* support new 'feature' names in pulp3 - https://projects.theforeman.org/issues/31968[#31968]
* pulp3 task group actions 'end' as soon as one subtask fails - https://projects.theforeman.org/issues/31905[#31905]
* update references to content (/pulp/repos/  /pulp/isos/ /pulp/deb) to point to /pulp/content/ - https://projects.theforeman.org/issues/31867[#31867]
* Katello not able to handle kickstarts with multiple variants effectively - https://projects.theforeman.org/issues/31801[#31801]
* Remove content_types requirement in katello.yaml and use of it - https://projects.theforeman.org/issues/31616[#31616]
* change bulk_load_size  within katello -&gt; pulp SETTING to use a Setting - https://projects.theforeman.org/issues/31323[#31323]
* Pulp download timeouts should be configurable - https://projects.theforeman.org/issues/17423[#17423]
* Limit packages to sync. - https://projects.theforeman.org/issues/16154[#16154]

=== Hosts

* Add extensions for Packages/Errata/Module streams - https://projects.theforeman.org/issues/32938[#32938]
* Error when trying to restart Traces: TypeError in Katello::RemoteExecutionController#create  no implicit conversion of nil into String - https://projects.theforeman.org/issues/32936[#32936]
* Move the host comment from the Katello Jail to the core - https://projects.theforeman.org/issues/32862[#32862]
* Host registration - :rhsm_base_url helper - https://projects.theforeman.org/issues/32841[#32841]
* Manage Errata from Content Host Page does not provide link to view list of content hosts affected by an Errata. - https://projects.theforeman.org/issues/32806[#32806]
* Old hostgroup with kickstart repository id aren't migrated to the new hostgroup content facet table. - https://projects.theforeman.org/issues/32661[#32661]
* Add Rocky Linux parsing support - https://projects.theforeman.org/issues/32515[#32515]
* Inherited hostgroup values are not set when creating host - https://projects.theforeman.org/issues/32464[#32464]
* Report Templates Host - Applied Errata report is empty. - https://projects.theforeman.org/issues/32312[#32312]
* Content Source missing in Katello 4 RC3 - https://projects.theforeman.org/issues/32298[#32298]
* Hypervisor task failed with NoMethodError: undefined method `split' for nil:NilClass - https://projects.theforeman.org/issues/32150[#32150]
* Default registration method - https://projects.theforeman.org/issues/32106[#32106]
* GR template - add --force option for Sub-man to re-register a host - https://projects.theforeman.org/issues/31820[#31820]
* Host Registration - Activation key field improvement - https://projects.theforeman.org/issues/31809[#31809]
* Show Candlepin version in /rhsm/status API - https://projects.theforeman.org/issues/31706[#31706]
* Actions::Katello::Applicability::Hosts::BulkGenerate called many times with only a single host after sync plan runs - https://projects.theforeman.org/issues/31411[#31411]
* Enable goferless builds by default - https://projects.theforeman.org/issues/31023[#31023]

=== Web UI

* CV UI - Add filters to CV - https://projects.theforeman.org/issues/32932[#32932]
* Change text on Component/Composite tiles in Create CV modal form - https://projects.theforeman.org/issues/32895[#32895]
* Red Hat repositories page filtering dropdowns do not work in production - https://projects.theforeman.org/issues/32711[#32711]
* CV UI - Add component CVs to composite CVs - https://projects.theforeman.org/issues/32698[#32698]
* use-deep-compare to replace usage of JSON.stringify in effect hooks - https://projects.theforeman.org/issues/32621[#32621]
* Update Composite and Component View icons on UI - https://projects.theforeman.org/issues/32349[#32349]
* New Content View Page - CV List page env and version expandable columns - https://projects.theforeman.org/issues/32283[#32283]
* New Content View Page - Versions tab - https://projects.theforeman.org/issues/32281[#32281]
* New Content View page: Back button doesn't work to return to list - https://projects.theforeman.org/issues/32162[#32162]
* Deprecate package groups UI on content host detail page - https://projects.theforeman.org/issues/32137[#32137]
* [sat-e-613] Update UI to hide k-agent dep warnings if it is disabled - https://projects.theforeman.org/issues/31910[#31910]

=== Tests

* Drop puppetclass and environment usage from host tests - https://projects.theforeman.org/issues/32923[#32923]
* Drop Foreman::Environment::Destroy action - https://projects.theforeman.org/issues/32922[#32922]
* Use unsafe_load in tests - https://projects.theforeman.org/issues/32604[#32604]
* npm install error on nightly - https://projects.theforeman.org/issues/32531[#32531]
* Transient package groups test - https://projects.theforeman.org/issues/32527[#32527]
* SubscriptionsTable failing test - https://projects.theforeman.org/issues/32340[#32340]
* Intermittent module stream clause generator test - https://projects.theforeman.org/issues/32231[#32231]
* test failure due to template kinds - https://projects.theforeman.org/issues/32087[#32087]
* bulk_host_extensions transient test failure - https://projects.theforeman.org/issues/31911[#31911]
* Module stream copying tests need to be un-skipped after Pulpcore 3.9.1 is released - https://projects.theforeman.org/issues/31704[#31704]

=== Content Views

* Create content view button doesn't work after the first time - https://projects.theforeman.org/issues/32911[#32911]
* Incremenal Update doesn't run MetadataGenerate or IndexContent for Pulp 3 yum content - https://projects.theforeman.org/issues/32901[#32901]
* Add functionality to publish and promote content view in one API call - https://projects.theforeman.org/issues/32574[#32574]
*  Duplicate YumMetadata index entries in content view repositories causing unneeded capsule sync - https://projects.theforeman.org/issues/32533[#32533]
* Add a show_all endpoint for content view components - https://projects.theforeman.org/issues/32303[#32303]
* Navigation doesn't display Content views (within Lab Features) without admin rights - https://projects.theforeman.org/issues/32138[#32138]
* New Content View Page - Add filter RPM detail pages - https://projects.theforeman.org/issues/31969[#31969]
* New Content View Page - view added CVs for Composite Content View - https://projects.theforeman.org/issues/31827[#31827]
* New Content View Page - Add breadcrumbs - https://projects.theforeman.org/issues/31825[#31825]
* New Content View Page - History Tab - https://projects.theforeman.org/issues/31804[#31804]
* available_for content_view_version parameter to /katello/api/packages or /katello/api/errata is slow - https://projects.theforeman.org/issues/31764[#31764]

=== Lifecycle Environments

* Use correct inverse association for kt_environment -&gt; organization association - https://projects.theforeman.org/issues/32905[#32905]

=== Foreman Proxy Content

* pulp3 remote smart proxies do not show download policy - https://projects.theforeman.org/issues/32882[#32882]
* Error: undefined methodpulp_href’ for nil:NilClass`  when syncing capsule - https://projects.theforeman.org/issues/32784[#32784]
* Katello 4.0 can't sync to a 3.18 proxy - https://projects.theforeman.org/issues/32275[#32275]

=== SElinux

* Allow katello ping controller to check pulpcore-api - https://projects.theforeman.org/issues/32765[#32765]
* Prevent calling systemctl from RoR process - https://projects.theforeman.org/issues/32724[#32724]

=== Errata Management

* repo package upload & package remove doesn't trigger applicability regen for hosts - https://projects.theforeman.org/issues/32601[#32601]
* Removal applicabilty code including event queue event, profile uploadings, applicability actions, config - https://projects.theforeman.org/issues/32459[#32459]
* applicability should run once for a sync plan instead of after every repo - https://projects.theforeman.org/issues/29898[#29898]

=== Upgrades

* 20210119162528_delete_puppet_and_ostree_repos.rb fails to remove puppet repos in CVs, leading to upgrade errors - https://projects.theforeman.org/issues/32590[#32590]

=== Inter Server Sync

* Auto-import/create RH repos/Products on disconnected Katello - https://projects.theforeman.org/issues/32528[#32528]
* hammer export fails with super large  chunk size (change chunk-size-mb to gb) - https://projects.theforeman.org/issues/32421[#32421]
* import/export metadata.json needs to be trimmed - https://projects.theforeman.org/issues/32407[#32407]
* Auto-import custom repos - Disconnected - https://projects.theforeman.org/issues/32333[#32333]
* Auto create cv on import - https://projects.theforeman.org/issues/32241[#32241]
* Can Import/Export file type - https://projects.theforeman.org/issues/32187[#32187]
* Need a dry run option to see content is importable - https://projects.theforeman.org/issues/31955[#31955]

=== Container

* katello should pass Docker-Content-Digest from pulp3 to the container client - https://projects.theforeman.org/issues/32426[#32426]
* Katello should send user to repo permissions mapping to container gateway - https://projects.theforeman.org/issues/32233[#32233]
* syncing pulp3 to pulp2  container content sometimes fails with PLP0000: 'fsLayers - https://projects.theforeman.org/issues/32230[#32230]

=== Roles and Permissions

* Permissions for import/export - https://projects.theforeman.org/issues/32396[#32396]

=== Notifications

* Error performing CreatePulpDiskSpaceNotifications  NameError (undefined local variable or method `percentage' for Katello::UINotifications::Pulp::ProxyDiskSpace:Class) - https://projects.theforeman.org/issues/32380[#32380]
* Expose Katello events for Webhooks - https://projects.theforeman.org/issues/32224[#32224]

=== API

* Use public API to update Setting values - https://projects.theforeman.org/issues/32285[#32285]
* "Unable to print debug information" log message from Katello::HttpResource.print_debug_info - https://projects.theforeman.org/issues/32249[#32249]
* Deprecate agent-based APIs - https://projects.theforeman.org/issues/32156[#32156]
* Remove unused import/export end points - https://projects.theforeman.org/issues/32000[#32000]
* Remove deprecated API params - https://projects.theforeman.org/issues/31996[#31996]

=== Organizations and Locations

* Seed fails with  PG::ForeignKeyViolation: ERROR:  insert or update on table "foreman_tasks_tasks" violates foreign key constraint "fk_rails_a56904dd86" - https://projects.theforeman.org/issues/32277[#32277]

=== Hammer

* hammer activation-key/content-host product-content not working correctly - https://projects.theforeman.org/issues/32259[#32259]

=== Activation Key

* Activation Key details always asking for content view - https://projects.theforeman.org/issues/32225[#32225]
* Activation Key Repository Set page not functioning correctly - https://projects.theforeman.org/issues/32067[#32067]

=== Provisioning

* Remove auto-assign of registration template to OS - https://projects.theforeman.org/issues/32093[#32093]

=== Ansible Collections

* Ansible collection remotes need auth_url, token fields exposed - https://projects.theforeman.org/issues/31928[#31928]
* upgrade pulp ansible plugin to 0.5.0 - https://projects.theforeman.org/issues/31197[#31197]

=== Documentation

* Add documentation for template macros - https://projects.theforeman.org/issues/31859[#31859]
