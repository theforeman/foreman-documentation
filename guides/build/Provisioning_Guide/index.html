<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta charset="UTF-8"/>
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"/><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="generator" content="Asciidoctor 1.5.6.1"/>
<title>Provisioning Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"/>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="book">
<div id="header">
<h1>Provisioning Guide</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="Introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provisioning is a process that starts with a bare physical or virtual machine and ends with a fully configured, ready-to-use operating system. Using Red Hat Satellite, you can define and automate fine-grained provisioning for a large number of hosts.</p>
</div>
<div class="paragraph">
<p>There are many provisioning methods. For example, you can use Satellite Server&#8217;s integrated Capsule or an external Capsule Server to provision bare metal hosts using both PXE based and non-PXE based methods. You can also provision cloud instances from specific providers through their APIs. These provisioning methods are part of the Red Hat Satellite 6 application life cycle to create, manage, and update hosts.</p>
</div>
<div class="sect2">
<h3 id="Introduction-Defining_Provisioning_Types">1.1. Provisioning Types Overview</h3>
<div class="paragraph">
<p>Red Hat Satellite 6 has different methods for provisioning hosts:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Bare Metal Provisioning</dt>
<dd>
<p>Satellite provisions bare metal hosts primarily through PXE boot and MAC address identification. You can create host entries and specify the MAC address of the physical host to provision. You can also boot blank hosts to use Satellite&#8217;s discovery service, which creates a pool of ready-to-provision hosts. You can also boot and provision hosts through PXE-less methods.</p>
</dd>
<dt class="hdlist1">Cloud Providers</dt>
<dd>
<p>Satellite connects to private and public cloud providers to provision instances of hosts from images that are stored with the Cloud environment. This also includes selecting which hardware profile or flavor to use.</p>
</dd>
<dt class="hdlist1">Virtualization Infrastructure</dt>
<dd>
<p>Satellite connects to virtualization infrastructure services such as Red Hat Virtualization and VMware to provision virtual machines from virtual image templates or using the same PXE-based boot methods as bare metal providers.</p>
</dd>
<dt class="hdlist1">Linux Containers</dt>
<dd>
<p>Satellite can create and manage containers on Red Hat Enterprise Linux Atomic Server.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="Introduction-Defining_the_Provisioning_Workflow">1.2. Provisioning Workflow Overview</h3>
<div class="paragraph">
<p>The provisioning process follows a basic workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You create a host. Satellite requests an unused IP address from the DHCP Capsule Server that is associated with the subnet. Satellite loads this IP address into the <strong>IP address</strong> field in the Create Host window. When you complete all the options for the new host, submit the new host request.</p>
</li>
<li>
<p>The DHCP Capsule Server that is associated with the subnet reserves an entry for the host.</p>
</li>
<li>
<p>Satellite configures the DNS records:</p>
<div class="ulist">
<ul>
<li>
<p>A forward DNS record is created on the Capsule Server that is associated with the domain.</p>
</li>
<li>
<p>A reverse DNS record is created on the DNS Capsule Server that is associated with the subnet.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A PXELinux menu is created for the host in the TFTP Capsule Server that is associated with the subnet.</p>
</li>
<li>
<p>The new host requests a DHCP lease from the DHCP server.</p>
</li>
<li>
<p>The DHCP server responds to the lease request and returns TFTP <code>next-server</code> and <code>filename</code> options.</p>
</li>
<li>
<p>The host requests the bootloader and menu from the TFTP server.</p>
</li>
<li>
<p>The PXELinux menu and OS installer for the host is returned over TFTP.</p>
</li>
<li>
<p>The installer requests the provisioning template or script from Satellite.</p>
</li>
<li>
<p>Satellite renders the template and returns the resulting kickstart file to the host.</p>
</li>
<li>
<p>The host enters a build process that installs the operating system, registers the host to Satellite, and installs management tools such as <code>katello-agent</code> and <code>puppet</code>.</p>
</li>
<li>
<p>The installer notifies Satellite of a successful build in the <code>postinstall</code> script.</p>
</li>
<li>
<p>The PXELinux menu reverts to a local boot template.</p>
</li>
<li>
<p>The host starts its operating system. If you configured the host to use any Puppet classes, the host configures itself using the modules stored on Satellite.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This workflow differs depending on custom options. For example:</p>
</div>
<div class="paragraph">
<p><strong>Discovery</strong></p>
</div>
<div class="paragraph">
<p>If you use the Discovery service, Satellite automatically detects the MAC address of the new host and restarts the host after you submit a request. Note that TCP port 8443 must be reachable by the Capsule to which the host is attached for Satellite to restart the host.</p>
</div>
<div class="paragraph">
<p><strong>PXE-less Provisioning</strong></p>
</div>
<div class="paragraph">
<p>After you submit a new host request, you must boot the specific host with a boot disk that you download from Satellite.</p>
</div>
<div class="paragraph">
<p><strong>Compute Resources</strong></p>
</div>
<div class="paragraph">
<p>The compute resource creates the virtual machine for the host and returns the MAC address to Satellite. If you use image-based provisioning, the host does not follow the standard PXE boot and operating system installation: the compute resource creates a copy of the image for the new host to use.</p>
</div>
<div class="paragraph">
<p><strong>Containers</strong></p>
</div>
<div class="paragraph">
<p>The container provisioning process does not follow the workflow process.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_Provisioning_Contexts">2. Configuring Provisioning Contexts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you provision hosts using Satellite, you must understand the placement strategy for hosts in Satellite. This is known as the provisioning context.</p>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Contexts-Defining_a_Provisioning_Context">2.1. Provisioning Context Overview</h3>
<div class="paragraph">
<p>A provisioning context is the combination of an organization and location that you specify for Satellite components. The organization and location that a component belongs to sets the ownership and access for that component.</p>
</div>
<div class="paragraph">
<p>Organizations divide Red Hat Satellite 6 components into logical groups based on ownership, purpose, content, security level, and other divisions. You can create and manage multiple organizations through Red Hat Satellite 6 and assign components to each individual organization. This ensures the Satellite Server provisions hosts within a certain organization and only uses components that are assigned to that organization. For more information about organizations, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_organizations">Managing Organizations</a> in the <em>Content Management Guide</em>.</p>
</div>
<div class="paragraph">
<p>Locations function similar to organizations. The difference is that locations are based on physical or geographical setting. Users can nest locations in a hierarchy.</p>
</div>
<div class="paragraph">
<p>For more information about locations, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_locations">Managing Locations</a> in the <em>Content Management Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Contexts-Setting_the_Provisioning_Context">2.2. Setting the Provisioning Context</h3>
<div class="paragraph">
<p>When you set a context, you define which organization and location to use for provisioning hosts.</p>
</div>
<div class="paragraph">
<p>The organization and location menus are located in the menu bar, on the upper left of the Satellite web UI. If you have not selected an organization and location to use, the menu displays: <strong>Any Organization</strong> and <strong>Any Location</strong>.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To set the provisioning context, click the <strong>Any Organization</strong> and <strong>Any Location</strong> buttons and select the organization and location to use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each user can set their default provisioning context in their account settings. Click the user name in the upper right of the Satellite web UI and select <strong>My account</strong> to edit your user account settings.</p>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>While using the CLI, include either <code>--organization</code> or <code>--organization-label</code> and <code>--location</code> or <code>--location-id</code> as an option. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer host list --organization "Default_Organization" --location "Default_Location"</pre>
</div>
</div>
<div class="paragraph">
<p>This command outputs hosts allocated for the Default_Organization and Default_Location.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_Provisioning_Resources">3. Configuring Provisioning Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat Satellite 6 contains provisioning resources that you can use to create a host.</p>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Creating_Operating_Systems">3.1. Creating Operating Systems</h3>
<div class="paragraph">
<p>An operating system is a collection of resources that define how Satellite Server installs a base operating system on a host. Operating system entries combine previously defined resources, such as installation media, partition tables, provisioning templates, and others.</p>
</div>
<div class="paragraph">
<p>Importing operating systems from Red Hat&#8217;s CDN creates new entries on the <strong>Hosts</strong> &gt; <strong>Operating Systems</strong> page.</p>
</div>
<div class="paragraph">
<p>You can also add custom operating systems using the following procedure:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and click <strong>New Operating</strong> system.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to represent the operating system entry.</p>
</li>
<li>
<p>In the <strong>Major</strong> field, enter the number that corresponds to the major version of the operating system.</p>
</li>
<li>
<p>In the <strong>Minor</strong> field, enter the number that corresponds to the minor version of the operating system.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description of the operating system.</p>
</li>
<li>
<p>From the <strong>Family</strong> list, select the operating system&#8217;s family.</p>
</li>
<li>
<p>From the <strong>Root Password Hash</strong> list, select the encoding method for the root password.</p>
</li>
<li>
<p>From the <strong>Architectures</strong> list, select the architectures that the operating system uses.</p>
</li>
<li>
<p>Click the <strong>Partition table</strong> tab and select the possible partition tables that apply to this operating system.</p>
</li>
<li>
<p>Optional: if you use non-Red&#160;Hat content, click the <strong>Installation media</strong> tab and select the installation media that apply to this operating system. For more information, see <a href="#Configuring_Provisioning_Resources-Creating_Installation_Media">Using Third Party Installation Media</a>.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab and select a <strong>PXELinux template</strong>, a <strong>Provisioning template</strong>, and a <strong>Finish template</strong> for your operating system to use. You can select other templates, for example an <strong>iPXE template</strong>, if you plan to use iPXE for provisioning.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your provisioning template.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the operating system using the <code>hammer os create</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer os create --name "<em>MyOS</em>" \
--description "<em>My_custom_operating_system</em>" \
--major 7 --minor 3 --family "Redhat" --architectures "x86_64" \
--partition-tables "<em>My_Partition</em>" --media "<em>Red_Hat</em>" \
--provisioning-templates "<em>My_Provisioning_Template</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Architectures">3.2. Creating Architectures</h3>
<div class="paragraph">
<p>An architecture in Satellite represents a logical grouping of hosts and operating systems. Architectures are created by Satellite automatically when hosts check in with Puppet. Basic i386 and x86_64 architectures are already preset in Satellite 6.</p>
</div>
<div class="paragraph">
<p>Use this procedure to create an architecture in Satellite.</p>
</div>
<div class="paragraph">
<div class="title">Supported Architectures</div>
<p>Intel x86_64 architecture is supported only for provisioning using PXE, Discovery, and boot disk. For more information, see Red Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/2674001">Architectures Supported for Satellite 6 Provisioning</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create an architecture, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Architectures</strong>, and in the Architectures window, click <strong>Create Architecture</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the architecture.</p>
</li>
<li>
<p>From the <strong>Operating Systems</strong> list, select an operating system. If none are available, you can create and assign them under <strong>Hosts</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Enter the <code>hammer architecture create</code> command to create an architecture. Specify its name and operating systems that include this architecture:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer architecture create --name "<em>Architecture_Name</em>" \
--operatingsystems "<em>os</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Hardware_Models">3.3. Creating Hardware Models</h3>
<div class="paragraph">
<p>Use this procedure to create a hardware model in Satellite so that you can specify what hardware model a host uses.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a hardware model, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Hardware Models</strong>, and in the Hardware Models window, click <strong>Create Model</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the hardware model.</p>
</li>
<li>
<p>Optionally, in the <strong>Hardware Model</strong> and <strong>Vendor Class</strong> fields, you can enter corresponding information for your system.</p>
</li>
<li>
<p>In the <strong>Info</strong> field, enter a description of the hardware model.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your hardware model.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create a hardware model using the <code>hammer model create</code> command. The only required parameter is <code>--name</code>. Optionally, enter the hardware model with the <code>--hardware-model</code> option, a vendor class with the <code>--vendor-class</code> option, and a description with the <code>--info</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer model create --name "<em>model_name</em>" --info "<em>description</em>" \
--hardware-model "<em>hardware_model</em>" --vendor-class "<em>vendor_class</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Using_Kickstart_Repository_as_Installation_Medium">3.4. Using a Synced Kickstart Repository for a Host&#8217;s Operating System</h3>
<div class="paragraph">
<p>Satellite contains a set of synchronized kickstart repositories that you use to install the provisioned host&#8217;s operating system.</p>
</div>
<div class="paragraph">
<p>To set up a kickstart repository, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the synchronized kickstart repository that you want to use to the existing Content View or create a new Content View and add the kickstart repository.</p>
</li>
<li>
<p>Publish a new version of the Content View where the kickstart repository is added and promote it to a required lifecycle environment. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_content_views">Managing Content Views</a> in the <em>Content Management Guide</em>.</p>
</li>
<li>
<p>When you create a host, in the <strong>Operating System</strong> tab, for <strong>Media Selection</strong>, select the <strong>Synced Content</strong> check box.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">To View the Kickstart Tree</div>
<p>To view the kickstart tree enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer medium list --organization "<em>your_organization</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Creating_Partition_Tables">3.5. Creating Partition Tables</h3>
<div class="paragraph">
<p>A partition table is a set of directives that defines the way Satellite Server configures the disks available on a new host. Red Hat Satellite 6 contains a set of default partition tables to use, including a <code>Kickstart default</code>. You can also edit partition table entries to configure the preferred partitioning scheme, or create a partition table entry and add it to the Red Hat Enterprise Linux operating system entry.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create partition tables, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Partition Tables</strong> and, in the Partition Tables window, click <strong>Create Partition Table</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to represent the partition table.</p>
</li>
<li>
<p>Select the <strong>Default</strong> check box if you want to set the template to automatically associate with new organizations or locations.</p>
</li>
<li>
<p>Select the <strong>Snippet</strong> check box if you want to identify the template as a reusable snippet for other partition tables.</p>
</li>
<li>
<p>From the <strong>Operating System Family</strong> list, select the distribution or family of the partitioning layout. For example, Red Hat Enterprise Linux, CentOS, and Fedora are in the Red Hat family.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, enter the layout for the disk partition. For example:</p>
<div class="listingblock">
<div class="content">
<pre>zerombr
clearpart --all --initlabel
autopart</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <strong>Template</strong> file browser to upload a template file.</p>
</div>
<div class="paragraph">
<p>The format of the layout must match that for the intended operating system. For example, Red Hat Enterprise Linux 7.2 requires a layout that matches a kickstart file.</p>
</div>
</li>
<li>
<p>In the <strong>Audit Comment</strong> field, add a summary of changes to the partition layout.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs to add any other provisioning contexts that you want to associate with the partition table. Satellite adds the partition table to the current provisioning context.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your partition table.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Before you create a partition table with the CLI, create a plain text file that contains the partition layout. This example uses the <code>~/my-partition</code> file. Create the installation medium using the <code>hammer partition-table create</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer partition-table create --name "My Partition" --snippet false \
--os-family Redhat --file ~/my-partition --organizations "<em>My_Organization</em>" \
--locations "<em>My_Location</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Creating_Provisioning_Templates">3.6. Creating Provisioning Templates</h3>
<div class="paragraph">
<p>A provisioning template defines the way Satellite Server installs an operating system on a host.</p>
</div>
<div class="sect3">
<h4 id="_types_of_provisioning_templates">3.6.1. Types of Provisioning Templates</h4>
<div class="paragraph">
<p>There are various types of provisioning templates, including:</p>
</div>
<div class="paragraph">
<p><strong>Provision</strong></p>
</div>
<div class="paragraph">
<p>The main template for the provisioning process. For example, a kickstart template. For more information about kickstart template syntax, see the <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Installation_Guide/sect-kickstart-syntax.html">Kickstart Syntax Reference</a> in the <em>Red Hat Enterprise Linux 7 Installation Guide</em>.</p>
</div>
<div class="paragraph">
<p><strong>PXELinux</strong>, <strong>PXEGrub</strong>, <strong>PXEGrub2</strong></p>
</div>
<div class="paragraph">
<p>PXE-based templates that deploy to the template Capsule associated with a subnet to ensure that the host uses the installer with the correct kernel options. For BIOS provisioning, select <strong>PXELinux</strong> template. For UEFI provisioning, select <strong>PXEGrub2</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Finish</strong></p>
</div>
<div class="paragraph">
<p>Post-configuration scripts to use when the main provisioning process completes. This is completed as an SSH task. You can use Finishing templates only for imaged-based provisioning in virtual environments. Do not confuse an image with a foreman discovery ISO, which is sometimes called a Foreman discovery image. An image in this context is an install image in a virtualized environment for easy deployment.</p>
</div>
<div class="paragraph">
<p><strong>Bootdisk</strong></p>
</div>
<div class="paragraph">
<p>Templates for PXE-less boot methods.</p>
</div>
<div class="paragraph">
<p><strong>Kernel Execution (kexec)</strong></p>
</div>
<div class="paragraph">
<p>Kernel execution templates for PXE-less boot methods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Kernel Execution is a Technology Preview feature. Technology Preview features are not fully supported under Red Hat Subscription Service Level Agreements (SLAs), may not be functionally complete, and are not intended for production use. However, these features provide early access to upcoming product innovations, enabling customers to test functionality and provide feedback during the development process.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>user_data</strong></p>
</div>
<div class="paragraph">
<p>Post-configuration scripts for providers that accept user data, such as <code>cloud-init</code> scripts.</p>
</div>
<div class="paragraph">
<p><strong>Script</strong></p>
</div>
<div class="paragraph">
<p>An arbitrary script not used by default but useful for custom tasks.</p>
</div>
<div class="paragraph">
<p><strong>ZTP</strong></p>
</div>
<div class="paragraph">
<p>Zero Touch Provisioning templates.</p>
</div>
<div class="paragraph">
<p><strong>POAP</strong></p>
</div>
<div class="paragraph">
<p>PowerOn Auto Provisioning templates.</p>
</div>
<div class="paragraph">
<p><strong>iPXE</strong></p>
</div>
<div class="paragraph">
<p>Templates for <code>iPXE</code> or <code>gPXE</code> environments to use instead of PXELinux.</p>
</div>
</div>
<div class="sect3">
<h4 id="_template_syntax_and_management">3.6.2. Template Syntax and Management</h4>
<div class="paragraph">
<p>Red Hat Satellite includes many template examples. In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning templates</strong> to view them. You can create a template or clone a template and edit the clone. For help with templates, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning templates</strong> &gt; <strong>Create Template</strong> &gt; <strong>Help</strong>.</p>
</div>
<div class="paragraph">
<p>Templates accept the Embedded Ruby (ERB) syntax. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/managing_hosts/appe-red_hat_satellite-managing_hosts-template_writing_reference">Template Writing Reference</a> in <em>Managing Hosts</em>.</p>
</div>
<div class="paragraph">
<p>You can download provisioning templates. Before you can download the template, you must create a debug certificate. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_organizations#Managing_Organizations-Creating_an_Organization_Debug_Certificate">Creating an Organization Debug Certificate</a> in the <em>Content Management Guide</em>.</p>
</div>
<div class="paragraph">
<p>You can synchronize templates between Satellite Server and a Git repository or a local directory. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/synchronizing_templates_with_git">Appendix F. Synchronizing Templates with Git</a> in the <em>Content Management</em> guide.</p>
</div>
<div class="paragraph">
<div class="title">Change logs and history</div>
<p>To view the history of changes applied to a template, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning templates</strong>, select one of the templates, and click <strong>History</strong>. Click <strong>Revert</strong> to override the editor content with the previous version. It is possible to revert to an earlier change as well. Click <strong>Show Diff</strong> to see information about a specific change:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Template Diff</strong> tab displays changes in the body of a provisioning template.</p>
</li>
<li>
<p><strong>Details</strong> tab displays changes in the template description.</p>
</li>
<li>
<p><strong>History</strong> tab displays the user who made a change to the template and date of the change.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_procedure">3.6.3. Procedure</h4>
<div class="paragraph">
<p>To create a template, complete the following step:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong> and, in the Provisioning Templates window, click <strong>Create Template</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>Help</strong> tab provides information about the template syntax. It details the available functions, variables, and methods that can be called on different types of objects within the template.</p>
</div>
<div class="paragraph">
<p>Alternatively, to clone a template and add your updates to the clone, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong> and search for the template that you want to use.</p>
</li>
<li>
<p>On the template that you want to use, click <strong>Clone</strong> to duplicate it.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the provisioning template.</p>
</li>
<li>
<p>Select the <strong>Default</strong> check box to set the template to associate automatically with new organizations or locations.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, enter the body of the provisioning template. You can also use the <strong>Template</strong> file browser to upload a template file.</p>
</li>
<li>
<p>In the <strong>Audit Comment</strong> field, enter a summary of changes to the provisioning template for auditing purposes.</p>
</li>
<li>
<p>Click the <strong>Type</strong> tab and if your template is a snippet, select the <strong>Snippet</strong> check box. A snippet is not a standalone provisioning template, but a part of a provisioning template that can be inserted into other provisioning templates.</p>
</li>
<li>
<p>From the <strong>Type</strong> list, select the type of the template. For example, <strong>Provisioning template</strong>.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab and from the <strong>Applicable Operating Systems</strong> list, select the names of the operating systems that you want to associate with the provisioning template.</p>
</li>
<li>
<p>Optionally, click <strong>Add combination</strong> and select a host group from the <strong>Host Group</strong> list or an environment from the <strong>Environment</strong> list to associate provisioning template with the host groups and environments.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs to add any additional contexts to the template.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your provisioning template.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Before you create a template with the CLI, create a plain text file that contains the template. This example uses the <code>~/my-template</code> file. Create the installation medium using the <code>hammer template create</code> command and specify the type with the <code>--type</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer template create --name "My Provisioning Template" \
--file ~/my-template --type provision --organizations "<em>My_Organization</em>" \
--locations "<em>My_Location</em>"</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Creating_Compute_Profiles">3.7. Creating Compute Profiles</h3>
<div class="paragraph">
<p>Compute profiles are used in conjunction with compute resources, such as virtualization infrastructure and cloud providers. Compute profiles allow users to predefine hardware such as CPUs, memory, and storage. A default installation of Red Hat Satellite 6 contains three predefined profiles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>1-Small</code></p>
</li>
<li>
<p><code>2-Medium</code></p>
</li>
<li>
<p><code>3-Large</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>, and in the Compute Profiles window, click <strong>Create Compute Profile</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the profile and click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>The compute profile CLI commands are not yet implemented in Red Hat Satellite 6.4.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Setting_Default_Root_Password">3.8. Setting a Default Encrypted Root Password for Hosts</h3>
<div class="paragraph">
<p>If you do not want to set a plain text default root password for the hosts that you provision, you can use a default encrypted password.</p>
</div>
<div class="paragraph">
<p>To set a default encrypted password for your hosts, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate an encrypted password. You can use the following command to generate a password:</p>
<div class="listingblock">
<div class="content">
<pre># python -c 'import crypt,getpass;pw=getpass.getpass(); print(crypt.crypt(pw)) if (pw==getpass.getpass("Confirm: ")) else exit()'</pre>
</div>
</div>
</li>
<li>
<p>Copy the password for later use.</p>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Settings</strong> page, select the <strong>Provisioning</strong> tab.</p>
</li>
<li>
<p>In the <strong>Name</strong> column, navigate to <strong>Root password</strong>, and click <strong>Click to edit</strong>.</p>
</li>
<li>
<p>Paste the encrypted password that you generate, and click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Creating_Installation_Media">3.9. Using Third Party Installation Media</h3>
<div class="paragraph">
<p>Installation media are sources of files for third parties that Satellite Server uses to install a third-party base operating system on a machine. Installation media must be in the format of an operating system installation tree, and must be accessible to the machine hosting the installer through an HTTP URL. You can view installation media by navigating to <strong>Hosts</strong> &gt; <strong>Installation Media</strong> menu.</p>
</div>
<div class="paragraph">
<p>For other installation media, for example, a locally mounted ISO image, you can add your own custom media paths using the following procedure.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create installation media, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Installation Media</strong> and click <strong>Create Medium</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to represent the installation media entry.</p>
</li>
<li>
<p>In the <strong>Path</strong> enter the URL or NFS share that contains the installation tree. You can use following variables in the path to represent multiple different system architectures and versions:</p>
<div class="ulist">
<ul>
<li>
<p><code>$arch</code> - The system architecture.</p>
</li>
<li>
<p><code>$version</code> - The operating system version.</p>
</li>
<li>
<p><code>$major</code> - The operating system major version.</p>
</li>
<li>
<p><code>$minor</code> - The operating system minor version.</p>
<div class="paragraph">
<p>Example HTTP path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://download.example.com/centos/$version/Server/$arch/os/</pre>
</div>
</div>
<div class="paragraph">
<p>Example NFS path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nfs://download.example.com:/centos/$version/Server/$arch/os/</pre>
</div>
</div>
<div class="paragraph">
<p>Synchronized content on Capsule Servers always uses an HTTP path. Capsule Server managed content does not support NFS paths.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>From the <strong>Operating system family</strong> list, select the distribution or family of the installation medium. For example, CentOS, and Fedora are in the <code>Red Hat</code> family.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs, to change the provisioning context. Satellite Server adds the installation medium to the set provisioning context.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your installation medium.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the installation medium using the <code>hammer medium create</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer medium create --name "CustomOS" --os-family "Redhat" \
--path 'http://download.example.com/centos/$version/Server/$arch/os/' \
--organizations "<em>My_Organization</em>" --locations "<em>My_Location</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Accessing_Virtual_Machines_with_the_noVNC_Console">3.10. Using noVNC to Access Virtual Machines</h3>
<div class="paragraph">
<p>You can use your browser to access the VNC console of VMs created by Satellite.</p>
</div>
<div class="paragraph">
<p>Satellite supports using noVNC on the following virtualization platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VMware</p>
</li>
<li>
<p>Libvirt</p>
</li>
<li>
<p>RHV</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the following procedure to configure your virtualization platform and browser to enable the use of the noVNC console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have a virtual machine created by Satellite.</p>
</li>
<li>
<p>For existing virtual machines, ensure that the <strong>Display type</strong> in the <strong>Compute Resource</strong> settings is <strong>VNC</strong>.</p>
</li>
<li>
<p>You must import the Katello root CA certificate into your Satellite Server. Adding a security exception in the browser is not enough for using noVNC. For more information, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/administering_red_hat_satellite/chap-red_hat_satellite-administering_red_hat_satellite-accessing_red_hat_satellite#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Installing_the_Katello_Root_CA_Certificate">Installing the Katello Root CA Certificate</a> section in the <em>Administering Red&#160;Hat Satellite</em> guide.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the VM host system, configure the firewall to allow VNC service on ports 5900 to 5930:</p>
<div class="ulist">
<ul>
<li>
<p>On Red Hat Enterprise Linux 6:</p>
<div class="listingblock">
<div class="content">
<pre># iptables -A INPUT -p tcp --dport 5900:5930 -j ACCEPT
# service iptables save</pre>
</div>
</div>
</li>
<li>
<p>On Red Hat Enterprise Linux 7:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --add-port=5900-5930/tcp
# firewall-cmd --add-port=5900-5930/tcp --permanent</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and select the name of a compute resource.</p>
</li>
<li>
<p>In the <strong>Virtual Machines</strong> tab, select the name of a VM host. Ensure the machine is powered on and then select <strong>Console</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_Networking">4. Configuring Networking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each provisioning type requires some network configuration. Use this chapter to configure network services in Satellite Server&#8217;s integrated Capsule.</p>
</div>
<div class="paragraph">
<p>New hosts must have access to your Capsule Server. A Capsule Server can be either Satellite Server&#8217;s integrated Capsule or an external Capsule Server. You might want to provision hosts from an external Capsule Server when the hosts are on isolated networks and cannot connect to the Satellite Server directly, or when the content is synchronized with the Capsule Server. Provisioning using the external Capsule Server can save on network bandwidth.</p>
</div>
<div class="paragraph">
<p>Configuring the Capsule Server has two basic requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuring network services. This includes:</p>
<div class="ulist">
<ul>
<li>
<p>Content delivery services</p>
</li>
<li>
<p>Network services (DHCP, DNS, and TFTP)</p>
</li>
<li>
<p>Puppet configuration</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defining network resource data in Satellite Server to help configure network interfaces on new hosts.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following instructions have similar applications to configuring standalone Capsule Servers managing a specific network. To configure Satellite to use external DHCP, DNS, and TFTP services, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/installing_satellite_server_from_a_connected_network/configuring_external_services">Configuring External Services</a> in <em>Installing Satellite Server from a Connected Network</em>.</p>
</div>
<div class="paragraph">
<div class="title">DHCP Ranges</div>
<p>You can define the same DHCP range in Satellite Server for both Discovered and Provisioned systems, but use a separate range for each service within the same subnet.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites_for_image_based_provisioning">4.1. Prerequisites for Image Based Provisioning</h3>
<div class="paragraph">
<div class="title">Post-Boot Configuration Method</div>
<p>Images that use the <code>finish</code> post-boot configuration scripts require a managed DHCP server, such as Satellite&#8217;s integrated Capsule or an external Capsule. The host must be created with a subnet associated with a DHCP Capsule, and the IP address of the host must be a valid IP address from the DHCP range.</p>
</div>
<div class="paragraph">
<p>It is possible to use an external DHCP service, but IP addresses must be entered manually. The SSH credentials corresponding to the configuration in the image must be configured in Satellite to enable the post-boot configuration to be made.</p>
</div>
<div class="paragraph">
<p>Check following items when troubleshooting a virtual machine booted from an image that depends on post-configuration scripts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The host has a subnet assigned in Satellite Server.</p>
</li>
<li>
<p>The subnet has a DHCP Capsule assigned in Satellite Server.</p>
</li>
<li>
<p>The host has a valid IP address assigned in Satellite Server.</p>
</li>
<li>
<p>The IP address acquired by the virtual machine using DHCP matches the address configured in Satellite Server.</p>
</li>
<li>
<p>The virtual machine created from an image responds to SSH requests.</p>
</li>
<li>
<p>The virtual machine created from an image authorizes the user and password, over SSH, which is associated with the image being deployed.</p>
</li>
<li>
<p>Satellite Server has access to the virtual machine via SSH keys. This is required for the virtual machine to receive post-configuration scripts from Satellite Server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Pre-Boot Initialization Configuration Method</div>
<p>Images that use the <code>cloud-init</code> scripts require a DHCP server to avoid having to include the IP address in the image. A managed DHCP Capsule is preferred. The image must have the <code>cloud-init</code> service configured to start when the system boots and fetch a script or configuration data to use in completing the configuration.</p>
</div>
<div class="paragraph">
<p>Check the following items when troubleshooting a virtual machine booted from an image that depends on initialization scripts included in the image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a DHCP server on the subnet.</p>
</li>
<li>
<p>The virtual machine has the <code>cloud-init</code> service installed and enabled.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about the differing levels of support for <code>finish</code> and <code>cloud-init</code> scripts in virtual-machine images, see the Red Hat Knowledgebase Solution <a href="https://access.redhat.com/solutions/2987171">What are the supported compute resources for the finish and cloud-init scripts</a> on the Red Hat Customer Portal.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Networking-Configuring_Network_Services_for_PXE_Boot">4.2. Configuring Network Services</h3>
<div class="paragraph">
<p>Some provisioning methods use Capsule Server services. For example, a network might require the Capsule Server to act as a DHCP server. A network can also use PXE boot services to install the operating system on new hosts. This requires configuring the Capsule Server to use the main PXE boot services: DHCP, DNS, and TFTP.</p>
</div>
<div class="paragraph">
<p>Use the <code>satellite-installer</code> script with the options to configure these services on the Satellite Server.</p>
</div>
<div class="paragraph">
<p>To configure these services on an external Capsule Server, run <code>satellite-installer --scenario capsule</code>.</p>
</div>
<div class="paragraph">
<p>Satellite Server uses <code>eth0</code> for external communication, such as connecting to Red Hat&#8217;s CDN.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure network services on Satellite&#8217;s integrated Capsule, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the <code>satellite-installer</code> command to configure the required network services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --foreman-proxy-dhcp true \
--foreman-proxy-dhcp-managed true \
--foreman-proxy-dhcp-gateway "<em>192.168.140.1</em>" \
--foreman-proxy-dhcp-interface "eth1" \
--foreman-proxy-dhcp-nameservers "<em>192.168.140.2</em>" \
--foreman-proxy-dhcp-range "<em>192.168.140.10</em> <em>192.168.140.110</em>" \
--foreman-proxy-dhcp-server "<em>192.168.140.2</em>" \
--foreman-proxy-dns true \
--foreman-proxy-dns-managed true \
--foreman-proxy-dns-forwarders "<em>8.8.8.8</em>; <em>4.4.4.4</em>" \
--foreman-proxy-dns-interface "eth1" \
--foreman-proxy-dns-reverse "<em>140.168.192.in-addr.arpa</em>" \
--foreman-proxy-dns-server "<em>192.168.140.2</em>" \
--foreman-proxy-dns-zone "<em>example.com</em>" \
--foreman-proxy-tftp true \
--foreman-proxy-tftp-managed true</pre>
</div>
</div>
</li>
<li>
<p>Find the Capsule Server that you configure:</p>
<div class="listingblock">
<div class="content">
<pre># hammer proxy list</pre>
</div>
</div>
</li>
<li>
<p>Refresh features of the Capsule Server to view the changes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer proxy refresh-features --name "<em>satellite.example.com</em>"</pre>
</div>
</div>
</li>
<li>
<p>Verify the services configured on the Capsule Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer proxy info --name "<em>satellite.example.com</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_dhcp_dns_and_tftp_options_for_network_configuration">4.2.1. DHCP, DNS, and TFTP Options for Network Configuration</h4>
<div class="dlist">
<div class="title">DHCP Options</div>
<dl>
<dt class="hdlist1">--foreman-proxy-dhcp</dt>
<dd>
<p>Enables the DHCP service. You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-managed</dt>
<dd>
<p>Enables Foreman to manage the DHCP service. You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-gateway</dt>
<dd>
<p>The DHCP pool gateway. Set this to the address of the external gateway for hosts on your private network.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-interface</dt>
<dd>
<p>Sets the interface for the DHCP service to listen for requests. Set this to <code>eth1</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-nameservers</dt>
<dd>
<p>Sets the addresses of the nameservers provided to clients through DHCP. Set this to the address for Satellite Server on <code>eth1</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-range</dt>
<dd>
<p>A space-separated DHCP pool range for Discovered and Unmanaged services.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dhcp-server</dt>
<dd>
<p>Sets the address of the DHCP server to manage.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">DNS Options</div>
<dl>
<dt class="hdlist1">--foreman-proxy-dns</dt>
<dd>
<p>Enables DNS service. You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-managed</dt>
<dd>
<p>Enables Foreman to manage the DNS service. You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-forwarders</dt>
<dd>
<p>Sets the DNS forwarders. Set this to your DNS servers.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-interface</dt>
<dd>
<p>Sets the interface to listen for DNS requests. Set this to <code>eth1</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-reverse</dt>
<dd>
<p>The DNS reverse zone name.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-server</dt>
<dd>
<p>Sets the address of the DNS server to manage.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-zone</dt>
<dd>
<p>Sets the DNS zone name.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">TFTP Options</div>
<dl>
<dt class="hdlist1">--foreman-proxy-tftp</dt>
<dd>
<p>Enables TFTP service. You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-tftp-managed</dt>
<dd>
<p>Enables Foreman to manage the TFTP service. You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-tftp-servername</dt>
<dd>
<p>Sets the TFTP server to use. Ensure that you use Capsule&#8217;s IP address.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Run <code>satellite-installer --scenario capsule --help</code> to view more options related to DHCP, DNS, TFTP, and other Satellite Capsule services</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Networking-Using_TFTP_Services_through_NAT">4.2.2. Using TFTP Services through NAT</h4>
<div class="paragraph">
<p>You can use Satellite TFTP services through NAT. To do this, on all NAT routers or firewalls, you must enable a TFTP service on UDP port 69 and enable the TFTP state tracking feature. For more information, see the documentation for your NAT device.</p>
</div>
<div class="paragraph">
<p>If your NAT routers or firewalls use Red&#160;Hat Enterprise&#160;Linux, perform this procedure on all devices.</p>
</div>
<div class="paragraph">
<div class="title">On Red Hat Enterprise Linux 7:</div>
<p>Use the following command to allow TFTP service on UDP port 69, load the kernel TFTP state tracking module, and make the changes persistent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --add-service=tftp &amp;&amp; firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
<div class="olist arabic">
<div class="title">On Red Hat Enterprise Linux 6:</div>
<ol class="arabic">
<li>
<p>Configure the firewall to allow TFTP service UDP on port 69.</p>
<div class="listingblock">
<div class="content">
<pre># iptables -A OUTPUT -i eth0 -p udp --sport 69 -m state \
--state ESTABLISHED -j ACCEPT
# service iptables save</pre>
</div>
</div>
</li>
<li>
<p>Load the <code>ip_conntrack_tftp</code> kernel TFTP state module. In the <code>/etc/sysconfig/iptables-config</code> file, locate <code>IPTABLES_MODULES</code> and add <code>ip_conntrack_tftp</code> as follows:</p>
<div class="listingblock">
<div class="content">
<pre>IPTABLES_MODULES="ip_conntrack_tftp"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Networking-Adding_a_Domain_to_the_Satellite_Server">4.3. Adding a Domain to Satellite Server</h3>
<div class="paragraph">
<p>Satellite Server defines domain names for each host on the network. Satellite Server must have information about the domain and the Capsule Server responsible for domain name assignment.</p>
</div>
<div class="paragraph">
<div class="title">Checking for Existing Domains</div>
<p>Satellite Server might already have the relevant domain created as part of Satellite Server installation. Switch the context to <code>Any Organization</code> and <code>Any Location</code> then check the domain list to see if it exists.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add a domain to Satellite, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and click <strong>Create Domain</strong>.</p>
</li>
<li>
<p>In the <strong>DNS Domain</strong> field, enter the full DNS domain name.</p>
</li>
<li>
<p>In the <strong>Fullname</strong> field, enter the plain text name of the domain.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and configure any domain level parameters to apply to hosts attached to this domain. For example, user defined Boolean or string parameters to use in templates.</p>
</li>
<li>
<p>Click <strong>Add Parameter</strong> and fill in the <strong>Name</strong> and <strong>Value</strong> fields.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and add the location where the domain resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and add the organization that the domain belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Use the <code>hammer domain create</code> command to create a domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer domain create --name "<em>domain_name.com</em>" \
--description "<em>My example domain</em>" --dns-id 1 \
--locations "<em>My_Location</em>" --organizations "<em>My_Organization</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>--dns-id</code> option uses <code>1</code>, which is the ID of Satellite Server&#8217;s integrated Capsule.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Networking-Adding_a_Subnet_to_the_Satellite_Server">4.4. Adding a Subnet to Satellite Server</h3>
<div class="paragraph">
<p>You must add information for each of your subnets to Satellite Server because Satellite configures interfaces for new hosts. To configure interfaces, Satellite Server must have all the information about the network that connects these interfaces.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add a subnet to Satellite Server, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>, and in the Subnets window, click <strong>Create Subnet</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the subnet.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the subnet.</p>
</li>
<li>
<p>In the <strong>Network address</strong> field, enter the network address for the subnet.</p>
</li>
<li>
<p>In the <strong>Network prefix</strong> field, enter the network prefix for the subnet.</p>
</li>
<li>
<p>In the <strong>Network mask</strong> field, enter the network mask for the subnet.</p>
</li>
<li>
<p>In the <strong>Gateway address</strong> field, enter the external gateway for the subnet.</p>
</li>
<li>
<p>In the <strong>Primary DNS server</strong> field, enter a primary DNS for the subnet.</p>
</li>
<li>
<p>In the <strong>Secondary DNS server</strong>, enter a secondary DNS for the subnet.</p>
</li>
<li>
<p>From the <strong>IPAM</strong> list, select the method that you want to use for IP address management (IPAM):</p>
<div class="ulist">
<ul>
<li>
<p><strong>DHCP</strong> - The subnet contains a DHCP server.</p>
</li>
<li>
<p><strong>Internal DB</strong> - The subnet does not contain a DHCP server but Satellite can manage the IP address assignment and record IP addresses in its internal database.</p>
</li>
<li>
<p><strong>None</strong> - No IP address management.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter the information for the IPAM method that you select.</p>
</li>
<li>
<p>Click the <strong>Remote Execution</strong> tab and select the capsule that controls the remote execution.</p>
</li>
<li>
<p>Click the <strong>Domains</strong> tab and select the domains that apply to this subnet.</p>
</li>
<li>
<p>Click the <strong>Capsules</strong> tab and select the capsule that applies to each service in the subnet, including DHCP, TFTP, and reverse DNS services.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and configure any subnet level parameters to apply to hosts attached to this subnet. For example, user defined Boolean or string parameters to use in templates.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and select the locations that use this capsule.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and select the organizations that use this capsule.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the subnet information.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the subnet with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer subnet create --name "<em>My_Network</em>" \
--description "<em>your_description</em>" \
--network "192.168.140.0" --mask "255.255.255.0" \
--gateway "192.168.140.1" --dns-primary "192.168.140.2" \
--dns-secondary "8.8.8.8" --ipam "DHCP" \
--from "192.168.140.111" --to "192.168.140.250" --boot-mode "DHCP" \
--domains "<em>example.com</em>" --dhcp-id 1 --dns-id 1 --tftp-id 1 \
--locations "<em>My_Location</em>" --organizations "<em>My_Organization</em>"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In this example, the <code>--dhcp-id</code>, <code>--dns-id</code>, and <code>--tftp-id</code> options use 1, which is the ID of the integrated Capsule in Satellite Server.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Networking-Configuring_gPXE_to_Reduce_Provisioning_Times">4.5. Configuring iPXE to Reduce Provisioning Times</h3>
<div class="paragraph">
<p>In Red Hat Satellite 6.4, you can configure PXELinux to chainboot iPXE and boot using the HTTP protocol, which is faster and more reliable on high latency networks than TFTP.</p>
</div>
<div class="paragraph">
<p>There are three methods of using iPXE with Red Hat Satellite 6.4:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Chainbooting virtual machines using hypervisors that use iPXE as primary firmware</p>
</li>
<li>
<p>Using PXELinux through TFTP to chainload iPXE directly on bare metal hosts</p>
</li>
<li>
<p>Using PXELinux through UNDI, which uses HTTP to transfer the kernel and the initial RAM disk on bare metal hosts</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before you begin, ensure that the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A host exists on Red Hat Satellite to use</p>
</li>
<li>
<p>The MAC address of the provisioning interface matches the host configuration</p>
</li>
<li>
<p>The provisioning interface of the host has a valid DHCP reservation</p>
</li>
<li>
<p>The NIC is capable of PXE booting. For more information, see <a href="http://ipxe.org/appnote/hardware_drivers" class="bare">http://ipxe.org/appnote/hardware_drivers</a></p>
</li>
<li>
<p>The NIC is compatible with iPXE</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_chainbooting_virtual_machines">4.5.1. Chainbooting virtual machines</h4>
<div class="paragraph">
<p>Most virtualization hypervisors use iPXE as primary firmware for PXE booting. Because of this, you can chainboot without TFTP and PXELinux.</p>
</div>
<div class="paragraph">
<div class="title">Chainbooting virtual machine workflow</div>
<p>Using virtualization hypervisors removes the need for TFTP and PXELinux. It has the following workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Virtual machine starts</p>
</li>
<li>
<p>iPXE retrieves the network credentials using DHCP</p>
</li>
<li>
<p>iPXE retrieves the HTTP address using DHCP</p>
</li>
<li>
<p>iPXE chainloads the iPXE template from the template Capsule</p>
</li>
<li>
<p>iPXE loads the kernel and initial RAM disk of the installer</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ensure that the hypervisor that you want to use supports iPXE. The following virtualization hypervisors support iPXE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>libvirt</p>
</li>
<li>
<p>oVirt</p>
</li>
<li>
<p>RHEV</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Configuring Red Hat Satellite Server to use iPXE</div>
<p>You can use the default template to configure iPXE booting for hosts.
If you want to change the default values in the template, clone the template and edit the clone.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure Satellite to use iPXE, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong>, enter <code>Kickstart default iPXE</code> and click <strong>Search</strong>.</p>
</li>
<li>
<p>Optional: If you want to change the template, click <strong>Clone</strong>, enter a unique name, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the template you want to use.</p>
</li>
<li>
<p>If you clone the template, you can make changes you require on the <strong>Template</strong> tab.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab, and select the operating systems that your host uses.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and add the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and add the organization that the host belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and select the operating system of your host.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>From the <strong>iPXE Template</strong> list, select the template you want to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</li>
<li>
<p>In the <strong>Hosts</strong> page, select the host that you want to use.</p>
</li>
<li>
<p>Select the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>From the <strong>iPXE template</strong> list, select <strong>Review</strong> and verify that the <strong>Kickstart default iPXE</strong> template is the correct template.</p>
</li>
<li>
<p>To prevent an endless loop of chainbooting iPXE firmware, edit the <code>/etc/dhcp/dhcpd.conf</code> file to match the following example. If you use an isolated network, use a Capsule Server URL with TCP port 8000, instead of Satellite Server&#8217;s URL.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Locate the following lines in the Bootfile Handoff section of the <code>/etc/dhcp/dhcpd.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre>} else {
  filename "pxelinux.0";
}</pre>
</div>
</div>
</li>
<li>
<p>Add the following extra <code>elsif</code> statement before the else statement:</p>
<div class="listingblock">
<div class="content">
<pre>elsif exists user-class and option user-class = "iPXE" {
  filename "http://satellite.example.com/unattended/iPXE";
}</pre>
</div>
</div>
</li>
<li>
<p>Verify that the 'if' section matches the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">if option architecture = 00:06 {
  filename "grub2/shim.efi";
} elsif option architecture = 00:07 {
  filename "grub2/shim.efi";
} elsif option architecture = 00:09 {
  filename "grub2/shim.efi";
} elsif exists user-class and option user-class = "iPXE" {
  filename "http://<em>satellite.example.com</em>/unattended/iPXE";
} else {
  filename "pxelinux.0";
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For <code><a href="http://satellite.example.com/unattended/iPXE" class="bare">http://satellite.example.com/unattended/iPXE</a></code>, you can also use a Red Hat Satellite Capsule <code><a href="http://capsule.example.com:8000/unattended/iPXE" class="bare">http://capsule.example.com:8000/unattended/iPXE</a></code>.
You must update the <code>/etc/dhcp/dhcpd.conf</code> file after every upgrade.
The content of the <code>/etc/dhcp/dhcpd.conf</code> file is case sensitive.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_chainbooting_ipxe_directly">4.5.2. Chainbooting iPXE directly</h4>
<div class="paragraph">
<p>Use this procedure to set up iPXE to use a built-in driver for network communication or UNDI interface. There are separate procedures to configure Satellite Server and Capsule to use iPXE.</p>
</div>
<div class="paragraph">
<p>You can use this procedure only with bare metal hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Chainbooting iPXE directly or with UNDI workflow</div>
<ol class="arabic">
<li>
<p>Host powers on</p>
</li>
<li>
<p>PXE driver retrieves the network credentials using DHCP</p>
</li>
<li>
<p>PXE driver retrieves the PXELinux firmware <code>pxelinux.0</code> using TFTP</p>
</li>
<li>
<p>PXELinux searches for the configuration file on the TFTP server</p>
</li>
<li>
<p>PXELinux chainloads iPXE <code>ipxe.lkrn</code> or <code>undionly-ipxe.0</code></p>
</li>
<li>
<p>iPXE retrieves the network credentials using DHCP again</p>
</li>
<li>
<p>iPXE retrieves HTTP address using DHCP</p>
</li>
<li>
<p>iPXE chainloads the iPXE template from the template Capsule</p>
</li>
<li>
<p>iPXE loads the kernel and initial RAM disk of the installer</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Configuring Red Hat Satellite Server to use iPXE</div>
<p>You can use the default template to configure iPXE booting for hosts.
If you want to change the default values in the template, clone the template and edit the clone.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure Satellite to use iPXE with the UNDI workflow, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong>, enter <code>PXELinux chain iPXE</code> or, for UNDI, enter <code>PXELinux chain iPXE UNDI</code>, and click <strong>Search</strong>.</p>
</li>
<li>
<p>Optional: If you want to change the template, click <strong>Clone</strong>, enter a unique name, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the template you want to use.</p>
</li>
<li>
<p>If you clone the template, you can make changes you require on the <strong>Template</strong> tab.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab, and select the operating systems that your host uses.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and add the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and add the organization that the host belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>In the <strong>Provisioning Templates</strong> page, enter <code>Kickstart default iPXE</code> into the search field and click <strong>Search</strong>.</p>
</li>
<li>
<p>Optional: If you want to change the template, click <strong>Clone</strong>, enter a unique name, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the template you want to use.</p>
</li>
<li>
<p>If you clone the template, you can make changes you require on the <strong>Template</strong> tab.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab, and associate the template with the operating system that your host uses.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and add the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and add the organization that the host belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and select the operating system of your host.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>From the <strong>PXELinux template</strong> list, select the template you want to use.</p>
</li>
<li>
<p>From the <strong>iPXE template</strong> list, select the template you want to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>, and select the host you want to use.</p>
</li>
<li>
<p>Select the <strong>Templates</strong> tab, and from the <strong>PXELinux template</strong> list, select <strong>Review</strong> and verify the template is the correct template.</p>
</li>
<li>
<p>From the <strong>iPXE template</strong> list, select <strong>Review</strong> and verify the template is the correct template. If there is no PXELinux entry, or you cannot find the new template, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>, and on your host, click <strong>Edit</strong>. Click the <strong>Operating system</strong> tab and click the Provisioning Template <strong>Resolve</strong> button to refresh the list of templates.</p>
</li>
<li>
<p>To prevent an endless loop of chainbooting iPXE firmware, edit the <code>/etc/dhcp/dhcpd.conf</code> file to match the following example. If you use an isolated network, use a Capsule Server URL with TCP port 8000, instead of Satellite Server&#8217;s URL.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Locate the following lines in the Bootfile Handoff section of the <code>/etc/dhcp/dhcpd.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre>} else {
  filename "pxelinux.0";
}</pre>
</div>
</div>
</li>
<li>
<p>Add the following extra <code>elsif</code> statement before the else statement:</p>
<div class="listingblock">
<div class="content">
<pre>elsif exists user-class and option user-class = "iPXE" {
  filename "http://satellite.example.com/unattended/iPXE";
}</pre>
</div>
</div>
</li>
<li>
<p>Verify that the 'if' section matches the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">if option architecture = 00:06 {
  filename "grub2/shim.efi";
} elsif option architecture = 00:07 {
  filename "grub2/shim.efi";
} elsif option architecture = 00:09 {
  filename "grub2/shim.efi";
} elsif exists user-class and option user-class = "iPXE" {
  filename "http://<em>satellite.example.com</em>/unattended/iPXE";
} else {
  filename "pxelinux.0";
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For <code><a href="http://satellite.example.com/unattended/iPXE" class="bare">http://satellite.example.com/unattended/iPXE</a></code>, you can also use a Red Hat Satellite Capsule <code><a href="http://capsule.example.comf:8000/unattended/iPXE" class="bare">http://capsule.example.comf:8000/unattended/iPXE</a></code>.
You must update the <code>/etc/dhcp/dhcpd.conf</code> file after every upgrade.
The content of the <code>/etc/dhcp/dhcpd.conf</code> file is case sensitive.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Configuring Red Hat Satellite Capsule to use iPXE</div>
<p>You can use this procedure to configure Capsules to use iPXE.</p>
</div>
<div class="paragraph">
<p>You must perform this procedure on all Capsules.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure the Capsule to chainboot iPXE, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>ipxe-bootimgs</code> RPM package:</p>
<div class="listingblock">
<div class="content">
<pre># yum install ipxe-bootimgs</pre>
</div>
</div>
</li>
<li>
<p>Copy the iPXE firmware to the TFTP server&#8217;s root directory. Do not use symbolic links because TFTP runs in the <code>chroot</code> environment.</p>
<div class="ulist">
<ul>
<li>
<p>For chainbooting directly, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre># cp /usr/share/ipxe/ipxe.lkrn /var/lib/tftpboot/</pre>
</div>
</div>
</li>
<li>
<p>For UNDI, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre># cp /usr/share/ipxe/undionly.kpxe /var/lib/tftpboot/undionly-ipxe.0</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Correct the file contexts:</p>
<div class="listingblock">
<div class="content">
<pre># restorecon -RvF /var/lib/tftpboot/</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Infoblox-Integration">5. Using Infoblox as DHCP and DNS Providers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use Capsule Server to connect to your Infoblox application to create and manage DHCP and DNS records, and to reserve IP addresses.</p>
</div>
<div class="paragraph">
<p>The supported Infoblox version is NIOS 8.0 or higher and Satellite 6.5 or higher.</p>
</div>
<div class="sect2">
<h3 id="_limitations">5.1. Limitations</h3>
<div class="paragraph">
<p>All DHCP and DNS records can be managed only in a single Network or DNS view, After you install the Infoblox modules on Capsule and set up the view using the <code>satellite-installer</code> command, you cannot edit the view.</p>
</div>
<div class="paragraph">
<p>Capsule Server communicates with a single Infoblox node using the standard HTTPS web API. If you want to configure clustering and High Availability, make the configurations in Infoblox.</p>
</div>
<div class="paragraph">
<p>Hosting PXE-related files using Infoblox&#8217;s TFTP functionality is not supported. You must use Capsule as a TFTP server for PXE provisioning. For more information, see <a href="#Configuring_Networking">Configuring Networking</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites">5.2. Prerequisites</h3>
<div class="paragraph">
<p>You must have Infoblox account credentials to manage DHCP and DNS entries in Satellite.</p>
</div>
<div class="paragraph">
<p>Ensure that you have Infoblox administration roles with the names: <code>DHCP Admin</code> and <code>DNS Admin</code>.</p>
</div>
<div class="paragraph">
<p>The administration roles must have permissions or belong to an admin group that permits the accounts to perform tasks through the Infoblox API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_infoblox_ca_certificate_on_capsule_server">5.3. Installing the Infoblox CA Certificate on Capsule Server</h3>
<div class="paragraph">
<p>You must install Infoblox HTTPS CA certificate on the base system for all Capsules that you want to integrate with Infoblox applications.</p>
</div>
<div class="paragraph">
<p>You can download the certificate from the Infoblox web UI, or you can use the following OpenSSL commands to download the certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># update-ca-trust enable
# openssl s_client -showcerts -connect Infoblox_hostname:443 &lt;/dev/null | \
openssl x509 -text &gt;/etc/pki/ca-trust/source/anchors/infoblox.crt
# update-ca-trust extract</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>Infoblox_hostname</code> entry must match the host name for the Infoblox application in the X509 certificate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To test the CA certificate, use a CURL query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -u admin:infoblox https://<em>Infoblox_hostname</em>/wapi/v2.0/network</pre>
</div>
</div>
<div class="paragraph">
<p>Example positive response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[
    {
        "_ref": "network/ZG5zLm5ldHdvcmskMTkyLjE2OC4yMDIuMC8yNC8w:<em>Infoblox_hostname</em>/24/default",
        "network": "192.168.202.0/24",
        "network_view": "default"
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Use the following Red&#160;Hat Knowledgebase article to install the certificate: <a href="https://access.redhat.com/solutions/1519813">How to install a CA certificate on Red Hat Enterprise Linux 6 / 7</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Infoblox-Integration-Installing_the_DHCP_Infoblox_Module">5.4. Installing the DHCP Infoblox module</h3>
<div class="paragraph">
<p>Use this procedure to install the DHCP Infoblox module on Capsule. Note that you cannot manage records in separate views.</p>
</div>
<div class="paragraph">
<p>You can also install DHCP and DNS Infoblox modules simultaneously by combining this procedure and <a href="#Infoblox-Integration-Installing_the_DNS_Infoblox_Module">Installing the DNS Infoblox Module</a></p>
</div>
<div class="paragraph">
<div class="title">DHCP Infoblox Record Type Considerations</div>
<p>Use only the <code>--foreman-proxy-plugin-dhcp-infoblox-record-type host</code> option to configure the DHCP and DNS modules.</p>
</div>
<div class="paragraph">
<p>Configuring both DHCP and DNS Infoblox modules with the <code>fixedaddress</code> record type setting causes DNS conflicts and is not supported. If you install the Infoblox module on Capsule Server with the <code>--foreman-proxy-plugin-dhcp-infoblox-record-type</code> option set to <code>fixedaddress</code>, you must unset both DNS Capsule and Reverse DNS Capsule options because Infoblox does the DNS management itself. You cannot use the <code>fixedaddress</code> option without creating conflicts and, for example, being unable to rename hosts in Satellite.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To install the Infoblox module for DHCP, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On Capsule, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --enable-foreman-proxy-plugin-dhcp-infoblox \
--foreman-proxy-dhcp true \
--foreman-proxy-dhcp-managed false \
--foreman-proxy-dhcp-provider infoblox \
--foreman-proxy-plugin-dhcp-infoblox-record-type host \
--foreman-proxy-dhcp-server <em>Infoblox_hostname</em> \
--foreman-proxy-plugin-dhcp-infoblox-username admin \
--foreman-proxy-plugin-dhcp-infoblox-password infoblox \
--foreman-proxy-plugin-dhcp-infoblox-network-view default \
--foreman-proxy-plugin-dhcp-infoblox-dns-view default</pre>
</div>
</div>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong> and select the Capsule with the Infoblox DHCP module and click <strong>Refresh</strong>.</p>
</li>
<li>
<p>Ensure that the <strong>dhcp</strong> features are listed.</p>
</li>
<li>
<p>For all domains managed through Infoblox, ensure that the DNS Capsule is set for that domain. To verify, in the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong>, and inspect the settings of each domain.</p>
</li>
<li>
<p>For all subnets managed through Infoblox, ensure that DHCP Capsule and Reverse DNS Capsule is set. To verify, in the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>, and inspect the settings of each subnet.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Infoblox-Integration-Installing_the_DNS_Infoblox_Module">5.5. Installing the DNS Infoblox Module</h3>
<div class="paragraph">
<p>Use this procedure to install the DNS Infoblox module on Capsule. You can also install DHCP and DNS Infoblox modules simultaneously by combining this procedure and <a href="#Infoblox-Integration-Installing_the_DHCP_Infoblox_Module">Installing the DHCP Infoblox module</a>.</p>
</div>
<div class="paragraph">
<p>DNS records are managed only in the default DNS view, it&#8217;s not possible to specify which DNS view to use.</p>
</div>
<div class="paragraph">
<p>To install the DNS Infoblox module, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On Capsule, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># satellite-installer --enable-foreman-proxy-plugin-dns-infoblox \
--foreman-proxy-dns true \
--foreman-proxy-dns-managed false \
--foreman-proxy-dns-provider infoblox \
--foreman-proxy-plugin-dns-infoblox-dns-server <em>Infoblox_hostname</em> \
--foreman-proxy-plugin-dns-infoblox-username admin \
--foreman-proxy-plugin-dns-infoblox-password infoblox</pre>
</div>
</div>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong> and select the Capsule with the Infoblox DNS module and click <strong>Refresh</strong>.</p>
</li>
<li>
<p>Ensure that the <strong>dns</strong> features are listed.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Bare_Metal_Hosts">6. Provisioning Bare Metal Hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are four main ways to provision bare metal instances with Red Hat Satellite 6.4:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Unattended Provisioning</dt>
<dd>
<p>New hosts are identified by a MAC address and Satellite Server provisions the host using a PXE boot process.</p>
</dd>
<dt class="hdlist1">Unattended Provisioning with Discovery</dt>
<dd>
<p>New hosts use PXE boot to load the Satellite Discovery service. This service identifies hardware information about the host and lists it as an available host to provision.</p>
</dd>
<dt class="hdlist1">PXE-less Provisioning</dt>
<dd>
<p>New hosts are provisioned with a boot disk or PXE-less discovery image that Satellite Server generates.</p>
</dd>
<dt class="hdlist1">PXE-less Provisioning with Discovery</dt>
<dd>
<p>New hosts use an ISO boot disk that loads the Satellite Discovery service. This service identifies hardware information about the host and lists it as an available host to provision.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">BIOS and UEFI Support</div>
<p>With Red&#160;Hat Satellite, you can perform both BIOS and UEFI based PXELinux provisioning.</p>
</div>
<div class="paragraph">
<p>Both BIOS and UEFI interfaces work as interpreters between the computer&#8217;s operating system and firmware, initializing the hardware components and starting the operating system at boot time.</p>
</div>
<div class="paragraph">
<p>While BIOS reads the first section of the hard drive that contains the next address to initialize, UEFI stores all the information about initialization and startup in an <code>.efi</code> file instead of the firmware. UEFI systems are newer and becoming more common.</p>
</div>
<div class="paragraph">
<p>To perform PXELinux provisioning with UEFI you must use a Red&#160;Hat Enterprise Linux Server 7 or higher that has Intel x86_64. In Satellite, PXELinux provisioning with UEFI is supported only on bare-metal systems. Because of a GRUB-related limitation, you cannot use UEFI to provision with a full host image. UEFI is not supported for virtual machines. UEFI SecureBoot is also not supported.</p>
</div>
<div class="paragraph">
<p>In Satellite provisioning, the PXE loader which is a DHCP file name that defines which file to load through TFTP during PXE provisioning. For BIOS system, the file is <code>pxelinux.0</code>. For UEFI systems, the file is <code>grub2/grubx64.efi</code>.</p>
</div>
<div class="paragraph">
<p>For BIOS provisioning, you must associate a PXELinux template with the operating system.</p>
</div>
<div class="paragraph">
<p>For UEFI provisioning you must associate a PXEGrub2 template with the operating system.</p>
</div>
<div class="paragraph">
<p>If you associate both PXELinux and PXEGrub2 templates, Satellite 6 can deploy configuration files for both on a TFTP server, so that you can switch between PXE loaders easily.</p>
</div>
<div class="sect2">
<h3 id="Provisioning_Bare_Metal_Hosts-Prerequisites_for_Bare_Metal_Provisioning">6.1. Prerequisites for Bare Metal Provisioning</h3>
<div class="paragraph">
<p>The requirements for bare metal provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronized content repositories for the version of Red Hat Enterprise Linux that you want to use. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/importing_red_hat_content#Importing_Red_Hat_Content-Synchronizing_Red_Hat_Repositories">Synchronizing Red Hat Repositories</a> in the <em>Content Management Guide</em>.</p>
</li>
<li>
<p>A Capsule Server managing the network for bare metal hosts. For unattended provisioning and discovery-based provisioning, Satellite Server requires PXE server settings. For more information, see <a href="#Configuring_Networking">Configuring Networking</a>.</p>
</li>
<li>
<p>An activation key for host registration. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_activation_keys#Managing_Activation_Keys-Creating_an_Activation_Key">Creating An Activation Key</a> in the <em>Content Management</em> guide.</p>
</li>
<li>
<p>A blank bare metal host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about the security token for unattended and PXE-less provisioning, see <a href="#Provisioning_Bare_Metal_Hosts-Security_Token_in_the_Boot_Process">Configuring the Security Token Validity Duration</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Bare_Metal_Hosts-Security_Token_in_the_Boot_Process">6.2. Configuring the Security Token Validity Duration</h3>
<div class="paragraph">
<p>When performing unattended and PXE-less provisioning, as a security measure, Satellite automatically generates a unique token and adds this token to the URL of the ISO image that downloads during the Kickstart provisioning process.</p>
</div>
<div class="paragraph">
<p>By default, the token is valid for 360 minutes. When you provision a host, ensure that you reboot the host within this time frame. If the token expires, it is deleted and you might receive a 404 error.</p>
</div>
<div class="paragraph">
<p>To adjust the token&#8217;s duration of validity, in the Satellite web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Provisioning</strong> tab. Find the <strong>Token duration</strong> option, and click the edit icon and edit the duration, or enter <code>0</code> to disable token generation.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Bare_Metal_Hosts-Creating_New_Hosts_with_Unattended_Provisioning">6.3. Creating Hosts with Unattended Provisioning</h3>
<div class="paragraph">
<p>Unattended provisioning is the simplest form of host provisioning. You enter the host details on Satellite Server and boot your host. Satellite Server automatically manages the PXE configuration, organizes networking services, and provides the operating system and configuration for the host.</p>
</div>
<div class="paragraph">
<p>This method of provisioning hosts uses minimal interaction during the process.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a host with unattended provisioning, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Click the <strong>Organization</strong> and <strong>Location</strong> tabs and change the context to match your requirements.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to use to populate the form.</p>
</li>
<li>
<p>Click the <strong>Interface</strong> tab, and on the host&#8217;s interface, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values. Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Satellite Server automatically assigns an IP address for the new host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>MAC address</strong> field, enter a MAC address for the host. This ensures the identification of the host during the PXE boot process.</p>
</li>
<li>
<p>Ensure that Satellite Server automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host. If not, select them.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and verify that all fields contain values. Confirm each aspect of the operating system.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning template</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Optional: If you want to use VLAN tagging, you must add the VLAN ID to the PXELinux or PXEGrub2 template. To the <code>APPEND</code> line, add <code>vlanid=example_vlanid</code>.</p>
<div class="paragraph">
<p>For more information about associating provisioning templates, see <a href="#Configuring_Provisioning_Resources-Creating_Provisioning_Templates">Creating Provisioning Templates</a>.</p>
</div>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab, and ensure that a parameter exists that provides an activation key. If not, add an activation key.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This creates the host entry and the relevant provisioning settings. This also includes creating the necessary directories and files for PXE booting the bare metal host. If you start the physical host and set its boot mode to PXE, the host detects the DHCP service of Satellite Server&#8217;s integrated Capsule and starts installing the operating system from its Kickstart tree. When the installation completes, the host also registers to Satellite Server using the activation key and installs the necessary configuration and management tools from the Red Hat Satellite Tools repository.</p>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the host with the <code>hammer host create</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create --name "<em>My_Unattended_Host</em>" --organization "<em>My_Organization</em>" \
--location "<em>My_Location</em>" --hostgroup "<em>My_Host_Group</em>" --mac "<em>aa:aa:aa:aa:aa:aa</em>" \
--build true --enabled true --managed true</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure the network interface options are set using the <code>hammer host interface update</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer host interface update --host "test1" --managed true \
--primary true --provision true</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Bare_Metal_Hosts-Configuring_Red_Hat_Satellites_Discovery_Service">6.4. Configuring Red Hat Satellite&#8217;s Discovery Service</h3>
<div class="paragraph">
<p>Red Hat Satellite provides a method to automatically detect hosts on a network that are not in your Satellite inventory. These hosts boot the discovery image that performs hardware detection and relays this information back to Satellite Server. This method creates a list of ready-to-provision hosts in Satellite Server without needing to enter the MAC address of each host.</p>
</div>
<div class="paragraph">
<p>The Discovery service is enabled by default on Satellite Server. However, the default setting of the global templates is to boot from the local hard drive. To use discovery you must change the default entry in the template to discovery.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/PXE-mode.png" alt="PXE mode"/>
</div>
</div>
<div class="paragraph">
<p>To use Satellite Server to provide the Discovery image, install the <code>foreman-discovery-image</code> and <code>rubygem-smart_proxy_discovery</code> packages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># yum install foreman-discovery-image rubygem-smart_proxy_discovery</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>foreman-discovery-image</code> package installs the Discovery ISO to the <code>/usr/share/foreman-discovery-image/</code> directory and also creates a PXE boot image from this ISO using the <code>livecd-iso-to-pxeboot</code> tool. The tool saves this PXE boot image in the <code>/var/lib/tftpboot/boot</code> directory.
The <code>rubygem-smart_proxy_discovery</code> package configures a Capsule Server, such as Satellite Server&#8217;s integrated Capsule, to act as a proxy for the Discovery service.</p>
</div>
<div class="paragraph">
<p>When the installation completes, you can view the new menu option by navigating to <strong>Hosts</strong> &gt; <strong>Discovered Hosts</strong>.</p>
</div>
<div class="sect3">
<h4 id="_enabling_discovery_service_on_a_capsule_server">6.4.1. Enabling Discovery service on a Capsule Server</h4>
<div class="paragraph">
<p>Complete the following procedure to enable the Discovery service on a Capsule Server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following commands on the Capsule Server:</p>
<div class="listingblock">
<div class="content">
<pre># yum install foreman-discovery-image rubygem-smart_proxy_discovery</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre># foreman-maintain service restart</pre>
</div>
</div>
</li>
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsule</strong>.</p>
</li>
<li>
<p>Click the Capsule Server and select <strong>Refresh</strong> from the <strong>Actions</strong> list. Locate <strong>Discovery</strong> in the list of features to confirm the Discovery service is now running.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Subnets</div>
<p>All subnets with discoverable hosts require an appropriate Capsule Server selected to provide the Discovery service.</p>
</div>
<div class="paragraph">
<p>To check this, navigate to <strong>Infrastructure</strong> &gt; <strong>Capsules</strong> and verify if the Capsule Server that you want to use lists the Discovery feature. If not, click <strong>Refresh features</strong>.</p>
</div>
<div class="paragraph">
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>, select a subnet, click the Capsules tab, and select the <strong>Discovery Proxy</strong> that you want to use. Perform this for each appropriate subnet.</p>
</div>
</div>
<div class="sect3">
<h4 id="_provisioning_template_pxelinux_discovery_snippet">6.4.2. Provisioning Template PXELinux Discovery Snippet</h4>
<div class="paragraph">
<p>For BIOS provisioning, the <code>PXELinux global default</code> template in the <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong> window contains the snippet <code>pxelinux_discovery</code>. The snippet has the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">LABEL discovery
  MENU LABEL Foreman Discovery Image
  KERNEL boot/fdi-image/vmlinuz0
  APPEND initrd=boot/fdi-image/initrd0.img rootflags=loop root=live:/fdi.iso rootfstype=auto ro rd.live.image acpi=force rd.luks=0 rd.md=0 rd.dm=0 rd.lvm=0 rd.bootif=0 rd.neednet=0 nomodeset proxy.url=&lt;%= foreman_server_url %&gt; proxy.type=foreman
  IPAPPEND 2</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>KERNEL</code> and <code>APPEND</code> options boot the Discovery image and ramdisk. The <code>APPEND</code> option contains a <code>proxy.url</code> parameter, with the <code>foreman_server_url</code> macro as its argument. This macro resolves to the full URL of Satellite Server.</p>
</div>
<div class="paragraph">
<p>For UEFI provisioning, the <code>PXEgrub2 global default</code> template in the <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong> window contains the snippet <code>pxegrub2_discovery</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">menuentry 'Foreman Discovery Image' --id discovery {
  linuxefi boot/fdi-image/vmlinuz0 rootflags=loop root=live:/fdi.iso rootfstype=auto ro rd.live.image acpi=force rd.luks=0 rd.md=0 rd.dm=0 rd.lvm=0 rd.bootif=0 rd.neednet=0 nomodeset proxy.url=&lt;%= foreman_server_url %&gt; proxy.type=foreman BOOTIF=01-$mac
  initrdefi boot/fdi-image/initrd0.img
}</pre>
</div>
</div>
<div class="paragraph">
<p>To use a Capsule to proxy the discovery steps, edit <code>/var/lib/tftpboot/pxelinux.cfg/default</code> or <code>/var/lib/tftpboot/grub2/grub.cfg</code> and change the URL to the FQDN of the Capsule Server you want to use.</p>
</div>
<div class="paragraph">
<p>The global template is available on Satellite Server and all Capsules that have the TFTP feature enabled.</p>
</div>
</div>
<div class="sect3">
<h4 id="_changing_templates_and_snippets">6.4.3. Changing Templates and Snippets</h4>
<div class="paragraph">
<p>To use a template, in the Satellite web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and click the <strong>Provisioning</strong> tab and set the templates that you want to use.</p>
</div>
<div class="paragraph">
<p>Templates and snippets are locked to prevent changes. If you want to edit a template or snippet, clone it, save it with a unique name, and then edit the clone.</p>
</div>
<div class="paragraph">
<p>When you change the template or a snippet it includes, the changes must be propagated to Satellite Server&#8217;s default PXE template. Navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong> and click <strong>Build PXE Default</strong>. This refreshes the default PXE template on Satellite Server.</p>
</div>
<div class="paragraph">
<div class="title">The proxy.url argument</div>
<p>During the Satellite installation process, if you use the default option <code>--enable-foreman-plugin-discovery</code>, you can edit the <code>proxy.url</code> argument in the template to set the URL of Capsule Server that provides the discovery service. You can change the <code>proxy.url</code> argument to the IP address or FQDN of another provisioning Capsule that you want to use, but ensure that you append the port number, for example, <code>9090</code>.
If you use an alternative port number with the <code>--foreman-proxy-ssl-port</code> option during Satellite installation, you must add that port number. You can also edit the <code>proxy.url</code> argument to use a Satellite IP address or FQDN so that the discovered hosts communicate directly with Satellite Server.</p>
</div>
<div class="paragraph">
<div class="title">The proxy.type argument</div>
<p>If you use a Capsule Server FQDN for the <code>proxy.url</code> argument, ensure that you set the <code>proxy.type</code> argument to <code>proxy</code>. If you use a Satellite FQDN, update the <code>proxy.type</code> argument to <code>foreman</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">proxy.url=https://<em>capsule.example.com</em>:9090 proxy.type=proxy</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Rendering the Capsule&#8217;s Host Name</div>
<p>Satellite 6 deploys the same template to all TFTP Capsules and there is no variable or macro available to render the Capsule&#8217;s host name. The hard-coded <code>proxy.url</code> does not not work with two or more TFTP Capsules. As a workaround, every time you click <strong>Build PXE Defaults</strong>, edit the configuration file in the TFTP directory using SSH.</p>
</div>
<div class="paragraph">
<div class="title">Setting Discovery Service as Default</div>
<p>For both BIOS and UEFI, to set the Discovery service as the default service that boots for hosts that are not present in your current Satellite inventory, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and click the <strong>Provisioning</strong> tab.</p>
</li>
<li>
<p>For the <strong>Default PXE global template entry</strong>, in the <strong>Value</strong> column, enter <code>discovery</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Tagged VLAN Provisioning</div>
<p>If you want to use tagged VLAN provisioning, and you want the discovery service to send a discovery request, add the following information to the <code>KERNEL</code> option in the discovery template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">fdi.vlan.primary=<em>example_VLAN_ID</em></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Testing</div>
<p>Test the Discovery service and boot a blank bare metal host on the 192.168.140.0/24 network. A boot menu has two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>local</code>, which boots from the hard disk</p>
</li>
<li>
<p><code>discovery</code>, which boots to the Discovery service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Select <code>discovery</code> to boot the Discovery image. After a few minutes, the Discovery image completes booting and a status screen is displayed.</p>
</div>
<div class="paragraph">
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Discovered hosts</strong> and view the newly discovered host. The discovered hosts automatically define their host name based on their MAC address. For example, Satellite sets a discovered host with a MAC address of ab:cd:ef:12:34:56 to have <code>macabcdef123456</code> as the host name. You can change this host name when provisioning the host.</p>
</div>
</div>
<div class="sect3">
<h4 id="_automatic_contexts_for_discovered_hosts">6.4.4. Automatic Contexts for Discovered Hosts</h4>
<div class="paragraph">
<p>Satellite Server assigns organization and location to discovered hosts according to the following sequence of rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the <code>Discovery organization</code> or <code>Discovery location</code> values are set. To set these values, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Discovered</strong>.</p>
</li>
<li>
<p>If the <code>foreman_organization</code> or <code>foreman_location</code> facts for a host are set. To configure fact names in <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Puppet</strong> section as the <strong>Default organization</strong> and <strong>Default location</strong> fact setting.</p>
</li>
<li>
<p>If a discovered host uses a subnet defined in Satellite, the host uses the first organization and location associated with the subnet.</p>
</li>
<li>
<p>If none of the previous conditions exists, Satellite assigns the first Organization and Location ordered by name.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can change the organization or location using the bulk actions menu of the <strong>Discovered hosts</strong> page. Select the discovered hosts to modify and select <strong>Assign Organization</strong> or <strong>Assign Location</strong> from the <strong>Select Action</strong> menu.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Bare_Metal_Hosts-Creating_New_Hosts_from_Discovered_Hosts">6.5. Creating Hosts from Discovered Hosts</h3>
<div class="paragraph">
<p>Provisioning discovered hosts follows a provisioning process that is similar to PXE provisioning. The main difference is that instead of manually entering the host&#8217;s MAC address, you can select the host to provision from the list of discovered hosts.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a host from a discovered host, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Discovered host</strong>. Select the host you want to use and click <strong>Provision</strong> to the right of the list.</p>
</li>
<li>
<p>Select from one of the two following options:</p>
<div class="ulist">
<ul>
<li>
<p>To provision a host from a host group, select a host group, organization, and location, and then click <strong>Create Host</strong>.</p>
</li>
<li>
<p>To provision a host with further customization, click <strong>Customize Host</strong> and enter the additional details you want to specify for the new host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Verify that the fields are populated with values. Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Satellite Server automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Satellite Server automatically populates the MAC address from the Discovery results.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ensure that Satellite Server automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host. If not, select them.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and verify that all fields contain values. Confirm each aspect of the operating system.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning template</strong> to check the new host can identify the right provisioning templates to use.</p>
<div class="paragraph">
<p>For more information about associating provisioning templates, see <a href="#Configuring_Provisioning_Resources-Creating_Provisioning_Templates">Creating Provisioning Templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the host provisioning is complete, the discovered host becomes a content host. To view the host, navigate to <strong>Hosts</strong> &gt; <strong>Content Hosts</strong>.</p>
</div>
<div class="olist arabic">
<div class="title">For CLI Users</div>
<ol class="arabic">
<li>
<p>Identify the discovered host to use for provisioning:</p>
<div class="listingblock">
<div class="content">
<pre># hammer discovery list</pre>
</div>
</div>
</li>
<li>
<p>Select a host and provision it using a host group. Set a new host name with the <code>--new-name</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer discovery provision --name "<em>host_name</em>" \
--new-name "<em>new_host_name</em>" --organization "<em>My_Organization</em>" \
--location "<em>My_Location</em>" --hostgroup "<em>My_Host_Group</em>" --build true \
--enabled true --managed true</pre>
</div>
</div>
<div class="paragraph">
<p>This removes the host from the discovered host listing and creates a host entry with the provisioning settings. The Discovery image automatically resets the host so that it can boot to PXE. The host detects the DHCP service on Satellite Server&#8217;s integrated Capsule and starts installing the operating system from its Kickstart tree. When the installation completes, the host also registers to Satellite Server using an activation key and installs the necessary configuration and management tools from the Red Hat Satellite Tools repository.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Bare_Metal_Hosts-Creating_Discovery_Rules">6.6. Creating Discovery Rules</h3>
<div class="paragraph">
<p>As a method of automating the provisioning process for discovered hosts, Red Hat Satellite 6 provides a feature to create discovery rules. These rules define how discovered hosts automatically provision themselves, based on the assigned host group. For example, you can automatically provision hosts with a high CPU count as hypervisors. Likewise, you can provision hosts with large hard disks as storage servers.</p>
</div>
<div class="paragraph">
<div class="title">NIC Considerations</div>
<p>Auto provisioning does not currently allow configuring NICs; all systems are being provisioned with the NIC configuration that was detected during discovery. However, you can set the NIC in an Anaconda kickstart, scriptlet, or using configuration management later on.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a rule, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Configure</strong> &gt; <strong>Discovery rules</strong>. Select <strong>Create Rule</strong> and enter the following details:</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the rule.</p>
</li>
<li>
<p>In the <strong>Search</strong> field, enter the rules to determine whether to provision a host. This field provides suggestions for values you enter and allows operators for multiple rules. For example: <code>cpu_count  &gt; 8</code>.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select the host group to use as a template for this host.</p>
</li>
<li>
<p>In the <strong>Hostname</strong> field, enter the pattern to determine host names for multiple hosts. This uses the same ERB syntax that provisioning templates use. The host name can use the <code>@host</code> attribute for host-specific values and the <code>rand</code> function for a random number.</p>
<div class="ulist">
<ul>
<li>
<p><code>myhost-&lt;%= rand(99999) %&gt;</code></p>
</li>
<li>
<p><code>abc-&lt;%= @host.facts['bios_vendor'] +  '-' + rand(99999).to_s %&gt;</code></p>
</li>
<li>
<p><code>xyz-&lt;%= @host.hostgroup.name %&gt;</code></p>
</li>
<li>
<p><code>srv-&lt;%= @host.discovery_rule.name %&gt;</code></p>
</li>
<li>
<p><code>server-&lt;%= @host.ip.gsub('.','-') +  '-' + @host.hostgroup.subnet.name %&gt;</code></p>
<div class="paragraph">
<p>Because the <code>rand()</code> function returns an integer that cannot be concatenated with a string, use the <code>to_s</code> function to change the integer to a string.
When creating host name patterns, ensure the resulting host names are unique, do not start with numbers, and do not contain underscores or dots. A good approach is to use unique information provided by Facter, such as the MAC address, BIOS, or serial ID.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Hosts limit</strong> field, enter the maximum hosts you can provision with the rule. Enter <code>0</code> for unlimited.</p>
</li>
<li>
<p>In the <strong>Priority</strong> field, enter a number to set the precedence the rule has over other rules. Rules with lower values have a higher priority.</p>
</li>
<li>
<p>From the <strong>Enabled</strong> list, select whether you want to enable the rule.</p>
</li>
<li>
<p>To set a different provisioning context for the rule, click the <strong>Organizations</strong> and <strong>Locations</strong> tabs and select the contexts you want to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your rule.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Discovered Host</strong> and select one of the following two options:</p>
<div class="ulist">
<ul>
<li>
<p>From the <strong>Discovered hosts</strong> list on the right, select <strong>Auto-Provision</strong> to automatically provisions a single host.</p>
</li>
<li>
<p>On the upper right of the window, click <strong>Auto-Provision All</strong> to automatically provisions all hosts.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the rule with the <code>hammer discovery_rule create</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer discovery_rule create --name "Hypervisor" \
--search "cpu_count  &gt; 8" --hostgroup "<em>My_Host_Group</em>" \
--hostname "hypervisor-&lt;%= rand(99999) %&gt;" \
--hosts-limit 5 --priority 5 --enabled true</pre>
</div>
</div>
<div class="paragraph">
<p>Automatically provision a host with the <code>hammer discovery auto-provision</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer discovery auto-provision --name "macabcdef123456"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Bare_Metal_Hosts-Creating_New_Hosts_with_PXE-less_Provisioning">6.7. Creating Hosts with PXE-less Provisioning</h3>
<div class="paragraph">
<p>Some hardware does not provide a PXE boot interface. Red Hat Satellite 6 provides a PXE-less discovery service that operates without PXE-based services, such as DHCP and TFTP. In Satellite, you can provision a host without PXE boot. This is also known as PXE-less provisioning and involves generating a boot ISO that hosts can use. Using this ISO, the host can connect to Satellite Server, boot the installation media, and install the operating system.</p>
</div>
<div class="paragraph">
<div class="title">Boot ISO Types</div>
<p>There are four types of boot ISOs:</p>
</div>
<div class="paragraph">
<p><strong>Host image</strong> - A boot ISO for the specific host. This image contains only the boot files that are necessary to access the installation media on Satellite Server. The user defines the subnet data in Satellite and the image is created with static networking.</p>
</div>
<div class="paragraph">
<p><strong>Full host image</strong> - A boot ISO that contains the kernel and initial RAM disk image for the specific host. This image is useful if the host fails to chainload correctly. The provisioning template still downloads from Satellite Server.</p>
</div>
<div class="paragraph">
<p><strong>Generic image</strong> - A boot ISO that is not associated with a specific host. The ISO sends the host&#8217;s MAC address to Satellite Server, which matches it against the host entry. The image does not store IP address details, and requires access to a DHCP server on the network to bootstrap. This image is also available from the <code>/bootdisk/disks/generic</code> URL on your Satellite Server, for example, <code><a href="https://satellite.example.com/bootdisk/disks/generic" class="bare">https://satellite.example.com/bootdisk/disks/generic</a></code>.</p>
</div>
<div class="paragraph">
<p><strong>Subnet image</strong> - A boot ISO that is similar to the generic image but is configured with the address of a Capsule Server. This image is generic to all hosts with a provisioning NIC on the same subnet.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a host with PXE-less provisioning, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name that you want to become the provisioned system&#8217;s host name.</p>
</li>
<li>
<p>Click the <strong>Organization</strong> and <strong>Location</strong> tabs and change the context to match your requirements.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to use to populate the form.</p>
</li>
<li>
<p>Click the <strong>Interface</strong> tab, and on the host&#8217;s interface, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values. Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Satellite Server automatically assigns an IP address for the new host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>MAC address</strong> field, enter a MAC address for the host.</p>
</li>
<li>
<p>Ensure that Satellite Server automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host. If not, select them.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and verify that all fields contain values. Confirm each aspect of the operating system.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning template</strong> to check the new host can identify the right provisioning templates to use.</p>
<div class="paragraph">
<p>For more information about associating provisioning templates, see <a href="#Configuring_Provisioning_Resources-Creating_Provisioning_Templates">Creating Provisioning Templates</a>.</p>
</div>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab, and ensure that a parameter exists that provides an activation key. If not, add an activation key.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This creates a host entry and the host details page appears.</p>
</div>
<div class="paragraph">
<p>The options on the upper-right of the window are the <strong>Boot disk</strong> menu. From this menu, one of the following images is available for download: <strong>Host image</strong>, <strong>Full host image</strong>, <strong>Generic image</strong>, and <strong>Subnet image</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <strong>Full host image</strong> is based on SYSLINUX and works with most hardware. When using a <strong>Host image</strong>, <strong>Generic image</strong>, or <strong>Subnet image</strong>, see <a href="http://ipxe.org/appnote/hardware_drivers" class="bare">http://ipxe.org/appnote/hardware_drivers</a> for a list of hardware drivers expected to work with an iPXE-based boot disk.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the host with the <code>hammer host create</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create --name "<em>My_Bare_Metal</em>" --organization "<em>My_Organization</em>" \
--location "<em>My_Location</em>" --hostgroup "<em>My_Host_Group</em>" --mac "aa:aa:aa:aa:aa:aa" \
--build true --enabled true --managed true</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that your network interface options are set using the <code>hammer host interface update</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host interface update --host "test3" --managed true \
--primary true --provision true</pre>
</div>
</div>
<div class="paragraph">
<p>Download the boot disk from Satellite Server with the <code>hammer bootdisk host</code> command:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <strong>Host image</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer bootdisk host --host <em>test3.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>For <strong>Full host image</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer bootdisk host --host <em>test3.example.com</em> --full true</pre>
</div>
</div>
</li>
<li>
<p>For <strong>Generic image</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer bootdisk generic</pre>
</div>
</div>
</li>
<li>
<p>For <strong>Subnet image</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer bootdisk subnet --subnet <em>subnetName</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This creates a boot ISO for your host to use.</p>
</div>
<div class="paragraph">
<p>Write the ISO to a USB storage device using the <strong>dd</strong> utility or <strong>livecd-tools</strong> if required.</p>
</div>
<div class="paragraph">
<p>When you start the physical host and boot from the ISO or the USB storage device, the host connects to Satellite Server and starts installing operating system from its kickstart tree.</p>
</div>
<div class="paragraph">
<p>When the installation completes, the host also registers to Satellite Server using the activation key and installs the necessary configuration and management tools from the <strong>Red Hat Satellite Tools</strong> repository.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Bare_Metal_Hosts-Implementing_PXE-less_Discovery">6.8. Implementing PXE-less Discovery</h3>
<div class="paragraph">
<p>Red Hat Satellite 6 provides a PXE-less Discovery service that operates without the need for PXE-based services (DHCP and TFTP). You accomplish this using Satellite Server&#8217;s Discovery image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/PXEless-mode.png" alt="PXEless mode"/>
</div>
</div>
<div class="paragraph">
<p>If you have not yet installed the Discovery service or image, follow the <em>"Installation"</em> section in <a href="#Provisioning_Bare_Metal_Hosts-Configuring_Red_Hat_Satellites_Discovery_Service">Configuring Red Hat Satellite&#8217;s Discovery Service</a>.</p>
</div>
<div class="paragraph">
<p>The ISO for the Discovery service resides at <code>/usr/share/foreman-discovery-image/</code> and is installed using the <code>foreman-discover-image</code> package.</p>
</div>
<div class="paragraph">
<div class="title">Attended Use</div>
<p>This ISO acts as bootable media. Copy this media to either a CD, DVD, or a USB stick. For example, to copy to a USB stick at <code>/dev/sdb</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dd bs=4M \
if=/usr/share/foreman-discovery-image/foreman-discovery-image-3.4.4-5.iso \
of=/dev/sdb</pre>
</div>
</div>
<div class="paragraph">
<p>Insert the Discovery boot media into a bare metal host, start the host, and boot from the media. The Discovery Image displays an option for either <strong>Manual network setup</strong> or <strong>Discovery with DHCP</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If selecting <strong>Manual network setup</strong>, the Discovery image requests a set of network options. This includes the primary network interface that connects to Satellite Server. This Discovery image also asks for network interface configuration options, such as an <strong>IPv4 Address</strong>, <strong>IPv4 Gateway</strong>, and an <strong>IPv4 DNS</strong> server.</p>
<div class="paragraph">
<p>After entering these details, select <strong>Next</strong>.</p>
</div>
</li>
<li>
<p>If selecting <strong>Discovery with DHCP</strong>, the Discovery image requests only the primary network interface that connects to Satellite Server. It attempts to automatically configure the network interface using a DHCP server, such as one that a Capsule Server provides.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the primary interface configuration, the Discovery image requests the <strong>Server URL</strong>, which is the URL of Satellite Server or Capsule Server offering the Discovery service. For example, to use the integrated Capsule on Satellite Server, use the following URL:</p>
</div>
<div class="paragraph">
<p><code><a href="https://satellite.example.com:9090" class="bare">https://satellite.example.com:9090</a></code></p>
</div>
<div class="paragraph">
<p>Set the <strong>Connection type</strong> to <code>Proxy</code>, then select <strong>Next</strong>.</p>
</div>
<div class="paragraph">
<p>The Discovery image also provides a set of fields to input <strong>Custom facts</strong> for the Facter tool to relay back to Satellite Server. These are entered in a <strong>name</strong>-<strong>value</strong> format. Provide any custom facts you require and select <strong>Confirm</strong> to continue.</p>
</div>
<div class="paragraph">
<p>The Satellite reports a successful communication with Satellite Server&#8217;s Discovery service. Navigate to <strong>Hosts</strong> &gt; <strong>Discovered Hosts</strong> and view the newly discovered host.</p>
</div>
<div class="paragraph">
<p>For more information about provisioning discovered hosts, see <a href="#Provisioning_Bare_Metal_Hosts-Creating_New_Hosts_from_Discovered_Hosts">Creating Hosts from Discovered Hosts</a>.</p>
</div>
<div class="paragraph">
<div class="title">Unattended Use and Customization</div>
<p>It is possible to create a customized Discovery ISO, which automates the process of configuring the image after booting. The Discovery image uses a Linux kernel for the operating system, which means you pass kernel parameters to the configure the image&#8217;s operating system. These kernel parameters include:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">proxy.url</dt>
<dd>
<p>The URL of the Capsule Server providing the Discovery service.</p>
</dd>
<dt class="hdlist1">proxy.type</dt>
<dd>
<p>The proxy type. This is usually set to <code>proxy</code> to connect to Capsule Server. This parameter also supports a legacy <code>foreman</code> option, where communication goes directly to Satellite Server instead of a Capsule Server.</p>
</dd>
<dt class="hdlist1">fdi.pxmac</dt>
<dd>
<p>The MAC address of the primary interface in the format of <code>AA:BB:CC:DD:EE:FF</code>. This is the interface you aim to use for communicating with Capsule Server. In automated mode, the first NIC (using network identifiers in alphabetical order) with a link is used. In semi-automated mode, a screen appears and requests you to select the correct interface.</p>
</dd>
<dt class="hdlist1">fdi.pxip, fdi.pxgw, fdi.pxdns</dt>
<dd>
<p>Manually configures IP address (<code>fdi.pxip</code>), the gateway (<code>fdi.pxgw</code>), and the DNS (<code>fdi.pxdns</code>) for the primary network interface. If your omit these parameters, the image uses DHCP to configure the network interface.</p>
</dd>
<dt class="hdlist1">fdi.pxfactname1, fdi.pxfactname2 &#8230;&#8203; fdi.pxfactnameN</dt>
<dd>
<p>Allows you to specify custom fact names.</p>
</dd>
<dt class="hdlist1">fdi.pxfactvalue1, fdi.pxfactvalue2 &#8230;&#8203; fdi.pxfactvalueN</dt>
<dd>
<p>The values for each custom fact. Each value corresponds to a fact name. For example, <code>fdi.pxfactvalue1</code> sets the value for the fact named with <code>fdi.pxfactname1</code>.</p>
</dd>
<dt class="hdlist1">fdi.pxauto</dt>
<dd>
<p>To set automatic or semi-automatic mode. If set to 0, the image uses semi-automatic mode, which allows you to confirm your choices through a set of dialog options. If set to 1, the image uses automatic mode and proceeds without any confirmation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Satellite Server also provides a tool (<code>discovery-remaster</code>) in the <code>foreman-discovery-image</code> package. This tool remasters the image to include these kernel parameters. To remaster the image, run the <code>discovery-remaster</code> tool. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># discovery-remaster ~/iso/foreman-discovery-image-3.4.4-5.iso \
"fdi.pxip=192.168.140.20/24 fdi.pxgw=192.168.140.1 \
fdi.pxdns=192.168.140.2 proxy.url=https://<em>satellite.example.com</em>:9090 \
proxy.type=proxy fdi.pxfactname1=customhostname \
fdi.pxfactvalue1=myhost fdi.pxmac=52:54:00:be:8e:8c fdi.pxauto=1"</pre>
</div>
</div>
<div class="paragraph">
<p>The tool creates a new ISO file in the same directory as the original discovery image. In this scenario, it saves in the <code>/usr/share/foreman-discovery-image/</code> directory.</p>
</div>
<div class="paragraph">
<p>Copy this media to either a CD, DVD, or a USB stick. For example, to copy to a USB stick at <code>/dev/sdb</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dd bs=4M \
if=/usr/share/foreman-discovery-image/foreman-discovery-image-3.4.4-5.iso \
of=/dev/sdb</pre>
</div>
</div>
<div class="paragraph">
<p>Insert the Discovery boot media into a bare metal host, start the host, and boot from the media.</p>
</div>
<div class="paragraph">
<p>For more information about provisioning discovered hosts, see <a href="#Provisioning_Bare_Metal_Hosts-Creating_New_Hosts_from_Discovered_Hosts">Creating Hosts from Discovered Hosts</a>.</p>
</div>
<div class="paragraph">
<div class="title">Final Notes</div>
<p>The host needs to resolve to the following provisioning templates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>kexec Template:</strong> <code>Discovery Red Hat kexec</code></p>
</li>
<li>
<p><strong>provision Template:</strong> <code>Satellite Kickstart Default</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about associating provisioning templates, see <a href="#Configuring_Provisioning_Resources-Creating_Provisioning_Templates">Creating Provisioning Templates</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Provisioning_Resources-Creating_Provisioning_Templates-Deploying_SSH_Keys_during_Provisioning">6.9. Deploying SSH Keys during Provisioning</h3>
<div class="paragraph">
<p>Use this procedure to deploy SSH keys added to a user during provisioning. For information on adding SSH keys to a user, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/administering_red_hat_satellite/chap-red_hat_satellite-administering_red_hat_satellite-users_and_roles#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Creating_and_Managing_Users-Adding_SSH_keys_to_a_User">Adding SSH Keys to a User</a> in <em>Administering Red Hat Satellite</em>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To deploy SSH keys during provisioning, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Create a provisioning template, or clone and edit an existing template. For more information, see <a href="#Configuring_Provisioning_Resources-Creating_Provisioning_Templates">Creating Provisioning Templates</a>.</p>
</li>
<li>
<p>In the template, click the <strong>Template</strong> tab.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, add the <code>create_users</code> snippet to the <code>%post</code> section:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%= snippet('create_users') %&gt;</pre>
</div>
</div>
</li>
<li>
<p>Select the <strong>Default</strong> check box.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab.</p>
</li>
<li>
<p>From the <strong>Application Operating Systems</strong> list, select an operating system.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the provisioning template.</p>
</li>
<li>
<p>Create a host that is associated with the provisioning template or rebuild a host using the OS associated with the modified template. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.3/html-single/managing_hosts/#sect-Red_Hat_Satellite-Managing_Hosts-Managing_Hosts-Creating_a_Host">Creating a Host</a> in the <em>Managing Hosts</em> guide.</p>
<div class="paragraph">
<p>The SSH keys of the <strong>Owned by</strong> user are added automatically when the <code>create_users</code> snippet is executed during the provisioning process. You can set <strong>Owned by</strong> to an individual user or a user group. If you set <strong>Owned by</strong> to a user group, the SSH keys of all users in the user group are added automatically.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_building_a_satellite_discovery_image">6.10. Building a Satellite Discovery Image</h3>
<div class="paragraph">
<p>Use this procedure to build a Satellite discovery image or rebuild an image if you change configuration files.</p>
</div>
<div class="paragraph">
<p>Do not use this procedure on your production Satellite or Capsule.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Install the <code>livecd-tools</code> package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># yum install livecd-tools</pre>
</div>
</div>
<div class="paragraph">
<p>Because Anaconda installer cannot publish through HTTPS, you must enable publishing through HTTP for Kickstart repositories:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Content</strong> &gt; <strong>Products</strong> and in the <strong>Products</strong> window, click the <strong>Repositories</strong> tab.</p>
</li>
<li>
<p>Select a Kickstart repository and for the <strong>Publish via HTTP</strong>, option, click the <strong>Edit</strong> icon, select the check box, and click <strong>Save</strong>.</p>
</li>
<li>
<p>Repeat the previous steps for the Satellite repository.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that publishing via HTTP does not apply to any Red&#160;Hat repositories.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To build the Satellite discovery image, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <code>/usr/share/foreman-discovery-image/foreman-discovery-image.ks</code> file for editing:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vim /usr/share/foreman-discovery-image/foreman-discovery-image.ks</pre>
</div>
</div>
</li>
<li>
<p>Replace <code>repo --name=rhel --baseurl=http://download/00000</code> with with your own repos for RHEL and Satellite with your repository URLs. To find the URLs, navigate to <strong>Content</strong> &gt; <strong>Products</strong> and click the <strong>Repositories</strong> tab and copy the URL for both repositories into the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">repo --name=rhel --baseurl=http://download/released/RHEL-7/7.4/Server/x86_64/os/
repo --name=sat --baseurl=http://download2/nightly/Satellite/6.4/candidate/latest-Satellite-6.4-RHEL-7/compose/Satellite/x86_64/os/</pre>
</div>
</div>
</li>
<li>
<p>Run the <code>livecd-creator</code> tool:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># livecd-creator --title="Discovery-Image" \
--compression-type=xz \
--cache=var/cache/build-fdi \
--config /usr/share/foreman-discovery-image/foreman-discovery-image.ks \
--fslabel fdi \
--tmpdir /var/tmp</pre>
</div>
</div>
<div class="paragraph">
<p>If you change <code>fdi</code> in the <code>--fslabel</code> option, you must also change the root label on the kernel command line when loading the image. <code>fdi</code> or the alternative name is appended to the <code>.iso</code> file that is created as part of this procedure. The PXE Discovery tool uses this name when converting from <code>.iso</code> to PXE.</p>
</div>
<div class="paragraph">
<p>Use <code>/var/tmp</code> because this process requires close to 3GB of space and <code>/tmp</code> might have problems if the system is low on swap space.</p>
</div>
</li>
<li>
<p>Verify that your <code>fdi.iso</code> file is created:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ls *.iso -h</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you create the <code>.iso</code> file, you can boot the <code>.iso</code> file over a network or locally. Complete one of the following procedures.</p>
</div>
<div class="olist arabic">
<div class="title">To boot the iso file over a network:</div>
<ol class="arabic">
<li>
<p>To extract the initial ramdisk and kernel files from the <code>.iso</code> file over a network, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># discovery-iso-to-pxe fdi.iso</pre>
</div>
</div>
</li>
<li>
<p>Create a directory to store your boot files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /var/lib/tftpboot/boot/<em>myimage</em></pre>
</div>
</div>
</li>
<li>
<p>Copy the <code>initrd0.img</code> and <code>vmlinuz0</code> files to your new directory.</p>
</li>
<li>
<p>Edit the <code>KERNEL</code> and <code>APPEND</code> entries in the <code>/var/lib/tftpboot/pxelinux.cfg</code> file to add the information about your own initial ramdisk and kernel files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">To boot the iso file locally:</div>
<p>If you want to create a hybrid <code>.iso</code> file for booting locally, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To convert the <code>.iso</code> file to an <code>.iso</code> hybrid file for PXE provisioning, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># isohybrid --partok fdi.iso</pre>
</div>
</div>
<div class="paragraph">
<p>If you have <code>grub2</code> packages installed, you can also use the following command to install a <code>grub2</code> bootloader:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># isohybrid --partok --uefi fdi.iso</pre>
</div>
</div>
</li>
<li>
<p>To add <code>md5</code> checksum to the <code>.iso</code> file so it can pass installation media validation tests in Satellite, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># implantisomd5 fdi.iso</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_in_KVM">7. Provisioning Virtual Machines on a KVM Server (libvirt)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kernel-based Virtual Machines (KVMs) use an open source virtualization daemon and API called <code>libvirt</code> running on Red Hat Enterprise Linux. Red Hat Satellite 6 can connect to the <code>libvirt</code> API on a KVM server, provision hosts on the hypervisor, and control certain virtualization functions.</p>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_KVM-Prerequisites_for_KVM_Provisioning">7.1. Prerequisites for KVM Provisioning</h3>
<div class="paragraph">
<p>The requirements for KVM provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronized content repositories for the version of Red Hat Enterprise Linux that you want to use. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/importing_red_hat_content#Importing_Red_Hat_Content-Synchronizing_Red_Hat_Repositories">Synchronizing Red Hat Repositories</a> in the <em>Content Management Guide</em>.</p>
</li>
<li>
<p>A Capsule Server managing a network on the KVM server. Ensure no other DHCP services run on this network to avoid conflicts with the Capsule Server. For more information about network service configuration for Capsule Servers, see <a href="#Configuring_Networking">Configuring Networking</a>.</p>
</li>
<li>
<p>An activation key for host registration. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_activation_keys#Managing_Activation_Keys-Creating_an_Activation_Key">Creating An Activation Key</a> in the <em>Content Management</em> guide.</p>
</li>
<li>
<p>A Red Hat Enterprise Linux server running KVM virtualization tools. For more information, see the <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Getting_Started_Guide/index.html">Red Hat Enterprise Linux 7 Virtualization Getting Started Guide</a>.</p>
</li>
<li>
<p>An existing virtual machine image if you want to use image-based provisioning. Ensure that this image exists in a storage pool on the KVM host. The <code>default</code> storage pool is usually located in <code>/var/lib/libvirt/images</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">User Roles and Permissions to Provision Libvirt Compute Resources</div>
<p>To provision a Libvirt host in Satellite, you must have a user account with the following roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Edit hosts</code></p>
</li>
<li>
<p><code>View hosts</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/administering_red_hat_satellite/chap-red_hat_satellite-administering_red_hat_satellite-users_and_roles#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Creating_and_Managing_Users-Assigning_Roles_to_a_User">Assigning Roles to a User</a> in the <em>Administering Red Hat Satellite</em> guide.</p>
</div>
<div class="paragraph">
<p>You must also create a custom role with the following permissions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>view_compute_resources</code></p>
</li>
<li>
<p><code>destroy_compute_resources_vms</code></p>
</li>
<li>
<p><code>power_compute_resources_vms</code></p>
</li>
<li>
<p><code>create_compute_resources_vms</code></p>
</li>
<li>
<p><code>view_compute_resources_vms</code></p>
</li>
<li>
<p><code>view_locations</code></p>
</li>
<li>
<p><code>view_subnets</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about creating roles, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/administering_red_hat_satellite/chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Creating_and_Managing_Roles-Creating_a_Role">Creating a Role</a>. For more information about adding permissions to a role, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/administering_red_hat_satellite/chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Users_and_Roles#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Creating_and_Managing_Roles-Adding_Permissions_to_a_Role">Adding Permissions to a Role</a> in the <em>Administering Red Hat Satellite</em> guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="Povisioning_Virtual_Machines_in_KVM-Configuring_the_Satellite_Server_for_KVM_Connections">7.2. Configuring Satellite Server for KVM Connections</h3>
<div class="paragraph">
<p>Before adding the KVM connection, Satellite Server requires some configuration to ensure a secure connection. This means creating an SSH key pair for the user that performs the connection, which is the <code>foreman</code> user.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On Satellite Server, switch to the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre># su foreman -s /bin/bash</pre>
</div>
</div>
</li>
<li>
<p>Generate the key pair:</p>
<div class="listingblock">
<div class="content">
<pre>$ ssh-keygen</pre>
</div>
</div>
</li>
<li>
<p>Copy the public key to the KVM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ssh-copy-id <em>root@kvm.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>Exit the bash shell for the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre>$ exit</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>libvirt-client</code> package:</p>
<div class="listingblock">
<div class="content">
<pre># yum install libvirt-client</pre>
</div>
</div>
</li>
<li>
<p>Use the following command to test the connection to the KVM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su foreman -s /bin/bash -c 'virsh -c qemu+ssh://root@kvm.example.com/system list'</pre>
</div>
</div>
<div class="paragraph">
<p>When you add the KVM connection in Satellite Server, use the <code>qemu+ssh</code> protocol and the address to the server. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">qemu+ssh://root@<em>kvm.example.com</em>/system</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_KVM-Adding_a_KVM_Connection_to_the_Satellite_Server">7.3. Adding a KVM Connection to Satellite Server</h3>
<div class="paragraph">
<p>Use this procedure to add a KVM connection to Satellite Server&#8217;s compute resources.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add a KVM connection to Satellite, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>, and in the Compute Resources window, click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the new compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>Libvirt</strong></p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the connection URL to the KVM server. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> qemu+ssh://<em>root@kvm.example.com</em>/system</pre>
</div>
</div>
</li>
<li>
<p>From the <strong>Display type</strong> list, select either <strong>VNC</strong> or <strong>Spice</strong>.</p>
</li>
<li>
<p>Optional: To secure console access for new hosts with a randomly generated password, select the <strong>Set a randomly generated password on the display connection</strong> check box. You can retrieve the password for the VNC console to access guest virtual machine console from the <code>libvirtd</code> host from the output of the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># virsh edit <em>your_VM_name</em>
&lt;graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0' passwd='<em>your_randomly_generated_password</em>'&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The password is randomly generated every time the console for the virtual machine is opened, for example, with virt-manager.</p>
</div>
</li>
<li>
<p>Click <strong>Test Connection</strong> to ensure that Satellite Server connects to the KVM server without fault.</p>
</li>
<li>
<p>Verify that the <strong>Locations</strong> and <strong>Organizations</strong> tabs are automatically set to your current context. If you want, add additional contexts to these tabs.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the KVM connection.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the connection with the <code>hammer compute-resource create</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create --name "<em>My_KVM_Server</em>" \
--provider "Libvirt" --description "KVM server at <em>kvm.example.com</em>" \
--url "qemu+ssh://root@<em>kvm.example.com/system</em>" --locations "New York" \
--organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_KVM-Adding_KVM_Images_to_Satellite_Server">7.4. Adding KVM Images to Satellite Server</h3>
<div class="paragraph">
<p>If you want to use image-based provisioning to create hosts, you must add information about the image to your Satellite Server. This includes access details and the image location.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add KVM images on Satellite Server, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>, and in the Compute Resources window, click the name of your KVM connection.</p>
</li>
<li>
<p>Click the <strong>Image</strong> tab, and then click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operatingsystem</strong> list, select the image&#8217;s base operating system.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access. This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>From the <strong>User data</strong> list, select if you want images to support user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>In the <strong>Image path</strong> field, enter the full path that points to the image on the KVM server. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> /var/lib/KVM/images/TestImage.qcow2</pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the image with the <code>hammer compute-resource image create</code> command. Use the <code>--uuid</code> field to store the full path of the image location on the KVM server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create --name "Test KVM Image" \
--operatingsystem "RedHat <em>version</em>" --architecture "x86_64" --username root \
--user-data false --uuid "/var/lib/libvirt/images/TestImage.qcow2" \
--compute-resource "<em>My_KVM_Server</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_KVM-Adding_KVM_Details_to_a_Compute_Profile">7.5. Adding KVM Details to a Compute Profile</h3>
<div class="paragraph">
<p>We can predefine certain hardware settings for KVM-based virtual machines by adding these hardware settings to a compute profile.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add Red Hat Virtualization details to a compute profile, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>In the Compute Profiles window, click the name of an existing compute resource or click <strong>Create Compute Profile</strong> and select a compute resource to use to create a compute profile.</p>
</li>
<li>
<p>In the <strong>CPUs</strong> field, enter the number of CPUs to allocate to the new host.</p>
</li>
<li>
<p>In the <strong>Memory</strong> field, enter the amount of memory to allocate to the new host.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use if performing image-based provisioning.</p>
</li>
<li>
<p>From the <strong>Network Interfaces</strong> list, select the network parameters for the host&#8217;s network interface. You can create multiple network interfaces. However, at least one interface must point to a Capsule-managed network.</p>
</li>
<li>
<p>In the <strong>Storage</strong> area, enter the storage parameters for the host. You can create multiple volumes for the host.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the settings to the compute profile.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>The compute profile CLI commands are not yet implemented in Red Hat Satellite 6.4. As an alternative, you can include the same settings directly during the host creation process.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_KVM-Creating_Hosts_on_a_KVM_Server">7.6. Creating Hosts on a KVM Server</h3>
<div class="paragraph">
<p>In Satellite, you can use KVM provisioning to create hosts over a network connection and from an existing image.</p>
</div>
<div class="paragraph">
<p>If you create a host with an existing image, the new host entry triggers the KVM server to create the virtual machine, using the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<p>If you want to create a host over a network connection, the new host must have access either to Satellite Server&#8217;s integrated Capsule or an external Capsule Server on a KVM virtual network, so that the host has access to PXE provisioning services. This new host entry triggers the KVM server to create and start a virtual machine. If the virtual machine detects the defined Capsule Server through the virtual network, the virtual machine boots to PXE and begins to install the chosen operating system.</p>
</div>
<div class="paragraph">
<div class="title">DHCP Conflicts</div>
<p>For network-based provisioning, if you use a virtual network on the KVM server for provisioning, select a network that does not provide DHCP assignments. This causes DHCP conflicts with Satellite Server when booting new hosts.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a KVM host, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name that you want to become the provisioned system&#8217;s host name.</p>
</li>
<li>
<p>Click the <strong>Organization</strong> and <strong>Location</strong> tabs to ensure that the provisioning context is automatically set to the current context.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select the host group that you want to use to populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the KVM connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine-based settings.</p>
</li>
<li>
<p>Click the <strong>Interface</strong> tab and click <strong>Edit</strong> on the host&#8217;s interface.</p>
</li>
<li>
<p>Verify that the fields are automatically populated with values. Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Satellite Server automatically assigns an IP address for the new host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank. The KVM server assigns one to the host.</p>
</li>
<li>
<p>Verify that the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options are automatically selected for the first interface on the host. If not, select them.</p>
</li>
<li>
<p>In the interface window, review the KVM-specific fields that are populated with settings from your compute profile. Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>For network-based provisioning, ensure that the <strong>Provisioning Method</strong> is set to <code>Network Based</code>. For image-based provisioning, ensure that the <strong>Provisioning Method</strong> is set to <code>Image Based</code></p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile. Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and ensure that a parameter exists that provides an activation key. If not, add an activation key.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method build</code> to use network-based provisioning.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create --name "kvm-test1" --organization "<em>My_Organization</em>" \
--location "New York" --hostgroup "Base" \
--compute-resource "<em>My_KVM_Server</em>" --provision-method build \
--build true --enabled true --managed true \
--interface "managed=true,primary=true,provision=true,compute_type=network,compute_network=examplenetwork" \
--compute-attributes="cpus=1,memory=1073741824" \
--volume="pool_name=default,capacity=20G,format_type=qcow2"</pre>
</div>
</div>
<div class="paragraph">
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code> to use image-based provisioning.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create --name "kvm-test2" --organization "<em>My_Organization</em>" \
--location "New York" --hostgroup "Base" \
--compute-resource "<em>My_KVM_Server</em>" --provision-method image \
--image "Test KVM Image" --enabled true --managed true \
--interface "managed=true,primary=true,provision=true,compute_type=network,compute_network=examplenetwork" \
--compute-attributes="cpus=1,memory=1073741824" \
--volume="pool_name=default,capacity=20G,format_type=qcow2"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, see <a href="#CLI_Params">Additional Host Parameters for Hammer CLI</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_in_Red_Hat_Virtualization">8. Provisioning Virtual Machines in Red Hat Virtualization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat Virtualization (version 4.0 and later) or Red Hat Enterprise Virtualization (version 3.6 and earlier) is an enterprise-grade server and desktop virtualization platform built on Red Hat Enterprise Linux.</p>
</div>
<div class="paragraph">
<p>With Red Hat Satellite 6, you can manage virtualization functions through Red Hat Virtualization&#8217;s REST API version 3. REST API version 4 is not yet supported by Satellite 6. This includes creating virtual machines and controlling their power states.</p>
</div>
<div class="paragraph">
<p>Use the following procedures to add a connection to a Red Hat Virtualization environment and provision a virtual machine.</p>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_Red_Hat_Enterprise_Virtualization-Prerequisites_for_Red_Hat_Virtualization_Provisioning">8.1. Prerequisites for Red Hat Virtualization Provisioning</h3>
<div class="paragraph">
<p>The requirements for Red Hat Virtualization provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronized content repositories for the version of Red Hat Enterprise Linux that you want to use. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/importing_red_hat_content#Importing_Red_Hat_Content-Synchronizing_Red_Hat_Repositories">Synchronizing Red Hat Repositories</a> in the <em>Content Management Guide</em>.</p>
</li>
<li>
<p>A Capsule Server managing a logical network on the Red Hat Virtualization environment. Ensure no other DHCP services run on this network to avoid conflicts with the Capsule Server. For more information, see <a href="#Configuring_Networking">Configuring Networking</a>.</p>
</li>
<li>
<p>An existing template, other than the <code>blank</code> template, if you want to use image-based provisioning. For more information about creating templates for virtual machines, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.0/html/virtual_machine_management_guide/chap-templates">Templates</a> in the <em>Virtual Machine Management Guide</em>.</p>
</li>
<li>
<p>An activation key for host registration. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_activation_keys#Managing_Activation_Keys-Creating_an_Activation_Key">Creating An Activation Key</a> in the <em>Content Management</em> guide.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_Red_Hat_Virtualization-Creating_a_Red_Hat_Virtualization_User">8.2. Creating a Red Hat Virtualization User</h3>
<div class="paragraph">
<p>The Red Hat Virtualization server requires an administration-like user for Satellite Server communication. For security reasons, Red Hat advises against using the <code>admin@internal</code> user for such communication. Instead, create a new Red Hat Virtualization user with the following permissions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>System</p>
<div class="ulist">
<ul>
<li>
<p>Configure System</p>
<div class="ulist">
<ul>
<li>
<p>Login Permissions</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Network</p>
<div class="ulist">
<ul>
<li>
<p>Configure vNIC Profile</p>
<div class="ulist">
<ul>
<li>
<p>Create</p>
</li>
<li>
<p>Edit Properties</p>
</li>
<li>
<p>Delete</p>
</li>
<li>
<p>Assign vNIC Profile to VM</p>
</li>
<li>
<p>Assign vNIC Profile to Template</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Template</p>
<div class="ulist">
<ul>
<li>
<p>Provisioning Operations</p>
<div class="ulist">
<ul>
<li>
<p>Import/Export</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>VM</p>
<div class="ulist">
<ul>
<li>
<p>Provisioning Operations</p>
<div class="ulist">
<ul>
<li>
<p>Create</p>
</li>
<li>
<p>Delete</p>
</li>
<li>
<p>Import/Export</p>
</li>
<li>
<p>Edit Storage</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Disk</p>
<div class="ulist">
<ul>
<li>
<p>Provisioning Operations</p>
<div class="ulist">
<ul>
<li>
<p>Create</p>
</li>
</ul>
</div>
</li>
<li>
<p>Disk Profile</p>
<div class="ulist">
<ul>
<li>
<p>Attach Disk Profile</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about how to create a user and add permissions in Red Hat Virtualization, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.1/html/administration_guide/sect-red_hat_enterprise_virtualization_manager_user_tasks">Administering User Tasks From the Administration Portal</a> in the <em>Red Hat Virtualization Administration Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_Red_Hat_Virtualization-Adding_a_Red_Hat_Virtualization_Connection_to_the_Satellite_Server">8.3. Adding a Red Hat Virtualization Connection to Satellite Server</h3>
<div class="paragraph">
<p>Use this procedure to add a Red Hat Virtualization connection to Satellite Server&#8217;s compute resources.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add a Red Hat Virtualization connection to Satellite, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>, and in the Compute Resources window, click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the new compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>RHV</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the connection URL for the Red Hat Virtualization Manager&#8217;s API.</p>
<div class="paragraph">
<p>For example, in RHEV 3.6 and earlier, the URL is
of the following form: <code><a href="https://rhvm.example.com/ovirt-engine/api" class="bare">https://rhvm.example.com/ovirt-engine/api</a></code>. In RHV 4.0 and
later, the URL is of the following form: <code><a href="https://rhvm.example.com/ovirt-engine/api/v3" class="bare">https://rhvm.example.com/ovirt-engine/api/v3</a></code>.</p>
</div>
</li>
<li>
<p>Optionally, select the <strong>Use APIv4 (experimental)</strong> check box to evaluate the new engine API.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The items listed in this step are provided as Technology Previews. For further information about the scope of Technology Preview status, and associated support implications, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the <strong>User</strong> field, enter the name of a user with permissions to access Red Hat Virtualization Manager&#8217;s resources.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the password of the user.</p>
</li>
<li>
<p>Click <strong>Load Datacenters</strong> to populate the <strong>Datacenter</strong> list with data centers from your Red Hat Virtualization environment.</p>
</li>
<li>
<p>From the <strong>Datacenter</strong> list, select a data center.</p>
</li>
<li>
<p>From the <strong>Quota ID</strong> list, select a quota to limit resources available to Satellite.</p>
</li>
<li>
<p>In the <strong>X509 Certification Authorities</strong> field, enter the certificate authority for SSL/TLS access. Alternatively, if you leave the field blank, a self-signed certificate is generated on the first API request by the server.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and select the location you want to use.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and select the organization you want to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute resource.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>To create a Red Hat Virtualization connection, enter the <code>hammer compute-resource create</code> command with <code>Ovirt</code> for <code>--provider</code> and the name of the data center you want to use for <code>--datacenter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create \
--name "<em>My_RHV</em>" --provider "Ovirt" \
--description "RHV server at <em>rhvm.example.com</em>" \
--url "<em>https://rhvm.example.com/ovirt-engine/api</em>" \
--use-v4 "false" --user "<em>Satellite_User</em>" \
--password "<em>My_Password</em>" \
--locations "New York" --organizations "<em>My_Organization</em>" \
--datacenter "<em>My_Datacenter</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, to evaluate the new engine API, change <code>false</code> to <code>true</code> for the <code>--use-v4</code> option.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>The items listed in this step are provided as Technology Previews. For further information about the scope of Technology Preview status, and associated support implications, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_Red_Hat_Virtualization-Adding_Red_Hat_Virtualization_Images_on_the_Satellite_Server">8.4. Adding Red Hat Virtualization Images to Satellite Server</h3>
<div class="paragraph">
<p>Red Hat Virtualization uses templates as images for creating virtual machines. If you use image-based provisioning to create hosts, you must add Red Hat Virtualization template details to your Satellite Server. This includes access details and the template name.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add Red Hat Virtualization images on Satellite Server, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>, and in the Compute Resources window, click the name of your Red Hat Virtualization connection.</p>
</li>
<li>
<p>Click the <strong>Image</strong> tab, and then click <strong>New Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operatingsystem</strong> list, select the image&#8217;s base operating system.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access. This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the name of the image on Red Hat Virtualization.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the image with the <code>hammer compute-resource image create</code> command. Use the <code>--uuid</code> option to store the template UUID on the Red Hat Virtualization server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create --name "<em>Test_RHV_Image</em>" \
--operatingsystem "RedHat 7.2" --architecture "x86_64" --username root \
--uuid "9788910c-4030-4ae0-bad7-603375dd72b1" \
--compute-resource "<em>My_RHV</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_Red_Hat_Virtualization-Adding_Red_Hat_Virtualization_Details_to_a_Compute_Profile">8.5. Adding Red Hat Virtualization Details to a Compute Profile</h3>
<div class="paragraph">
<p>You can predefine certain hardware settings for virtual machines on Red Hat Virtualization. You achieve this through adding these hardware settings to a compute profile.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add Red Hat Virtualization details to a compute profile, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong> and in the Compute Profiles window, click the name of the Red Hat Virtualization connection.</p>
</li>
<li>
<p>From the <strong>Cluster</strong> list, select the target host cluster in the Red Hat Virtualization environment.</p>
</li>
<li>
<p>From the <strong>Template</strong> list, select the RHV template to use for the <strong>Cores</strong> and <strong>Memory</strong> settings.</p>
</li>
<li>
<p>In the <strong>Cores</strong> field, enter the number of CPU cores to allocate to the new host.</p>
</li>
<li>
<p>In the <strong>Memory</strong> field, enter the amount of memory to allocate to the new host.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select image to use for image-based provisioning.</p>
</li>
<li>
<p>In the <strong>Network Interfaces</strong> area, enter the network parameters for the host&#8217;s network interface. You can create multiple network interfaces. However, at least one interface must point to a Capsule-managed network. For each network interface, enter the following details:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter the name of the network interface.</p>
</li>
<li>
<p>From the <strong>Network</strong> list, select The logical network that you want to use.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the <strong>Storage</strong> area, enter the storage parameters for the host. You can create multiple volumes for the host. For each volume, enter the following details:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Size (GB)</strong> enter the size, in GB, for the new volume.</p>
</li>
<li>
<p>From the <strong>Storage domain</strong> list, select the storage domain for the volume.</p>
</li>
<li>
<p>From the <strong>Preallocate disk</strong>, select either thin provisioning or preallocation of the full disk.</p>
</li>
<li>
<p>From the <strong>Bootable</strong> list, select whether you want a bootable or non bootable volume.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>The compute profile CLI commands are not yet implemented in Red Hat Satellite 6.4. As an alternative, you can include the same settings directly during the host creation process.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_Red_Hat_Virtualization-Creating_Hosts_on_a_Red_Hat_Virtualization_Server">8.6. Creating Network-Based Hosts on a Red Hat Virtualization Server</h3>
<div class="paragraph">
<p>In Satellite, you can create Red Hat Virtualization hosts over a network connection or from an existing image.</p>
</div>
<div class="paragraph">
<p>To create a host over a network, the new host must have access to either Satellite Server&#8217;s integrated Capsule or an external Capsule Server on a Red Hat Virtualization virtual network, so that the host has access to PXE provisioning services. The new host entry triggers the Red Hat Virtualization server to create the virtual machine. If the virtual machine detects the defined Capsule Server through the virtual network, the virtual machine boots to PXE and begins to install the chosen operating system.</p>
</div>
<div class="paragraph">
<div class="title">DHCP conflicts</div>
<p>If you use a virtual network on the Red Hat Virtualization server for provisioning, ensure to select one that does not provide DHCP assignments. This causes DHCP conflicts with Satellite Server when booting new hosts.</p>
</div>
<div class="paragraph">
<p>When you create a host with an existing image, the new host entry triggers the Red Hat Virtualization server to create the virtual machine, using the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a host for Red Hat Virtualization Server, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>New Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name that you want to become the provisioned system&#8217;s host name.</p>
</li>
<li>
<p>Click the <strong>Organization</strong> and <strong>Location</strong> tabs to ensure that the provisioning context is automatically set to the current context.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select the host group that you want to use to populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the Red Hat Virtualization connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine-based settings.</p>
</li>
<li>
<p>Click the <strong>Interface</strong> tab and click <strong>Edit</strong> on the host&#8217;s interface.</p>
</li>
<li>
<p>Verify that the fields are automatically populated with values. Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Satellite Server automatically assigns an IP address for the new host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank. The Red Hat Virtualization server assigns one to the host.</p>
</li>
<li>
<p>Verify that the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options are automatically selected for the first interface on the host. If not, select them.</p>
</li>
<li>
<p>In the interface window, ensure that the Red Hat Virtualization-specific fields are populated with settings from the compute profile. Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>For network-based provisioning, ensure that the <strong>Provisioning Method</strong> is set to <code>Network Based</code>. For image-based provisioning, ensure that the <strong>Provisioning Method</strong> is set to <code>Image Based</code>.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile. Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and ensure that a parameter exists that provides an activation key. If not, add an activation key.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>To create a host with network-based provisioning, use the <code>hammer host create</code> command and include <code>--provision-method build</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create --name "rhv-test1" --organization "<em>My_Organization</em>" \
--location "New York" --hostgroup "Base" \
--compute-resource "<em>My_RHV</em>" --provision-method build \
--build true --enabled true --managed true \
--interface "managed=true,primary=true,provision=true,compute_name=eth0,compute_network=satnetwork" \
--compute-attributes="cluster=Default,cores=1,memory=1073741824,start=true" \
--volume="size_gb=20G,storage_domain=Data,bootable=true"</pre>
</div>
</div>
<div class="paragraph">
<p>To create a host with image-based provisioning, use the <code>hammer host create</code> command and include <code>--provision-method image</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create --name "rhv-test2" --organization "<em>My_Organization</em>" \
--location "New York" --hostgroup "Base" \
--compute-resource "<em>My_RHV</em>" --provision-method image \
--image "<em>Test_RHV_Image</em>" --enabled true --managed true \
--interface "managed=true,primary=true,provision=true,compute_name=eth0,compute_network=satnetwork" \
--compute-attributes="cluster=Default,cores=1,memory=1073741824,start=true" \
--volume="size_gb=20G,storage_domain=Data,bootable=true"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, see <a href="#CLI_Params">Additional Host Parameters for Hammer CLI</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_in_VMware_vSphere">9. Provisioning Virtual Machines in VMware vSphere</h2>
<div class="sectionbody">
<div class="paragraph">
<p>VMware vSphere is an enterprise-level virtualization platform from VMware. Red Hat Satellite 6 can interact with the vSphere platform, including creating new virtual machines and controlling their power management states.</p>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_VMware_vSphere-Prerequisites_for_VMware_vSphere_Provisioning">9.1. Prerequisites for VMware vSphere Provisioning</h3>
<div class="paragraph">
<p>The requirements for VMware vSphere provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronized content repositories for the version of Red Hat Enterprise Linux that you want to use. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/importing_red_hat_content#Importing_Red_Hat_Content-Synchronizing_Red_Hat_Repositories">Synchronizing Red Hat Repositories</a> in the <em>Content Management Guide</em>.</p>
</li>
<li>
<p>A Capsule Server managing a network on the vSphere environment. Ensure no other DHCP services run on this network to avoid conflicts with the Capsule Server. For more information, see <a href="#Configuring_Networking">Configuring Networking</a>.</p>
</li>
<li>
<p>An existing VMware template if you aim to use image-based provisioning.</p>
</li>
<li>
<p>An activation key for host registration. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_activation_keys#Managing_Activation_Keys-Creating_an_Activation_Key">Creating An Activation Key</a> in the <em>Content Management</em> guide.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_VMware_vSphere-Creating_a_VMware_vSphere_User">9.2. Creating a VMware vSphere User</h3>
<div class="paragraph">
<p>The VMware vSphere server requires an administration-like user for Satellite Server communication. For security reasons, do not use the <code>administrator</code> user for such communication. Instead, create a user with the following permissions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All Privileges &#8594; Datastore &#8594; Allocate Space</p>
</li>
<li>
<p>All Privileges &#8594; Network &#8594; Assign Network</p>
</li>
<li>
<p>All Privileges &#8594; Resource &#8594; Assign virtual machine to resource pool</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Configuration (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Interaction</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Inventory</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Provisioning</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_VMware_vSphere-Adding_a_VMware_vSphere_Connection_to_the_Satellite_Server">9.3. Adding a VMware vSphere Connection to Satellite Server</h3>
<div class="paragraph">
<p>Use this procedure to add a VMware vSphere connection in Satellite Server&#8217;s compute resources.</p>
</div>
<div class="paragraph">
<p>Ensure that the host and network-based firewalls are configured to allow Satellite to vCenter communication on TCP port 443. Verify that Satellite is able to resolve the host name of vCenter and vCenter is able to resolve Satellite Server&#8217;s host name.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add a connection, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>, and in the Compute Resources window, click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>VMware</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the resource.</p>
</li>
<li>
<p>In the <strong>VCenter/Server</strong> field, enter the IP address or host name of the vCenter server.</p>
</li>
<li>
<p>In the <strong>User</strong> field, enter the user name with permission to access the vCenter&#8217;s resources.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the password for the user.</p>
</li>
<li>
<p>Click <strong>Load Datacenters</strong> to populate the list of data centers from your VMware vSphere environment.</p>
</li>
<li>
<p>From the <strong>Datacenter</strong> list, select a specific data center to manage from this list.</p>
</li>
<li>
<p>In the <strong>Fingerprint</strong> field, ensure that this field is populated with the fingerprint from the data center.</p>
</li>
<li>
<p>From the <strong>Display Type</strong> list, select a console type, for example, <strong>VNC</strong> or <strong>VMRC</strong>. Note that VNC consoles are unsupported on VMware ESXi 6.5 and later.</p>
</li>
<li>
<p>Optional: In the <strong>VNC Console Passwords</strong> field, select the <strong>Set a randomly generated password on the display connection</strong> check box to secure console access for new hosts with a randomly generated password. You can retrieve the password for the VNC console to access guest virtual machine console from the <code>libvirtd</code> host from the output of the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># virsh edit <em>your_VM_name</em>
&lt;graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0' passwd='<em>your_randomly_generated_password</em>'&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The password randomly generates every time the console for the virtual machine opens, for example, with virt-manager.</p>
</div>
</li>
<li>
<p>From the <strong>Enable Caching</strong> list, you can select whether to enable caching of compute resources. For more information, see <a href="#Provisioning_Virtual_Machines_in_VMware_vSphere-Caching_of_Compute_resources">Caching of Compute Resources</a>.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> and <strong>Organizations</strong> tabs and verify that the values are automatically set to your current context. You can also add additional contexts.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the connection.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the connection with the <code>hammer compute-resource create</code> command. Select <code>Vmware</code> as the <code>--provider</code> and set the instance UUID of the data center as the <code>--uuid</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create --name "<em>My_vSphere</em>" \
--provider "Vmware" \
--description "vSphere server at <em>vsphere.example.com</em>" \
--server "<em>vsphere.example.com</em>" --user "<em>SatelliteUser</em>" \
--password "p@55w0rd!" --locations "New York" --organizations "<em>My_Organization</em>" \
--uuid 72cb9454-81cd-4231-a863-d9baf0f399f8</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_VMware_vSphere-Adding_VMware_vSphere_Images_on_the_Satellite_Server">9.4. Adding VMware vSphere Images to Satellite Server</h3>
<div class="paragraph">
<p>VMware vSphere uses templates as images for creating new virtual machines. If using image-based provisioning to create new hosts, you need to add VMware template details to your Satellite Server. This includes access details and the template name.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add an image, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and in the Compute Resources window, click the VMware vSphere connection.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operatingsystem</strong> list, select the image&#8217;s base operating system.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>User</strong> field, enter the SSH user name for image access. This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>From the <strong>User data</strong> list, select whether you want the images to support user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>In the <strong>Image</strong> field, enter the relative path and name of the template on the vSphere environment. Do not include the data center in the relative path.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the image with the <code>hammer compute-resource image create</code> command. Use the <code>--uuid</code> field to store the relative template path on the vSphere environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create --name "<em>Test_vSphere_Image</em>" \
--operatingsystem "RedHat 7.2" --architecture "x86_64" \
--username root --uuid "Templates/RHEL72" \
--compute-resource "<em>My_vSphere</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_VMware_vSphere-Adding_VMware_vSphere_Details_to_a_Compute_Profile">9.5. Adding VMware vSphere Details to a Compute Profile</h3>
<div class="paragraph">
<p>You can predefine certain hardware settings for virtual machines on VMware vSphere. You achieve this through adding these hardware settings to a compute profile.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add VMware vSphere details to a compute profile, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong> and, in the Compute Profiles window, click the name of the compute profile, and then click the vSphere connection.</p>
</li>
<li>
<p>In the <strong>CPUs</strong> field, enter the number of CPUs to allocate to the new host.</p>
</li>
<li>
<p>In the <strong>Cores per socket</strong> field, enter the number of cores to allocate to each CPU.</p>
</li>
<li>
<p>In the <strong>Memory</strong> field, enter the amount of memory to allocate to the new host.</p>
</li>
<li>
<p>In the <strong>Cluster</strong> field, enter the name of the target host cluster on the VMware environment.</p>
</li>
<li>
<p>From the <strong>Resource pool</strong> list, select an available resource allocations for the host.</p>
</li>
<li>
<p>In the <strong>Folder</strong> field, enter the folder to organize the host.</p>
</li>
<li>
<p>From the <strong>Guest OS</strong> list, select the operating system you want to use in VMware vSphere.</p>
</li>
<li>
<p>From the <strong>SCSI controller</strong> list, select the disk access method for the host.</p>
</li>
<li>
<p>From the <strong>Virtual H/W version</strong> list, select the underlying VMware hardware abstraction to use for virtual machines.</p>
</li>
<li>
<p>You can select the <strong>Memory hot add</strong> or <strong>CPU hot add</strong> check boxes if you want to add more resources while the virtual machine is powered.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use if performing image-based provisioning.</p>
</li>
<li>
<p>From the <strong>Network Interfaces</strong> list, select the network parameters for the host&#8217;s network interface. You can create multiple network interfaces. However, at least one interface must point to a Capsule-managed network.</p>
</li>
<li>
<p>Select the <strong>Eager zero</strong> check box if you want to use eager zero thick provisioning. If unchecked, the disk uses lazy zero thick provisioning.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>The compute profile CLI commands are not yet implemented in Red Hat Satellite 6.4. As an alternative, you can include the same settings directly during the host creation process.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_VMware_vSphere-Creating_Hosts_on_a_VMware_vSphere_Server">9.6. Creating Hosts on a VMware vSphere Server</h3>
<div class="paragraph">
<p>The VMware vSphere provisioning process provides the option to create hosts over a network connection or using an existing image.</p>
</div>
<div class="paragraph">
<p>For network-based provisioning, you must create a host to access either Satellite Server&#8217;s integrated Capsule or an external Capsule Server on a VMware vSphere virtual network, so that the host has access to PXE provisioning services. The new host entry triggers the VMware vSphere server to create the virtual machine. If the virtual machine detects the defined Capsule Server through the virtual network, the virtual machine boots to PXE and begins to install the chosen operating system.</p>
</div>
<div class="paragraph">
<div class="title">DHCP Conflicts</div>
<p>If you use a virtual network on the VMware vSphere server for provisioning, ensure that you select a virtual network that does not provide DHCP assignments. This causes DHCP conflicts with Satellite Server when booting new hosts.</p>
</div>
<div class="paragraph">
<p>For image-based provisioning, use the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To create a host for a VMware vSphere server, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>New host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name that you want to become the provisioned system&#8217;s host name.</p>
</li>
<li>
<p>Click the <strong>Organization</strong> and <strong>Location</strong> tabs to ensure that the provisioning context is automatically set to the current context.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select the host group that you want to use to populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the VMware vSphere connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine-based settings.</p>
</li>
<li>
<p>Click the <strong>Interface</strong> tab and click <strong>Edit</strong> on the host&#8217;s interface.</p>
</li>
<li>
<p>Verify that the fields are automatically populated with values. Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>The Satellite Server automatically assigns an IP address for the new host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank. The VMware vSphere server assigns one to the host.</p>
</li>
<li>
<p>Verify that the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options are automatically selected for the first interface on the host. If not, select them.</p>
</li>
<li>
<p>In the interface window, review the VMware vSphere-specific fields that are populated with settings from our compute profile. Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>For network-based provisioning, ensure that the <strong>Provisioning Method</strong> is set to <code>Network Based</code>. For image-based provisioning, ensure that the <strong>Provisioning Method</strong> is set to <code>Image Based</code></p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile. Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and ensure that a parameter exists that provides an activation key. If not, add an activation key.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the host from a network with the <code>hammer host create</code> command and include <code>--provision-method build</code> to use network-based provisioning.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer host create --name "vmware-test1" --organization "_My_Organization_" \
--location "New York" --hostgroup "Base" \
--compute-resource "_My_vSphere_" --provision-method build \
--build true --enabled true --managed true \
--interface "managed=true,primary=true,provision=true,compute_type=VirtualE1000,compute_network=mynetwork" \
--compute-attributes="cpus=1,corespersocket=2,memory_mb=1024,cluster=MyCluster,path=MyVMs,start=true" \
--volume="size_gb=20G,datastore=Data,name=myharddisk,thin=true"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
See <a href="#CLI_Params">Additional Host Parameters for Hammer CLI</a> for more information on additional host creation parameters for this compute resource.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the host from an image with the <code>hammer host create</code> command and include <code>--provision-method image</code> to use image-based provisioning.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create --name "vmware-test2" --organization "<em>My_Organization</em>" \
--location "New York" --hostgroup "Base" \
--compute-resource "<em>My_RHEV</em>" --provision-method image \
--image "Test RHEV Image" --enabled true --managed true \
--interface "managed=true,primary=true,provision=true,compute_type=VirtualE1000,compute_network=mynetwork" \
--compute-attributes="cpus=1,corespersocket=2,memory_mb=1024,cluster=MyCluster,path=MyVMs,start=true" \
--volume="size_gb=20G,datastore=Data,name=myharddisk,thin=true"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, see <a href="#CLI_Params">Additional Host Parameters for Hammer CLI</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Virtual_Machines_in_VMware_vSphere-Caching_of_Compute_resources">9.7. Caching of Compute Resources</h3>
<div class="paragraph">
<p>Caching of compute resources speeds up rendering of VMware information.</p>
</div>
<div class="sect3">
<h4 id="_enabling_caching_of_compute_resources">9.7.1. Enabling Caching of Compute Resources</h4>
<div class="paragraph">
<p>To enable or disable caching of compute resources:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Click the <strong>Edit</strong> button to the right of the VMware server you want to update.</p>
</li>
<li>
<p>Select the <strong>Enable caching</strong> check box.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_refreshing_the_compute_resources_cache">9.7.2. Refreshing the Compute Resources Cache</h4>
<div class="paragraph">
<p>To refresh the cache of compute resources to update compute resources information:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select a VMware server you want to refresh the compute resources cache for and click the <strong>Refresh Cache</strong> button.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Use this API call to refresh the compute resources cache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -H "Accept:application/json,version=2" \
-H "Content-Type:application/json" -X PUT \
-u <em>username</em>:<em>password</em> -k \
https://<em>satellite.example.com</em>/api/compute_resources/<em>compute_resource_id</em>/refresh_cache</pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>hammer compute-resource list</code> command to determine the ID of the VMware server you want to refresh the compute resources cache for.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Cloud_Instances_in_Red_Hat_OpenStack_Platform">10. Provisioning Cloud Instances in Red Hat OpenStack Platform</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat OpenStack Platform provides the foundation to build a private or public Infrastructure-as-a-Service (IaaS) cloud on Red Hat Enterprise Linux. It offers a massively scalable, fault-tolerant platform for the development of cloud-enabled workloads. In Red Hat Satellite 6, you can interact with Red Hat OpenStack Platforms REST API to create new cloud instances and control their power management states.</p>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Red_Hat_OpenStack_Platform-Prerequisites_for_Red_Hat_OpenStack_Platform_Provisioning">10.1. Prerequisites for Red Hat OpenStack Platform Provisioning:</h3>
<div class="paragraph">
<p>Requirements for Red Hat OpenStack Platform Provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronized content repositories for Red Hat Enterprise Linux 7. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/importing_red_hat_content#Importing_Red_Hat_Content-Synchronizing_Red_Hat_Repositories">Synchronizing Red Hat Repositories</a> in the <em>Content Management Guide</em>.</p>
</li>
<li>
<p>A Capsule Server managing a network in your OpenStack environment. For more information, see <a href="#Configuring_Networking">Configuring Networking</a>.</p>
</li>
<li>
<p>An image added to OpenStack Image Storage (glance) service for image-based provisioning. For more information, see the <a href="https://access.redhat.com/documentation/en/red-hat-openstack-platform/9/paged/instances-and-images-guide/">Red Hat OpenStack Platform Instances and Images Guide</a>.</p>
</li>
<li>
<p>An activation key for host registration. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_activation_keys#Managing_Activation_Keys-Creating_an_Activation_Key">Creating An Activation Key</a> in the <em>Content Management</em> guide.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Red_Hat_OpenStack_Platform-Adding_a_Red_Hat_OpenStack_Platform_Connection_to_the_Satellite_Server">10.2. Adding a Red Hat OpenStack Platform Connection to the Satellite Server</h3>
<div class="paragraph">
<p>Use this procedure to add the Red Hat OpenStack Platform connection in the Satellite Server&#8217;s compute resources.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add a compute resource, use the following procedure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and in the Compute Resources window, click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to identify the compute resource for future use.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>RHEL OpenStack Platform</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the resource.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter a URL to point to the OpenStack Authentication keystone service&#8217;s API at the <code>tokens</code> resource. Use the following format: <code><a href="http://openstack.example.com:5000/v2.0/tokens" class="bare">http://openstack.example.com:5000/v2.0/tokens</a></code>.</p>
</li>
<li>
<p>In the <strong>User</strong> and <strong>Password</strong> fields, enter the authentication user and password for Satellite to access the environment.</p>
</li>
<li>
<p>In the <strong>Domain</strong> field, enter the domain for V3 authentication.</p>
</li>
<li>
<p>From the <strong>Tenant</strong> list, select the tenant or project for Satellite Server to manage.</p>
</li>
<li>
<p>To use external networks as primary networks for hosts, select the <strong>Allow external network as main network</strong> check box.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> and <strong>Organizations</strong> tabs and verify that the location and organization that you want to use are set to your current context. Add any additional contexts that you want to these tabs.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the Red Hat OpenStack Platform connection.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the connection with the <code>hammer compute-resource create</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create --name "<em>My_OpenStack</em>" \
--provider "OpenStack" \
--description "My OpenStack environment at <em>openstack.example.com</em>" \
--url "<em>http://openstack.example.com</em>:5000/v2.0/tokens" --user "<em>My_Username</em>" \
--password "<em>My_Password</em>" --tenant "openstack" --locations "New York" \
--organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Red_Hat_OpenStack_Platform-Adding_Red_Hat_OpenStack_Platform_Images_on_the_Satellite_Server">10.3. Adding Red Hat OpenStack Platform Images to the Satellite Server</h3>
<div class="paragraph">
<p>Red Hat OpenStack Platform uses image-based provisioning to create new hosts. You must add image details to your Satellite Server. This includes access details and image location.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add Red Hat OpenStack Platform images, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and in the Computer Resources window, click the name of a Red Hat OpenStack Platform connection.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name that describes the image.</p>
</li>
<li>
<p>From the <strong>Operatingsystem</strong> list, select the image&#8217;s base operating system.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>User</strong> field, enter the SSH user name for image access. This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image in OpenStack Image Storage.</p>
</li>
<li>
<p>From the <strong>User data</strong> list, select whether you want to set if images support user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the image with the <code>hammer compute-resource image create</code> command. Use the <code>--uuid</code> field to store the full path of the image location on the Red Hat OpenStack Platform server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create --name "Test OpenStack Image" \
--operatingsystem "RedHat 7.2" --architecture "x86_64" \
--user root --user-data true \
--compute-resource "<em>My_OpenStack_Platform</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Red_Hat_OpenStack_Platform-Adding_Red_Hat_OpenStack_Platform_Details_to_a_Compute_Profile">10.4. Adding Red Hat OpenStack Platform Details to a Compute Profile</h3>
<div class="paragraph">
<p>In Satellite, you can define certain hardware settings for instances on Red Hat OpenStack Platform. You can add these hardware settings to a compute profile.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add Red Hat OpenStack Platform details to a compute profile, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong> and in the Compute Profiles window, click the name of the profile you want to use.</p>
</li>
<li>
<p>From the <strong>Flavor</strong> list, select the hardware profile on OpenStack Platform to use for the host.</p>
</li>
<li>
<p>From the <strong>Availability zone</strong> list, selec the target cluster to use within the OpenStack Platform environment.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use for image-based provisioning.</p>
</li>
<li>
<p>From the <strong>Tenant</strong> list, select the tenant or project for the OpenStack Platform instance.</p>
</li>
<li>
<p>From the <strong>Security Group</strong> list, select the cloud-based access rules for ports and IP addresses.</p>
</li>
<li>
<p>From the <strong>Internal network</strong>, select the private networks for the host to join.</p>
</li>
<li>
<p>From the <strong>Floating IP network</strong>, select the external networks for the host to join and assign a floating IP address.</p>
</li>
<li>
<p>From the <strong>Boot from volume</strong>, select whether a volume is created from the image. If not selected, the instance boots the image directly.</p>
</li>
<li>
<p>In the <strong>New boot volume size (GB)</strong> field, enter the size, in GB, of the new boot volume.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>The compute profile CLI commands are not yet implemented in Red Hat Satellite 6.4. As an alternative, you can include the same settings directly during the host creation process.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Red_Hat_OpenStack_Platform-Creating_Image_Based_Hosts_on_Red_Hat_OpenStack_Platform">10.5. Creating Image-Based Hosts on Red Hat OpenStack Platform</h3>
<div class="paragraph">
<p>In Satellite, you can provision Red Hat OpenStack Platform hosts from existing images on the Red Hat OpenStack Platform server.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To provision a host, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>New Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name that you want to assign to the provisioned system&#8217;s host.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, you can select a host group to populate the host fields.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> lits, select the OpenStack Platform connection.</p>
</li>
<li>
<p>From the <strong>Compute profile</strong> list, select a profile to use to automatically populate cloud instance-based settings.</p>
</li>
<li>
<p>Click the <strong>Interface</strong> tab, and click <strong>Edit</strong> on the host&#8217;s interface. Verify that the <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>, and that the Satellite Server automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank. The Red Hat OpenStack Platform server assigns a MAC address to the host.</p>
</li>
<li>
<p>Verify that Satellite Server automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host. If not, select them.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that each aspect of the operating system is populated.</p>
</li>
<li>
<p>If you want to change the image that populates automatically from your compute profile, from the <strong>Images</strong> list, select a different image to base the new host&#8217;s root volume.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning Templates</strong> to verify that the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab, and verify that the settings are populated with details from the host groups and compute profile. Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and ensure that a parameter exists that provides an activation key. If not, add an activation key.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This new host entry triggers the Red Hat OpenStack Platform server to create the instance, using the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the host with the <code>hammer host create</code> command and include the <code>--provision-method image</code> option to use image-based provisioning.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create --name "openstack-test1" --organization "<em>My_Organization</em>" \
--location "New York" --hostgroup "<em>Example_Hostgroup</em>" \
--compute-resource "<em>My_OpenStack_Platform</em>" --provision-method image \
--image "Test OpenStack Image" --enabled true --managed true \
--interface "managed=true,primary=true,provision=true" \
--compute-attributes="flavor_ref=m1.small,tenant_id=openstack,security_groups=default,network=mynetwork"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, see <a href="#CLI_Params">Additional Host Parameters for Hammer CLI</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Cloud_Instances_in_Amazon_EC2">11. Provisioning Cloud Instances in Amazon EC2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Amazon Elastic Compute Cloud (Amazon EC2) is a web service that provides public cloud compute resources. Using Red&#160;Hat Satellite 6, you can interact with Amazon EC2&#8217;s public API to create cloud instances and control their power management states. Use the procedures in this chapter to add a connection to an Amazon EC2 account and provision a cloud instance.</p>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Amazon_EC2-Prerequisites_for_Amazon_EC2_Provisioning">11.1. Prerequisites for Amazon EC2 Provisioning</h3>
<div class="paragraph">
<p>The requirements for Amazon EC2 provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronized content repositories for Red&#160;Hat Enterprise Linux 7. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/importing_red_hat_content#Importing_Red_Hat_Content-Synchronizing_Red_Hat_Repositories">Synchronizing Red&#160;Hat Repositories</a> in the <em>Content Management Guide</em>.</p>
</li>
<li>
<p>A Capsule Server managing a network in your EC2 environment. Use a Virtual Private Cloud (VPC) to ensure a secure network between the hosts and the Capsule Server.</p>
</li>
<li>
<p>An Amazon Machine Image (AMI) for image-based provisioning.</p>
</li>
<li>
<p>An activation key for host registration. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_activation_keys#Managing_Activation_Keys-Creating_an_Activation_Key">Creating An Activation Key</a> in the <em>Content Management</em> guide.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Amazon_EC2-Adding_a_Amazon_EC2_Connection_to_the_Satellite_Server">11.2. Adding an Amazon EC2 Connection to the Satellite Server</h3>
<div class="paragraph">
<p>Use this procedure to add the Amazon EC2 connection in the Satellite Server&#8217;s compute resources.</p>
</div>
<div class="paragraph">
<div class="title">Time Settings and Amazon Web Services</div>
<p>Amazon Web Services uses time settings as part of the authentication process. Ensure that Satellite Server&#8217;s time is correctly synchronized. Ensure that an NTP service, such as <code>ntpd</code> or <code>chronyd</code>, is running properly on the Satellite Server. Failure to provide the correct time to Amazon Web Services can lead to authentication failures. For more information about synchronizing time in Satellite, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/installing_satellite_server_from_a_connected_network/installing_satellite_server#synchronizing_time">Synchronizing Time</a> in <em>Installing Satellite Server from a Connected Network</em>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add an Amazon EC2 connection, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and in the Compute Resources window, click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to identify the Amazon EC2 compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>EC2</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter information that helps distinguish the resource for future use.</p>
</li>
<li>
<p>From the <strong>HTTP proxy</strong> list, select a HTTP proxy to connect to external API services. You must add HTTP proxies to Satellite before you can select a proxy from this list. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/installing_satellite_server_from_a_connected_network/performing_additional_configuration_on_satellite_server#configuring_satellite_http_proxy">Configuring Satellite Server with HTTP Proxy</a> in <em>Installing Satellite Server from a Connected Network</em>.</p>
</li>
<li>
<p>In the <strong>Access Key</strong> and <strong>Secret Key</strong> fields, enter the access keys for your Amazon EC2 account. For more information, see <a href="http://docs.aws.amazon.com/general/latest/gr/managing-aws-access-keys.html">Managing Access Keys for your AWS Account</a> on the Amazon documentation website.</p>
</li>
<li>
<p>Click the <strong>Load Regions</strong> button to populate the <strong>Regions</strong> list.</p>
</li>
<li>
<p>From the <strong>Region</strong> list, select the Amazon EC2 region or data center to use.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and ensure that the location you want to use is selected, or add a different location.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and ensure that the organization you want to use is selected, or add a different organization.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the Amazon EC2 connection.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the connection with the <code>hammer compute-resource create</code> command. Use <code>--user</code> and <code>--password</code> options to add the access key and secret key respectively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create --name "<em>My_EC2</em>" --provider "EC2" \
--description "Amazon EC2 Public Cloud` --user "<em>user_name</em>" \
--password "<em>secret_key</em>" --region "us-east-1" --locations "New York" \
--organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Amazon_EC2-Using-an-HTTP-Smart-Proxy">11.3. Using an HTTP Smart Proxy with Compute Resources</h3>
<div class="paragraph">
<p>In some cases, the EC2 compute resource that you use might require a specific HTTP proxy to communicate with Satellite. In Satellite, you can create an HTTP proxy entry and then assign the proxy to your EC2 compute resource.</p>
</div>
<div class="paragraph">
<p>However, if you configure a proxy for Satellite in <strong>Administer</strong> &gt; <strong>Settings</strong>, and then add a proxy for your compute resource, the proxy that you define in <strong>Administer</strong> &gt; <strong>Settings</strong> takes precedence.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add an HTTP proxy that you can assign to a compute resource, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>HTTP Capsules</strong>, and select <strong>New HTTP Proxy</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the proxy.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the URL for the proxy, including the port number.</p>
</li>
<li>
<p>Optional: Enter a username and password to authenticate to the proxy, if your proxy requires authentication.</p>
</li>
<li>
<p>Click <strong>Test Connection</strong> to ensure that you can connect to the proxy from Satellite.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add a location.</p>
</li>
<li>
<p>Click the <strong>Organization</strong> tab and add an organization.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Amazon_EC2-Adding_Amazon_EC2_Images_on_the_Satellite_Server">11.4. Adding Amazon EC2 Images to Satellite Server</h3>
<div class="paragraph">
<p>Amazon EC2 uses image-based provisioning to create hosts. You must add image details to your Satellite Server. This includes access details and image location.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and select an Amazon EC2 connection.</p>
</li>
<li>
<p>Click the <strong>Images</strong> tab, and then click <strong>New Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to identify the image for future use.</p>
</li>
<li>
<p>From the <strong>Operatingsystem</strong> list, select the operating system that corresponds with the image you want to add.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system&#8217;s architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access. This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>In the <strong>Image ID</strong> field, enter the Amazon Machine Image (AMI) ID for the image. This is usually in the following format: <code>ami-xxxxxxxx</code>.</p>
</li>
<li>
<p>From the <strong>User data</strong> list, select whether the images support user data input, such as <code>cloud-init</code> data. If you enable user data, the Finish scripts are automatically disabled. This also applies in reverse: if you enable the Finish scripts, this disables user data.</p>
</li>
<li>
<p>From the <strong>IAM role</strong> list, select the Amazon security role used for creating the image.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the image with the <code>hammer compute-resource image create</code> command. Use the <code>--uuid</code> field to store the full path of the image location on the Amazon EC2 server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource image create --name "Test Amazon EC2 Image" \
--operatingsystem "RedHat 7.2" --architecture "x86_64" --username root \
--user-data true --uuid "ami-<em>my_ami_id</em>" --compute-resource "<em>My_EC2</em>"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Amazon_EC2-Adding_Amazon_EC2_Details_to_a_Compute_Profile">11.5. Adding Amazon EC2 Details to a Compute Profile</h3>
<div class="paragraph">
<p>You can add hardware settings for instances on Amazon EC2 to a compute profile.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add hardware settings, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong> and click the name of your profile, then click an EC2 connection.</p>
</li>
<li>
<p>From the <strong>Flavor</strong> list, select the hardware profile on EC2 to use for the host.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use for image-based provisioning.</p>
</li>
<li>
<p>From the <strong>Availability zone</strong> list, select the target cluster to use within the chosen EC2 region.</p>
</li>
<li>
<p>From the <strong>Subnet</strong> list, add the subnet for the EC2 instance. If you have a VPC for provisioning new hosts, use its subnet.</p>
</li>
<li>
<p>From the <strong>Security Groups</strong> list, select the cloud-based access rules for ports and IP addresses to apply to the host.</p>
</li>
<li>
<p>From the <strong>Managed IP</strong> list, select either a <code>Public</code> IP or a <code>Private</code> IP.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>The compute profile CLI commands are not yet implemented in Red&#160;Hat Satellite 6.4. As an alternative, you can include the same settings directly during the host creation process.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Cloud_Instances_in_Amazon_EC2-Creating_Image_Based_Hosts_on_Amazon_EC2">11.6. Creating Image-Based Hosts on Amazon EC2</h3>
<div class="paragraph">
<p>The Amazon EC2 provisioning process creates hosts from existing images on the Amazon EC2 server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Hosts</strong> &gt; <strong>New Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, you can select a host group to populate most of the new host&#8217;s fields.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the EC2 connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine-based settings.</p>
</li>
<li>
<p>Click the <strong>Interface</strong> tab, and then click <strong>Edit</strong> on the host&#8217;s interface, and verify that the fields are populated with values. Leave the <strong>Mac Address</strong> field blank. The Satellite Server automatically selects and IP address and the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab and confirm that all fields are populated with values.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that all fields are populated with values.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab, and ensure that a parameter exists that provides an activation key. If not, add an activation key.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This new host entry triggers the Amazon EC2 server to create the instance, using the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code> to use image-based provisioning.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer host create --name "ec2-test1" --organization "<em>My_Organization</em>" \
--location "New York" --hostgroup "Base" \
--compute-resource "<em>My_EC2</em>" --provision-method image \
--image "Test Amazon EC2 Image" --enabled true --managed true \
--interface "managed=true,primary=true,provision=true,subnet_id=EC2" \
--compute-attributes="flavor_id=m1.small,image_id=TestImage,availability_zones=us-east-1a,security_group_ids=Default,managed_ip=Public"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about host creation parameters for this compute resource, see <a href="#CLI_Params">Additional Host Parameters for Hammer CLI</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_to_an_amazon_ec2_instance_using_ssh">11.7. Connecting to an Amazon EC2 instance using SSH</h3>
<div class="paragraph">
<p>You can connect remotely to an Amazon EC2 instance from Satellite Server using SSH. However, to connect to any Amazon Web Services EC2 instance that you provision through Red&#160;Hat Satellite, you must first access the private key that is associated with the compute resource in the Foreman database, and use this key for authentication.</p>
</div>
<div class="paragraph">
<p>To locate the private key and connect to an Amazon EC2 server using SSH, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To locate the compute resource list, on your Satellite Server base system, enter the following command, and note the ID of the compute resource that you want to use:</p>
<div class="listingblock">
<div class="content">
<pre># hammer compute-resource list</pre>
</div>
</div>
</li>
<li>
<p>Switch user to the <code>postgres</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su - postgres</pre>
</div>
</div>
</li>
<li>
<p>Initiate the <code>postgres</code> shell:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ psql</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Foreman database as the user <code>postgres</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># postgres=# \c foreman</pre>
</div>
</div>
</li>
<li>
<p>Select the secret from <code>key_pairs</code> where <code>compute_resource_id = 3</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># select secret from key_pairs where compute_resource_id = 3; secret</pre>
</div>
</div>
</li>
<li>
<p>Copy the key from after <code>-----BEGIN RSA PRIVATE KEY-----</code> until <code>-----END RSA PRIVATE KEY-----</code>.</p>
</li>
<li>
<p>Create a <code>.pem</code> file and paste your key into the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vim <em>Keyname</em>.pem</pre>
</div>
</div>
</li>
<li>
<p>Ensure that you restrict access to the <code>.pem</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 600 <em>Keyname</em>.pem</pre>
</div>
</div>
</li>
<li>
<p>To connect to the Amazon EC2 instance, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ssh -i <em>Keyname</em>.pem   ec2-user@<em>example.aws.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_a_finish_template_for_an_amazon_web_service_ec2_environment">11.8. Configuring a Finish Template for an Amazon Web Service EC2 Environment</h3>
<div class="paragraph">
<p>You can use Red&#160;Hat Satellite finish templates during the provisioning of Red&#160;Hat Enterprise Linux instances in an Amazon EC2 environment.</p>
</div>
<div class="paragraph">
<p>To configure a finish template for Amazon EC2, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Red&#160;Hat Satellite 6 web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>In the <strong>Provisioning Templates</strong> page, enter <code>Kickstart default finish</code> into the search field and click <strong>Search</strong>.</p>
</li>
<li>
<p>On the <strong>Kickstart default finish</strong> template, select <strong>Clone</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a unique name for the template.</p>
</li>
<li>
<p>In the template, prefix each command that requires root privileges with <code>sudo</code>, except for <code>subscription-manager register</code> and <code>yum</code> commands, or add the following line to run the entire template as the sudo user:</p>
<div class="listingblock">
<div class="content">
<pre>sudo -s &lt;&lt; EOS
_Template_ _Body_
EOS</pre>
</div>
</div>
</li>
<li>
<p>Click the <strong>Association</strong> tab, and associate the template with a Red&#160;Hat Enterprise Linux operating system that you want to use.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and add the the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and add the organization that the host belongs to.</p>
</li>
<li>
<p>Make any additional customizations or changes that you require, then click <strong>Submit</strong> to save your template.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and select the operating system that you want for your host.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab, and from the <strong>Finish Template</strong> list, select your finish template.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong> and enter the information about the host that you want to create.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and navigate to <strong>Host parameters</strong>.</p>
</li>
<li>
<p>In <strong>Host parameters</strong>, click the <strong>Add Parameter</strong> button three times to add three new parameter fields. Add the following three parameters:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter <code>remote_execution_ssh_keys</code>. In the corresponding <strong>Value</strong> field, enter the output of <code>cat /usr/share/foreman/.ssh/id_rsa_foreman_proxy.pub</code>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter <code>remote_execution_ssh_user</code>. In the corresponding <strong>Value</strong> field, enter <code>ec2-user</code>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter <code>activation_keys</code>. In the corresponding <strong>Value</strong> field, enter your activation key.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_more_information_about_amazon_web_services_and_satellite">11.9. More Information about Amazon Web Services and Satellite</h3>
<div class="paragraph">
<p>For information about how to locate Red&#160;Hat Gold Images on Amazon Web Services EC2, see <a href="https://access.redhat.com/articles/2962171">How to Locate Red&#160;Hat Cloud Access Gold Images on AWS EC2</a>.</p>
</div>
<div class="paragraph">
<p>For information about how to install and use the Amazon Web Service Client on Linux, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/awscli-install-linux.html">Install the AWS Command Line Interface on Linux</a> in the Amazon Web Services documentation.</p>
</div>
<div class="paragraph">
<p>For information about importing and exporting virtual machines in Amazon Web Services, see <a href="https://aws.amazon.com/ec2/vm-import/">VM Import/Export</a> in the Amazon Web Services documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Containers">12. Provisioning Containers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With Red Hat Satellite 6, you can create an on-premise registry, import images from various sources and distribute them to containers using Content Views. Satellite Server supports creating one or more Docker compute resources that act as servers for running containers.</p>
</div>
<div class="paragraph">
<p>You can import an image, start a container based on this image, monitor the container&#8217;s activity, and commit its state to a new image layer that can be further propagated.</p>
</div>
<div class="paragraph">
<p>For information about containers, see the <a href="https://access.redhat.com/documentation/en/red-hat-enterprise-linux-atomic-host/7/getting-started-with-containers/getting-started-with-containers">Getting Started with Containers</a> guide for <em>Red Hat Enterprise Linux Atomic Host 7</em>.</p>
</div>
<div class="paragraph">
<p>Use this chapter to import container images and use these images to create containers.</p>
</div>
<div class="sect2">
<h3 id="Provisioning_Containers-Prerequisites_for_Container_Provisioning">12.1. Prerequisites for Container Provisioning</h3>
<div class="paragraph">
<p>Before you can provision a container using Red Hat Enterprise Linux Atomic Host, you must have a source for images, such as a container registry.</p>
</div>
<div class="paragraph">
<p>Red Hat Satellite 6 uses three sources of container images:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronized Docker-formatted container images that are a part of the Satellite Server&#8217;s application life cycle.</p>
</li>
<li>
<p>Public images from Docker Hub.</p>
</li>
<li>
<p>Other External registries, including Red Hat&#8217;s container image registry. This is explored in <a href="#Provisioning_Containers-Adding_External_Registries_to_the_Satellite_Server">Adding External Registries to the Satellite Server</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Importing_Container_Images">12.2. Importing Container Images</h3>
<div class="paragraph">
<p>You can import container image repositories from the Red Hat Container Catalog or from other image registries that you connect to Satellite.</p>
</div>
<div class="paragraph">
<p>This procedure uses repository discovery to find container image repositories to import. For information about creating a product and repository manually, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/importing_custom_content#Importing_Custom_Content-Creating_a_Custom_Product">Creating a Custom Product</a> in the <em>Content Management Guide</em>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To import container image repositories and create or associate them with a product, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Content</strong> &gt; <strong>Products</strong> and click <strong>Repo Discovery</strong>.</p>
</li>
<li>
<p>From the <strong>Repository Type</strong> list, select <strong>Container Images</strong>.</p>
</li>
<li>
<p>In the <strong>Registry to Discover</strong> field, enter the URL of the registry to import images from.</p>
</li>
<li>
<p>In the <strong>Registry Username</strong> field, enter the name that corresponds with your user name for the container image registry.</p>
</li>
<li>
<p>In the <strong>Registry Password</strong> field, enter the password that corresponds with the user name that you enter.</p>
</li>
<li>
<p>In the <strong>Registry Search Parameter</strong> field, enter any search criteria that you want to use to filter your search, and then click <strong>Discover</strong>.</p>
</li>
<li>
<p>Optional: To further refine the <strong>Discovered Repository</strong> list, in the <strong>Filter</strong> field, enter any additional search criteria that you want to use.</p>
</li>
<li>
<p>From the <strong>Discovered Repository</strong> list, select any repositories that you want to import, and then click <strong>Create Selected</strong>.</p>
</li>
<li>
<p>Optional: If you want to create a product, from the <strong>Product</strong> list, select <strong>New Product</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a product name.</p>
</li>
<li>
<p>Optional: In the <strong>Repository Name</strong> and <strong>Repository Label</strong> columns, you can edit the repository names and labels.</p>
</li>
<li>
<p>Click <strong>Run Repository Creation</strong>.</p>
</li>
<li>
<p>When repository creation is complete, you can click each new repository to view more information.</p>
</li>
<li>
<p>Optional: To filter the content you import to a repository, click a repository, and then navigate to <strong>Limit Sync Tags</strong>. Click to edit, and add any tags that you want to limit the content that synchronizes to Satellite.</p>
</li>
<li>
<p>Navigate to <strong>Content</strong> &gt; <strong>Products</strong>  and select the name of your product.</p>
</li>
<li>
<p>Select the new repositories and then click <strong>Sync Now</strong> to start the synchronization process.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To view the progress of the synchronization navigate to <strong>Content</strong> &gt; <strong>Sync Status</strong> and expand the repository tree.</p>
</div>
<div class="paragraph">
<p>When the synchronization completes, you can click <strong>Manage Docker Manifests</strong> to list the available manifests. From the list, you can also remove any manifests that you do not require.</p>
</div>
<div class="olist arabic">
<div class="title">For CLI Users</div>
<ol class="arabic">
<li>
<p>Create the custom <code>Red Hat Container Catalog</code> product:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer product create \
--name "Red Hat Container Catalog" \
--sync-plan "Example Plan" \
--description "Red Hat Container Catalog content" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
<li>
<p>Create the repository for the container images:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer repository create \
--name "RHEL7" \
--content-type "docker" \
--url "http://registry.access.redhat.com/" \
--docker-upstream-name "rhel7" \
--product "Red Hat Container Catalog" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
<li>
<p>Synchronize the repository:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer repository synchronize \
--name "RHEL7" \
--product "Red Hat Container Catalog" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Containers-Adding_External_Registries_to_the_Satellite_Server">12.3. Adding External Registries to the Satellite Server</h3>
<div class="paragraph">
<p>If you want to create a container from an image in an external registry, you must first add the registry to Satellite.</p>
</div>
<div class="paragraph">
<p>To add an external container registry, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Containers</strong> &gt; <strong>Registries</strong> and click <strong>Create Registry</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the registry.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the location of the registry. For example: <code><a href="https://registry.access.redhat.com" class="bare">https://registry.access.redhat.com</a></code>.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, enter a description for your registry entry.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the user name that corresponds with your user account on the registry.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the password for your user account on your registry.</p>
</li>
<li>
<p>Select the <strong>Locations</strong> tab, and select a location.</p>
</li>
<li>
<p>Select the <strong>Organizations</strong> tab, and select an organization.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the external registry.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the registry with the <code>hammer docker registry create</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer docker registry create --name "Red Hat" \
--url "https://registry.access.redhat.com" \
--description "Red Hat Container Image Registry" \
--organization "Default_Organization" \
--location "Default_Location"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Managing_Container_Names">12.4. Managing Container Name Patterns</h3>
<div class="paragraph">
<p>When you use Satellite to create and manage your containers, as the container moves through Content View versions and different stages of the Satellite lifecycle environment, the container name changes at each stage. For example, if you synchronize a container image with the name <code>ssh</code> from an upstream repository, when you add it to a Satellite product and organization and then publish as part of a Content View, the container image can have the following name: <code>my_organization_production-custom_spin-my_product-custom_ssh</code>. This can create problems when you want to pull a container image because container registries can contain only one instance of a container name. To avoid problems with Satellite&#8217;s naming conventions, you can set a registry name pattern to override the default name to ensure that your container name is clear for future use.</p>
</div>
<div class="paragraph">
<div class="title">Limitations</div>
<p>If you use a registry name pattern to manage container naming conventions, because registry naming patterns must generate globally unique names, you might experience naming conflict problems. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you set the <code>repository.docker_upstream_name</code> registry name pattern, you cannot publish or promote Content Views with container content with identical repository names to the <code>Production</code> lifecycle.</p>
</li>
<li>
<p>If you set the <code>lifecycle_environment.name</code> registry name pattern, this can prevent the creation of a second container repository with the identical name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You must proceed with caution when defining registry naming patterns for your containers.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To manage container naming with a registry name pattern, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Content</strong> &gt; <strong>Lifecycle Environments</strong>, and either create a lifecycle environment or select a lifecycle environment to edit.</p>
</li>
<li>
<p>In the <strong>Container Image Registry</strong> area, click the edit icon to the right of <strong>Registry Name Pattern</strong> area.</p>
</li>
<li>
<p>Use the list of variables and examples to determine which registry name pattern you require.</p>
</li>
<li>
<p>In the <strong>Registry Name Pattern</strong> field, enter the registry name pattern that you want to use. For example, to use the <code>repository.docker_upstream_name</code>:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%= repository.docker_upstream_name %&gt;</pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The container repositories update immediately and you can use <code>docker pull</code> to pull your container image with the name you specify.</p>
</div>
</div>
<div class="sect2">
<h3 id="Managing_Container_Images_with_Content_Views">12.5. Managing Container Images in Satellite</h3>
<div class="paragraph">
<p>To manage container images with Content Views, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Content</strong> &gt; <strong>Content Views</strong> and click <strong>Create New View</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter <code>Containers</code>. This automatically populates the <strong>Label</strong> field.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description. For example, <code>Container image for Red Hat Enterprise Linux 7</code>.</p>
</li>
<li>
<p>If you want to use a Composite Content View to hold other Content Views, select the <strong>Composite View</strong> check box.</p>
</li>
<li>
<p>Optional: If you select <strong>Composite Content View</strong>, you can select whether you want to Auto publish a composite view when a new version of a component Content View is created.</p>
</li>
<li>
<p>Click <strong>Save</strong> to create the Content View.</p>
</li>
<li>
<p>Navigate to the <strong>Docker Content</strong> subtab, then click <strong>Add</strong>.</p>
</li>
<li>
<p>Select the container repository for a Red Hat Enterprise Linux 7 Server image.</p>
</li>
<li>
<p>Click <strong>Add Repository</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Versions</strong> and click <strong>Publish New Version</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can enter a <strong>Description</strong> for the version; meaningful descriptions can help in logging new content versions.</p>
</div>
<div class="paragraph">
<p>Satellite Server creates the new version of the view and publishes it to the Library environment.</p>
</div>
<div class="paragraph">
<p>You can also click <strong>Promote</strong> to promote this Content View across environments in the application life cycle.</p>
</div>
<div class="olist arabic">
<div class="title">For CLI Users</div>
<ol class="arabic">
<li>
<p>To obtain a list of repository IDs:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer repository list --organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
<li>
<p>Create the Content View and add the repository:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer content-view create \
--name "Containers" \
--description "Container image for Red Hat Enterprise Linux 7" \
--repository-ids 8 \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
<li>
<p>Publish the view:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer content-view publish \
--name "Containers" \
--description "Initial Content View for our container image" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Containers-Configuring_the_Red_Hat_Enterprise_Linux_Atomic_Host">12.6. Configuring the Red Hat Enterprise Linux Atomic Host</h3>
<div class="paragraph">
<p>Configure the Atomic Host before connecting to Satellite. This includes exposing the Red Hat API for Docker-formatted containers to the Satellite Server. For information about containers, see the <a href="https://access.redhat.com/documentation/en/red-hat-enterprise-linux-atomic-host/7/getting-started-with-containers/getting-started-with-containers">Getting Started with Containers</a> guide for <em>Red Hat Enterprise Linux Atomic Host 7</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log on to the Atomic Host and edit the <code>/etc/sysconfig/docker</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ vi /etc/sysconfig/docker</pre>
</div>
</div>
</li>
<li>
<p>Find the <code>OPTIONS</code> parameter and modify it to expose the API:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">OPTIONS='--selinux-enabled -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375'</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Use either TCP port 2375 or 2376 for the connection. Satellite Server contains certain SELinux rules to permit access to these ports. Using an alternative port results in authentication failure.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Open port 2375 for the firewall:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port=2375/tcp
# firewall-cmd --add-port=2375/tcp --permanent</pre>
</div>
</div>
</li>
<li>
<p>Import the Satellite Server certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ curl http://satellite.example.com/pub/katello-server-ca.crt \
-o /etc/pki/ca-trust/source/anchors/katello-server-ca.crt
$ update-ca-trust</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>docker</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart docker</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Containers-Adding_an_Atomic_Host_Connection_to_the_Satellite_Server">12.7. Adding an Atomic Host Connection to the Satellite Server</h3>
<div class="paragraph">
<p>To add an Red Hat Enterprise Linux Atomic connection in the Satellite Server&#8217;s compute resources, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>Docker</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, you can add a description for the resource.</p>
</li>
<li>
<p>Select the <strong>Locations</strong> tab, and select the location that you want to use.</p>
</li>
<li>
<p>Select the <strong>Organizations</strong> tab, and select the organization that you want to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>Create the connection with the <code>hammer compute-resource create</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hammer compute-resource create --provider docker \
--name "Atomic" --url "http://atomic.example.com:2375" \
--organizations 'Default Organization' --locations 'Default Location'</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Containers-Creating_Containers_with_the_Satellite_Server">12.8. Creating a Container</h3>
<div class="paragraph">
<p>Use this procedure to create a container in Satellite. The Satellite web UI contains a wizard that guides you through the creation process. You can select a container image from a Content View, a Docker Hub, or an external registry that you add to Satellite.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Containers</strong> &gt; <strong>Create Container</strong>.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the compute resource that you want to use.</p>
</li>
<li>
<p>Select the <strong>Locations</strong> tab, and select a location.</p>
</li>
<li>
<p>Select the <strong>Organizations</strong> tab, and select an organization.</p>
</li>
<li>
<p>Click <strong>Next step</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To create a container, you have three options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create from a container image in Content View</p>
</li>
<li>
<p>Create from an container image in the Docker Hub</p>
</li>
<li>
<p>Create from an container image in an external registry.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Creating a Container from a Content View</div>
<ol class="arabic">
<li>
<p>From the <strong>Lifecycle Environment</strong> list, select the lifecycle environment that you want to use.</p>
</li>
<li>
<p>From the <strong>Content View</strong> list, select the container image that you want to use.</p>
</li>
<li>
<p>From the <strong>Registry</strong> list, select the registry that you want to use.</p>
</li>
<li>
<p>From the <strong>Tag</strong> list, select the container image tag that you want to use.</p>
</li>
<li>
<p>From the <strong>Capsule</strong> list, select the Capsule that you want to use.</p>
</li>
<li>
<p>Click <strong>Next Step</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Creating a Container from Docker Hub</div>
<ol class="arabic">
<li>
<p>Select the <strong>Docker Hub</strong> tab, and in the <strong>Search</strong> field, enter the Docker container that you want to use.</p>
</li>
<li>
<p>In the <strong>Tag</strong> field, enter the name of the container image tag that you want to use, and click <strong>Search for images</strong>.</p>
</li>
<li>
<p>Select the container image that you want to use, and click <strong>Next Step</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Creating a Container from an External Registry</div>
<ol class="arabic">
<li>
<p>From the <strong>Registry</strong> list, select a registry that you want to use.</p>
</li>
<li>
<p>In the <strong>Search</strong> field, enter the name of the container image that you want to use.</p>
</li>
<li>
<p>In the <strong>Tag</strong> field, enter the tag that is associated with the container image you want to use.</p>
</li>
<li>
<p>Click <strong>Search for images</strong> and select the image that you want to use, and click <strong>Next step</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Finishing the Container Creation Process</div>
<ol class="arabic">
<li>
<p>In the <strong>Name</strong> field, enter a name for the new container.</p>
</li>
<li>
<p>In the <strong>Command</strong> field, enter a command that you want to run in the container.</p>
</li>
<li>
<p>In the <strong>Entry point</strong> field, enter a command that you want the container to execute automatically when the container starts. The default entrypoint is <code>/bin/sh -c</code>.</p>
</li>
<li>
<p>Select the <strong>Compute options</strong> tab.</p>
</li>
<li>
<p>In the <strong>CPU Sets</strong> field, assign CPUs to the container. For example, 0-2,16 represents CPUs 0, 1, 2, and 16.</p>
</li>
<li>
<p>In the <strong>CPU share</strong> field, assign the CPU share for the container. This sets the share of CPU time available to containerized tasks.</p>
</li>
<li>
<p>In the <strong>Memory</strong> field, enter the memory size that you want to allocate to the container.</p>
</li>
<li>
<p>Click <strong>Next Step</strong>.</p>
</li>
<li>
<p>In the <strong>Environment variables</strong> field, define a set of environmental variables. For example, <code>LANG=en_US.UTF-8</code>.</p>
</li>
<li>
<p>In the <strong>Exposed Ports</strong> field, enter the number of ports that you want to open in the container. For example, you can open SSH communication to the container on port 22.</p>
</li>
<li>
<p>In the <strong>DNS</strong> field, enter the DNS server for the container.</p>
</li>
<li>
<p>Select the <strong>Run</strong> check box to start the container automatically after it is created.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to create a container.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">For CLI Users</div>
<p>The following are three examples of the <code>hammer docker container create</code> command.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To create a container from a Content View:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer docker container create --compute-resource "Atomic" \
--repository-name "rhel7" --tag "latest" --name "docker-test1" \
--command "bash" --organizations "<em>My_Organization</em>" --locations "New York"</pre>
</div>
</div>
</li>
<li>
<p>To provision from the Docker Hub:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer docker container create --compute-resource "Atomic" \
--repository-name "docker.io/redhat" --tag latest \
--name "docker-test2" --command bash --organizations "<em>My_Organization</em>" \
--locations "New York"</pre>
</div>
</div>
</li>
<li>
<p>To provision from an external registry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer docker container create --compute-resource "Atomic" \
--registry-id 1 --repository-name "rhel" --tag latest \
--name "docker-test3 --command bash --organizations "<em>My_Organization</em>" \
--locations "New York"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Managing_Container_Authentication">12.9. Managing Container Registry Authentication</h3>
<div class="paragraph">
<p>By default, users must authenticate to access containers in the Satellite image registry. Use the <code>docker login</code> command to log on to Satellite. You can then use the <code>docker pull</code> and <code>docker search</code> commands to access containers based on your Satellite permissions.</p>
</div>
<div class="paragraph">
<p>You can specify whether you want users to authenticate to access container images in a Satellite image registry that you manage in a lifecycle environment. For example, you might want to permit users to pull container images from the <code>Production</code> lifecycle without any authentication requirement and restrict access the <code>Development</code> and <code>QA</code> environments to authenticated users.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To manage the authentication settings for your Satellite image registry, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Content</strong> &gt; <strong>Lifecycle Environments</strong> and select the lifecycle environment that you want to manage authentication for.</p>
</li>
<li>
<p>To permit unauthenticated access to the containers in this lifecycle environment, select the <strong>Unauthenticated Pull</strong> check box. To restrict unauthenticated access, clear the <strong>Unauthenticated Pull</strong> check box.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Containers-Working-with-containers">12.10. Starting, Committing, and Removing Containers</h3>
<div class="paragraph">
<div class="title">Starting or Stopping a Container</div>
<p>When you create a container, its default state is disabled. By enabling a container, you start the processes of the containerized application in the compute resource. Hosts are then able to communicate with the container as with a web application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Containers</strong> &gt; <strong>All Containers</strong>.</p>
</li>
<li>
<p>From the list of existing containers, select the container that you want, and then click <strong>Power On</strong>. To stop the container, click <strong>Power Off</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Committing a Container</div>
<p>When you launch a container from an image, a writable layer is added on top of this image. Committing a container creates an image layer that stores the status of that container.  Every time you commit a container a new image layer is added to store your changes.  The container is committed to the repository of the original image. For example, if the container is based on an image pulled from the Docker Hub, the committed changes are pushed back to the Docker Hub.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Containers</strong> &gt; <strong>All Containers</strong>.</p>
</li>
<li>
<p>From the list of existing containers, select the container that you want, and then click <strong>Commit</strong>.</p>
</li>
<li>
<p>Enter a repository name, for example <code>user/my-rhel-image</code>.</p>
</li>
<li>
<p>Assign a tag to the image.</p>
</li>
<li>
<p>Enter your contact information.</p>
</li>
<li>
<p>Enter an informative comment about the commit.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Removing a Container</div>
<ol class="arabic">
<li>
<p>In the Satellite web UI, navigate to <strong>Containers</strong> &gt; <strong>All Containers</strong>.</p>
</li>
<li>
<p>From the list of existing containers, select the container that you want, and then click <strong>Delete</strong>.</p>
</li>
<li>
<p>In the alert window, click <strong>OK</strong> to confirm the deletion.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Initialization_Script_for_Provisioning_Examples">Appendix A: Initialization Script for Provisioning Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have not followed the examples in the Red Hat Satellite 6 Content Management Guide, you can use the following initialization script to create an environment for provisioning examples.</p>
</div>
<div class="paragraph">
<p>Create a script file (<code>sat6-content-init.sh</code>) and include the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/bash

MANIFEST=$1

# Import the content from Red Hat CDN
hammer organization create --name "ACME" --label "ACME" \
--description "Our example organization for managing content."
hammer subscription upload --file ~/$MANIFEST --organization "ACME"
hammer repository-set enable \
--name "Red Hat Enterprise Linux 7 Server (RPMs)" \
--releasever "7Server" --basearch "x86_64" \
--product "Red Hat Enterprise Linux Server" --organization "ACME"
hammer repository-set enable \
--name "Red Hat Enterprise Linux 7 Server (Kickstart)" \
--releasever "7Server" --basearch "x86_64" \
--product "Red Hat Enterprise Linux Server" --organization "ACME"
hammer repository-set enable \
--name "Red Hat Satellite Tools {ProductVersion} (for RHEL 7 Server) (RPMs)" \
--basearch "x86_64" --product "Red Hat Enterprise Linux Server" \
--organization "ACME"
hammer product synchronize --name "Red Hat Enterprise Linux Server" \
--organization "ACME"

# Create our application life cycle
hammer lifecycle-environment create --name "Development" \
--description "Environment for ACME's Development Team" \
--prior "Library" --organization "ACME"
hammer lifecycle-environment create --name "Testing" \
--description "Environment for ACME's Quality Engineering Team" \
--prior "Development" --organization "ACME"
hammer lifecycle-environment create --name "Production" \
--description "Environment for ACME's Product Releases" \
--prior "Testing" --organization "ACME"

# Create and publish our Content View
hammer content-view create --name "Base" \
--description "Base operating system" \
--repositories "Red Hat Enterprise Linux 7 Server RPMs x86_64 7Server,Red Hat Satellite Tools {ProductVersion} for RHEL 7 Server RPMs x86_64" \
--organization "ACME"
hammer content-view publish --name "Base" \
--description "Initial content view for our operating system" \
--organization "ACME"
hammer content-view version promote --content-view "Base" --version 1 \
--to-lifecycle-environment "Development" --organization "ACME"
hammer content-view version promote --content-view "Base" --version 1 \
--to-lifecycle-environment "Testing" --organization "ACME"
hammer content-view version promote --content-view "Base" --version 1 \
--to-lifecycle-environment "Production" --organization "ACME"</pre>
</div>
</div>
<div class="paragraph">
<p>Set executable permissions on the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># chmod +x sat6-content-init.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Download a copy of your Subscription Manifest from the Red Hat Customer Portal and run the script on the manifest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ./sat6-content-init.sh manifest_98f4290e-6c0b-4f37-ba79-3a3ec6e405ba.zip</pre>
</div>
</div>
<div class="paragraph">
<p>This imports the necessary Red Hat content for the provisioning examples in this guide.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="CLI_Params">Appendix B: Additional Host Parameters for Hammer CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix provides some information on additional parameters for the <code>hammer host create</code> command.</p>
</div>
<div class="sect2">
<h3 id="_common_interface_parameters">B.1. Common Interface Parameters</h3>
<div class="paragraph">
<p>These parameters are used with the <code>--interface</code> option for all provisioning types:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAC address for the interface</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address for the interface</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of interface. For example: <code>interface</code>, <code>bmc</code>, or <code>bond</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host name associated with this interface`</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subnet_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The subnet ID on the Satellite Server</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The domain ID on the Satellite Server</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The device identifier. For example: <code>eth0</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">managed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean for managed interfaces. Set to <code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">primary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean for primary interfaces. Managed hosts needs to have one primary interface. Set to <code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">provision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean for whether to provision on this interface. Set to <code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">virtual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean for whether the interface is a VLAN interface. Set to <code>true</code> or <code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use the following parameters if <code>virtual</code> is <code>true</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VLAN tag, this attribute has precedence over the subnet VLAN ID. Only for virtual interfaces.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attached_to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifier of the interface to which this interface belongs. For example: <code>eth1</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use the following parameters if <code>type</code> is <code>bond</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bonding mode. One of <code>balance-rr</code>, <code>active-backup</code>, <code>balance-xor</code>, <code>broadcast</code>, <code>802.3ad</code>, <code>balance-tlb</code>, <code>balance-alb</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attached_devices</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifiers of slave interfaces. For example: <code>[eth1,eth2]</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bond_options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional bonding options</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use the following parameters if <code>type</code> is <code>bmc</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The BMC provider. Only <code>IPMI</code> is supported</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username for the BMC device</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the BMC device</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ec2_parameters">B.2. EC2 Parameters</h3>
<div class="paragraph">
<p>Available parameters for <code>--compute-attributes</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flavor_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The EC2 flavor to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The AMI ID of the image to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">availability_zone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The availability zone within the region of the EC2 provider</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security_group_ids</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The IDs for security groups to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">managed_ip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To utilize a public or private IP</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_libvirt_parameters">B.3. Libvirt Parameters</h3>
<div class="paragraph">
<p>Available keys for <code>--compute-attributes</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of CPUs</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of memory in bytes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to start the machine</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Available keys for <code>--interface</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compute_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>bridge</code> or <code>network</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compute_network / compute_bridge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the network or physical interface</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compute_model</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface model. One of <code>virtio</code>, <code>rtl8139</code>, <code>ne2k_pci</code>, <code>pcnet</code>, or <code>e1000</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Available keys for <code>--volume</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pool_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The storage pool to store the volume</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">capacity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The capacity of the volume. For example: <code>10G</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">format_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The disk type. Either <code>raw</code> or <code>qcow2</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_red_hat_openstack_platform_parameters">B.4. Red Hat OpenStack Platform Parameters</h3>
<div class="paragraph">
<p>Available keys for <code>--compute-attributes</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flavor_ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The flavor to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image_ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The image to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenant_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The tenant to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security_groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of security groups to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">network</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The network to connect the instance</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_red_hat_virtualization_parameters">B.5. Red Hat Virtualization Parameters</h3>
<div class="paragraph">
<p>Available keys for <code>--compute-attributes</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cluster ID to contain the host</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hardware profile to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of CPU cores  to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of memory in bytes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to start the machine</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Available keys for <code>--interface</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compute_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface name. For example: <code>eth0</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compute_network</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The network in the cluster to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Available keys for <code>--volume</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_gb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Volume size in GB</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storage_domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The storage domain to use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to set the volume as bootable. Only one volume can be bootable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_vmware_interface_parameters">B.6. VMware Interface Parameters</h3>
<div class="paragraph">
<p>Available keys for <code>--compute-attributes</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of CPUs for the host</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">corespersocket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of cores per CPU socket. Applicable to hosts using hardware versions less than v10.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory_mb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of memory in MB</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster ID for the host</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to folder to organize the host</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">guest_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guest OS ID</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scsi_controller_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the VMware controller</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hardware_version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VMware hardware version ID</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to start the machine</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Available keys for <code>--interface</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compute_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the network adapter. One of <code>VirtualVmxnet</code>, <code>VirtualVmxnet2</code>, <code>VirtualVmxnet3</code>, <code>VirtualE1000</code>, <code>VirtualE1000e</code>, <code>VirtualPCNet32</code>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compute_network</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VMware network ID</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Available keys for <code>--volume</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datastore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The datastore ID</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the volume</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size_gb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size in GB</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean value to enable thin provisioning</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eager_zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean value to enable Eager Zero thick provisioning</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provision_FIPS_Hosts">Appendix C: Provisioning FIPS Compliant Hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red&#160;Hat Satellite&#160;6 supports provisioning hosts that comply with the National Institute of Standards and Technology&#8217;s <a href="http://csrc.nist.gov/groups/STM/cmvp/standards.html#02">Security Requirements for Cryptographic Modules</a> standard, reference number FIPS 140-2, referred to here as FIPS.</p>
</div>
<div id="NOTE" class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Red&#160;Hat Satellite&#160;6 is not supported on a FIPS enabled host.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>To enable the provisioning of hosts that are FIPS compliant, complete the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identify the relevant operating systems, locations, and organizations</p>
</li>
<li>
<p>Create and enable the FIPS provisioning templates</p>
</li>
<li>
<p>Change the provisioning password hashing algorithm</p>
</li>
<li>
<p>Change the Puppet message digest algorithm</p>
</li>
<li>
<p>Set the FIPS enabled parameter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When these changes are complete, the new provisioning templates will be associated with those operating systems, locations, and organizations you specify. When you provision a host to those operating systems, locations, and organizations, the host will have the FIPS-compliant settings applied. To confirm that these settings have been successful, complete the steps in <a href="#verifying_fips_mode_enabled">Verifying FIPS Mode is Enabled</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Complete the configuration steps from the <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/hammer_cli_guide/chap-cli_guide-introduction_to_hammer#sect-CLI_Guide-Authentication">Authentication</a> section in the <em>Hammer CLI Guide</em>. This allows you to run Hammer commands without providing your Satellite username and password each time.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="identifying_relevant_operating_systems_locations_organizations">C.1. Identifying the Relevant Operating Systems, Locations, and Organizations</h3>
<div class="paragraph">
<p>Before creating the FIPS-compliant templates in Satellite, you must identify those locations, organizations and operating systems to which you want to deploy FIPS-compliant hosts. For example, if you will only deploy Red&#160;Hat Enterprise&#160;Linux 7 hosts as FIPS compliant, associate the template with only Red&#160;Hat Enterprise&#160;Linux 7.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List all locations.</p>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>$ hammer location list
---|-----------------
ID | NAME
---|-----------------
2  | Default Location
---|-----------------</pre>
</div>
</div>
<div class="paragraph">
<p>Note the value in the <code>NAME</code> column of those locations to which you want to deploy FIPS-compliant hosts.</p>
</div>
</li>
<li>
<p>List all organizations.</p>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>---|----------------------|----------------------|------------
ID | NAME                 | LABEL                | DESCRIPTION
---|----------------------|----------------------|------------
1  | Default Organization | Default_Organization |
2  | Sales                | Sales_Department     |
---|----------------------|----------------------|------------</pre>
</div>
</div>
<div class="paragraph">
<p>Note the value in the <code>NAME</code> column of those organizations to which you want to deploy FIPS-compliant hosts.</p>
</div>
</li>
<li>
<p>List all operating systems.</p>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>$ hammer os list
---|-----------------|--------------|-------
ID | TITLE           | RELEASE NAME | FAMILY
---|-----------------|--------------|-------
2  | RedHat 6.6      |              | Redhat
3  | RedHat 7.1      |              | Redhat
1  | RedHat 7.2      |              | Redhat
4  | RedHat 6.7      |              | Redhat
---|-----------------|--------------|-------</pre>
</div>
</div>
<div class="paragraph">
<p>Note the value in the <code>TITLE</code> column of those operating systems to which you want to deploy FIPS-compliant hosts.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_creating_and_enabling_the_fips_provisioning_templates">C.2. Creating and Enabling the FIPS Provisioning Templates</h3>
<div class="paragraph">
<p>The FIPS provisioning templates are provided in a git repository. In this procedure you import them into the Satellite environment, then associate them with the desired operating systems, locations, and organizations.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Satellite&#160;Server, clone the git repository containing the FIPS enabled templates, then change into the repository&#8217;s directory.</p>
<div class="listingblock">
<div class="content">
<pre>$ git clone https://github.com/RedHatSatellite/satellite6-fips-client
$ cd satellite6-fips-client</pre>
</div>
</div>
<div class="paragraph">
<p>This repository contains the following Embedded RuBy (ERB) templates. These are plain text files, which you can view to see in detail the configuration settings they contain.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kickstart_Default_PXELinux_FIPS.erb</code></p>
<div class="ulist">
<ul>
<li>
<p>Updated PXELinux template</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>fips_packages.erb</code></p>
<div class="ulist">
<ul>
<li>
<p>Packages required by FIPS mode (for example, <code>dracut-fips</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Satellite_Kickstart_Default_FIPS.erb</code></p>
<div class="ulist">
<ul>
<li>
<p>Kickstart template with modifications to call the <code>fips_packages</code> snippet</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>puppet.conf.erb</code></p>
<div class="ulist">
<ul>
<li>
<p>Updated <code>puppet.conf</code> configuration file with updated (SHA256) message digest algorithm</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Add the <em>PXELinux FIPS</em> template.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer template create  --name "Kickstart Default PXELinux FIPS" \
  --file Kickstart_Default_PXELinux_FIPS.erb  \
  --locations <em>LOCATIONS</em> \
  --organizations <em>ORGANIZATION</em> \
  --operatingsystems <em>OS</em> \
  --type PXELinux</pre>
</div>
</div>
<div class="paragraph">
<p>Replace the placeholder values <code>LOCATIONS</code>, <code>ORGANIZATION</code>, and <code>OS</code> with the values you noted in <a href="#identifying_relevant_operating_systems_locations_organizations">Identifying the Relevant Operating Systems, Locations, and Organizations</a>. If any value contains non-aphabetical characters, enclose the value in quotation marks (").</p>
</div>
<div class="paragraph">
<p>The message <code>Config template created</code> indicates success.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="nowrap">$ hammer template create  --name "Kickstart Default PXELinux FIPS" \
  --file Kickstart_Default_PXELinux_FIPS.erb \
  --locations "Default Location" \
  --organizations "Default Organization","Sales" \
  --operatingsystems "RedHat 6.6","RedHat 7.1","RedHat 7.2","RedHat 6.7" \
  --type PXELinux</pre>
</div>
</div>
</li>
<li>
<p>Add the <em>Satellite Kickstart Default FIPS</em> template.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer template create  --name "Satellite Kickstart Default FIPS" \
  --file Satellite_Kickstart_Default_FIPS.erb  \
  --locations <em>LOCATIONS</em> \
  --organizations <em>ORGANIZATION</em> \
  --operatingsystems <em>OS</em> \
  --type provision</pre>
</div>
</div>
<div class="paragraph">
<p>Replace the placeholder values <code>LOCATIONS</code>, <code>ORGANIZATION</code>, and <code>OS</code> with the values you noted in <a href="#identifying_relevant_operating_systems_locations_organizations">Identifying the Relevant Operating Systems, Locations, and Organizations</a>. If any value contains non-aphabetical characters, enclose the value in quotation marks (").</p>
</div>
<div class="paragraph">
<p>The message <code>Config template created</code> indicates success.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="nowrap">$ hammer template create  --name "Satellite Kickstart Default FIPS" \
  --file Satellite_Kickstart_Default_FIPS.erb  \
  --locations "Default Location" \
  --organizations "Default Organization","Sales" \
  --operatingsystems "RedHat 6.6","RedHat 7.1","RedHat 7.2","RedHat 6.7" \
  --type provision</pre>
</div>
</div>
</li>
<li>
<p>Add the <em>FIPS Packages</em> snippet.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer template create  --name "fips_packages" \
  --file fips_packages.erb \
  --locations <em>LOCATIONS</em> \
  --organizations <em>ORGANIZATION</em> \
  --type snippet</pre>
</div>
</div>
<div class="paragraph">
<p>Replace the placeholder values <em>LOCATIONS</em> and <em>ORGANIZATION</em> with the values you noted in <a href="#identifying_relevant_operating_systems_locations_organizations">Identifying the Relevant Operating Systems, Locations, and Organizations</a>. If any value contains non-aphabetical characters, enclose the value in quotation marks (").</p>
</div>
<div class="paragraph">
<p>The message <code>Config template created</code> indicates success.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="nowrap">$ hammer template create  --name "fips_packages" \
  --file fips_packages.erb \
  --locations "Default Location" \
  --organizations "Default Organization","Sales" \
  --type snippet</pre>
</div>
</div>
</li>
<li>
<p>Update the default Puppet configuration snippet.</p>
<div class="listingblock">
<div class="content">
<pre>$ hammer template update --name puppet.conf \
  --file puppet.conf.erb  \
  --type snippet</pre>
</div>
</div>
<div class="paragraph">
<p>The message <code>Config template created</code> indicates success.</p>
</div>
</li>
<li>
<p>Update the Operating System Object to use the new templates.</p>
<div class="paragraph">
<p>Now that the new FIPS templates have been added to Satellite, they must be set as <em>default</em> templates for the desired operating system.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Identify the IDs of the <em>Satellite Kickstart Default FIPS</em> and <em>Kickstart Default PXELinux FIPS</em> templates.</p>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>$ hammer template list
---|---------------------------------------|----------
ID | NAME                                  | TYPE
---|---------------------------------------|----------
41 | redhat_register                       | snippet
42 | saltstack_minion                      | snippet
53 | Kickstart Default PXELinux FIPS       | PXELinux
46 | Satellite Kickstart Default           | provision
48 | Satellite Kickstart Default Finish    | finish
54 | Satellite Kickstart Default FIPS      | provision
47 | Satellite Kickstart Default User Data | user_data
50 | subscription_manager_registration     | snippet
29 | UserData default                      | user_data
30 | WAIK default PXELinux                 | PXELinux
---|---------------------------------------|----------</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the IDs are 54 and 53 respectively. These IDs are installation specific.</p>
</div>
</li>
<li>
<p>Specify the FIPS templates as default.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer os set-default-template --config-template-id <em>TEMPLATE</em> \
--id <em>OS</em></pre>
</div>
</div>
<div class="paragraph">
<p>Replace the placeholders <em>TEMPLATE</em> and <em>OS</em> with the IDs of the FIPS templates, and the desired operating system, noted earlier. Repeat this command for every combination of FIPS template and operating system. It does not accept a comma-separated list of values.</p>
</div>
<div class="paragraph">
<p>In this example, the FIPS templates are set as default for Red&#160;Hat Enterprise&#160;Linux 7.2, identified in an earlier example as ID 1.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="nowrap">$ hammer os set-default-template --config-template-id <em>54</em> --id <em>1</em>
$ hammer os set-default-template --config-template-id <em>53</em> --id <em>1</em></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_change_the_provisioning_password_hashing_algorithm">C.3. Change the Provisioning Password Hashing Algorithm</h3>
<div class="paragraph">
<p>This sets the password hashing algorithm used in provisioning to SHA256. This configuration setting must be applied for each operating system you want to deploy as FIPS compliant.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This is required <strong>ONLY</strong> if Red&#160;Hat Satellite&#160;6 was upgraded from Satellite&#160;6.1. Satellite 6.4 uses SHA256 by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify the Operating System IDs.</p>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>$ hammer os list
---|-----------------|--------------|-------
ID | TITLE           | RELEASE NAME | FAMILY
---|-----------------|--------------|-------
2  | RedHat 6.6      |              | Redhat
3  | RedHat 7.1      |              | Redhat
1  | RedHat 7.2      |              | Redhat
4  | RedHat 6.7      |              | Redhat
---|-----------------|--------------|-------</pre>
</div>
</div>
</li>
<li>
<p>Update each operating system&#8217;s password hash value.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer os update --title <em>OS</em> \
  --password-hash SHA256</pre>
</div>
</div>
<div class="paragraph">
<p>Repeat this command for each of the desired operating systems, using the matching value in the <code>TITLE</code> column. It does not accept a comma-separated list of values.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>$ hammer os update --title "RedHat 7.2" \
  --password-hash SHA256</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_switching_to_a_fips_compliant_message_algorithm_for_puppet">C.4. Switching to a FIPS Compliant Message Algorithm for Puppet</h3>
<div class="paragraph">
<p>On the Satellite&#160;Server, all external Capsule&#160;Servers, and <strong>all</strong> existing hosts, configure Puppet to use the SHA256 message digest algorithm.</p>
</div>
<div class="paragraph">
<p>Edit the <code>/etc/puppet/puppet.conf</code> file, adding the line <code>digest_algorithm = sha256</code> in the <code>[main]</code> stanza.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This change will be overwritten on every upgrade of Satellite, so needs to be reapplied afterward.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because the Puppet message digest algorithm is changed on the Satellite&#160;Server and all Capsule&#160;Servers, it must also be changed on <strong>all</strong> hosts, including those that are not FIPS compliant.</p>
</div>
<div class="paragraph">
<p>In the event of a message digest algorithm mismatch, the client will download its facts again. This will result in a noticeable increased load on the Satellite&#160;Server or external Capsule&#160;Servers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_the_fips_enabled_parameter">C.5. Setting the FIPS Enabled Parameter</h3>
<div class="paragraph">
<p>To provision a FIPS compliant host, the FIPS templates require a parameter named <em>fips_enabled</em> to be set to <code>true</code>. If this is not set to <code>true</code>, or is absent, the FIPS specific changes will not be applied. This parameter can be specified when provisioning an individual host, or set for a hostgroup. Retrospectively enabling FIPS compliance on a host is outside the scope of this guide and likely to cause problems.</p>
</div>
<div class="paragraph">
<p>To set this parameter when provisioning a host, append <code>--parameters fips_enabled=true</code> to the Hammer command.</p>
</div>
<div class="paragraph">
<p>To set this parameter on an existing host group, use the Hammer sub-command <code>set-parameter</code>. For more information, see the output of the command <code>hammer hostgroup set-parameter --help</code>. Any host provisioned to this hostgroup will inherit the <em>fips_enabled</em> parameter from the hostgroup.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="nowrap">$ hammer hostgroup set-parameter --name fips_enabled \
 --value 'true' \
 --hostgroup <em>prod_servers</em></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verifying_fips_mode_enabled">C.6. Verifying FIPS Mode is Enabled</h3>
<div class="paragraph">
<p>To verify these FIPS compliance changes have been successful, you must provision a host and check its configuration.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy a host using the FIPS templates, ensuring that parameter named <em>fips_enabled</em> is set to <code>true</code>.</p>
</li>
<li>
<p>Log in to the new host as a root-equivalent account.</p>
</li>
<li>
<p>Enter the command <code>cat /proc/sys/crypto/fips_enabled</code>. A value of <code>1</code> confirms that FIPS mode is enabled.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Creating_Cloud_Images">Appendix D: Building Cloud Images for Red Hat Satellite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this section to build and register images to Red Hat Satellite.</p>
</div>
<div class="paragraph">
<p>You can use a preconfigured Red Hat Enterprise Linux KVM guest QCOW2 image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/downloads/content/69/ver=/rhel---7/7.4/x86_64/product-software">RHEL 7.4 KVM Guest Image</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/downloads/content/69/ver=/rhel---6/6.9/x86_64/product-software">RHEL 6.9 KVM Guest Image</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These images contain <code>cloud-init</code>. To function properly, they must use ec2-compatible metadata services for provisioning an SSH key.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For the KVM guest images:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>root</code> account in the image is disabled, but <code>sudo</code> access is granted to a special user named <code>cloud-user</code>.</p>
</li>
<li>
<p>There is no <code>root</code> password set for this image.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>root</code> password is locked in <code>/etc/shadow</code> by placing <code>!!</code> in the second field.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to create custom Red Hat Enterprise Linux images,
see <a href="#sect-create-rhel7-image">Creating a Red Hat Enterprise Linux 7 Image</a> and
<a href="#sect-create-rhel6-image">Creating a Red Hat Enterprise Linux 6 Image</a>.</p>
</div>
<div class="sect2">
<h3 id="section-create-custom-images">D.1. Creating Custom Red Hat Enterprise Linux Images</h3>
<div class="paragraph">
<p><strong>Prerequisites:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use a Linux host machine to create an image. In this example, we use a Red Hat Enterprise Linux 7 Workstation.</p>
</li>
<li>
<p>Use <code>virt-manager</code> on your workstation to complete this procedure. If you create the image on a remote server, connect to the server from your workstation with <code>virt-manager</code>.</p>
</li>
<li>
<p>A Red Hat Enterprise Linux 7 or 6 ISO file (see
<a href="https://access.redhat.com/downloads/content/69/ver=/rhel---7/7.4/x86_64/product-software">Red Hat Enterprise Linux 7.4 Binary DVD</a> or <a href="https://access.redhat.com/downloads/content/69/ver=/rhel---6/6.9/x86_64/product-software">Red Hat Enterprise Linux 6.9 Binary DVD</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about installing a Red Hat Enterprise Linux Workstation, see <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Installation_Guide/">Red Hat Enterprise Linux 7 Installation Guide</a>.</p>
</div>
<div class="paragraph">
<p>Before you can create custom images, install the following packages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install <code>libvirt</code>, <code>qemu-kvm</code> and graphical tools:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# yum install virt-manager virt-viewer libvirt qemu-kvm</pre>
</div>
</div>
</li>
<li>
<p>Install the following command line tools:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# yum install virt-install libguestfs-tools-c</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In the following procedures, enter all commands with the <code>[root@host]#</code> prompt on the workstation that hosts the <code>libvirt</code> environment.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sect-create-rhel7-image">D.2. Creating a Red Hat Enterprise Linux 7 Image</h3>
<div class="paragraph">
<p>Use this section to create an image in the QCOW2 format using a Red Hat Enterprise Linux 7 ISO file.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using your web browser, download the Red Hat Enterprise Linux binary ISO file to a temporary location, for example, the <code>Downloads</code> directory.</p>
</li>
<li>
<p>Copy the Red Hat Enterprise Linux binary ISO file to the <code>/var/lib/libvirt/images/</code> directory.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[root@host]# cp ~/home/<em>user</em>/Downloads/rhel-server-7.4-x86_64-dvd.iso /var/lib/libvirt/images/</pre>
</div>
</div>
</li>
<li>
<p>Verify that <strong>virtbr0</strong> is the virtual bridge:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# ip a</pre>
</div>
</div>
</li>
<li>
<p>Start <code>libvirtd</code>:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# systemctl start libvirtd</pre>
</div>
</div>
</li>
<li>
<p>Navigate to the <code>/var/lib/libvirt/images/</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# cd /var/lib/libvirt/images/</pre>
</div>
</div>
</li>
<li>
<p>Prepare the QEMU image:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# qemu-img create -f qcow2 rhel7.qcow2 8G</pre>
</div>
</div>
</li>
<li>
<p>Start the installation using <code>virt-install</code>. Use the following example as a guide:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# virt-install --virt-type qemu --name rhel7 --ram 2048 \
--cdrom rhel-server-7.4-x86_64-dvd.iso \
--disk rhel7.qcow2,format=qcow2 \
--network=bridge:virbr0 --graphics vnc,listen=0.0.0.0 \
--noautoconsole --os-type=linux --os-variant=rhel7</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For GUI users, if the instance does not launch automatically, enter the <code>virt-manager</code> command to view the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[root@host]# virt-manager</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Follow the steps of the Red Hat Enterprise Linux installation wizard.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>For the installation source, add an HTTP link to your repository in Red Hat Satellite, for example <code>satellite.example.com/pub/export/RHEL7/content/dist/rhel/server/7/7Server/x86_64/os/</code></p>
</li>
<li>
<p>For the type of devices your installation uses, select <strong>Auto-detected installation media</strong>.</p>
</li>
<li>
<p>For the type of installation destination, select <strong>Local Standard Disks</strong>.</p>
</li>
<li>
<p>For other storage options, select <strong>Automatically configure partitioning</strong>.</p>
</li>
<li>
<p>For software selection, select <strong>Minimal Install</strong>.</p>
</li>
<li>
<p>Set the network interface to <strong>ON</strong> to ensure the interface activates on system start.</p>
</li>
<li>
<p>Enter a host name, and click <strong>Apply</strong>.</p>
</li>
<li>
<p>Enter a <code>root</code> password.</p>
</li>
</ol>
</div>
</li>
<li>
<p>When the installation completes, reboot the instance and log in as
the root user.</p>
</li>
<li>
<p>Confirm that the network interface is up and that the IP address is assigned:</p>
<div class="listingblock">
<div class="content">
<pre># ip a</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the hostname is correct:</p>
<div class="listingblock">
<div class="content">
<pre># hostname</pre>
</div>
</div>
</li>
<li>
<p>Create a <code>/etc/NetworkManager/conf.d/XX-cloud-image.conf</code> file where <em>XX</em> is a two-digit number that indicates order of precedence. Add the following contents to the file:</p>
<div class="listingblock">
<div class="content">
<pre>[main]
dns=none</pre>
</div>
</div>
</li>
<li>
<p>Proceed to <a href="#Configuring_Host_Registration">Configuring a Host for Registration</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sect-create-rhel6-image">D.3. Creating a Red Hat Enterprise Linux 6 Image</h3>
<div class="paragraph">
<p>Use this section to create an image in the QCOW2 format using a Red Hat Enterprise Linux 6 ISO file.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start the installation using <code>virt-install</code>:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# qemu-img create -f qcow2 rhel6.qcow2 4G
[root@host]# virt-install --connect=qemu:///system --network=bridge:virbr0 \
--name=rhel6 --os-type linux --os-variant rhel6 \
--disk path=rhel6.qcow2,format=qcow2,size=10,cache=none \
--ram 4096 --vcpus=2 --check-cpu --accelerate \
--hvm --cdrom=rhel-server-6.8-x86_64-dvd.iso</pre>
</div>
</div>
<div class="paragraph">
<p>This launches an instance and starts the installation process.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the instance does not launch automatically, enter the <code>virt-viewer</code> command to view the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[root@host]# virt-viewer rhel6</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set up the virtual machines as follows:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>At the initial Installer boot menu, select the <strong>Install or upgrade an existing system</strong> option.</p>
</li>
<li>
<p>Select the appropriate <strong>Language</strong> and <strong>Keyboard</strong> options.</p>
</li>
<li>
<p>When prompted about which type of devices your installation uses, select <strong>Basic Storage Devices</strong>.</p>
</li>
<li>
<p>Select a <code>hostname</code> for your device. The default host name is <code>localhost.localdomain</code>.</p>
</li>
<li>
<p>Set a root password.</p>
</li>
<li>
<p>Based on the space on the disk, select the type of installation.</p>
</li>
<li>
<p>Select the <strong>Basic Server</strong> install, which includes an SSH server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Reboot the instance and log in as the <code>root</code> user.</p>
</li>
<li>
<p>Update the <code>/etc/sysconfig/network-scripts/ifcfg-eth0</code> file so it only contains the following values:</p>
<div class="listingblock">
<div class="content">
<pre>TYPE=Ethernet
DEVICE=eth0
ONBOOT=yes
BOOTPROTO=dhcp
NM_CONTROLLED=no</pre>
</div>
</div>
</li>
<li>
<p>Restart the service network:</p>
<div class="listingblock">
<div class="content">
<pre># service network restart</pre>
</div>
</div>
</li>
<li>
<p>Proceed to <a href="#Configuring_Host_Registration">Configuring a Host for Registration</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Host_Registration">D.4. Configuring a Host for Registration</h3>
<div class="paragraph">
<p>RedHat EnterpriseLinux virtual machines register to Customer Portal
Subscription Management by default. You must update each virtual machine
configuration so that they receive updates from the correct Satellite
Server or Capsule Server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Hosts must be using the following RedHat EnterpriseLinux version:</p>
<div class="ulist">
<ul>
<li>
<p>6.4 or later</p>
</li>
<li>
<p>7.0 or later</p>
</li>
</ul>
</div>
</li>
<li>
<p>All architectures of RedHat EnterpriseLinux are supported (i386,
x86_64, s390x, ppc_64).</p>
</li>
<li>
<p>Ensure that a time synchronization tool is enabled and runs on the
Satellite Servers, any Capsule Servers, and the hosts.</p>
<div class="ulist">
<ul>
<li>
<p>For RedHat EnterpriseLinux 6:</p>
<div class="listingblock">
<div class="content">
<pre># chkconfig ntpd on; service ntpd start</pre>
</div>
</div>
</li>
<li>
<p>For RedHat EnterpriseLinux 7:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl enable chronyd; systemctl start chronyd</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Ensure that the daemon <code>rhsmcertd</code> is enabled and running on the hosts.</p>
<div class="ulist">
<ul>
<li>
<p>For RedHat EnterpriseLinux 6:</p>
<div class="listingblock">
<div class="content">
<pre># chkconfig rhsmcertd on; service rhsmcertd start</pre>
</div>
</div>
</li>
<li>
<p>For RedHat EnterpriseLinux 7:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl start rhsmcertd</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">To Configure a Host for Registration:</div>
<ol class="arabic">
<li>
<p>Take note of the fully qualified domain name (FQDN) of the Satellite
Server or Capsule Server, for example <em>server.example.com</em>.</p>
</li>
<li>
<p>On the host, connect to a terminal on the host as the root user</p>
</li>
<li>
<p>Install the consumer RPM from the Satellite Server or Capsule Server to
which the host is to be registered. The consumer RPM updates the content
source location of the host and allows the host to download content from
the content source specified in RedHat Satellite.</p>
<div class="listingblock">
<div class="content">
<pre># rpm -Uvh http://server.example.com/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Registering_Host">D.5. Registering a Host</h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that an activation key that is associated with the appropriate content
view and environment exists for the host. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/content_management_guide/managing_activation_keys">Managing Activation Keys</a> in the <em>Content Management Guide</em>. By default, an activation key has the <code>auto-attach</code> function
enabled. The feature is commonly used with hosts used as hypervisors.</p>
</li>
<li>
<p>Ensure that the version of the <code>subscription-manager</code> utility is 1.10 or higher. The package is available in the standard
RedHat Enterprise Linux repository.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Red Hat Enterprise Linux Workstation, connect to a terminal as the root user.</p>
</li>
<li>
<p>Register the host using Red Hat Subscription Manager:</p>
<div class="listingblock">
<div class="content">
<pre># subscription-manager register --org="My_Organization" --activationkey="MyKey"</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the <code>--environment</code> option to override the content view and
life cycle environment defined by the activation key. For example, to
register a host to the content view "MyView" in a "Development" life
cycle environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># subscription-manager register --org="My_Organization" \
--environment=Development/MyView \
--activationkey="MyKey"</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For RedHat Enterprise Linux 6.3 hosts, the release version defaults to
RedHat EnterpriseLinux6 Server and must point to the 6.3
repository.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On RedHat Satellite, select <strong>Hosts</strong> &gt; <strong>Content Hosts</strong>.</p>
</li>
<li>
<p>Select the name of the host that needs to be changed.</p>
</li>
<li>
<p>In the <strong>Content Host Content</strong> section click the edit icon to the right of
<strong>Release Version</strong>.</p>
</li>
<li>
<p>Select "6.3" from the <strong>Release Version</strong> drop-down menu.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Installing_katello_Agent">D.6. Installing the Katello Agent</h3>
<div class="paragraph">
<p>Use the following procedure to install the Katello agent on a host
registered to Satellite 6. The <code>katello-agent</code> package depends on the
gofer package that provides the <code>goferd service</code>. This service must be
enabled so that the RedHat Satellite Server or Capsule Server can
provide information about errata that are applicable for content hosts.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>The <code>Satellite Tools</code> repository must be enabled, synchronized to the Red
Hat Satellite Server, and made available to your hosts as it provides the
required packages. For more information about enabling Satellite Tools, see <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/managing_hosts/chap-red_hat_satellite-managing_hosts-managing_hosts#sect-Red_Hat_Satellite-Managing_Hosts-Registration-Installing_the_Katello_Agent">Installing the Katello Agent</a> in <em>Managing Hosts</em>.</p>
</div>
<div class="olist arabic">
<div class="title">To Install the Katello Agent</div>
<ol class="arabic">
<li>
<p>Install the <code>katello-agent</code> RPM package using the following command:</p>
<div class="listingblock">
<div class="content">
<pre># yum install katello-agent</pre>
</div>
</div>
</li>
<li>
<p>Ensure goferd is running:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl start goferd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_puppet_agent">D.7. Installing the Puppet Agent</h3>
<div class="paragraph">
<p>Use this section to install and configure the Puppet agent on
a host. When you have correctly installed and configured the Puppet
agent, you can navigate to <strong>Hosts</strong> &gt; <strong>All hosts</strong> to list all hosts visible to
RedHat Satellite Server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the Puppet agent RPM package using the following command:</p>
<div class="listingblock">
<div class="content">
<pre># yum install puppet</pre>
</div>
</div>
</li>
<li>
<p>Configure the puppet agent to start at boot:</p>
<div class="paragraph">
<p>On RedHat EnterpriseLinux6:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># chkconfig puppet on</pre>
</div>
</div>
<div class="paragraph">
<p>On RedHat EnterpriseLinux7:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># systemctl enable puppet</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_completing_the_red_hat_enterprise_linux_7_image">D.8. Completing the Red Hat Enterprise Linux 7 image</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the system:</p>
<div class="listingblock">
<div class="content">
<pre># yum update</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>cloud-init</code> packages:</p>
<div class="listingblock">
<div class="content">
<pre># yum install cloud-utils-growpart cloud-init</pre>
</div>
</div>
</li>
<li>
<p>Open the <code>/etc/cloud/cloud.cfg</code> configuration file:</p>
<div class="listingblock">
<div class="content">
<pre># vi /etc/cloud/cloud.cfg</pre>
</div>
</div>
</li>
<li>
<p>Under the heading <code>cloud_init_modules</code>, add:</p>
<div class="listingblock">
<div class="content">
<pre>- resolv-conf</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>resolv-conf</code> option automatically configures the <code>resolv.conf</code> when an instance boots for the first time. This file contains information related to the instance such as <code>nameservers</code>, <code>domain</code> and other options.</p>
</div>
</li>
<li>
<p>Open the <code>/etc/sysconfig/network</code> file:</p>
<div class="listingblock">
<div class="content">
<pre># vi /etc/sysconfig/network</pre>
</div>
</div>
</li>
<li>
<p>Add the following line to avoid problems accessing the EC2 metadata service:</p>
<div class="listingblock">
<div class="content">
<pre>NOZEROCONF=yes</pre>
</div>
</div>
</li>
<li>
<p>Un-register the virtual machine so that the resulting image does not contain the same subscription details for every instance cloned based on it:</p>
<div class="listingblock">
<div class="content">
<pre># subscription-manager repos --disable=*
# subscription-manager unregister</pre>
</div>
</div>
</li>
<li>
<p>Power off the instance:</p>
<div class="listingblock">
<div class="content">
<pre># poweroff</pre>
</div>
</div>
</li>
<li>
<p>On your Red Hat Enterprise Linux Workstation, connect to the terminal as the root user and navigate to the <code>/var/lib/libvirt/images/</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# cd /var/lib/libvirt/images/</pre>
</div>
</div>
</li>
<li>
<p>Reset and clean the image using the <code>virt-sysprep</code> command so it can be used to create instances without issues:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# virt-sysprep -d rhel7</pre>
</div>
</div>
</li>
<li>
<p>Reduce image size using the <code>virt-sparsify</code> command. This command
converts any free space within the disk image back to free space within
the host:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# virt-sparsify --compress rhel7.qcow2 rhel7-cloud.qcow2</pre>
</div>
</div>
<div class="paragraph">
<p>This creates a new <code>rhel7-cloud.qcow2</code> file in the location where you enter the command.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_completing_the_red_hat_enterprise_linux_6_image">D.9. Completing the Red Hat Enterprise Linux 6 image</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the system:</p>
<div class="listingblock">
<div class="content">
<pre># yum update</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>cloud-init</code> packages:</p>
<div class="listingblock">
<div class="content">
<pre># yum install cloud-utils-growpart cloud-init</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>/etc/cloud/cloud.cfg</code> configuration file and under <code>cloud_init_modules</code> add:</p>
<div class="listingblock">
<div class="content">
<pre>- resolv-conf</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>resolv-conf</code> option automatically configures the <code>resolv.conf</code> configuration file when an instance boots for the first time. This file contains information related to the instance such as <code>nameservers</code>, <code>domain</code>, and other options.</p>
</div>
</li>
<li>
<p>To prevent network issues, create the <code>/etc/udev/rules.d/75-persistent-net-generator.rules</code>
file as follows:</p>
<div class="listingblock">
<div class="content">
<pre># echo "#" &gt; /etc/udev/rules.d/75-persistent-net-generator.rules</pre>
</div>
</div>
<div class="paragraph">
<p>This prevents <code>/etc/udev/rules.d/70-persistent-net.rules</code> file from being created. If <code>/etc/udev/rules.d/70-persistent-net.rules</code> is created, networking might not function properly when booting from snapshots (the network interface is created as "eth1" rather than "eth0" and IP address is not assigned).</p>
</div>
</li>
<li>
<p>Add the following line to <code>/etc/sysconfig/network</code> to avoid problems accessing the EC2 metadata service:</p>
<div class="listingblock">
<div class="content">
<pre>NOZEROCONF=yes</pre>
</div>
</div>
</li>
<li>
<p>Un-register the virtual machine so that the resulting image does not contain the same subscription details for every instance cloned based on it:</p>
<div class="listingblock">
<div class="content">
<pre># subscription-manager repos --disable=*
# subscription-manager unregister
# yum clean all</pre>
</div>
</div>
</li>
<li>
<p>Power off the instance:</p>
<div class="listingblock">
<div class="content">
<pre># poweroff</pre>
</div>
</div>
</li>
<li>
<p>On your Red Hat Enterprise Linux Workstation, log in as root and reset and clean the image using the <code>virt-sysprep</code> command so it can be used to create instances without issues:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# virt-sysprep -d rhel6</pre>
</div>
</div>
</li>
<li>
<p>Reduce image size using the <code>virt-sparsify</code> command. This command converts any free space within the disk image back to free space within the host:</p>
<div class="listingblock">
<div class="content">
<pre>[root@host]# virt-sparsify --compress rhel6.qcow2 rhel6-cloud.qcow2</pre>
</div>
</div>
<div class="paragraph">
<p>This creates a new <code>rhel6-cloud.qcow2</code> file in the location where you enter the command.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You must manually resize the partitions of instances based on the image in accordance with the disk space in the flavor that is applied to the instance.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_next_steps">D.10. Next steps</h3>
<div class="ulist">
<ul>
<li>
<p>Repeat the procedures for every image that you want to provision with Satellite.</p>
</li>
<li>
<p>Move the image to the location where you want to store for future use.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-05-09 11:06:12 CEST
</div>
</div>
</body>
</html>