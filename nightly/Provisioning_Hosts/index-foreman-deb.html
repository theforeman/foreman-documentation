<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Provisioning hosts</title>
<style>
﻿*,::before,::after{box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:100%}body{background:#fff;color:rgba(0,0,0,0.8);padding:0;margin:0;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:inherit;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,p,blockquote,th,td{margin:0;padding:0}a{background:none;color:#2156a5;text-decoration:underline;line-height:inherit}a:active,a:hover{cursor:pointer;outline:0}a:focus{outline:thin dotted}a:hover,a:focus{color:#1d4b8f}abbr{font-size:0.9em}abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}b,strong{font-weight:bold;line-height:inherit}strong strong{font-weight:400}code,kbd,pre{font-family:"Droid Sans Mono", "DejaVu Sans Mono", monospace;font-size:1em}code{font-weight:400;color:rgba(0,0,0,0.9)}pre{color:rgba(0,0,0,0.9);line-height:1.45;text-rendering:optimizeSpeed;white-space:pre-wrap}dfn{font-style:italic}em,i{font-style:italic;line-height:inherit}em em{font-style:normal}hr{border:solid #dddddf;border-width:1px 0 0;clear:both;height:0;margin:1.25em 0 1.1875em}mark{background:#ff0;color:#000}p{line-height:1.6;margin-bottom:1.25rem;text-rendering:optimizeLegibility}q{quotes:"“" "”" "‘" "’"}small{font-size:60%;line-height:inherit}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img,object[type^="image/"],svg{display:inline-block;height:auto;max-width:100%;vertical-align:middle}img{border:0;-ms-interpolation-mode:bicubic}object{max-width:100%}svg:not(:root){overflow:hidden}figure{margin:0}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}.left{float:left !important}.right{float:right !important}.text-left{text-align:left !important}.text-right{text-align:right !important}.text-center{text-align:center !important}.text-justify{text-align:justify !important}.hide{display:none}.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:0.25em}p aside{font-size:.875em;line-height:1.35;font-style:italic}h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.2;word-spacing:-0.05em}h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{color:#e99b8f;line-height:0}h1{font-size:2.125em}h2{font-size:1.6875em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}h4,h5{font-size:1.125em}h6{font-size:1em}ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}ul,ol{margin-left:1.5em}ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}ul.square{list-style-type:square}ul.circle{list-style-type:circle}ul.disc{list-style-type:disc}ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}dl dt{margin-bottom:.3125em;font-weight:bold}dl dd{margin-bottom:1.25em;margin-left:1.125em}blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,0.85)}@media screen and (min-width: 768px){h1{font-size:2.75em}h2{font-size:2.3125em}h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}h4{font-size:1.4375em}}table{background:#fff;border:1px solid #dedede;border-collapse:collapse;border-spacing:0;margin-bottom:1.25em;word-wrap:normal}table thead,table tfoot{background:#f7f8f7}table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,0.8);text-align:left}table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,0.8)}table tr.even,table tr.alt{background:#f8f8f7}table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}.center{margin-left:auto;margin-right:auto}.stretch{width:100%}.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:"";display:table}.clearfix::after,.float-group::after{clear:both}:not(pre).nobreak{word-wrap:normal}:not(pre).nowrap{white-space:nowrap}:not(pre).pre-wrap{white-space:pre-wrap}:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal !important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}pre>code{display:block}pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}.keyseq{color:rgba(51,51,51,0.8)}kbd{display:inline-block;color:rgba(0,0,0,0.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,0.2),inset 0 0 0 0.1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}.keyseq kbd:first-child{margin-left:0}.keyseq kbd:last-child{margin-right:0}.menuseq,.menuref{color:#000}.menuseq b:not(.caret),.menuref{font-weight:inherit}.menuseq{word-spacing:-0.02em}.menuseq b.caret{font-size:1.25em;line-height:0.8}.menuseq i.caret{font-weight:bold;text-align:center;width:0.45em}b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}b.button::before{content:"[";padding:0 3px 0 2px}b.button::after{content:"]";padding:0 2px 0 3px}p a>code:hover{color:rgba(0,0,0,0.9)}body>div[id]{margin:0 auto;max-width:62.5em;position:relative;padding-left:.9375em;padding-right:0.9375em}body>div[id]::before,body>div[id]::after,#content #footnotes::before{content:"";display:table;clear:both}#content{margin-top:1.25em;margin-bottom:0.625em}#content::before{content:none}#header>h1:first-child{color:rgba(0,0,0,0.85);margin-top:2.25rem;margin-bottom:0}#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,0.6);display:flex;flex-flow:row wrap}#header .details span:first-child{margin-left:-0.125em}#header .details span.email a{color:rgba(0,0,0,0.85)}#header .details br{display:none}#header .details br+span::before{content:" – "}#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,0.85)}#header .details br+span#revremark::before{content:" | "}#header #revnumber{text-transform:capitalize}#header #revnumber::after{content:" "}#content>h1:first-child:not([class]){color:rgba(0,0,0,0.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}#toc{border-bottom:1px solid #e7e7e9;padding-bottom:0.5em}#toc>ul{margin-left:0.125em}#toc ul.sectlevel0>li>a{font-style:italic}#toc ul.sectlevel0 ul.sectlevel1{margin:0.5em 0}#toc ul{font-family:"Open Sans", "DejaVu Sans", sans-serif;list-style-type:none}#toc li{line-height:1.3334;margin-top:0.3334em}#toc a{text-decoration:none}#toc a:active{text-decoration:underline}#toctitle{color:#7a2518;font-size:1.2em}@media screen and (min-width: 768px){#toctitle{font-size:1.375em}body.toc2{padding-left:15em;padding-right:0}#toc.toc2{margin-top:0 !important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0 !important;border-bottom-width:0 !important;z-index:1000;padding:1.25em 1em;height:calc(100% - (70px + 2.5em));overflow:auto}#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}#toc.toc2>ul{font-size:.9em;margin-bottom:0}#toc.toc2 ul ul{margin-left:0;padding-left:1em}#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:0.5em}body.toc2.toc-right{padding-left:0;padding-right:15em}body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}@media screen and (min-width: 1280px){body.toc2{padding-left:20em;padding-right:0}#toc.toc2{width:20em}#toc.toc2 #toctitle{font-size:1.375em}#toc.toc2>ul{font-size:0.95em}#toc.toc2 ul ul{padding-left:1.25em}body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}#content #toc>:first-child{margin-top:0}#content #toc>:last-child{margin-bottom:0}#footer{max-width:none;background:#025d8c;padding:1.25em;margin-left:2em}#footer-text{color:rgba(255,255,255,0.8);line-height:1.44}h1:before,h2:before,h3:before,h4:before,h5:before,h6:before,div.title:before{display:block;content:" ";height:90px;margin-top:-90px;visibility:hidden}.sect1{padding-bottom:0.625em}@media screen and (min-width: 768px){#content{margin-bottom:1.25em}.sect1{padding-bottom:1.25em}}.sect1:last-child{padding-bottom:0}.sect1+.sect1{border-top:1px solid #e7e7e9}#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none !important;visibility:hidden;text-align:center;font-weight:400}#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:0.1em}#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}details{margin-left:1.25rem}details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}details>summary::-webkit-details-marker{display:none}details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif", "DejaVu Serif", serif;font-size:1rem;font-style:italic}table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,0.85)}.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}.admonitionblock>table td.icon{text-align:center;width:80px}.admonitionblock>table td.icon img{max-width:none}.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans", "DejaVu Sans", sans-serif;text-transform:uppercase}.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,0.6);word-wrap:anywhere}.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}.exampleblock>.content{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#fffef7;border-radius:4px;box-shadow:0 1px 4px #e0e0dc}.exampleblock>.content>:first-child{margin-top:0}.exampleblock>.content>:last-child{margin-bottom:0}.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}.sidebarblock>:first-child{margin-top:0}.sidebarblock>:last-child{margin-bottom:0}.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:0.8125em}@media screen and (min-width: 768px){.literalblock pre,.listingblock>.content>pre{font-size:0.90625em}}@media screen and (min-width: 1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,0.9)}.listingblock>.content{position:relative}.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:0.5}.listingblock:hover code[data-lang]::before{display:block}.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:0.5}.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}.listingblock pre.highlightjs{padding:0}.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}.listingblock pre.prettyprint{border-width:0}.prettyprint{background:#f7f7f8}pre.prettyprint .linenums{line-height:1.45;margin-left:2em}pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}pre.prettyprint li code[data-lang]::before{opacity:1}pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}table.linenotable td.code{padding-left:0.75em}table.linenotable td.linenos{width:0.01%}table.linenotable td.linenos,pre.pygments .linenos,pre.rouge .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}pre.pygments span.linenos,pre.rouge span.linenos{display:inline-block;margin-right:0.75em}.quoteblock{margin:0 1em 1.25em 1.5em;display:table}.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:0.75em}.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,0.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}.quoteblock blockquote{margin:0;padding:0;border:0}.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,0.1)}.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}.verseblock{margin:0 1em 1.25em}.verseblock pre{font-family:"Open Sans", "DejaVu Sans", sans-serif;font-size:1.15rem;color:rgba(0,0,0,0.85);font-weight:300;text-rendering:optimizeLegibility}.verseblock pre strong{font-weight:400}.verseblock .attribution{margin-top:1.25rem;margin-left:0.5ex}.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}.quoteblock .attribution br,.verseblock .attribution br{display:none}.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,0.6)}.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}.quoteblock.abstract{margin:0 1em 1.25em;display:block}.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:0.25em solid #dddddf}.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}p.tableblock:last-child{margin-bottom:0}td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}td.tableblock>.content>:last-child{margin-bottom:-1.25em}table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}table.grid-all>*>tr>*{border-width:1px}table.grid-cols>*>tr>*{border-width:0 1px}table.grid-rows>*>tr>*{border-width:1px 0}table.frame-all{border-width:1px}table.frame-ends{border-width:1px 0}table.frame-sides{border-width:0 1px}table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}th.halign-left,td.halign-left{text-align:left}th.halign-right,td.halign-right{text-align:right}th.halign-center,td.halign-center{text-align:center}th.valign-top,td.valign-top{vertical-align:top}th.valign-bottom,td.valign-bottom{vertical-align:bottom}th.valign-middle,td.valign-middle{vertical-align:middle}table thead th,table tfoot th{font-weight:bold}tbody tr th{background:#f7f8f7}tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,0.8);font-weight:bold}p.tableblock>code:only-child{background:none;padding:0}p.tableblock{font-size:1em}ol{margin-left:1.75em}ul li ol{margin-left:1.5em}dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:0.625em}ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:0.625em}ul.unstyled,ol.unstyled{margin-left:0}li>p:empty:only-child::before{content:"";display:inline-block}ul.checklist>li>p:first-child{margin-left:-1em}ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:0.125em}ul.checklist>li>p:first-child>input[type=checkbox]:first-child{font:inherit;margin:0 .25em 0 0;padding:0}ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 0.625em -1.25em}ul.inline>li{margin-left:1.25em}.unstyled dl dt{font-weight:400;font-style:normal}ol.arabic{list-style-type:decimal}ol.decimal{list-style-type:decimal-leading-zero}ol.loweralpha{list-style-type:lower-alpha}ol.upperalpha{list-style-type:upper-alpha}ol.lowerroman{list-style-type:lower-roman}ol.upperroman{list-style-type:upper-roman}ol.lowergreek{list-style-type:lower-greek}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}td.hdlist1,td.hdlist2{vertical-align:top;padding:0 0.625em}td.hdlist1{font-weight:bold;padding-bottom:1.25em}td.hdlist2{word-wrap:anywhere}.literalblock+.colist,.listingblock+.colist{margin-top:-0.5em}.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}.colist td:not([class]):first-child img{max-width:none}.colist td:not([class]):last-child{padding:0.25em 0}.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}.imageblock.left{margin:0.25em 0.625em 1.25em 0}.imageblock.right{margin:0.25em 0 1.25em 0.625em}.imageblock>.title{margin-bottom:0}.imageblock.thumb,.imageblock.th{border-width:6px}.imageblock.thumb>.title,.imageblock.th>.title{padding:0 0.125em}.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}.image.left{margin-right:0.625em}.image.right{margin-left:0.625em}a.image{text-decoration:none;display:inline-block}a.image object{pointer-events:none}sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}sup.footnote a,sup.footnoteref a{text-decoration:none}sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:0.625em}#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:0.2em}#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}#footnotes .footnote:last-of-type{margin-bottom:0}#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:0.75em 0}div.page-break{display:none}div.unbreakable{page-break-inside:avoid}.big{font-size:larger}.small{font-size:smaller}.underline{text-decoration:underline}.overline{text-decoration:overline}.line-through{text-decoration:line-through}.aqua{color:#00bfbf}.aqua-background{background:#00fafa}.black{color:#000}.black-background{background:#000}.blue{color:#0000bf}.blue-background{background:#0000fa}.fuchsia{color:#bf00bf}.fuchsia-background{background:#fa00fa}.gray{color:#606060}.gray-background{background:#7d7d7d}.green{color:#006000}.green-background{background:#007d00}.lime{color:#00bf00}.lime-background{background:#00fa00}.maroon{color:#600000}.maroon-background{background:#7d0000}.navy{color:#000060}.navy-background{background:#00007d}.olive{color:#606000}.olive-background{background:#7d7d00}.purple{color:#600060}.purple-background{background:#7d007d}.red{color:#bf0000}.red-background{background:#fa0000}.silver{color:#909090}.silver-background{background:#bcbcbc}.teal{color:#006060}.teal-background{background:#007d7d}.white{color:#bfbfbf}.white-background{background:#fafafa}.yellow{color:#bfbf00}.yellow-background{background:#fafa00}span.icon>.fa{cursor:default}a span.icon>.fa{cursor:inherit}.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,0.5);cursor:default}.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,0.8);color:#111}.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}.conum[data-value]{display:inline-block;color:#fff !important;background:rgba(0,0,0,0.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans", "DejaVu Sans", sans-serif;font-style:normal;font-weight:bold}.conum[data-value] *{color:#fff !important}.conum[data-value]+b{display:none}.conum[data-value]::after{content:attr(data-value)}pre .conum[data-value]{position:relative;top:-0.125em}b.conum *{color:inherit !important}.conum:not([data-value]):empty{display:none}dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}h1,h2,p,td.content,span.alt,summary{letter-spacing:-0.01em}p strong,td.content strong,div.footnote strong{letter-spacing:-0.005em}p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}.print-only{display:none !important}@page{margin:1.25cm 0.75cm}@media print{*{box-shadow:none !important;text-shadow:none !important}html{font-size:80%}a{color:inherit !important;text-decoration:underline !important}a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none !important}a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:0.25em}abbr[title]{border-bottom:1px dotted}abbr[title]::after{content:" (" attr(title) ")"}pre,blockquote,tr,img,object,svg{page-break-inside:avoid}thead{display:table-header-group}p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}body>div[id]{max-width:none}#toc,.sidebarblock,.exampleblock>.content{background:none !important}#toc{border-bottom:1px solid #dddddf !important;padding-bottom:0 !important}body.book #header{text-align:center}body.book #header>h1:first-child{border:0 !important;margin:2.5em 0 1em}body.book #header .details{border:0 !important;display:block;padding:0 !important}body.book #header .details span:first-child{margin-left:0 !important}body.book #header .details br{display:block}body.book #header .details br+span::before{content:none !important}body.book #toc{border:0 !important;text-align:left !important;padding:0 !important;margin:0 !important}body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}.listingblock code[data-lang]::before{display:block}div.page-break{display:block;page-break-after:always}#footer{padding:0 0.9375em}.hide-on-print{display:none !important}.print-only{display:block !important}.hide-for-print{display:none !important}.show-for-print{display:inherit !important}}@media amzn-kf8, print{#header>h1:first-child{margin-top:1.25rem}.sect1{padding:0 !important}.sect1+.sect1{border:0}#footer{background:none}#footer-text{color:rgba(0,0,0,0.6);font-size:0.9em}}@media amzn-kf8{body>div[id]{padding:0}}body{padding:0;margin:0;margin-top:70px !important}.container{position:relative;z-index:1;padding-top:50px;min-height:100%}.container p{font-family:sans-serif;font-size:1.2em}nav{position:fixed;z-index:9999;left:0;right:0;top:0;height:70px;padding:0 1.5em;background-color:#025d8c;font-family:sans-serif;line-height:70px}nav .logo{width:50px;vertical-align:middle}nav .nav-menu{position:absolute;right:0.3em;top:0;padding:0;margin:0;list-style:none}nav .nav-item{display:inline-block}nav .nav-item>a{display:inline-block;padding:0 2.5em;line-height:70px;color:#fff;text-decoration:none}nav .dropdown{position:relative}nav .dropdown a::after{content:"";display:inline-block;margin-left:0.5em;vertical-align:middle;border-top:0.3em solid #fff;border-right:0.3em solid transparent;border-left:0.3em solid transparent}nav .dropdown.show a::after{transform:rotate(180deg)}nav .dropdown-menu{display:none;position:absolute;left:0;right:0;top:100%;padding:0.5em 0;margin-top:-0.5em;border:1px solid rgba(0,0,0,0.3);border-radius:0.5em;background-color:#fff;width:max-content;max-height:80vh;overflow:scroll}nav .dropdown-menu-left{left:auto;right:0}nav .dropdown.show .dropdown-menu{display:block}nav .dropdown-div{display:block;padding:0.4em 0;line-height:4em}nav .dropdown-div a::after{content:none;margin-left:0;border-top:0;border-right:0;border-left:0}nav .dropdown-item{display:block;padding:0 1.5em;font-size:0.875em;color:#000;line-height:1.6em;text-decoration:none}nav .btn-hamburger{display:none;position:absolute;right:1.5em;top:50%;background-color:transparent;border:0;cursor:pointer;outline:none;transform:translateY(-50%)}nav .btn-hamburger span{display:block;width:30px;height:4px;background-color:#fff;margin:6px;border-radius:2px;transition:0.3s ease-in-out}nav .btn-hamburger span:nth-child(4),nav .btn-hamburger span:nth-child(5){position:absolute;top:10px;opacity:0.5}nav .btn-hamburger span:nth-child(4){transform:rotate(45deg) scale(0)}nav .btn-hamburger span:nth-child(5){transform:rotate(-45deg) scale(0)}nav.opened .btn-hamburger span:nth-child(4){opacity:1;transform:rotate(45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(5){opacity:1;transform:rotate(-45deg) scale(1)}nav.opened .btn-hamburger span:nth-child(1),nav.opened .btn-hamburger span:nth-child(2),nav.opened .btn-hamburger span:nth-child(3){opacity:0}@media screen and (max-width: 768px){nav .nav-menu{position:fixed;left:0;right:0;top:70px;bottom:100%;display:flex;flex-direction:column;justify-content:start;background-color:#363d4e;transition:bottom 0.5s ease-in-out;overflow:hidden}nav.opened .nav-menu{bottom:0}nav .nav-item>a{display:block}nav .dropdown-menu{position:relative;top:0;margin:0 1.5em}nav .btn-hamburger{display:block}}/*!
* "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License
* https://github.com/simonwhitaker/github-fork-ribbon-css

The MIT License (MIT)

Copyright (c) 2013 Simon Whitaker

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/.github-fork-ribbon,.release-ribbon,.issue-ribbon{width:12.1em;height:12.1em;position:absolute;overflow:hidden;top:70px;right:0;z-index:9998;pointer-events:none;font-size:13px;text-decoration:none;text-indent:-999999px}.github-fork-ribbon.fixed,.fixed.release-ribbon,.fixed.issue-ribbon{position:fixed}.github-fork-ribbon:hover,.release-ribbon:hover,.issue-ribbon:hover,.github-fork-ribbon:active,.release-ribbon:active,.issue-ribbon:active{background-color:transparent}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before,.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{position:absolute;display:block;width:15.38em;height:1.54em;top:3.23em;right:-3.23em;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.github-fork-ribbon:before,.release-ribbon:before,.issue-ribbon:before{content:"";padding:.38em 0;background-color:#a00;background-image:-webkit-gradient(linear, left top, left bottom, from(transparent), to(rgba(0,0,0,0.15)));background-image:-webkit-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-moz-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-ms-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:-o-linear-gradient(top, transparent, rgba(0,0,0,0.15));background-image:linear-gradient(to bottom, transparent, rgba(0,0,0,0.15));-webkit-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);-moz-box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);box-shadow:0 0.15em 0.23em 0 rgba(0,0,0,0.5);pointer-events:auto}.github-fork-ribbon:after,.release-ribbon:after,.issue-ribbon:after{content:attr(data-ribbon);color:#fff;font:700 1em "Helvetica Neue", Helvetica, Arial, sans-serif;line-height:1.54em;text-decoration:none;text-shadow:0 -0.08em rgba(0,0,0,0.5);text-align:center;text-indent:0;padding:.15em 0;margin:.15em 0;border-width:.08em 0;border-style:dotted;border-color:#fff;border-color:rgba(255,255,255,0.7)}.github-fork-ribbon.left-top,.left-top.release-ribbon,.left-top.issue-ribbon,.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon{right:auto;left:0}.github-fork-ribbon.left-bottom,.left-bottom.release-ribbon,.left-bottom.issue-ribbon,.github-fork-ribbon.right-bottom,.right-bottom.release-ribbon,.right-bottom.issue-ribbon{top:auto;bottom:0}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after{right:auto;left:-3.23em}.github-fork-ribbon.left-bottom:before,.left-bottom.release-ribbon:before,.left-bottom.issue-ribbon:before,.github-fork-ribbon.left-bottom:after,.left-bottom.release-ribbon:after,.left-bottom.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{top:auto;bottom:3.23em}.github-fork-ribbon.left-top:before,.left-top.release-ribbon:before,.left-top.issue-ribbon:before,.github-fork-ribbon.left-top:after,.left-top.release-ribbon:after,.left-top.issue-ribbon:after,.github-fork-ribbon.right-bottom:before,.right-bottom.release-ribbon:before,.right-bottom.issue-ribbon:before,.github-fork-ribbon.right-bottom:after,.right-bottom.release-ribbon:after,.right-bottom.issue-ribbon:after{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}.release-ribbon:before{background-color:#a00}.issue-ribbon:before{background-color:#025d8c}@media screen{div.narrow{max-width:1080px;margin:0 auto !important;margin-top:70px auto !important;float:none !important}#toc.toc2{margin-top:70px !important}}

</style>
<!-- Generate a nice TOC -->
<script src="/js/jquery-1.11.3.min.js"></script>
<script src="/js/jquery-ui.min.js"></script>
<script src="/js/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we need -->

<style>
.tocify-header {
    /* font-style: italic; */
}

.tocify-subheader {
    font-style: normal;
    font-size: 95%;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    /* background-color: rgba(0, 0, 0, 0.05);*/
}

.tocify-focus > a {
    color: #ba3925;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>
<style>
/*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
.tabs {
  margin-bottom: 1.25em;
}

.tablist > ul {
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  margin: 0;
  padding: 0;
}

.tablist > ul li {
  align-items: center;
  background-color: #fff;
  cursor: pointer;
  display: flex;
  font-weight: bold;
  line-height: 1.5;
  padding: 0.25em 1em;
  position: relative;
}

.tablist > ul li:focus-visible {
  outline: none;
}

.tablist.ulist,
.tablist.ulist > ul li {
  margin: 0;
}

.tablist.ulist > ul li + li {
  margin-left: 0.25em;
}

.tabs .tablist li::after {
  content: "";
  display: block;
  height: 1px;
  position: absolute;
  bottom: -1px;
  left: 0;
  right: 0;
}

.tabs.is-loading .tablist li:not(:first-child),
.tabs:not(.is-loading) .tablist li:not(.is-selected) {
  background-color: #f5f5f5;
}

.tabs.is-loading .tablist li:first-child::after,
.tabs:not(.is-loading) .tablist li.is-selected::after {
  background-color: #fff;
}

/*
.tabs:not(.is-loading) .tablist li,
.tabs:not(.is-loading) .tablist li::after {
  transition: background-color 200ms ease-in-out;
}
*/

.tablist > ul p {
  line-height: inherit;
  margin: 0;
}

.tabpanel {
  background-color: #fff;
  padding: 1.25em;
}

.tablist > ul li,
.tabpanel {
  border: 1px solid #dcdcdc;
}

.tablist > ul li {
  border-bottom: 0;
}

.tabs.is-loading .tabpanel + .tabpanel,
.tabs:not(.is-loading) .tabpanel.is-hidden {
  display: none;
}

.tabpanel > :first-child {
  margin-top: 0;
}

/* #content is a signature of the Asciidoctor standalone HTML output */
#content .tabpanel > :last-child,
#content .tabpanel > :last-child > :last-child,
#content .tabpanel > :last-child > :last-child > li:last-child > :last-child {
  margin-bottom: 0;
}

.tablecontainer {
  overflow-x: auto;
}

#content .tablecontainer {
  margin-bottom: 1.25em;
}

#content .tablecontainer > table.tableblock {
  margin-bottom: 0;
}
</style>
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Provisioning hosts</h1>
<div class="details">
<span id="revnumber">version Nightly,</span>
<span id="revdate">published Sep 2025</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Introduction_to_Provisioning_provisioning">1. Introduction to provisioning</a>
<ul class="sectlevel2">
<li><a href="#Provisioning-Methods-in-Foreman_provisioning">1.1. Provisioning methods in Foreman</a></li>
<li><a href="#provisioning-hardware-types">1.2. Provisioning hardware types</a></li>
<li><a href="#supported-client-platforms-in-provisioning">1.3. Supported client platforms in provisioning</a></li>
<li><a href="#supported-cloud-providers">1.4. Supported cloud providers</a></li>
<li><a href="#supported-virtualization-infrastructures">1.5. Supported virtualization infrastructures</a></li>
</ul>
</li>
<li><a href="#preparing-networking">2. Preparing networking</a>
<ul class="sectlevel2">
<li><a href="#facts-and-nic-filtering_provisioning">2.1. Facts and NIC filtering</a></li>
<li><a href="#optimizing-performance-by-removing-nics-from-database_provisioning">2.2. Optimizing performance by removing NICs from database</a></li>
<li><a href="#Network_Resources_provisioning">2.3. Network resources</a>
<ul class="sectlevel3">
<li><a href="#options-in-managed-dhcpv4">2.3.1. Options in managed DHCPv4</a></li>
<li><a href="#options-in-unmanaged-dhcpv6">2.3.2. Options in unmanaged DHCPv6</a></li>
</ul>
</li>
<li><a href="#Prerequisites_for_Image_Based_Provisioning_provisioning">2.4. Prerequisites for image-based provisioning</a>
<ul class="sectlevel3">
<li><a href="#Multiple_Subnets_or_Domains_Using_Installer_provisioning">2.4.1. Multiple subnets or domains using installer</a></li>
<li><a href="#DNS_Options_For_Network_Configuration_provisioning">2.4.2. DNS options for network configuration</a></li>
<li><a href="#TFTP_Options_For_Network_Configuration_provisioning">2.4.3. TFTP options for network configuration</a></li>
</ul>
</li>
<li><a href="#Adding_a_Domain_to_Server_provisioning">2.5. Adding a domain to Foreman&#160;server</a></li>
<li><a href="#Adding_a_Subnet_to_Server_provisioning">2.6. Adding a subnet to Foreman&#160;server</a></li>
</ul>
</li>
<li><a href="#preparing-provisioning-content">3. Preparing provisioning content</a>
<ul class="sectlevel2">
<li><a href="#adding-installation-media_provisioning">3.1. Adding installation media to Foreman</a></li>
<li><a href="#Creating_an_Installation_Medium_for_Debian-Ubuntu_provisioning">3.2. Creating an installation medium for Debian/Ubuntu</a></li>
<li><a href="#creating-an-installation-medium-for-ubuntu-22-04">3.3. Creating an installation medium for Ubuntu 22.04</a></li>
<li><a href="#Provisioning_Ubuntu_Autoinstall_Through_Smart_Proxies_provisioning">3.4. Provisioning Ubuntu autoinstall through Smart&#160;Proxies</a></li>
<li><a href="#configuring-foreman-to-provision-from-a-builder-image">3.5. Configuring Foreman to provision from a Lorax Composer image</a>
<ul class="sectlevel3">
<li><a href="#provisioning-from-a-builder-image-on-an-http-server">3.5.1. Provisioning from a Lorax Composer image on an HTTP server</a></li>
<li><a href="#packages-required-in-a-builder-image">3.5.2. Packages required in a Lorax Composer image</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#preparing-client-platforms">4. Preparing client platforms</a>
<ul class="sectlevel2">
<li><a href="#creating-operating-systems_provisioning">4.1. Creating operating systems</a></li>
<li><a href="#Creating-an-operating-system-for-Debian-12_provisioning">4.2. Creating an operating system for Debian 12</a></li>
<li><a href="#Creating-an-operating-system-for-Debian-11_provisioning">4.3. Creating an operating system for Debian 11</a></li>
<li><a href="#Creating-an-operating-system-for-Ubuntu-24-04_provisioning">4.4. Creating an operating system for Ubuntu 24.04</a></li>
<li><a href="#Creating-an-operating-system-for-Ubuntu-22-04_provisioning">4.5. Creating an operating system for Ubuntu 22.04</a></li>
<li><a href="#updating-the-details-of-multiple-operating-systems_provisioning">4.6. Updating the details of multiple operating systems</a></li>
<li><a href="#creating-architectures_provisioning">4.7. Creating architectures</a></li>
<li><a href="#creating-hardware-models_provisioning">4.8. Creating hardware models</a></li>
<li><a href="#creating-compute-profiles_provisioning">4.9. Creating compute profiles</a></li>
</ul>
</li>
<li><a href="#preparing-templates-for-provisioning">5. Preparing templates for provisioning</a>
<ul class="sectlevel2">
<li><a href="#provisioning-templates">5.1. Provisioning templates</a></li>
<li><a href="#kinds-of-provisioning-templates">5.2. Kinds of provisioning templates</a></li>
<li><a href="#creating-provisioning-templates">5.3. Creating provisioning templates</a></li>
<li><a href="#cloning-provisioning-templates">5.4. Cloning provisioning templates</a></li>
<li><a href="#running-custom-code-during-host-provisioning">5.5. Running custom code during host provisioning</a></li>
<li><a href="#Custom_Provisioning_Snippet_Example_for_Debian_provisioning">5.6. Custom provisioning snippet example for Debian</a></li>
<li><a href="#Custom_Provisioning_Snippet_Example_for_Enterprise_Linux_provisioning">5.7. Custom provisioning snippet example for Enterprise Linux</a></li>
<li><a href="#custom-provisioning-snippet-example-for-sles">5.8. Custom provisioning snippet example for SUSE Linux Enterprise Server</a></li>
<li><a href="#associating-templates-with-operating-systems">5.9. Associating templates with operating systems</a></li>
<li><a href="#creating-partition-tables_provisioning">5.10. Creating partition tables</a></li>
<li><a href="#associating-partition-tables-with-disk-encryption_provisioning">5.11. Associating partition tables with disk encryption</a></li>
<li><a href="#dynamic-partition-example_provisioning">5.12. Dynamic partition example</a></li>
</ul>
</li>
<li><a href="#security-settings">6. Security settings</a>
<ul class="sectlevel2">
<li><a href="#configuring-the-security-token-validity-duration">6.1. Configuring the security token validity duration</a></li>
<li><a href="#setting-a-default-encrypted-root-password_provisioning">6.2. Setting a default encrypted root password for hosts</a></li>
<li><a href="#Provisioning_FIPS_Compliant_Hosts_provisioning">6.3. Provisioning FIPS-compliant hosts</a>
<ul class="sectlevel3">
<li><a href="#Changing_the_Provisioning_Password_Hashing_Algorithm_provisioning">6.3.1. Changing the provisioning password hashing algorithm</a></li>
<li><a href="#Setting_the_FIPS_Enabled_Parameter_provisioning">6.3.2. Setting the FIPS-enabled parameter</a></li>
<li><a href="#Verifying_FIPS_Mode_Is_Enabled_provisioning">6.3.3. Verifying FIPS mode is enabled</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#provisioning-contexts_provisioning">7. Provisioning contexts</a>
<ul class="sectlevel2">
<li><a href="#setting-the-provisioning-context_provisioning">7.1. Setting the provisioning context</a></li>
</ul>
</li>
<li><a href="#using-network-boot-to-provision-hosts">8. Using network boot to provision hosts</a>
<ul class="sectlevel2">
<li><a href="#Network_Boot_Provisioning_Workflow_using-network-boot">8.1. Network boot provisioning workflow</a></li>
<li><a href="#prerequisites-for-network-boot-provisioning">8.2. Prerequisites for network-boot provisioning</a></li>
<li><a href="#required-boot-order-for-network-boot_using-network-boot">8.3. Required boot order for network boot</a></li>
<li><a href="#configuring-smart-proxy-for-secure-boot">8.4. Configuring Smart&#160;Proxy for Secure Boot</a>
<ul class="sectlevel3">
<li><a href="#configuring-smart-proxy-to-provision-almalinux-on-Secure-Boot-enabled-hosts">8.4.1. Configuring Smart&#160;Proxy to provision AlmaLinux on Secure Boot enabled hosts</a></li>
<li><a href="#configuring-smart-proxy-to-provision-debian-on-Secure-Boot-enabled-hosts">8.4.2. Configuring Smart&#160;Proxy to provision Debian on Secure Boot enabled hosts</a></li>
<li><a href="#configuring-smart-proxy-to-provision-rocky-on-Secure-Boot-enabled-hosts">8.4.3. Configuring Smart&#160;Proxy to provision Rocky Linux on Secure Boot enabled hosts</a></li>
<li><a href="#configuring-smart-proxy-to-provision-rhel-on-Secure-Boot-enabled-hosts">8.4.4. Configuring Smart&#160;Proxy to provision Red&#160;Hat Enterprise Linux on Secure Boot enabled hosts</a></li>
<li><a href="#configuring-smart-proxy-to-provision-ubuntu-on-Secure-Boot-enabled-hosts">8.4.5. Configuring Smart&#160;Proxy to provision Ubuntu on Secure Boot enabled hosts</a></li>
</ul>
</li>
<li><a href="#creating-hosts-with-pxe-boot-provisioning">8.5. Creating hosts with PXE boot provisioning</a></li>
<li><a href="#configuring-smart-proxy-for-uefi-http-booting">8.6. Configuring Smart&#160;Proxy for UEFI HTTP booting</a></li>
<li><a href="#creating-hosts-with-uefi-http-boot-provisioning">8.7. Creating hosts with UEFI HTTP boot provisioning</a></li>
<li><a href="#Deploying_SSH_Keys_During_Provisioning_using-network-boot">8.8. Deploying SSH keys during provisioning</a></li>
<li><a href="#using-ipxe-to-reduce-provisioning-times_using-network-boot">8.9. Using iPXE to reduce provisioning times</a>
<ul class="sectlevel3">
<li><a href="#prerequisites-for-using-ipxe_using-network-boot">8.9.1. Prerequisites for using iPXE</a></li>
<li><a href="#Configuring_iPXE_Environment_using-network-boot">8.9.2. Configuring iPXE environment</a></li>
<li><a href="#Booting_Virtual_Machines_using-network-boot">8.9.3. Booting virtual machines</a></li>
<li><a href="#Chainbooting_iPXE_from_PXELinux_using-network-boot">8.9.4. Chainbooting iPXE from PXELinux</a></li>
</ul>
</li>
<li><a href="#pxe-loaders">8.10. PXE loaders</a></li>
</ul>
</li>
<li><a href="#using-boot-disks-to-provision-hosts">9. Using boot disks to provision hosts</a>
<ul class="sectlevel2">
<li><a href="#boot-disk-workflow">9.1. Boot disk workflow</a></li>
<li><a href="#boot-disk-types">9.2. Boot disk types</a></li>
<li><a href="#enabling-bootdisk-plugin">9.3. Enabling Bootdisk plugin</a></li>
<li><a href="#generating-a-full-host-boot-disk">9.4. Generating a full host boot disk</a></li>
<li><a href="#generating-a-subnet-boot-disk">9.5. Generating a subnet boot disk</a></li>
<li><a href="#generating-a-generic-boot-disk">9.6. Generating a generic boot disk</a></li>
<li><a href="#generating-a-host-boot-disk">9.7. Generating a host boot disk</a></li>
<li><a href="#Deploying_SSH_Keys_During_Provisioning_using-bootdisks">9.8. Deploying SSH keys during provisioning</a></li>
</ul>
</li>
<li><a href="#discovering-hosts-on-a-network">10. Discovering hosts on a network</a>
<ul class="sectlevel2">
<li><a href="#prerequisites-for-using-discovery_provisioning">10.1. Prerequisites for using Discovery</a></li>
<li><a href="#Installing_the_Discovery_Service_provisioning">10.2. Installing the Discovery service</a></li>
<li><a href="#discovery-in-pxe-mode">10.3. Discovery in PXE mode</a>
<ul class="sectlevel3">
<li><a href="#setting-discovery-as-the-default-PXE-boot-option_provisioning">10.3.1. Setting Discovery as the default PXE boot option</a></li>
<li><a href="#performing-discovery-in-pxe-mode_provisioning">10.3.2. Performing Discovery in PXE mode</a></li>
<li><a href="#Customizing_the_Discovery_PXE_Boot_provisioning">10.3.3. Customizing the Discovery PXE boot</a></li>
</ul>
</li>
<li><a href="#discovery-in-pxeless-mode">10.4. Discovery in PXE-less mode</a>
<ul class="sectlevel3">
<li><a href="#performing-discovery-in-pxeless-mode_provisioning">10.4.1. Performing Discovery in PXE-less mode</a></li>
<li><a href="#customizing-the-discovery-iso_provisioning">10.4.2. Customizing the Discovery ISO</a></li>
</ul>
</li>
<li><a href="#Automatic_Contexts_for_Discovered_Hosts_provisioning">10.5. Automatic contexts for discovered hosts</a></li>
<li><a href="#Creating_Hosts_from_Discovered_Hosts_provisioning">10.6. Creating hosts from discovered hosts</a></li>
<li><a href="#Creating_Discovery_Rules_provisioning">10.7. Creating Discovery rules</a></li>
<li><a href="#Extending_the_Discovery_Image_provisioning">10.8. Extending the Discovery image</a></li>
<li><a href="#Building_a_custom_Discovery_Image_provisioning">10.9. Building a custom Discovery image</a></li>
<li><a href="#kernel-parameters-for-discovery-customization_provisioning">10.10. Kernel parameters for Discovery customization</a></li>
<li><a href="#Troubleshooting_Discovery_provisioning">10.11. Troubleshooting Discovery</a></li>
</ul>
</li>
<li><a href="#Provisioning_Virtual_Machines_on_KVM_kvm-provisioning">11. Provisioning virtual machines on KVM (libvirt)</a>
<ul class="sectlevel2">
<li><a href="#enabling-libvirt-plugin">11.1. Enabling libvirt plugin</a></li>
<li><a href="#configuring-server-for-kvm-connections_kvm-provisioning">11.2. Configuring Foreman&#160;server for KVM connections</a></li>
<li><a href="#adding-kvm-connection_kvm-provisioning">11.3. Adding a KVM connection to Foreman&#160;server</a></li>
<li><a href="#adding-images-to-server_kvm-provisioning">11.4. Adding KVM images to Foreman&#160;server</a></li>
<li><a href="#adding-kvm-details-to-a-compute-profile_kvm-provisioning">11.5. Adding KVM details to a compute profile</a></li>
<li><a href="#creating-network-or-image-based-hosts_kvm-provisioning">11.6. Creating hosts on KVM</a></li>
</ul>
</li>
<li><a href="#Provisioning_Virtual_Machines_in_VMware_vmware-provisioning">12. Provisioning virtual machines in VMware vSphere</a>
<ul class="sectlevel2">
<li><a href="#Installing_VMware_plugin_vmware-provisioning">12.1. Installing VMware plugin</a></li>
<li><a href="#Prerequisites_for_VMware_Provisioning_vmware-provisioning">12.2. Prerequisites for VMware provisioning</a></li>
<li><a href="#Creating_a_VMware_User_vmware-provisioning">12.3. Creating a VMware user</a></li>
<li><a href="#Adding_a_VMware_Connection_to_Server_vmware-provisioning">12.4. Adding a VMware connection to Foreman&#160;server</a></li>
<li><a href="#Adding_VMware_Images_to_Server_vmware-provisioning">12.5. Adding VMware images to Foreman&#160;server</a></li>
<li><a href="#Adding_VMware_Details_to_a_Compute_Profile_vmware-provisioning">12.6. Adding VMware details to a compute profile</a></li>
<li><a href="#Creating_Hosts_on_VMware_vmware-provisioning">12.7. Creating hosts on VMware</a></li>
<li><a href="#Using_VMware_Cloud_Init_and_Userdata_Templates_for_Provisioning_vmware-provisioning">12.8. Using VMware cloud-init and userdata templates for provisioning</a></li>
<li><a href="#Deleting_a_VM_on_VMware_vmware-provisioning">12.9. Deleting a VM on VMware</a></li>
<li><a href="#Importing-a_virtual-machine-from-VMware-into-foreman_vmware-provisioning">12.10. Importing a virtual machine from VMware into Foreman</a></li>
<li><a href="#Caching_of_Compute_Resources_vmware-provisioning">12.11. Caching of compute resources</a>
<ul class="sectlevel3">
<li><a href="#Enabling_Caching_of_Compute_Resources_vmware-provisioning">12.11.1. Enabling caching of compute resources</a></li>
<li><a href="#Refreshing_the_Compute_Resources_Cache_vmware-provisioning">12.11.2. Refreshing the compute resources cache</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Provisioning_Virtual_Machines_in_Proxmox_proxmox-provisioning">13. Provisioning virtual machines in Proxmox</a>
<ul class="sectlevel2">
<li><a href="#Installing_the_Proxmox_plugin_proxmox-provisioning">13.1. Installing the Proxmox plugin</a></li>
<li><a href="#Adding_a_Proxmox_Connection_to_foreman_proxmox-provisioning">13.2. Adding a Proxmox connection to Foreman&#160;server</a></li>
<li><a href="#adding-proxmox-images-to-foreman-by-using-web-ui">13.3. Adding Proxmox images to Foreman by using Foreman web UI</a></li>
<li><a href="#adding-proxmox-images-to-foreman-by-using-cli">13.4. Adding Proxmox images to Foreman by using Hammer CLI</a></li>
<li><a href="#Adding_Proxmox_Details_to_a_Compute_Profile_proxmox-provisioning">13.5. Adding Proxmox details to a compute profile</a></li>
<li><a href="#Creating_Hosts_on_Proxmox_proxmox-provisioning">13.6. Creating hosts on Proxmox</a></li>
<li><a href="#Deleting_a_Virtual_Machine_on_Proxmox_proxmox-provisioning">13.7. Deleting a virtual machine on Proxmox</a></li>
<li><a href="#Importing-a_virtual-machine-from-Proxmox-into-foreman_proxmox-provisioning">13.8. Importing a virtual machine from Proxmox into Foreman</a></li>
<li><a href="#Adding_a_Remote_Console_Connection_for_a_Host_on_Proxmox_proxmox-provisioning">13.9. Adding a remote console connection for a host on Proxmox</a></li>
</ul>
</li>
<li><a href="#Provisioning_Virtual_Machines_Kubevirt_kubevirt-provisioning">14. Provisioning virtual machines on KubeVirt</a>
<ul class="sectlevel2">
<li><a href="#adding-kubevirt-connection_kubevirt-provisioning">14.1. Adding a KubeVirt connection to Foreman&#160;server</a></li>
</ul>
</li>
<li><a href="#Provisioning_Cloud_Instances_OpenStack_openstack-provisioning">15. Provisioning cloud instances on OpenStack</a>
<ul class="sectlevel2">
<li><a href="#adding-openstack-connection_openstack-provisioning">15.1. Adding a OpenStack connection to Foreman&#160;server</a></li>
<li><a href="#adding-images-to-server_openstack-provisioning">15.2. Adding OpenStack images to Foreman&#160;server</a></li>
<li><a href="#adding-openstack-details-to-a-compute-profile_openstack-provisioning">15.3. Adding OpenStack details to a compute profile</a></li>
<li><a href="#creating-image-only-hosts_openstack-provisioning">15.4. Creating image-based hosts on OpenStack</a></li>
</ul>
</li>
<li><a href="#provisioning-cloud-instances-on-amazon-ec2">16. Provisioning cloud instances on Amazon EC2</a>
<ul class="sectlevel2">
<li><a href="#Prerequisites_for_Amazon_EC2_Provisioning_ec2-provisioning">16.1. Prerequisites for Amazon EC2 provisioning</a></li>
<li><a href="#Installing_Amazon_EC2_plugin_ec2-provisioning">16.2. Installing Amazon EC2 plugin</a></li>
<li><a href="#using-an-http-proxy-to-communicate-with-amazon-ec2">16.3. Using an HTTP proxy to communicate with Amazon EC2</a></li>
<li><a href="#Adding_an_Amazon_EC2_Connection_to_Server_ec2-provisioning">16.4. Adding an Amazon EC2 connection to the Foreman&#160;server</a></li>
<li><a href="#Creating_an_Image_for_Amazon_EC2_ec2-provisioning">16.5. Creating an image for Amazon EC2</a></li>
<li><a href="#Adding_Amazon_EC2_Images_to_Server_ec2-provisioning">16.6. Adding Amazon EC2 images to Foreman&#160;server</a></li>
<li><a href="#Adding_Amazon_EC2_Details_to_a_Compute_Profile_ec2-provisioning">16.7. Adding Amazon EC2 details to a compute profile</a></li>
<li><a href="#Creating_Image_Based_Hosts_on_Amazon_EC2_ec2-provisioning">16.8. Creating image-based hosts on Amazon EC2</a></li>
<li><a href="#Connecting_to_an_Amazon_EC2_Instance_Using_SSH_ec2-provisioning">16.9. Connecting to an Amazon EC2 instance using SSH</a></li>
<li><a href="#Configuring_a_Finish_Template_for_Amazon_EC2_ec2-provisioning">16.10. Configuring a finish template for an Amazon Web Service EC2 environment</a></li>
<li><a href="#Deleting_a_Virtual_Machine_on_Amazon_EC2_ec2-provisioning">16.11. Deleting a virtual machine on Amazon EC2</a></li>
<li><a href="#Uninstalling_Amazon_EC2_plugin_ec2-provisioning">16.12. Uninstalling Amazon EC2 plugin</a></li>
<li><a href="#More_Information_About_Amazon_Web_Services_ec2-provisioning">16.13. More information about Amazon Web Services and Foreman</a></li>
</ul>
</li>
<li><a href="#Provisioning_Cloud_Instances_on_Google_Compute_Engine_gce-provisioning">17. Provisioning cloud instances on Google Compute Engine</a>
<ul class="sectlevel2">
<li><a href="#Installing_Google_GCE_plugin_gce-provisioning">17.1. Installing Google GCE plugin</a></li>
<li><a href="#Adding_a_Google_GCE_Connection_gce-provisioning">17.2. Adding a Google GCE connection to Foreman&#160;server</a></li>
<li><a href="#adding-images-to-server_gce-provisioning">17.3. Adding Google Compute Engine images to Foreman&#160;server</a></li>
<li><a href="#Adding_Google_GCE_Details_to_a_Compute_Profile_gce-provisioning">17.4. Adding Google GCE details to a compute profile</a></li>
<li><a href="#creating-image-only-hosts_gce-provisioning">17.5. Creating image-based hosts on Google Compute Engine</a></li>
<li><a href="#Deleting_a_VM_on_Google_GCE_gce-provisioning">17.6. Deleting a VM on Google GCE</a></li>
</ul>
</li>
<li><a href="#Provisioning_Cloud_Instances_on_Microsoft_Azure_Resource_Manager_azure-provisioning">18. Provisioning cloud instances on Microsoft Azure Resource Manager</a>
<ul class="sectlevel2">
<li><a href="#Installing_Microsoft_Azure_plugin_azure-provisioning">18.1. Installing Microsoft Azure plugin</a></li>
<li><a href="#Adding_a_Microsoft_Azure_Resource_Manager_Connection_azure-provisioning">18.2. Adding a Microsoft Azure Resource Manager connection to Foreman&#160;server</a></li>
<li><a href="#adding-images-to-server_azure-provisioning">18.3. Adding Microsoft Azure Resource Manager images to Foreman&#160;server</a></li>
<li><a href="#Adding_Microsoft_Azure_Resource_Manager_Details_to_a_Compute_Profile_azure-provisioning">18.4. Adding Microsoft Azure Resource Manager details to a compute profile</a></li>
<li><a href="#creating-image-only-hosts_azure-provisioning">18.5. Creating image-based hosts on Microsoft Azure Resource Manager</a></li>
<li><a href="#Deleting_a_VM_on_Microsoft_Azure_azure-provisioning">18.6. Deleting a VM on Microsoft Azure</a></li>
<li><a href="#Uninstalling_Microsoft_Azure_plugin_azure-provisioning">18.7. Uninstalling Microsoft Azure plugin</a></li>
</ul>
</li>
<li><a href="#using-novnc-to-access-virtual-machines_provisioning">Appendix A: Using noVNC to access virtual machines</a></li>
<li><a href="#Host_Parameter_Hierarchy_provisioning">Appendix B: Host parameter hierarchy</a></li>
<li><a href="#permissions-required-to-provision-hosts">Appendix C: Permissions required to provision hosts</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="Introduction_to_Provisioning_provisioning"><a class="anchor" href="#Introduction_to_Provisioning_provisioning"></a>1. Introduction to provisioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Provisioning is a process that starts with a blank machine and ends with a fully configured, ready-to-use operating system.
Using Foreman, you can define and automate fine-grained provisioning for a large number of hosts.</p>
</div>
<div class="sect2">
<h3 id="Provisioning-Methods-in-Foreman_provisioning"><a class="anchor" href="#Provisioning-Methods-in-Foreman_provisioning"></a>1.1. Provisioning methods in Foreman</h3>
<div class="paragraph">
<p>With Foreman, you can provision hosts by using the following provisioning methods.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Network based</dt>
<dd>
<p>You can use this method with hosts that are capable of PXE booting or UEFI HTTP booting.</p>
<div class="paragraph">
<p>You must configure the necessary network booting services, such as DHCP or TFTP.
When you create a host entry, you select a PXE loader that can configure DHCP options for network booting if Smart&#160;Proxy is set up to configure the DHCP service automatically.</p>
</div>
<div class="paragraph">
<p>This method uses an operating system installer, such as Anaconda, Debian Installer, or YaST, and template-generated file with installation options downloaded from Foreman, such as Kickstart, Preseed, or AutoYaST.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Network based with PXE Discovery</dt>
<dd>
<p>You can create host entries by discovering hosts on a network.
The discovery process uses the Discovery image to boot the host and report its hardware details to Foreman.
You can automate provisioning of discovered hosts by creating Discovery rules.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">PXE-less Discovery with kexec</dt>
<dd>
<p>You can use this method with hosts that do not support network boot.</p>
<div class="paragraph">
<p>You must configure DHCP for host discovery.</p>
</div>
<div class="paragraph">
<p>This method uses the Discovery image ISO to boot the host and report its hardware details to Foreman.
Using kernel execute (kexec), the Discovery image runs the installer downloaded from Foreman.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Kernel execute is a Technology Preview feature only.
Technology Preview features are not supported by Foreman community.
Foreman community does not recommend using them in production.
These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Boot disk based</dt>
<dd>
<p>You can use this method with hosts that do not support network boot or when you do not have the option of configuring network booting services, such as DHCP.</p>
<div class="paragraph">
<p>This method supplies the booting capability but the rest of the provisioning process still downloads the installer and template-generated files from Foreman to automate the installation.</p>
</div>
</dd>
<dt class="hdlist1">Image based</dt>
<dd>
<p>You can use this method with virtual machines or cloud instances.</p>
<div class="paragraph">
<p>This method uses a virtual image template or a cloud image from a compute resource to provision the operating system.
Foreman can customize the image by running either a pre-boot or post-boot configuration script generated from a provisioning template.</p>
</div>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/common/provisioning-method-selection.svg" alt="Choosing a provisioning method">
</div>
<div class="title">Figure 1. Choosing a provisioning method</div>
</div>
</div>
<div class="sect2">
<h3 id="provisioning-hardware-types"><a class="anchor" href="#provisioning-hardware-types"></a>1.2. Provisioning hardware types</h3>
<div class="paragraph">
<p>With Foreman, you can provision hosts of the following hardware types.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Bare-metal hosts</dt>
<dd>
<p>Foreman provisions bare-metal hosts primarily by using network boot and MAC address identification.
When provisioning bare-metal hosts with Foreman, you can do the following:</p>
<div class="ulist">
<ul>
<li>
<p>Create host entries and specify the MAC address of the host to provision.</p>
</li>
<li>
<p>Boot blank hosts to the Foreman Discovery service, which creates a pool of hosts that are ready to be provisioned.</p>
</li>
<li>
<p>Boot and provision PXE-less hosts by using boot disks.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Virtual machines</dt>
<dd>
<p>Foreman connects to virtualization infrastructure services, such as VMware.
You can instruct Foreman to use a particular hardware profile by defining a compute profile.
When provisioning virtual machines with Foreman, you can do the following:</p>
<div class="ulist">
<ul>
<li>
<p>Select which hardware profile to use.</p>
</li>
<li>
<p>Provision virtual machines from virtual image templates.</p>
</li>
<li>
<p>Use the same provisioning methods that you use to provision bare-metal hosts.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Cloud instances</dt>
<dd>
<p>Foreman connects to private and public cloud providers to provision instances of hosts from images stored in the cloud environment.
You can instruct Foreman to use a particular hardware profile by defining a compute profile.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="supported-client-platforms-in-provisioning"><a class="anchor" href="#supported-client-platforms-in-provisioning"></a>1.3. Supported client platforms in provisioning</h3>
<div class="paragraph">
<p>Foreman supports the following operating systems and architectures for host provisioning.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The following combinations have been tested.
Provisioning templates can be extended for additional systems.</p>
</div>
<div class="paragraph">
<p>If you decide to extend the templates, please submit your changes to <a href="https://github.com/theforeman/foreman/#how-to-contribute">our repository</a>.
Thanks for your contribution!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Supported host operating systems</dt>
<dd>
<p>The hosts can use the following operating systems:</p>
<div class="ulist">
<ul>
<li>
<p>Amazon Linux</p>
</li>
<li>
<p>Debian</p>
</li>
<li>
<p>Enterprise Linux 10, 9, and 8</p>
</li>
<li>
<p>Fedora</p>
</li>
<li>
<p>OpenSUSE</p>
</li>
<li>
<p>SUSE Linux Enterprise Server</p>
</li>
<li>
<p>Ubuntu</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Supported host architectures</dt>
<dd>
<p>The hosts can use the following architectures:</p>
<div class="ulist">
<ul>
<li>
<p>AMD and Intel 64-bit architectures</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="supported-cloud-providers"><a class="anchor" href="#supported-cloud-providers"></a>1.4. Supported cloud providers</h3>
<div class="paragraph">
<p>You can connect the following cloud providers as compute resources to Foreman:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenStack</p>
</li>
<li>
<p>Amazon EC2</p>
</li>
<li>
<p>Google Compute Engine</p>
</li>
<li>
<p>Microsoft Azure</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Provisioning_Cloud_Instances_OpenStack_openstack-provisioning">Provisioning cloud instances on OpenStack</a></p>
</li>
<li>
<p><a href="#provisioning-cloud-instances-on-amazon-ec2">Provisioning cloud instances on Amazon EC2</a></p>
</li>
<li>
<p><a href="#Provisioning_Cloud_Instances_on_Google_Compute_Engine_gce-provisioning">Provisioning cloud instances on Google Compute Engine</a></p>
</li>
<li>
<p><a href="#Provisioning_Cloud_Instances_on_Microsoft_Azure_Resource_Manager_azure-provisioning">Provisioning cloud instances on Microsoft Azure Resource Manager</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="supported-virtualization-infrastructures"><a class="anchor" href="#supported-virtualization-infrastructures"></a>1.5. Supported virtualization infrastructures</h3>
<div class="paragraph">
<p>You can connect the following virtualization infrastructures as compute resources to Foreman:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KVM (libvirt)</p>
</li>
<li>
<p>VMware</p>
</li>
<li>
<p>Proxmox</p>
</li>
<li>
<p>KubeVirt</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Provisioning_Virtual_Machines_on_KVM_kvm-provisioning">Provisioning virtual machines on KVM (libvirt)</a></p>
</li>
<li>
<p><a href="#Provisioning_Virtual_Machines_in_VMware_vmware-provisioning">Provisioning virtual machines in VMware vSphere</a></p>
</li>
<li>
<p><a href="#Provisioning_Virtual_Machines_in_Proxmox_proxmox-provisioning">Provisioning virtual machines in Proxmox</a></p>
</li>
<li>
<p><a href="#Provisioning_Virtual_Machines_Kubevirt_kubevirt-provisioning">Provisioning virtual machines on KubeVirt</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-networking"><a class="anchor" href="#preparing-networking"></a>2. Preparing networking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each provisioning type requires some network configuration.
Use this chapter to configure network services on your Smart&#160;Proxies.</p>
</div>
<div class="paragraph">
<p>New hosts must have access to either your Foreman&#160;server or any Smart&#160;Proxy&#160;server.
If your hosts are on isolated networks and cannot connect to Foreman&#160;server directly, you must provision your hosts from Smart&#160;Proxy&#160;servers.
Provisioning by using Smart&#160;Proxy&#160;servers can save on network bandwidth.</p>
</div>
<div class="paragraph">
<p>Configuring Smart&#160;Proxies has two basic requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuring network services.
This includes:</p>
<div class="ulist">
<ul>
<li>
<p>Network services (DHCP, DNS, and TFTP)</p>
</li>
<li>
<p>Puppet configuration</p>
</li>
</ul>
</div>
</li>
<li>
<p>Defining network resource data in Foreman&#160;server to help configure network interfaces on new hosts.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following instructions have similar applications to configuring Smart&#160;Proxy&#160;servers managing a specific network.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/nightly/Integrating_Provisioning_Infrastructure_Services/index-foreman-deb.html#">Integrating provisioning infrastructure services</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="facts-and-nic-filtering_provisioning"><a class="anchor" href="#facts-and-nic-filtering_provisioning"></a>2.1. Facts and NIC filtering</h3>
<div class="paragraph">
<p>Facts describe aspects such as total memory, operating system version, or architecture as reported by the host.
You can find facts in <strong>Monitor</strong> &gt; <strong>Facts</strong> and search hosts through facts or use facts in templates.</p>
</div>
<div class="paragraph">
<p>Foreman collects facts from multiple sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>subscription manager</code></p>
</li>
<li>
<p><code>ansible</code></p>
</li>
<li>
<p><code>puppet</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Foreman is an inventory system for hosts and network interfaces.
For hypervisors or container hosts, adding thousands of interfaces per host and updating the inventory every few minutes is inadequate.
For each individual NIC reported, Foreman creates a NIC entry and those entries are never removed from the database.
Parsing all the facts and comparing all records in the database makes Foreman extremely slow and unusable.
To optimize the performance of various actions, most importantly fact import, you can use the options available on the <strong>Facts</strong> tab under <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="optimizing-performance-by-removing-nics-from-database_provisioning"><a class="anchor" href="#optimizing-performance-by-removing-nics-from-database_provisioning"></a>2.2. Optimizing performance by removing NICs from database</h3>
<div class="paragraph">
<p>Filter and exclude the connections using the <code>Exclude pattern for facts stored in Foreman</code> and <code>Ignore interfaces with matching identifier</code> option.
By default, these options are set to most common hypervisors.
If you name the virtual interfaces differently, you can update this filter to use it according to your requirements.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> and select the <strong>Facts</strong> tab.</p>
</li>
<li>
<p>To filter out all interfaces starting with specific names, for example, <code>blu</code>, add <code>blu*</code> to the <code>Ignore interfaces with matching identifier</code> option.</p>
</li>
<li>
<p>To prevent databases from storing facts related to interfaces starting with specific names, for example, <code>blu</code>, add <code>blu*</code> to the <code>Exclude pattern for facts stored in Foreman</code> option.</p>
<div class="paragraph">
<p>By default, it contains the same list as the <code>Ignore interfaces with matching identifier</code> option.
You can override it based on the your requirements.
This filters out facts completely without storing them.</p>
</div>
</li>
<li>
<p>To remove facts from the database, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake facts:clean</pre>
</div>
</div>
<div class="paragraph">
<p>This command removes all facts matching with the filter added in <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Facts</strong> &gt; the <code>Exclude pattern for facts stored in Foreman</code> option.</p>
</div>
</li>
<li>
<p>To remove interfaces from the database, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-rake interfaces:clean</pre>
</div>
</div>
<div class="paragraph">
<p>This command removes all interfaces matching with the filter added in <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Facts</strong> &gt; the <code>Ignore interfaces with matching identifier</code> option.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Network_Resources_provisioning"><a class="anchor" href="#Network_Resources_provisioning"></a>2.3. Network resources</h3>
<div class="paragraph">
<p>Foreman contains networking resources that you must set up and configure to create a host.
It includes the following networking resources:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Domain</dt>
<dd>
<p>You must assign every host that is managed by Foreman to a domain.
Using the domain, Foreman can manage A, AAAA, and PTR records.
Even if you do not want Foreman to manage your DNS servers, you still must create and associate at least one domain.
Domains are included in the naming conventions Foreman hosts, for example, a host with the name <code>test123</code> in the <code>example.com</code> domain has the fully qualified domain name <code>test123.example.com</code>.</p>
</dd>
<dt class="hdlist1">Subnet</dt>
<dd>
<p>You must assign every host managed by Foreman to a subnet.
Using subnets, Foreman can then manage IPv4 reservations.
If there are no reservation integrations, you still must create and associate at least one subnet.
When you manage a subnet in Foreman, you cannot create DHCP records for that subnet outside of Foreman.
In Foreman, you can use IP Address Management (IPAM) to manage IP addresses with one of the following options:</p>
<div class="ulist">
<ul>
<li>
<p><strong>DHCP</strong>: DHCP Smart&#160;Proxy manages the assignment of IP addresses by finding the next available IP address starting from the first address of the range and skipping all addresses that are reserved.
Before assigning an IP address, Smart&#160;Proxy sends an ICMP and TCP pings to check whether the IP address is in use.
Note that if a host is powered off, or has a firewall configured to disable connections, Foreman makes a false assumption that the IP address is available.
This check does not work for hosts that are turned off, therefore, the <strong>DHCP</strong> option can only be used with subnets that Foreman controls and that do not have any hosts created externally.</p>
<div class="paragraph">
<p>The Smart&#160;Proxy DHCP module retains the offered IP addresses for a short period of time to prevent collisions during concurrent access, so some IP addresses in the IP range might remain temporarily unused.</p>
</div>
</li>
<li>
<p><strong>Internal DB</strong>: Foreman finds the next available IP address from the Subnet range by excluding all IP addresses from the Foreman database in sequence.
The primary source of data is the database, not DHCP reservations.
This IPAM is not safe when multiple hosts are being created in parallel; in that case, use <strong>DHCP</strong> or <strong>Random DB</strong> IPAM instead.</p>
</li>
<li>
<p><strong>Random DB</strong>: Foreman finds the next available IP address from the Subnet range by excluding all IP addresses from the Foreman database randomly.
The primary source of data is the database, not DHCP reservations.
This IPAM is safe to use with concurrent host creation as IP addresses are returned in random order, minimizing the chance of a conflict.</p>
</li>
<li>
<p><strong>EUI-64</strong>: Extended Unique Identifier (EUI) 64bit IPv6 address generation, as per RFC2373, is obtained through the 48-bit MAC address.</p>
</li>
<li>
<p><strong>External IPAM</strong>: Delegates IPAM to an external system through Smart&#160;Proxy feature.
Foreman currently does not ship with any external IPAM implementations, but several plugins are in development.</p>
</li>
<li>
<p><strong>None</strong>: IP address for each host must be entered manually.</p>
<div class="paragraph">
<p>Options DHCP, Internal DB and Random DB can lead to DHCP conflicts on subnets with records created externally.
These subnets must be under exclusive Foreman control.</p>
</div>
<div class="paragraph">
<p>For more information about adding a subnet, see <a href="#Adding_a_Subnet_to_Server_provisioning">Adding a subnet to Foreman&#160;server</a>.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">DHCP Ranges</dt>
<dd>
<p>You can define the same DHCP range in Foreman&#160;server for both discovered and provisioned systems, but use a separate range for each service within the same subnet.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="options-in-managed-dhcpv4"><a class="anchor" href="#options-in-managed-dhcpv4"></a>2.3.1. Options in managed DHCPv4</h4>
<div class="paragraph">
<p>When Foreman manages the DHCP service and can update the DHCP configuration, Foreman sets the <code>next-server</code> and <code>filename</code> DHCP options.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>next-server</code></dt>
<dd>
<p>The <code>next-server</code> option provides the IP address of the TFTP server to boot from.
This option is not set by default and must be set for each TFTP Smart&#160;Proxy.
You can use the <code>foreman-installer</code> command with the <code>--foreman-proxy-tftp-servername</code> argument to set the TFTP server in the <code>/etc/foreman-proxy/settings.d/tftp.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-tftp-servername <em>1.2.3.4</em></pre>
</div>
</div>
<div class="paragraph">
<p>Each TFTP Smart&#160;Proxy then reports this setting through the API and Foreman can retrieve the configuration information when it creates the DHCP record.</p>
</div>
<div class="paragraph">
<p>When the PXE loader is set to <code>none</code>, Foreman does not populate the <code>next-server</code> option into the DHCP record.</p>
</div>
<div class="paragraph">
<p>If the <code>next-server</code> option remains undefined, Foreman calls the Smart&#160;Proxy API to retrieve the server name as specified by the <code>--foreman-proxy-tftp-servername</code> argument in a <code>foreman-installer</code> run.
If the Smart&#160;Proxy API call does not return a server name, Foreman uses the hostname of the Smart&#160;Proxy.</p>
</div>
</dd>
<dt class="hdlist1"><code>filename</code></dt>
<dd>
<p>The <code>filename</code> option contains the full path to the file that downloads and executes during provisioning.
The PXE loader that you select for the host or host group defines which <code>filename</code> option to use.
When the PXE loader is set to <code>none</code>, Foreman does not populate the <code>filename</code> option into the DHCP record.
Depending on the PXE loader option, the <code>filename</code> changes as follows:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PXE loader option</th>
<th class="tableblock halign-left valign-top">filename entry</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXELinux BIOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pxelinux.0</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXELinux UEFI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pxelinux.efi</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPXE Chain BIOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>undionly.kpxe</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PXEGrub2 UEFI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grub2/grubx64.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x64 can differ depending on architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPXE UEFI HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http://<em>smartproxy.example.com</em>:8000/httpboot/ipxe-x64.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires the <code>httpboot</code> feature and renders the <code>filename</code> as a full URL where <em>smartproxy.example.com</em> is a known host name of Smart&#160;Proxy in Foreman.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grub2 UEFI HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http://<em>smartproxy.example.com</em>:8000/httpboot/grub2/grubx64.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires the <code>httpboot</code> feature and renders the <code>filename</code> as a full URL where <em>smartproxy.example.com</em> is a known host name of Smart&#160;Proxy in Foreman.</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="options-in-unmanaged-dhcpv6"><a class="anchor" href="#options-in-unmanaged-dhcpv6"></a>2.3.2. Options in unmanaged DHCPv6</h4>
<div class="paragraph">
<p>To provision hosts over TFTP in an IPv6-only network, configure the DHCP server to respond with the <code>bootfile-url</code> DHCP option.
Foreman cannot manage the DHCPv6 service, therefore, you have to configure your DHCP server manually.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>bootfile-url</code></dt>
<dd>
<p>The URL value of this option has to point to a file on TFTP Smart&#160;Proxy that is a first-stage boot loader, such as <code>pxelinux.0</code>.
Example configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">   "option-data": [
      {
         "name": "bootfile-url",
         "data": "tftp://2001:db8:1::1/pxelinux.0"
      }
   ],</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Prerequisites_for_Image_Based_Provisioning_provisioning"><a class="anchor" href="#Prerequisites_for_Image_Based_Provisioning_provisioning"></a>2.4. Prerequisites for image-based provisioning</h3>
<div class="paragraph">
<div class="title">Post-boot configuration method</div>
<p>Images that use the <code>finish</code> post-boot configuration scripts require a managed DHCP server, for example, your Foreman&#160;server or Smart&#160;Proxy&#160;servers.
The host must be created with a subnet associated with a DHCP Smart&#160;Proxy, and the IP address of the host must be a valid IP address from the DHCP range.</p>
</div>
<div class="paragraph">
<p>It is possible to use an external DHCP service, but IP addresses must be entered manually.
The SSH credentials corresponding to the configuration in the image must be configured in Foreman to enable the post-boot configuration to be made.</p>
</div>
<div class="paragraph">
<p>Check the following items when troubleshooting a virtual machine booted from an image that depends on post-configuration scripts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The host has a subnet assigned in Foreman&#160;server.</p>
</li>
<li>
<p>The subnet has a DHCP Smart&#160;Proxy assigned in Foreman&#160;server.</p>
</li>
<li>
<p>The host has a valid IP address assigned in Foreman&#160;server.</p>
</li>
<li>
<p>The IP address acquired by the virtual machine by using DHCP matches the address configured in Foreman&#160;server.</p>
</li>
<li>
<p>The virtual machine created from an image responds to SSH requests.</p>
</li>
<li>
<p>The virtual machine created from an image authorizes the user and password, over SSH, which is associated with the image being deployed.</p>
</li>
<li>
<p>Foreman&#160;server has access to the virtual machine via SSH keys.
This is required for the virtual machine to receive post-configuration scripts from Foreman&#160;server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Pre-boot initialization configuration method</div>
<p>Images that use the <code>cloud-init</code> scripts require a DHCP server to avoid having to include the IP address in the image.
A managed DHCP Smart&#160;Proxy is preferred.
The image must have the <code>cloud-init</code> service configured to start when the system boots and fetch a script or configuration data to use in completing the configuration.</p>
</div>
<div class="paragraph">
<p>Check the following items when troubleshooting a virtual machine booted from an image that depends on initialization scripts included in the image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a DHCP server on the subnet.</p>
</li>
<li>
<p>The virtual machine has the <code>cloud-init</code> service installed and enabled.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="Multiple_Subnets_or_Domains_Using_Installer_provisioning"><a class="anchor" href="#Multiple_Subnets_or_Domains_Using_Installer_provisioning"></a>2.4.1. Multiple subnets or domains using installer</h4>
<div class="paragraph">
<p>The <code>foreman-installer</code> options allow only for a single DHCP subnet or DNS domain.
One way to define more than one subnet is by using a custom configuration file.</p>
</div>
<div class="paragraph">
<p>For every additional subnet or domain, create an entry in <code>/etc/foreman-installer/custom-hiera.yaml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dhcp::pools:
 isolated.lan:
   network: 192.168.99.0
   mask: 255.255.255.0
   gateway: 192.168.99.1
   range: 192.168.99.5 192.168.99.49

dns::zones:
  # creates @ SOA $::fqdn root.example.com.
  # creates $::fqdn A $::ipaddress
  example.com: {}

  # creates @ SOA test.example.net. hostmaster.example.com.
  # creates test.example.net A 192.0.2.100
  example.net:
    soa: test.example.net
    soaip: 192.0.2.100
    contact: hostmaster.example.com.

  # creates @ SOA $::fqdn root.example.org.
  # does NOT create an A record
  example.org:
    reverse: true

  # creates @ SOA $::fqdn hostmaster.example.com.
  2.0.192.in-addr.arpa:
    reverse: true
    contact: hostmaster.example.com.</pre>
</div>
</div>
<div class="paragraph">
<p>Execute <code>foreman-installer</code> to perform the changes and verify that the <code>/etc/dhcp/dhcpd.conf</code> contains appropriate entries.
Subnets must be then defined in Foreman database.</p>
</div>
</div>
<div class="sect3">
<h4 id="DNS_Options_For_Network_Configuration_provisioning"><a class="anchor" href="#DNS_Options_For_Network_Configuration_provisioning"></a>2.4.2. DNS options for network configuration</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">--foreman-proxy-dns</dt>
<dd>
<p>  Enables the DNS feature.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-provider</dt>
<dd>
<p>Selects the provider to be used.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-managed</dt>
<dd>
<p>  Let the installer manage ISC BIND.
This is only relevant when using the <code>nsupdate</code> and <code>nsupdate_gss</code> providers.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-forwarders</dt>
<dd>
<p>  Sets the DNS forwarders.
Only used when ISC BIND is managed by the installer.
Set this to your DNS recursors.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-interface</dt>
<dd>
<p>  Sets the interface to listen for DNS requests.
Only used when ISC BIND is managed by the installer.
Set this to <code>eth1</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-reverse</dt>
<dd>
<p>  The DNS reverse zone name.
Only used when ISC BIND is managed by the installer.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-server</dt>
<dd>
<p>  Sets the address of the DNS server.
Only used by the <code>nsupdate</code>, <code>nsupdate_gss</code>, and <code>infoblox</code> providers.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-dns-zone</dt>
<dd>
<p>  Sets the DNS zone name.
Only used when ISC BIND is managed by the installer.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Run <code>foreman-installer --help</code> to view more options related to DNS and other Smart&#160;Proxy services.</p>
</div>
</div>
<div class="sect3">
<h4 id="TFTP_Options_For_Network_Configuration_provisioning"><a class="anchor" href="#TFTP_Options_For_Network_Configuration_provisioning"></a>2.4.3. TFTP options for network configuration</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">--foreman-proxy-tftp</dt>
<dd>
<p>  Enables TFTP service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-tftp-managed</dt>
<dd>
<p>  Enables Foreman to manage the TFTP service.
You can set this option to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1">--foreman-proxy-tftp-servername</dt>
<dd>
<p>  Sets the TFTP server to use.
Ensure that you use Smart&#160;Proxy&#8217;s IP address.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Run <code>foreman-installer --help</code> to view more options related to TFTP and other Smart&#160;Proxy services.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Domain_to_Server_provisioning"><a class="anchor" href="#Adding_a_Domain_to_Server_provisioning"></a>2.5. Adding a domain to Foreman&#160;server</h3>
<div class="paragraph">
<p>Foreman&#160;server defines domain names for each host on the network.
Foreman&#160;server must have information about the domain and Smart&#160;Proxy&#160;server responsible for domain name assignment.</p>
</div>
<div class="paragraph">
<div class="title">Checking for existing domains</div>
<p>Foreman&#160;server might already have the relevant domain created as part of Foreman&#160;server installation.
Switch the context to <code>Any Organization</code> and <code>Any Location</code> then check the domain list to see if it exists.</p>
</div>
<div class="paragraph">
<div class="title">DNS server configuration considerations</div>
<p>During the DNS record creation, Foreman performs conflict DNS lookups to verify that the host name is not in active use.
This check runs against one of the following DNS servers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The system-wide resolver if <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Query local nameservers</strong> is set to <strong>true</strong>.</p>
</li>
<li>
<p>The nameservers that are defined in the subnet associated with the host.</p>
</li>
<li>
<p>The authoritative NS-Records that are queried from the SOA from the domain name associated with the host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you experience timeouts during DNS conflict resolution, check the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The subnet nameservers must be reachable from Foreman&#160;server.</p>
</li>
<li>
<p>The domain name must have a Start of Authority (SOA) record available from Foreman&#160;server.</p>
</li>
<li>
<p>The system resolver in the <code>/etc/resolv.conf</code> file must have a valid and working configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-a-domain_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and click <strong>Create Domain</strong>.</p>
</li>
<li>
<p>In the <strong>DNS Domain</strong> field, enter the full DNS domain name.</p>
</li>
<li>
<p>In the <strong>Fullname</strong> field, enter the plain text name of the domain.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and configure any domain level parameters to apply to hosts attached to this domain.
For example, user defined Boolean or string parameters to use in templates.</p>
</li>
<li>
<p>Click <strong>Add Parameter</strong> and fill in the <strong>Name</strong> and <strong>Value</strong> fields.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and add the location where the domain resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and add the organization that the domain belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
<div id="cli-adding-a-domain_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Use the <code>hammer domain create</code> command to create a domain:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer domain create \
--description "<em>My_Domain</em>" \
--dns-id <em>My_DNS_Smart_Proxy_ID</em> \
--locations "<em>My_Location</em>" \
--name "<em>my-domain.tld</em>" \
--organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Subnet_to_Server_provisioning"><a class="anchor" href="#Adding_a_Subnet_to_Server_provisioning"></a>2.6. Adding a subnet to Foreman&#160;server</h3>
<div class="paragraph">
<p>You must add information for each of your subnets to Foreman&#160;server because Foreman configures interfaces for new hosts.
To configure interfaces, Foreman&#160;server must have all the information about the network that connects these interfaces.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-a-subnet_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>, and in the Subnets window, click <strong>Create Subnet</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the subnet.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the subnet.</p>
</li>
<li>
<p>In the <strong>Network address</strong> field, enter the network address for the subnet.</p>
</li>
<li>
<p>In the <strong>Network prefix</strong> field, enter the network prefix for the subnet.</p>
</li>
<li>
<p>In the <strong>Network mask</strong> field, enter the network mask for the subnet.</p>
</li>
<li>
<p>In the <strong>Gateway address</strong> field, enter the external gateway for the subnet.</p>
</li>
<li>
<p>In the <strong>Primary DNS server</strong> field, enter a primary DNS for the subnet.</p>
</li>
<li>
<p>In the <strong>Secondary DNS server</strong>, enter a secondary DNS for the subnet.</p>
</li>
<li>
<p>From the <strong>IPAM</strong> list, select the method that you want to use for IP address management (IPAM).
For more information about IPAM, see <a href="#Network_Resources_provisioning">Network resources</a>.</p>
</li>
<li>
<p>Enter the information for the IPAM method that you select.</p>
</li>
<li>
<p>If you use the remote execution plugin, click the <strong>Remote Execution</strong> tab and select the Smart&#160;Proxy that controls the remote execution.</p>
</li>
<li>
<p>Click the <strong>Domains</strong> tab and select the domains that apply to this subnet.</p>
</li>
<li>
<p>Click the <strong>Smart&#160;Proxies</strong> tab and select the Smart&#160;Proxy that applies to each service in the subnet, including DHCP, TFTP, and reverse DNS services.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and configure any subnet level parameters to apply to hosts attached to this subnet.
For example, user defined Boolean or string parameters to use in templates.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and select the locations that use this Smart&#160;Proxy.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and select the organizations that use this Smart&#160;Proxy.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the subnet information.</p>
</li>
</ol>
</div>
<div id="cli-adding-a-subnet_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create a subnet:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer subnet create \
--boot-mode "DHCP" \
--description "<em>My_Description</em>" \
--dhcp-id <em>My_DHCP_Smart_Proxy_ID</em> \
--dns-id <em>My_DNS_Smart_Proxy_ID</em> \
--dns-primary "192.168.140.2" \
--dns-secondary "8.8.8.8" \
--domains "<em>my-domain.tld" \
--from "192.168.140.111" \
--gateway "192.168.140.1" \
--ipam "DHCP" \
--locations "_My_Location</em>" \
--mask "255.255.255.0" \
--name "<em>My_Network</em>" \
--network "192.168.140.0" \
--organizations "<em>My_Organization</em>" \
--tftp-id <em>My_TFTP_Smart_Proxy_ID</em> \
--to "192.168.140.250"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-provisioning-content"><a class="anchor" href="#preparing-provisioning-content"></a>3. Preparing provisioning content</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You have to configure provisioning content that will be used for installation of the operating system on the provisioned host.</p>
</div>
<div class="sect2">
<h3 id="adding-installation-media_provisioning"><a class="anchor" href="#adding-installation-media_provisioning"></a>3.1. Adding installation media to Foreman</h3>
<div class="paragraph">
<p>Installation media are sources of packages that Foreman&#160;server uses to install a base operating system on a machine from an external repository.</p>
</div>
<div class="paragraph">
<p>You can view installation media by navigating to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Installation Media</strong>.</p>
</div>
<div class="paragraph">
<p>Installation media must be in the format of an operating system installation tree and must be accessible from the machine hosting the installer through an HTTP URL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Other protocols, such as HTTPS or NFS, are known to work but have not been tested.
Foreman community recommends using HTTP.</p>
</div>
<div class="paragraph">
<p>You can hypothetically use NFS share for PXE-based provisioning in a semi-automated way by copying the <code>initrd.img</code> and <code>vmlinuz</code> files from the NFS source to <code>/var/lib/tftpboot/boot</code> on Smart&#160;Proxy with the expected names.
Only then PXE booting can proceed further.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, Foreman includes installation media for some official Linux distributions.
Note that some of those installation media are targeted for a specific version of an operating system.
For example <strong>CentOS mirror (7.x)</strong> must be used for CentOS 7 or earlier, and <strong>CentOS mirror (8.x)</strong> must be used for CentOS 8 or later.</p>
</div>
<div class="paragraph">
<p>If you want to improve download performance when using installation media to install operating systems on multiple hosts, you must modify the <strong>Path</strong> of the installation medium to point to the closest mirror or a local copy.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-installation-media_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Installation Media</strong>.</p>
</li>
<li>
<p>Click <strong>Create Medium</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to represent the installation media entry.</p>
</li>
<li>
<p>In the <strong>Path</strong> enter the URL that contains the installation tree.
You can use following variables in the path to represent multiple different system architectures and versions:</p>
<div class="ulist">
<ul>
<li>
<p><code>$arch</code> &#8211; The system architecture.</p>
</li>
<li>
<p><code>$version</code> &#8211; The operating system version.</p>
</li>
<li>
<p><code>$major</code> &#8211; The operating system major version.</p>
</li>
<li>
<p><code>$minor</code> &#8211; The operating system minor version.</p>
<div class="paragraph">
<p>Example HTTP path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">http://download.example.com/centos/$version/Server/$arch/os/</pre>
</div>
</div>
<div class="paragraph">
<p>Example NFS path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">nfs://download.example.com/centos/$version/Server/$arch/os/</pre>
</div>
</div>
<div class="paragraph">
<p>Synchronized content on Smart&#160;Proxy&#160;servers always uses an HTTP path.
Smart&#160;Proxy&#160;server managed content does not support NFS paths.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>From the <strong>Operating system family</strong> list, select the distribution or family of the installation medium.
For example, CentOS and Fedora are in the <code>Red Hat</code> family.
Debian and Ubuntu belong to the <code>Debian</code> family.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs, to change the provisioning context.
Foreman&#160;server adds the installation medium to the set provisioning context.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your installation medium.</p>
</li>
</ol>
</div>
<div id="cli-adding-installation-media_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the installation medium using the <code>hammer medium create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer medium create \
--locations "<em>My_Location</em>" \
--name "<em>My_Operating_System</em>" \
--organizations "<em>My_Organization</em>" \
--os-family "Redhat" \
--path "http://download.example.com/centos/$version/Server/$arch/os/"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Creating_an_Installation_Medium_for_Debian-Ubuntu_provisioning"><a class="anchor" href="#Creating_an_Installation_Medium_for_Debian-Ubuntu_provisioning"></a>3.2. Creating an installation medium for Debian/Ubuntu</h3>
<div class="paragraph">
<p>Create an installation medium in Foreman to provision hosts running Debian/Ubuntu.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Installation Media</strong>.</p>
</li>
<li>
<p>Click <strong>Create Medium</strong> to create an installation medium entry.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> for the installation medium.</p>
</li>
<li>
<p>Set the <strong>Path</strong> to the upstream URL <code><a href="http://deb.debian.org/debian/" class="bare">http://deb.debian.org/debian/</a></code>.</p>
<div class="paragraph">
<p>Alternatively, you can also use a Debian/Ubuntu Mirror.</p>
</div>
</li>
<li>
<p>Set the <strong>Operating System Family</strong> to <code>Debian</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the installation medium to Foreman.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-an-installation-medium-for-ubuntu-22-04"><a class="anchor" href="#creating-an-installation-medium-for-ubuntu-22-04"></a>3.3. Creating an installation medium for Ubuntu 22.04</h3>
<div class="paragraph">
<p>To provision Ubuntu 22.04, you need to provide both the ISO image and the extracted ISO image on your Foreman&#160;server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to your Foreman&#160;server using SSH:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh root@foreman.example.com</pre>
</div>
</div>
</li>
<li>
<p>Download the ISO image:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cd /tmp/
# wget https://releases.ubuntu.com/22.04/ubuntu-22.04.3-live-server-amd64.iso</pre>
</div>
</div>
</li>
<li>
<p>Mount the ISO image:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount ubuntu-22.04.3-live-server-amd64.iso /mnt</pre>
</div>
</div>
</li>
<li>
<p>Provide the ISO image and the extracted directory under <em>foreman.example.com/pub</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /var/www/html/pub/installation_media/ubuntu/22.04-x86_64/
# cp ubuntu-22.04.3-live-server-amd64.iso /var/www/html/pub/installation_media/ubuntu/22.04-x86_64.iso
# cp -a /mnt/* /var/www/html/pub/installation_media/ubuntu/22.04-x86_64/</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure the path in <code>/pub/</code> matches the path in your <em>Preseed default PXELinux Autoinstall</em> template.</p>
</div>
</li>
<li>
<p>Unmount and delete the ISO image:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># umount /mnt/
# rm -f ubuntu-22.04.3-live-server-amd64.iso</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you manage this with Puppet or a similar configuration management system, you can take an alternative approach.
Instead of copying the ISO image content, you can create a symbolic link at <code>/var/www/html/pub/installation_media/ubuntu/22.04-x86_64</code> that points to the mounted image.
Keep the ISO image mounted so that it is accessible to HTTP clients.</p>
</div>
<div class="paragraph">
<p>Do not mount the ISO image directly under <code>/var/lib/foreman</code>.
On Debian and Ubuntu, mounting under this directory causes the package <code>postinst</code> script to fail during the <code>chmod -Rf /var/lib/foreman</code> command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use <code>http://foreman.example.com/pub/installation_media/ubuntu/22.04-x86_64/</code> to set up your installation media entry in Foreman.
For more information, see <a href="#adding-installation-media_provisioning">Adding installation media to Foreman</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_Ubuntu_Autoinstall_Through_Smart_Proxies_provisioning"><a class="anchor" href="#Provisioning_Ubuntu_Autoinstall_Through_Smart_Proxies_provisioning"></a>3.4. Provisioning Ubuntu autoinstall through Smart&#160;Proxies</h3>
<div class="paragraph">
<p>Perform these steps to provision hosts running Ubuntu 20.04.3+ or Ubuntu 22.04.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure you have configured your Smart&#160;Proxy&#160;servers for provisioning.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Provide the extracted ISO and ISO image itself on each Smart&#160;Proxy&#160;server.
For more information, see <a href="#creating-an-installation-medium-for-ubuntu-22-04">Creating an installation medium for Ubuntu 22.04</a>.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Installation Media</strong>.</p>
</li>
<li>
<p>Create an installation medium.
Set the <strong>Path</strong> to the extracted ISO image on your Smart&#160;Proxy&#160;server.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Assign the installation medium to your operating system entry for Ubuntu 22.04.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Configure &gt; Host Groups</strong>.</p>
</li>
<li>
<p>Select the host group that you use to deploy Ubuntu 22.04 through a Smart&#160;Proxy&#160;server and set the installation medium entry accordingly.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-foreman-to-provision-from-a-builder-image"><a class="anchor" href="#configuring-foreman-to-provision-from-a-builder-image"></a>3.5. Configuring Foreman to provision from a Lorax Composer image</h3>
<div class="paragraph">
<p>In Foreman, you can enable integration with Cockpit to perform actions and monitor your hosts.
Using Cockpit, you can access Lorax Composer and build images.
Afterwards, you can use these images to provision hosts.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#host-management-and-monitoring-by-using-cockpit">Host management and monitoring by using Cockpit</a> in <em>Managing hosts</em></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="provisioning-from-a-builder-image-on-an-http-server"><a class="anchor" href="#provisioning-from-a-builder-image-on-an-http-server"></a>3.5.1. Provisioning from a Lorax Composer image on an HTTP server</h4>
<div class="paragraph">
<p>You can upload a Lorax Composer image to an HTTP server and use this image to provision hosts by using network boot.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is available for Enterprise Linux hosts only.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you provision from a Lorax Composer image, Anaconda installer partitions disks, downloads and mounts the image, and copies files over to a host.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing TAR image created by using Lorax Composer in Cockpit.
Ensure that your blueprint to build the image includes the <a href="#packages-required-in-a-builder-image">required packages</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the image to an existing HTTP server that your hosts can reach.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>.</p>
</li>
<li>
<p>Select the host group that you want to use.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab, and then click <strong>Add Parameter</strong>.</p>
</li>
<li>
<p>Create a parameter named <code>kickstart_liveimg</code> with type <strong>string</strong> and set the value to the URL of the image location, such as <code>https://<em>webserver.example.com</em>/<em>path</em>/<em>My_Image_Name</em>.tar</code>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#using-network-boot-to-provision-hosts">Using network boot to provision hosts</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="packages-required-in-a-builder-image"><a class="anchor" href="#packages-required-in-a-builder-image"></a>3.5.2. Packages required in a Lorax Composer image</h4>
<div class="paragraph">
<p>For the use in Foreman, the Lorax Composer image must contain the following minimum of packages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NetworkManager</code></p>
</li>
<li>
<p><code>authselect</code></p>
</li>
<li>
<p><code>chrony</code></p>
</li>
<li>
<p><code>dnf</code></p>
</li>
<li>
<p><code>dracut</code></p>
</li>
<li>
<p><code>efibootmgr</code></p>
</li>
<li>
<p><code>firewalld</code></p>
</li>
<li>
<p><code>grub2</code></p>
</li>
<li>
<p><code>grub2-efi</code></p>
</li>
<li>
<p><code>grub2-tools-extra</code></p>
</li>
<li>
<p><code>insights-client</code> &#8211; required only if you plan to use Insights reporting</p>
</li>
<li>
<p><code>iproute</code></p>
</li>
<li>
<p><code>iputils</code></p>
</li>
<li>
<p><code>kernel</code></p>
</li>
<li>
<p><code>kernel-core</code></p>
</li>
<li>
<p><code>lvm2</code></p>
</li>
<li>
<p><code>subscription-manager</code></p>
</li>
<li>
<p><code>wget</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-client-platforms"><a class="anchor" href="#preparing-client-platforms"></a>4. Preparing client platforms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You have to configure the platforms that you will provision.
That entails creating a hardware model, CPU architecture, and operating system.</p>
</div>
<div class="sect2">
<h3 id="creating-operating-systems_provisioning"><a class="anchor" href="#creating-operating-systems_provisioning"></a>4.1. Creating operating systems</h3>
<div class="paragraph">
<p>An operating system is a collection of resources that define how Foreman&#160;server installs a base operating system on a host.
Operating system entries combine previously defined resources, such as installation media, partition tables, provisioning templates, and others.</p>
</div>
<div class="paragraph">
<p>You can add operating systems using the following procedure.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-operating-systems_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and click <strong>New Operating</strong> system.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to represent the operating system entry.</p>
</li>
<li>
<p>In the <strong>Major</strong> field, enter the number that corresponds to the major version of the operating system.</p>
</li>
<li>
<p>In the <strong>Minor</strong> field, enter the number that corresponds to the minor version of the operating system.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description of the operating system.</p>
</li>
<li>
<p>From the <strong>Family</strong> list, select the operating system&#8217;s family.</p>
</li>
<li>
<p>From the <strong>Root Password Hash</strong> list, select the encoding method for the root password.</p>
</li>
<li>
<p>From the <strong>Architectures</strong> list, select the architectures that the operating system uses.</p>
</li>
<li>
<p>Click the <strong>Partition table</strong> tab and select the possible partition tables that apply to this operating system.</p>
</li>
<li>
<p>Click the Installation Media tab and enter the information for the installation media source.
For more information, see <a href="https://docs.theforeman.org/nightly/Provisioning_Hosts/index-foreman-deb.html#adding-installation-media_provisioning">Adding Installation Media to Foreman</a>.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab and select a <strong>PXELinux template</strong>, a <strong>Provisioning template</strong>, and a <strong>Finish template</strong> for your operating system to use.
You can select other templates, for example an <strong>iPXE template</strong>, if you plan to use iPXE for provisioning.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your provisioning template.</p>
</li>
</ol>
</div>
<div id="cli-creating-operating-systems_provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the operating system using the <code>hammer os create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer os create \
--architectures "x86_64" \
--description "Enterprise Linux 9" \
--family "Redhat" \
--major 9 \
--media "Red Hat" \
--minor 5 \
--name "Enterprise Linux" \
--partition-tables "<em>My_Partition_Table</em>" \
--provisioning-templates "<em>My_Provisioning_Template</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Creating-an-operating-system-for-Debian-12_provisioning"><a class="anchor" href="#Creating-an-operating-system-for-Debian-12_provisioning"></a>4.2. Creating an operating system for Debian 12</h3>
<div class="paragraph">
<p>Create an operating system in Foreman to provision hosts running Debian 12.
This example creates an operating system entry for Debian 12.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Create Operating System</strong> to create an operating system entry for Debian.</p>
</li>
<li>
<p>Enter <code>Debian 12</code> as <strong>Name</strong> for the operating system.
Choose a name as reported by Ansible, Puppet, or Salt as fact.</p>
</li>
<li>
<p>Set the <strong>Major Version</strong> to <code>12</code>.</p>
</li>
<li>
<p>Leave the <strong>Minor Version</strong> field empty.</p>
</li>
<li>
<p>Set the <strong>Release Name</strong> to <code>bookworm</code> for Debian 12.</p>
</li>
<li>
<p>On the <strong>Partition Table</strong> tab, select the <code>Preseed</code> partition table.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-partition-tables_provisioning">Creating partition tables</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Templates</strong> tab, select the <code>Preseed Finish</code> template as <strong>Finish template</strong>, the <code>Preseed</code> template as <strong>Provisioning Template</strong>, and the <code>Preseed PXELinux</code> template as <strong>PXELinux template</strong>.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-provisioning-templates">Creating provisioning templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the operating system entry for Debian.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating-an-operating-system-for-Debian-11_provisioning"><a class="anchor" href="#Creating-an-operating-system-for-Debian-11_provisioning"></a>4.3. Creating an operating system for Debian 11</h3>
<div class="paragraph">
<p>Create an operating system in Foreman to provision hosts running Debian 11.
This example creates an operating system entry for Debian 11.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Create Operating System</strong> to create an operating system entry for Debian.</p>
</li>
<li>
<p>Enter <code>Debian 11</code> as <strong>Name</strong> for the operating system.
Choose a name as reported by Ansible, Puppet, or Salt as fact.</p>
</li>
<li>
<p>Set the <strong>Major Version</strong> to <code>11</code>.</p>
</li>
<li>
<p>Leave the <strong>Minor Version</strong> field empty.</p>
</li>
<li>
<p>Set the <strong>Release Name</strong> to <code>bullseye</code> for Debian 11.</p>
</li>
<li>
<p>On the <strong>Partition Table</strong> tab, select the <code>Preseed</code> partition table.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-partition-tables_provisioning">Creating partition tables</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Templates</strong> tab, select the <code>Preseed Finish</code> template as <strong>Finish template</strong>, the <code>Preseed</code> template as <strong>Provisioning Template</strong>, and the <code>Preseed PXELinux</code> template as <strong>PXELinux template</strong>.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-provisioning-templates">Creating provisioning templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the operating system entry for Debian.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating-an-operating-system-for-Ubuntu-24-04_provisioning"><a class="anchor" href="#Creating-an-operating-system-for-Ubuntu-24-04_provisioning"></a>4.4. Creating an operating system for Ubuntu 24.04</h3>
<div class="paragraph">
<p>Create an operating system in Foreman to provision hosts running Ubuntu 24.04.
This example creates an operating system entry for Ubuntu 24.04.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Create Operating System</strong> to create an operating system entry for Ubuntu.</p>
</li>
<li>
<p>Enter <code>Ubuntu 24.04</code> as <strong>Name</strong> for the operating system.
Choose a name as reported by Ansible, Puppet, or Salt as fact.</p>
</li>
<li>
<p>Set the <strong>Major Version</strong> to <code>24.04</code>.</p>
</li>
<li>
<p>Leave the <strong>Minor Version</strong> field empty.</p>
</li>
<li>
<p>Set the <strong>Release Name</strong> to <code>noble</code> for Ubuntu 24.04.</p>
</li>
<li>
<p>On the <strong>Partition Table</strong> tab, select the <code>Preseed</code> partition table.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-partition-tables_provisioning">Creating partition tables</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Templates</strong> tab, select the <code>Preseed Finish</code> template as <strong>Finish template</strong>, the <code>Preseed</code> template as <strong>Provisioning Template</strong>, and the <code>Preseed PXELinux</code> template as <strong>PXELinux template</strong>.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-provisioning-templates">Creating provisioning templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the operating system entry for Ubuntu.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating-an-operating-system-for-Ubuntu-22-04_provisioning"><a class="anchor" href="#Creating-an-operating-system-for-Ubuntu-22-04_provisioning"></a>4.5. Creating an operating system for Ubuntu 22.04</h3>
<div class="paragraph">
<p>Create an operating system in Foreman to provision hosts running Ubuntu 22.04.
This example creates an operating system entry for Ubuntu 22.04.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Create Operating System</strong> to create an operating system entry for Ubuntu.</p>
</li>
<li>
<p>Enter <code>Ubuntu 22.04</code> as <strong>Name</strong> for the operating system.
Choose a name as reported by Ansible, Puppet, or Salt as fact.</p>
</li>
<li>
<p>Set the <strong>Major Version</strong> to <code>22.04</code>.</p>
</li>
<li>
<p>Leave the <strong>Minor Version</strong> field empty.</p>
</li>
<li>
<p>Set the <strong>Release Name</strong> to <code>jammy</code> for Ubuntu 22.04.</p>
</li>
<li>
<p>On the <strong>Partition Table</strong> tab, select the <code>Preseed</code> partition table.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-partition-tables_provisioning">Creating partition tables</a>.</p>
</div>
</li>
<li>
<p>On the <strong>Templates</strong> tab, select the <code>Preseed Finish</code> template as <strong>Finish template</strong>, the <code>Preseed</code> template as <strong>Provisioning Template</strong>, and the <code>Preseed PXELinux</code> template as <strong>PXELinux template</strong>.</p>
<div class="paragraph">
<p>For more information, see <a href="#creating-provisioning-templates">Creating provisioning templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the operating system entry for Ubuntu.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="updating-the-details-of-multiple-operating-systems_provisioning"><a class="anchor" href="#updating-the-details-of-multiple-operating-systems_provisioning"></a>4.6. Updating the details of multiple operating systems</h3>
<div class="paragraph">
<p>Use this procedure to update the details of multiple operating systems.
This example shows you how to assign each operating system a partition table called <code>Kickstart default</code>, a configuration template called <code>Kickstart default PXELinux</code>, and a provisioning template called <code>Kickstart Default</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, run the following Bash script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">PARTID=$(hammer --csv partition-table list | grep "Kickstart default," | cut -d, -f1)
PXEID=$(hammer --csv template list --per-page=1000 | grep "Kickstart default PXELinux" | cut -d, -f1)
FOREMAN_ID=$(hammer --csv template list --per-page=1000 | grep "provision" | grep ",Kickstart default" | cut -d, -f1)

for i in $(hammer --no-headers --csv os list | awk -F, {'print $1'})
do
   hammer partition-table add-operatingsystem --id="${PARTID}" --operatingsystem-id="${i}"
   hammer template add-operatingsystem --id="${PXEID}" --operatingsystem-id="${i}"
   hammer os set-default-template --id="${i}" --config-template-id=${PXEID}
   hammer os add-config-template --id="${i}" --config-template-id=${FOREMAN_ID}
   hammer os set-default-template --id="${i}" --config-template-id=${FOREMAN_ID}
done</code></pre>
</div>
</div>
</li>
<li>
<p>Display information about the updated operating system to verify that the operating system is updated correctly:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer os info --id <em>1</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-architectures_provisioning"><a class="anchor" href="#creating-architectures_provisioning"></a>4.7. Creating architectures</h3>
<div class="paragraph">
<p>An architecture in Foreman represents a logical grouping of hosts and operating systems.
Architectures are created by Foreman automatically when hosts check in with Puppet.
The x86_64 architecture is already preset in Foreman.</p>
</div>
<div class="paragraph">
<p>Use this procedure to create an architecture in Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Architectures</strong>.</p>
</li>
<li>
<p>Click <strong>Create Architecture</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the architecture.</p>
</li>
<li>
<p>From the <strong>Operating Systems</strong> list, select an operating system.
If none are available, you can create and assign them under <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Enter the <code>hammer architecture create</code> command to create an architecture.
Specify its name and operating systems that include this architecture:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer architecture create \
--name "<em>My_Architecture</em>" \
--operatingsystems "<em>My_Operating_System</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-hardware-models_provisioning"><a class="anchor" href="#creating-hardware-models_provisioning"></a>4.8. Creating hardware models</h3>
<div class="paragraph">
<p>Use this procedure to create a hardware model in Foreman so that you can specify which hardware model a host uses.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Hardware Models</strong>.</p>
</li>
<li>
<p>Click <strong>Create Model</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the hardware model.</p>
</li>
<li>
<p>Optionally, in the <strong>Hardware Model</strong> and <strong>Vendor Class</strong> fields, you can enter corresponding information for your system.</p>
</li>
<li>
<p>In the <strong>Info</strong> field, enter a description of the hardware model.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your hardware model.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create a hardware model using the <code>hammer model create</code> command.
The only required parameter is <code>--name</code>.
Optionally, enter the hardware model with the <code>--hardware-model</code> option, a vendor class with the <code>--vendor-class</code> option, and a description with the <code>--info</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer model create \
--hardware-model "<em>My_Hardware_Model</em>" \
--info "<em>My_Description</em>" \
--name "<em>My_Hardware_Model_Name</em>" \
--vendor-class "<em>My_Vendor_Class</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-compute-profiles_provisioning"><a class="anchor" href="#creating-compute-profiles_provisioning"></a>4.9. Creating compute profiles</h3>
<div class="paragraph">
<p>You can use compute profiles to predefine virtual machine hardware details such as CPUs, memory, and storage.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-compute-profiles_provisioning">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<p>A default installation of Foreman contains three predefined profiles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>1-Small</code></p>
</li>
<li>
<p><code>2-Medium</code></p>
</li>
<li>
<p><code>3-Large</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can apply compute profiles to all supported compute resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#supported-cloud-providers">Supported cloud providers</a></p>
</li>
<li>
<p><a href="#supported-virtualization-infrastructures">Supported virtualization infrastructures</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong> and click <strong>Create Compute Profile</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the profile.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.
A new window opens with the name of the compute profile.</p>
</li>
<li>
<p>In the new window, click the name of each compute resource and edit the attributes you want to set for this compute profile.</p>
</li>
</ol>
</div>
<div id="cli-creating-compute-profiles_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a new compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile create --name "<em>My_Compute_Profile</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set attributes for the compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile values create \
--compute-attributes "<em>flavor=m1.small,cpus=2,memory=4GB,cpu_mode=default</em> \
--compute-resource "<em>My_Compute_Resource</em>" \
--compute-profile "<em>My_Compute_Profile</em>" \
--volume size=<em>40GB</em></pre>
</div>
</div>
</li>
<li>
<p>Optional: To update the attributes of a compute profile, specify the attributes you want to change.
For example, to change the number of CPUs and memory size:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile values update \
--compute-resource "<em>My_Compute_Resource</em>" \
--compute-profile "<em>My_Compute_Profile</em>" \
--attributes "<em>cpus=2,memory=4GB</em>" \
--interface "<em>type=network,bridge=br1,index=1</em>" \
--volume "size=<em>40GB</em>"</pre>
</div>
</div>
</li>
<li>
<p>Optional: To change the name of the compute profile, use the <code>--new-name</code> attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile update \
--name "<em>My_Compute_Profile</em>" \
--new-name "<em>My_New_Compute_Profile</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about creating compute profiles by using Hammer, enter <code>hammer compute-profile --help</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-templates-for-provisioning"><a class="anchor" href="#preparing-templates-for-provisioning"></a>5. Preparing templates for provisioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman provides the following default template types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provisioning templates</p>
</li>
<li>
<p>Partition tables</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use the default templates or create custom templates.</p>
</div>
<div class="paragraph">
<p>Provisioning templates are implemented with parameters that you can configure as host parameters to affect the provisioning process.
You can also add custom steps to certain templates by creating custom <code>pre</code> or <code>post</code> snippets and thus customize the provisioning process further without editing the default templates.</p>
</div>
<div class="paragraph">
<p>Thanks to partition tables implemented as templates, you can create custom, even dynamic, partition tables.</p>
</div>
<div class="paragraph">
<p>When you do not edit the default templates, maintenance is easier and you get the benefit of updates to the templates from Foreman community.</p>
</div>
<div class="sect2">
<h3 id="provisioning-templates"><a class="anchor" href="#provisioning-templates"></a>5.1. Provisioning templates</h3>
<div class="paragraph">
<p>A provisioning template defines the way Foreman&#160;server installs an operating system on a host.</p>
</div>
<div class="paragraph">
<p>Foreman includes many template examples.
In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> to view them.
You can create a template or clone a template and edit the clone.
For help with templates, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> &gt; <strong>Create Template</strong> &gt; <strong>Help</strong>.</p>
</div>
<div class="paragraph">
<p>Templates accept the Embedded Ruby (ERB) syntax.
For more information, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#Template_Writing_Reference_managing-hosts">Template Writing Reference</a> in <em>Managing hosts</em>.</p>
</div>
<div class="paragraph">
<p>You can download provisioning templates.
Before you can download the template, you must create a debug certificate.
For more information, see <a href="https://docs.theforeman.org/nightly/Managing_Organizations_and_Locations/index-foreman-deb.html#Creating_an_Organization_Debug_Certificate_managing-organizations-locations">Creating an Organization Debug Certificate</a> in <em>Managing organizations and locations in Foreman</em>.</p>
</div>
<div class="paragraph">
<p>You can synchronize templates between Foreman&#160;server and a Git repository or a local directory.
For more information, see <a href="https://docs.theforeman.org/nightly/Administering_Project/index-foreman-deb.html#synchronizing-template-repositories">Synchronizing template repositories</a> in <em>Administering Foreman</em>.</p>
</div>
<div class="paragraph">
<p>To view the history of changes applied to a template, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>, select one of the templates, and click <strong>History</strong>.
Click <strong>Revert</strong> to override the content with the previous version.
You can also revert to an earlier change.
Click <strong>Show Diff</strong> to see information about a specific change:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Template Diff</strong> tab displays changes in the body of a provisioning template.</p>
</li>
<li>
<p>The <strong>Details</strong> tab displays changes in the template description.</p>
</li>
<li>
<p>The <strong>History</strong> tab displays the user who made a change to the template and date of the change.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="kinds-of-provisioning-templates"><a class="anchor" href="#kinds-of-provisioning-templates"></a>5.2. Kinds of provisioning templates</h3>
<div class="paragraph">
<p>There are various kinds of provisioning templates:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Provision</dt>
<dd>
<p>The main template for the provisioning process.
For example, a Kickstart template.
For more information about Kickstart syntax and commands, see the following resources:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/automatically_installing_rhel/automated-installation-workflow_rhel-installer">Automated installation workflow</a> in <em>Automatically installing RHEL&#160;9</em></p>
</li>
<li>
<p><a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/automatically_installing_rhel/automated-installation-workflow_rhel-installer">Automated installation workflow</a> in <em>Automatically installing RHEL&#160;8</em></p>
</li>
<li>
<p><a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/installation_guide/sect-kickstart-syntax">Kickstart Syntax Reference</a> in the <em>Red&#160;Hat Enterprise Linux&#160;7 Installation Guide</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">PXELinux, PXEGrub, PXEGrub2</dt>
<dd>
<p>PXE-based templates that deploy to the template Smart&#160;Proxy associated with a subnet to ensure that the host uses the installer with the correct kernel options.
For BIOS provisioning, select <strong>PXELinux</strong> template.
For UEFI provisioning, select <strong>PXEGrub2</strong>.</p>
</dd>
<dt class="hdlist1">Finish</dt>
<dd>
<p>Post-configuration scripts to execute using an SSH connection when the main provisioning process completes.
You can use Finish templates only for image-based provisioning in virtual or cloud environments that do not support user_data.
Do not confuse an image with a foreman discovery ISO, which is sometimes called a Foreman discovery image.
An image in this context is an install image in a virtualized environment for easy deployment.</p>
<div class="paragraph">
<p>When a finish script successfully exits with the return code <code>0</code>, Foreman treats the code as a success and the host exits the build mode.</p>
</div>
<div class="paragraph">
<p>Note that there are a few finish scripts with a build mode that uses a <em>call back</em> HTTP call.
These scripts are not used for image-based provisioning, but for post configuration of operating-system installations such as Debian, Ubuntu, and BSD.</p>
</div>
</dd>
<dt class="hdlist1">user_data</dt>
<dd>
<p>Post-configuration scripts for providers that accept custom data, also known as seed data.
You can use the user_data template to provision virtual machines in cloud or virtualised environments only.
This template does not require Foreman to be able to reach the host; the cloud or virtualization platform is responsible for delivering the data to the image.</p>
<div class="paragraph">
<p>Ensure that the image that you want to provision has the software to read the data installed and set to start during boot.
For example, <code>cloud-init</code>, which expects YAML input, or <code>ignition</code>, which expects JSON input.</p>
</div>
</dd>
<dt class="hdlist1">cloud_init</dt>
<dd>
<p>Some environments, such as VMWare, either do not support custom data or have their own data format that limits what can be done during customization.
In this case, you can configure a cloud-init client with the <code>foreman</code> plugin, which attempts to download the template directly from Foreman over HTTP or HTTPS.
This technique can be used in any environment, preferably virtualized.</p>
<div class="paragraph">
<p>Ensure that you meet the following requirements to use the <code>cloud_init</code> template:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that the image that you want to provision has the software to read the data installed and set to start during boot.</p>
</li>
<li>
<p>A provisioned host is able to reach Foreman from the IP address that matches the host&#8217;s provisioning interface IP.</p>
<div class="paragraph">
<p>Note that cloud-init does not work behind NAT.</p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Bootdisk</dt>
<dd>
<p>Templates for PXE-less boot methods.</p>
</dd>
<dt class="hdlist1">Kernel Execution (kexec)</dt>
<dd>
<p>Kernel execution templates for PXE-less boot methods.</p>
</dd>
<dt class="hdlist1">Script</dt>
<dd>
<p>An arbitrary script not used by default but useful for custom tasks.</p>
</dd>
<dt class="hdlist1">ZTP</dt>
<dd>
<p>Zero Touch Provisioning templates.</p>
</dd>
<dt class="hdlist1">POAP</dt>
<dd>
<p>PowerOn Auto Provisioning templates.</p>
</dd>
<dt class="hdlist1">iPXE</dt>
<dd>
<p>Templates for <code>iPXE</code> or <code>gPXE</code> environments to use instead of PXELinux.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="creating-provisioning-templates"><a class="anchor" href="#creating-provisioning-templates"></a>5.3. Creating provisioning templates</h3>
<div class="paragraph">
<p>A provisioning template defines the way Foreman&#160;server installs an operating system on a host.
Use this procedure to create a new provisioning template.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong> and click <strong>Create Template</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the provisioning template.</p>
</li>
<li>
<p>Fill in the rest of the fields as required.
The <strong>Help</strong> tab provides information about the template syntax and details the available functions, variables, and methods that can be called on different types of objects within the template.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Before you create a template with the CLI, create a plain text file that contains the template.
This example uses the <code>~/my-template</code> file.</p>
</li>
<li>
<p>Create the template using the <code>hammer template create</code> command and specify the type with the <code>--type</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer template create \
--file ~/my-template \
--locations "<em>My_Location</em>" \
--name "<em>My_Provisioning_Template</em>" \
--organizations "<em>My_Organization</em>" \
--type provision</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="cloning-provisioning-templates"><a class="anchor" href="#cloning-provisioning-templates"></a>5.4. Cloning provisioning templates</h3>
<div class="paragraph">
<p>A provisioning template defines the way Foreman&#160;server installs an operating system on a host.
Use this procedure to clone a template and add your updates to the clone.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Find the template that you want to use.</p>
</li>
<li>
<p>Click <strong>Clone</strong> to duplicate the template.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the provisioning template.</p>
</li>
<li>
<p>Select the <strong>Default</strong> checkbox to set the template to associate automatically with new organizations or locations.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, enter the body of the provisioning template.
You can also use the <strong>Template</strong> file browser to upload a template file.</p>
</li>
<li>
<p>In the <strong>Audit Comment</strong> field, enter a summary of changes to the provisioning template for auditing purposes.</p>
</li>
<li>
<p>Click the <strong>Type</strong> tab and if your template is a snippet, select the <strong>Snippet</strong> checkbox.
A snippet is not a standalone provisioning template, but a part of a provisioning template that can be inserted into other provisioning templates.</p>
</li>
<li>
<p>From the <strong>Type</strong> list, select the type of the template.
For example, <strong>Provisioning template</strong>.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab and from the <strong>Applicable Operating Systems</strong> list, select the names of the operating systems that you want to associate with the provisioning template.</p>
</li>
<li>
<p>Optionally, click <strong>Add combination</strong> and select a host group from the <strong>Host Group</strong> list or an environment from the <strong>Environment</strong> list to associate provisioning template with the host groups and environments.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs to add any additional contexts to the template.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your provisioning template.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="running-custom-code-during-host-provisioning"><a class="anchor" href="#running-custom-code-during-host-provisioning"></a>5.5. Running custom code during host provisioning</h3>
<div class="paragraph">
<p>You can run custom code before or after provisioning the host by creating a custom provisioning snippet.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Check your provisioning template to ensure that it supports the custom snippets you want to use.</p>
<div class="paragraph">
<p>You can view all provisioning templates under <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Click <strong>Create Template</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for your custom provisioning snippet.
The name must start with the name of a provisioning template that supports including custom provisioning snippets:</p>
<div class="ulist">
<ul>
<li>
<p>Append <code>custom pre</code> to the name of a provisioning template to run code before provisioning a host.</p>
</li>
<li>
<p>Append <code>custom post</code> to the name of a provisioning template to run code after provisioning a host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>On the <strong>Type</strong> tab, select <strong>Snippet</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to create your custom provisioning snippet.</p>
</li>
</ol>
</div>
<div id="cli-running-custom-code-during-host-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a plain text file that contains your custom snippet.</p>
</li>
<li>
<p>Create the template using <code>hammer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer template create \
--file "<em>/path/to/My_Snippet</em>" \
--locations "<em>My_Location</em>" \
--name "<em>My_Template_Name_custom_pre" \
--organizations "_My_Organization</em>" \
--type snippet</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Custom_Provisioning_Snippet_Example_for_Debian_provisioning"><a class="anchor" href="#Custom_Provisioning_Snippet_Example_for_Debian_provisioning"></a>5.6. Custom provisioning snippet example for Debian</h3>
<div class="paragraph">
<p>You can use <code>Custom Post</code> snippets to call external APIs from within the provisioning template directly after provisioning a host.</p>
</div>
<div class="listingblock">
<div class="title"><code>Preseed default custom post</code> Example for Debian/Ubuntu</div>
<div class="content">
<pre class="nowrap">echo "Calling API to report successful host deployment"

apt install -y curl ca-certificates

curl -X POST \
-H "Content-Type: application/json" \
-d '{"name": "&lt;%= @host.name %&gt;", "operating_system": "&lt;%= @host.operatingsystem.name %&gt;", "status": "provisioned",}' \
"https://api.example.com/"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Custom_Provisioning_Snippet_Example_for_Enterprise_Linux_provisioning"><a class="anchor" href="#Custom_Provisioning_Snippet_Example_for_Enterprise_Linux_provisioning"></a>5.7. Custom provisioning snippet example for Enterprise Linux</h3>
<div class="paragraph">
<p>You can use <code>Custom Post</code> snippets to call external APIs from within the provisioning template directly after provisioning a host.</p>
</div>
<div class="listingblock">
<div class="title"><code>Kickstart default finish custom post</code> Example for Enterprise Linux</div>
<div class="content">
<pre class="nowrap">echo "Calling API to report successful host deployment"

yum install -y curl ca-certificates

curl -X POST \
-H "Content-Type: application/json" \
-d '{"name": "&lt;%= @host.name %&gt;", "operating_system": "&lt;%= @host.operatingsystem.name %&gt;", "status": "provisioned",}' \
"https://api.example.com/"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-provisioning-snippet-example-for-sles"><a class="anchor" href="#custom-provisioning-snippet-example-for-sles"></a>5.8. Custom provisioning snippet example for SUSE Linux Enterprise Server</h3>
<div class="paragraph">
<p>You can use <code>Custom Post</code> snippets to call external APIs from within the provisioning template directly after provisioning a host.</p>
</div>
<div class="listingblock">
<div class="title"><code>AutoYaST default custom post</code> Example for SUSE Linux Enterprise Server</div>
<div class="content">
<pre class="nowrap">echo "Calling API to report successful host deployment"

zypper install -y curl ca-certificates

curl -X POST \
-H "Content-Type: application/json" \
-d '{"name": "&lt;%= @host.name %&gt;", "operating_system": "&lt;%= @host.operatingsystem.name %&gt;", "status": "provisioned",}' \
"https://api.example.com/"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="associating-templates-with-operating-systems"><a class="anchor" href="#associating-templates-with-operating-systems"></a>5.9. Associating templates with operating systems</h3>
<div class="paragraph">
<p>You can associate templates with operating systems in Foreman.
The following example adds a provisioning template to an operating system entry.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-associating-templates-with-operating-systems">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Select a provisioning template.</p>
</li>
<li>
<p>On the <strong>Association</strong> tab, select all applicable operating systems.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
<div id="cli-associating-templates-with-operating-systems" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Optional: View all templates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer template list</pre>
</div>
</div>
</li>
<li>
<p>Optional: View all operating systems:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer os list</pre>
</div>
</div>
</li>
<li>
<p>Associate a template with an operating system:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer template add-operatingsystem \
--id <em>My_Template_ID</em> \
--operatingsystem-id <em>My_Operating_System_ID</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-partition-tables_provisioning"><a class="anchor" href="#creating-partition-tables_provisioning"></a>5.10. Creating partition tables</h3>
<div class="paragraph">
<p>A partition table is a type of template that defines the way Foreman&#160;server configures the disks available on a new host.
A Partition table uses the same ERB syntax as provisioning templates.
Foreman contains a set of default partition tables to use, including a <code>Kickstart default</code>.
You can also edit partition table entries to configure the preferred partitioning scheme, or create a partition table entry and add it to the operating system entry.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-partition-tables_provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Partition Tables</strong>.</p>
</li>
<li>
<p>Click <strong>Create Partition Table</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the partition table.</p>
</li>
<li>
<p>Select the <strong>Default</strong> checkbox if you want to set the template to automatically associate with new organizations or locations.</p>
</li>
<li>
<p>Select the <strong>Snippet</strong> checkbox if you want to identify the template as a reusable snippet for other partition tables.</p>
</li>
<li>
<p>From the <strong>Operating System Family</strong> list, select the distribution or family of the partitioning layout.
For example, Red&#160;Hat Enterprise Linux, CentOS, and Fedora are in the Red Hat family.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, enter the layout for the disk partition.</p>
<div class="paragraph">
<p>The format of the layout must match that for the intended operating system.
For example, Enterprise Linux requires a layout that matches a Kickstart file, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zerombr
clearpart --all --initlabel
autopart</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="#dynamic-partition-example_provisioning">Dynamic partition example</a>.</p>
</div>
<div class="paragraph">
<p>You can also use the file browser in the template editor to import the layout from a file.</p>
</div>
</li>
<li>
<p>In the <strong>Audit Comment</strong> field, add a summary of changes to the partition layout.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> and <strong>Locations</strong> tabs to add any other provisioning contexts that you want to associate with the partition table.
Foreman adds the partition table to the current provisioning context.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your partition table.</p>
</li>
</ol>
</div>
<div id="cli-creating-partition-tables_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a plain text file, such as <code><em>~/My_Partition_Table</em></code>, that contains the partition layout.</p>
<div class="paragraph">
<p>The format of the layout must match that for the intended operating system.
For example, Enterprise Linux requires a layout that matches a Kickstart file, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zerombr
clearpart --all --initlabel
autopart</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="#dynamic-partition-example_provisioning">Dynamic partition example</a>.</p>
</div>
</li>
<li>
<p>Create the installation medium using the <code>hammer partition-table create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer partition-table create \
--file "<em>~/My_Partition_Table</em>" \
--locations "<em>My_Location</em>" \
--name "<em>My_Partition_Table</em>" \
--organizations "<em>My_Organization</em>" \
--os-family "Redhat" \
--snippet false</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="associating-partition-tables-with-disk-encryption_provisioning"><a class="anchor" href="#associating-partition-tables-with-disk-encryption_provisioning"></a>5.11. Associating partition tables with disk encryption</h3>
<div class="paragraph">
<p>Foreman contains partition tables that encrypt the disk of your host by using Linux Unified Key Setup (LUKS) during host provisioning.
Encrypted disks on hosts protect data at rest.
Optionally, you can also bind the disk to a Tang server through Clevis for decryption during boot.</p>
</div>
<div class="paragraph">
<p>Associate the partition table with your operating system entry.
Then, you assign the partition table to your host group or select it manually during provisioning.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your host has access to the <code>AppStream</code> repository to install <code>clevis</code> during provisioning.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Select your Enterprise Linux entry.</p>
</li>
<li>
<p>On the <strong>Partition Table</strong> tab, associate <code>Kickstart default encrypted</code> with your operating system entry.</p>
</li>
<li>
<p>Create a host group that uses the <code>Kickstart default encrypted</code> partition table.
For more information, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#Creating_a_Host_Group_managing-hosts">Creating a host group</a> in <em>Managing hosts</em>.</p>
</li>
<li>
<p>Decrypt the disk of your host during boot time by using one of the following options:</p>
<div class="ulist">
<ul>
<li>
<p>LUKS encryption: Add the host parameter <code>disk_enc_passphrase</code> as type <strong>string</strong> and your cleartext passphrase of the LUKS container as the value.</p>
</li>
<li>
<p>Clevis and Tang: Add the host parameter <code>disk_enc_tang_servers</code> as type <strong>array</strong> and your list of Tang servers (example: <code>["1.2.3.4"]</code> or <code>["server.example.com", "5.6.7.8"]</code>).</p>
<div class="paragraph">
<p>If you set <code>disk_enc_tang_servers</code>, do not set <code>disk_enc_passphrase</code> because the passphrase slot is removed from the LUKS container after provisioning.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/latchset/clevis" class="bare">https://github.com/latchset/clevis</a></p>
</li>
<li>
<p><a href="https://github.com/latchset/tang" class="bare">https://github.com/latchset/tang</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-partition-example_provisioning"><a class="anchor" href="#dynamic-partition-example_provisioning"></a>5.12. Dynamic partition example</h3>
<div class="paragraph">
<p>Using an Anaconda Kickstart template, the following section instructs Anaconda to erase the whole disk, automatically partition, enlarge one partition to maximum size, and then proceed to the next sequence of events in the provisioning process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">zerombr
clearpart --all --initlabel
autopart &lt;%= host_param('autopart_options') %&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dynamic partitioning is executed by the installation program.
Therefore, you can write your own rules to specify how you want to partition disks according to runtime information from the node, for example, disk sizes, number of drives, vendor, or manufacturer.</p>
</div>
<div class="paragraph">
<p>If you want to provision servers and use dynamic partitioning, add the following example as a template.
When the <code>#Dynamic</code> entry is included, the content of the template loads into a <code>%pre</code> shell scriplet and creates a <code>/tmp/diskpart.cfg</code> that is then included into the Kickstart partitioning section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-none" data-lang="none">#Dynamic (do not remove this line)

MEMORY=$((`grep MemTotal: /proc/meminfo | sed 's/^MemTotal: *//'|sed 's/ .*//'` / 1024))
if [ "$MEMORY" -lt 2048 ]; then
    SWAP_MEMORY=$(($MEMORY * 2))
elif [ "$MEMORY" -lt 8192 ]; then
    SWAP_MEMORY=$MEMORY
elif [ "$MEMORY" -lt 65536 ]; then
    SWAP_MEMORY=$(($MEMORY / 2))
else
    SWAP_MEMORY=32768
fi

cat &lt;&lt;EOF &gt; /tmp/diskpart.cfg
zerombr
clearpart --all --initlabel
part /boot --fstype ext4 --size 200 --asprimary
part swap --size "$SWAP_MEMORY"
part / --fstype ext4 --size 1024 --grow
EOF</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-settings"><a class="anchor" href="#security-settings"></a>6. Security settings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure global settings for provisioning.</p>
</div>
<div class="paragraph">
<p>This chapter only mentions notable settings.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/nightly/Administering_Project/index-foreman-deb.html#provisioning_settings_admin">Provisioning settings</a> in <em>Administering Foreman</em></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="configuring-the-security-token-validity-duration"><a class="anchor" href="#configuring-the-security-token-validity-duration"></a>6.1. Configuring the security token validity duration</h3>
<div class="paragraph">
<p>When performing any kind of provisioning, as a security measure, Foreman automatically generates a unique token and adds this token to the OS installer recipe URL in the PXE configuration file (PXELinux, Grub2).
By default, the token is valid for 360 minutes.
When you provision a host, ensure that you reboot the host within this time frame.
If the token expires, it is no longer valid and you receive a 404 error and the operating system installer download fails.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>, and click the <strong>Provisioning</strong> tab.</p>
</li>
<li>
<p>Find the <strong>Token duration</strong> option and click the edit icon and edit the duration, or enter <code>0</code> to disable token generation.
If token generation is disabled, an attacker can spoof client IP address and download OS installer recipe from Foreman&#160;server, including the encrypted root password.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="setting-a-default-encrypted-root-password_provisioning"><a class="anchor" href="#setting-a-default-encrypted-root-password_provisioning"></a>6.2. Setting a default encrypted root password for hosts</h3>
<div class="paragraph">
<p>If you do not want to set a plain text default root password for the hosts that you provision, you can use a default encrypted password.</p>
</div>
<div class="paragraph">
<p>The default root password can be inherited by a host group and consequentially by hosts in that group.</p>
</div>
<div class="paragraph">
<p>If you change the password and reprovision the hosts in the group that inherits the password, the password will be overwritten on the hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Generate an encrypted password:</p>
<div class="listingblock">
<div class="content">
<pre>$ python3 -c 'import crypt,getpass;pw=getpass.getpass(); print(crypt.crypt(pw)) if (pw==getpass.getpass("Confirm: ")) else exit()'</pre>
</div>
</div>
</li>
<li>
<p>Copy the password for later use.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Settings</strong> page, select the <strong>Provisioning</strong> tab.</p>
</li>
<li>
<p>In the <strong>Name</strong> column, navigate to <strong>Root password</strong>, and click <strong>Click to edit</strong>.</p>
</li>
<li>
<p>Paste the encrypted password, and click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Provisioning_FIPS_Compliant_Hosts_provisioning"><a class="anchor" href="#Provisioning_FIPS_Compliant_Hosts_provisioning"></a>6.3. Provisioning FIPS-compliant hosts</h3>
<div class="paragraph">
<p>Foreman supports provisioning hosts that comply with the National Institute of Standards and Technology&#8217;s <a href="https://csrc.nist.gov/publications/detail/fips/140/2/final">Security Requirements for Cryptographic Modules</a> standard, reference number FIPS 140-2, referred to here as FIPS.</p>
</div>
<div class="paragraph">
<p>To enable the provisioning of hosts that are FIPS-compliant, complete the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change the provisioning password hashing algorithm for the operating system</p>
</li>
<li>
<p>Create a host group and set a host group parameter to enable FIPS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#Creating_a_Host_Group_managing-hosts">Creating a Host Group</a> in <em>Managing hosts</em>.</p>
</div>
<div class="paragraph">
<p>The provisioned hosts have the FIPS-compliant settings applied.
To confirm that these settings are enabled, complete the steps in <a href="#Verifying_FIPS_Mode_Is_Enabled_provisioning">Verifying FIPS mode is enabled</a>.</p>
</div>
<div class="sect3">
<h4 id="Changing_the_Provisioning_Password_Hashing_Algorithm_provisioning"><a class="anchor" href="#Changing_the_Provisioning_Password_Hashing_Algorithm_provisioning"></a>6.3.1. Changing the provisioning password hashing algorithm</h4>
<div class="paragraph">
<p>To provision FIPS-compliant hosts, you must first set the password hashing algorithm that you use in provisioning to SHA256.
This configuration setting must be applied for each operating system you want to deploy as FIPS-compliant.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify the Operating System IDs:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer os list</pre>
</div>
</div>
</li>
<li>
<p>Update each operating system&#8217;s password hash value.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer os update \
--password-hash SHA256
--title "<em>My_Operating_System</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>Note that you cannot use a comma-separated list of values.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Setting_the_FIPS_Enabled_Parameter_provisioning"><a class="anchor" href="#Setting_the_FIPS_Enabled_Parameter_provisioning"></a>6.3.2. Setting the FIPS-enabled parameter</h4>
<div class="paragraph">
<p>To provision a FIPS-compliant host, you must create a host group and set the host group parameter <code>fips_enabled</code> to <code>true</code>.
If this is not set to <code>true</code>, or is absent, the FIPS-specific changes do not apply to the system.
You can set this parameter when you provision a host or for a host group.</p>
</div>
<div class="paragraph">
<p>To set this parameter when provisioning a host, append <code>--parameters fips_enabled=true</code> to the Hammer command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer hostgroup set-parameter \
--hostgroup "<em>My_Host_Group</em>" \
--name fips_enabled \
--value "true"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the output of the command <code>hammer hostgroup set-parameter --help</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Verifying_FIPS_Mode_Is_Enabled_provisioning"><a class="anchor" href="#Verifying_FIPS_Mode_Is_Enabled_provisioning"></a>6.3.3. Verifying FIPS mode is enabled</h4>
<div class="paragraph">
<p>To verify these FIPS compliance changes have been successful, you must provision a host and check its configuration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the host as <code>root</code> or with an admin-level account.</p>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ cat /proc/sys/crypto/fips_enabled</pre>
</div>
</div>
<div class="paragraph">
<p>A value of <code>1</code> confirms that FIPS mode is enabled.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="provisioning-contexts_provisioning"><a class="anchor" href="#provisioning-contexts_provisioning"></a>7. Provisioning contexts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A provisioning context is the combination of an organization and location that you specify for Foreman components.
The organization and location that a component belongs to sets the ownership and access for that component.</p>
</div>
<div class="paragraph">
<p>Organizations divide Foreman components into logical groups based on ownership, purpose, content, security level, and other divisions.
You can create and manage multiple organizations through Foreman and assign components to each individual organization.
This ensures Foreman&#160;server provisions hosts within a certain organization and only uses components that are assigned to that organization.
For more information about organizations, see <a href="https://docs.theforeman.org/nightly/Managing_Organizations_and_Locations/index-foreman-deb.html#Managing_Organizations_managing-organizations-locations">Managing Organizations</a> in <em>Managing organizations and locations in Foreman</em>.</p>
</div>
<div class="paragraph">
<p>Locations function similar to organizations.
The difference is that locations are based on physical or geographical setting.
Users can nest locations in a hierarchy.
For more information about locations, see <a href="https://docs.theforeman.org/nightly/Managing_Organizations_and_Locations/index-foreman-deb.html#Managing_Locations_managing-organizations-locations">Managing Locations</a> in <em>Managing organizations and locations in Foreman</em>.</p>
</div>
<div class="sect2">
<h3 id="setting-the-provisioning-context_provisioning"><a class="anchor" href="#setting-the-provisioning-context_provisioning"></a>7.1. Setting the provisioning context</h3>
<div class="paragraph">
<p>When you set a provisioning context, you define which organization and location to use for provisioning hosts.</p>
</div>
<div class="paragraph">
<p>The organization and location menus are located in the menu bar, on the upper left of the Foreman web UI.
If you have not selected an organization and location to use, the menu displays: <strong>Any Organization</strong> and <strong>Any Location</strong>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <strong>Any Organization</strong> and select the organization.</p>
</li>
<li>
<p>Click <strong>Any Location</strong> and select the location to use.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each user can set their default provisioning context in their account settings.
Click the user name in the upper right of the Foreman web UI and select <strong>My account</strong> to edit your user account settings.</p>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>When using the CLI, include either <code>--organization</code> or <code>--organization-label</code> and <code>--location</code> or <code>--location-id</code> as an option.
For example:</p>
<div class="listingblock">
<div class="content">
<pre>$ hammer host list --organization "<em>My_Organization</em>" --location "<em>My_Location</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>This command outputs hosts allocated to <code>My_Organization</code> and <code>My_Location</code>.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-network-boot-to-provision-hosts"><a class="anchor" href="#using-network-boot-to-provision-hosts"></a>8. Using network boot to provision hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After integrating provisioning infrastructure services with Foreman, you can provision hosts with Foreman by booting hosts over a network.
Once the host boots, Foreman&#160;server or Smart&#160;Proxy&#160;server provides operating system installation content that the host downloads.
After the operating system has been installed, the host registers to Foreman and Foreman performs an initial configuration of the host.</p>
</div>
<div class="paragraph">
<div class="title">BIOS and UEFI interfaces</div>
<p>Both BIOS and UEFI interfaces work as interpreters between the operating system and firmware of a computer, initializing hardware components and starting the operating system at boot time.
With Foreman, you can perform both BIOS and UEFI based PXE provisioning.
For UEFI interfaces with an HTTP boot client, you can also perform UEFI HTTP provisioning.</p>
</div>
<div class="paragraph">
<div class="title">UEFI Secure Boot</div>
<p>Foreman supports host provisioning with UEFI Secure Boot.
By default, you can provision operating systems from the vendor of the operating system of your Foreman&#160;server on Secure Boot enabled hosts.
To provision operating systems on Secure Boot enabled hosts from different vendors, you have to provide signed shim and GRUB2 binaries provided by the vendor of your operating system.
For more information, see <a href="#configuring-smart-proxy-for-secure-boot">Configuring Smart&#160;Proxy for Secure Boot</a>.</p>
</div>
<div class="paragraph">
<div class="title">Bonded network interfaces</div>
<p>You can configure a bonded interface that Foreman will use during the installation process, for example, to download installation content.
After provisioning completes, the provisioned system can also use the bonded interface.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Foreman cannot PXE boot a bonded interface that requires configuration on a network switch as well as on your host.</p>
</div>
<div class="paragraph">
<p>After your host loads the kernel of an installer or the kernel of an operating system, bonding works as expected.
Therefore, you can use a boot disk to work around PXE boot limitations when your bonded interface requires configuration on both a switch and your host.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="Network_Boot_Provisioning_Workflow_using-network-boot"><a class="anchor" href="#Network_Boot_Provisioning_Workflow_using-network-boot"></a>8.1. Network boot provisioning workflow</h3>
<div class="paragraph">
<p>The provisioning process follows a basic PXE workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You create a host and select a domain and subnet.
Foreman requests an available IP address from the DHCP Smart&#160;Proxy&#160;server that is associated with the subnet or from the PostgreSQL database in Foreman.
Foreman loads this IP address into the <strong>IP address</strong> field in the Create Host window.
When you complete all the options for the new host, submit the new host request.</p>
</li>
<li>
<p>Depending on the configuration specifications of the host and its domain and subnet, Foreman creates the following settings:</p>
<div class="ulist">
<ul>
<li>
<p>A DHCP record on Smart&#160;Proxy&#160;server that is associated with the subnet.</p>
</li>
<li>
<p>A forward DNS record on Smart&#160;Proxy&#160;server that is associated with the domain.</p>
</li>
<li>
<p>A reverse DNS record on the DNS Smart&#160;Proxy&#160;server that is associated with the subnet.</p>
</li>
<li>
<p>PXELinux, Grub, Grub2, and iPXE configuration files for the host in the TFTP Smart&#160;Proxy&#160;server that is associated with the subnet.</p>
</li>
<li>
<p>A Puppet certificate on the associated Puppet server.</p>
</li>
<li>
<p>A realm on the associated identity server.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The host is configured to boot from the network as the first device and HDD as the second device.</p>
</li>
<li>
<p>The new host requests a DHCP reservation from the DHCP server.</p>
</li>
<li>
<p>The DHCP server responds to the reservation request and returns TFTP <code>next-server</code> and <code>filename</code> options.</p>
</li>
<li>
<p>The host requests the boot loader and menu from the TFTP server according to the PXELoader setting.</p>
</li>
<li>
<p>A boot loader is returned over TFTP.</p>
</li>
<li>
<p>The boot loader fetches configuration for the host through its provisioning interface MAC address.</p>
</li>
<li>
<p>The boot loader fetches the operating system installer kernel, init RAM disk, and boot parameters.</p>
</li>
<li>
<p>The installer requests the provisioning template from Foreman.</p>
</li>
<li>
<p>Foreman renders the provision template and returns the result to the host.</p>
</li>
<li>
<p>The installer performs installation of the operating system.</p>
<div class="ulist">
<ul>
<li>
<p>The installer notifies Foreman of a successful build in the <code>postinstall</code> script.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The PXE configuration files revert to a local boot template.</p>
</li>
<li>
<p>The host reboots.</p>
</li>
<li>
<p>The new host requests a DHCP reservation from the DHCP server.</p>
</li>
<li>
<p>The DHCP server responds to the reservation request and returns TFTP <code>next-server</code> and <code>filename</code> options.</p>
</li>
<li>
<p>The host requests the boot loader and menu from the TFTP server according to the PXELoader setting.</p>
</li>
<li>
<p>A boot loader is returned over TFTP.</p>
</li>
<li>
<p>The boot loader fetches the configuration for the host through its provision interface MAC address.</p>
</li>
<li>
<p>The boot loader initiates boot from the local drive.</p>
</li>
<li>
<p>If you configured the host to use Puppet classes, the host uses the modules to configure itself.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The fully provisioned host performs the following workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The host is configured to boot from the network as the first device and HDD as the second device.</p>
</li>
<li>
<p>The new host requests a DHCP reservation from the DHCP server.</p>
</li>
<li>
<p>The DHCP server responds to the reservation request and returns TFTP <code>next-server</code> and <code>filename</code> options.</p>
</li>
<li>
<p>The host requests the boot loader and menu from the TFTP server according to the PXELoader setting.</p>
</li>
<li>
<p>A boot loader is returned over TFTP.</p>
</li>
<li>
<p>The boot loader fetches the configuration settings for the host through its provisioning interface MAC address.</p>
</li>
<li>
<p>For BIOS hosts:</p>
<div class="ulist">
<ul>
<li>
<p>The boot loader returns non-bootable device so BIOS skips to the next device (boot from HDD).</p>
</li>
</ul>
</div>
</li>
<li>
<p>For EFI hosts:</p>
<div class="ulist">
<ul>
<li>
<p>The boot loader finds Grub2 on a ESP partition and chainboots it.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the host is unknown to Foreman, a default boot loader configuration is provided.
When Discovery service is enabled, it boots into discovery, otherwise it boots from HDD.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This workflow differs depending on custom options.
For example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Discovery</dt>
<dd>
<p>If you use the discovery service, Foreman automatically detects the MAC address of the new host and restarts the host after you submit a request.
Note that TCP port 8443 must be reachable by the Smart&#160;Proxy to which the host is attached for Foreman to restart the host.</p>
</dd>
<dt class="hdlist1">PXE-less Provisioning</dt>
<dd>
<p>After you submit a new host request, you must boot the specific host with the boot disk that you download from Foreman and transfer by using an external storage device.</p>
</dd>
<dt class="hdlist1">Compute Resources</dt>
<dd>
<p>Foreman creates the virtual machine and retrieves the MAC address and stores the MAC address in Foreman.
If you use image-based provisioning, the host does not follow the standard PXE boot and operating system installation.
The compute resource creates a copy of the image for the host to use.
Depending on image settings in Foreman, seed data can be passed in for initial configuration, for example by using <code>cloud-init</code>.
Foreman can connect to the host by using SSH and execute a template to finish the customization.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites-for-network-boot-provisioning"><a class="anchor" href="#prerequisites-for-network-boot-provisioning"></a>8.2. Prerequisites for network-boot provisioning</h3>
<div class="paragraph">
<p>The requirements for network-boot provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provisioning infrastructure services (DNS, DHCP, TFTP) are integrated with Foreman and configured.</p>
</li>
<li>
<p>Provisioning templates are associated with a client operating system.</p>
<div class="paragraph">
<p>For BIOS provisioning, you must associate a PXELinux template with the operating system.
For UEFI provisioning, you must associate a PXEGrub2 template with the operating system.
If you associate both PXELinux and PXEGrub2 templates, Foreman deploys configuration files for both on a TFTP server, so that you can switch between PXE loaders easily.</p>
</div>
</li>
<li>
<p>A bare-metal machine or a blank virtual machine.
The provisioned machine must appear on the same network as your provisioning infrastructure services.</p>
<div class="paragraph">
<p>You can integrate a compute resource with Foreman and let the compute resource create virtual machines through this integration.
You can also provision virtual machines from unintegrated infrastructure as you would bare-metal machines.</p>
</div>
</li>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/nightly/Integrating_Provisioning_Infrastructure_Services/index-foreman-deb.html#">Integrating provisioning infrastructure services</a></p>
</li>
<li>
<p><a href="#preparing-networking">Preparing networking</a></p>
</li>
<li>
<p><a href="#associating-templates-with-operating-systems">Associating templates with operating systems</a></p>
</li>
<li>
<p><a href="#discovering-hosts-on-a-network">Discovering hosts on a network</a></p>
</li>
<li>
<p><a href="#configuring-the-security-token-validity-duration">Configuring the security token validity duration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="required-boot-order-for-network-boot_using-network-boot"><a class="anchor" href="#required-boot-order-for-network-boot_using-network-boot"></a>8.3. Required boot order for network boot</h3>
<div class="paragraph">
<p>This requirement applies to physical and virtual machines that you want to provision in Foreman.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Machines with BIOS interface</dt>
<dd>
<p>The first booting device: network</p>
<div class="paragraph">
<p>The second booting device: hard drive</p>
</div>
<div class="paragraph">
<p>When Foreman manages TFTP boot configuration files, hosts can be provisioned by rebooting.</p>
</div>
</dd>
<dt class="hdlist1">Machines with UEFI interface</dt>
<dd>
<p>The first booting device: network</p>
<div class="paragraph">
<p>Depending on the UEFI firmware type and configuration, the operating system installer configures the operating system boot loader as the first entry.</p>
</div>
<div class="paragraph">
<p>You can reboot back into the installer by using the <code>efibootmgr</code> utility to switch back to booting from network.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="configuring-smart-proxy-for-secure-boot"><a class="anchor" href="#configuring-smart-proxy-for-secure-boot"></a>8.4. Configuring Smart&#160;Proxy for Secure Boot</h3>
<div class="paragraph">
<p>If you want to provision Secure Boot enabled hosts, configure your Smart&#160;Proxy for the client operating system.</p>
</div>
<div class="sect3">
<h4 id="configuring-smart-proxy-to-provision-almalinux-on-Secure-Boot-enabled-hosts"><a class="anchor" href="#configuring-smart-proxy-to-provision-almalinux-on-Secure-Boot-enabled-hosts"></a>8.4.1. Configuring Smart&#160;Proxy to provision AlmaLinux on Secure Boot enabled hosts</h4>
<div class="paragraph">
<p>Secure Boot follows a chain of trust from the start of the host to the loading of Linux kernel modules.
The first shim that is loaded determines which distribution can be booted or loaded by using a <code>kexec</code> system call until the next reboot.</p>
</div>
<div class="paragraph">
<p>To provision AlmaLinux on Secure Boot enabled hosts, you have to provide signed shim and GRUB2 binaries provided by the vendor of your operating system.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>You have to perform the following configuration steps on each TFTP Smart&#160;Proxy for a subnet to provision Secure Boot enabled hosts on that subnet.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example works for AlmaLinux on x86_64 architecture.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <code>cpio</code> package is installed on your Smart&#160;Proxy.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the path for the shim and GRUB2 binaries for the operating system of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># BOOTLOADER_PATH="/var/lib/tftpboot/bootloader-universe/pxegrub2/almalinux/default/x86_64"</pre>
</div>
</div>
<div class="paragraph">
<p>If you require specific versions of the shim and GRUB2 binaries for the version of the operating system of your host, replace <code>default</code> with the <strong>Major</strong> and <strong>Minor</strong> version of the operating system separated by a dot.
If no <strong>Minor</strong> version is set, replace <code>default</code> with the <strong>Major</strong> version.</p>
</div>
<div class="paragraph">
<p>Foreman community recommends to not use version-specific shim and GRUB2 binaries unless it is really necessary.</p>
</div>
</li>
<li>
<p>Create the directory to store the shim and GRUB2 binaries for the operating system of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># install -o foreman-proxy -g foreman-proxy -d $BOOTLOADER_PATH</pre>
</div>
</div>
</li>
<li>
<p>Download the shim and GRUB2 packages for the operating system of your host.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># wget -O /tmp/grub2-efi-x64.rpm <em>https://server.example.com/grub2-efi-x64.rpm</em>
# wget -O /tmp/shim-x64.rpm <em>https://server.example.com/shim-x64.rpm</em></pre>
</div>
</div>
<div class="paragraph">
<p>You can download the <code>grub2-efi-x64</code> package from <a href="https://repo.almalinux.org/almalinux/9/BaseOS/x86_64/os/Packages/" class="bare">https://repo.almalinux.org/almalinux/9/BaseOS/x86_64/os/Packages/</a>.
You can download the <code>shim-x64</code> package from <a href="https://repo.almalinux.org/almalinux/9/BaseOS/x86_64/os/Packages/" class="bare">https://repo.almalinux.org/almalinux/9/BaseOS/x86_64/os/Packages/</a>.</p>
</div>
</li>
<li>
<p>Extract the shim and GRUB2 binaries:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rpm2cpio /tmp/grub2-efi-x64.rpm | cpio -idv --directory /tmp
# rpm2cpio /tmp/shim-x64.rpm | cpio -idv --directory /tmp</pre>
</div>
</div>
</li>
<li>
<p>Make the shim and GRUB2 binaries available for host provisioning:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/boot/efi/EFI/almalinux/grubx64.efi $BOOTLOADER_PATH/grubx64.efi
# cp /tmp/boot/efi/EFI/almalinux/shimx64.efi $BOOTLOADER_PATH/shimx64.efi
# ln -sr $BOOTLOADER_PATH/grubx64.efi $BOOTLOADER_PATH/boot.efi
# ln -sr $BOOTLOADER_PATH/shimx64.efi $BOOTLOADER_PATH/boot-sb.efi
# chmod 644 $BOOTLOADER_PATH/grubx64.efi $BOOTLOADER_PATH/shimx64.efi</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify the contents of your boot loader directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none"># tree /var/lib/tftpboot/bootloader-universe
/var/lib/tftpboot/bootloader-universe
└── pxegrub2
    └── almalinux
        └── default
            └── x86_64
                ├── boot.efi -&gt; grubx64.efi
                ├── boot-sb.efi -&gt; shimx64.efi
                ├── grubx64.efi
                └── shimx64.efi</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>You can now provision Secure Boot enabled AlmaLinux hosts by using the <strong>Grub2 UEFI SecureBoot</strong> and <strong>Grub2 UEFI HTTPS SecureBoot</strong> PXE loaders.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-smart-proxy-to-provision-debian-on-Secure-Boot-enabled-hosts"><a class="anchor" href="#configuring-smart-proxy-to-provision-debian-on-Secure-Boot-enabled-hosts"></a>8.4.2. Configuring Smart&#160;Proxy to provision Debian on Secure Boot enabled hosts</h4>
<div class="paragraph">
<p>Secure Boot follows a chain of trust from the start of the host to the loading of Linux kernel modules.
The first shim that is loaded determines which distribution can be booted or loaded by using a <code>kexec</code> system call until the next reboot.</p>
</div>
<div class="paragraph">
<p>To provision Debian on Secure Boot enabled hosts, you have to provide signed shim and GRUB2 binaries provided by the vendor of your operating system.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>You have to perform the following configuration steps on each TFTP Smart&#160;Proxy for a subnet to provision Secure Boot enabled hosts on that subnet.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example works for Debian on x86_64 architecture.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <code>binutils</code> and <code>xz-utils</code> packages are installed on your Smart&#160;Proxy.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the path for the shim and GRUB2 binaries for the operating system of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># BOOTLOADER_PATH="/var/lib/tftpboot/bootloader-universe/pxegrub2/debian/default/x86_64"</pre>
</div>
</div>
<div class="paragraph">
<p>If you require specific versions of the shim and GRUB2 binaries for the version of the operating system of your host, replace <code>default</code> with the <strong>Major</strong> and <strong>Minor</strong> version of the operating system separated by a dot.
If no <strong>Minor</strong> version is set, replace <code>default</code> with the <strong>Major</strong> version.</p>
</div>
<div class="paragraph">
<p>Foreman community recommends to not use version-specific shim and GRUB2 binaries unless it is really necessary.</p>
</div>
</li>
<li>
<p>Create the directory to store the shim and GRUB2 binaries for the operating system of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># install -o foreman-proxy -g foreman-proxy -d $BOOTLOADER_PATH</pre>
</div>
</div>
</li>
<li>
<p>Download the shim and GRUB2 packages for the operating system of your host.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># wget -O /tmp/grub-efi-amd64-signed.deb <em>https://server.example.com/grub-efi-amd64-signed.deb</em>
# wget -O /tmp/shim-signed.deb <em>https://server.example.com/shim-signed.deb</em></pre>
</div>
</div>
<div class="paragraph">
<p>You can download the <code>grub-efi-amd64-signed</code> package from <a href="http://security.debian.org/debian-security/pool/updates/main/g/grub-efi-amd64-signed/" class="bare">http://security.debian.org/debian-security/pool/updates/main/g/grub-efi-amd64-signed/</a>.
You can download the <code>shim-signed</code> package from <a href="http://ftp.de.debian.org/debian/pool/main/s/shim-signed/" class="bare">http://ftp.de.debian.org/debian/pool/main/s/shim-signed/</a>.</p>
</div>
</li>
<li>
<p>Extract the shim and GRUB2 binaries:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cd /tmp &amp;&amp; ar x /tmp/grub-efi-amd64-signed.deb &amp;&amp; tar -xf data.tar.xz &amp;&amp; cd -
# cd /tmp &amp;&amp; ar x /tmp/shim-signed.deb &amp;&amp; tar -xf data.tar.xz &amp;&amp; cd -</pre>
</div>
</div>
</li>
<li>
<p>Make the shim and GRUB2 binaries available for host provisioning:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed $BOOTLOADER_PATH/grubx64.efi
# cp /tmp/usr/lib/shim/shimx64.efi.signed $BOOTLOADER_PATH/shimx64.efi
# ln -sr $BOOTLOADER_PATH/grubx64.efi $BOOTLOADER_PATH/boot.efi
# ln -sr $BOOTLOADER_PATH/shimx64.efi $BOOTLOADER_PATH/boot-sb.efi
# chmod 644 $BOOTLOADER_PATH/grubx64.efi $BOOTLOADER_PATH/shimx64.efi</pre>
</div>
</div>
</li>
<li>
<p>Link the <code>grub.cfg</code> file from the TFTP servers <code>grub2</code> folder to the legacy <code>grub</code> folder:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ln --relative --symbolic /var/lib/tftpboot/grub2/grub.cfg /var/lib/tftpboot/grub/grub.cfg</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify the contents of your boot loader directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none"># tree /var/lib/tftpboot/bootloader-universe
/var/lib/tftpboot/bootloader-universe
└── pxegrub2
    └── debian
        └── default
            └── x86_64
                ├── boot.efi -&gt; grubx64.efi
                ├── boot-sb.efi -&gt; shimx64.efi
                ├── grubx64.efi
                └── shimx64.efi</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>You can now provision Secure Boot enabled Debian hosts by using the <strong>Grub2 UEFI SecureBoot</strong> and <strong>Grub2 UEFI HTTPS SecureBoot</strong> PXE loaders.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-smart-proxy-to-provision-rocky-on-Secure-Boot-enabled-hosts"><a class="anchor" href="#configuring-smart-proxy-to-provision-rocky-on-Secure-Boot-enabled-hosts"></a>8.4.3. Configuring Smart&#160;Proxy to provision Rocky Linux on Secure Boot enabled hosts</h4>
<div class="paragraph">
<p>Secure Boot follows a chain of trust from the start of the host to the loading of Linux kernel modules.
The first shim that is loaded determines which distribution can be booted or loaded by using a <code>kexec</code> system call until the next reboot.</p>
</div>
<div class="paragraph">
<p>To provision Rocky Linux on Secure Boot enabled hosts, you have to provide signed shim and GRUB2 binaries provided by the vendor of your operating system.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>You have to perform the following configuration steps on each TFTP Smart&#160;Proxy for a subnet to provision Secure Boot enabled hosts on that subnet.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example works for Rocky Linux on x86_64 architecture.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <code>cpio</code> package is installed on your Smart&#160;Proxy.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the path for the shim and GRUB2 binaries for the operating system of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># BOOTLOADER_PATH="/var/lib/tftpboot/bootloader-universe/pxegrub2/rocky_linux/default/x86_64"</pre>
</div>
</div>
<div class="paragraph">
<p>If you require specific versions of the shim and GRUB2 binaries for the version of the operating system of your host, replace <code>default</code> with the <strong>Major</strong> and <strong>Minor</strong> version of the operating system separated by a dot.
If no <strong>Minor</strong> version is set, replace <code>default</code> with the <strong>Major</strong> version.</p>
</div>
<div class="paragraph">
<p>Foreman community recommends to not use version-specific shim and GRUB2 binaries unless it is really necessary.</p>
</div>
</li>
<li>
<p>Create the directory to store the shim and GRUB2 binaries for the operating system of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># install -o foreman-proxy -g foreman-proxy -d $BOOTLOADER_PATH</pre>
</div>
</div>
</li>
<li>
<p>Download the shim and GRUB2 packages for the operating system of your host.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># wget -O /tmp/grub2-efi-x64.rpm <em>https://server.example.com/grub2-efi-x64.rpm</em>
# wget -O /tmp/shim-x64.rpm <em>https://server.example.com/shim-x64.rpm</em></pre>
</div>
</div>
<div class="paragraph">
<p>You can download the <code>grub2-efi-x64</code> package from <a href="http://dl.rockylinux.org/pub/rocky/9/BaseOS/x86_64/os/Packages/g/" class="bare">http://dl.rockylinux.org/pub/rocky/9/BaseOS/x86_64/os/Packages/g/</a>.
You can download the <code>shim-x64</code> package from <a href="http://dl.rockylinux.org/pub/rocky/9/BaseOS/x86_64/os/Packages/s/" class="bare">http://dl.rockylinux.org/pub/rocky/9/BaseOS/x86_64/os/Packages/s/</a>.</p>
</div>
</li>
<li>
<p>Extract the shim and GRUB2 binaries:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rpm2cpio /tmp/grub2-efi-x64.rpm | cpio -idv --directory /tmp
# rpm2cpio /tmp/shim-x64.rpm | cpio -idv --directory /tmp</pre>
</div>
</div>
</li>
<li>
<p>Make the shim and GRUB2 binaries available for host provisioning:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/boot/efi/EFI/rocky/grubx64.efi $BOOTLOADER_PATH/grubx64.efi
# cp /tmp/boot/efi/EFI/rocky/shimx64.efi $BOOTLOADER_PATH/shimx64.efi
# ln -sr $BOOTLOADER_PATH/grubx64.efi $BOOTLOADER_PATH/boot.efi
# ln -sr $BOOTLOADER_PATH/shimx64.efi $BOOTLOADER_PATH/boot-sb.efi
# chmod 644 $BOOTLOADER_PATH/grubx64.efi $BOOTLOADER_PATH/shimx64.efi</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify the contents of your boot loader directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none"># tree /var/lib/tftpboot/bootloader-universe
/var/lib/tftpboot/bootloader-universe
└── pxegrub2
    └── rocky_linux
        └── default
            └── x86_64
                ├── boot.efi -&gt; grubx64.efi
                ├── boot-sb.efi -&gt; shimx64.efi
                ├── grubx64.efi
                └── shimx64.efi</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>You can now provision Secure Boot enabled Rocky Linux hosts by using the <strong>Grub2 UEFI SecureBoot</strong> and <strong>Grub2 UEFI HTTPS SecureBoot</strong> PXE loaders.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-smart-proxy-to-provision-rhel-on-Secure-Boot-enabled-hosts"><a class="anchor" href="#configuring-smart-proxy-to-provision-rhel-on-Secure-Boot-enabled-hosts"></a>8.4.4. Configuring Smart&#160;Proxy to provision Red&#160;Hat Enterprise Linux on Secure Boot enabled hosts</h4>
<div class="paragraph">
<p>Secure Boot follows a chain of trust from the start of the host to the loading of Linux kernel modules.
The first shim that is loaded determines which distribution can be booted or loaded by using a <code>kexec</code> system call until the next reboot.</p>
</div>
<div class="paragraph">
<p>To provision Red&#160;Hat Enterprise Linux on Secure Boot enabled hosts, you have to provide signed shim and GRUB2 binaries provided by the vendor of your operating system.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>You have to perform the following configuration steps on each TFTP Smart&#160;Proxy for a subnet to provision Secure Boot enabled hosts on that subnet.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Red&#160;Hat Enterprise Linux supports Secure Boot on x86_64 architecture only.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <code>cpio</code> package is installed on your Smart&#160;Proxy.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the path for the shim and GRUB2 binaries for the operating system of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># BOOTLOADER_PATH="/var/lib/tftpboot/bootloader-universe/pxegrub2/redhat/default/x86_64"</pre>
</div>
</div>
<div class="paragraph">
<p>If you require specific versions of the shim and GRUB2 binaries for the version of the operating system of your host, replace <code>default</code> with the <strong>Major</strong> and <strong>Minor</strong> version of the operating system separated by a dot.
If no <strong>Minor</strong> version is set, replace <code>default</code> with the <strong>Major</strong> version.</p>
</div>
<div class="paragraph">
<p>Foreman community recommends to not use version-specific shim and GRUB2 binaries unless it is really necessary.</p>
</div>
</li>
<li>
<p>Create the directory to store the shim and GRUB2 binaries for the operating system of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># install -o foreman-proxy -g foreman-proxy -d $BOOTLOADER_PATH</pre>
</div>
</div>
</li>
<li>
<p>Download the shim and GRUB2 packages for the operating system of your host.
You can download the <code>grub2-efi-x64</code> and <code>shim-x64</code> packages from <a href="https://access.redhat.com/downloads/content/package-browser">Package browser</a> on the Red&#160;Hat Customer Portal.</p>
</li>
<li>
<p>Extract the shim and GRUB2 binaries:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rpm2cpio /tmp/grub2-efi-x64.rpm | cpio -idv --directory /tmp
# rpm2cpio /tmp/shim-x64.rpm | cpio -idv --directory /tmp</pre>
</div>
</div>
</li>
<li>
<p>Make the shim and GRUB2 binaries available for host provisioning:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/boot/efi/EFI/redhat/grubx64.efi $BOOTLOADER_PATH/grubx64.efi
# cp /tmp/boot/efi/EFI/redhat/shimx64.efi $BOOTLOADER_PATH/shimx64.efi
# ln -sr $BOOTLOADER_PATH/grubx64.efi $BOOTLOADER_PATH/boot.efi
# ln -sr $BOOTLOADER_PATH/shimx64.efi $BOOTLOADER_PATH/boot-sb.efi
# chmod 644 $BOOTLOADER_PATH/grubx64.efi $BOOTLOADER_PATH/shimx64.efi</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify the contents of your boot loader directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none"># tree /var/lib/tftpboot/bootloader-universe
/var/lib/tftpboot/bootloader-universe
└── pxegrub2
    └── redhat
        └── default
            └── x86_64
                ├── boot.efi -&gt; grubx64.efi
                ├── boot-sb.efi -&gt; shimx64.efi
                ├── grubx64.efi
                └── shimx64.efi</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>You can now provision Secure Boot enabled Red&#160;Hat Enterprise Linux hosts by using the <strong>Grub2 UEFI SecureBoot</strong> and <strong>Grub2 UEFI HTTPS SecureBoot</strong> PXE loaders.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-smart-proxy-to-provision-ubuntu-on-Secure-Boot-enabled-hosts"><a class="anchor" href="#configuring-smart-proxy-to-provision-ubuntu-on-Secure-Boot-enabled-hosts"></a>8.4.5. Configuring Smart&#160;Proxy to provision Ubuntu on Secure Boot enabled hosts</h4>
<div class="paragraph">
<p>Secure Boot follows a chain of trust from the start of the host to the loading of Linux kernel modules.
The first shim that is loaded determines which distribution can be booted or loaded by using a <code>kexec</code> system call until the next reboot.</p>
</div>
<div class="paragraph">
<p>To provision Ubuntu on Secure Boot enabled hosts, you have to provide signed shim and GRUB2 binaries provided by the vendor of your operating system.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>You have to perform the following configuration steps on each TFTP Smart&#160;Proxy for a subnet to provision Secure Boot enabled hosts on that subnet.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example works for Ubuntu on x86_64 architecture.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <code>binutils</code>, <code>xz-utils</code>, and <code>zstd</code> packages are installed on your Smart&#160;Proxy.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the path for the shim and GRUB2 binaries for the operating system of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># BOOTLOADER_PATH="/var/lib/tftpboot/bootloader-universe/pxegrub2/ubuntu/default/x86_64"</pre>
</div>
</div>
<div class="paragraph">
<p>If you require specific versions of the shim and GRUB2 binaries for the version of the operating system of your host, replace <code>default</code> with the <strong>Major</strong> and <strong>Minor</strong> version of the operating system separated by a dot.
If no <strong>Minor</strong> version is set, replace <code>default</code> with the <strong>Major</strong> version.</p>
</div>
<div class="paragraph">
<p>Foreman community recommends to not use version-specific shim and GRUB2 binaries unless it is really necessary.</p>
</div>
</li>
<li>
<p>Create the directory to store the shim and GRUB2 binaries for the operating system of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># install -o foreman-proxy -g foreman-proxy -d $BOOTLOADER_PATH</pre>
</div>
</div>
</li>
<li>
<p>Download the shim and GRUB2 packages for the operating system of your host.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># wget -O /tmp/grub-efi-amd64-signed.deb <em>https://server.example.com/grub-efi-amd64-signed.deb</em>
# wget -O /tmp/shim-signed.deb <em>https://server.example.com/shim-signed.deb</em></pre>
</div>
</div>
<div class="paragraph">
<p>You can download the <code>grub-efi-amd64-signed</code> package from <a href="http://security.ubuntu.com/ubuntu/pool/main/g/grub2-signed/" class="bare">http://security.ubuntu.com/ubuntu/pool/main/g/grub2-signed/</a>.
You can download the <code>shim-signed</code> package from <a href="http://de.archive.ubuntu.com/ubuntu/pool/main/s/shim-signed/" class="bare">http://de.archive.ubuntu.com/ubuntu/pool/main/s/shim-signed/</a>.</p>
</div>
</li>
<li>
<p>Extract the shim and GRUB2 binaries:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cd /tmp &amp;&amp; ar x /tmp/grub-efi-amd64-signed.deb &amp;&amp; tar --use-compress-program=unzstd -xf data.tar.zst &amp;&amp; cd -
# cd /tmp &amp;&amp; ar x /tmp/shim-signed.deb &amp;&amp; tar -xf data.tar.xz &amp;&amp; cd -</pre>
</div>
</div>
</li>
<li>
<p>Make the shim and GRUB2 binaries available for host provisioning:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed $BOOTLOADER_PATH/grubx64.efi
# cp /tmp/usr/lib/shim/shimx64.efi.signed.latest $BOOTLOADER_PATH/shimx64.efi
# ln -sr $BOOTLOADER_PATH/grubx64.efi $BOOTLOADER_PATH/boot.efi
# ln -sr $BOOTLOADER_PATH/shimx64.efi $BOOTLOADER_PATH/boot-sb.efi
# chmod 644 $BOOTLOADER_PATH/grubx64.efi $BOOTLOADER_PATH/shimx64.efi</pre>
</div>
</div>
</li>
<li>
<p>Link the <code>grub.cfg</code> file from the TFTP servers <code>grub2</code> folder to the legacy <code>grub</code> folder:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ln --relative --symbolic /var/lib/tftpboot/grub2/grub.cfg /var/lib/tftpboot/grub/grub.cfg</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify the contents of your boot loader directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-none" data-lang="none"># tree /var/lib/tftpboot/bootloader-universe
/var/lib/tftpboot/bootloader-universe
└── pxegrub2
    └── ubuntu
        └── default
            └── x86_64
                ├── boot.efi -&gt; grubx64.efi
                ├── boot-sb.efi -&gt; shimx64.efi
                ├── grubx64.efi
                └── shimx64.efi</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>You can now provision Secure Boot enabled Ubuntu hosts by using the <strong>Grub2 UEFI SecureBoot</strong> and <strong>Grub2 UEFI HTTPS SecureBoot</strong> PXE loaders.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-hosts-with-pxe-boot-provisioning"><a class="anchor" href="#creating-hosts-with-pxe-boot-provisioning"></a>8.5. Creating hosts with PXE boot provisioning</h3>
<div class="paragraph">
<p>PXE boot provisioning is a method of unattended host provisioning that requires minimal interaction during the process.</p>
</div>
<div class="paragraph">
<p>You enter the host details on Foreman&#160;server and boot your host.
Foreman&#160;server automatically manages the PXE configuration, organizes networking services, and provides the operating system and configuration for the host.</p>
</div>
<div class="paragraph">
<p>Create a host entry to add the host details.
When you save the host entry, Foreman creates the relevant provisioning settings.
This also includes creating the necessary directories and files for PXE booting.
When you boot the host, the host requests a DHCP lease.
The DHCP service responds with a lease which includes the location of the installation content.
The host uses the installation content to install the operating system.</p>
</div>
<div class="paragraph">
<p>During the installation, the host registers to Foreman&#160;server and performs initial configuration.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-hosts-with-pxe-boot-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>In the <strong>MAC address</strong> field, enter a MAC address of the provisioning interface of the host.
This ensures the identification of the host during the PXE boot process.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and verify that all fields contain values.
Confirm each aspect of the operating system.</p>
</li>
<li>
<p>Optional: Click <strong>Resolve</strong> in <strong>Provisioning template</strong> to check the new host can identify the right provisioning templates to use.</p>
<div class="paragraph">
<p>For more information about provisioning templates, see <a href="#provisioning-templates">Provisioning templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.</p>
</li>
</ol>
</div>
<div id="cli-creating-hosts-with-pxe-boot-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create the host by using Hammer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--build true \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--location "<em>My_Location</em>" \
--mac "<em>My_MAC_Address</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
<li>
<p>Configure the network interface:</p>
<div class="listingblock">
<div class="content">
<pre>$ hammer host interface update \
--host "_My_Host_Name_" \
--managed true \
--primary true \
--provision true</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-smart-proxy-for-uefi-http-booting"><a class="anchor" href="#configuring-smart-proxy-for-uefi-http-booting"></a>8.6. Configuring Smart&#160;Proxy for UEFI HTTP booting</h3>
<div class="paragraph">
<p>You can provision hosts from Foreman by using the UEFI HTTP Boot if the hosts have this capability.
Configure your Smart&#160;Proxy for UEFI HTTP booting.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your environment meets the requirements for HTTP booting.
For more information, see <a href="https://docs.theforeman.org/nightly/Planning_for_Project/index-foreman-deb.html#http-booting">HTTP booting</a> in <em>Planning for Foreman</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Smart&#160;Proxy, enable the <code>foreman-proxy-http</code>, <code>foreman-proxy-httpboot</code>, and <code>foreman-proxy-tftp</code> features:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-http true \
--foreman-proxy-httpboot true \
--foreman-proxy-tftp true</pre>
</div>
</div>
</li>
<li>
<p>Ensure that Smart&#160;Proxy is associated with the provisioning subnet.
In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>.</p>
</li>
<li>
<p>Click <strong>Edit Subnet</strong> &gt; <strong>Smart&#160;Proxies</strong>.</p>
</li>
<li>
<p>Select the Smart&#160;Proxy for both <strong>TFTP</strong> and <strong>HTTPBoot</strong> options.</p>
</li>
<li>
<p>Click <strong>OK</strong> to save.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Ensure that the Smart&#160;Proxy has TFTP and HTTPBoot features recognized.
In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Smart&#160;Proxies</strong> and click on Smart&#160;Proxy to see the list of recognized features.
Click <strong>Refresh Features</strong> if any of the features are missing.</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Next steps</div>
<ul>
<li>
<p><a href="#creating-hosts-with-uefi-http-boot-provisioning">Creating hosts with UEFI HTTP boot provisioning</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-hosts-with-uefi-http-boot-provisioning"><a class="anchor" href="#creating-hosts-with-uefi-http-boot-provisioning"></a>8.7. Creating hosts with UEFI HTTP boot provisioning</h3>
<div class="paragraph">
<p>You can provision hosts from Foreman by using the UEFI HTTP Boot if the hosts have this capability.
In HTTP boot, configuration files are transferred over HTTP instead of TFTP as in PXE boot.
Using this method can help reduce the booting time during host provisioning.
HTTP is also more reliable for transfer of large files, such as Live images, than TFTP.</p>
</div>
<div class="paragraph">
<p>You enter the host details on Foreman&#160;server and boot your host.
Foreman&#160;server automatically manages the HTTP boot configuration, organizes networking services, and provides the operating system and configuration for the host.</p>
</div>
<div class="paragraph">
<p>Create a host entry to add the host details.
When you save the host entry, Foreman creates the relevant provisioning settings.
This also includes creating the necessary directories and files for PXE booting.
When you boot the host, the host requests a DHCP lease.
The DHCP service responds with a lease which includes the location of the installation content.
The host uses the installation content to install the operating system.</p>
</div>
<div class="paragraph">
<p>During the installation, the host registers to Foreman&#160;server and performs initial configuration.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-hosts-with-uefi-http-boot-provisioning_using-network-boot">CLI procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your Smart&#160;Proxy has been configured for UEFI HTTP booting.
For more information, see <a href="#configuring-smart-proxy-for-uefi-http-booting">Configuring Smart&#160;Proxy for UEFI HTTP booting</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>In the <strong>MAC address</strong> field, enter a MAC address of the provisioning interface of the host.
This ensures the identification of the host during the PXE boot process.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and verify that all fields contain values.
Confirm each aspect of the operating system.</p>
</li>
<li>
<p>From the <strong>PXE Loader</strong> list, select <strong>Grub2 UEFI HTTP</strong>.</p>
</li>
<li>
<p>Optional: Click <strong>Resolve</strong> in <strong>Provisioning template</strong> to check the new host can identify the right provisioning templates to use.</p>
<div class="paragraph">
<p>For more information about provisioning templates, see <a href="#provisioning-templates">Provisioning templates</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.</p>
</li>
</ol>
</div>
<div id="cli-creating-hosts-with-uefi-http-boot-provisioning_using-network-boot" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create the host by using Hammer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--build true \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--location "<em>My_Location</em>" \
--mac "<em>My_MAC_Address</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>" \
--pxe-loader "Grub2 UEFI HTTP"</pre>
</div>
</div>
</li>
<li>
<p>Configure the network interface:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host interface update \
--host "<em>My_Host_Name</em>" \
--managed true \
--primary true \
--provision true</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Deploying_SSH_Keys_During_Provisioning_using-network-boot"><a class="anchor" href="#Deploying_SSH_Keys_During_Provisioning_using-network-boot"></a>8.8. Deploying SSH keys during provisioning</h3>
<div class="paragraph">
<p>Use this procedure to deploy SSH keys added to a user during provisioning.
For information on adding SSH keys to a user, see <a href="https://docs.theforeman.org/nightly/Administering_Project/index-foreman-deb.html#Managing_SSH_Keys_for_a_User_admin">Managing SSH Keys for a User</a> in <em>Administering Foreman</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Create a provisioning template, or clone and edit an existing template.
For more information, see <a href="#creating-provisioning-templates">Creating provisioning templates</a>.</p>
</li>
<li>
<p>In the template, click the <strong>Template</strong> tab.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, add the <code>create_users</code> snippet to the <code>%post</code> section:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%= snippet('create_users') %&gt;</pre>
</div>
</div>
</li>
<li>
<p>Select the <strong>Default</strong> checkbox.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab.</p>
</li>
<li>
<p>From the <strong>Application Operating Systems</strong> list, select an operating system.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the provisioning template.</p>
</li>
<li>
<p>Create a host that is associated with the provisioning template or rebuild a host using the operating system associated with the modified template.
For more information, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#Creating_a_Host_managing-hosts">Creating a Host</a> in <em>Managing hosts</em>.</p>
<div class="paragraph">
<p>The SSH keys of the <strong>Owned by</strong> user are added automatically when the <code>create_users</code> snippet is executed during the provisioning process.
You can set <strong>Owned by</strong> to an individual user or a user group.
If you set <strong>Owned by</strong> to a user group, the SSH keys of all users in the user group are added automatically.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="using-ipxe-to-reduce-provisioning-times_using-network-boot"><a class="anchor" href="#using-ipxe-to-reduce-provisioning-times_using-network-boot"></a>8.9. Using iPXE to reduce provisioning times</h3>
<div class="paragraph">
<p>iPXE is an open-source network-boot firmware.
It provides a full PXE implementation enhanced with additional features, such as booting from an HTTP server.
For more information about iPXE, see <a href="https://ipxe.org">iPXE website</a>.</p>
</div>
<div class="paragraph">
<p>You can use iPXE if the following restrictions prevent you from using PXE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A network with unmanaged DHCP servers.</p>
</li>
<li>
<p>A PXE service that is unreachable because of, for example, a firewall restriction.</p>
</li>
<li>
<p>A TFTP UDP-based protocol that is unreliable because of, for example, a low-bandwidth network.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="prerequisites-for-using-ipxe_using-network-boot"><a class="anchor" href="#prerequisites-for-using-ipxe_using-network-boot"></a>8.9.1. Prerequisites for using iPXE</h4>
<div class="paragraph">
<p>You can use iPXE to boot virtual machines in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your virtual machines run on a hypervisor that uses iPXE as primary firmware.</p>
</li>
<li>
<p>Your virtual machines are in BIOS mode.
In this case, you can configure PXELinux to chainboot iPXE and boot by using the HTTP protocol.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For booting virtual machines in UEFI mode by using HTTP, you can follow <a href="#creating-hosts-with-uefi-http-boot-provisioning">Creating hosts with UEFI HTTP boot provisioning</a> instead.</p>
</div>
<div class="paragraph">
<div class="title">BIOS and UEFI support</div>
<p>Only BIOS systems are known to work reliably.
For configuring iPXE with <strong>some</strong> EFI hosts, read a <a href="https://community.theforeman.org/t/discovery-ipxe-efi-workflow-in-foreman-1-20/13026">separate tutorial</a>.</p>
</div>
<div class="ulist">
<div class="title">Host requirements</div>
<ul>
<li>
<p>The MAC address of the provisioning interface matches the host configuration.</p>
</li>
<li>
<p>The provisioning interface of the host has a valid DHCP reservation.</p>
</li>
<li>
<p>The NIC is capable of PXE booting.
For more information, see <a href="https://ipxe.org/appnote/hardware_drivers">supported hardware on ipxe.org</a> for a list of hardware drivers expected to work with an iPXE-based boot disk.</p>
</li>
<li>
<p>The NIC is compatible with iPXE.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_iPXE_Environment_using-network-boot"><a class="anchor" href="#Configuring_iPXE_Environment_using-network-boot"></a>8.9.2. Configuring iPXE environment</h4>
<div class="paragraph">
<p>Configure an iPXE environment on all Smart&#160;Proxies that you want to use for iPXE provisioning.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>If you want to use Smart&#160;Proxy&#160;servers instead of your Foreman&#160;server, ensure that you have configured your Smart&#160;Proxy&#160;servers accordingly.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>It is essential to add your Smart&#160;Proxy&#160;server to the list of trusted proxies on Foreman&#160;server!</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable the <strong>TFTP</strong> and <strong>HTTPboot</strong> services on your Smart&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-httpboot true \
--foreman-proxy-tftp true</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>ipxe</code> package on your Smart&#160;Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># apt install ipxe</pre>
</div>
</div>
</li>
<li>
<p>Copy iPXE firmware to the TFTP directory.</p>
<div class="ulist">
<ul>
<li>
<p>Copy the iPXE firmware with the Linux kernel header:</p>
<div class="listingblock">
<div class="content">
<pre># cp /usr/share/ipxe/ipxe.lkrn /var/lib/tftpboot/</pre>
</div>
</div>
</li>
<li>
<p>Copy the UNDI iPXE firmware:</p>
<div class="listingblock">
<div class="content">
<pre># cp /usr/share/ipxe/undionly.kpxe /var/lib/tftpboot/undionly-ipxe.0</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Set the HTTP URL.</p>
<div class="ulist">
<ul>
<li>
<p>If you want to use Foreman&#160;server for booting, reconfigure your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-dhcp-ipxefilename "http://<em>foreman.example.com</em>/unattended/iPXE?bootstrap=1"</pre>
</div>
</div>
</li>
<li>
<p>If you want to use Smart&#160;Proxy&#160;server for booting, reconfigure your Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dhcp-ipxe-bootstrap true</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Booting_Virtual_Machines_using-network-boot"><a class="anchor" href="#Booting_Virtual_Machines_using-network-boot"></a>8.9.3. Booting virtual machines</h4>
<div class="paragraph">
<p>Some virtualization hypervisors use iPXE as primary firmware for PXE booting.
If you use such a hypervisor, you can boot virtual machines without TFTP and PXELinux.</p>
</div>
<div class="paragraph">
<p>Booting a virtual machine has the following workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Virtual machine starts.</p>
</li>
<li>
<p>iPXE retrieves the network credentials, including an HTTP URL, by using DHCP.</p>
</li>
<li>
<p>iPXE loads the iPXE bootstrap template from Smart&#160;Proxy.</p>
</li>
<li>
<p>iPXE loads the iPXE template with MAC as a URL parameter from Smart&#160;Proxy.</p>
</li>
<li>
<p>iPXE loads the kernel and initial RAM disk of the installer.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your hypervisor must support iPXE.
The following virtualization hypervisors support iPXE:</p>
<div class="ulist">
<ul>
<li>
<p>libvirt</p>
</li>
<li>
<p>VMWare (<a href="https://ipxe.org/howto/vmware">via custom firmware</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>You have configured your iPXE environment.
For more information, see <a href="#Configuring_iPXE_Environment_using-network-boot">Configuring iPXE environment</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the original templates shipped in Foreman as described below.
If you require modification to an original template, clone the template, edit the clone, and associate the clone instead of the original template.
For more information, see <a href="#running-custom-code-during-host-provisioning">Running custom code during host provisioning</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Search for the required template:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>AutoYaST default iPXE</code> template for SUSE Linux Enterprise Server hosts.</p>
</li>
<li>
<p>The <code>Kickstart default iPXE</code> template for Enterprise Linux hosts.</p>
</li>
<li>
<p>The <code>Preseed default iPXE</code> template for Debian/Ubuntu hosts.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click the name of the template.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab and select the operating systems that your host uses.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add the organization that the host belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and select the operating system of your host.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>From the <strong>iPXE template</strong> list, select the required template:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>AutoYaST default iPXE</code> template for SUSE Linux Enterprise Server hosts.</p>
</li>
<li>
<p>The <code>Kickstart default iPXE</code> template for Enterprise Linux hosts.</p>
</li>
<li>
<p>The <code>Preseed default iPXE</code> template for Debian/Ubuntu hosts.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</li>
<li>
<p>In the <strong>Hosts</strong> page, select the host that you want to use.</p>
</li>
<li>
<p>Select the <strong>Operating System</strong> tab.</p>
</li>
<li>
<p>Set <strong>PXE Loader</strong> to <code>iPXE Embedded</code>.</p>
</li>
<li>
<p>Select the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>In <strong>Provisioning Templates</strong>, click <strong>Resolve</strong> and verify that the <strong>iPXE template</strong> resolves to the required template.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save host settings.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Chainbooting_iPXE_from_PXELinux_using-network-boot"><a class="anchor" href="#Chainbooting_iPXE_from_PXELinux_using-network-boot"></a>8.9.4. Chainbooting iPXE from PXELinux</h4>
<div class="paragraph">
<p>You can set up iPXE to use a built-in driver for network communication (<code>ipxe.lkrn</code>) or Universal Network Device Interface (UNDI) (<code>undionly-ipxe.0</code>).
You can choose to load either file depending on the networking hardware capabilities and iPXE driver availability.</p>
</div>
<div class="paragraph">
<p>UNDI is a minimalistic UDP/IP stack that implements TFTP client.
However, UNDI cannot support other protocols like HTTP.
To use HTTP with iPXE, use the iPXE build with built-in drivers (<code>ipxe.lkrn</code>).</p>
</div>
<div class="paragraph">
<p>Chainbooting iPXE has the following workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Host powers on.</p>
</li>
<li>
<p>PXE driver retrieves the network credentials by using DHCP.</p>
</li>
<li>
<p>PXE driver retrieves the PXELinux firmware <code>pxelinux.0</code> by using TFTP.</p>
</li>
<li>
<p>PXELinux searches for the configuration file on the TFTP server.</p>
</li>
<li>
<p>PXELinux chainloads iPXE <code>ipxe.lkrn</code> or <code>undionly-ipxe.0</code>.</p>
</li>
<li>
<p>iPXE retrieves the network credentials, including an HTTP URL, by using DHCP again.</p>
</li>
<li>
<p>iPXE chainloads the iPXE template from your Templates Smart&#160;Proxy.</p>
</li>
<li>
<p>iPXE loads the kernel and initial RAM disk of the installer.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have configured your iPXE environment.
For more information, see <a href="#Configuring_iPXE_Environment_using-network-boot">Configuring iPXE environment</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the original templates shipped in Foreman as described below.
If you require modification to an original template, clone the template, edit the clone, and associate the clone instead of the original template.
For more information, see <a href="#running-custom-code-during-host-provisioning">Running custom code during host provisioning</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Search for the required PXELinux template:</p>
<div class="ulist">
<ul>
<li>
<p><code>PXELinux chain iPXE</code> to use <code>ipxe.lkrn</code></p>
</li>
<li>
<p><code>PXELinux chain iPXE UNDI</code> to use <code>undionly-ipxe.0</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click the name of the template you want to use.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab and select the operating systems that your host uses.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add the organization that the host belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>On the <strong>Provisioning Templates</strong> page, search for the required template:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>AutoYaST default iPXE</code> template for SUSE Linux Enterprise Server hosts.</p>
</li>
<li>
<p>The <code>Kickstart default iPXE</code> template for Enterprise Linux hosts.</p>
</li>
<li>
<p>The <code>Preseed default iPXE</code> template for Debian/Ubuntu hosts.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click the name of the template.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab and associate the template with the operating system that your host uses.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and add the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and add the organization that the host belongs to.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and select the operating system of your host.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>From the <strong>PXELinux template</strong> list, select the template you want to use.</p>
</li>
<li>
<p>From the <strong>iPXE template</strong> list, select the required template:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>AutoYaST default iPXE</code> template for SUSE Linux Enterprise Server hosts.</p>
</li>
<li>
<p>The <code>Kickstart default iPXE</code> template for Enterprise Linux hosts.</p>
</li>
<li>
<p>The <code>Preseed default iPXE</code> template for Debian/Ubuntu hosts.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Host Groups</strong>, and select the host group you want to configure.</p>
</li>
<li>
<p>Select the <strong>Operating System</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Architecture</strong> and <strong>Operating system</strong>.</p>
</li>
<li>
<p>Set the <strong>PXE Loader</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Select <code>PXELinux BIOS</code> to chainboot iPXE (<code>ipxe.lkrn</code>) from PXELinux.</p>
</li>
<li>
<p>Select <code>iPXE Chain BIOS</code> to load <code>undionly-ipxe.0</code> directly.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pxe-loaders"><a class="anchor" href="#pxe-loaders"></a>8.10. PXE loaders</h3>
<div class="paragraph">
<p>In Foreman, a PXE loader defines the <code>filename</code> DHCPv4 option to use during provisioning.
Foreman deploys the required files to TFTP Smart&#160;Proxy.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. PXE loaders and DHCPv4 filenames</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PXE loader option</th>
<th class="tableblock halign-left valign-top"><code>filename</code> value</th>
<th class="tableblock halign-left valign-top">Use for</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No filename passed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-PXE booting, for example HTTP booting with iPXE or image-based provisioning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PXELinux BIOS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pxelinux.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIOS machines with PXE booting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PXELinux UEFI</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pxelinux.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UEFI machines with PXE booting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Grub2 BIOS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grub2/grub<em>arch</em>.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIOS machines with PXE booting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Grub2 UEFI</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>subdir</em>/grub2/grub<em>arch</em>.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UEFI machines with PXE boot using GRUB2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Grub2 UEFI SecureBoot</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>subdir</em>/grub2/shim<em>arch</em>.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SecureBoot-enabled UEFI machines with PXE booting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Grub2 UEFI HTTP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http://<em>smartproxy.example.com</em>:8000/httpboot/<em>subdir</em>/grub2/grub<em>arch</em>.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UEFI machines with HTTP booting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Grub2 UEFI HTTPS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https://<em>smartproxy.example.com</em>:8443/httpboot/<em>subdir</em>/grub2/grub<em>arch</em>.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UEFI machines with HTTP booting over HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Grub2 UEFI HTTPS SecureBoot</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https://<em>smartproxy.example.com</em>:8443/httpboot/<em>subdir</em>/grub2/shim<em>arch</em>.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SecureBoot-enabled UEFI machines with HTTP booting over HTTPS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>iPXE Embedded</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreman iPXE URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machines with iPXE embedded in their NIC firmware</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>iPXE UEFI HTTP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http://<em>smartproxy.example.com</em>:8000/httpboot/ipxe-<em>arch</em>.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UEFI machines with HTTP boot using iPXE implementation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>iPXE Chain BIOS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>undionly-ipxe.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIOS machines with PXE boot chainloading iPXE executable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>iPXE Chain UEFI</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ipxe.efi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UEFI machines with PXE boot chainloading iPXE executable</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Other PXE loaders, such as <strong>PXELinux UEFI</strong> or <strong>Grub2 ELF</strong>, require additional configuration.
These workflows are not documented.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-boot-disks-to-provision-hosts"><a class="anchor" href="#using-boot-disks-to-provision-hosts"></a>9. Using boot disks to provision hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some hardware does not provide a PXE boot interface or your environment may not support network boot.
In Foreman, you can provision a host without PXE boot.
This is also known as PXE-less provisioning and involves generating a boot ISO that hosts can use.
Using this ISO, the host can boot the installation media, connect to Smart&#160;Proxy, and install the operating system.</p>
</div>
<div class="paragraph">
<p>Foreman also provides a PXE-less discovery service that operates without PXE-based services, such as DHCP and TFTP.
For more information, see <a href="#discovery-in-pxeless-mode">Discovery in PXE-less mode</a>.</p>
</div>
<div class="sect2">
<h3 id="boot-disk-workflow"><a class="anchor" href="#boot-disk-workflow"></a>9.1. Boot disk workflow</h3>
<div class="paragraph">
<p>Using a boot disk to provision a host involves the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a host entry in Foreman.</p>
</li>
<li>
<p>Generate a boot disk ISO image.</p>
</li>
<li>
<p>Boot your host from the ISO image.</p>
</li>
<li>
<p>The host connects to Templates Smart&#160;Proxy and starts installing the operating system.</p>
</li>
<li>
<p>When the installation completes, the host registers to Foreman&#160;server.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="boot-disk-types"><a class="anchor" href="#boot-disk-types"></a>9.2. Boot disk types</h3>
<div class="paragraph">
<p>You can generate the following types of boot disks:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Full host image</dt>
<dd>
<p>A boot ISO that contains the installer kernel and initial RAM disk image for a specific host.
The boot loader on this image chain loads the installer directly from the image.
This image is useful if the host fails to chain load from Foreman&#160;server or Smart&#160;Proxy&#160;server correctly.
The provisioning template still downloads from Foreman&#160;server.</p>
<div class="paragraph">
<p>This image is based on SYSLINUX and GRUB and works with most network cards.</p>
</div>
<div class="paragraph">
<p>This image contains a provisioning security token, therefore the generated image has a limited lifespan.
For more information about configuring the security token, see <a href="#configuring-the-security-token-validity-duration">Configuring the security token validity duration</a>.</p>
</div>
</dd>
<dt class="hdlist1">Subnet image</dt>
<dd>
<p>A boot ISO that is not associated with a specific host.
You can use this image if you have an environment with multiple subnets, where hosts do not have access to Foreman&#160;server but can access Smart&#160;Proxy in the particular subnet.
You can use this image to boot multiple hosts on the same subnet.
The boot loader on this image chain loads the installer from the TFTP Smart&#160;Proxy of the host.</p>
<div class="paragraph">
<p>The ISO sends the MAC address of the host to Smart&#160;Proxy, which matches the MAC address against the host entry.
The image does not store IP address details and requires access to a DHCP server on the network to bootstrap.
This image is generic to all hosts with a provisioning NIC on the same subnet.</p>
</div>
<div class="paragraph">
<p>This image is based on iPXE boot firmware.
Only a limited number of network cards is supported.
For more information, see <a href="https://ipxe.org/appnote/hardware_drivers">supported hardware drivers at ipxe.org</a>.</p>
</div>
</dd>
<dt class="hdlist1">Generic image</dt>
<dd>
<p>A boot ISO that is not associated with a specific host.
The boot loader on this image chain loads the installer from Foreman&#160;server.</p>
<div class="paragraph">
<p>The ISO sends the MAC address of the host to Smart&#160;Proxy, which matches the MAC address against the host entry.
The image does not store IP address details and requires access to a DHCP server on the network to bootstrap.</p>
</div>
<div class="paragraph">
<p>This image is based on iPXE boot firmware.
Only a limited number of network cards is supported.
For more information, see <a href="https://ipxe.org/appnote/hardware_drivers">supported hardware drivers at ipxe.org</a>.</p>
</div>
<div class="paragraph">
<p>This image does not support UEFI systems.</p>
</div>
</dd>
<dt class="hdlist1">Host image</dt>
<dd>
<p>A boot ISO for a specific host.
This image contains only the boot files that are necessary to access the installation media on Foreman&#160;server.
You define the subnet data in Foreman and the image is created with static networking.</p>
<div class="paragraph">
<p>This image is based on iPXE boot firmware.
Only a limited number of network cards is supported.
For more information, see <a href="https://ipxe.org/appnote/hardware_drivers">supported hardware drivers at ipxe.org</a>.</p>
</div>
<div class="paragraph">
<p>This image contains a provisioning security token, therefore the generated image has a limited lifespan.
For more information about configuring the security token, see <a href="#configuring-the-security-token-validity-duration">Configuring the security token validity duration</a>.</p>
</div>
<div class="paragraph">
<p>This image does not support UEFI systems.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="enabling-bootdisk-plugin"><a class="anchor" href="#enabling-bootdisk-plugin"></a>9.3. Enabling Bootdisk plugin</h3>
<div class="paragraph">
<p>Enable the Bootdisk plugin to perform boot disk-based host provisioning.
The plugin must be enabled before you can generate a boot disk on your Foreman to provision hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable the Bootdisk plugin on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-bootdisk</pre>
</div>
</div>
</li>
<li>
<p>Optional: Install the Bootdisk plugin for Hammer CLI on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-cli-bootdisk</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong>.</p>
</li>
<li>
<p>On the <strong>System Status</strong> card, select the <strong>Plugins</strong> tab to verify that the Bootdisk plugin is installed.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>Continue with generating a boot disk on your Foreman to provision hosts.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="generating-a-full-host-boot-disk"><a class="anchor" href="#generating-a-full-host-boot-disk"></a>9.4. Generating a full host boot disk</h3>
<div class="paragraph">
<p>You can generate a full boot disk for a specific host.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-generating-a-full-host-boot-disk">CLI procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the operating system has PXELinux and PXEGrub2 templates associated.
For more information, see <a href="#associating-templates-with-operating-systems">Associating templates with operating systems</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab.
Verify that all fields contain correct values.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning Templates</strong> to check the new host can identify the right provisioning templates to use.</p>
<div class="paragraph">
<p>For more information about associating provisioning templates, see <a href="#associating-templates-with-operating-systems">Associating templates with operating systems</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.
This creates a host entry and the host details page appears.</p>
</li>
<li>
<p>Download the boot disk from Foreman&#160;server.
On the host details page, click the vertical ellipsis and select <strong>Full host '<em>My_Host_Name</em>' image</strong>.</p>
</li>
</ol>
</div>
<div id="cli-generating-a-full-host-boot-disk" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--build true \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--location "<em>My_Location</em>" \
--mac "<em>My_MAC_Address</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
<li>
<p>Configure the network interface of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host interface update \
--host "<em>My_Host_Name</em>" \
--managed true \
--primary true \
--provision true</pre>
</div>
</div>
</li>
<li>
<p>Download the <strong>Full host image</strong> boot disk from Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer bootdisk host \
--full true \
--host <em>My_Host_Name</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="generating-a-subnet-boot-disk"><a class="anchor" href="#generating-a-subnet-boot-disk"></a>9.5. Generating a subnet boot disk</h3>
<div class="paragraph">
<p>You can generate a subnet boot disk.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-generating-a-subnet-boot-disk">CLI procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <code>ipxe</code> package is installed on your Smart&#160;Proxy.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>.</p>
</li>
<li>
<p>Click the dropdown menu in the <strong>Actions</strong> column of the required subnet.</p>
</li>
<li>
<p>Select <strong>Subnet generic image</strong>.</p>
</li>
</ol>
</div>
<div id="cli-generating-a-subnet-boot-disk" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Generate the <strong>Subnet image</strong> boot disk:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer bootdisk subnet --subnet <em>My_Subnet_Name</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="generating-a-generic-boot-disk"><a class="anchor" href="#generating-a-generic-boot-disk"></a>9.6. Generating a generic boot disk</h3>
<div class="paragraph">
<p>You can generate a generic boot disk.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-generating-a-generic-boot-disk">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<p>This image is also available from the <code>/disks/generic</code> URL path on your Foreman&#160;server, for example, <code>https://foreman.example.com/disks/generic</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the <code>ipxe</code> package is installed on your Foreman&#160;server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>.</p>
</li>
<li>
<p>Click the dropdown menu in the <strong>Actions</strong> column of the required subnet.</p>
</li>
<li>
<p>Select <strong>Generic image</strong>.</p>
</li>
</ol>
</div>
<div id="cli-generating-a-generic-boot-disk" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Generate the <strong>Generic image</strong> boot disk:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer bootdisk generic</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="generating-a-host-boot-disk"><a class="anchor" href="#generating-a-host-boot-disk"></a>9.7. Generating a host boot disk</h3>
<div class="paragraph">
<p>You can generate a boot disk for a specific host.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-generating-a-host-boot-disk">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab.
Verify that all fields contain correct values.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning Templates</strong> to check the new host can identify the right provisioning templates to use.</p>
<div class="paragraph">
<p>For more information about associating provisioning templates, see <a href="#associating-templates-with-operating-systems">Associating templates with operating systems</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.
This creates a host entry and the host details page appears.</p>
</li>
<li>
<p>Download the boot disk from Foreman&#160;server.
On the host details page, click the vertical ellipsis and select <strong>Host '<em>My_Host_Name</em>' image</strong>.</p>
</li>
</ol>
</div>
<div id="cli-generating-a-host-boot-disk" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--build true \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--location "<em>My_Location</em>" \
--mac "<em>My_MAC_Address</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
<li>
<p>Configure the network interface of your host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host interface update \
--host "<em>My_Host_Name</em>" \
--managed true \
--primary true \
--provision true</pre>
</div>
</div>
</li>
<li>
<p>Download the <strong>Host image</strong> boot disk from Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer bootdisk host --host <em>My_Host_Name</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Deploying_SSH_Keys_During_Provisioning_using-bootdisks"><a class="anchor" href="#Deploying_SSH_Keys_During_Provisioning_using-bootdisks"></a>9.8. Deploying SSH keys during provisioning</h3>
<div class="paragraph">
<p>Use this procedure to deploy SSH keys added to a user during provisioning.
For information on adding SSH keys to a user, see <a href="https://docs.theforeman.org/nightly/Administering_Project/index-foreman-deb.html#Managing_SSH_Keys_for_a_User_admin">Managing SSH Keys for a User</a> in <em>Administering Foreman</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Create a provisioning template, or clone and edit an existing template.
For more information, see <a href="#creating-provisioning-templates">Creating provisioning templates</a>.</p>
</li>
<li>
<p>In the template, click the <strong>Template</strong> tab.</p>
</li>
<li>
<p>In the <strong>Template editor</strong> field, add the <code>create_users</code> snippet to the <code>%post</code> section:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;%= snippet('create_users') %&gt;</pre>
</div>
</div>
</li>
<li>
<p>Select the <strong>Default</strong> checkbox.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab.</p>
</li>
<li>
<p>From the <strong>Application Operating Systems</strong> list, select an operating system.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the provisioning template.</p>
</li>
<li>
<p>Create a host that is associated with the provisioning template or rebuild a host using the operating system associated with the modified template.
For more information, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#Creating_a_Host_managing-hosts">Creating a Host</a> in <em>Managing hosts</em>.</p>
<div class="paragraph">
<p>The SSH keys of the <strong>Owned by</strong> user are added automatically when the <code>create_users</code> snippet is executed during the provisioning process.
You can set <strong>Owned by</strong> to an individual user or a user group.
If you set <strong>Owned by</strong> to a user group, the SSH keys of all users in the user group are added automatically.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="discovering-hosts-on-a-network"><a class="anchor" href="#discovering-hosts-on-a-network"></a>10. Discovering hosts on a network</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="Configuring_the_Discovery_Service_provisioning"></a></p>
</div>
<div class="paragraph">
<p>Foreman can detect hosts on a network that are not in your Foreman inventory.
These hosts boot the Discovery image that performs hardware detection and relays this information back to Foreman&#160;server.
This method creates a list of ready-to-provision hosts in Foreman&#160;server without needing to enter the MAC address of each host.</p>
</div>
<div class="sect2">
<h3 id="prerequisites-for-using-discovery_provisioning"><a class="anchor" href="#prerequisites-for-using-discovery_provisioning"></a>10.1. Prerequisites for using Discovery</h3>
<div class="ulist">
<ul>
<li>
<p>Ensure that the DHCP range of all subnets that you plan to use for Discovery does not overlap with the DHCP lease pool configured for the managed DHCP service.
The DHCP range is set in the Foreman web UI, whereas the lease pool range is set by using the <code>foreman-installer</code> command.</p>
<div class="paragraph">
<p>For example, in the 10.1.0.0/16 network range, you can allocate the following IP address blocks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>10.1.0.0 to 10.1.127.255 for leases.</p>
</li>
<li>
<p>10.1.128.0 to 10.1.255.254 for reservations.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ensure the host or virtual machine being discovered has at least 1200 MB of memory.
Insufficient memory can cause various random kernel panic errors because the Discovery image is extracted in memory.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Installing_the_Discovery_Service_provisioning"><a class="anchor" href="#Installing_the_Discovery_Service_provisioning"></a>10.2. Installing the Discovery service</h3>
<div class="paragraph">
<p>Enable the Discovery service on Foreman&#160;server.
Additionally, you can enable the Discovery service on any Smart&#160;Proxy&#160;servers that provide the TFTP service.</p>
</div>
<div class="paragraph">
<p>The Discovery service requires a Discovery image, which is provided with Foreman.
The Discovery image uses a minimal operating system that is booted on hosts to acquire initial hardware information and check in with Foreman.</p>
</div>
<div class="paragraph">
<p>Foreman provides <a href="https://downloads.theforeman.org/discovery/releases/">multiple versions</a> of the Foreman Discovery image (FDI):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FDI versions 5.y are based on CentOS Stream 9.</p>
</li>
<li>
<p>FDI versions 4.0 and 4.1 are based on CentOS Stream 8.</p>
</li>
<li>
<p>FDI versions older than 4.0 are based on CentOS Stream 7.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the Discovery plugin on Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-cli-discovery \
--enable-foreman-plugin-discovery \
--enable-foreman-proxy-plugin-discovery \
--foreman-proxy-plugin-discovery-install-images true</pre>
</div>
</div>
<div class="paragraph">
<p>This command downloads the latest Discovery ISO.
If you require another version, add the following argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--foreman-proxy-plugin-discovery-source-url https://downloads.theforeman.org/discovery/releases/<em>x.y</em>/</pre>
</div>
</div>
</li>
<li>
<p>If you want to use Smart&#160;Proxy&#160;server, install the Discovery plugin on Smart&#160;Proxy&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-proxy-plugin-discovery \
--foreman-proxy-plugin-discovery-install-images true</pre>
</div>
</div>
<div class="paragraph">
<p>This command downloads the latest Discovery image.
If you require another version, add the following argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--foreman-proxy-plugin-discovery-source-url https://downloads.theforeman.org/discovery/releases/<em>x.y</em>/</pre>
</div>
</div>
</li>
<li>
<p>Configure the Discovery Smart&#160;Proxy for the subnet with discoverable hosts:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong>.</p>
</li>
<li>
<p>Select a subnet.</p>
</li>
<li>
<p>On the <strong>Proxies</strong> tab, select the Discovery Proxy that you want to use.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Perform this for each subnet that you want to use.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="discovery-in-pxe-mode"><a class="anchor" href="#discovery-in-pxe-mode"></a>10.3. Discovery in PXE mode</h3>
<div class="paragraph">
<p>Foreman provides a PXE-based Discovery service that uses DHCP and TFTP services.
You discover unknown nodes by booting them into the Discovery kernel and initial RAM disk images from Foreman&#160;server or Smart&#160;Proxy&#160;server.
When a discovered node is scheduled for installation, it reboots and continues with the configured PXE-based host provisioning.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/common/discovery-pxe-mode.svg" alt="Discovery workflow in PXE mode">
</div>
<div class="title">Figure 2. Discovery workflow in PXE mode</div>
</div>
<div class="sect3">
<h4 id="setting-discovery-as-the-default-PXE-boot-option_provisioning"><a class="anchor" href="#setting-discovery-as-the-default-PXE-boot-option_provisioning"></a>10.3.1. Setting Discovery as the default PXE boot option</h4>
<div class="paragraph">
<p>Set the Discovery service as the default service that boots for hosts that are not present in your current Foreman inventory.</p>
</div>
<div class="paragraph">
<p>When you start an unknown host in PXE mode, Foreman&#160;server or Smart&#160;Proxy&#160;server provides a boot menu with a default boot option.
The boot menu has two basic options: <code>local</code> and <code>discovery</code>.
The default setting of the global PXE templates is to select <code>local</code> to boot the host from the local hard drive.
Change the setting to select <code>discovery</code> to boot from the Discovery image.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your Foreman account has the <code>view_settings</code>, <code>edit_settings</code>, and <code>view_provisioning_templates</code> permissions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Provisioning</strong> tab, enter <code>discovery</code> in the <strong>Default PXE global template entry</strong> field.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Click <strong>Build PXE Default</strong>.</p>
<div class="paragraph">
<p>The boot menus are built as the following files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/var/lib/tftpboot/pxelinux.cfg/default</code></p>
</li>
<li>
<p><code>/var/lib/tftpboot/grub2/grub.cfg</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Foreman propagates the default boot menus to all TFTP Smart&#160;Proxies.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="performing-discovery-in-pxe-mode_provisioning"><a class="anchor" href="#performing-discovery-in-pxe-mode_provisioning"></a>10.3.2. Performing Discovery in PXE mode</h4>
<div class="paragraph">
<p>Discovery in PXE mode uses the Discovery PXE boot images and runs unattended.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the Discovery service and image.
For more information, see <a href="#Installing_the_Discovery_Service_provisioning">Installing the Discovery service</a>.</p>
</li>
<li>
<p>You have set Discovery as the default booting option.
For more information, see <a href="#setting-discovery-as-the-default-PXE-boot-option_provisioning">Setting Discovery as the default PXE boot option</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Power on or reboot your host.
After a few minutes, the Discovery image completes booting and the host displays a status screen.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Foreman web UI displays a notification about a new discovered host.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Discovered Hosts</strong> and view the newly discovered host.
For more information about provisioning discovered hosts, see <a href="#Creating_Hosts_from_Discovered_Hosts_provisioning">Creating hosts from discovered hosts</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Customizing_the_Discovery_PXE_Boot_provisioning"><a class="anchor" href="#Customizing_the_Discovery_PXE_Boot_provisioning"></a>10.3.3. Customizing the Discovery PXE boot</h4>
<div class="paragraph">
<p><a id="Discovery_Templates_and_Snippets_Settings_provisioning"></a>
<a id="Provisioning_Template_PXELinux_Discovery_Snippet_provisioning"></a></p>
</div>
<div class="paragraph">
<p>Foreman builds PXE boot menus from the following global provisioning templates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PXELinux global default</code> for BIOS provisioning.</p>
</li>
<li>
<p><code>PXEGrub global default</code> and <code>PXEGrub2 global default</code> for UEFI provisioning.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The PXE boot menus are available on Foreman&#160;server and Smart&#160;Proxies that have TFTP enabled.</p>
</div>
<div class="paragraph">
<p>The Discovery menu item uses a Linux kernel for the operating system and passes kernel parameters to configure the Discovery service.
You can customize the passed kernel parameters by changing the following snippets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pxelinux_discovery</code>: This snippet is included in the <code>PXELinux global default</code> template.</p>
<div class="paragraph">
<p>This snippet renders the Discovery boot menu option.
The <code>KERNEL</code> and <code>APPEND</code> options boot the Discovery kernel and initial RAM disk.
The <code>APPEND</code> option contains kernel parameters.</p>
</div>
</li>
<li>
<p><code>pxegrub_discovery</code>: This snippet is included in the <code>PXEGrub global default</code> template.
However, Discovery is <a href="http://projects.theforeman.org/issues/15997">not implemented for GRUB 1.x</a>.</p>
</li>
<li>
<p><code>pxegrub2_discovery</code>: This snippet is included in the <code>PXEGrub2 global default</code> template.</p>
<div class="paragraph">
<p>This snippet renders the Discovery GRUB2 menu entry.
The <code>common</code> variable contains kernel parameters.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about the kernel parameters, see <a href="#kernel-parameters-for-discovery-customization_provisioning">Kernel parameters for Discovery customization</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Clone and edit the snippet you want to customize.
For more information, see <a href="#cloning-provisioning-templates">Cloning provisioning templates</a>.</p>
</li>
<li>
<p>Clone and edit the template that contains the original snippet.
Include your custom snippet instead of the original snippet.
For more information, see <a href="#cloning-provisioning-templates">Cloning provisioning templates</a>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Settings</strong>.</p>
</li>
<li>
<p>Click the <strong>Provisioning</strong> tab.</p>
</li>
<li>
<p>In the appropriate <strong>Global default PXE\</strong> template* setting, select your custom template.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Click <strong>Build PXE Default</strong>.
This refreshes the default PXE boot menus on Foreman&#160;server and any TFTP Smart&#160;Proxies.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="discovery-in-pxeless-mode"><a class="anchor" href="#discovery-in-pxeless-mode"></a>10.4. Discovery in PXE-less mode</h3>
<div class="paragraph">
<p>Foreman provides a PXE-less Discovery service for environments without DHCP and TFTP services.
You discover unknown nodes by using the Discovery ISO from Foreman&#160;server.
When a discovered node is scheduled for installation, the <code>kexec</code> command reloads a Linux kernel with an operating system installer without rebooting the node.</p>
</div>
<div class="ulist">
<div class="title">Known issues</div>
<ul>
<li>
<p>The console might freeze during the process.</p>
</li>
<li>
<p>On some hardware, you might experience graphical hardware problems.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/common/discovery-pxeless-mode.svg" alt="Discovery workflow in PXE-less mode">
</div>
<div class="title">Figure 3. Discovery workflow in PXE-less mode</div>
</div>
<div class="sect3">
<h4 id="performing-discovery-in-pxeless-mode_provisioning"><a class="anchor" href="#performing-discovery-in-pxeless-mode_provisioning"></a>10.4.1. Performing Discovery in PXE-less mode</h4>
<div class="paragraph">
<p><a id="Implementing_PXE_less_Discovery_provisioning"></a></p>
</div>
<div class="paragraph">
<p>Discovery in PXE-less mode uses the Discovery ISO and requires you to attend to the process.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the Foreman Discovery image or built a custom Discovery image ISO.
For more information, see one of the following resources:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#Installing_the_Discovery_Service_provisioning">Installing the Discovery service</a></p>
</li>
<li>
<p><a href="#Building_a_custom_Discovery_Image_provisioning">Building a custom Discovery image</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the Discovery ISO to a CD, DVD, or a USB flash drive.
For example, to copy to a USB drive at <code>/dev/sdb</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dd bs=4M \
if=/usr/share/foreman-discovery-image/foreman-discovery-image-<em>version</em>.iso \
of=/dev/sdb</pre>
</div>
</div>
</li>
<li>
<p>Insert the Discovery boot media into a host, start the host, and boot from the media.</p>
</li>
<li>
<p>The Discovery image displays options for either <strong>Manual network setup</strong> or <strong>Discovery with DHCP</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Manual network setup</strong>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>On the <strong>Primary interface</strong> screen, select the primary network interface that connects to Foreman&#160;server or Smart&#160;Proxy&#160;server.
Optionally, enter a <strong>VLAN ID</strong>.
Hit <strong>Select</strong> to continue.</p>
</li>
<li>
<p>On the <strong>Network configuration</strong> screen, enter the <strong>Address</strong>, <strong>Gateway</strong>, and <strong>DNS</strong>.
Hit <strong>Next</strong> to continue.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Discovery with DHCP</strong>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>On the <strong>Primary interface</strong> screen, select the primary network interface that connects to Foreman&#160;server or Smart&#160;Proxy&#160;server.
Optionally, enter a <strong>VLAN ID</strong>.
Hit <strong>Select</strong> to continue.</p>
</li>
<li>
<p>The Discovery image attempts to automatically configure the network interface by using a DHCP server, such as one that a Smart&#160;Proxy&#160;server provides.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>On the <strong>Credentials</strong> screen, enter the following options:</p>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Server URL</strong> field, enter the URL of Foreman&#160;server or Discovery Smart&#160;Proxy&#160;server.
If you refer to a Smart&#160;Proxy&#160;server, include the Smart&#160;Proxy port number.</p>
</li>
<li>
<p>In the <strong>Connection type</strong> field, select the connection type: <code>Server</code> for Foreman&#160;server or <code>Foreman Proxy</code> for Smart&#160;Proxy&#160;server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hit <strong>Next</strong> to continue.</p>
</div>
</li>
<li>
<p>Optional: On the <strong>Custom facts</strong> screen, enter custom facts for the Facter tool to relay back to Foreman&#160;server.
Enter a name and value for each custom fact you need.</p>
</li>
<li>
<p>Hit <strong>Confirm</strong> to proceed.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Foreman web UI displays a notification about a new discovered host.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Discovered Hosts</strong> and view the newly discovered host.
For more information about provisioning discovered hosts, see <a href="#Creating_Hosts_from_Discovered_Hosts_provisioning">Creating hosts from discovered hosts</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="customizing-the-discovery-iso_provisioning"><a class="anchor" href="#customizing-the-discovery-iso_provisioning"></a>10.4.2. Customizing the Discovery ISO</h4>
<div class="paragraph">
<p>You can create a customized Discovery ISO to automate the image configuration process after booting.
The Discovery image uses a Linux kernel for the operating system, which passes kernel parameters to configure the Discovery service.</p>
</div>
<div class="paragraph">
<p>By using this tool, remaster the image to include custom kernel parameters.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the <code>discovery-remaster</code> tool.
Enter the kernel parameters as a single string.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># discovery-remaster ~/iso/foreman-discovery-image-<em>version</em>.iso \
"fdi.pxip=192.168.140.20/24 \
fdi.pxgw=192.168.140.1 \
fdi.pxdns=192.168.140.2 \
proxy.url=https://<em>foreman.example.com</em>:8443 \
proxy.type=proxy \
fdi.pxfactname1=<em>My_Custom_Hostname</em> \
fdi.pxfactvalue1=<em>My_Host</em> \
fdi.pxmac=52:54:00:be:8e:8c fdi.pxauto=1"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about kernel parameters, see <a href="#kernel-parameters-for-discovery-customization_provisioning">Kernel parameters for Discovery customization</a>.</p>
</div>
</li>
<li>
<p>Copy the new ISO to either a CD, DVD, or a USB stick.
For example, to copy to a USB stick at <code>/dev/sdb</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dd bs=4M \
if=/usr/share/foreman-discovery-image/foreman-discovery-image-<em>version</em>.iso \
of=/dev/sdb</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Next steps</div>
<ul>
<li>
<p>Insert the Discovery boot medium into a bare metal host, start the host, and boot from the medium.</p>
<div class="paragraph">
<p>For more information about provisioning discovered hosts, see <a href="#Creating_Hosts_from_Discovered_Hosts_provisioning">Creating hosts from discovered hosts</a>.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Automatic_Contexts_for_Discovered_Hosts_provisioning"><a class="anchor" href="#Automatic_Contexts_for_Discovered_Hosts_provisioning"></a>10.5. Automatic contexts for discovered hosts</h3>
<div class="paragraph">
<p>Foreman&#160;server assigns an organization and location to discovered hosts automatically according to the following sequence of rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If a discovered host uses a subnet defined in Foreman, the host uses the first organization and location associated with the subnet.</p>
</li>
<li>
<p>If the default location and organization is configured in global settings, the discovered hosts are placed in this organization and location.
To configure these settings, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Discovery</strong> and select values for the <strong>Discovery organization</strong> and <strong>Discovery location</strong> settings.
Ensure that the subnet of discovered host also belongs to the selected organization and location, otherwise Foreman refuses to set it for security reasons.</p>
</li>
<li>
<p>If none of the previous conditions is met, Foreman assigns the first organization and location ordered by name.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can change the organization or location manually by using the bulk actions on the <strong>Discovered Hosts</strong> page.
Select the discovered hosts to modify and, from the <strong>Select Action</strong> menu, select <strong>Assign Organization</strong> or <strong>Assign Location</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Hosts_from_Discovered_Hosts_provisioning"><a class="anchor" href="#Creating_Hosts_from_Discovered_Hosts_provisioning"></a>10.6. Creating hosts from discovered hosts</h3>
<div class="paragraph">
<p>Provisioning discovered hosts follows a provisioning process that is similar to PXE provisioning.
The main difference is that instead of manually entering the host&#8217;s MAC address, you can select the host to provision from the list of discovered hosts.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-hosts-from-discovered-hosts_provisioning">CLI procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure a domain and subnet on Foreman.
For more information about networking requirements, see <a href="#preparing-networking">Preparing networking</a>.</p>
</li>
<li>
<p>You have one or more discovered hosts in your Foreman inventory.</p>
</li>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.</p>
</li>
<li>
<p>You have associated a <code>Discovery kexec</code>-kind template and <code>provisioning</code>-kind template with the operating system.
For more information, see <a href="#associating-templates-with-operating-systems">Associating templates with operating systems</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about the security tokens, see <a href="#configuring-the-security-token-validity-duration">Configuring the security token validity duration</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Discovered hosts</strong>.</p>
</li>
<li>
<p>Select the host you want to provision and click <strong>Provision</strong> to the right of the list.</p>
</li>
<li>
<p>Select one of the following options:</p>
<div class="ulist">
<ul>
<li>
<p>To provision a host from a host group, select a host group, organization, and location, and then click <strong>Create Host</strong>.</p>
</li>
<li>
<p>To provision a host with further customization, click <strong>Customize Host</strong> and enter the additional details you want to specify for the new host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Foreman&#160;server automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Foreman&#160;server automatically populates the MAC address from the Discovery results.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ensure that Foreman&#160;server automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and verify that all fields contain values.
Confirm each aspect of the operating system.</p>
</li>
<li>
<p>In <strong>Provisioning templates</strong>, click <strong>Resolve</strong> to check if the new host can identify the correct provisioning templates.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the host provisioning is complete, the discovered host moves to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</div>
<div id="cli-creating-hosts-from-discovered-hosts_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Identify the discovered host to provision:</p>
<div class="listingblock">
<div class="content">
<pre>$ hammer discovery list</pre>
</div>
</div>
</li>
<li>
<p>Select the host and provision it by using a host group.
Set a new host name with the <code>--new-name</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer discovery provision \
--build true \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--new-name "<em>My_New_Host_Name</em>" \
--organization "<em>My_Organization</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>This removes the host from the discovered host listing and creates a host entry with the provisioning settings.
The Discovery image automatically reboots the host to PXE or initiates kernel execution.
The host detects the DHCP service and starts installing the operating system.
The rest of the process is identical to the normal PXE workflow.
For more information, see <a href="#creating-hosts-with-pxe-boot-provisioning">Creating hosts with PXE boot provisioning</a>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Discovery_Rules_provisioning"><a class="anchor" href="#Creating_Discovery_Rules_provisioning"></a>10.7. Creating Discovery rules</h3>
<div class="paragraph">
<p>As a method of automating the provisioning process for discovered hosts, Foreman provides a feature to create Discovery rules.
These rules define how discovered hosts automatically provision themselves, based on the assigned host group.
For example, you can automatically provision hosts with a high CPU count as hypervisors.
Likewise, you can provision hosts with large hard disks as storage servers.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-discovery-rules_provisioning">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<div class="title">NIC considerations</div>
<p>Auto provisioning does not currently allow configuring network interface cards (NICs).
All systems are being provisioned with the NIC configuration that was detected during discovery.
However, you can set the NIC in the <code>OS installer recipe</code> scriptlet, by using a script, or by using configuration management at a later stage.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Configure</strong> &gt; <strong>Discovery rules</strong>, and select <strong>Create Rule</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the rule.</p>
</li>
<li>
<p>In the <strong>Search</strong> field, enter the rules to determine whether to provision a host.
This field provides suggestions for values you enter and allows operators for multiple rules.
For example: <code>cpu_count  &gt; 8</code>.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select the host group to use as a template for this host.</p>
</li>
<li>
<p>In the <strong>Hostname</strong> field, enter the pattern to determine host names for multiple hosts.
This uses the same ERB syntax that provisioning templates use.
The host name can use the <code>@host</code> attribute for host-specific values and the <code>rand</code> macro for a random number or the <code>sequence_hostgroup_param_next</code> macro for incrementing the value.
For more information about provisioning templates, see <a href="#provisioning-templates">Provisioning templates</a> and the API documentation.</p>
<div class="ulist">
<ul>
<li>
<p><code>myhost-&lt;%= sequence_hostgroup_param_next("EL7/MyHostgroup", 10, "discovery_host") %&gt;</code></p>
</li>
<li>
<p><code>myhost-&lt;%= rand(99999) %&gt;</code></p>
</li>
<li>
<p><code>abc-&lt;%= @host.facts['bios_vendor'] %&gt;-&lt;%= rand(99999) %&gt;</code></p>
</li>
<li>
<p><code>xyz-&lt;%= @host.hostgroup.name %&gt;</code></p>
</li>
<li>
<p><code>srv-&lt;%= @host.discovery_rule.name %&gt;</code></p>
</li>
<li>
<p><code>server-&lt;%= @host.ip.gsub('.','-') +  '-' + @host.hostgroup.subnet.name %&gt;</code></p>
<div class="paragraph">
<p>When creating host name patterns, ensure that the resulting host names are unique, do not start with numbers, and do not contain underscores or dots.
A good approach is to use unique information provided by Facter, such as the MAC address, BIOS, or serial ID.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Hosts limit</strong> field, enter the maximum number of hosts that you can provision with the rule.
Enter <code>0</code> for unlimited.</p>
</li>
<li>
<p>In the <strong>Priority</strong> field, enter a number to set the precedence the rule has over other rules.
Rules with lower values have a higher priority.</p>
</li>
<li>
<p>From the <strong>Enabled</strong> list, select whether you want to enable the rule.</p>
</li>
<li>
<p>To set a different provisioning context for the rule, click the <strong>Organizations</strong> and <strong>Locations</strong> tabs and select the contexts you want to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your rule.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Discovered Host</strong> and select one of the following two options:</p>
<div class="ulist">
<ul>
<li>
<p>From the <strong>Discovered hosts</strong> list on the right, select <strong>Auto-Provision</strong> to automatically provisions a single host.</p>
</li>
<li>
<p>On the upper right of the window, click <strong>Auto-Provision All</strong> to automatically provisions all hosts.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="cli-creating-discovery-rules_provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create the rule by using Hammer:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer discovery-rule create \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--hostname "hypervisor-&lt;%= rand(99999) %&gt;" \
--hosts-limit 5 \
--name "<em>My_Hypervisor</em>" \
--priority 5 \
--search "cpu_count  &gt; 8"</pre>
</div>
</div>
</li>
<li>
<p>Automatically provision a host with the <code>hammer discovery auto-provision</code> command:</p>
<div class="listingblock">
<div class="content">
<pre>$ hammer discovery auto-provision --name "macabcdef123456"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Extending_the_Discovery_Image_provisioning"><a class="anchor" href="#Extending_the_Discovery_Image_provisioning"></a>10.8. Extending the Discovery image</h3>
<div class="paragraph">
<p>You can extend the Foreman Discovery image with custom facts, software, or device drivers.
You can also provide a compressed archive file containing extra code for the image to use.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the following directory structure:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">.
├── autostart.d
│   └── 01_zip.sh
├── bin
│   └── ntpdate
├── facts
│   └── test.rb
└── lib
    ├── libcrypto.so.1.0.0
    └── ruby
        └── test.rb</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>autostart.d</code> directory contains scripts that are executed in POSIX order by the Discovery kernel when it starts but before the host is registered to Foreman.</p>
</li>
<li>
<p>The <code>bin</code> directory is added to the <code>$PATH</code> variable; you can place binary files in this directory and use them in the <code>autostart</code> scripts.</p>
</li>
<li>
<p>The <code>facts</code> directory is added to the <code>FACTERLIB</code> variable so that custom facts can be configured and sent to Foreman.</p>
</li>
<li>
<p>The <code>lib</code> directory is added to the <code>LD_LIBRARY_PATH</code> variable and <code>lib/ruby</code> is added to the <code>RUBYLIB</code> variable, so that binary files in <code>/bin</code> can be executed correctly.</p>
</li>
</ul>
</div>
</li>
<li>
<p>After creating the directory structure, create a <code>.zip</code> file archive:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># zip -r my_extension.zip .</pre>
</div>
</div>
</li>
<li>
<p>Inform the Discovery kernel of the extensions it must use.
Place your zip files on your TFTP server with the Discovery image and customize the Discovery PXE boot with the <code>fdi.zips</code> parameter where the paths are relative to the TFTP root.</p>
<div class="paragraph">
<p>For example, if you have two archives at <code>$TFTP/zip1.zip</code> and <code>$TFTP/boot/zip2.zip</code>, use the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">fdi.zips=zip1.zip,boot/zip2.zip</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="#Customizing_the_Discovery_PXE_Boot_provisioning">Customizing the Discovery PXE boot</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can append new directives and options to the existing environment variables (<code>PATH</code>, <code>LD_LIBRARY_PATH</code>, <code>RUBYLIB</code> and <code>FACTERLIB</code>).
If you want to specify the path explicitly in your scripts, the <code>.zip</code> file contents are extracted to the <code>/opt/extension</code> directory on the image.</p>
</div>
<div class="paragraph">
<p>You can create multiple <code>.zip</code> files but be aware that they are extracted to the same location on the Discovery image.
Files extracted from in later <code>.zip</code> files overwrite earlier versions if they contain the same file name.</p>
</div>
</div>
<div class="sect2">
<h3 id="Building_a_custom_Discovery_Image_provisioning"><a class="anchor" href="#Building_a_custom_Discovery_Image_provisioning"></a>10.9. Building a custom Discovery image</h3>
<div class="paragraph">
<p>You can build a custom Discovery ISO or rebuild an ISO if you change configuration files.</p>
</div>
<div class="paragraph">
<p>The Discovery image uses a minimal operating system that is booted on hosts to acquire initial hardware information and check in with Foreman.
Discovered hosts keep running the Discovery operating system until they are rebooted into an operating system installer, which then initiates the provisioning process.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use your production Foreman&#160;server nor Smart&#160;Proxy&#160;server to perform this procedure.
Use either a dedicated environment or copy the repositories and Kickstart file to a separate server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following procedure demonstrates the building process on Enterprise Linux 8 and uses CentOS Stream 8 repositories.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that hardware virtualization is available on your server.</p>
</li>
<li>
<p>Install the following packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install git-core lorax anaconda pykickstart wget qemu-kvm</pre>
</div>
</div>
</li>
<li>
<p>Clone the <code>foreman-discovery-image</code> repository:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ git clone https://github.com/theforeman/foreman-discovery-image.git
$ cd foreman-discovery-image</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Replace the contents of the <code>00-repos-centos8.ks</code> file with the following:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">url --mirrorlist=http://mirrorlist.centos.org/?release=8&arch=$basearch&repo=baseos
repo --name="AppStream" --mirrorlist=http://mirrorlist.centos.org/?release=8&arch=$basearch&repo=appstream
repo --name="foreman-el8" --baseurl=http://yum.theforeman.org/releases/nightly/el8/$basearch/
repo --name="foreman-plugins-el8" --baseurl=http://yum.theforeman.org/plugins/nightly/el8/$basearch/
module --name=ruby --stream=2.7
module --name=postgresql --stream=12
module --name=foreman --stream=el8</pre>
</div>
</div>
</li>
<li>
<p>Prepare the Kickstart file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ./build-livecd fdi-centos8.ks</pre>
</div>
</div>
</li>
<li>
<p>Build the ISO image:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo ./build-livecd-root <em>custom</em> ./result "nomodeset nokaslr"</pre>
</div>
</div>
<div class="paragraph">
<p><code>nomodeset</code> disables mode setting.
<code>nokaslr</code> disables address space layout randomization.</p>
</div>
<div class="paragraph">
<p>For example, you can build a fully automated Discovery image with a static network configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo ./build-livecd-root <em>custom</em> ./result \
"nomodeset nokaslr \
fdi.pxip=192.168.140.20/24 fdi.pxgw=192.168.140.1 \
fdi.pxdns=192.168.140.2 proxy.url=https://foreman.example.com:8443 \
proxy.type=foreman fdi.pxmac=52:54:00:be:8e:8c fdi.pxauto=1"</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about configuration options, see <a href="#kernel-parameters-for-discovery-customization_provisioning">Kernel parameters for Discovery customization</a>.</p>
</div>
</li>
<li>
<p>Verify that your <code>./result/fdi-custom-XXXXXXX.iso</code> file is created:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ls -h ./result/*.iso</pre>
</div>
</div>
</li>
<li>
<p>Convert the <code>.iso</code> file to an <code>.iso</code> hybrid file for local booting:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># isohybrid --partok fdi.iso</pre>
</div>
</div>
<div class="paragraph">
<p>If you have <code>grub2</code> packages installed, you can also use the following command to install a <code>grub2</code> boot loader:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># isohybrid --partok --uefi fdi.iso</pre>
</div>
</div>
</li>
<li>
<p>Add <code>md5</code> checksum to the <code>.iso</code> file so that it can pass installation media validation tests in Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># implantisomd5 fdi.iso</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="kernel-parameters-for-discovery-customization_provisioning"><a class="anchor" href="#kernel-parameters-for-discovery-customization_provisioning"></a>10.10. Kernel parameters for Discovery customization</h3>
<div class="paragraph">
<p>Discovery uses a Linux kernel for the operating system and passes kernel parameters to configure the Discovery service.
These kernel parameters include the following entries:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">fdi.cachefacts</dt>
<dd>
<p>Number of fact uploads without caching.
By default, Foreman does not cache any uploaded facts.</p>
</dd>
<dt class="hdlist1">fdi.countdown</dt>
<dd>
<p>Number of seconds to wait until the text-user interface is refreshed after the initial discovery attempt.
This value defaults to 45 seconds.
Increase this value if the status page reports the IP address as <code>N/A</code>.</p>
</dd>
<dt class="hdlist1">fdi.dhcp_timeout</dt>
<dd>
<p>NetworkManager DHCP timeout.
The default value is 300 seconds.</p>
</dd>
<dt class="hdlist1">fdi.dns_nameserver</dt>
<dd>
<p>Nameserver to use for DNS SRV record.</p>
</dd>
<dt class="hdlist1">fdi.dns_ndots</dt>
<dd>
<p><code>ndots</code> option to use for DNS SRV record.</p>
</dd>
<dt class="hdlist1">fdi.dns_search</dt>
<dd>
<p>Search domain to use for DNS SRV record.</p>
</dd>
<dt class="hdlist1">fdi.initnet</dt>
<dd>
<p>By default, the image initializes all network interfaces (value <code>all</code>).
When this setting is set to <code>bootif</code>, only the network interface it was network-booted from will be initialized.</p>
</dd>
<dt class="hdlist1">fdi.ipv4.method</dt>
<dd>
<p>By default, NetworkManager IPv4 method setting is set to <code>auto</code>.
This option overrides it, set it to <code>ignore</code> to disable the IPv4 stack.
This option works only in DHCP mode.</p>
</dd>
<dt class="hdlist1">fdi.ipv6.method</dt>
<dd>
<p>By default, NetworkManager IPv6 method setting is set to <code>auto</code>.
This option overrides it, set it to <code>ignore</code> to disable the IPv6 stack.
This option only works in DHCP mode.</p>
</dd>
<dt class="hdlist1">fdi.ipwait</dt>
<dd>
<p>Duration in seconds to wait for IP to be available in HTTP proxy SSL cert start.
By default, Foreman waits for 120 seconds.</p>
</dd>
<dt class="hdlist1">fdi.nmwait</dt>
<dd>
<p><code>nmcli -wait</code> option for NetworkManager.
By default, <code>nmcli</code> waits for 120 seconds.</p>
</dd>
<dt class="hdlist1">fdi.proxy_cert_days</dt>
<dd>
<p>Number of days the self-signed HTTPS cert is valid for.
By default, the certificate is valid for 999 days.</p>
</dd>
<dt class="hdlist1">fdi.pxauto</dt>
<dd>
<p>To set automatic or semi-automatic mode.
If set to 0, the image uses semi-automatic mode, which allows you to confirm your choices through a set of dialog options.
If set to 1, the image uses automatic mode and proceeds without any confirmation.</p>
</dd>
<dt class="hdlist1">fdi.pxfactname1, fdi.pxfactname2 &#8230;&#8203; fdi.pxfactnameN</dt>
<dd>
<p>Use to specify custom fact names.</p>
</dd>
<dt class="hdlist1">fdi.pxfactvalue1, fdi.pxfactvalue2 &#8230;&#8203; fdi.pxfactvalueN</dt>
<dd>
<p>The values for each custom fact.
Each value corresponds to a fact name.
For example, <code>fdi.pxfactvalue1</code> sets the value for the fact named with <code>fdi.pxfactname1</code>.</p>
</dd>
<dt class="hdlist1">fdi.pxip, fdi.pxgw, fdi.pxdns</dt>
<dd>
<p>Manually configures IP address (<code>fdi.pxip</code>), the gateway (<code>fdi.pxgw</code>), and the DNS (<code>fdi.pxdns</code>) for the primary network interface.
If you omit these parameters, the image uses DHCP to configure the network interface.
You can add multiple DNS entries in a comma-separated
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>
list, for example <code>fdi.pxdns=192.168.1.1,192.168.200.1</code>.</p>
</dd>
<dt class="hdlist1">fdi.pxmac</dt>
<dd>
<p>The MAC address of the primary interface in the format of <code>AA:BB:CC:DD:EE:FF</code>.
This is the interface you aim to use for communicating with Smart&#160;Proxy&#160;server.
In automated mode, the first NIC (using network identifiers in alphabetical order) with a link is used.
In semi-automated mode, a screen appears and requests you to select the correct interface.</p>
</dd>
<dt class="hdlist1">fdi.rootpw</dt>
<dd>
<p>By default, the <code>root</code> account is locked.
Use this option to set a root password.
You can enter both clear and encrypted passwords.</p>
</dd>
<dt class="hdlist1">fdi.ssh</dt>
<dd>
<p>By default, the SSH service is disabled.
Set this to <code>1</code> or <code>true</code> to enable SSH access.</p>
</dd>
<dt class="hdlist1">fdi.uploadsleep</dt>
<dd>
<p>Duration in seconds between facter runs.
By default, facter runs every 30 seconds.</p>
</dd>
<dt class="hdlist1">fdi.vlan.primary</dt>
<dd>
<p>VLAN tagging ID to set for the primary interface.
If you want to use tagged VLAN provisioning and you want the Discovery service to send a discovery request, add the following parameter to the Discovery snippet:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">fdi.vlan.primary=<em>My_VLAN_ID</em></pre>
</div>
</div>
</dd>
<dt class="hdlist1">fdi.zips</dt>
<dd>
<p>Filenames with extensions to be downloaded and started during boot.
For more information, see <a href="#Extending_the_Discovery_Image_provisioning">Extending the Discovery image</a>.</p>
</dd>
<dt class="hdlist1">fdi.zipserver</dt>
<dd>
<p>TFTP server to use to download extensions from.
For more information, see <a href="#Extending_the_Discovery_Image_provisioning">Extending the Discovery image</a>.</p>
</dd>
<dt class="hdlist1">net.ifnames and biosdevname</dt>
<dd>
<p>Because network interface names are not expected to always be the same <a href="https://access.redhat.com/solutions/5984311">between major versions</a> of Red&#160;Hat Enterprise Linux,
hosts can be created with incorrect network configurations.
You can disable the new naming scheme by a kernel command line parameter:</p>
<div class="ulist">
<ul>
<li>
<p>For Dell servers, use the <code>biosdevname=1</code> parameter.</p>
</li>
<li>
<p>For other hardware or virtual machines, use the <code>net.ifnames=1</code> parameter.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">proxy.type</dt>
<dd>
<p>The proxy type.
By default, this parameter is set to <code>foreman</code>, where communication goes directly to Foreman&#160;server.
Set this parameter to <code>proxy</code> if you point to Smart&#160;Proxy in <code>proxy.url</code>.</p>
</dd>
<dt class="hdlist1">proxy.url</dt>
<dd>
<p>The URL of the server providing the Discovery service.
By default, this parameter contains the <code>foreman_server_url</code> macro as its argument.
This macro resolves to the full URL of Foreman&#160;server.
There is no macro for a Smart&#160;Proxy URL.
You have to set a Smart&#160;Proxy explicitly.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">proxy.url=https://<em>smartproxy.example.com</em>:8443 proxy.type=proxy</pre>
</div>
</div>
<div class="paragraph">
<p>You can use an IP address or FQDN in this parameter.
Add a SSL port number if you point to Smart&#160;Proxy.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="Troubleshooting_Discovery_provisioning"><a class="anchor" href="#Troubleshooting_Discovery_provisioning"></a>10.11. Troubleshooting Discovery</h3>
<div class="paragraph">
<p>If a machine is not listed in the Foreman web UI in <strong>Hosts</strong> &gt; <strong>Discovered Hosts</strong>, it means that Discovery has failed.
Inspect the following configuration areas to help isolate the problem:</p>
</div>
<div class="ulist">
<div class="title">Inspecting prerequisites</div>
<ul>
<li>
<p>Ensure that your Foreman and hosts meet the requirements.
For more information, see <a href="#prerequisites-for-using-discovery_provisioning">Prerequisites for using Discovery</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Inspecting problems on Foreman</div>
<ul>
<li>
<p>Ensure you have set Discovery for booting and built the PXE boot configuration files.
For more information, see <a href="#setting-discovery-as-the-default-PXE-boot-option_provisioning">Setting Discovery as the default PXE boot option</a>.</p>
</li>
<li>
<p>Verify that these configuration files are present on your TFTP Smart&#160;Proxy and have <code>discovery</code> set as the default boot option:</p>
<div class="ulist">
<ul>
<li>
<p><code>/var/lib/tftpboot/pxelinux.cfg/default</code></p>
</li>
<li>
<p><code>/var/lib/tftpboot/grub2/grub.cfg</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Verify that the values of the <code>proxy.url</code> and <code>proxy.type</code> options in the PXE Discovery snippet you are using.
The default snippets are named <code>pxelinux_discovery</code>, <code>pxegrub_discovery</code>, or <code>pxegrub2_discovery</code>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Inspecting problems with networking</div>
<ul>
<li>
<p>Ensure adequate network connectivity between hosts, Smart&#160;Proxy&#160;server, and Foreman&#160;server.</p>
</li>
<li>
<p>Ensure that the DHCP server provides IP addresses to the booted Discovery image correctly.</p>
</li>
<li>
<p>Ensure that DNS is working correctly for the discovered hosts or use an IP address in the <code>proxy.url</code> option in the PXE Discovery snippet included in the PXE template you are using.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Inspecting problems on the host</div>
<ul>
<li>
<p>If the host boots into the Discovery image but Discovery is not successful, enable the root account and SSH access on the Discovery image.
You can enable SSH and set the root password by using the following Discovery kernel options:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">fdi.ssh=1 fdi.rootpw=<em>My_Password</em></pre>
</div>
</div>
</li>
<li>
<p>Using TTY2 or higher, log in to a Discovery-booted host to review system logs.
For example, these logs are useful for troubleshooting:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>discover-host</code></dt>
<dd>
<p>Initial facts upload</p>
</dd>
<dt class="hdlist1"><code>foreman-discovery</code></dt>
<dd>
<p>Facts refresh, reboot remote commands</p>
</dd>
<dt class="hdlist1"><code>nm-prepare</code></dt>
<dd>
<p>Boot script which pre-configures NetworkManager</p>
</dd>
<dt class="hdlist1"><code>NetworkManager</code></dt>
<dd>
<p>Networking information</p>
</dd>
</dl>
</div>
</li>
<li>
<p>For gathering important system facts, use the <code>discovery-debug</code> command on the Discovery-booted host.
It prints out system logs, network configuration, list of facts, and other information on the standard output.
You can redirect this output to a file and copy it with the <code>scp</code> command for further investigation.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about changing the Discovery kernel options, see the following resources:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#Customizing_the_Discovery_PXE_Boot_provisioning">Customizing the Discovery PXE boot</a></p>
</li>
<li>
<p><a href="#customizing-the-discovery-iso_provisioning">Customizing the Discovery ISO</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_on_KVM_kvm-provisioning"><a class="anchor" href="#Provisioning_Virtual_Machines_on_KVM_kvm-provisioning"></a>11. Provisioning virtual machines on KVM (libvirt)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman can connect to the <code>libvirt</code> API on the hypervisor to provision hosts and control certain virtualization functions.</p>
</div>
<div class="paragraph">
<p>Only Virtual Machines created through Foreman can be managed.
Virtual Machines with other than directory storage pool types are unsupported.</p>
</div>
<div class="paragraph">
<p>You can use KVM provisioning to create hosts over a network connection or from an existing image.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.</p>
</li>
<li>
<p>A Smart&#160;Proxy&#160;server managing a network on the KVM server.
Ensure no other DHCP services run on this network to avoid conflicts with Smart&#160;Proxy&#160;server.
For more information about network service configuration for Smart&#160;Proxy&#160;servers, see <a href="https://docs.theforeman.org/nightly/Provisioning_Hosts/index-foreman-deb.html#preparing-networking">Preparing networking</a> in <em>Provisioning hosts</em>.</p>
</li>
<li>
<p>A server running KVM virtualization tools (libvirt daemon).</p>
</li>
<li>
<p>A virtual network running on the libvirt server.
Only NAT and isolated virtual networks can be managed through Foreman.</p>
</li>
<li>
<p>An existing virtual machine image if you want to use image-based provisioning.
Ensure that this image exists in a storage pool on the KVM host.
The <code>default</code> storage pool is usually located in <code>/var/lib/libvirt/images</code>.
Only directory pool storage types can be managed through Foreman.</p>
</li>
<li>
<p>Optional: The examples in these procedures use the root user for KVM.
If you want to use a non-root user on the KVM server, you must add the user to the <code>libvirt</code> group on the KVM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># usermod -a -G libvirt <em>non_root_user</em></pre>
</div>
</div>
</li>
<li>
<p>Ensure the provisioning user has the required permissions to provision hosts.
For more information, see <a href="#permissions-required-to-provision-hosts">Permissions required to provision hosts</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting a host entry associated with a virtual machine does not destroy the virtual machine on the compute resource.</p>
</div>
<div class="paragraph">
<p>To change the default behavior, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and set <strong>Destroy associated VM on host delete</strong> to <strong>Yes</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="enabling-libvirt-plugin"><a class="anchor" href="#enabling-libvirt-plugin"></a>11.1. Enabling libvirt plugin</h3>
<div class="paragraph">
<p>Install the libvirt plugin to attach a libvirt/KVM compute resource provider to Foreman.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Install the libvirt plugin on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-compute-libvirt</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong>.</p>
</li>
<li>
<p>On the <strong>Available Providers</strong> tab, verify that the libvirt plugin is installed.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>Continue with connecting your Foreman to your libvirt/KVM compute resource.
For more information, see <a href="#configuring-server-for-kvm-connections_kvm-provisioning">Configuring Foreman&#160;server for KVM connections</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-server-for-kvm-connections_kvm-provisioning"><a class="anchor" href="#configuring-server-for-kvm-connections_kvm-provisioning"></a>11.2. Configuring Foreman&#160;server for KVM connections</h3>
<div class="paragraph">
<p>Before adding the KVM connection, create an SSH key pair for the <code>foreman</code> user to ensure a secure connection between Foreman&#160;server and KVM.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Foreman&#160;server, switch to the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre># su foreman -s /bin/bash</pre>
</div>
</div>
</li>
<li>
<p>Generate the key pair:</p>
<div class="listingblock">
<div class="content">
<pre>$ ssh-keygen</pre>
</div>
</div>
</li>
<li>
<p>Copy the public key to the KVM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ssh-copy-id <em>root@kvm.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>Exit the bash shell for the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre>$ exit</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>libvirt-client</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># apt install libvirt-client</pre>
</div>
</div>
</li>
<li>
<p>Test the connection to the KVM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su foreman -s /bin/bash -c 'virsh -c qemu+ssh://root@kvm.example.com/system list'</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-kvm-connection_kvm-provisioning"><a class="anchor" href="#adding-kvm-connection_kvm-provisioning"></a>11.3. Adding a KVM connection to Foreman&#160;server</h3>
<div class="paragraph">
<p>Use this procedure to add KVM as a compute resource in Foreman.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-kvm-connection_kvm-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the new compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>Libvirt</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the connection URL to the KVM server.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> qemu+ssh://<em>root@kvm.example.com</em>/system</pre>
</div>
</div>
</li>
<li>
<p>From the <strong>Display type</strong> list, select either <strong>VNC</strong> or <strong>Spice</strong>.</p>
</li>
<li>
<p>Optional: To secure console access for new hosts with a randomly generated password, select the <strong>Set a randomly generated password on the display connection</strong> checkbox.
You can retrieve the password for the VNC console to access the guest virtual machine console on your KVM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># virsh edit <em>your_VM_name</em>
&lt;graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0' passwd='<em>your_randomly_generated_password</em>'&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The password is randomly generated every time the console for the virtual machine is opened, for example, with virt-manager.</p>
</div>
</li>
<li>
<p>Click <strong>Test Connection</strong> to ensure that Foreman&#160;server connects to the KVM server without fault.</p>
</li>
<li>
<p>Verify that the <strong>Locations</strong> and <strong>Organizations</strong> tabs are automatically set to your current context.
If you want, add additional contexts to these tabs.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the KVM connection.</p>
</li>
</ol>
</div>
<div id="cli-adding-kvm-connection_kvm-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a compute resource, enter the <code>hammer compute-resource create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource create --name "<em>My_KVM_Server</em>" \
--provider "Libvirt" --description "KVM server at <em>kvm.example.com</em>" \
--url "qemu+ssh://root@<em>kvm.example.com/system</em>" --locations "New York" \
--organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-images-to-server_kvm-provisioning"><a class="anchor" href="#adding-images-to-server_kvm-provisioning"></a>11.4. Adding KVM images to Foreman&#160;server</h3>
<div class="paragraph">
<p>To create hosts using image-based provisioning, you must add information about the image, such as access details and the image location, to your Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>Note that you can manage only directory pool storage types through Foreman.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-images-to-server_kvm-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click the name of the KVM connection.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>In the <strong>Image path</strong> field, enter the full path that points to the image on the KVM server.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> /var/lib/libvirt/images/TestImage.qcow2</pre>
</div>
</div>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the image supports user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-images-to-server_kvm-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Use the <code>--uuid</code> field to store the full path of the image location on the KVM server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource image create \
--name "<em>KVM Image</em>" \
--compute-resource "<em>My_KVM_Server</em>"
--operatingsystem "RedHat <em>version</em>" \
--architecture "x86_64" \
--username root \
--user-data false \
--uuid "/var/lib/libvirt/images/<em>KVMimage</em>.qcow2" \</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-kvm-details-to-a-compute-profile_kvm-provisioning"><a class="anchor" href="#adding-kvm-details-to-a-compute-profile_kvm-provisioning"></a>11.5. Adding KVM details to a compute profile</h3>
<div class="paragraph">
<p>Use this procedure to add KVM hardware settings to a compute profile.
When you create a host on KVM using this compute profile, these settings are automatically populated.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-kvm-details-to-a-compute-profile_kvm-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>In the Compute Profiles window, click the name of an existing compute profile, or click <strong>Create Compute Profile</strong>, enter a <strong>Name</strong>, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the KVM compute resource.</p>
</li>
<li>
<p>In the <strong>CPUs</strong> field, enter the number of CPUs to allocate to the new host.</p>
</li>
<li>
<p>In the <strong>Memory</strong> field, enter the amount of memory to allocate to the new host.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use if performing image-based provisioning.</p>
</li>
<li>
<p>From the <strong>Network Interfaces</strong> list, select the network parameters for the host&#8217;s network interface.
You can create multiple network interfaces.
However, at least one interface must point to a Smart&#160;Proxy-managed network.</p>
</li>
<li>
<p>In the <strong>Storage</strong> area, enter the storage parameters for the host.
You can create multiple volumes for the host.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the settings to the compute profile.</p>
</li>
</ol>
</div>
<div id="cli-adding-kvm-details-to-a-compute-profile_kvm-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile create --name "<em>My_Libvirt_Compute_Profile</em>"</pre>
</div>
</div>
</li>
<li>
<p>Add values to your compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile values create \
--compute-attributes "cpus=1,memory=1073741824" \
--compute-profile "<em>My_Libvirt_Compute_Profile</em>" \
--compute-resource "<em>My_KVM_Server</em>" \
--interface "compute_type=network,compute_model=virtio,compute_network=<em>examplenetwork</em>" \
--volume "pool_name=default,capacity=20G,format_type=qcow2"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-network-or-image-based-hosts_kvm-provisioning"><a class="anchor" href="#creating-network-or-image-based-hosts_kvm-provisioning"></a>11.6. Creating hosts on KVM</h3>
<div class="paragraph">
<p>In Foreman, you can use KVM provisioning to create hosts over a network connection or from an existing image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you want to create a host over a network connection, the new host must be able to access your Foreman&#160;server or Smart&#160;Proxy&#160;servers on a KVM virtual network, so that the host has access to PXE provisioning services.
This new host entry triggers the KVM server to create and start a virtual machine.
If the virtual machine detects the defined Smart&#160;Proxy&#160;server through the virtual network, the virtual machine boots to PXE and begins to install the chosen operating system.</p>
</li>
<li>
<p>If you want to create a host with an existing image, the new host entry triggers the KVM server to create the virtual machine using a pre-existing image as a basis for the new volume.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-network-or-image-based-hosts_kvm-provisioning">CLI procedure</a>.</p>
</div>
<div class="paragraph">
<div class="title">DHCP conflicts</div>
<p>For network-based provisioning, if you use a virtual network on the KVM server for provisioning, select a network that does not provide DHCP assignments.
This causes DHCP conflicts with Foreman&#160;server when booting new hosts.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the KVM connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine settings.
The KVM-specific fields are populated with settings from your compute profile.
Modify these settings if required.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
KVM assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>Select the <strong>Provisioning Method</strong> that you want to use:</p>
<div class="ulist">
<ul>
<li>
<p>For network-based provisioning, click <strong>Network Based</strong>.</p>
</li>
<li>
<p>For image-based provisioning, click <strong>Image Based</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div id="cli-creating-network-or-image-based-hosts_kvm-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To use network-based provisioning, create the host with the <code>hammer host create</code> command and include <code>--provision-method build</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--build true \
--compute-attributes="cpus=1,memory=1073741824" \
--compute-resource "<em>My_KVM_Server</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--interface "managed=true,primary=true,provision=true,compute_type=network,compute_network=<em>examplenetwork</em>" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>" \
--provision-method "build" \
--root-password "<em>My_Password</em>" \
--volume="pool_name=default,capacity=20G,format_type=qcow2"</pre>
</div>
</div>
</li>
<li>
<p>To use image-based provisioning, create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--compute-attributes="cpus=1,memory=1073741824" \
--compute-resource "<em>My_KVM_Server</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--image "<em>My_KVM_Image</em>" \
--interface "managed=true,primary=true,provision=true,compute_type=network,compute_network=examplenetwork" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>" \
--provision-method "image" \
--volume="pool_name=default,capacity=20G,format_type=qcow2"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_in_VMware_vmware-provisioning"><a class="anchor" href="#Provisioning_Virtual_Machines_in_VMware_vmware-provisioning"></a>12. Provisioning virtual machines in VMware vSphere</h2>
<div class="sectionbody">
<div class="paragraph">
<p>VMware vSphere is an enterprise-level virtualization platform from VMware.
Foreman can interact with the vSphere platform, including creating new virtual machines and controlling their power management states.</p>
</div>
<div class="sect2">
<h3 id="Installing_VMware_plugin_vmware-provisioning"><a class="anchor" href="#Installing_VMware_plugin_vmware-provisioning"></a>12.1. Installing VMware plugin</h3>
<div class="paragraph">
<p>Install the VMware plugin to attach the VMware compute resource provider to Foreman.
You can use the VMware provider to manage and deploy hosts to VMware.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Install the VMware compute resource provider on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-compute-vmware</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong>.</p>
</li>
<li>
<p>On the <strong>System Status</strong> card, select the <strong>Available Providers</strong> tab to verify that the VMware provider is installed.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Prerequisites_for_VMware_Provisioning_vmware-provisioning"><a class="anchor" href="#Prerequisites_for_VMware_Provisioning_vmware-provisioning"></a>12.2. Prerequisites for VMware provisioning</h3>
<div class="paragraph">
<p>The requirements for VMware vSphere provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A supported version of VMware vCenter Server.
The following versions have been fully tested with Foreman:</p>
<div class="ulist">
<ul>
<li>
<p>vCenter Server 8.0</p>
</li>
<li>
<p>vCenter Server 7.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>A Smart&#160;Proxy&#160;server managing a network on the vSphere environment.
Ensure no other DHCP services run on this network to avoid conflicts with Smart&#160;Proxy&#160;server.
For more information, see <a href="#preparing-networking">Preparing networking</a>.</p>
</li>
<li>
<p>An existing VMware template if you want to use image-based provisioning.</p>
</li>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Creating_a_VMware_User_vmware-provisioning"><a class="anchor" href="#Creating_a_VMware_User_vmware-provisioning"></a>12.3. Creating a VMware user</h3>
<div class="paragraph">
<p>The VMware vSphere server requires an administration-like user for Foreman&#160;server communication.
For security reasons, do not use the <code>administrator</code> user for such communication.
Instead, create a user with the required privileges.</p>
</div>
<div class="paragraph">
<p>In VMware vCenter Server version 8.0 or 7.0, set the following privileges:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All Privileges &#8594; Datastore &#8594; Allocate Space, Browse datastore, Update Virtual Machine files, Low level file operations</p>
</li>
<li>
<p>All Privileges &#8594; Network &#8594; Assign Network</p>
</li>
<li>
<p>All Privileges &#8594; Resource &#8594; Assign virtual machine to resource pool</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Change Config (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Interaction (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Edit Inventory (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Provisioning (All)</p>
</li>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Guest Operations (All)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, if you want to create virtual machines with a Virtual Trusted Platform Module (TPM) for enhanced security, set the following privileges:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All Privileges &#8594; Cryptographic operations &#8594; Clone, Encrypt, Encrypt new, Migrate, Register VM</p>
</li>
<li>
<p>All Privileges &#8594; Cryptographic operations &#8594; Direct Access &#8211; required to open a console session</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, if you want to take snapshots of virtual machines by using the Snapshot Management plugin, set the following privileges:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All Privileges &#8594; Virtual Machine &#8594; Snapshot management (All)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_VMware_Connection_to_Server_vmware-provisioning"><a class="anchor" href="#Adding_a_VMware_Connection_to_Server_vmware-provisioning"></a>12.4. Adding a VMware connection to Foreman&#160;server</h3>
<div class="paragraph">
<p>Use this procedure to add a VMware vSphere connection in Foreman&#160;server&#8217;s compute resources.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-vmware-vsphere-connection_vmware-provisioning">CLI procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the host and network-based firewalls are configured to allow communication from Foreman&#160;server to vCenter on TCP port 443.</p>
</li>
<li>
<p>Verify that Foreman&#160;server and vCenter can resolve each other&#8217;s host names.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>, and in the Compute Resources window, click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>VMware</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the resource.</p>
</li>
<li>
<p>In the <strong>VCenter/Server</strong> field, enter the IP address or host name of the vCenter server.</p>
</li>
<li>
<p>In the <strong>User</strong> field, enter the user name with permission to access the vCenter&#8217;s resources.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the password for the user.</p>
</li>
<li>
<p>Click <strong>Load Datacenters</strong> to populate the list of data centers from your VMware vSphere environment.</p>
</li>
<li>
<p>From the <strong>Datacenter</strong> list, select a specific data center to manage from this list.</p>
</li>
<li>
<p>In the <strong>Fingerprint</strong> field, ensure that this field is populated with the fingerprint from the data center.</p>
</li>
<li>
<p>From the <strong>Display Type</strong> list, select a console type, for example, <strong>VNC</strong> or <strong>VMRC</strong>.
Note that VNC consoles are unsupported on VMware ESXi 6.5 and later.</p>
</li>
<li>
<p>Optional: In the <strong>VNC Console Passwords</strong> field, select the <strong>Set a randomly generated password on the display connection</strong> checkbox to secure console access for new hosts with a randomly generated password.</p>
</li>
<li>
<p>From the <strong>Enable Caching</strong> list, you can select whether to enable caching of compute resources.
For more information, see <a href="#Caching_of_Compute_Resources_vmware-provisioning">Caching of compute resources</a>.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> and <strong>Organizations</strong> tabs and verify that the values are automatically set to your current context.
You can also add additional contexts.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the connection.</p>
</li>
</ol>
</div>
<div id="cli-adding-vmware-vsphere-connection_vmware-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the connection with the <code>hammer compute-resource create</code> command.
Select <code>Vmware</code> as the <code>--provider</code> and set the instance UUID of the data center as the <code>--uuid</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource create \
--datacenter "<em>My_Data_Center</em>" \
--description "vSphere server at <em>vsphere.example.com</em>" \
--locations "<em>My_Location</em>" \
--name "My_vSphere" \
--organizations "<em>My_Organization</em>" \
--password "<em>My_Password</em>" \
--provider "Vmware" \
--server "<em>vsphere.example.com</em>" \
--user "<em>My_User</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_VMware_Images_to_Server_vmware-provisioning"><a class="anchor" href="#Adding_VMware_Images_to_Server_vmware-provisioning"></a>12.5. Adding VMware images to Foreman&#160;server</h3>
<div class="paragraph">
<p>VMware vSphere uses templates as images for creating new virtual machines.
If using image-based provisioning to create new hosts, you need to add VMware template details to your Foreman&#160;server.
This includes access details and the template name.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-vmware-vsphere-images-to-server_vmware-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your VMware compute resource.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
By default, this is set to <code>root</code>.</p>
</li>
<li>
<p>If your image supports user data input such as <code>cloud-init</code> data, click the <strong>User data</strong> checkbox.</p>
</li>
<li>
<p>Optional: In the <strong>Password</strong> field, enter the SSH password to access the image.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select an image from VMware.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-vmware-vsphere-images-to-server_vmware-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Use the <code>--uuid</code> field to store the relative template path on the vSphere environment:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource image create \
--architecture "<em>My_Architecture</em>" \
--compute-resource "<em>My_VMware</em>"
--name "<em>My_Image</em>" \
--operatingsystem "<em>My_Operating_System</em>" \
--username root \
--uuid "<em>My_UUID</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_VMware_Details_to_a_Compute_Profile_vmware-provisioning"><a class="anchor" href="#Adding_VMware_Details_to_a_Compute_Profile_vmware-provisioning"></a>12.6. Adding VMware details to a compute profile</h3>
<div class="paragraph">
<p>You can predefine certain hardware settings for virtual machines on VMware vSphere.
You achieve this through adding these hardware settings to a compute profile.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-Adding_VMware_Details_to_a_Compute_Profile_vmware-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>Select a compute profile.</p>
</li>
<li>
<p>Select a VMware compute resource.</p>
</li>
<li>
<p>In the <strong>CPUs</strong> field, enter the number of CPUs to allocate to the host.</p>
</li>
<li>
<p>In the <strong>Cores per socket</strong> field, enter the number of cores to allocate to each CPU.</p>
</li>
<li>
<p>In the <strong>Memory</strong> field, enter the amount of memory in MiB to allocate to the host.</p>
</li>
<li>
<p>In the <strong>Firmware</strong> field, select the firmware type for the host.
By default, this is set to <strong>Automatic</strong>.</p>
</li>
<li>
<p>In the <strong>Cluster</strong> list, select the name of the target host cluster on the VMware environment.</p>
</li>
<li>
<p>From the <strong>Resource pool</strong> list, select an available resource allocations for the host.</p>
</li>
<li>
<p>In the <strong>Folder</strong> list, select the folder to organize the host.</p>
</li>
<li>
<p>From the <strong>Guest OS</strong> list, select the operating system you want to use in VMware vSphere.</p>
</li>
<li>
<p>From the <strong>Virtual H/W version</strong> list, select the underlying VMware hardware abstraction to use for virtual machines.</p>
</li>
<li>
<p>If you want to add more memory while the virtual machine is powered on, select the <strong>Memory hot add</strong> checkbox.</p>
</li>
<li>
<p>If you want to add more CPUs while the virtual machine is powered on, select the <strong>CPU hot add</strong> checkbox.</p>
</li>
<li>
<p>If you want to add a CD-ROM drive, select the <strong>CD-ROM drive</strong> checkbox.</p>
</li>
<li>
<p>From the <strong>Boot order</strong> list, define the order in which the virtual machines tried to boot.</p>
</li>
<li>
<p>Optional: In the <strong>Annotation Notes</strong> field, enter an arbitrary description.</p>
</li>
<li>
<p>If you use image-based provisioning, select the image from the <strong>Image</strong> list.</p>
</li>
<li>
<p>From the <strong>SCSI controller</strong> list, select the disk access method for the host.</p>
</li>
<li>
<p>If you want to use eager zero thick provisioning, select the <strong>Eager zero</strong> checkbox.
By default, the disk uses lazy zero thick provisioning.</p>
</li>
<li>
<p>Optional: Select <strong>Virtual TPM</strong> if you want to add a Virtual Trusted Platform Module for enhanced security.
This is compatible with UEFI firmware only.</p>
</li>
<li>
<p>From the <strong>Network Interfaces</strong> list, select the network parameters for the host&#8217;s network interface.
At least one interface must point to a Smart&#160;Proxy-managed network.</p>
</li>
<li>
<p>Optional: Click <strong>Add Interface</strong> to create another network interfaces.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div id="cli-Adding_VMware_Details_to_a_Compute_Profile_vmware-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile create --name "<em>My_Compute_Profile</em>"</pre>
</div>
</div>
</li>
<li>
<p>Set VMware details to a compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile values create \
--compute-attributes "cpus=1,corespersocket=2,memory_mb=1024,cluster=MyCluster,path=MyVMs,virtual_tpm=true,start=true" \
--compute-profile "<em>My_Compute_Profile</em>" \
--compute-resource "<em>My_VMware</em>" \
--interface "compute_type=VirtualE1000,compute_network=mynetwork \
--volume "size_gb=20G,datastore=Data,name=myharddisk,thin=true"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Hosts_on_VMware_vmware-provisioning"><a class="anchor" href="#Creating_Hosts_on_VMware_vmware-provisioning"></a>12.7. Creating hosts on VMware</h3>
<div class="paragraph">
<p>The VMware vSphere provisioning process provides the option to create hosts over a network connection or using an existing image.</p>
</div>
<div class="paragraph">
<p>For network-based provisioning, you must create a host to access either Foreman&#160;server or Smart&#160;Proxy&#160;servers on a VMware vSphere virtual network, so that the host has access to PXE provisioning services.
The new host entry triggers the VMware vSphere server to create the virtual machine.
If the virtual machine detects the defined Smart&#160;Proxy through the virtual network, the virtual machine boots to PXE and begins to install the chosen operating system.</p>
</div>
<div class="paragraph">
<div class="title">DHCP conflicts</div>
<p>If you use a virtual network on the VMware vSphere server for provisioning, ensure that you select a virtual network that does not provide DHCP assignments.
This causes DHCP conflicts with Foreman&#160;server when booting new hosts.</p>
</div>
<div class="paragraph">
<p>For image-based provisioning, use the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-hosts-on-vmware-vsphere_vmware-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the VMware vSphere connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine-based settings.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
VMware assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the interface window, review the VMware-specific fields that are populated with settings from our compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>Select the Provisioning Method that you want:</p>
<div class="ulist">
<ul>
<li>
<p>For network-based provisioning, click <strong>Network Based</strong>.</p>
</li>
<li>
<p>For image-based provisioning, click <strong>Image Based</strong>.</p>
</li>
<li>
<p>If the <code>foreman_bootdisk</code> plugin is installed, and you want to use boot-disk provisioning, click <strong>Boot disk based</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your requirements.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to provision your host on VMware.</p>
</li>
</ol>
</div>
<div id="cli-creating-hosts-on-vmware-vsphere_vmware-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host from a network with the <code>hammer host create</code> command and include <code>--provision-method build</code> to use network-based provisioning:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--build true \
--compute-attributes="cpus=1,corespersocket=2,memory_mb=1024,cluster=MyCluster,path=MyVMs,start=true" \
--compute-resource "<em>My_VMware</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--interface "managed=true,primary=true,provision=true,compute_type=VirtualE1000,compute_network=mynetwork" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host</em>" \
--organization "<em>My_Organization</em>" \
--provision-method build \
--volume="size_gb=20G,datastore=Data,name=myharddisk,thin=true"</pre>
</div>
</div>
</li>
<li>
<p>Create the host from an image with the <code>hammer host create</code> command and include <code>--provision-method image</code> to use image-based provisioning:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--compute-attributes="cpus=1,corespersocket=2,memory_mb=1024,cluster=MyCluster,path=MyVMs,start=true" \
--compute-resource "<em>My_VMware</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--image "<em>My_VMware_Image</em>" \
--interface "managed=true,primary=true,provision=true,compute_type=VirtualE1000,compute_network=mynetwork" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host</em>" \
--organization "<em>My_Organization</em>" \
--provision-method image \
--volume="size_gb=20G,datastore=Data,name=myharddisk,thin=true"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="Using_VMware_Cloud_Init_and_Userdata_Templates_for_Provisioning_vmware-provisioning"><a class="anchor" href="#Using_VMware_Cloud_Init_and_Userdata_Templates_for_Provisioning_vmware-provisioning"></a>12.8. Using VMware cloud-init and userdata templates for provisioning</h3>
<div class="paragraph">
<p>You can use VMware with the <code>Cloud-init</code> and <code>Userdata</code> templates to insert user data into the new virtual machine, to make further VMware customization, and to enable the VMware-hosted virtual machine to call back to Foreman.</p>
</div>
<div class="paragraph">
<p>You can use the same procedures to set up a VMware compute resource within Foreman, with a few modifications to the workflow.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/common/user-data-sequence-foreman.svg" alt="VMware template provisioning">
</div>
<div class="title">Figure 4. VMware cloud-init provisioning overview</div>
</div>
<div class="paragraph">
<p>When you set up the compute resource and images for VMware provisioning in Foreman, the following sequence of provisioning events occurs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user provisions one or more virtual machines using the Foreman web UI, API, or hammer</p>
</li>
<li>
<p>Foreman calls the VMware vCenter to clone the virtual machine template</p>
</li>
<li>
<p>Foreman <code>userdata</code> provisioning template adds customized identity information</p>
</li>
<li>
<p>When provisioning completes, the <code>Cloud-init</code> provisioning template instructs the virtual machine to call back to Smart&#160;Proxy when <code>cloud-init</code> runs</p>
</li>
<li>
<p>VMware vCenter clones the template to the virtual machine</p>
</li>
<li>
<p>VMware vCenter applies customization for the virtual machine&#8217;s identity, including the host name, IP, and DNS</p>
</li>
<li>
<p>The virtual machine builds, <code>cloud-init</code> is invoked and calls back Foreman on port <code>80</code>, which then redirects to <code>443</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure port and firewall settings to open any necessary connections.
Because of the <code>cloud-init</code> service, the virtual machine always calls back to Foreman even if you register the virtual machine to Smart&#160;Proxy.
For more information, see <a href="https://docs.theforeman.org/nightly/Installing_Server/index-foreman-deb.html#Port_and_firewall_requirements_foreman">Port and firewall requirements</a> in <em>Installing Foreman&#160;Server nightly on Debian/Ubuntu</em> and <a href="https://docs.theforeman.org/nightly/Installing_Proxy/index-foreman-deb.html#smart-proxy-port-and-firewall-requirements_smart-proxy">Port and firewall requirements</a> in <em>Installing a Smart&#160;Proxy&#160;Server nightly on Debian/Ubuntu</em>.</p>
</li>
<li>
<p>If you want to use Smart&#160;Proxy&#160;servers instead of your Foreman&#160;server, ensure that you have configured your Smart&#160;Proxy&#160;servers accordingly.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>It is essential to add your Smart&#160;Proxy&#160;server to the list of trusted proxies on Foreman&#160;server!</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Back up the following configuration files:</p>
<div class="ulist">
<ul>
<li>
<p><code>/etc/cloud/cloud.cfg.d/01_network.cfg</code></p>
</li>
<li>
<p><code>/etc/cloud/cloud.cfg.d/10_datasource.cfg</code></p>
</li>
<li>
<p><code>/etc/cloud/cloud.cfg</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Associating the <code>Userdata</code> and <code>Cloud-init</code> templates with the operating system</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>Search for the <strong>CloudInit default</strong> template and click its name.</p>
</li>
<li>
<p>Click the <strong>Association</strong> tab.</p>
</li>
<li>
<p>Select all operating systems to which the template applies and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Repeat the steps above for the <strong>UserData open-vm-tools</strong> template.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong>.</p>
</li>
<li>
<p>Select the operating system that you want to use for provisioning.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab.</p>
</li>
<li>
<p>From the <strong>Cloud-init template</strong> list, select <strong>CloudInit default</strong>.</p>
</li>
<li>
<p>From the <strong>User data template</strong> list, select <strong>UserData open-vm-tools</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Preparing an image to use the cloud-init template</div>
<p>To prepare an image, you must first configure the settings that you require on a virtual machine that you can then save as an image to use in Foreman.</p>
</div>
<div class="paragraph">
<p>To use the <code>cloud-init</code> template for provisioning, you must configure a virtual machine so that <code>cloud-init</code> is installed, enabled, and configured to call back to Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>For security purposes, you must install a CA certificate to use HTTPS for all communication.
This procedure includes steps to clean the virtual machine so that no unwanted information transfers to the image you use for provisioning.</p>
</div>
<div class="paragraph">
<p>If you have an image with <code>cloud-init</code>, you must still follow this procedure to enable <code>cloud-init</code> to communicate with Foreman because <code>cloud-init</code> is disabled by default.</p>
</div>
<div class="paragraph">
<p>These instructions are for Enterprise Linux or Fedora, follow similar steps for other Linux distributions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the virtual machine that you use to create the image, install the required packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install cloud-init open-vm-tools perl-interpreter perl-File-Temp</pre>
</div>
</div>
<div class="paragraph">
<p>On Enterprise Linux 9, you also require the <code>dbus-tools</code> package for network connectivity.</p>
</div>
</li>
<li>
<p>Disable network configuration by <code>cloud-init</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat &lt;&lt; EOM &gt; /etc/cloud/cloud.cfg.d/01_network.cfg
network:
  config: disabled
EOM</pre>
</div>
</div>
</li>
<li>
<p>Configure <code>cloud-init</code> to fetch data from Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat &lt;&lt; EOM &gt; /etc/cloud/cloud.cfg.d/10_datasource.cfg
datasource_list: [NoCloud]
datasource:
  NoCloud:
    seedfrom: https://foreman.example.com/userdata/
EOM</pre>
</div>
</div>
<div class="paragraph">
<p>If you intend to provision through Smart&#160;Proxy&#160;server, use the URL of your Smart&#160;Proxy&#160;server in the <code>seedfrom</code> option, such as <code>https://<em>smartproxy.example.com</em>:8443/userdata/</code>.</p>
</div>
</li>
<li>
<p>Configure modules to use in <code>cloud-init</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat &lt;&lt; EOM &gt; /etc/cloud/cloud.cfg
cloud_init_modules:
 - bootcmd
 - ssh

cloud_config_modules:
 - runcmd

cloud_final_modules:
 - scripts-per-once
 - scripts-per-boot
 - scripts-per-instance
 - scripts-user
 - phone-home

system_info:
  distro: rhel
  paths:
    cloud_dir: /var/lib/cloud
    templates_dir: /etc/cloud/templates
  ssh_svcname: sshd
EOM</pre>
</div>
</div>
</li>
<li>
<p>Copy the CA certificate from the Apache configuration to <code>/etc/pki/ca-trust/source/anchors/cloud-init-ca.crt</code>.</p>
</li>
<li>
<p>Update the record of certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># update-ca-trust extract</pre>
</div>
</div>
</li>
<li>
<p>Stop the <code>rsyslog</code> and <code>auditd</code> services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl stop rsyslog
# systemctl stop auditd</pre>
</div>
</div>
</li>
<li>
<p>Clean packages on the image:</p>
<div class="ulist">
<ul>
<li>
<p>On Enterprise Linux 8 and later:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf remove --oldinstallonly</pre>
</div>
</div>
</li>
<li>
<p>On Enterprise Linux 7 and earlier:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># package-cleanup --oldkernels --count=1
# dnf clean all</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Reduce logspace, remove old logs, and truncate logs:</p>
<div class="listingblock">
<div class="content">
<pre># logrotate -f /etc/logrotate.conf
# rm -f /var/log/*-???????? /var/log/*.gz
# rm -f /var/log/dmesg.old
# rm -rf /var/log/anaconda
# cat /dev/null &gt; /var/log/audit/audit.log
# cat /dev/null &gt; /var/log/wtmp
# cat /dev/null &gt; /var/log/lastlog
# cat /dev/null &gt; /var/log/grubby</pre>
</div>
</div>
</li>
<li>
<p>Remove <code>udev</code> hardware rules:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -f /etc/udev/rules.d/70*</pre>
</div>
</div>
</li>
<li>
<p>Remove the <code>ifcfg</code> scripts related to existing network configurations:</p>
<div class="listingblock">
<div class="content">
<pre># rm -f /etc/sysconfig/network-scripts/ifcfg-ens*
# rm -f /etc/sysconfig/network-scripts/ifcfg-eth*</pre>
</div>
</div>
</li>
<li>
<p>Remove the SSH host keys:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -f /etc/ssh/ssh_host_*</pre>
</div>
</div>
</li>
<li>
<p>Remove root user&#8217;s SSH history:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -rf ~root/.ssh/known_hosts</pre>
</div>
</div>
</li>
<li>
<p>Remove root user&#8217;s shell history:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -f ~root/.bash_history
# unset HISTFILE</pre>
</div>
</div>
</li>
<li>
<p>Create an image from this virtual machine.</p>
</li>
<li>
<p><a href="#Adding_VMware_Images_to_Server_vmware-provisioning">Add your image to Foreman</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_VM_on_VMware_vmware-provisioning"><a class="anchor" href="#Deleting_a_VM_on_VMware_vmware-provisioning"></a>12.9. Deleting a VM on VMware</h3>
<div class="paragraph">
<p>You can delete VMs running on VMware from within Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure &gt; Compute Resources</strong>.</p>
</li>
<li>
<p>Select your VMware provider.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Delete</strong> from the <strong>Actions</strong> menu.
This deletes the virtual machine from the VMware compute resource while retaining any associated hosts within Foreman.
If you want to delete the orphaned host, navigate to <strong>Hosts &gt; All Hosts</strong> and delete the host manually.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting a host entry associated with a virtual machine does not destroy the virtual machine on the compute resource.</p>
</div>
<div class="paragraph">
<p>To change the default behavior, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and set <strong>Destroy associated VM on host delete</strong> to <strong>Yes</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Importing-a_virtual-machine-from-VMware-into-foreman_vmware-provisioning"><a class="anchor" href="#Importing-a_virtual-machine-from-VMware-into-foreman_vmware-provisioning"></a>12.10. Importing a virtual machine from VMware into Foreman</h3>
<div class="paragraph">
<p>You can import existing virtual machines running on VMware into Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your VMware compute resource.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Import as managed Host</strong> or <strong>Import as unmanaged Host</strong> from the <strong>Actions</strong> menu.
The following page looks identical to creating a host with the compute resource being already selected.
For more information, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#Creating_a_Host_managing-hosts">Creating a host in Foreman</a> in <em>Managing hosts</em>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to import the virtual machine into Foreman.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Caching_of_Compute_Resources_vmware-provisioning"><a class="anchor" href="#Caching_of_Compute_Resources_vmware-provisioning"></a>12.11. Caching of compute resources</h3>
<div class="paragraph">
<p>Caching of compute resources speeds up rendering of VMware information.</p>
</div>
<div class="sect3">
<h4 id="Enabling_Caching_of_Compute_Resources_vmware-provisioning"><a class="anchor" href="#Enabling_Caching_of_Compute_Resources_vmware-provisioning"></a>12.11.1. Enabling caching of compute resources</h4>
<div class="paragraph">
<p>To enable or disable caching of compute resources:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Click the <strong>Edit</strong> button to the right of the VMware server you want to update.</p>
</li>
<li>
<p>Select the <strong>Enable caching</strong> checkbox.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Refreshing_the_Compute_Resources_Cache_vmware-provisioning"><a class="anchor" href="#Refreshing_the_Compute_Resources_Cache_vmware-provisioning"></a>12.11.2. Refreshing the compute resources cache</h4>
<div class="paragraph">
<p>Refresh the cache of compute resources to update compute resources information.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select a VMware server you want to refresh the compute resources cache for and click <strong>Refresh Cache</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Use this API call to refresh the compute resources cache:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl -H "Accept:application/json" \
-H "Content-Type:application/json" -X PUT \
-u <em>username</em>:<em>password</em> -k \
https://<em>foreman.example.com</em>/api/compute_resources/<em>compute_resource_id</em>/refresh_cache</pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>hammer compute-resource list</code> to determine the ID of the VMware server you want to refresh the compute resources cache for.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_in_Proxmox_proxmox-provisioning"><a class="anchor" href="#Provisioning_Virtual_Machines_in_Proxmox_proxmox-provisioning"></a>13. Provisioning virtual machines in Proxmox</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Proxmox Virtual Environment is an open-source server management platform for enterprise virtualization.
Proxmox tightly integrates the KVM hypervisor and Linux Containers (LXC).
Foreman can interact with Proxmox, including creating virtual machines and controlling their power management states.</p>
</div>
<div class="paragraph">
<p>Foreman supports Proxmox 7, 8, and 9.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting a host entry associated with a virtual machine does not destroy the virtual machine on the compute resource.</p>
</div>
<div class="paragraph">
<p>To change the default behavior, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and set <strong>Destroy associated VM on host delete</strong> to <strong>Yes</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="Installing_the_Proxmox_plugin_proxmox-provisioning"><a class="anchor" href="#Installing_the_Proxmox_plugin_proxmox-provisioning"></a>13.1. Installing the Proxmox plugin</h3>
<div class="paragraph">
<p>Install the Proxmox plugin to attach a Proxmox compute resource provider to Foreman.
This allows you to manage and deploy hosts to Proxmox.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the Proxmox plugin on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-proxmox</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong> and select the <strong>Compute Resources</strong> tab to verify the installation of the Proxmox plugin.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Proxmox_Connection_to_foreman_proxmox-provisioning"><a class="anchor" href="#Adding_a_Proxmox_Connection_to_foreman_proxmox-provisioning"></a>13.2. Adding a Proxmox connection to Foreman&#160;server</h3>
<div class="paragraph">
<p>Use this procedure to add a Proxmox connection to Foreman.
If your Proxmox instance consists of multiple nodes, you have to create a Proxmox connection to Foreman for each node.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the host and network-based firewalls are configured to allow communication from Foreman to Proxmox on TCP port 443.</p>
</li>
<li>
<p>Verify that Foreman&#160;server is able to resolve the host name of your Proxmox compute resource and Proxmox is able to resolve the host name of Foreman&#160;server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>Proxmox</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>Optional: In the <strong>Authentication method</strong> list, select <code>User token</code> if you do not want to use access tickets to authenticate on Proxmox.</p>
</li>
<li>
<p>In the <strong>Url</strong> field, enter the IP address or host name of your Proxmox node.
Ensure to specify its port and add <code>/api2/json</code> to its path.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the user name to access Proxmox.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the password for the user.</p>
</li>
<li>
<p>Optional: Select the <strong>SSL verify peer</strong> checkbox to verify the certificate used for the encrypted connection from Foreman to Proxmox.</p>
</li>
<li>
<p>In the <strong>X509 Certificate Authorities</strong> field, enter a certificate authority or a correctly ordered chain of certificate authorities.</p>
</li>
<li>
<p>Optional: Click <strong>Test Connection</strong> to verify the URL and its corresponding credentials.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the connection.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-proxmox-images-to-foreman-by-using-web-ui"><a class="anchor" href="#adding-proxmox-images-to-foreman-by-using-web-ui"></a>13.3. Adding Proxmox images to Foreman by using Foreman web UI</h3>
<div class="paragraph">
<p>Proxmox uses templates as images for creating virtual machines.
When you use image-based provisioning to create hosts, add Proxmox template details to your Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Proxmox compute resource.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the architecture of the operating system.</p>
</li>
<li>
<p>In the <strong>Username</strong> and <strong>Password</strong> fields, enter the credentials to access the image over SSH.</p>
</li>
<li>
<p>Select the <strong>User data</strong> checkbox if the image supports user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the name of the template in your Proxmox environment.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to add the image to Foreman.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-proxmox-images-to-foreman-by-using-cli"><a class="anchor" href="#adding-proxmox-images-to-foreman-by-using-cli"></a>13.4. Adding Proxmox images to Foreman by using Hammer CLI</h3>
<div class="paragraph">
<p>Proxmox uses templates as images for creating virtual machines.
When you use image-based provisioning to create new hosts, add Proxmox template details to your Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Optional: View all available images on Proxmox:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource image available --compute-resource "<em>My_Proxmox</em>"</pre>
</div>
</div>
</li>
<li>
<p>Add your Proxmox image to Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource image create \
--architecture "<em>My_Architecture</em>" \
--compute-resource "<em>My_Proxmox</em>" \
--name "<em>My_Image_Name</em>" \
--operatingsystem "<em>My_Operating_System</em>" \
--user-data true \
--username <em>My_User_Name</em> \
--uuid "<em>My_UUID</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify that the Proxmox image is present on your Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource image list --compute-resource "<em>My_Proxmox</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Proxmox_Details_to_a_Compute_Profile_proxmox-provisioning"><a class="anchor" href="#Adding_Proxmox_Details_to_a_Compute_Profile_proxmox-provisioning"></a>13.5. Adding Proxmox details to a compute profile</h3>
<div class="paragraph">
<p>You can predefine certain hardware settings for virtual machines on Proxmox.
You achieve this through adding these hardware settings to a compute profile.</p>
</div>
<div class="paragraph">
<p>Note that this procedure assumes you are using KVM/qemu-based virtualization.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>Select a compute profile.</p>
</li>
<li>
<p>Select a Proxmox compute resource.</p>
</li>
<li>
<p>From the <strong>Type</strong> list, select a virtualization option:</p>
<div class="ulist">
<ul>
<li>
<p><strong>LXC container</strong>: Linux containers that focus on isolating applications and reusing the host kernel</p>
</li>
<li>
<p><strong>KVM/Qemu server</strong>: Kernel-based virtual machines that run their own kernel and let you boot various guest operating systems</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click the <strong>General</strong> tab.</p>
</li>
<li>
<p>From the <strong>Node</strong> list, select a Proxmox node.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select an image that is available on your Proxmox compute resource.</p>
</li>
<li>
<p>From the <strong>Pool</strong> list, select a resource allocation pool.</p>
</li>
<li>
<p>Optional: Click <strong>Advanced Options</strong>, <strong>Hardware</strong>, <strong>Network Interfaces</strong>, or <strong>Storage</strong> to configure compute profile settings.</p>
</li>
<li>
<p>On the <strong>Storage</strong> tab, Foreman community recommends to use either <code>SCSI</code> or <code>VirtIO Block</code> in the <strong>Controller</strong> field as the type of the disk controller of your host in Proxmox.</p>
</li>
<li>
<p>On the <strong>Storage</strong> tab, Foreman community does not recommend caching.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Hosts_on_Proxmox_proxmox-provisioning"><a class="anchor" href="#Creating_Hosts_on_Proxmox_proxmox-provisioning"></a>13.6. Creating hosts on Proxmox</h3>
<div class="paragraph">
<p>The Proxmox provisioning process provides the option to create hosts over a network connection or using an existing image.</p>
</div>
<div class="paragraph">
<p>For network-based provisioning, you must create a host to access either Foreman&#160;server or Smart&#160;Proxy&#160;servers on a Proxmox virtual network, so that the host has access to PXE provisioning services.
The new host entry triggers the Proxmox node to create the virtual machine.
If the virtual machine detects the defined Smart&#160;Proxy through the virtual network, the virtual machine boots to PXE and begins to install the chosen operating system.</p>
</div>
<div class="paragraph">
<div class="title">DHCP conflicts</div>
<p>If you use a virtual network on the Proxmox node for provisioning, ensure that you select a virtual network that does not provide DHCP assignments.
This causes DHCP conflicts with Foreman&#160;server when booting new hosts.</p>
</div>
<div class="paragraph">
<p>For image-based provisioning, use the pre-existing image as a basis for the new volume.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you have associated the <strong>Proxmox UserData</strong> provisioning template as <strong>User data template</strong> to your operating system entry.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select your Proxmox compute resource.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine-based settings.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
Proxmox assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>On the <strong>Operating System</strong> tab, confirm that all fields automatically contain values.</p>
</li>
<li>
<p>Select the Provisioning Method that you want:</p>
<div class="ulist">
<ul>
<li>
<p>For network-based provisioning, click <strong>Network Based</strong>.</p>
</li>
<li>
<p>For image-based provisioning, click <strong>Image Based</strong>.</p>
</li>
<li>
<p>If the <code>foreman_bootdisk</code> plugin is installed and you want to use boot-disk provisioning, click <strong>Boot disk based</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your requirements.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to provision your host on Proxmox.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_Virtual_Machine_on_Proxmox_proxmox-provisioning"><a class="anchor" href="#Deleting_a_Virtual_Machine_on_Proxmox_proxmox-provisioning"></a>13.7. Deleting a virtual machine on Proxmox</h3>
<div class="paragraph">
<p>You can delete virtual machines running on Proxmox from within Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Proxmox compute resource.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Delete</strong> from the <strong>Actions</strong> menu.
This deletes the virtual machine from your Proxmox compute resource while retaining any associated hosts within Foreman.</p>
</li>
<li>
<p>Optional: If you want to delete the orphaned host, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and delete the host manually.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting a host entry associated with a virtual machine does not destroy the virtual machine on the compute resource.</p>
</div>
<div class="paragraph">
<p>To change the default behavior, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and set <strong>Destroy associated VM on host delete</strong> to <strong>Yes</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Importing-a_virtual-machine-from-Proxmox-into-foreman_proxmox-provisioning"><a class="anchor" href="#Importing-a_virtual-machine-from-Proxmox-into-foreman_proxmox-provisioning"></a>13.8. Importing a virtual machine from Proxmox into Foreman</h3>
<div class="paragraph">
<p>You can import existing virtual machines running on Proxmox into Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Proxmox compute resource.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Import as managed Host</strong> or <strong>Import as unmanaged Host</strong> from the <strong>Actions</strong> menu.
The following page looks identical to creating a host with the compute resource being already selected.
For more information, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#Creating_a_Host_managing-hosts">Creating a host in Foreman</a> in <em>Managing hosts</em>.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to import the virtual machine into Foreman.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Remote_Console_Connection_for_a_Host_on_Proxmox_proxmox-provisioning"><a class="anchor" href="#Adding_a_Remote_Console_Connection_for_a_Host_on_Proxmox_proxmox-provisioning"></a>13.9. Adding a remote console connection for a host on Proxmox</h3>
<div class="paragraph">
<p>Use this procedure to add a remote console connection using VNC for a host on Proxmox.</p>
</div>
<div class="ulist">
<div class="title">Limitation</div>
<ul>
<li>
<p>This procedure only works for hosts based on <code>qemu</code>.
It does not work for LXC container on Proxmox.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that your host has <code>Standard VGA</code> selected from the <strong>VGA</strong> list.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Proxmox, open the required port for VNC:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port=<em>My_Port</em>/tcp --permanent</pre>
</div>
</div>
<div class="paragraph">
<p>The port is the sum of <code>5900</code> and the VMID of your host.
You can view the VMID on the <strong>VM</strong> tab for your host in the Foreman web UI.
For example, if your host has the VMID 142, open port <code>6042</code> on your Proxmox.</p>
</div>
<div class="paragraph">
<p>To enable a remote console connection for multiple hosts, open a range of ports using <code>firewall-cmd --add-port=5900-<em>My_Upper_Port_Range_Limit</em>/tcp --permanent</code>.</p>
</div>
</li>
<li>
<p>Reload the firewall configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --reload</pre>
</div>
</div>
</li>
<li>
<p>On your Proxmox, enable VNC for your host in <code>/etc/pve/nodes/<em>My_Proxmox_Instance</em>/qemu-server/<em>My_VMID</em>.conf</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">args: -vnc 0.0.0.0:_My_VMID_</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://pve.proxmox.com/wiki/VNC_Client_Access">VNC Client Access</a> in the Proxmox documentation.</p>
</div>
</li>
<li>
<p>Restart your host on Proxmox.</p>
</li>
<li>
<p>Optional: Verify that the required port for VNC is open:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># netstat -ltunp</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Virtual_Machines_Kubevirt_kubevirt-provisioning"><a class="anchor" href="#Provisioning_Virtual_Machines_Kubevirt_kubevirt-provisioning"></a>14. Provisioning virtual machines on KubeVirt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>KubeVirt addresses the needs of development teams that have adopted or want to adopt Kubernetes but possess existing virtual machine (VM) workloads that cannot be easily containerized.
This technology provides a unified development platform where developers can build, modify, and deploy applications residing in application containers and VMs in a shared environment.
These capabilities support rapid application modernization across the open hybrid cloud.</p>
</div>
<div class="paragraph">
<p>You can create a compute resource for KubeVirt so that you can provision and manage virtual machines in Kubernetes by using Foreman.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.</p>
</li>
<li>
<p>You must have <code>cluster-admin</code> permissions for the Kubernetes cluster.</p>
</li>
<li>
<p>A Smart&#160;Proxy&#160;server managing a network on the Kubernetes cluster.
Ensure that no other DHCP services run on this network to avoid conflicts with Smart&#160;Proxy&#160;server.
For more information about network service configuration for Smart&#160;Proxy&#160;servers, see <a href="https://docs.theforeman.org/nightly/Provisioning_Hosts/index-foreman-deb.html#preparing-networking">Preparing networking</a> in <em>Provisioning hosts</em>.</p>
</li>
<li>
<p>Ensure the provisioning user has the required permissions to provision hosts.
For more information, see <a href="#permissions-required-to-provision-hosts">Permissions required to provision hosts</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting a host entry associated with a virtual machine does not destroy the virtual machine on the compute resource.</p>
</div>
<div class="paragraph">
<p>To change the default behavior, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and set <strong>Destroy associated VM on host delete</strong> to <strong>Yes</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="adding-kubevirt-connection_kubevirt-provisioning"><a class="anchor" href="#adding-kubevirt-connection_kubevirt-provisioning"></a>14.1. Adding a KubeVirt connection to Foreman&#160;server</h3>
<div class="paragraph">
<p>Use this procedure to add KubeVirt as a compute resource in Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following <code>foreman-installer</code> command to enable the KubeVirt plugin for Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-kubevirt</pre>
</div>
</div>
</li>
<li>
<p>Obtain a token to use for HTTP and HTTPs authentication:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Log in to the Kubernetes cluster and list the secrets that contain tokens:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kubectl get secrets</pre>
</div>
</div>
</li>
<li>
<p>Obtain the token for your secret:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ kubectl get secrets <em>MY_SECRET</em> -o jsonpath='{.data.token}' | base64 -d | xargs</pre>
</div>
</div>
</li>
<li>
<p>Record the token to use later in this procedure.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>, and click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the new compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>KubeVirt</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>In the <strong>Hostname</strong> field, enter the FQDN, hostname, or IP address of the Kubernetes cluster.</p>
</li>
<li>
<p>In the <strong>API Port</strong> field, enter the port number that you want to use for provisioning requests from Foreman to KubeVirt.</p>
</li>
<li>
<p>In the <strong>Namespace</strong> field, enter the user name of the Kubernetes cluster.</p>
</li>
<li>
<p>In the <strong>Token</strong> field, enter the bearer token for HTTP and HTTPs authentication.</p>
</li>
<li>
<p>Optional: In the <strong>X509 Certification Authorities</strong> field, enter a certificate to enable client certificate authentication for API server calls.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Cloud_Instances_OpenStack_openstack-provisioning"><a class="anchor" href="#Provisioning_Cloud_Instances_OpenStack_openstack-provisioning"></a>15. Provisioning cloud instances on OpenStack</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenStack provides the foundation to build a private or public Infrastructure-as-a-Service (IaaS) cloud.
It offers a massively scalable, fault-tolerant platform for the development of cloud-enabled workloads.
In Foreman, you can interact with OpenStack REST API to create cloud instances and control their power management states.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.</p>
</li>
<li>
<p>A Smart&#160;Proxy&#160;server managing a network in your OpenStack environment.
For more information, see <a href="https://docs.theforeman.org/nightly/Provisioning_Hosts/index-foreman-deb.html#preparing-networking">Preparing networking</a> in <em>Provisioning hosts</em>.</p>
</li>
<li>
<p>An image added to OpenStack Image Storage (glance) service for image-based provisioning.
For more information, see the <a href="https://docs.redhat.com/en/documentation/red_hat_openstack_platform/16.0/html/instances_and_images_guide/index">OpenStack <em>Instances and Images Guide</em></a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting a host entry associated with a virtual machine does not destroy the virtual machine on the compute resource.</p>
</div>
<div class="paragraph">
<p>To change the default behavior, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and set <strong>Destroy associated VM on host delete</strong> to <strong>Yes</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="adding-openstack-connection_openstack-provisioning"><a class="anchor" href="#adding-openstack-connection_openstack-provisioning"></a>15.1. Adding a OpenStack connection to Foreman&#160;server</h3>
<div class="paragraph">
<p>You can add OpenStack as a compute resource in Foreman.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-openstack-connection_openstack-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the new compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>OpenStack</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, enter a description for the compute resource.</p>
</li>
<li>
<p>In the <strong>URL</strong> field, enter the URL for the OpenStack Authentication keystone service&#8217;s API at the <code>tokens</code> resource, such as <code>http://openstack.example.com:5000/v2.0/tokens</code> or <code>http://openstack.example.com:5000/v3/auth/tokens</code>.</p>
</li>
<li>
<p>In the <strong>Username</strong> and <strong>Password</strong> fields, enter the user authentication for Foreman to access the environment.</p>
</li>
<li>
<p>Optional: In the <strong>Project (Tenant) name</strong> field, enter the name of your tenant (v2) or project (v3) for Foreman&#160;server to manage.</p>
</li>
<li>
<p>In the <strong>User domain</strong> field, enter the user domain for v3 authentication.</p>
</li>
<li>
<p>In the <strong>Project domain name</strong> field, enter the project domain name for v3 authentication.</p>
</li>
<li>
<p>In the <strong>Project domain ID</strong> field, enter the project domain ID for v3 authentication.</p>
</li>
<li>
<p>Optional: Select <strong>Allow external network as main network</strong> to use external networks as primary networks for hosts.</p>
</li>
<li>
<p>Optional: Click <strong>Test Connection</strong> to verify that Foreman can connect to your compute resource.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> and <strong>Organizations</strong> tabs and verify that the location and organization that you want to use are set to your current context.
Add any additional contexts that you want to these tabs.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the OpenStack connection.</p>
</li>
</ol>
</div>
<div id="cli-adding-openstack-connection_openstack-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>To create a compute resource, enter the <code>hammer compute-resource create</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource create --name "<em>My_OpenStack</em>" \
--provider "OpenStack" \
--description "<em>My OpenStack environment at openstack.example.com</em>" \
--url "<em>http://openstack.example.com</em>:5000/v3/auth/tokens" \
--user "<em>My_Username</em>" --password "<em>My_Password</em>" \
--tenant "<em>My_Openstack</em>" --domain "<em>My_User_Domain</em>" \
--project-domain-id "<em>My_Project_Domain_ID</em>" \
--project-domain-name "<em>My_Project_Domain_Name</em>" \
--locations "New York" --organizations "<em>My_Organization</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-images-to-server_openstack-provisioning"><a class="anchor" href="#adding-images-to-server_openstack-provisioning"></a>15.2. Adding OpenStack images to Foreman&#160;server</h3>
<div class="paragraph">
<p>To create hosts using image-based provisioning, you must add information about the image, such as access details and the image location, to your Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-images-to-server_openstack-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click the name of the OpenStack connection.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select an image from the OpenStack compute resource.</p>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the image supports user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-images-to-server_openstack-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Use the <code>--uuid</code> field to store the full path of the image location on the OpenStack server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource image create \
--name "OpenStack Image" \
--compute-resource "<em>My_OpenStack_Platform</em>"
--operatingsystem "RedHat <em>version</em>" \
--architecture "x86_64" \
--username root \
--user-data true \
--uuid "<em>/path/to/OpenstackImage.qcow2</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="adding-openstack-details-to-a-compute-profile_openstack-provisioning"><a class="anchor" href="#adding-openstack-details-to-a-compute-profile_openstack-provisioning"></a>15.3. Adding OpenStack details to a compute profile</h3>
<div class="paragraph">
<p>Use this procedure to add OpenStack hardware settings to a compute profile.
When you create a host on OpenStack using this compute profile, these settings are automatically populated.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>In the Compute Profiles window, click the name of an existing compute profile, or click <strong>Create Compute Profile</strong>, enter a <strong>Name</strong>, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the OpenStack compute resource.</p>
</li>
<li>
<p>From the <strong>Flavor</strong> list, select the hardware profile on OpenStack to use for the host.</p>
</li>
<li>
<p>From the <strong>Availability zone</strong> list, select the target cluster to use within the OpenStack environment.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use for image-based provisioning.</p>
</li>
<li>
<p>From the <strong>Tenant</strong> list, select the tenant or project for the OpenStack instance.</p>
</li>
<li>
<p>From the <strong>Security Group</strong> list, select the cloud-based access rules for ports and IP addresses.</p>
</li>
<li>
<p>From the <strong>Internal network</strong>, select the private networks for the host to join.</p>
</li>
<li>
<p>From the <strong>Floating IP network</strong>, select the external networks for the host to join and assign a floating IP address.</p>
</li>
<li>
<p>From the <strong>Boot from volume</strong>, select whether a volume is created from the image.
If not selected, the instance boots the image directly.</p>
</li>
<li>
<p>In the <strong>New boot volume size (GB)</strong> field, enter the size, in GB, of the new boot volume.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Set OpenStack details to a compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile values create
--compute-resource "<em>My_Laptop</em>" \
--compute-profile "<em>My_Compute_Profile</em>" \
--compute-attributes "availability_zone=<em>My_Zone</em>,image_ref=<em>My_Image</em>,flavor_ref=m1.small,tenant_id=openstack,security_groups=default,network=<em>My_Network</em>,boot_from_volume=false"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-image-only-hosts_openstack-provisioning"><a class="anchor" href="#creating-image-only-hosts_openstack-provisioning"></a>15.4. Creating image-based hosts on OpenStack</h3>
<div class="paragraph">
<p>In Foreman, you can use OpenStack provisioning to create hosts from an existing image.
The new host entry triggers the OpenStack server to create the instance using the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-image-only-hosts_openstack-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the OpenStack connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine settings.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
OpenStack assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>If you want to change the image that populates automatically from your compute profile, from the <strong>Images</strong> list, select a different image to base the new host&#8217;s root volume on.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div id="cli-creating-image-only-hosts_openstack-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--compute-attributes="flavor_ref=m1.small,tenant_id=openstack,security_groups=default,network=mynetwork" \
--compute-resource "<em>My_OpenStack_Platform</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--image "<em>My_OpenStack_Image</em>" \
--interface "managed=true,primary=true,provision=true" \
--location "<em>My_Location</em>" \
--managed true \
--name "<em>My_Host_Name</em>" \
--organization "<em>My_Organization</em>" \
--provision-method image</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="provisioning-cloud-instances-on-amazon-ec2"><a class="anchor" href="#provisioning-cloud-instances-on-amazon-ec2"></a>16. Provisioning cloud instances on Amazon EC2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Amazon Elastic Compute Cloud (Amazon EC2) is a web service that provides public cloud compute resources.
Using Foreman, you can interact with Amazon EC2&#8217;s public API to create cloud instances and control their power management states.
Use the procedures in this chapter to add a connection to an Amazon EC2 account and provision a cloud instance.</p>
</div>
<div class="sect2">
<h3 id="Prerequisites_for_Amazon_EC2_Provisioning_ec2-provisioning"><a class="anchor" href="#Prerequisites_for_Amazon_EC2_Provisioning_ec2-provisioning"></a>16.1. Prerequisites for Amazon EC2 provisioning</h3>
<div class="paragraph">
<p>The requirements for Amazon EC2 provisioning include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Smart&#160;Proxy&#160;server managing a network in your EC2 environment.
Use a Virtual Private Cloud (VPC) to ensure a secure network between the hosts and Smart&#160;Proxy&#160;server.</p>
</li>
<li>
<p>An Amazon Machine Image (AMI) for image-based provisioning.</p>
</li>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Installing_Amazon_EC2_plugin_ec2-provisioning"><a class="anchor" href="#Installing_Amazon_EC2_plugin_ec2-provisioning"></a>16.2. Installing Amazon EC2 plugin</h3>
<div class="paragraph">
<p>Install the Amazon EC2 plugin to attach an EC2 compute resource provider to Foreman.
This allows you to manage and deploy hosts to EC2.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Install the EC2 compute resource provider on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-compute-ec2</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong>.</p>
</li>
<li>
<p>On the <strong>Available Providers</strong> tab, verify the installation of the Amazon EC2 plugin.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="using-an-http-proxy-to-communicate-with-amazon-ec2"><a class="anchor" href="#using-an-http-proxy-to-communicate-with-amazon-ec2"></a>16.3. Using an HTTP proxy to communicate with Amazon EC2</h3>
<div class="paragraph">
<p>If your Amazon EC2 requires an HTTP proxy to communicate with Foreman, you have to setup and select the HTTP proxy in Foreman.
If you have configured an HTTP proxy for Foreman in <strong>Administer</strong> &gt; <strong>Settings</strong>, it takes precedence over the HTTP proxy for your compute resource.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>To add an HTTP proxy to Foreman, see <a href="https://docs.theforeman.org/nightly/Managing_Content/index-foreman-deb.html#Adding_an_HTTP_Proxy_content-management">Adding an HTTP proxy</a> in <em>Managing content</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_an_Amazon_EC2_Connection_to_Server_ec2-provisioning"><a class="anchor" href="#Adding_an_Amazon_EC2_Connection_to_Server_ec2-provisioning"></a>16.4. Adding an Amazon EC2 connection to the Foreman&#160;server</h3>
<div class="paragraph">
<p>Use this procedure to add the Amazon EC2 connection in Foreman&#160;server&#8217;s compute resources.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-amazon-ec2-connection_ec2-provisioning">CLI procedure</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An AWS EC2 user performing this procedure needs the <code>AmazonEC2FullAccess</code> permissions.
You can attach these permissions from AWS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Time settings and Amazon Web Services</div>
<p>Amazon Web Services uses time settings as part of the authentication process.
Ensure that Foreman&#160;server&#8217;s time is correctly synchronized.
Ensure that an NTP service, such as <code>ntpd</code> or <code>chronyd</code>, is running properly on Foreman&#160;server.
Failure to provide the correct time to Amazon Web Services can lead to authentication failures.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and in the Compute Resources window, click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to identify the Amazon EC2 compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>EC2</strong>.</p>
</li>
<li>
<p>In the <strong>Description</strong> field, enter information that helps distinguish the resource for future use.</p>
</li>
<li>
<p>Optional: From the <strong>HTTP proxy</strong> list, select an HTTP proxy to connect to external API services.
You must add HTTP proxies to Foreman before you can select an HTTP proxy from this list.
For more information, see <a href="#using-an-http-proxy-to-communicate-with-amazon-ec2">Using an HTTP proxy to communicate with Amazon EC2</a>.</p>
</li>
<li>
<p>In the <strong>Access Key</strong> and <strong>Secret Key</strong> fields, enter the access keys for your Amazon EC2 account.
For more information, see <a href="http://docs.aws.amazon.com/general/latest/gr/managing-aws-access-keys.html">Managing Access Keys for your AWS Account</a> on the Amazon documentation website.</p>
</li>
<li>
<p>Optional: Click <strong>Load Regions</strong> to populate the <strong>Regions</strong> list.</p>
</li>
<li>
<p>From the <strong>Region</strong> list, select the Amazon EC2 region or data center to use.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab and ensure that the location you want to use is selected, or add a different location.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab and ensure that the organization you want to use is selected, or add a different organization.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the Amazon EC2 connection.</p>
</li>
<li>
<p>Select the new compute resource and then click the <strong>SSH keys</strong> tab, and click <strong>Download</strong> to save a copy of the SSH keys to use for SSH authentication.
Until <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1793138">BZ1793138</a> is resolved, you can download a copy of the SSH keys only immediately after creating the Amazon EC2 compute resource.
If you require SSH keys at a later stage, follow the procedure in <a href="#Connecting_to_an_Amazon_EC2_Instance_Using_SSH_ec2-provisioning">Connecting to an Amazon EC2 instance using SSH</a>.</p>
</li>
</ol>
</div>
<div id="cli-adding-amazon-ec2-connection_ec2-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the connection with the <code>hammer compute-resource create</code> command.
Use <code>--user</code> and <code>--password</code> options to add the access key and secret key respectively.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource create \
--description "Amazon EC2 Public Cloud` \
--locations "<em>My_Location</em>" \
--name "<em>My_EC2_Compute_Resource</em>" \
--organizations "<em>My_Organization</em>" \
--password "<em>My_Secret_Key</em>" \
--provider "EC2" \
--region "<em>My_Region</em>" \
--user "<em>My_User_Name</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Creating_an_Image_for_Amazon_EC2_ec2-provisioning"><a class="anchor" href="#Creating_an_Image_for_Amazon_EC2_ec2-provisioning"></a>16.5. Creating an image for Amazon EC2</h3>
<div class="paragraph">
<p>You can create images for Amazon EC2 from within Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Amazon EC2 provider.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Name</strong> field, enter a meaningful and unique name for your EC2 image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select an operating system to associate with the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select an architecture to associate with the image.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the username needed to SSH into the machine.</p>
</li>
<li>
<p>In the <strong>Image ID</strong> field, enter the image ID provided by Amazon or an operating system vendor.
You can find the ID within Amazon AWS or on operating system specific pages such as <a href="https://cloud.debian.org/images/cloud/">debian.org</a> or <a href="https://cloud-images.ubuntu.com/locator/ec2/">ubuntu.com</a>.</p>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> check box to enable support for user data input.</p>
</li>
<li>
<p>Optional: Set an <strong>Iam Role</strong> for <em>Fog</em> to use when creating this image.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes to Foreman.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Amazon_EC2_Images_to_Server_ec2-provisioning"><a class="anchor" href="#Adding_Amazon_EC2_Images_to_Server_ec2-provisioning"></a>16.6. Adding Amazon EC2 images to Foreman&#160;server</h3>
<div class="paragraph">
<p>Amazon EC2 uses image-based provisioning to create hosts.
You must add image details to your Foreman&#160;server.
This includes access details and image location.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-amazon-ec2-images_ec2-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and select an Amazon EC2 connection.</p>
</li>
<li>
<p>Click the <strong>Images</strong> tab, and then click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name to identify the image for future use.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the operating system that corresponds with the image you want to add.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system&#8217;s architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
This is normally the <code>root</code> user.</p>
</li>
<li>
<p>In the <strong>Password</strong> field, enter the SSH password for image access.</p>
</li>
<li>
<p>In the <strong>Image ID</strong> field, enter the Amazon Machine Image (AMI) ID for the image.
This is usually in the following format: <code>ami-xxxxxxxx</code>.</p>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the images support user data input, such as <code>cloud-init</code> data.
If you enable user data, the Finish scripts are automatically disabled.
This also applies in reverse: if you enable the Finish scripts, this disables user data.</p>
</li>
<li>
<p>Optional: In the <strong>IAM role</strong> field, enter the Amazon security role used for creating the image.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-amazon-ec2-images_ec2-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Use the <code>--uuid</code> field to store the full path of the image location on the Amazon EC2 server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource image create \
--architecture "<em>My_Architecture</em>" \
--compute-resource "<em>My_EC2_Compute_Resource</em>" \
--name "<em>My_Amazon_EC2_Image</em>" \
--operatingsystem "<em>My_Operating_System</em>" \
--user-data true \
--username root \
--uuid "ami-<em>My_AMI_ID</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Amazon_EC2_Details_to_a_Compute_Profile_ec2-provisioning"><a class="anchor" href="#Adding_Amazon_EC2_Details_to_a_Compute_Profile_ec2-provisioning"></a>16.7. Adding Amazon EC2 details to a compute profile</h3>
<div class="paragraph">
<p>You can add hardware settings for instances on Amazon EC2 to a compute profile.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong> and click the name of your profile, then click an EC2 connection.</p>
</li>
<li>
<p>From the <strong>Flavor</strong> list, select the hardware profile on EC2 to use for the host.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use for image-based provisioning.</p>
</li>
<li>
<p>From the <strong>Availability zone</strong> list, select the target cluster to use within the chosen EC2 region.</p>
</li>
<li>
<p>From the <strong>Subnet</strong> list, add the subnet for the EC2 instance.
If you have a VPC for provisioning new hosts, use its subnet.</p>
</li>
<li>
<p>From the <strong>Security Groups</strong> list, select the cloud-based access rules for ports and IP addresses to apply to the host.</p>
</li>
<li>
<p>From the <strong>Managed IP</strong> list, select either a <code>Public</code> IP or a <code>Private</code> IP.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Set Amazon EC2 details to a compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile values create
--compute-resource "<em>My_Laptop</em>" \
--compute-profile "<em>My_Compute_Profile</em>" \
--compute-attributes "flavor_id=1,availability_zone= <em>My_Zone</em>,subnet_id=1,security_group_ids=1,managed_ip=public_ip"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Creating_Image_Based_Hosts_on_Amazon_EC2_ec2-provisioning"><a class="anchor" href="#Creating_Image_Based_Hosts_on_Amazon_EC2_ec2-provisioning"></a>16.8. Creating image-based hosts on Amazon EC2</h3>
<div class="paragraph">
<p>The Amazon EC2 provisioning process creates hosts from existing images on the Amazon EC2 server.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-hosts-on-amazon-ec2_ec2-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the EC2 connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine-based settings.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
Amazon EC2 assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab and confirm that all fields are populated with values.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that all fields are populated with values.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save your changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This new host entry triggers the Amazon EC2 server to create the instance, using the pre-existing image as a basis for the new volume.</p>
</div>
<div id="cli-creating-hosts-on-amazon-ec2_ec2-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code> to use image-based provisioning.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--compute-attributes="flavor_id=m1.small,image_id=TestImage,availability_zones=us-east-1a,security_group_ids=Default,managed_ip=Public" \
--compute-resource "<em>My_EC2_Compute_Resource</em>" \
--enabled true \
--hostgroup "<em>My_Host_Group</em>" \
--image "<em>My_Amazon_EC2_Image</em>" \
--interface "managed=true,primary=true,provision=true,subnet_id=EC2" \
--location "<em>My_Location</em>" \
--managed true \
--name "My_Host_Name_" \
--organization "<em>My_Organization</em>" \
--provision-method image</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="Connecting_to_an_Amazon_EC2_Instance_Using_SSH_ec2-provisioning"><a class="anchor" href="#Connecting_to_an_Amazon_EC2_Instance_Using_SSH_ec2-provisioning"></a>16.9. Connecting to an Amazon EC2 instance using SSH</h3>
<div class="paragraph">
<p>You can connect remotely to an Amazon EC2 instance from Foreman&#160;server using SSH.
However, to connect to any Amazon Web Services EC2 instance that you provision through Foreman, you must first access the private key that is associated with the compute resource in the Foreman database, and use this key for authentication.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To locate the compute resource list, on your Foreman&#160;server base system, enter the following command, and note the ID of the compute resource that you want to use:</p>
<div class="listingblock">
<div class="content">
<pre>$ hammer compute-resource list</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Foreman database as the user <code>postgres</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su - postgres -c psql foreman</pre>
</div>
</div>
</li>
<li>
<p>Select the secret from <code>key_pairs</code> where <code>compute_resource_id = 3</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># select secret from key_pairs where compute_resource_id = 3; secret</pre>
</div>
</div>
</li>
<li>
<p>Copy the key from after <code>-----BEGIN RSA PRIVATE KEY-----</code> until <code>-----END RSA PRIVATE KEY-----</code>.</p>
</li>
<li>
<p>Create a <code>.pem</code> file and paste your key into the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vim <em>Keyname</em>.pem</pre>
</div>
</div>
</li>
<li>
<p>Ensure that you restrict access to the <code>.pem</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 600 <em>Keyname</em>.pem</pre>
</div>
</div>
</li>
<li>
<p>To connect to the Amazon EC2 instance, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ssh -i <em>Keyname</em>.pem   ec2-user@<em>example.aws.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_a_Finish_Template_for_Amazon_EC2_ec2-provisioning"><a class="anchor" href="#Configuring_a_Finish_Template_for_Amazon_EC2_ec2-provisioning"></a>16.10. Configuring a finish template for an Amazon Web Service EC2 environment</h3>
<div class="paragraph">
<p>You can use Foreman finish templates during the provisioning of Linux instances in an Amazon EC2 environment.</p>
</div>
<div class="paragraph">
<p>If you want to use a Finish template with SSH, Foreman must reside within the EC2 environment and in the correct security group.
Foreman currently performs SSH finish provisioning directly, not using Smart&#160;Proxy&#160;server.
If Foreman&#160;server does not reside within EC2, the EC2 virtual machine reports an internal IP rather than the necessary external IP with which it can be reached.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Templates</strong> &gt; <strong>Provisioning Templates</strong>.</p>
</li>
<li>
<p>In the <strong>Provisioning Templates</strong> page, enter <code>Kickstart default finish</code> into the search field and click <strong>Search</strong>.</p>
</li>
<li>
<p>On the <strong>Kickstart default finish</strong> template, select <strong>Clone</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a unique name for the template.</p>
</li>
<li>
<p>In the template, prefix each command that requires root privileges with <code>sudo</code>, except for <code>yum</code> or equivalent commands, or add the following line to run the entire template as the <code>sudo</code> user:</p>
<div class="listingblock">
<div class="content">
<pre>sudo -s &lt;&lt; EOS
_Template_ _Body_
EOS</pre>
</div>
</div>
</li>
<li>
<p>Click the <strong>Association</strong> tab, and associate the template with a Enterprise Linux operating system that you want to use.</p>
</li>
<li>
<p>Click the <strong>Locations</strong> tab, and add the the location where the host resides.</p>
</li>
<li>
<p>Click the <strong>Organizations</strong> tab, and add the organization that the host belongs to.</p>
</li>
<li>
<p>Make any additional customizations or changes that you require, then click <strong>Submit</strong> to save your template.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Operating systems</strong> and select the operating system that you want for your host.</p>
</li>
<li>
<p>Click the <strong>Templates</strong> tab, and from the <strong>Finish Template</strong> list, select your finish template.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>Click the <strong>Parameters</strong> tab and navigate to <strong>Host parameters</strong>.</p>
</li>
<li>
<p>If you have the Remote Execution plugin installed, in <strong>Host parameters</strong>, click <strong>Add Parameter</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter <code>remote_execution_ssh_user</code>.
In the corresponding <strong>Value</strong> field, enter <code>ec2-user</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_Virtual_Machine_on_Amazon_EC2_ec2-provisioning"><a class="anchor" href="#Deleting_a_Virtual_Machine_on_Amazon_EC2_ec2-provisioning"></a>16.11. Deleting a virtual machine on Amazon EC2</h3>
<div class="paragraph">
<p>You can delete virtual machines running on Amazon EC2 from within Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Amazon EC2 provider.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Delete</strong> from the <strong>Actions</strong> menu.
This deletes the virtual machine from the Amazon EC2 compute resource while retaining any associated hosts within Foreman.
If you want to delete an orphaned host, navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and delete the host manually.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting a host entry associated with a virtual machine does not destroy the virtual machine on the compute resource.</p>
</div>
<div class="paragraph">
<p>To change the default behavior, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and set <strong>Destroy associated VM on host delete</strong> to <strong>Yes</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Uninstalling_Amazon_EC2_plugin_ec2-provisioning"><a class="anchor" href="#Uninstalling_Amazon_EC2_plugin_ec2-provisioning"></a>16.12. Uninstalling Amazon EC2 plugin</h3>
<div class="paragraph">
<p>If you have previously installed the Amazon EC2 plugin but do not use it anymore to manage and deploy hosts to EC2, you can uninstall it from your Foreman&#160;server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Uninstall the EC2 compute resource provider from your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># apt remove foreman-ec2
# foreman-installer --no-enable-foreman-compute-ec2</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the Foreman web UI, navigate to <strong>Administer</strong> &gt; <strong>About</strong> and select the <strong>Available Providers</strong> tab to verify the removal of the Amazon EC2 plugin.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="More_Information_About_Amazon_Web_Services_ec2-provisioning"><a class="anchor" href="#More_Information_About_Amazon_Web_Services_ec2-provisioning"></a>16.13. More information about Amazon Web Services and Foreman</h3>
<div class="paragraph">
<p>For information about how to locate Red&#160;Hat Gold Images on Amazon Web Services EC2, see <a href="https://access.redhat.com/articles/2962171">How to Locate Red&#160;Hat Cloud Access Gold Images on AWS EC2</a>.</p>
</div>
<div class="paragraph">
<p>For information about how to install and use the Amazon Web Service Client on Linux, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/awscli-install-linux.html">Install the AWS Command Line Interface on Linux</a> in the Amazon Web Services documentation.</p>
</div>
<div class="paragraph">
<p>For information about importing and exporting virtual machines in Amazon Web Services, see <a href="https://aws.amazon.com/ec2/vm-import/">VM Import/Export</a> in the Amazon Web Services documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Cloud_Instances_on_Google_Compute_Engine_gce-provisioning"><a class="anchor" href="#Provisioning_Cloud_Instances_on_Google_Compute_Engine_gce-provisioning"></a>17. Provisioning cloud instances on Google Compute Engine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman can interact with Google Compute Engine (GCE), including creating new virtual machines and controlling their power management states.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure a domain and subnet on Foreman.
For more information about networking requirements, see <a href="#preparing-networking">Preparing networking</a>.</p>
</li>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.</p>
</li>
<li>
<p>In your GCE project, configure a service account with the necessary IAM Compute role.
For more information, see <a href="https://cloud.google.com/compute/docs/access/iam">Compute Engine IAM roles</a> in the GCE documentation.</p>
</li>
<li>
<p>In your GCE project-wise metadata, set the <code>enable-oslogin</code> to <code>FALSE</code>.
For more information, see <a href="https://cloud.google.com/compute/docs/instances/managing-instance-access#enable_oslogin">Enabling or disabling OS Login</a> in the GCE documentation.</p>
</li>
<li>
<p>Optional: If you want to use Puppet with GCE hosts, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Puppet</strong> and enable the <code>Use UUID for certificates</code> setting to configure Puppet to use consistent Puppet certificate IDs.</p>
</li>
<li>
<p>Based on your needs, associate a <code>finish</code> or <code>user_data</code> provisioning template with the operating system you want to use.
For more information, see <a href="https://docs.theforeman.org/nightly/Provisioning_Hosts/index-foreman-deb.html#provisioning-templates">Provisioning Templates</a> in <em>Provisioning hosts</em>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="Installing_Google_GCE_plugin_gce-provisioning"><a class="anchor" href="#Installing_Google_GCE_plugin_gce-provisioning"></a>17.1. Installing Google GCE plugin</h3>
<div class="paragraph">
<p>Install the Google GCE plugin to attach an GCE compute resource provider to Foreman.
This allows you to manage and deploy hosts to GCE.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the Google GCE compute resource provider on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--enable-foreman-cli-google \
--enable-foreman-plugin-google</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the Foreman web UI, navigate to <strong>Administer &gt; About</strong> and select the <strong>Compute Resources</strong> tab to verify the installation of the Google GCE plugin.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Google_GCE_Connection_gce-provisioning"><a class="anchor" href="#Adding_a_Google_GCE_Connection_gce-provisioning"></a>17.2. Adding a Google GCE connection to Foreman&#160;server</h3>
<div class="paragraph">
<p>Use this procedure to add Google Compute Engine (GCE) as a compute resource in Foreman.
To use the CLI instead of the Foreman web UI, see the <a href="#cli-Adding_a_Google_GCE_Connection_gce-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In Google GCE, generate a service account key in JSON format.
For more information, see <a href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys">Create and manage service account keys</a> in the GCE documentation.</p>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>Google</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, enter a description for the resource.</p>
</li>
<li>
<p>In the <strong>JSON key</strong> field, click <strong>Choose File</strong> and locate your service account key for upload from your local machine.</p>
</li>
<li>
<p>Click <strong>Load Zones</strong> to populate the list of zones from your GCE environment.</p>
</li>
<li>
<p>From the <strong>Zone</strong> list, select the GCE zone to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div id="cli-Adding_a_Google_GCE_Connection_gce-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>In Google GCE, generate a service account key in JSON format.
For more information, see <a href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys">Create and manage service account keys</a> in the GCE documentation.</p>
</li>
<li>
<p>Use the <code>hammer compute-resource create</code> command to add a GCE compute resource to Foreman:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hammer compute-resource create \
--key-path "<em>My_GCE_Key</em>.json" \
--name "<em>My_GCE_Compute_Resource</em>" \
--provider "gce" \
--zone "<em>My_Zone</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-images-to-server_gce-provisioning"><a class="anchor" href="#adding-images-to-server_gce-provisioning"></a>17.3. Adding Google Compute Engine images to Foreman&#160;server</h3>
<div class="paragraph">
<p>To create hosts using image-based provisioning, you must add information about the image, such as access details and the image location, to your Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-images-to-server_gce-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click the name of the Google Compute Engine connection.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
Specify a user other than <code>root</code>, because the <code>root</code> user cannot connect to a GCE instance using SSH keys. The username must begin with a letter and consist of lowercase letters and numbers.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select an image from the Google Compute Engine compute resource.</p>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the image supports user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-images-to-server_gce-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
With the <code>--username</code> option, specify a user other than <code>root</code>, because the <code>root</code> user cannot connect to a GCE instance using SSH keys.
The username must begin with a letter and consist of lowercase letters and numbers.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource image create \
--name '<em>gce_image_name</em>' \
--compute-resource '<em>gce_cr</em>' \
--operatingsystem-id 1 \
--architecture-id 1 \
--uuid '<em>3780108136525169178</em>' \
--username '<em>admin</em>'</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Google_GCE_Details_to_a_Compute_Profile_gce-provisioning"><a class="anchor" href="#Adding_Google_GCE_Details_to_a_Compute_Profile_gce-provisioning"></a>17.4. Adding Google GCE details to a compute profile</h3>
<div class="paragraph">
<p>Use this procedure to add Google GCE hardware settings to a compute profile.
When you create a host on Google GCE using this compute profile, these settings are automatically populated.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-Adding_Google_GCE_Details_to_a_Compute_Profile_gce-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>In the Compute Profiles window, click the name of an existing compute profile, or click <strong>Create Compute Profile</strong>, enter a <strong>Name</strong>, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the GCE compute resource.</p>
</li>
<li>
<p>From the <strong>Machine Type</strong> list, select the machine type to use for provisioning.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the image to use for provisioning.</p>
</li>
<li>
<p>From the <strong>Network</strong> list, select the Google GCE network to use for provisioning.</p>
</li>
<li>
<p>Optional: Select the <strong>Associate Ephemeral External IP</strong> checkbox to assign a dynamic ephemeral IP address that Foreman uses to communicate with the host.
This public IP address changes when you reboot the host.
If you need a permanent IP address, reserve a static public IP address on Google GCE and attach it to the host.</p>
</li>
<li>
<p>In the <strong>Size (GB)</strong> field, enter the size of the storage to create on the host.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the compute profile.</p>
</li>
</ol>
</div>
<div id="cli-Adding_Google_GCE_Details_to_a_Compute_Profile_gce-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a compute profile to use with the Google GCE compute resource:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile create --name <em>My_GCE_Compute_Profile</em></pre>
</div>
</div>
</li>
<li>
<p>Add GCE details to the compute profile:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile values create \
--compute-attributes "machine_type=f1-micro,associate_external_ip=true,network=default" \
--compute-profile "<em>My_GCE_Compute_Profile</em>" \
--compute-resource "<em>My_GCE_Compute_Resource</em>" \
--volume "<em>size_gb=20</em>"</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-image-only-hosts_gce-provisioning"><a class="anchor" href="#creating-image-only-hosts_gce-provisioning"></a>17.5. Creating image-based hosts on Google Compute Engine</h3>
<div class="paragraph">
<p>In Foreman, you can use Google Compute Engine provisioning to create hosts from an existing image.
The new host entry triggers the Google Compute Engine server to create the instance using the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-image-only-hosts_gce-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the Google Compute Engine connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine settings.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
Google Compute Engine assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>The <strong>Domain</strong> field is populated with the required domain.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div id="cli-creating-image-only-hosts_gce-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--architecture <em>x86_64</em> \
--compute-profile "<em>My_Compute_Profile</em>" \
--compute-resource "<em>My_Compute_Resource</em>" \
--image "<em>My_GCE_Image</em>" \
--interface "type=interface,domain_id=1,managed=true,primary=true,provision=true" \
--location "<em>My_Location</em>" \
--name "<em>My_Host_Name</em>" \
--operatingsystem "<em>My_Operating_System</em>" \
--organization "<em>My_Organization</em>" \
--provision-method "image" \
--puppet-ca-proxy-id <em>My_Puppet_CA_Proxy_ID</em> \
--puppet-environment-id <em>My_Puppet_Environment_ID</em> \
--puppet-proxy-id <em>My_Puppet_Proxy_ID</em> \
--root-password "<em>My_Root_Password</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_VM_on_Google_GCE_gce-provisioning"><a class="anchor" href="#Deleting_a_VM_on_Google_GCE_gce-provisioning"></a>17.6. Deleting a VM on Google GCE</h3>
<div class="paragraph">
<p>You can delete VMs running on Google GCE on your Foreman&#160;server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure &gt; Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Google GCE provider.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Delete</strong> from the <strong>Actions</strong> menu.
This deletes the virtual machine from the Google GCE compute resource while retaining any associated hosts within Foreman.
If you want to delete the orphaned host, navigate to <strong>Hosts &gt; All Hosts</strong> and delete the host manually.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting a host entry associated with a virtual machine does not destroy the virtual machine on the compute resource.</p>
</div>
<div class="paragraph">
<p>To change the default behavior, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and set <strong>Destroy associated VM on host delete</strong> to <strong>Yes</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Provisioning_Cloud_Instances_on_Microsoft_Azure_Resource_Manager_azure-provisioning"><a class="anchor" href="#Provisioning_Cloud_Instances_on_Microsoft_Azure_Resource_Manager_azure-provisioning"></a>18. Provisioning cloud instances on Microsoft Azure Resource Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Foreman can interact with Microsoft Azure Resource Manager, including creating new virtual machines and controlling their power management states.
Only image-based provisioning is supported for creating Azure hosts.
This includes provisioning by using Marketplace images, custom images, and shared image gallery.</p>
</div>
<div class="paragraph">
<p>For more information about Azure Resource Manager concepts, see <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/">Azure Resource Manager documentation</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Provide the installation medium for the operating systems that you want to use to provision hosts.</p>
</li>
<li>
<p>Ensure that you have the correct permissions to create an Azure Active Directory application.
For more information, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#required-permissions">Check Azure AD permissions</a> in the <em>Microsoft identity platform (Azure Active Directory for developers)</em> documentation.</p>
</li>
<li>
<p>You must create and configure an Azure Active Directory application and service principle to obtain Application or <em>client</em> ID, Directory or <em>tenant</em> ID, and Client Secret.
For more information, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal">Use the portal to create an Azure AD application and service principal that can access resources</a> in the <em>Microsoft identity platform (Azure Active Directory for developers)</em> documentation.</p>
</li>
<li>
<p>Optional: If you want to use Puppet with Azure hosts, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Puppet</strong> and enable the <code>Use UUID for certificates</code> setting to configure Puppet to use consistent Puppet certificate IDs.</p>
</li>
<li>
<p>Based on your needs, associate a <code>finish</code> or <code>user_data</code> provisioning template with the operating system you want to use.
For more information about provisioning templates, see <a href="https://docs.theforeman.org/nightly/Provisioning_Hosts/index-foreman-deb.html#provisioning-templates">Provisioning Templates</a>.</p>
</li>
<li>
<p>Optional: If you want the virtual machine to use a static private IP address, create a subnet in Foreman with the <strong>Network Address</strong> field matching the Azure subnet address.</p>
</li>
<li>
<p>Before creating Red&#160;Hat Enterprise Linux BYOS images, you must accept the image terms either in the Azure CLI or Portal so that the image can be used to create and manage virtual machines for your subscription.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="Installing_Microsoft_Azure_plugin_azure-provisioning"><a class="anchor" href="#Installing_Microsoft_Azure_plugin_azure-provisioning"></a>18.1. Installing Microsoft Azure plugin</h3>
<div class="paragraph">
<p>Install the Microsoft Azure plugin to attach an Azure compute resource provider to Foreman.
This allows you to manage and deploy hosts to Azure.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the Azure compute resource provider on your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --enable-foreman-plugin-azure</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the Foreman web UI, navigate to <strong>Administer &gt; About</strong> and select the <em>compute resources</em> tab to verify the installation of the Microsoft Azure plugin.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_a_Microsoft_Azure_Resource_Manager_Connection_azure-provisioning"><a class="anchor" href="#Adding_a_Microsoft_Azure_Resource_Manager_Connection_azure-provisioning"></a>18.2. Adding a Microsoft Azure Resource Manager connection to Foreman&#160;server</h3>
<div class="paragraph">
<p>Use this procedure to add Microsoft Azure as a compute resource in Foreman.
Note that you must add a separate compute resource for each Microsoft Azure region that you want to use.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-Adding_a_Microsoft_Azure_Resource_Manager_Connection_azure-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click <strong>Create Compute Resource</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the compute resource.</p>
</li>
<li>
<p>From the <strong>Provider</strong> list, select <strong>Azure Resource Manager</strong>.</p>
</li>
<li>
<p>Optional: In the <strong>Description</strong> field, enter a description for the resource.</p>
</li>
<li>
<p>By default, the <strong>Cloud</strong> is set to Public/Standard.
Azure Government Cloud supports the following regions:</p>
<div class="ulist">
<ul>
<li>
<p>US Government</p>
</li>
<li>
<p>China</p>
</li>
<li>
<p>Germany</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Client ID</strong> field, enter your Application or <em>client</em> ID.</p>
</li>
<li>
<p>In the <strong>Client Secret</strong> field, enter your client secret.</p>
</li>
<li>
<p>In the <strong>Subscription ID</strong> field, enter your subscription ID.</p>
</li>
<li>
<p>In the <strong>Tenant ID</strong> field, enter your Directory or <em>tenant</em> ID.</p>
</li>
<li>
<p>Click <strong>Load Regions</strong>.
This tests if your connection to Azure Resource Manager is successful and loads the regions available in your subscription.</p>
</li>
<li>
<p>From the <strong>Azure Region</strong> list, select the Azure region to use.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div id="cli-Adding_a_Microsoft_Azure_Resource_Manager_Connection_azure-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Use <code>hammer compute-resource create</code> to add an Azure compute resource to Foreman.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource create \
--app-ident <em>My_Client_ID</em> \
--name <em>My_Compute_Resource_Name</em> \
--provider azurerm \
--region "<em>My_Region</em>" \
--secret-key <em>My_Client_Secret</em> \
--sub-id <em>My_Subscription_ID</em> \
--tenant <em>My_Tenant_ID</em></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the value for the <code>--region</code> option must be in lowercase and must not contain special characters.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using Azure Government Cloud then you must pass in the <code>--cloud</code> parameter.
The values for the <code>cloud</code> parameter are:</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name of Azure Government Cloud</th>
<th class="tableblock halign-left valign-top">Value for hammer --cloud</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">US Government</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">azureusgovernment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">China</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">azurechina</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Germany</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">azuregermancloud</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="adding-images-to-server_azure-provisioning"><a class="anchor" href="#adding-images-to-server_azure-provisioning"></a>18.3. Adding Microsoft Azure Resource Manager images to Foreman&#160;server</h3>
<div class="paragraph">
<p>To create hosts using image-based provisioning, you must add information about the image, such as access details and the image location, to your Foreman&#160;server.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-adding-images-to-server_azure-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and click the name of the Microsoft Azure Resource Manager connection.</p>
</li>
<li>
<p>Click <strong>Create Image</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the image.</p>
</li>
<li>
<p>From the <strong>Operating System</strong> list, select the base operating system of the image.</p>
</li>
<li>
<p>From the <strong>Architecture</strong> list, select the operating system architecture.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter the SSH user name for image access.
You cannot use the <code>root</code> user.</p>
</li>
<li>
<p>Optional: In the <strong>Password</strong> field, enter a password to authenticate with.</p>
</li>
<li>
<p>In the <strong>Azure Image Name</strong> field, enter an image name in the format <code><em>prefix://UUID</em></code>.</p>
<div class="ulist">
<ul>
<li>
<p>For a custom image, use the prefix <code>custom</code>.
For example, <strong>custom://image-name</strong>.</p>
</li>
<li>
<p>For a shared gallery image, use the prefix <code>gallery</code>.
For example, <strong>gallery://Templates/image-name</strong>.</p>
</li>
<li>
<p>For public and RHEL Bring Your Own Subscription (BYOS) images, use the prefix <code>marketplace</code>.
For example, <strong>marketplace://OpenLogicCentOS:7.5:latest</strong>.</p>
<div class="paragraph">
<p>For more information, see <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/cli-ps-findimage">Find Linux VM images in the Azure Marketplace with the Azure CLI</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: Select the <strong>User Data</strong> checkbox if the image supports user data input, such as <code>cloud-init</code> data.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the image details.</p>
</li>
</ol>
</div>
<div id="cli-adding-images-to-server_azure-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the image with the <code>hammer compute-resource image create</code> command.
Note that the username that you enter for the image must be the same that you use when you create a host with this image.
The <code>--password</code> option is optional when creating an image.
You cannot use the <code>root</code> user.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-resource image create \
--name <em>Azure_image_name</em> \
--compute-resource <em>azure_cr_name</em> \
--uuid '<em>marketplace://RedHat:RHEL:7-RAW:latest</em>' \
--username '<em>azure_username</em>' \
--user-data <em>no</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Microsoft_Azure_Resource_Manager_Details_to_a_Compute_Profile_azure-provisioning"><a class="anchor" href="#Adding_Microsoft_Azure_Resource_Manager_Details_to_a_Compute_Profile_azure-provisioning"></a>18.4. Adding Microsoft Azure Resource Manager details to a compute profile</h3>
<div class="paragraph">
<p>Use this procedure to add Microsoft Azure hardware settings to a compute profile.
When you create a host on Microsoft Azure using this compute profile, these settings are automatically populated.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-Adding_Microsoft_Azure_Resource_Manager_Details_to_a_Compute_Profile_azure-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Profiles</strong>.</p>
</li>
<li>
<p>In the Compute Profiles window, click the name of an existing compute profile, or click <strong>Create Compute Profile</strong>, enter a <strong>Name</strong>, and click <strong>Submit</strong>.</p>
</li>
<li>
<p>Click the name of the Azure compute resource.</p>
</li>
<li>
<p>From the <strong>Resource group</strong> list, select the resource group to provision to.</p>
</li>
<li>
<p>From the <strong>VM Size</strong> list, select a size of a virtual machine to provision.</p>
</li>
<li>
<p>From the <strong>Platform</strong> list, select <strong>Linux</strong>.</p>
</li>
<li>
<p>In the <strong>Username</strong> field, enter a user name to authenticate with.
Note that the username that you enter for compute profile must be the same that you use when creating an image.</p>
</li>
<li>
<p>To authenticate the user, use one of the following options:</p>
<div class="ulist">
<ul>
<li>
<p>To authenticate using a password, enter a password in the <strong>Password</strong> field.</p>
</li>
<li>
<p>To authenticate using an SSH key, enter an SSH key in the <strong>SSH Key</strong> field.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: If you want the virtual machine to use a premium virtual machine disk, select the <strong>Premium OS Disk</strong> checkbox.</p>
</li>
<li>
<p>From the <strong>OS Disk Caching</strong> list, select the disc caching setting.</p>
</li>
<li>
<p>Optional: In the <strong>Custom Script Command</strong> field, enter commands to perform on the virtual machine when the virtual machine is provisioned.</p>
</li>
<li>
<p>Optional: If you want to run custom scripts when provisioning finishes, in the <strong>Comma separated file URIs</strong> field, enter comma-separated file URIs of scripts to use.
The scripts must contain <code>sudo</code> at the beginning because Foreman downloads files to the <code>/var/lib/waagent/custom-script/download/0/</code> directory on the host and scripts require sudo privileges to be executed.</p>
</li>
<li>
<p>Optional: You can add a <strong>NVIDIA Driver</strong> by selecting the <strong>NVIDIA driver / CUDA</strong> checkbox.
For more information, refer to the following Microsoft Azure documentation:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/hpccompute-gpu-linux">NVIDIA GPU Driver Extension for Linux</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/hpccompute-gpu-windows">NVIDIA GPU Driver Extension for Windows</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: If you want to create an additional volume on the VM, click the <strong>Add Volume</strong> button, enter the <strong>Size</strong> in GB and select the <strong>Data Disk Caching</strong> method.</p>
<div class="ulist">
<ul>
<li>
<p>Note that the maximum number of these disks depends on the VM Size selected.
For more information on Microsoft Azure VM storage requirements, see the <a href="https://docs.microsoft.com/en-us/azure/virtual-machines">Microsoft Azure documentation</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Add Interface</strong>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The maximum number of interfaces depends on the VM Size selected.
For more information, see the Microsoft Azure documentation link above.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>From the <strong>Azure Subnet</strong> list, select the Azure subnet to provision to.</p>
</li>
<li>
<p>From the <strong>Public IP</strong> list, select the public IP setting.</p>
</li>
<li>
<p>Optional: If you want the virtual machine to use a static private IP, select the <strong>Static Private IP</strong> checkbox.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div id="cli-Adding_Microsoft_Azure_Resource_Manager_Details_to_a_Compute_Profile_azure-provisioning" class="olist arabic">
<div class="title">CLI procedure</div>
<ol class="arabic">
<li>
<p>Create a compute profile to use with the Azure Resource Manager compute resource:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile create --name <em>compute_profile_name</em></pre>
</div>
</div>
</li>
<li>
<p>Add Azure details to the compute profile.
With the <code>username</code> setting, enter the SSH user name for image access.
Note that the username that you enter for compute profile must be the same that you use when creating an image.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer compute-profile values create \
--compute-attributes="resource_group=<em>resource_group</em>,vm_size=<em>Standard_B1s</em>,username=<em>azure_user</em>,password=<em>azure_password</em>,platform=Linux,script_command=touch /var/tmp/text.txt" \
--compute-profile "<em>compute_profile_name</em>" \
--compute-resource <em>azure_cr_name</em> \
--interface="compute_public_ip=Dynamic,compute_network=mysubnetID,compute_private_ip=false" \
--volume="disk_size_gb=<em>5</em>,data_disk_caching=<em>None</em>"</pre>
</div>
</div>
<div class="paragraph">
<p>Optional: If you want to run scripts on the virtual machine after provisioning, specify the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To enter the script directly, with the <code>script_command</code> setting, enter a command to be executed on the provisioned virtual machine.</p>
</li>
<li>
<p>To run a script from a URI, with the <code>script_uris</code> setting, enter comma-separated file URIs of scripts to use.
The scripts must contain <code>sudo</code> at the beginning because Foreman downloads files to the <code>/var/lib/waagent/custom-script/download/0/</code> directory on the host and therefore scripts require sudo privileges to be executed.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-image-only-hosts_azure-provisioning"><a class="anchor" href="#creating-image-only-hosts_azure-provisioning"></a>18.5. Creating image-based hosts on Microsoft Azure Resource Manager</h3>
<div class="paragraph">
<p>In Foreman, you can use Microsoft Azure Resource Manager provisioning to create hosts from an existing image.
The new host entry triggers the Microsoft Azure Resource Manager server to create the instance using the pre-existing image as a basis for the new volume.</p>
</div>
<div class="paragraph">
<p>To use the CLI instead of the Foreman web UI, see the <a href="#cli-creating-image-only-hosts_azure-provisioning">CLI procedure</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Hosts</strong> &gt; <strong>Create Host</strong>.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter a name for the host.</p>
</li>
<li>
<p>Optional: Click the <strong>Organization</strong> tab and change the organization context to match your requirement.</p>
</li>
<li>
<p>Optional: Click the <strong>Location</strong> tab and change the location context to match your requirement.</p>
</li>
<li>
<p>From the <strong>Host Group</strong> list, select a host group that you want to assign your host to.
That host group will populate the form.</p>
</li>
<li>
<p>From the <strong>Deploy on</strong> list, select the Microsoft Azure Resource Manager connection.</p>
</li>
<li>
<p>From the <strong>Compute Profile</strong> list, select a profile to use to automatically populate virtual machine settings.</p>
</li>
<li>
<p>Click the <strong>Interfaces</strong> tab, and on the interface of the host, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Verify that the fields are populated with values.
Note in particular:</p>
<div class="ulist">
<ul>
<li>
<p>Foreman automatically assigns an IP address for the new host.</p>
</li>
<li>
<p>Ensure that the <strong>MAC address</strong> field is blank.
Microsoft Azure Resource Manager assigns a MAC address to the host during provisioning.</p>
</li>
<li>
<p>The <strong>Name</strong> from the <strong>Host</strong> tab becomes the <strong>DNS name</strong>.</p>
</li>
<li>
<p>The <strong>Azure Subnet</strong> field is populated with the required Azure subnet.</p>
</li>
<li>
<p>Optional: If you want to use a static private IP address, from the <strong>IPv4 Subnet</strong> list select the Foreman subnet with the <strong>Network Address</strong> field matching the Azure subnet address.
In the <strong>IPv4 Address</strong> field, enter an IPv4 address within the range of your Azure subnet.</p>
</li>
<li>
<p>Ensure that Foreman automatically selects the <strong>Managed</strong>, <strong>Primary</strong>, and <strong>Provision</strong> options for the first interface on the host.
If not, select them.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong> to save.
To add another interface, click <strong>Add Interface</strong>.
You can select only one interface for <strong>Provision</strong> and <strong>Primary</strong>.</p>
<div class="paragraph">
<p>For more information about network interfaces, see <a href="https://docs.theforeman.org/nightly/Managing_Hosts/index-foreman-deb.html#configuring-network-interfaces">Configuring network interfaces</a> in <em>Managing hosts</em>.</p>
</div>
</li>
<li>
<p>Click the <strong>Operating System</strong> tab, and confirm that all fields automatically contain values.</p>
</li>
<li>
<p>For <strong>Provisioning Method</strong>, ensure <strong>Image Based</strong> is selected.</p>
</li>
<li>
<p>From the <strong>Image</strong> list, select the Azure Resource Manager image that you want to use for provisioning.</p>
</li>
<li>
<p>In the <strong>Root Password</strong> field, enter the root password to authenticate with.</p>
</li>
<li>
<p>Click <strong>Resolve</strong> in <strong>Provisioning templates</strong> to check the new host can identify the right provisioning templates to use.</p>
</li>
<li>
<p>Click the <strong>Virtual Machine</strong> tab and confirm that these settings are populated with details from the host group and compute profile.
Modify these settings to suit your needs.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the host entry.</p>
</li>
</ol>
</div>
<div id="cli-creating-image-only-hosts_azure-provisioning" class="ulist">
<div class="title">CLI procedure</div>
<ul>
<li>
<p>Create the host with the <code>hammer host create</code> command and include <code>--provision-method image</code>.
Replace the values in the following example with the appropriate values for your environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ hammer host create \
--architecture <em>x86_64</em> \
--compute-profile "<em>My_Compute_Profile</em>" \
--compute-resource "<em>My_Compute_Resource</em>" \
--domain "<em>My_Domain</em>" \
--image "<em>My_Azure_Image</em>" \
--location "<em>My_Location</em>" \
--name "<em>My_Host_Name</em>" \
--operatingsystem "<em>My_Operating_System</em>" \
--organization "<em>My_Organization</em>" \
--provision-method "image"</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about additional host creation parameters for this compute resource, enter the <code>hammer host create --help</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_VM_on_Microsoft_Azure_azure-provisioning"><a class="anchor" href="#Deleting_a_VM_on_Microsoft_Azure_azure-provisioning"></a>18.6. Deleting a VM on Microsoft Azure</h3>
<div class="paragraph">
<p>You can delete VMs running on Microsoft Azure from within Foreman.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure &gt; Compute Resources</strong>.</p>
</li>
<li>
<p>Select your Microsoft Azure provider.</p>
</li>
<li>
<p>On the <strong>Virtual Machines</strong> tab, click <strong>Delete</strong> from the <strong>Actions</strong> menu.
This deletes the virtual machine from the Microsoft Azure compute resource while retaining any associated hosts within Foreman.
If you want to delete the orphaned host, navigate to <strong>Hosts &gt; All Hosts</strong> and delete the host manually.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, deleting a host entry associated with a virtual machine does not destroy the virtual machine on the compute resource.</p>
</div>
<div class="paragraph">
<p>To change the default behavior, navigate to <strong>Administer</strong> &gt; <strong>Settings</strong> &gt; <strong>Provisioning</strong> and set <strong>Destroy associated VM on host delete</strong> to <strong>Yes</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Uninstalling_Microsoft_Azure_plugin_azure-provisioning"><a class="anchor" href="#Uninstalling_Microsoft_Azure_plugin_azure-provisioning"></a>18.7. Uninstalling Microsoft Azure plugin</h3>
<div class="paragraph">
<p>If you have previously installed the Microsoft Azure plugin but don&#8217;t use it anymore to manage and deploy hosts to Azure, you can uninstall it from your Foreman&#160;server.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Uninstall the Azure compute resource provider from your Foreman&#160;server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># apt remove rubygem-foreman_azure_rm rubygem-ms_rest_azure
# foreman-installer --no-enable-foreman-plugin-azure</pre>
</div>
</div>
</li>
<li>
<p>Optional: In the Foreman web UI, navigate to <strong>Administer &gt; About</strong> and select the <strong>Available Providers</strong> tab to verify the removal of the Microsoft Azure plugin.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-novnc-to-access-virtual-machines_provisioning"><a class="anchor" href="#using-novnc-to-access-virtual-machines_provisioning"></a>Appendix A: Using noVNC to access virtual machines</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use your browser to access the VNC console of VMs created by Foreman.</p>
</div>
<div class="paragraph">
<p>Foreman supports using noVNC on the following virtualization platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VMware</p>
</li>
<li>
<p>Libvirt</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have a virtual machine created by Foreman.</p>
</li>
<li>
<p>For existing virtual machines, ensure that the <strong>Display type</strong> in the <strong>Compute Resource</strong> settings is <strong>VNC</strong>.</p>
</li>
<li>
<p>You have imported the CA certificate used for Foreman into your browser.
Adding a security exception in the browser is not enough for using noVNC.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On your Foreman&#160;server, configure the firewall to allow VNC service on ports 5900 to 5930.</p>
<div class="ulist">
<ul>
<li>
<p>On operating systems with the <code>iptables</code> command:</p>
<div class="listingblock">
<div class="content">
<pre># iptables -A INPUT -p tcp --dport 5900:5930 -j ACCEPT
# service iptables save</pre>
</div>
</div>
</li>
<li>
<p>On operating systems with the <code>firewalld</code> service:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --add-port=5900-5930/tcp
# firewall-cmd --add-port=5900-5930/tcp --permanent</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the Foreman web UI, navigate to <strong>Infrastructure</strong> &gt; <strong>Compute Resources</strong> and select the name of a compute resource.</p>
</li>
<li>
<p>In the <strong>Virtual Machines</strong> tab, select the name of your virtual machine.
Ensure the machine is powered on and then select <strong>Console</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Host_Parameter_Hierarchy_provisioning"><a class="anchor" href="#Host_Parameter_Hierarchy_provisioning"></a>Appendix B: Host parameter hierarchy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can access host parameters when provisioning hosts.
Hosts inherit their parameters from the following locations, in order of increasing precedence:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter Level</th>
<th class="tableblock halign-left valign-top">Set in Foreman web UI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Globally defined parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Configure</strong> &gt; <strong>Global parameters</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Administer</strong> &gt; <strong>Organizations</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Administer</strong> &gt; <strong>Locations</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Infrastructure</strong> &gt; <strong>Domains</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subnet-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Infrastructure</strong> &gt; <strong>Subnets</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating system-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts</strong> &gt; <strong>Provisioning Setup</strong> &gt; <strong>Operating Systems</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host group-level parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Configure</strong> &gt; <strong>Host Groups</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts</strong> &gt; <strong>All Hosts</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="permissions-required-to-provision-hosts"><a class="anchor" href="#permissions-required-to-provision-hosts"></a>Appendix C: Permissions required to provision hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following list provides an overview of the permissions a non-admin user requires to provision hosts.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource name</th>
<th class="tableblock halign-left valign-top">Permissions</th>
<th class="tableblock halign-left valign-top">Additional details</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ansible role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_ansible_roles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if Ansible is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Architecture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_architectures</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_compute_profiles</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Compute resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_compute_resources, create_compute_resources, destroy_compute_resources, power_compute_resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required to provision bare-metal hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_compute_resources_vms, create_compute_resources_vms, destroy_compute_resources_vms, power_compute_resources_vms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required to provision virtual machines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_domains</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_environments</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_hosts, create_hosts, edit_hosts, destroy_hosts, build_hosts, power_hosts, play_roles_on_host</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_discovered_hosts, submit_discovered_hosts, auto_provision_discovered_hosts, provision_discovered_hosts, edit_discovered_hosts, destroy_discovered_hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if the Discovery service is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostgroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_hostgroups, create_hostgroups, edit_hostgroups, play_roles_on_hostgroup</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_images</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_locations</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medium</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_media</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operatingsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_operatingsystems</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_organizations</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_params, create_params, edit_params, destroy_params</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provisioning template</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_provisioning_templates</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ptable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_ptables</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart&#160;Proxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_smart_proxies, view_smart_proxies_puppetca</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subnet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">view_subnets</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.theforeman.org/nightly/Administering_Project/index-foreman-deb.html#Creating_a_Role_admin">Creating a Role</a> in <em>Administering Foreman</em></p>
</li>
<li>
<p><a href="https://docs.theforeman.org/nightly/Administering_Project/index-foreman-deb.html#Adding_Permissions_to_a_Role_admin">Adding Permissions to a Role</a> in <em>Administering Foreman</em></p>
</li>
<li>
<p><a href="https://docs.theforeman.org/nightly/Administering_Project/index-foreman-deb.html#Assigning_Roles_to_a_User_admin">Assigning Roles to a User</a> in <em>Administering Foreman</em></p>
</li>
</ul>
</div>
<!-- "Fork me on GitHub" CSS ribbon v0.2.3 | MIT License -->
<!-- https://github.com/simonwhitaker/github-fork-ribbon-css -->
<a class="release-ribbon right-top fixed" data-ribbon="Pre-release version" title="Pre-release version">
Pre-release version
</a>
<a class="issue-ribbon right-bottom fixed" href="https://github.com/theforeman/foreman-documentation/issues/new?template=report-issue.md" data-ribbon="Report issue" title="Report issue">
Report issue
</a>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. NetworkManager expects <code>;</code> as a list separator but currently also accepts <code>,</code>. For more information, see <code>man nm-settings-keyfile</code>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version Nightly<br>
Last updated Sep 2025
</div>
</div>
<script>
;(function () { /*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
  'use strict'

  var config = (document.currentScript || {}).dataset || {}
  var forEach = Array.prototype.forEach

  init(document.querySelectorAll('.tabs'))

  function init (tabsBlocks) {
    if (!tabsBlocks.length) return
    forEach.call(tabsBlocks, function (tabs) {
      var syncIds = tabs.classList.contains('is-sync') ? {} : undefined
      var tablist = tabs.querySelector('.tablist ul')
      tablist.setAttribute('role', 'tablist')
      var start
      forEach.call(tablist.querySelectorAll('li'), function (tab, idx) {
        tab.tabIndex = -1
        tab.setAttribute('role', tab.classList.add('tab') || 'tab')
        var id, anchor, syncId
        if (!(id = tab.id) && (anchor = tab.querySelector('a[id]'))) {
          id = tab.id = anchor.parentNode.removeChild(anchor).id
        }
        var panel = id && tabs.querySelector('.tabpanel[aria-labelledby~="' + id + '"]')
        if (!panel) return idx ? undefined : toggleSelected(tab, true) // invalid state
        syncIds && (((syncId = tab.textContent.trim()) in syncIds) ? (syncId = undefined) : true) &&
          (syncIds[(tab.dataset.syncId = syncId)] = tab)
        idx || (syncIds && (start = { tab: tab, panel: panel })) ? toggleHidden(panel, true) : toggleSelected(tab, true)
        tab.setAttribute('aria-controls', panel.id)
        panel.setAttribute('role', 'tabpanel')
        var onClick = syncId === undefined ? activateTab : activateTabSync
        tab.addEventListener('click', onClick.bind({ tabs: tabs, tab: tab, panel: panel }))
      })
      if (!tabs.closest('.tabpanel')) {
        forEach.call(tabs.querySelectorAll('.tabpanel table.tableblock'), function (table) {
          var container = Object.assign(document.createElement('div'), { className: 'tablecontainer' })
          table.parentNode.insertBefore(container, table).appendChild(table)
        })
      }
      if (start) {
        var syncGroupId
        for (var i = 0, lst = tabs.classList, len = lst.length, className; i !== len; i++) {
          if (!(className = lst.item(i)).startsWith('data-sync-group-id=')) continue
          tabs.dataset.syncGroupId = syncGroupId = lst.remove(className) || className.slice(19).replace(/\u00a0/g, ' ')
          break
        }
        if (syncGroupId === undefined) tabs.dataset.syncGroupId = syncGroupId = Object.keys(syncIds).sort().join('|')
        var preferredSyncId = 'syncStorageKey' in config &&
          window[(config.syncStorageScope || 'local') + 'Storage'].getItem(config.syncStorageKey + '-' + syncGroupId)
        var tab = preferredSyncId && syncIds[preferredSyncId]
        tab && Object.assign(start, { tab: tab, panel: document.getElementById(tab.getAttribute('aria-controls')) })
        toggleSelected(start.tab, true) || toggleHidden(start.panel, false)
      }
    })
    onHashChange()
    toggleClassOnEach(tabsBlocks, 'is-loading', 'remove')
    window.setTimeout(toggleClassOnEach.bind(null, tabsBlocks, 'is-loaded', 'add'), 0)
    window.addEventListener('hashchange', onHashChange)
  }

  function activateTab (e) {
    var tab = this.tab
    var tabs = this.tabs || (this.tabs = tab.closest('.tabs'))
    var panel = this.panel || (this.panel = document.getElementById(tab.getAttribute('aria-controls')))
    querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (el) {
      toggleSelected(el, el === tab)
    })
    querySelectorWithSiblings(tabs, '.tabpanel', 'tabpanel').forEach(function (el) {
      toggleHidden(el, el !== panel)
    })
    if (!this.isSync && 'syncStorageKey' in config && 'syncGroupId' in tabs.dataset) {
      var storageKey = config.syncStorageKey + '-' + tabs.dataset.syncGroupId
      window[(config.syncStorageScope || 'local') + 'Storage'].setItem(storageKey, tab.dataset.syncId)
    }
    if (!e) return
    var loc = window.location
    var hashIdx = loc.hash ? loc.href.indexOf('#') : -1
    if (~hashIdx) window.history.replaceState(null, '', loc.href.slice(0, hashIdx))
    e.preventDefault()
  }

  function activateTabSync (e) {
    activateTab.call(this, e)
    var thisTabs = this.tabs
    var thisTab = this.tab
    var initialY = thisTabs.getBoundingClientRect().y
    forEach.call(document.querySelectorAll('.tabs'), function (tabs) {
      if (tabs === thisTabs || tabs.dataset.syncGroupId !== thisTabs.dataset.syncGroupId) return
      querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (tab) {
        if (tab.dataset.syncId === thisTab.dataset.syncId) activateTab.call({ tabs: tabs, tab: tab, isSync: true })
      })
    })
    var shiftedBy = thisTabs.getBoundingClientRect().y - initialY
    if (shiftedBy && (shiftedBy = Math.round(shiftedBy))) window.scrollBy({ top: shiftedBy, behavior: 'instant' })
  }

  function querySelectorWithSiblings (scope, selector, siblingClass) {
    var el = scope.querySelector(selector)
    if (!el) return []
    var result = [el]
    while ((el = el.nextElementSibling) && el.classList.contains(siblingClass)) result.push(el)
    return result
  }

  function toggleClassOnEach (elements, className, method) {
    forEach.call(elements, function (el) {
      el.classList[method](className)
    })
  }

  function toggleHidden (el, state) {
    el.classList[(el.hidden = state) ? 'add' : 'remove']('is-hidden')
  }

  function toggleSelected (el, state) {
    el.setAttribute('aria-selected', '' + state)
    el.classList[state ? 'add' : 'remove']('is-selected')
    el.tabIndex = state ? 0 : -1
  }

  function onHashChange () {
    var id = window.location.hash.slice(1)
    if (!id) return
    var tab = document.getElementById(~id.indexOf('%') ? decodeURIComponent(id) : id)
    if (!(tab && tab.classList.contains('tab'))) return
    'syncId' in tab.dataset ? activateTabSync.call({ tab: tab }) : activateTab.call({ tab: tab })
  }
})()
</script>
</body>
</html>